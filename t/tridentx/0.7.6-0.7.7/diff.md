# Comparing `tmp/tridentx-0.7.6-py3-none-any.whl.zip` & `tmp/tridentx-0.7.7-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,82 +1,82 @@
-Zip file size: 1176179 bytes, number of entries: 153
--rw-rw-rw-  2.0 fat      720 b- defN 23-Feb-01 02:47 trident/__init__.py
+Zip file size: 1176563 bytes, number of entries: 153
+-rw-rw-rw-  2.0 fat      720 b- defN 23-Aug-01 08:24 trident/__init__.py
 -rw-rw-rw-  2.0 fat    13441 b- defN 23-Feb-07 20:17 trident/context.py
 -rw-rw-rw-  2.0 fat    41712 b- defN 22-Jun-01 13:00 trident/readable_errors.py
 -rw-rw-rw-  2.0 fat     3598 b- defN 23-Feb-19 02:15 trident/backend/__init__.py
 -rw-rw-rw-  2.0 fat    64781 b- defN 23-Feb-03 09:39 trident/backend/common.py
 -rw-rw-rw-  2.0 fat     2048 b- defN 23-Jan-31 15:55 trident/backend/decorators.py
 -rw-rw-rw-  2.0 fat    13093 b- defN 22-Jan-06 01:17 trident/backend/distribution.py
 -rw-rw-rw-  2.0 fat     3621 b- defN 22-May-19 18:16 trident/backend/dtype.py
 -rw-rw-rw-  2.0 fat    30444 b- defN 23-Jan-31 16:22 trident/backend/function.py
 -rw-rw-rw-  2.0 fat    71540 b- defN 23-Feb-02 21:45 trident/backend/graph_tools.py
 -rw-rw-rw-  2.0 fat    28221 b- defN 22-Jan-06 01:17 trident/backend/iteration_tools.py
--rw-rw-rw-  2.0 fat   105784 b- defN 23-Feb-19 02:56 trident/backend/jax_backend.py
--rw-rw-rw-  2.0 fat   111490 b- defN 23-Mar-18 05:28 trident/backend/jax_ops.py
+-rw-rw-rw-  2.0 fat   105774 b- defN 23-Apr-06 21:16 trident/backend/jax_backend.py
+-rw-rw-rw-  2.0 fat   112324 b- defN 23-May-08 22:28 trident/backend/jax_ops.py
 -rw-rw-rw-  2.0 fat    37076 b- defN 23-Feb-07 20:26 trident/backend/jax_serialization.py
 -rw-rw-rw-  2.0 fat     5169 b- defN 23-Feb-07 15:20 trident/backend/load_backend.py
--rw-rw-rw-  2.0 fat    54142 b- defN 23-Feb-15 15:14 trident/backend/model.py
--rw-rw-rw-  2.0 fat   129771 b- defN 23-Feb-18 17:47 trident/backend/numpy_ops.py
+-rw-rw-rw-  2.0 fat    54095 b- defN 23-Jul-11 13:14 trident/backend/model.py
+-rw-rw-rw-  2.0 fat   129775 b- defN 23-May-21 07:18 trident/backend/numpy_ops.py
 -rw-rw-rw-  2.0 fat    12911 b- defN 23-Jan-20 14:20 trident/backend/opencv_backend.py
 -rw-rw-rw-  2.0 fat     8181 b- defN 23-Jan-20 14:20 trident/backend/pillow_backend.py
--rw-rw-rw-  2.0 fat   161801 b- defN 23-Feb-15 14:53 trident/backend/pytorch_backend.py
--rw-rw-rw-  2.0 fat   186932 b- defN 23-Mar-18 05:28 trident/backend/pytorch_ops.py
--rw-rw-rw-  2.0 fat   161019 b- defN 23-Feb-08 07:27 trident/backend/tensorflow_backend.py
--rw-rw-rw-  2.0 fat   172078 b- defN 23-Mar-18 05:28 trident/backend/tensorflow_ops.py
+-rw-rw-rw-  2.0 fat   161888 b- defN 23-Aug-01 05:11 trident/backend/pytorch_backend.py
+-rw-rw-rw-  2.0 fat   188174 b- defN 23-Jun-25 11:32 trident/backend/pytorch_ops.py
+-rw-rw-rw-  2.0 fat   160455 b- defN 23-Apr-06 22:22 trident/backend/tensorflow_backend.py
+-rw-rw-rw-  2.0 fat   172203 b- defN 23-May-08 22:28 trident/backend/tensorflow_ops.py
 -rw-rw-rw-  2.0 fat    37231 b- defN 23-Feb-07 15:30 trident/backend/tensorflow_serialization.py
 -rw-rw-rw-  2.0 fat    37642 b- defN 23-Jan-30 16:43 trident/backend/tensorspec.py
 -rw-rw-rw-  2.0 fat      749 b- defN 21-Nov-28 19:11 trident/callbacks/__init__.py
 -rw-rw-rw-  2.0 fat    17735 b- defN 22-May-29 16:18 trident/callbacks/callback_base.py
 -rw-rw-rw-  2.0 fat     2347 b- defN 23-Feb-07 20:42 trident/callbacks/dataflow_callbacks.py
 -rw-rw-rw-  2.0 fat    27191 b- defN 23-Feb-07 20:42 trident/callbacks/lr_schedulers.py
 -rw-rw-rw-  2.0 fat    23850 b- defN 23-Feb-07 20:43 trident/callbacks/regularization_callbacks.py
 -rw-rw-rw-  2.0 fat     1838 b- defN 23-Feb-07 20:43 trident/callbacks/saving_strategies.py
--rw-rw-rw-  2.0 fat    41360 b- defN 22-Dec-16 13:15 trident/callbacks/visualization_callbacks.py
--rw-rw-rw-  2.0 fat      630 b- defN 21-Nov-08 20:13 trident/data/__init__.py
+-rw-rw-rw-  2.0 fat    41257 b- defN 23-Apr-06 23:51 trident/callbacks/visualization_callbacks.py
+-rw-rw-rw-  2.0 fat      631 b- defN 23-May-21 06:49 trident/data/__init__.py
 -rw-rw-rw-  2.0 fat     6308 b- defN 21-Nov-08 19:41 trident/data/augment_policy.py
 -rw-rw-rw-  2.0 fat    12988 b- defN 21-Nov-08 19:41 trident/data/bbox.py
 -rw-rw-rw-  2.0 fat    13459 b- defN 22-Dec-03 22:11 trident/data/bbox_common.py
 -rw-rw-rw-  2.0 fat   167037 b- defN 21-Apr-10 08:15 trident/data/char_freq.txt
--rw-rw-rw-  2.0 fat    63838 b- defN 23-Feb-07 20:44 trident/data/data_loaders.py
+-rw-rw-rw-  2.0 fat    64603 b- defN 23-Apr-07 00:59 trident/data/data_loaders.py
 -rw-rw-rw-  2.0 fat    38678 b- defN 22-May-19 15:25 trident/data/data_provider.py
--rw-rw-rw-  2.0 fat    70058 b- defN 22-Dec-16 15:50 trident/data/dataset.py
--rw-rw-rw-  2.0 fat    24203 b- defN 22-Jul-26 13:02 trident/data/image_common.py
+-rw-rw-rw-  2.0 fat    70094 b- defN 23-May-21 07:12 trident/data/dataset.py
+-rw-rw-rw-  2.0 fat    24083 b- defN 23-May-21 07:07 trident/data/image_common.py
 -rw-rw-rw-  2.0 fat     4383 b- defN 21-Nov-08 19:41 trident/data/image_reader.py
 -rw-rw-rw-  2.0 fat     2785 b- defN 21-Nov-08 19:41 trident/data/label_common.py
--rw-rw-rw-  2.0 fat     8905 b- defN 21-Dec-21 01:31 trident/data/mask_common.py
+-rw-rw-rw-  2.0 fat     8529 b- defN 23-Jul-11 13:20 trident/data/mask_common.py
 -rw-rw-rw-  2.0 fat     5958 b- defN 21-Nov-08 19:41 trident/data/preprocess_policy.py
 -rw-rw-rw-  2.0 fat    10001 b- defN 22-Aug-08 12:55 trident/data/samplers.py
 -rw-rw-rw-  2.0 fat    39074 b- defN 22-May-19 15:09 trident/data/t2s.txt
 -rw-rw-rw-  2.0 fat   599727 b- defN 21-Nov-29 18:10 trident/data/text2pronounce.txt
 -rw-rw-rw-  2.0 fat     3728 b- defN 21-Nov-08 19:41 trident/data/text_common.py
 -rw-rw-rw-  2.0 fat    35274 b- defN 22-Jun-21 19:36 trident/data/text_transforms.py
--rw-rw-rw-  2.0 fat    21375 b- defN 22-Oct-11 11:10 trident/data/transform.py
+-rw-rw-rw-  2.0 fat    21379 b- defN 23-May-21 07:10 trident/data/transform.py
 -rw-rw-rw-  2.0 fat    28830 b- defN 22-Jun-03 15:11 trident/data/utils.py
 -rw-rw-rw-  2.0 fat   119214 b- defN 23-Jan-30 16:11 trident/data/vision_transforms.py
 -rw-rw-rw-  2.0 fat       22 b- defN 21-Nov-08 19:41 trident/layers/__init__.py
 -rw-rw-rw-  2.0 fat    24238 b- defN 23-Feb-19 02:52 trident/layers/jax_activations.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-May-19 15:25 trident/layers/jax_blocks.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-May-19 15:25 trident/layers/jax_initializers.py
 -rw-rw-rw-  2.0 fat     3766 b- defN 23-Feb-19 02:21 trident/layers/jax_layers.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-May-19 15:25 trident/layers/jax_normalizations.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-May-19 15:25 trident/layers/jax_pooling.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-May-19 15:25 trident/layers/jax_rnn.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-May-19 15:25 trident/layers/jax_transformers.py
 -rw-rw-rw-  2.0 fat    24467 b- defN 23-Mar-16 06:55 trident/layers/pytorch_activations.py
 -rw-rw-rw-  2.0 fat    70188 b- defN 23-Feb-08 08:42 trident/layers/pytorch_blocks.py
 -rw-rw-rw-  2.0 fat    12460 b- defN 22-Dec-14 20:33 trident/layers/pytorch_initializers.py
--rw-rw-rw-  2.0 fat   121085 b- defN 23-Feb-15 08:23 trident/layers/pytorch_layers.py
+-rw-rw-rw-  2.0 fat   122537 b- defN 23-Aug-01 08:30 trident/layers/pytorch_layers.py
 -rw-rw-rw-  2.0 fat    34202 b- defN 23-Feb-01 06:27 trident/layers/pytorch_normalizations.py
--rw-rw-rw-  2.0 fat    38800 b- defN 22-Dec-04 09:06 trident/layers/pytorch_pooling.py
+-rw-rw-rw-  2.0 fat    38804 b- defN 23-Jun-23 04:45 trident/layers/pytorch_pooling.py
 -rw-rw-rw-  2.0 fat    47106 b- defN 22-May-19 15:25 trident/layers/pytorch_rnn.py
 -rw-rw-rw-  2.0 fat    47274 b- defN 22-Sep-09 03:25 trident/layers/pytorch_transformers.py
 -rw-rw-rw-  2.0 fat    19614 b- defN 22-May-28 08:10 trident/layers/tensorflow_activations.py
 -rw-rw-rw-  2.0 fat    51498 b- defN 22-May-19 15:25 trident/layers/tensorflow_blocks.py
 -rw-rw-rw-  2.0 fat    14544 b- defN 22-Jun-28 13:18 trident/layers/tensorflow_initializers.py
--rw-rw-rw-  2.0 fat    68883 b- defN 22-Jun-28 13:18 trident/layers/tensorflow_layers.py
+-rw-rw-rw-  2.0 fat    68646 b- defN 23-Mar-29 22:36 trident/layers/tensorflow_layers.py
 -rw-rw-rw-  2.0 fat    30439 b- defN 22-May-19 15:25 trident/layers/tensorflow_normalizations.py
 -rw-rw-rw-  2.0 fat    28286 b- defN 21-Dec-16 05:35 trident/layers/tensorflow_pooling.py
 -rw-rw-rw-  2.0 fat    60659 b- defN 22-Dec-12 15:36 trident/layers/tensorflow_rnn.py
 -rw-rw-rw-  2.0 fat    14026 b- defN 22-May-19 15:25 trident/layers/tensorflow_transformers.py
 -rw-rw-rw-  2.0 fat     1033 b- defN 21-Nov-08 19:41 trident/loggers/BaseLogger.py
 -rw-rw-rw-  2.0 fat      403 b- defN 21-Dec-16 05:35 trident/loggers/__init__.py
 -rw-rw-rw-  2.0 fat    17326 b- defN 21-Jun-07 18:51 trident/loggers/graph.py
@@ -118,20 +118,20 @@
 -rw-rw-rw-  2.0 fat    21152 b- defN 21-Dec-22 16:48 trident/models/tensorflow_densenet.py
 -rw-rw-rw-  2.0 fat    20992 b- defN 22-May-29 15:40 trident/models/tensorflow_efficientnet.py
 -rw-rw-rw-  2.0 fat     6564 b- defN 21-Dec-12 14:21 trident/models/tensorflow_mobilenet.py
 -rw-rw-rw-  2.0 fat    17403 b- defN 21-Nov-08 19:41 trident/models/tensorflow_mtcnn.py
 -rw-rw-rw-  2.0 fat     7741 b- defN 22-Jun-26 18:48 trident/models/tensorflow_resnet.py
 -rw-rw-rw-  2.0 fat     7341 b- defN 21-Dec-12 14:21 trident/models/tensorflow_vgg.py
 -rw-rw-rw-  2.0 fat        2 b- defN 21-Nov-08 19:41 trident/optims/__init__.py
--rw-rw-rw-  2.0 fat     8557 b- defN 23-Feb-01 02:13 trident/optims/losses.py
+-rw-rw-rw-  2.0 fat     8784 b- defN 23-Mar-19 17:58 trident/optims/losses.py
 -rw-rw-rw-  2.0 fat     2925 b- defN 22-May-29 15:40 trident/optims/metrics.py
 -rw-rw-rw-  2.0 fat     4498 b- defN 21-Dec-22 01:11 trident/optims/pytorch_constraints.py
--rw-rw-rw-  2.0 fat   115381 b- defN 23-Jan-21 06:35 trident/optims/pytorch_losses.py
+-rw-rw-rw-  2.0 fat   115401 b- defN 23-Mar-19 23:17 trident/optims/pytorch_losses.py
 -rw-rw-rw-  2.0 fat    11437 b- defN 22-May-29 22:49 trident/optims/pytorch_metrics.py
--rw-rw-rw-  2.0 fat   135881 b- defN 23-Feb-28 17:44 trident/optims/pytorch_optimizers.py
+-rw-rw-rw-  2.0 fat   134607 b- defN 23-Jul-04 22:16 trident/optims/pytorch_optimizers.py
 -rw-rw-rw-  2.0 fat     4698 b- defN 21-Nov-08 19:41 trident/optims/pytorch_profiling.py
 -rw-rw-rw-  2.0 fat     2795 b- defN 22-Sep-03 21:00 trident/optims/pytorch_regularizers.py
 -rw-rw-rw-  2.0 fat   116767 b- defN 23-Feb-03 13:03 trident/optims/pytorch_trainer.py
 -rw-rw-rw-  2.0 fat     6181 b- defN 21-Dec-22 01:13 trident/optims/tensorflow_constraints.py
 -rw-rw-rw-  2.0 fat    63130 b- defN 22-Dec-10 18:36 trident/optims/tensorflow_losses.py
 -rw-rw-rw-  2.0 fat    12822 b- defN 22-May-29 21:22 trident/optims/tensorflow_metrics.py
 -rw-rw-rw-  2.0 fat   112541 b- defN 22-May-29 21:46 trident/optims/tensorflow_optimizers.py
@@ -143,13 +143,13 @@
 -rw-rw-rw-  2.0 fat    22242 b- defN 22-May-29 23:45 trident/reinforcement/tensorflow_policies.py
 -rw-rw-rw-  2.0 fat    16845 b- defN 22-May-19 15:25 trident/reinforcement/utils.py
 -rw-rw-rw-  2.0 fat     3462 b- defN 22-Jan-06 01:17 trident/reinforcement/envs/__init__.py
 -rw-rw-rw-  2.0 fat    21609 b- defN 22-Jan-06 01:17 trident/reinforcement/envs/tetris.py
 -rw-rw-rw-  2.0 fat    10211 b- defN 22-Jan-06 01:17 trident/reinforcement/envs/tetris2.py
 -rw-rw-rw-  2.0 fat    22759 b- defN 22-May-29 15:38 trident/reinforcement/envs/wrappers.py
 -rw-rw-rw-  2.0 fat     8856 b- defN 22-May-29 15:42 trident/tools/model_converter.py
--rw-rw-rw-  2.0 fat     1087 b- defN 23-Mar-18 05:55 tridentx-0.7.6.dist-info/LICENSE
--rw-rw-rw-  2.0 fat    10987 b- defN 23-Mar-18 05:55 tridentx-0.7.6.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Mar-18 05:55 tridentx-0.7.6.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        8 b- defN 23-Mar-18 05:55 tridentx-0.7.6.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat    13662 b- defN 23-Mar-18 05:55 tridentx-0.7.6.dist-info/RECORD
-153 files, 5267507 bytes uncompressed, 1154683 bytes compressed:  78.1%
+-rw-rw-rw-  2.0 fat     1087 b- defN 23-Aug-01 08:30 tridentx-0.7.7.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat    10977 b- defN 23-Aug-01 08:30 tridentx-0.7.7.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Aug-01 08:30 tridentx-0.7.7.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        8 b- defN 23-Aug-01 08:30 tridentx-0.7.7.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat    13662 b- defN 23-Aug-01 08:30 tridentx-0.7.7.dist-info/RECORD
+153 files, 5269567 bytes uncompressed, 1155067 bytes compressed:  78.1%
```

## zipnote {}

```diff
@@ -438,23 +438,23 @@
 
 Filename: trident/reinforcement/envs/wrappers.py
 Comment: 
 
 Filename: trident/tools/model_converter.py
 Comment: 
 
-Filename: tridentx-0.7.6.dist-info/LICENSE
+Filename: tridentx-0.7.7.dist-info/LICENSE
 Comment: 
 
-Filename: tridentx-0.7.6.dist-info/METADATA
+Filename: tridentx-0.7.7.dist-info/METADATA
 Comment: 
 
-Filename: tridentx-0.7.6.dist-info/WHEEL
+Filename: tridentx-0.7.7.dist-info/WHEEL
 Comment: 
 
-Filename: tridentx-0.7.6.dist-info/top_level.txt
+Filename: tridentx-0.7.7.dist-info/top_level.txt
 Comment: 
 
-Filename: tridentx-0.7.6.dist-info/RECORD
+Filename: tridentx-0.7.7.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## trident/__init__.py

```diff
@@ -11,15 +11,15 @@
 if sys.getdefaultencoding() != defaultencoding:
     reload(sys)
     sys.setdefaultencoding(defaultencoding)
 
 PACKAGE_ROOT = os.path.dirname(__file__)
 PROJECT_ROOT = os.path.dirname(PACKAGE_ROOT)
 
-__version__ = '0.7.6'
+__version__ = '0.7.7'
 stderr.write('trident {0}\n'.format(__version__))
 
 from trident import context
 from trident import readable_errors
 from trident.backend import *
 import threading
 import random
```

## trident/backend/jax_backend.py

```diff
@@ -794,15 +794,15 @@
 
         self._modules[name] = module
         self.nodes = OrderedDict([(mod.uuid, mod) for mod in list(self.modules()) if isinstance(mod, Layer)])
         if isinstance(module, Layer):
             for mod in module.modules():
                 mod.nodes = self.nodes
                 mod.is_root = False
-                mod._device = self._device
+                mod.device = self.device
                 reset_name(mod, self._uid_prefixs)
                 mod.relative_name = name if mod.relative_name == '' else name + '.' + mod.relative_name
 
         # elif inspect.isfunction(module) or callable(module):
         #     module.__name__ = name
         #     self._modules[name] = module
 
@@ -1127,15 +1127,15 @@
                             module._parameters[name].assign(identity(cast(para.value(), dtype)))
                 if module._buffers is not None and len(module._buffers) > 0:
                     for name, buff in module._buffers.items():
                         if buff is None:
                             module._buffers[name] = None
                         else:
                             module._buffers[name] = identity(cast(buff, dtype))
-                module._device = self._device
+                module.device = self.device
             except Exception as e:
                 print(e)
                 PrintException()
 
     def cuda(self: T, device: Optional[Union[int, str]] = None) -> T:
         """Moves all model parameters and buffers to the GPU.
 
@@ -1148,29 +1148,29 @@
                 copied to that device
 
         Returns:
             Module: self
         """
 
         if is_gpu_available:
-            if self.get_root()._device != 'cuda:0':
-                self.get_root()._device = 'cuda:0'
+            if self.get_root().device != 'cuda:0':
+                self.get_root().device = 'cuda:0'
             return self._apply(lambda t: jax.device_put(t, device=jax.devices("gpu")[0]))
 
         else:
             sys.stderr.write('GPU is not available in this machone./n')
 
     def cpu(self: T) -> T:
         """Moves all model parameters and buffers to the CPU.
 
         Returns:
             Module: self
         """
-        if self.get_root()._device != 'cpu':
-            self.get_root()._device = 'cpu'
+        if self.get_root().device != 'cpu':
+            self.get_root().device = 'cpu'
         return self._apply(lambda t: jax.device_put(t, device=jax.devices("cpu")[0]))
 
     def gpu(self: T, device: Optional[Union[int, str]] = None) -> T:
         """Moves all model parameters and buffers to the GPU.
 
         This also makes associated parameters and buffers different objects. So
         it should be called before constructing optimizer if the module will
@@ -1181,16 +1181,16 @@
                 copied to that device
 
         Returns:
             Module: self
         """
 
         if is_gpu_available:
-            if self.get_root()._device != 'cuda:0':
-                self.get_root()._device = 'cuda:0'
+            if self.get_root().device != 'cuda:0':
+                self.get_root().device = 'cuda:0'
             return self._apply(lambda t: jax.device_put(t, device=jax.devices("gpu")[0]))
         else:
             sys.stderr.write('GPU is not available in this machone./n')
 
     def _apply(self, fn):
         for module in self.children():
             module._apply(fn)
```

## trident/backend/jax_ops.py

```diff
@@ -3546,14 +3546,36 @@
 #     if axis != -1:
 #         axes = np.arange(ndim(label))
 #         axes[axis] = ndim(label) - 1
 #         axes[-1] = axis
 #         onehot = jnp.transpose(axes)
 #     return onehot
 
+@numpy_compatible
+def binary_cross_entropy(output, target, from_logits=False):
+    """Binary crossentropy between an output tensor and a target tensor.
+      Args:
+          target: A tensor with the same shape as `output`.
+          output: A tensor.
+          from_logits: Whether `output` is expected to be a logits tensor.
+              By default, we consider that `output`
+              encodes a probability distribution.
+      Returns:
+          A tensor.
+      """
+    if from_logits:
+        pass
+    else:
+        output = sigmoid(output)
+    if isinstance(target,(_float,_int )):
+        target=(ones_like(output)*float(target)).to(output.dtype).to(output.device)
+    bce = target *  jnp.log(jnp.clip(output,1e-7,1))
+    bce =bce+ (1 - target) * jnp.log(jnp.clip(1 - output,1e-7,1))
+    return -bce
+
 
 def bbox_iou(bboxes1: Tensor, bboxes2: Tensor):
     """
 
     Args:
         bboxes1 (Tensor): shape (n, 4)
         bboxes2 (Tensor): shape (n, 4)
```

## trident/backend/model.py

```diff
@@ -22,15 +22,15 @@
 from trident.context import split_path, make_dir_if_need, sanitize_path
 
 from trident.backend import dtype
 from trident.backend.common import to_list, format_time, get_terminal_size, get_backend, \
     PrintException, OrderedDict, adaptive_format, cyan_color, get_class, camel2snake, is_instance,unpack_singleton
 from trident.backend.opencv_backend import array2image
 from trident.backend.tensorspec import *
-from trident.data.image_common import *
+
 from trident.data.vision_transforms import Unnormalize
 from trident.loggers.history import HistoryBase
 
 ctx = context._context()
 working_directory = ctx.working_directory
 
 if get_backend() == 'pytorch':
@@ -1087,15 +1087,15 @@
                 self.print_batch_progress(self.training_context['print_batch_progress_frequency'])
 
                 self.training_context['print_batch_progress_frequency'] = 1
 
             else:
                 self.training_context['print_batch_progress_frequency'] += 1
 
-            if is_out_sample_evaluation == True:
+            if is_out_sample_evaluation:
                 self.model.eval()
                 verbose = []
                 for k in self.training_context['out_sample_metrics'].get_keys():
                     test_steps, test_values = self.training_context['out_sample_metrics'].get_series(k)
                     metric_value = test_values[-1]
                     history_metric_value = to_scalar(test_values[-1])
                     verbose.append('{0}: {1}'.format(k, adaptive_format(history_metric_value, prev_value=test_values,
```

## trident/backend/numpy_ops.py

```diff
@@ -1,14 +1,14 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
 
 import math
 import random
-from collections import Iterable
+from collections.abc import Iterable
 from typing import List, Optional, Sequence
 
 import numpy as np
 from scipy import special
 
 from trident import context
 from trident.backend import dtype as Dtype
```

## trident/backend/pytorch_backend.py

```diff
@@ -2146,7968 +2146,7973 @@
 00008610: 4572 726f 7228 227b 7d20 6361 6e6e 6f74  Error("{} cannot
 00008620: 2062 6520 6164 6465 6422 2e66 6f72 6d61   be added".forma
 00008630: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
 00008640: 2020 2020 746f 7263 682e 7479 7065 6e61      torch.typena
 00008650: 6d65 286d 6f64 756c 6529 2929 0d0a 2020  me(module)))..  
 00008660: 2020 2020 2020 656c 6966 206e 6f74 2069        elif not i
 00008670: 7369 6e73 7461 6e63 6528 6e61 6d65 2c20  sinstance(name, 
-00008680: 746f 7263 682e 5f73 6978 2e73 7472 696e  torch._six.strin
-00008690: 675f 636c 6173 7365 7329 3a0d 0a20 2020  g_classes):..   
-000086a0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-000086b0: 7970 6545 7272 6f72 2822 6d6f 6475 6c65  ypeError("module
-000086c0: 206e 616d 6520 7368 6f75 6c64 2062 6520   name should be 
-000086d0: 6120 7374 7269 6e67 2e20 476f 7420 7b7d  a string. Got {}
-000086e0: 222e 666f 726d 6174 2874 6f72 6368 2e74  ".format(torch.t
-000086f0: 7970 656e 616d 6528 6e61 6d65 2929 290d  ypename(name))).
-00008700: 0a20 2020 2020 2020 2065 6c69 6620 6861  .        elif ha
-00008710: 7361 7474 7228 7365 6c66 2c20 6e61 6d65  sattr(self, name
-00008720: 2920 616e 6420 6e61 6d65 206e 6f74 2069  ) and name not i
-00008730: 6e20 7365 6c66 2e5f 6d6f 6475 6c65 733a  n self._modules:
-00008740: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-00008750: 6973 6520 4b65 7945 7272 6f72 2822 6174  ise KeyError("at
-00008760: 7472 6962 7574 6520 277b 7d27 2061 6c72  tribute '{}' alr
-00008770: 6561 6479 2065 7869 7374 7322 2e66 6f72  eady exists".for
-00008780: 6d61 7428 6e61 6d65 2929 0d0a 2020 2020  mat(name))..    
-00008790: 2020 2020 656c 6966 2027 2e27 2069 6e20      elif '.' in 
-000087a0: 6e61 6d65 3a0d 0a20 2020 2020 2020 2020  name:..         
-000087b0: 2020 2023 206e 616d 653d 6e61 6d65 2e72     # name=name.r
-000087c0: 6570 6c61 6365 2827 2e27 2c27 5f27 290d  eplace('.','_').
-000087d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000087e0: 7365 204b 6579 4572 726f 7228 226d 6f64  se KeyError("mod
-000087f0: 756c 6520 6e61 6d65 2063 616e 2774 2063  ule name can't c
-00008800: 6f6e 7461 696e 205c 222e 5c22 2229 0d0a  ontain \".\"")..
-00008810: 2020 2020 2020 2020 656c 6966 206e 616d          elif nam
-00008820: 6520 3d3d 2027 273a 0d0a 2020 2020 2020  e == '':..      
-00008830: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
-00008840: 7272 6f72 2822 6d6f 6475 6c65 206e 616d  rror("module nam
-00008850: 6520 6361 6e27 7420 6265 2065 6d70 7479  e can't be empty
-00008860: 2073 7472 696e 6720 5c22 5c22 2229 0d0a   string \"\"")..
-00008870: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00008880: 6d6f 6475 6c65 735b 6e61 6d65 5d20 3d20  modules[name] = 
-00008890: 6d6f 6475 6c65 0d0a 2020 2020 2020 2020  module..        
-000088a0: 7365 6c66 2e6e 6f64 6573 203d 204f 7264  self.nodes = Ord
-000088b0: 6572 6564 4469 6374 285b 286d 6f64 2e75  eredDict([(mod.u
-000088c0: 7569 642c 206d 6f64 2920 666f 7220 6d6f  uid, mod) for mo
-000088d0: 6420 696e 206c 6973 7428 7365 6c66 2e6d  d in list(self.m
-000088e0: 6f64 756c 6573 2829 2920 6966 2069 7369  odules()) if isi
-000088f0: 6e73 7461 6e63 6528 6d6f 642c 204c 6179  nstance(mod, Lay
-00008900: 6572 295d 290d 0a0d 0a20 2020 2020 2020  er)])....       
-00008910: 2069 6620 6973 696e 7374 616e 6365 286d   if isinstance(m
-00008920: 6f64 756c 652c 204c 6179 6572 293a 0d0a  odule, Layer):..
-00008930: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00008940: 6d6f 6420 696e 206d 6f64 756c 652e 6d6f  mod in module.mo
-00008950: 6475 6c65 7328 293a 0d0a 2020 2020 2020  dules():..      
-00008960: 2020 2020 2020 2020 2020 6d6f 642e 6e6f            mod.no
-00008970: 6465 7320 3d20 7365 6c66 2e6e 6f64 6573  des = self.nodes
-00008980: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008990: 2020 6d6f 642e 6973 5f72 6f6f 7420 3d20    mod.is_root = 
-000089a0: 4661 6c73 650d 0a0d 0a0d 0a20 2020 2020  False......     
-000089b0: 2020 2020 2020 2020 2020 2072 6573 6574             reset
-000089c0: 5f6e 616d 6528 6d6f 642c 2073 656c 662e  _name(mod, self.
-000089d0: 5f75 6964 5f70 7265 6669 7873 290d 0a20  _uid_prefixs).. 
-000089e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000089f0: 6f64 2e72 656c 6174 6976 655f 6e61 6d65  od.relative_name
-00008a00: 203d 206e 616d 6520 6966 206d 6f64 2e72   = name if mod.r
-00008a10: 656c 6174 6976 655f 6e61 6d65 203d 3d20  elative_name == 
-00008a20: 2727 2065 6c73 6520 6e61 6d65 202b 2027  '' else name + '
-00008a30: 2e27 202b 206d 6f64 2e72 656c 6174 6976  .' + mod.relativ
-00008a40: 655f 6e61 6d65 0d0a 0d0a 2020 2020 6465  e_name....    de
-00008a50: 6620 6164 6428 7365 6c66 2c20 6d6f 6475  f add(self, modu
-00008a60: 6c65 293a 0d0a 2020 2020 2020 2020 2222  le):..        ""
-00008a70: 2253 696d 706c 6966 6965 6420 6164 645f  "Simplified add_
-00008a80: 6d6f 6475 6c65 0d0a 0d0a 2020 2020 2020  module....      
-00008a90: 2020 5573 6520 7468 6520 636f 756e 7420    Use the count 
-00008aa0: 6f66 2063 6869 6c64 206d 6f64 756c 6573  of child modules
-00008ab0: 2061 7320 7468 6520 6465 6661 756c 7420   as the default 
-00008ac0: 6e61 6d65 2e0d 0a0d 0a20 2020 2020 2020  name.....       
-00008ad0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00008ae0: 2020 2020 6d6f 6475 6c65 2028 4d6f 6475      module (Modu
-00008af0: 6c65 293a 2063 6869 6c64 206d 6f64 756c  le): child modul
-00008b00: 6520 746f 2062 6520 6164 6465 6420 746f  e to be added to
-00008b10: 2074 6865 206d 6f64 756c 652e 0d0a 0d0a   the module.....
-00008b20: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00008b30: 2020 2020 2069 6620 6d6f 6475 6c65 2069       if module i
-00008b40: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00008b50: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
-00008b60: 726f 7228 226d 6f64 756c 6520 2063 616e  ror("module  can
-00008b70: 2774 2062 6520 4e6f 6e65 2229 0d0a 2020  't be None")..  
-00008b80: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00008b90: 7461 6e63 6528 6d6f 6475 6c65 2c20 4c61  tance(module, La
-00008ba0: 7965 7229 3a0d 0a20 2020 2020 2020 2020  yer):..         
-00008bb0: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
-00008bc0: 6c65 2873 7472 286c 656e 2873 656c 662e  le(str(len(self.
-00008bd0: 5f6d 6f64 756c 6573 2929 2c0d 0a20 2020  _modules)),..   
-00008be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bf0: 2020 2020 2020 2020 206d 6f64 756c 6529           module)
-00008c00: 2020 2320 7365 6c66 2e6e 6f64 6573 203d    # self.nodes =
-00008c10: 206e 6f64 6573 2020 2320 666f 7220 6d6f   nodes  # for mo
-00008c20: 6420 696e 2073 656c 662e 6d6f 6475 6c65  d in self.module
-00008c30: 7328 293a 2020 2320 2020 2020 6d6f 642e  s():  #     mod.
-00008c40: 6e6f 6465 7320 3d20 6e6f 6465 730d 0a0d  nodes = nodes...
-00008c50: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00008c60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00008c70: 6520 5661 6c75 6545 7272 6f72 2827 4e6f  e ValueError('No
-00008c80: 7420 7661 6c69 6420 6d6f 6475 6c65 2729  t valid module')
-00008c90: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-00008ca0: 6428 7365 6c66 2c20 2a69 6e70 7574 5f73  d(self, *input_s
-00008cb0: 6861 7065 3a20 5465 6e73 6f72 5368 6170  hape: TensorShap
-00008cc0: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
-00008cd0: 2044 6f20 7468 6520 7368 6170 6520 696e   Do the shape in
-00008ce0: 6665 7265 6e63 6520 616e 6420 696e 6974  ference and init
-00008cf0: 6961 6c69 7a65 2077 6569 6768 7473 2061  ialize weights a
-00008d00: 6e64 2062 6961 732e 0d0a 0d0a 2020 2020  nd bias.....    
-00008d10: 2020 2020 6062 7569 6c64 2720 6973 2061      `build' is a
-00008d20: 206b 6579 206d 6574 686f 6420 696e 2074   key method in t
-00008d30: 7269 6465 6e74 2c20 796f 7520 6361 6e20  rident, you can 
-00008d40: 7573 6520 2070 726f 7065 7274 7920 6062  use  property `b
-00008d50: 7569 6c74 2720 746f 2063 6865 636b 2077  uilt' to check w
-00008d60: 6865 7468 6572 2074 6865 206c 6179 6572  hether the layer
-00008d70: 2064 6f20 7468 6520 6275 696c 6420 7072   do the build pr
-00008d80: 6f63 6573 732e 0d0a 2020 2020 2020 2020  ocess...        
-00008d90: 496e 2027 6275 696c 6427 202c 2077 6520  In 'build' , we 
-00008da0: 6e65 6564 2074 6f20 7075 7420 616c 6c20  need to put all 
-00008db0: 7468 6520 6c6f 6769 6373 2061 626f 7574  the logics about
-00008dc0: 2020 686f 7720 746f 2063 6f6d 6669 726d    how to comfirm
-00008dd0: 2074 6865 2073 6861 7065 206f 6620 6f75   the shape of ou
-00008de0: 7470 7574 732c 2077 6569 6768 7473 2061  tputs, weights a
-00008df0: 6e64 2062 6961 7320 6163 636f 7264 696e  nd bias accordin
-00008e00: 6720 746f 2074 6865 2063 6f6d 696e 6720  g to the coming 
-00008e10: 696e 7075 7420 7465 6e73 6f72 2e0d 0a0d  input tensor....
-00008e20: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-00008e30: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00008e40: 745f 7368 6170 6520 2854 656e 736f 7253  t_shape (TensorS
-00008e50: 6861 7065 293a 2020 7468 6520 7368 6170  hape):  the shap
-00008e60: 6520 7265 7072 6573 656e 7461 7469 6f6e  e representation
-00008e70: 2065 7863 6c75 6465 2074 6865 2062 6174   exclude the bat
-00008e80: 6368 2061 7869 732e 0d0a 0d0a 2020 2020  ch axis.....    
-00008e90: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00008ea0: 2070 6173 730d 0a0d 0a20 2020 2064 6566   pass....    def
-00008eb0: 2072 6562 7569 6c64 2873 656c 662c 2069   rebuild(self, i
-00008ec0: 6e70 7574 5f73 6861 7065 293a 0d0a 2020  nput_shape):..  
-00008ed0: 2020 2020 2020 2222 2220 446f 2074 6865        """ Do the
-00008ee0: 2073 6861 7065 2069 6e66 6572 656e 6365   shape inference
-00008ef0: 2061 6e64 2069 6e69 7469 616c 697a 6520   and initialize 
-00008f00: 7765 6967 6874 7320 616e 6420 6269 6173  weights and bias
-00008f10: 2e0d 0a0d 0a20 2020 2020 2020 2060 6275  .....        `bu
-00008f20: 696c 6427 2069 7320 6120 6b65 7920 6d65  ild' is a key me
-00008f30: 7468 6f64 2069 6e20 7472 6964 656e 742c  thod in trident,
-00008f40: 2079 6f75 2063 616e 2075 7365 2020 7072   you can use  pr
-00008f50: 6f70 6572 7479 2060 6275 696c 7427 2074  operty `built' t
-00008f60: 6f20 6368 6563 6b20 7768 6574 6865 7220  o check whether 
-00008f70: 7468 6520 6c61 7965 7220 646f 2074 6865  the layer do the
-00008f80: 2062 7569 6c64 2070 726f 6365 7373 2e0d   build process..
-00008f90: 0a20 2020 2020 2020 2049 6e20 2762 7569  .        In 'bui
-00008fa0: 6c64 2720 2c20 7765 206e 6565 6420 746f  ld' , we need to
-00008fb0: 2070 7574 2061 6c6c 2074 6865 206c 6f67   put all the log
-00008fc0: 6963 7320 6162 6f75 7420 2068 6f77 2074  ics about  how t
-00008fd0: 6f20 636f 6d66 6972 6d20 7468 6520 7368  o comfirm the sh
-00008fe0: 6170 6520 6f66 206f 7574 7075 7473 2c20  ape of outputs, 
-00008ff0: 7765 6967 6874 7320 616e 6420 6269 6173  weights and bias
-00009000: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
-00009010: 6520 636f 6d69 6e67 2069 6e70 7574 2074  e coming input t
-00009020: 656e 736f 722e 0d0a 0d0a 2020 2020 2020  ensor.....      
-00009030: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-00009040: 2020 2020 2069 6e70 7574 5f73 6861 7065       input_shape
-00009050: 2028 7465 6e73 6f72 293a 2020 7468 6520   (tensor):  the 
-00009060: 7368 6170 6520 7265 7072 6573 656e 7461  shape representa
-00009070: 7469 6f6e 2065 7863 6c75 6465 2074 6865  tion exclude the
-00009080: 2062 6174 6368 2061 7869 732e 0d0a 0d0a   batch axis.....
-00009090: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-000090a0: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
-000090b0: 2020 2020 2020 2020 2027 596f 7572 206d           'Your m
-000090c0: 6f64 656c 2077 696c 6c20 7374 6172 7420  odel will start 
-000090d0: 746f 2072 6562 7569 6c64 2c20 6974 2077  to rebuild, it w
-000090e0: 696c 6c20 6361 7573 6520 6c6f 7374 2061  ill cause lost a
-000090f0: 6c6c 2065 7869 7374 696e 6720 7472 6169  ll existing trai
-00009100: 6e61 626c 6520 7061 7261 6d65 7465 7273  nable parameters
-00009110: 2c20 7769 6c6c 2079 6f75 2077 616e 7420  , will you want 
-00009120: 746f 2072 6562 7569 6c64 2069 743f 2729  to rebuild it?')
-00009130: 0d0a 2020 2020 2020 2020 616e 7320 3d20  ..        ans = 
-00009140: 696e 7075 7428 2728 592f 4e29 203c 3c20  input('(Y/N) << 
-00009150: 2729 2e6c 6f77 6572 2829 0d0a 2020 2020  ').lower()..    
-00009160: 2020 2020 6966 2061 6e73 2069 6e20 5b27      if ans in ['
-00009170: 7965 7327 2c20 2779 275d 3a0d 0a20 2020  yes', 'y']:..   
-00009180: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
-00009190: 652c 206d 6f64 756c 6520 696e 2073 656c  e, module in sel
-000091a0: 662e 6e61 6d65 645f 6d6f 6475 6c65 7328  f.named_modules(
-000091b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000091c0: 2020 2020 6966 206c 656e 286d 6f64 756c      if len(modul
-000091d0: 652e 5f70 6172 616d 6574 6572 7329 203e  e._parameters) >
-000091e0: 2030 206f 7220 6d6f 6475 6c65 2e74 7261   0 or module.tra
-000091f0: 696e 6162 6c65 3a0d 0a20 2020 2020 2020  inable:..       
-00009200: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00009210: 756c 652e 5f69 6e70 7574 5f73 6861 7065  ule._input_shape
-00009220: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-00009230: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00009240: 756c 652e 5f6f 7574 7075 745f 7368 6170  ule._output_shap
-00009250: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
-00009260: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00009270: 6475 6c65 2e5f 6275 696c 7420 3d20 4661  dule._built = Fa
-00009280: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00009290: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
-000092a0: 6e20 6d6f 6475 6c65 2e5f 7061 7261 6d65  n module._parame
-000092b0: 7465 7273 2e6b 6579 7328 293a 0d0a 2020  ters.keys():..  
-000092c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092d0: 2020 2020 2020 6d6f 6475 6c65 2e5f 7061        module._pa
-000092e0: 7261 6d65 7465 7273 5b6b 5d20 3d20 4e6f  rameters[k] = No
-000092f0: 6e65 0d0a 0d0a 2020 2020 2020 2020 2020  ne....          
-00009300: 2020 2020 2020 6966 206c 656e 286d 6f64        if len(mod
-00009310: 756c 652e 5f66 6f72 7761 7264 5f70 7265  ule._forward_pre
-00009320: 5f68 6f6f 6b73 2920 3e20 303a 0d0a 2020  _hooks) > 0:..  
-00009330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009340: 2020 6d6f 6475 6c65 2e5f 666f 7277 6172    module._forwar
-00009350: 645f 7072 655f 686f 6f6b 7320 3d20 4f72  d_pre_hooks = Or
-00009360: 6465 7265 6444 6963 7428 290d 0a0d 0a20  deredDict().... 
-00009370: 2020 2020 2020 2020 2020 2064 756d 6d61             dumma
-00009380: 795f 696e 7075 7420 3d20 746f 5f74 656e  y_input = to_ten
-00009390: 736f 7228 6e70 2e72 616e 646f 6d2e 7374  sor(np.random.st
-000093a0: 616e 6461 7264 5f6e 6f72 6d61 6c28 2832  andard_normal((2
-000093b0: 2c29 202b 2069 6e70 7574 5f73 6861 7065  ,) + input_shape
-000093c0: 292e 6173 7479 7065 286e 702e 666c 6f61  ).astype(np.floa
-000093d0: 7433 3229 292e 746f 2867 6574 5f64 6576  t32)).to(get_dev
-000093e0: 6963 6528 2929 0d0a 2020 2020 2020 2020  ice())..        
-000093f0: 2020 2020 6f75 7420 3d20 7365 6c66 2e66      out = self.f
-00009400: 6f72 7761 7264 2864 756d 6d61 795f 696e  orward(dummay_in
-00009410: 7075 7429 0d0a 0d0a 2020 2020 4070 726f  put)....    @pro
-00009420: 7065 7274 790d 0a20 2020 2064 6566 2074  perty..    def t
-00009430: 7261 696e 6162 6c65 5f77 6569 6768 7473  rainable_weights
-00009440: 2873 656c 6629 202d 3e20 4c69 7374 5b6e  (self) -> List[n
-00009450: 6e2e 5061 7261 6d65 7465 725d 3a0d 0a20  n.Parameter]:.. 
-00009460: 2020 2020 2020 2022 2222 5468 6520 6c69         """The li
-00009470: 7374 206f 6620 7472 6169 6e61 626c 6520  st of trainable 
-00009480: 7661 7269 6162 6c65 7320 2870 6172 616d  variables (param
-00009490: 6574 6572 7329 206f 6620 7468 6520 6d6f  eters) of the mo
-000094a0: 6475 6c65 2e0d 0a20 2020 2020 2020 2050  dule...        P
-000094b0: 6172 616d 6574 6572 7320 6f66 2074 6869  arameters of thi
-000094c0: 7320 6d6f 6475 6c65 2061 6e64 2061 6c6c  s module and all
-000094d0: 2069 7473 2073 7562 6d6f 6475 6c65 7320   its submodules 
-000094e0: 6172 6520 696e 636c 7564 6564 2e0d 0a0d  are included....
-000094f0: 0a20 2020 2020 2020 204e 6f74 6573 3a0d  .        Notes:.
-00009500: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00009510: 206c 6973 7420 7265 7475 726e 6564 206d   list returned m
-00009520: 6179 2063 6f6e 7461 696e 2064 7570 6c69  ay contain dupli
-00009530: 6361 7465 2070 6172 616d 6574 6572 7320  cate parameters 
-00009540: 2865 2e67 2e20 6f75 7470 7574 0d0a 2020  (e.g. output..  
-00009550: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
-00009560: 7368 6172 6573 2070 6172 616d 6574 6572  shares parameter
-00009570: 7320 7769 7468 2065 6d62 6564 6469 6e67  s with embedding
-00009580: 7329 2e20 466f 7220 6d6f 7374 2075 7361  s). For most usa
-00009590: 6765 732c 2069 7427 7320 6e6f 740d 0a20  ges, it's not.. 
-000095a0: 2020 2020 2020 2020 2020 206e 6563 6573             neces
-000095b0: 7361 7279 2074 6f20 656e 7375 7265 2075  sary to ensure u
-000095c0: 6e69 7175 656e 6573 732e 0d0a 0d0a 2020  niqueness.....  
-000095d0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-000095e0: 2020 2070 6172 6173 203d 205b 5d0d 0a20     paras = [].. 
-000095f0: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
-00009600: 7365 6c66 2e70 6172 616d 6574 6572 7328  self.parameters(
-00009610: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00009620: 6966 2070 2e72 6571 7569 7265 735f 6772  if p.requires_gr
-00009630: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00009640: 2020 2020 2070 6172 6173 2e61 7070 656e       paras.appen
-00009650: 6428 7029 0d0a 0d0a 2020 2020 2020 2020  d(p)....        
-00009660: 7265 7475 726e 2070 6172 6173 0d0a 0d0a  return paras....
-00009670: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-00009680: 2020 2064 6566 206e 6f6e 5f74 7261 696e     def non_train
-00009690: 6162 6c65 5f77 6569 6768 7473 2873 656c  able_weights(sel
-000096a0: 6629 202d 3e20 4c69 7374 5b6e 6e2e 5061  f) -> List[nn.Pa
-000096b0: 7261 6d65 7465 725d 3a0d 0a20 2020 2020  rameter]:..     
-000096c0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-000096d0: 5468 6520 6c69 7374 206f 6620 6e6f 6e2d  The list of non-
-000096e0: 7472 6169 6e61 626c 6520 7661 7269 6162  trainable variab
-000096f0: 6c65 7320 2870 6172 616d 6574 6572 7329  les (parameters)
-00009700: 206f 6620 7468 6520 6d6f 6475 6c65 2e50   of the module.P
-00009710: 6172 616d 6574 6572 7320 6f66 2074 6869  arameters of thi
-00009720: 7320 6d6f 6475 6c65 2061 6e64 2061 6c6c  s module and all
-00009730: 2069 7473 2073 7562 6d6f 6475 6c65 7320   its submodules 
-00009740: 6172 6520 696e 636c 7564 6564 2e0d 0a0d  are included....
-00009750: 0a20 2020 2020 2020 204e 6f74 6573 3a0d  .        Notes:.
-00009760: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00009770: 206c 6973 7420 7265 7475 726e 6564 206d   list returned m
-00009780: 6179 2063 6f6e 7461 696e 2064 7570 6c69  ay contain dupli
-00009790: 6361 7465 2070 6172 616d 6574 6572 7320  cate parameters 
-000097a0: 2865 2e67 2e20 6f75 7470 7574 0d0a 2020  (e.g. output..  
-000097b0: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
-000097c0: 7368 6172 6573 2070 6172 616d 6574 6572  shares parameter
-000097d0: 7320 7769 7468 2065 6d62 6564 6469 6e67  s with embedding
-000097e0: 7329 2e20 466f 7220 6d6f 7374 2075 7361  s). For most usa
-000097f0: 6765 732c 2069 7427 7320 6e6f 740d 0a20  ges, it's not.. 
-00009800: 2020 2020 2020 2020 2020 206e 6563 6573             neces
-00009810: 7361 7279 2074 6f20 656e 7375 7265 2075  sary to ensure u
-00009820: 6e69 7175 656e 6573 732e 0d0a 0d0a 2020  niqueness.....  
-00009830: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00009840: 2020 2070 6172 6173 203d 205b 5d0d 0a20     paras = [].. 
-00009850: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
-00009860: 7365 6c66 2e70 6172 616d 6574 6572 7328  self.parameters(
-00009870: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00009880: 6966 206e 6f74 2070 2e72 6571 7569 7265  if not p.require
-00009890: 735f 6772 6164 3a0d 0a20 2020 2020 2020  s_grad:..       
-000098a0: 2020 2020 2020 2020 2070 6172 6173 2e61           paras.a
-000098b0: 7070 656e 6428 7029 0d0a 0d0a 2020 2020  ppend(p)....    
-000098c0: 2020 2020 7265 7475 726e 2070 6172 6173      return paras
-000098d0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-000098e0: 790d 0a20 2020 2064 6566 2077 6569 6768  y..    def weigh
-000098f0: 7473 2873 656c 6629 3a0d 0a20 2020 2020  ts(self):..     
-00009900: 2020 2022 2222 5468 6520 6c69 7374 206f     """The list o
-00009910: 6620 616c 6c20 7661 7269 6162 6c65 7320  f all variables 
-00009920: 2870 6172 616d 6574 6572 7329 206f 6620  (parameters) of 
-00009930: 7468 6520 6d6f 6475 6c65 2e50 6172 616d  the module.Param
-00009940: 6574 6572 7320 6f66 2074 6869 7320 6d6f  eters of this mo
-00009950: 6475 6c65 2061 6e64 2061 6c6c 2069 7473  dule and all its
-00009960: 2073 7562 6d6f 6475 6c65 7320 6172 6520   submodules are 
-00009970: 696e 636c 7564 6564 2e22 2222 0d0a 2020  included."""..  
-00009980: 2020 2020 2020 7265 7475 726e 206c 6973        return lis
-00009990: 7428 7365 6c66 2e70 6172 616d 6574 6572  t(self.parameter
-000099a0: 7328 2929 0d0a 0d0a 2020 2020 6465 6620  s())....    def 
-000099b0: 6765 745f 7765 6967 6874 7328 7365 6c66  get_weights(self
-000099c0: 293a 0d0a 2020 2020 2020 2020 2222 2254  ):..        """T
-000099d0: 6865 206c 6973 7420 6f66 2061 6c6c 206e  he list of all n
-000099e0: 756d 7079 2076 6172 6961 626c 6573 206e  umpy variables n
-000099f0: 6461 7272 6179 2065 7175 6976 656c 656e  darray equivelen
-00009a00: 7420 6f66 2074 6865 206d 6f64 756c 652e  t of the module.
-00009a10: 5061 7261 6d65 7465 7273 206f 6620 7468  Parameters of th
-00009a20: 6973 206d 6f64 756c 6520 616e 6420 616c  is module and al
-00009a30: 6c20 6974 7320 7375 626d 6f64 756c 6573  l its submodules
-00009a40: 2061 7265 2069 6e63 6c75 6465 642e 2222   are included.""
-00009a50: 220d 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-00009a60: 6e20 5b70 2e6e 756d 7079 2829 2066 6f72  n [p.numpy() for
-00009a70: 2070 2069 6e20 6c69 7374 2873 656c 662e   p in list(self.
-00009a80: 7061 7261 6d65 7465 7273 2829 295d 0d0a  parameters())]..
-00009a90: 0d0a 2020 2020 6465 6620 7365 745f 7765  ..    def set_we
-00009aa0: 6967 6874 7328 7365 6c66 2c20 7765 6967  ights(self, weig
-00009ab0: 6874 7329 3a0d 0a20 2020 2020 2020 2070  hts):..        p
-00009ac0: 6172 616d 7320 3d20 7365 6c66 2e77 6569  arams = self.wei
-00009ad0: 6768 7473 0d0a 2020 2020 2020 2020 6966  ghts..        if
-00009ae0: 206e 6f74 2070 6172 616d 733a 0d0a 2020   not params:..  
-00009af0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009b00: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
-00009b10: 5f76 616c 7565 5f74 7570 6c65 7320 3d20  _value_tuples = 
-00009b20: 5b5d 0d0a 2020 2020 2020 2020 7061 7261  []..        para
-00009b30: 6d5f 7661 6c75 6573 203d 205b 772e 6461  m_values = [w.da
-00009b40: 7461 2066 6f72 2077 2069 6e20 7061 7261  ta for w in para
-00009b50: 6d73 5d0d 0a20 2020 2020 2020 2066 6f72  ms]..        for
-00009b60: 2070 762c 2070 2c20 7720 696e 207a 6970   pv, p, w in zip
-00009b70: 2870 6172 616d 5f76 616c 7565 732c 2070  (param_values, p
-00009b80: 6172 616d 732c 2077 6569 6768 7473 293a  arams, weights):
-00009b90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00009ba0: 2070 762e 7368 6170 6520 213d 2077 2e73   pv.shape != w.s
-00009bb0: 6861 7065 3a0d 0a20 2020 2020 2020 2020  hape:..         
-00009bc0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00009bd0: 7565 4572 726f 7228 274c 6179 6572 2077  ueError('Layer w
-00009be0: 6569 6768 7420 7368 6170 6520 2720 2b20  eight shape ' + 
-00009bf0: 7374 7228 7076 2e73 6861 7065 2920 2b20  str(pv.shape) + 
-00009c00: 2720 6e6f 7420 636f 6d70 6174 6962 6c65  ' not compatible
-00009c10: 2077 6974 6820 270d 0a20 2020 2020 2020   with '..       
+00008680: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
+00008690: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000086a0: 6f72 2822 6d6f 6475 6c65 206e 616d 6520  or("module name 
+000086b0: 7368 6f75 6c64 2062 6520 6120 7374 7269  should be a stri
+000086c0: 6e67 2e20 476f 7420 7b7d 222e 666f 726d  ng. Got {}".form
+000086d0: 6174 2874 6f72 6368 2e74 7970 656e 616d  at(torch.typenam
+000086e0: 6528 6e61 6d65 2929 290d 0a20 2020 2020  e(name)))..     
+000086f0: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
+00008700: 7365 6c66 2c20 6e61 6d65 2920 616e 6420  self, name) and 
+00008710: 6e61 6d65 206e 6f74 2069 6e20 7365 6c66  name not in self
+00008720: 2e5f 6d6f 6475 6c65 733a 0d0a 2020 2020  ._modules:..    
+00008730: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
+00008740: 7945 7272 6f72 2822 6174 7472 6962 7574  yError("attribut
+00008750: 6520 277b 7d27 2061 6c72 6561 6479 2065  e '{}' already e
+00008760: 7869 7374 7322 2e66 6f72 6d61 7428 6e61  xists".format(na
+00008770: 6d65 2929 0d0a 2020 2020 2020 2020 656c  me))..        el
+00008780: 6966 2027 2e27 2069 6e20 6e61 6d65 3a0d  if '.' in name:.
+00008790: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
+000087a0: 616d 653d 6e61 6d65 2e72 6570 6c61 6365  ame=name.replace
+000087b0: 2827 2e27 2c27 5f27 290d 0a20 2020 2020  ('.','_')..     
+000087c0: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
+000087d0: 4572 726f 7228 226d 6f64 756c 6520 6e61  Error("module na
+000087e0: 6d65 2063 616e 2774 2063 6f6e 7461 696e  me can't contain
+000087f0: 205c 222e 5c22 2229 0d0a 2020 2020 2020   \".\"")..      
+00008800: 2020 656c 6966 206e 616d 6520 3d3d 2027    elif name == '
+00008810: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00008820: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
+00008830: 6d6f 6475 6c65 206e 616d 6520 6361 6e27  module name can'
+00008840: 7420 6265 2065 6d70 7479 2073 7472 696e  t be empty strin
+00008850: 6720 5c22 5c22 2229 0d0a 0d0a 2020 2020  g \"\"")....    
+00008860: 2020 2020 7365 6c66 2e5f 6d6f 6475 6c65      self._module
+00008870: 735b 6e61 6d65 5d20 3d20 6d6f 6475 6c65  s[name] = module
+00008880: 0d0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
+00008890: 6f64 6573 203d 204f 7264 6572 6564 4469  odes = OrderedDi
+000088a0: 6374 285b 286d 6f64 2e75 7569 642c 206d  ct([(mod.uuid, m
+000088b0: 6f64 2920 666f 7220 6d6f 6420 696e 206c  od) for mod in l
+000088c0: 6973 7428 7365 6c66 2e6d 6f64 756c 6573  ist(self.modules
+000088d0: 2829 2920 6966 2069 7369 6e73 7461 6e63  ()) if isinstanc
+000088e0: 6528 6d6f 642c 204c 6179 6572 295d 290d  e(mod, Layer)]).
+000088f0: 0a0d 0a20 2020 2020 2020 2069 6620 6973  ...        if is
+00008900: 696e 7374 616e 6365 286d 6f64 756c 652c  instance(module,
+00008910: 204c 6179 6572 293a 0d0a 2020 2020 2020   Layer):..      
+00008920: 2020 2020 2020 666f 7220 6d6f 6420 696e        for mod in
+00008930: 206d 6f64 756c 652e 6d6f 6475 6c65 7328   module.modules(
+00008940: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00008950: 2020 2020 6d6f 642e 6e6f 6465 7320 3d20      mod.nodes = 
+00008960: 7365 6c66 2e6e 6f64 6573 0d0a 2020 2020  self.nodes..    
+00008970: 2020 2020 2020 2020 2020 2020 6d6f 642e              mod.
+00008980: 6973 5f72 6f6f 7420 3d20 4661 6c73 650d  is_root = False.
+00008990: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
+000089a0: 2020 2020 2072 6573 6574 5f6e 616d 6528       reset_name(
+000089b0: 6d6f 642c 2073 656c 662e 5f75 6964 5f70  mod, self._uid_p
+000089c0: 7265 6669 7873 290d 0a20 2020 2020 2020  refixs)..       
+000089d0: 2020 2020 2020 2020 206d 6f64 2e72 656c           mod.rel
+000089e0: 6174 6976 655f 6e61 6d65 203d 206e 616d  ative_name = nam
+000089f0: 6520 6966 206d 6f64 2e72 656c 6174 6976  e if mod.relativ
+00008a00: 655f 6e61 6d65 203d 3d20 2727 2065 6c73  e_name == '' els
+00008a10: 6520 6e61 6d65 202b 2027 2e27 202b 206d  e name + '.' + m
+00008a20: 6f64 2e72 656c 6174 6976 655f 6e61 6d65  od.relative_name
+00008a30: 0d0a 0d0a 2020 2020 6465 6620 6164 6428  ....    def add(
+00008a40: 7365 6c66 2c20 6d6f 6475 6c65 293a 0d0a  self, module):..
+00008a50: 2020 2020 2020 2020 2222 2253 696d 706c          """Simpl
+00008a60: 6966 6965 6420 6164 645f 6d6f 6475 6c65  ified add_module
+00008a70: 0d0a 0d0a 2020 2020 2020 2020 5573 6520  ....        Use 
+00008a80: 7468 6520 636f 756e 7420 6f66 2063 6869  the count of chi
+00008a90: 6c64 206d 6f64 756c 6573 2061 7320 7468  ld modules as th
+00008aa0: 6520 6465 6661 756c 7420 6e61 6d65 2e0d  e default name..
+00008ab0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00008ac0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00008ad0: 6475 6c65 2028 4d6f 6475 6c65 293a 2063  dule (Module): c
+00008ae0: 6869 6c64 206d 6f64 756c 6520 746f 2062  hild module to b
+00008af0: 6520 6164 6465 6420 746f 2074 6865 206d  e added to the m
+00008b00: 6f64 756c 652e 0d0a 0d0a 2020 2020 2020  odule.....      
+00008b10: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+00008b20: 6620 6d6f 6475 6c65 2069 7320 4e6f 6e65  f module is None
+00008b30: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00008b40: 6169 7365 204b 6579 4572 726f 7228 226d  aise KeyError("m
+00008b50: 6f64 756c 6520 2063 616e 2774 2062 6520  odule  can't be 
+00008b60: 4e6f 6e65 2229 0d0a 2020 2020 2020 2020  None")..        
+00008b70: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00008b80: 6d6f 6475 6c65 2c20 4c61 7965 7229 3a0d  module, Layer):.
+00008b90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008ba0: 662e 6164 645f 6d6f 6475 6c65 2873 7472  f.add_module(str
+00008bb0: 286c 656e 2873 656c 662e 5f6d 6f64 756c  (len(self._modul
+00008bc0: 6573 2929 2c0d 0a20 2020 2020 2020 2020  es)),..         
+00008bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008be0: 2020 206d 6f64 756c 6529 2020 2320 7365     module)  # se
+00008bf0: 6c66 2e6e 6f64 6573 203d 206e 6f64 6573  lf.nodes = nodes
+00008c00: 2020 2320 666f 7220 6d6f 6420 696e 2073    # for mod in s
+00008c10: 656c 662e 6d6f 6475 6c65 7328 293a 2020  elf.modules():  
+00008c20: 2320 2020 2020 6d6f 642e 6e6f 6465 7320  #     mod.nodes 
+00008c30: 3d20 6e6f 6465 730d 0a0d 0a20 2020 2020  = nodes....     
+00008c40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00008c50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00008c60: 6545 7272 6f72 2827 4e6f 7420 7661 6c69  eError('Not vali
+00008c70: 6420 6d6f 6475 6c65 2729 0d0a 0d0a 2020  d module')....  
+00008c80: 2020 6465 6620 6275 696c 6428 7365 6c66    def build(self
+00008c90: 2c20 2a69 6e70 7574 5f73 6861 7065 3a20  , *input_shape: 
+00008ca0: 5465 6e73 6f72 5368 6170 6529 3a0d 0a20  TensorShape):.. 
+00008cb0: 2020 2020 2020 2022 2222 2044 6f20 7468         """ Do th
+00008cc0: 6520 7368 6170 6520 696e 6665 7265 6e63  e shape inferenc
+00008cd0: 6520 616e 6420 696e 6974 6961 6c69 7a65  e and initialize
+00008ce0: 2077 6569 6768 7473 2061 6e64 2062 6961   weights and bia
+00008cf0: 732e 0d0a 0d0a 2020 2020 2020 2020 6062  s.....        `b
+00008d00: 7569 6c64 2720 6973 2061 206b 6579 206d  uild' is a key m
+00008d10: 6574 686f 6420 696e 2074 7269 6465 6e74  ethod in trident
+00008d20: 2c20 796f 7520 6361 6e20 7573 6520 2070  , you can use  p
+00008d30: 726f 7065 7274 7920 6062 7569 6c74 2720  roperty `built' 
+00008d40: 746f 2063 6865 636b 2077 6865 7468 6572  to check whether
+00008d50: 2074 6865 206c 6179 6572 2064 6f20 7468   the layer do th
+00008d60: 6520 6275 696c 6420 7072 6f63 6573 732e  e build process.
+00008d70: 0d0a 2020 2020 2020 2020 496e 2027 6275  ..        In 'bu
+00008d80: 696c 6427 202c 2077 6520 6e65 6564 2074  ild' , we need t
+00008d90: 6f20 7075 7420 616c 6c20 7468 6520 6c6f  o put all the lo
+00008da0: 6769 6373 2061 626f 7574 2020 686f 7720  gics about  how 
+00008db0: 746f 2063 6f6d 6669 726d 2074 6865 2073  to comfirm the s
+00008dc0: 6861 7065 206f 6620 6f75 7470 7574 732c  hape of outputs,
+00008dd0: 2077 6569 6768 7473 2061 6e64 2062 6961   weights and bia
+00008de0: 7320 6163 636f 7264 696e 6720 746f 2074  s according to t
+00008df0: 6865 2063 6f6d 696e 6720 696e 7075 7420  he coming input 
+00008e00: 7465 6e73 6f72 2e0d 0a0d 0a20 2020 2020  tensor.....     
+00008e10: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+00008e20: 2020 2020 2020 696e 7075 745f 7368 6170        input_shap
+00008e30: 6520 2854 656e 736f 7253 6861 7065 293a  e (TensorShape):
+00008e40: 2020 7468 6520 7368 6170 6520 7265 7072    the shape repr
+00008e50: 6573 656e 7461 7469 6f6e 2065 7863 6c75  esentation exclu
+00008e60: 6465 2074 6865 2062 6174 6368 2061 7869  de the batch axi
+00008e70: 732e 0d0a 0d0a 2020 2020 2020 2020 2222  s.....        ""
+00008e80: 220d 0a20 2020 2020 2020 2070 6173 730d  "..        pass.
+00008e90: 0a0d 0a20 2020 2064 6566 2072 6562 7569  ...    def rebui
+00008ea0: 6c64 2873 656c 662c 2069 6e70 7574 5f73  ld(self, input_s
+00008eb0: 6861 7065 293a 0d0a 2020 2020 2020 2020  hape):..        
+00008ec0: 2222 2220 446f 2074 6865 2073 6861 7065  """ Do the shape
+00008ed0: 2069 6e66 6572 656e 6365 2061 6e64 2069   inference and i
+00008ee0: 6e69 7469 616c 697a 6520 7765 6967 6874  nitialize weight
+00008ef0: 7320 616e 6420 6269 6173 2e0d 0a0d 0a20  s and bias..... 
+00008f00: 2020 2020 2020 2060 6275 696c 6427 2069         `build' i
+00008f10: 7320 6120 6b65 7920 6d65 7468 6f64 2069  s a key method i
+00008f20: 6e20 7472 6964 656e 742c 2079 6f75 2063  n trident, you c
+00008f30: 616e 2075 7365 2020 7072 6f70 6572 7479  an use  property
+00008f40: 2060 6275 696c 7427 2074 6f20 6368 6563   `built' to chec
+00008f50: 6b20 7768 6574 6865 7220 7468 6520 6c61  k whether the la
+00008f60: 7965 7220 646f 2074 6865 2062 7569 6c64  yer do the build
+00008f70: 2070 726f 6365 7373 2e0d 0a20 2020 2020   process...     
+00008f80: 2020 2049 6e20 2762 7569 6c64 2720 2c20     In 'build' , 
+00008f90: 7765 206e 6565 6420 746f 2070 7574 2061  we need to put a
+00008fa0: 6c6c 2074 6865 206c 6f67 6963 7320 6162  ll the logics ab
+00008fb0: 6f75 7420 2068 6f77 2074 6f20 636f 6d66  out  how to comf
+00008fc0: 6972 6d20 7468 6520 7368 6170 6520 6f66  irm the shape of
+00008fd0: 206f 7574 7075 7473 2c20 7765 6967 6874   outputs, weight
+00008fe0: 7320 616e 6420 6269 6173 2061 6363 6f72  s and bias accor
+00008ff0: 6469 6e67 2074 6f20 7468 6520 636f 6d69  ding to the comi
+00009000: 6e67 2069 6e70 7574 2074 656e 736f 722e  ng input tensor.
+00009010: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
+00009020: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00009030: 6e70 7574 5f73 6861 7065 2028 7465 6e73  nput_shape (tens
+00009040: 6f72 293a 2020 7468 6520 7368 6170 6520  or):  the shape 
+00009050: 7265 7072 6573 656e 7461 7469 6f6e 2065  representation e
+00009060: 7863 6c75 6465 2074 6865 2062 6174 6368  xclude the batch
+00009070: 2061 7869 732e 0d0a 0d0a 2020 2020 2020   axis.....      
+00009080: 2020 2222 220d 0a20 2020 2020 2020 2070    """..        p
+00009090: 7269 6e74 280d 0a20 2020 2020 2020 2020  rint(..         
+000090a0: 2020 2027 596f 7572 206d 6f64 656c 2077     'Your model w
+000090b0: 696c 6c20 7374 6172 7420 746f 2072 6562  ill start to reb
+000090c0: 7569 6c64 2c20 6974 2077 696c 6c20 6361  uild, it will ca
+000090d0: 7573 6520 6c6f 7374 2061 6c6c 2065 7869  use lost all exi
+000090e0: 7374 696e 6720 7472 6169 6e61 626c 6520  sting trainable 
+000090f0: 7061 7261 6d65 7465 7273 2c20 7769 6c6c  parameters, will
+00009100: 2079 6f75 2077 616e 7420 746f 2072 6562   you want to reb
+00009110: 7569 6c64 2069 743f 2729 0d0a 2020 2020  uild it?')..    
+00009120: 2020 2020 616e 7320 3d20 696e 7075 7428      ans = input(
+00009130: 2728 592f 4e29 203c 3c20 2729 2e6c 6f77  '(Y/N) << ').low
+00009140: 6572 2829 0d0a 2020 2020 2020 2020 6966  er()..        if
+00009150: 2061 6e73 2069 6e20 5b27 7965 7327 2c20   ans in ['yes', 
+00009160: 2779 275d 3a0d 0a20 2020 2020 2020 2020  'y']:..         
+00009170: 2020 2066 6f72 206e 616d 652c 206d 6f64     for name, mod
+00009180: 756c 6520 696e 2073 656c 662e 6e61 6d65  ule in self.name
+00009190: 645f 6d6f 6475 6c65 7328 293a 0d0a 2020  d_modules():..  
+000091a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000091b0: 206c 656e 286d 6f64 756c 652e 5f70 6172   len(module._par
+000091c0: 616d 6574 6572 7329 203e 2030 206f 7220  ameters) > 0 or 
+000091d0: 6d6f 6475 6c65 2e74 7261 696e 6162 6c65  module.trainable
+000091e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000091f0: 2020 2020 2020 206d 6f64 756c 652e 5f69         module._i
+00009200: 6e70 7574 5f73 6861 7065 203d 204e 6f6e  nput_shape = Non
+00009210: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00009220: 2020 2020 2020 206d 6f64 756c 652e 5f6f         module._o
+00009230: 7574 7075 745f 7368 6170 6520 3d20 4e6f  utput_shape = No
+00009240: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00009250: 2020 2020 2020 2020 6d6f 6475 6c65 2e5f          module._
+00009260: 6275 696c 7420 3d20 4661 6c73 650d 0a20  built = False.. 
+00009270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009280: 2020 2066 6f72 206b 2069 6e20 6d6f 6475     for k in modu
+00009290: 6c65 2e5f 7061 7261 6d65 7465 7273 2e6b  le._parameters.k
+000092a0: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
+000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092c0: 6d6f 6475 6c65 2e5f 7061 7261 6d65 7465  module._paramete
+000092d0: 7273 5b6b 5d20 3d20 4e6f 6e65 0d0a 0d0a  rs[k] = None....
+000092e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092f0: 6966 206c 656e 286d 6f64 756c 652e 5f66  if len(module._f
+00009300: 6f72 7761 7264 5f70 7265 5f68 6f6f 6b73  orward_pre_hooks
+00009310: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
+00009320: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+00009330: 6c65 2e5f 666f 7277 6172 645f 7072 655f  le._forward_pre_
+00009340: 686f 6f6b 7320 3d20 4f72 6465 7265 6444  hooks = OrderedD
+00009350: 6963 7428 290d 0a0d 0a20 2020 2020 2020  ict()....       
+00009360: 2020 2020 2064 756d 6d61 795f 696e 7075       dummay_inpu
+00009370: 7420 3d20 746f 5f74 656e 736f 7228 6e70  t = to_tensor(np
+00009380: 2e72 616e 646f 6d2e 7374 616e 6461 7264  .random.standard
+00009390: 5f6e 6f72 6d61 6c28 2832 2c29 202b 2069  _normal((2,) + i
+000093a0: 6e70 7574 5f73 6861 7065 292e 6173 7479  nput_shape).asty
+000093b0: 7065 286e 702e 666c 6f61 7433 3229 292e  pe(np.float32)).
+000093c0: 746f 2867 6574 5f64 6576 6963 6528 2929  to(get_device())
+000093d0: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
+000093e0: 7420 3d20 7365 6c66 2e66 6f72 7761 7264  t = self.forward
+000093f0: 2864 756d 6d61 795f 696e 7075 7429 0d0a  (dummay_input)..
+00009400: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+00009410: 0a20 2020 2064 6566 2074 7261 696e 6162  .    def trainab
+00009420: 6c65 5f77 6569 6768 7473 2873 656c 6629  le_weights(self)
+00009430: 202d 3e20 4c69 7374 5b6e 6e2e 5061 7261   -> List[nn.Para
+00009440: 6d65 7465 725d 3a0d 0a20 2020 2020 2020  meter]:..       
+00009450: 2022 2222 5468 6520 6c69 7374 206f 6620   """The list of 
+00009460: 7472 6169 6e61 626c 6520 7661 7269 6162  trainable variab
+00009470: 6c65 7320 2870 6172 616d 6574 6572 7329  les (parameters)
+00009480: 206f 6620 7468 6520 6d6f 6475 6c65 2e0d   of the module..
+00009490: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+000094a0: 6572 7320 6f66 2074 6869 7320 6d6f 6475  ers of this modu
+000094b0: 6c65 2061 6e64 2061 6c6c 2069 7473 2073  le and all its s
+000094c0: 7562 6d6f 6475 6c65 7320 6172 6520 696e  ubmodules are in
+000094d0: 636c 7564 6564 2e0d 0a0d 0a20 2020 2020  cluded.....     
+000094e0: 2020 204e 6f74 6573 3a0d 0a20 2020 2020     Notes:..     
+000094f0: 2020 2020 2020 2054 6865 206c 6973 7420         The list 
+00009500: 7265 7475 726e 6564 206d 6179 2063 6f6e  returned may con
+00009510: 7461 696e 2064 7570 6c69 6361 7465 2070  tain duplicate p
+00009520: 6172 616d 6574 6572 7320 2865 2e67 2e20  arameters (e.g. 
+00009530: 6f75 7470 7574 0d0a 2020 2020 2020 2020  output..        
+00009540: 2020 2020 6c61 7965 7220 7368 6172 6573      layer shares
+00009550: 2070 6172 616d 6574 6572 7320 7769 7468   parameters with
+00009560: 2065 6d62 6564 6469 6e67 7329 2e20 466f   embeddings). Fo
+00009570: 7220 6d6f 7374 2075 7361 6765 732c 2069  r most usages, i
+00009580: 7427 7320 6e6f 740d 0a20 2020 2020 2020  t's not..       
+00009590: 2020 2020 206e 6563 6573 7361 7279 2074       necessary t
+000095a0: 6f20 656e 7375 7265 2075 6e69 7175 656e  o ensure uniquen
+000095b0: 6573 732e 0d0a 0d0a 2020 2020 2020 2020  ess.....        
+000095c0: 2222 220d 0a20 2020 2020 2020 2070 6172  """..        par
+000095d0: 6173 203d 205b 5d0d 0a20 2020 2020 2020  as = []..       
+000095e0: 2066 6f72 2070 2069 6e20 7365 6c66 2e70   for p in self.p
+000095f0: 6172 616d 6574 6572 7328 293a 0d0a 2020  arameters():..  
+00009600: 2020 2020 2020 2020 2020 6966 2070 2e72            if p.r
+00009610: 6571 7569 7265 735f 6772 6164 3a0d 0a20  equires_grad:.. 
+00009620: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00009630: 6172 6173 2e61 7070 656e 6428 7029 0d0a  aras.append(p)..
+00009640: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00009650: 2070 6172 6173 0d0a 0d0a 2020 2020 4070   paras....    @p
+00009660: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+00009670: 206e 6f6e 5f74 7261 696e 6162 6c65 5f77   non_trainable_w
+00009680: 6569 6768 7473 2873 656c 6629 202d 3e20  eights(self) -> 
+00009690: 4c69 7374 5b6e 6e2e 5061 7261 6d65 7465  List[nn.Paramete
+000096a0: 725d 3a0d 0a20 2020 2020 2020 2022 2222  r]:..        """
+000096b0: 0d0a 2020 2020 2020 2020 5468 6520 6c69  ..        The li
+000096c0: 7374 206f 6620 6e6f 6e2d 7472 6169 6e61  st of non-traina
+000096d0: 626c 6520 7661 7269 6162 6c65 7320 2870  ble variables (p
+000096e0: 6172 616d 6574 6572 7329 206f 6620 7468  arameters) of th
+000096f0: 6520 6d6f 6475 6c65 2e50 6172 616d 6574  e module.Paramet
+00009700: 6572 7320 6f66 2074 6869 7320 6d6f 6475  ers of this modu
+00009710: 6c65 2061 6e64 2061 6c6c 2069 7473 2073  le and all its s
+00009720: 7562 6d6f 6475 6c65 7320 6172 6520 696e  ubmodules are in
+00009730: 636c 7564 6564 2e0d 0a0d 0a20 2020 2020  cluded.....     
+00009740: 2020 204e 6f74 6573 3a0d 0a20 2020 2020     Notes:..     
+00009750: 2020 2020 2020 2054 6865 206c 6973 7420         The list 
+00009760: 7265 7475 726e 6564 206d 6179 2063 6f6e  returned may con
+00009770: 7461 696e 2064 7570 6c69 6361 7465 2070  tain duplicate p
+00009780: 6172 616d 6574 6572 7320 2865 2e67 2e20  arameters (e.g. 
+00009790: 6f75 7470 7574 0d0a 2020 2020 2020 2020  output..        
+000097a0: 2020 2020 6c61 7965 7220 7368 6172 6573      layer shares
+000097b0: 2070 6172 616d 6574 6572 7320 7769 7468   parameters with
+000097c0: 2065 6d62 6564 6469 6e67 7329 2e20 466f   embeddings). Fo
+000097d0: 7220 6d6f 7374 2075 7361 6765 732c 2069  r most usages, i
+000097e0: 7427 7320 6e6f 740d 0a20 2020 2020 2020  t's not..       
+000097f0: 2020 2020 206e 6563 6573 7361 7279 2074       necessary t
+00009800: 6f20 656e 7375 7265 2075 6e69 7175 656e  o ensure uniquen
+00009810: 6573 732e 0d0a 0d0a 2020 2020 2020 2020  ess.....        
+00009820: 2222 220d 0a20 2020 2020 2020 2070 6172  """..        par
+00009830: 6173 203d 205b 5d0d 0a20 2020 2020 2020  as = []..       
+00009840: 2066 6f72 2070 2069 6e20 7365 6c66 2e70   for p in self.p
+00009850: 6172 616d 6574 6572 7328 293a 0d0a 2020  arameters():..  
+00009860: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00009870: 2070 2e72 6571 7569 7265 735f 6772 6164   p.requires_grad
+00009880: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009890: 2020 2070 6172 6173 2e61 7070 656e 6428     paras.append(
+000098a0: 7029 0d0a 0d0a 2020 2020 2020 2020 7265  p)....        re
+000098b0: 7475 726e 2070 6172 6173 0d0a 0d0a 2020  turn paras....  
+000098c0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+000098d0: 2064 6566 2077 6569 6768 7473 2873 656c   def weights(sel
+000098e0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+000098f0: 5468 6520 6c69 7374 206f 6620 616c 6c20  The list of all 
+00009900: 7661 7269 6162 6c65 7320 2870 6172 616d  variables (param
+00009910: 6574 6572 7329 206f 6620 7468 6520 6d6f  eters) of the mo
+00009920: 6475 6c65 2e50 6172 616d 6574 6572 7320  dule.Parameters 
+00009930: 6f66 2074 6869 7320 6d6f 6475 6c65 2061  of this module a
+00009940: 6e64 2061 6c6c 2069 7473 2073 7562 6d6f  nd all its submo
+00009950: 6475 6c65 7320 6172 6520 696e 636c 7564  dules are includ
+00009960: 6564 2e22 2222 0d0a 2020 2020 2020 2020  ed."""..        
+00009970: 7265 7475 726e 206c 6973 7428 7365 6c66  return list(self
+00009980: 2e70 6172 616d 6574 6572 7328 2929 0d0a  .parameters())..
+00009990: 0d0a 2020 2020 6465 6620 6765 745f 7765  ..    def get_we
+000099a0: 6967 6874 7328 7365 6c66 293a 0d0a 2020  ights(self):..  
+000099b0: 2020 2020 2020 2222 2254 6865 206c 6973        """The lis
+000099c0: 7420 6f66 2061 6c6c 206e 756d 7079 2076  t of all numpy v
+000099d0: 6172 6961 626c 6573 206e 6461 7272 6179  ariables ndarray
+000099e0: 2065 7175 6976 656c 656e 7420 6f66 2074   equivelent of t
+000099f0: 6865 206d 6f64 756c 652e 5061 7261 6d65  he module.Parame
+00009a00: 7465 7273 206f 6620 7468 6973 206d 6f64  ters of this mod
+00009a10: 756c 6520 616e 6420 616c 6c20 6974 7320  ule and all its 
+00009a20: 7375 626d 6f64 756c 6573 2061 7265 2069  submodules are i
+00009a30: 6e63 6c75 6465 642e 2222 220d 0a20 2020  ncluded."""..   
+00009a40: 2020 2020 2072 6574 7572 6e20 5b70 2e6e       return [p.n
+00009a50: 756d 7079 2829 2066 6f72 2070 2069 6e20  umpy() for p in 
+00009a60: 6c69 7374 2873 656c 662e 7061 7261 6d65  list(self.parame
+00009a70: 7465 7273 2829 295d 0d0a 0d0a 2020 2020  ters())]....    
+00009a80: 6465 6620 7365 745f 7765 6967 6874 7328  def set_weights(
+00009a90: 7365 6c66 2c20 7765 6967 6874 7329 3a0d  self, weights):.
+00009aa0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+00009ab0: 3d20 7365 6c66 2e77 6569 6768 7473 0d0a  = self.weights..
+00009ac0: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+00009ad0: 6172 616d 733a 0d0a 2020 2020 2020 2020  arams:..        
+00009ae0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00009af0: 2020 2020 7765 6967 6874 5f76 616c 7565      weight_value
+00009b00: 5f74 7570 6c65 7320 3d20 5b5d 0d0a 2020  _tuples = []..  
+00009b10: 2020 2020 2020 7061 7261 6d5f 7661 6c75        param_valu
+00009b20: 6573 203d 205b 772e 6461 7461 2066 6f72  es = [w.data for
+00009b30: 2077 2069 6e20 7061 7261 6d73 5d0d 0a20   w in params].. 
+00009b40: 2020 2020 2020 2066 6f72 2070 762c 2070         for pv, p
+00009b50: 2c20 7720 696e 207a 6970 2870 6172 616d  , w in zip(param
+00009b60: 5f76 616c 7565 732c 2070 6172 616d 732c  _values, params,
+00009b70: 2077 6569 6768 7473 293a 0d0a 2020 2020   weights):..    
+00009b80: 2020 2020 2020 2020 6966 2070 762e 7368          if pv.sh
+00009b90: 6170 6520 213d 2077 2e73 6861 7065 3a0d  ape != w.shape:.
+00009ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009bb0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00009bc0: 7228 274c 6179 6572 2077 6569 6768 7420  r('Layer weight 
+00009bd0: 7368 6170 6520 2720 2b20 7374 7228 7076  shape ' + str(pv
+00009be0: 2e73 6861 7065 2920 2b20 2720 6e6f 7420  .shape) + ' not 
+00009bf0: 636f 6d70 6174 6962 6c65 2077 6974 6820  compatible with 
+00009c00: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 2020 2770 726f 7669 6465 6420 7765 6967    'provided weig
-00009c70: 6874 2073 6861 7065 2027 202b 2073 7472  ht shape ' + str
-00009c80: 2877 2e73 6861 7065 2929 0d0a 2020 2020  (w.shape))..    
-00009c90: 2020 2020 2020 2020 7765 6967 6874 5f76          weight_v
-00009ca0: 616c 7565 5f74 7570 6c65 732e 6170 7065  alue_tuples.appe
-00009cb0: 6e64 2828 702c 2077 2929 0d0a 2020 2020  nd((p, w))..    
-00009cc0: 2020 2020 666f 7220 702c 2077 2069 6e20      for p, w in 
-00009cd0: 7765 6967 6874 5f76 616c 7565 5f74 7570  weight_value_tup
-00009ce0: 6c65 733a 0d0a 2020 2020 2020 2020 2020  les:..          
-00009cf0: 2020 702e 6461 7461 203d 2077 2e64 6174    p.data = w.dat
-00009d00: 610d 0a0d 0a20 2020 2040 7072 6f70 6572  a....    @proper
-00009d10: 7479 0d0a 2020 2020 6465 6620 7472 6169  ty..    def trai
-00009d20: 6e61 626c 6528 7365 6c66 293a 0d0a 2020  nable(self):..  
-00009d30: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-00009d40: 662e 5f70 6172 616d 6574 6572 7329 203d  f._parameters) =
-00009d50: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00009d60: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00009d70: 0d0a 2020 2020 2020 2020 656c 6966 206c  ..        elif l
-00009d80: 656e 2873 656c 662e 5f70 6172 616d 6574  en(self._paramet
-00009d90: 6572 7329 203e 2030 3a0d 0a20 2020 2020  ers) > 0:..     
-00009da0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00009db0: 696e 2073 656c 662e 5f70 6172 616d 6574  in self._paramet
-00009dc0: 6572 732e 6974 656d 7328 293a 0d0a 2020  ers.items():..  
-00009dd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009de0: 2076 2069 7320 6e6f 7420 4e6f 6e65 2061   v is not None a
-00009df0: 6e64 2076 2e72 6571 7569 7265 735f 6772  nd v.requires_gr
-00009e00: 6164 203d 3d20 4661 6c73 653a 0d0a 2020  ad == False:..  
-00009e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e20: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e40: 656c 6966 2076 2069 7320 4e6f 6e65 3a0d  elif v is None:.
-00009e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e60: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
-00009e70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00009e80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009e90: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
-00009ea0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00009eb0: 7275 650d 0a0d 0a20 2020 2040 7472 6169  rue....    @trai
-00009ec0: 6e61 626c 652e 7365 7474 6572 0d0a 2020  nable.setter..  
-00009ed0: 2020 6465 6620 7472 6169 6e61 626c 6528    def trainable(
-00009ee0: 7365 6c66 2c20 7661 6c75 653a 2062 6f6f  self, value: boo
-00009ef0: 6c29 3a0d 0a20 2020 2020 2020 206e 203d  l):..        n =
-00009f00: 2030 0d0a 2020 2020 2020 2020 666f 7220   0..        for 
-00009f10: 6e61 6d65 2c20 7061 7261 2069 6e20 7365  name, para in se
-00009f20: 6c66 2e6e 616d 6564 5f70 6172 616d 6574  lf.named_paramet
-00009f30: 6572 7328 293a 0d0a 2020 2020 2020 2020  ers():..        
-00009f40: 2020 2020 6966 2070 6172 612e 7265 7175      if para.requ
-00009f50: 6972 6573 5f67 7261 6420 213d 2076 616c  ires_grad != val
-00009f60: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
-00009f70: 2020 2020 2070 6172 612e 7265 7175 6972       para.requir
-00009f80: 6573 5f67 7261 6420 3d20 7661 6c75 650d  es_grad = value.
-00009f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009fa0: 206e 202b 3d20 6e70 2e70 726f 6428 6c69   n += np.prod(li
-00009fb0: 7374 2870 6172 612e 7369 7a65 2829 2929  st(para.size()))
-00009fc0: 0d0a 2020 2020 2020 2020 6966 2076 616c  ..        if val
-00009fd0: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
-00009fe0: 2070 7269 6e74 2827 7b30 7d20 7061 7261   print('{0} para
-00009ff0: 6d65 7465 7273 2068 6176 6520 7365 7420  meters have set 
-0000a000: 7472 6169 6e61 626c 6527 2e66 6f72 6d61  trainable'.forma
-0000a010: 7428 6e29 290d 0a20 2020 2020 2020 2065  t(n))..        e
-0000a020: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000a030: 2020 7072 696e 7428 277b 307d 2070 6172    print('{0} par
-0000a040: 616d 6574 6572 7320 6861 7665 2073 6574  ameters have set
-0000a050: 2075 6e74 7261 696e 6162 6c65 272e 666f   untrainable'.fo
-0000a060: 726d 6174 286e 2929 0d0a 0d0a 2020 2020  rmat(n))....    
-0000a070: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0000a080: 6566 2064 6576 6963 6528 7365 6c66 2920  ef device(self) 
-0000a090: 2d3e 2073 7472 3a0d 0a20 2020 2020 2020  -> str:..       
-0000a0a0: 205f 726f 6f74 203d 2073 656c 662e 6765   _root = self.ge
-0000a0b0: 745f 726f 6f74 2829 0d0a 2020 2020 2020  t_root()..      
-0000a0c0: 2020 6966 2073 656c 662e 6973 5f72 6f6f    if self.is_roo
-0000a0d0: 7420 6f72 205f 726f 6f74 2069 7320 4e6f  t or _root is No
-0000a0e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0000a0f0: 2069 6620 6c65 6e28 7365 6c66 2e77 6569   if len(self.wei
-0000a100: 6768 7473 2920 3d3d 2030 3a0d 0a20 2020  ghts) == 0:..   
-0000a110: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000a120: 7572 6e20 7365 6c66 2e66 6163 746f 7279  urn self.factory
-0000a130: 5f6b 7761 7267 735b 2764 6576 6963 6527  _kwargs['device'
-0000a140: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-0000a150: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000a160: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000a170: 662e 7765 6967 6874 735b 305d 2e64 6576  f.weights[0].dev
-0000a180: 6963 652e 7479 7065 0d0a 2020 2020 2020  ice.type..      
-0000a190: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0000a1a0: 2020 2020 2072 6574 7572 6e20 5f72 6f6f       return _roo
-0000a1b0: 742e 6465 7669 6365 0d0a 0d0a 2020 2020  t.device....    
-0000a1c0: 4064 6576 6963 652e 7365 7474 6572 0d0a  @device.setter..
-0000a1d0: 2020 2020 6465 6620 6465 7669 6365 2873      def device(s
-0000a1e0: 656c 662c 2076 616c 7565 3a20 7374 7229  elf, value: str)
-0000a1f0: 3a0d 0a20 2020 2020 2020 2069 6620 6973  :..        if is
-0000a200: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
-0000a210: 746f 7263 682e 6465 7669 6365 293a 0d0a  torch.device):..
-0000a220: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0000a230: 6520 3d20 7661 6c75 652e 7479 7065 0d0a  e = value.type..
-0000a240: 2020 2020 2020 2020 7365 6c66 2e66 6163          self.fac
-0000a250: 746f 7279 5f6b 7761 7267 735b 2764 6576  tory_kwargs['dev
-0000a260: 6963 6527 5d20 3d20 7661 6c75 650d 0a20  ice'] = value.. 
-0000a270: 2020 2020 2020 2073 656c 662e 746f 2876         self.to(v
-0000a280: 616c 7565 290d 0a0d 0a20 2020 2064 6566  alue)....    def
-0000a290: 2063 7564 6128 7365 6c66 2c20 6465 7669   cuda(self, devi
-0000a2a0: 6365 3a20 4f70 7469 6f6e 616c 5b55 6e69  ce: Optional[Uni
-0000a2b0: 6f6e 5b69 6e74 2c20 746f 7263 682e 6465  on[int, torch.de
-0000a2c0: 7669 6365 5d5d 203d 204e 6f6e 6529 3a0d  vice]] = None):.
-0000a2d0: 0a20 2020 2020 2020 2022 2222 4d6f 7665  .        """Move
-0000a2e0: 7320 616c 6c20 6d6f 6465 6c20 7061 7261  s all model para
-0000a2f0: 6d65 7465 7273 2061 6e64 2062 7566 6665  meters and buffe
-0000a300: 7273 2074 6f20 7468 6520 4750 552e 0d0a  rs to the GPU...
-0000a310: 0d0a 2020 2020 2020 2020 5468 6973 2061  ..        This a
-0000a320: 6c73 6f20 6d61 6b65 7320 6173 736f 6369  lso makes associ
-0000a330: 6174 6564 2070 6172 616d 6574 6572 7320  ated parameters 
-0000a340: 616e 6420 6275 6666 6572 7320 6469 6666  and buffers diff
-0000a350: 6572 656e 7420 6f62 6a65 6374 732e 2053  erent objects. S
-0000a360: 6f0d 0a20 2020 2020 2020 2069 7420 7368  o..        it sh
-0000a370: 6f75 6c64 2062 6520 6361 6c6c 6564 2062  ould be called b
-0000a380: 6566 6f72 6520 636f 6e73 7472 7563 7469  efore constructi
-0000a390: 6e67 206f 7074 696d 697a 6572 2069 6620  ng optimizer if 
-0000a3a0: 7468 6520 6d6f 6475 6c65 2077 696c 6c0d  the module will.
-0000a3b0: 0a20 2020 2020 2020 206c 6976 6520 6f6e  .        live on
-0000a3c0: 2047 5055 2077 6869 6c65 2062 6569 6e67   GPU while being
-0000a3d0: 206f 7074 696d 697a 6564 2e0d 0a0d 0a20   optimized..... 
-0000a3e0: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-0000a3f0: 2020 2020 2020 2020 2020 6465 7669 6365            device
-0000a400: 2028 696e 742c 206f 7074 696f 6e61 6c29   (int, optional)
-0000a410: 3a20 6966 2073 7065 6369 6669 6564 2c20  : if specified, 
-0000a420: 616c 6c20 7061 7261 6d65 7465 7273 2077  all parameters w
-0000a430: 696c 6c20 6265 0d0a 2020 2020 2020 2020  ill be..        
-0000a440: 2020 2020 2020 2020 636f 7069 6564 2074          copied t
-0000a450: 6f20 7468 6174 2064 6576 6963 650d 0a0d  o that device...
-0000a460: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0000a470: 3a0d 0a20 2020 2020 2020 2020 2020 204d  :..            M
-0000a480: 6f64 756c 653a 2073 656c 660d 0a20 2020  odule: self..   
-0000a490: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000a4a0: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
-0000a4b0: 7070 6c79 286c 616d 6264 6120 743a 2074  pply(lambda t: t
-0000a4c0: 2e63 7564 6128 6465 7669 6365 2929 0d0a  .cuda(device))..
-0000a4d0: 0d0a 2020 2020 6465 6620 7870 7528 7365  ..    def xpu(se
-0000a4e0: 6c66 2c20 6465 7669 6365 3a20 4f70 7469  lf, device: Opti
-0000a4f0: 6f6e 616c 5b55 6e69 6f6e 5b69 6e74 2c20  onal[Union[int, 
-0000a500: 746f 7263 682e 6465 7669 6365 5d5d 203d  torch.device]] =
-0000a510: 204e 6f6e 6529 3a0d 0a20 2020 2020 2020   None):..       
-0000a520: 2022 2222 4d6f 7665 7320 616c 6c20 6d6f   """Moves all mo
-0000a530: 6465 6c20 7061 7261 6d65 7465 7273 2061  del parameters a
-0000a540: 6e64 2062 7566 6665 7273 2074 6f20 7468  nd buffers to th
-0000a550: 6520 5850 552e 0d0a 0d0a 2020 2020 2020  e XPU.....      
-0000a560: 2020 5468 6973 2061 6c73 6f20 6d61 6b65    This also make
-0000a570: 7320 6173 736f 6369 6174 6564 2070 6172  s associated par
-0000a580: 616d 6574 6572 7320 616e 6420 6275 6666  ameters and buff
-0000a590: 6572 7320 6469 6666 6572 656e 7420 6f62  ers different ob
-0000a5a0: 6a65 6374 732e 2053 6f0d 0a20 2020 2020  jects. So..     
-0000a5b0: 2020 2069 7420 7368 6f75 6c64 2062 6520     it should be 
-0000a5c0: 6361 6c6c 6564 2062 6566 6f72 6520 636f  called before co
-0000a5d0: 6e73 7472 7563 7469 6e67 206f 7074 696d  nstructing optim
-0000a5e0: 697a 6572 2069 6620 7468 6520 6d6f 6475  izer if the modu
-0000a5f0: 6c65 2077 696c 6c0d 0a20 2020 2020 2020  le will..       
-0000a600: 206c 6976 6520 6f6e 2058 5055 2077 6869   live on XPU whi
-0000a610: 6c65 2062 6569 6e67 206f 7074 696d 697a  le being optimiz
-0000a620: 6564 2e0d 0a0d 0a20 2020 2020 2020 2041  ed.....        A
-0000a630: 7267 756d 656e 7473 3a0d 0a20 2020 2020  rguments:..     
-0000a640: 2020 2020 2020 2064 6576 6963 6520 2869         device (i
-0000a650: 6e74 2c20 6f70 7469 6f6e 616c 293a 2069  nt, optional): i
-0000a660: 6620 7370 6563 6966 6965 642c 2061 6c6c  f specified, all
-0000a670: 2070 6172 616d 6574 6572 7320 7769 6c6c   parameters will
-0000a680: 2062 650d 0a20 2020 2020 2020 2020 2020   be..           
-0000a690: 2020 2020 2063 6f70 6965 6420 746f 2074       copied to t
-0000a6a0: 6861 7420 6465 7669 6365 0d0a 0d0a 2020  hat device....  
-0000a6b0: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
-0000a6c0: 2020 2020 2020 2020 2020 2020 4d6f 6475              Modu
-0000a6d0: 6c65 3a20 7365 6c66 0d0a 2020 2020 2020  le: self..      
-0000a6e0: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-0000a6f0: 6620 6973 5f74 7075 5f61 7661 696c 6162  f is_tpu_availab
-0000a700: 6c65 2829 2061 6e64 2028 6465 7669 6365  le() and (device
-0000a710: 203d 3d20 2778 7075 2720 6f72 2064 6576   == 'xpu' or dev
-0000a720: 6963 6520 6973 204e 6f6e 6529 3a0d 0a20  ice is None):.. 
-0000a730: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
-0000a740: 7420 746f 7263 685f 786c 612e 636f 7265  t torch_xla.core
-0000a750: 2e78 6c61 5f6d 6f64 656c 2061 7320 786d  .xla_model as xm
-0000a760: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-0000a770: 7669 6365 203d 2078 6d2e 786c 615f 6465  vice = xm.xla_de
-0000a780: 7669 6365 2829 0d0a 2020 2020 2020 2020  vice()..        
-0000a790: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
-0000a7a0: 6c79 286c 616d 6264 6120 743a 2074 2e78  ly(lambda t: t.x
-0000a7b0: 7075 2864 6576 6963 6529 290d 0a0d 0a20  pu(device)).... 
-0000a7c0: 2020 2064 6566 2063 7075 2873 656c 6629     def cpu(self)
-0000a7d0: 3a0d 0a20 2020 2020 2020 2022 2222 4d6f  :..        """Mo
-0000a7e0: 7665 7320 616c 6c20 6d6f 6465 6c20 7061  ves all model pa
-0000a7f0: 7261 6d65 7465 7273 2061 6e64 2062 7566  rameters and buf
-0000a800: 6665 7273 2074 6f20 7468 6520 4350 552e  fers to the CPU.
-0000a810: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
-0000a820: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
-0000a830: 2020 4d6f 6475 6c65 3a20 7365 6c66 0d0a    Module: self..
-0000a840: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0000a850: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000a860: 2e5f 6170 706c 7928 6c61 6d62 6461 2074  ._apply(lambda t
-0000a870: 3a20 742e 6370 7528 2929 0d0a 0d0a 2020  : t.cpu())....  
-0000a880: 2020 6465 6620 6770 7528 7365 6c66 2c20    def gpu(self, 
-0000a890: 6465 7669 6365 3a20 4f70 7469 6f6e 616c  device: Optional
-0000a8a0: 5b55 6e69 6f6e 5b69 6e74 2c20 746f 7263  [Union[int, torc
-0000a8b0: 682e 6465 7669 6365 5d5d 203d 204e 6f6e  h.device]] = Non
-0000a8c0: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
-0000a8d0: 4d6f 7665 7320 616c 6c20 6d6f 6465 6c20  Moves all model 
-0000a8e0: 7061 7261 6d65 7465 7273 2061 6e64 2062  parameters and b
-0000a8f0: 7566 6665 7273 2074 6f20 7468 6520 4750  uffers to the GP
-0000a900: 552e 0d0a 0d0a 2020 2020 2020 2020 2020  U.....          
-0000a910: 2020 5468 6973 2061 6c73 6f20 6d61 6b65    This also make
-0000a920: 7320 6173 736f 6369 6174 6564 2070 6172  s associated par
-0000a930: 616d 6574 6572 7320 616e 6420 6275 6666  ameters and buff
-0000a940: 6572 7320 6469 6666 6572 656e 7420 6f62  ers different ob
-0000a950: 6a65 6374 732e 2053 6f0d 0a20 2020 2020  jects. So..     
-0000a960: 2020 2020 2020 2069 7420 7368 6f75 6c64         it should
-0000a970: 2062 6520 6361 6c6c 6564 2062 6566 6f72   be called befor
-0000a980: 6520 636f 6e73 7472 7563 7469 6e67 206f  e constructing o
-0000a990: 7074 696d 697a 6572 2069 6620 7468 6520  ptimizer if the 
-0000a9a0: 6d6f 6475 6c65 2077 696c 6c0d 0a20 2020  module will..   
-0000a9b0: 2020 2020 2020 2020 206c 6976 6520 6f6e           live on
-0000a9c0: 2047 5055 2077 6869 6c65 2062 6569 6e67   GPU while being
-0000a9d0: 206f 7074 696d 697a 6564 2e0d 0a0d 0a20   optimized..... 
-0000a9e0: 2020 2020 2020 2020 2020 2041 7267 733a             Args:
-0000a9f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000aa00: 2020 6465 7669 6365 2028 696e 742c 206f    device (int, o
-0000aa10: 7074 696f 6e61 6c29 3a20 6966 2073 7065  ptional): if spe
-0000aa20: 6369 6669 6564 2c20 616c 6c20 7061 7261  cified, all para
-0000aa30: 6d65 7465 7273 2077 696c 6c20 6265 0d0a  meters will be..
-0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa50: 2020 2020 636f 7069 6564 2074 6f20 7468      copied to th
-0000aa60: 6174 2064 6576 6963 650d 0a0d 0a20 2020  at device....   
-0000aa70: 2020 2020 2020 2020 2052 6574 7572 6e73           Returns
-0000aa80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000aa90: 2020 204d 6f64 756c 653a 2073 656c 660d     Module: self.
-0000aaa0: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-0000aab0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000aac0: 2073 656c 662e 5f61 7070 6c79 286c 616d   self._apply(lam
-0000aad0: 6264 6120 743a 2074 2e63 7564 6128 6465  bda t: t.cuda(de
-0000aae0: 7669 6365 2929 0d0a 0d0a 2020 2020 2320  vice))....    # 
-0000aaf0: 6465 6620 746f 2873 656c 662c 202a 6172  def to(self, *ar
-0000ab00: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
-0000ab10: 2020 2020 2320 2020 2020 2222 224d 6f76      #     """Mov
-0000ab20: 6573 2061 6e64 2f6f 7220 6361 7374 7320  es and/or casts 
-0000ab30: 7468 6520 7061 7261 6d65 7465 7273 2061  the parameters a
-0000ab40: 6e64 2062 7566 6665 7273 2e0d 0a20 2020  nd buffers...   
-0000ab50: 2023 0d0a 2020 2020 2320 2020 2020 5468   #..    #     Th
-0000ab60: 6973 2063 616e 2062 6520 6361 6c6c 6564  is can be called
-0000ab70: 2061 730d 0a20 2020 2023 0d0a 2020 2020   as..    #..    
-0000ab80: 2320 2020 2020 2e2e 2066 756e 6374 696f  #     .. functio
-0000ab90: 6e3a 3a20 746f 2864 6576 6963 653d 4e6f  n:: to(device=No
-0000aba0: 6e65 2c20 6474 7970 653d 4e6f 6e65 2c20  ne, dtype=None, 
-0000abb0: 6e6f 6e5f 626c 6f63 6b69 6e67 3d46 616c  non_blocking=Fal
-0000abc0: 7365 290d 0a20 2020 2023 0d0a 2020 2020  se)..    #..    
-0000abd0: 2320 2020 2020 2e2e 2066 756e 6374 696f  #     .. functio
-0000abe0: 6e3a 3a20 746f 2864 7479 7065 2c20 6e6f  n:: to(dtype, no
-0000abf0: 6e5f 626c 6f63 6b69 6e67 3d46 616c 7365  n_blocking=False
-0000ac00: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
-0000ac10: 2020 2020 2e2e 2066 756e 6374 696f 6e3a      .. function:
-0000ac20: 3a20 746f 2874 656e 736f 722c 206e 6f6e  : to(tensor, non
-0000ac30: 5f62 6c6f 636b 696e 673d 4661 6c73 6529  _blocking=False)
-0000ac40: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
-0000ac50: 2020 202e 2e20 6675 6e63 7469 6f6e 3a3a     .. function::
-0000ac60: 2074 6f28 6d65 6d6f 7279 5f66 6f72 6d61   to(memory_forma
-0000ac70: 743d 746f 7263 682e 6368 616e 6e65 6c73  t=torch.channels
-0000ac80: 5f6c 6173 7429 0d0a 2020 2020 230d 0a20  _last)..    #.. 
-0000ac90: 2020 2023 2020 2020 2049 7473 2073 6967     #     Its sig
-0000aca0: 6e61 7475 7265 2069 7320 7369 6d69 6c61  nature is simila
-0000acb0: 7220 746f 203a 6d65 7468 3a60 746f 7263  r to :meth:`torc
-0000acc0: 682e 5465 6e73 6f72 2e74 6f60 2c20 6275  h.Tensor.to`, bu
-0000acd0: 7420 6f6e 6c79 2061 6363 6570 7473 0d0a  t only accepts..
-0000ace0: 2020 2020 2320 2020 2020 666c 6f61 7469      #     floati
-0000acf0: 6e67 2070 6f69 6e74 206f 7220 636f 6d70  ng point or comp
-0000ad00: 6c65 7820 3a61 7474 723a 6064 7479 7065  lex :attr:`dtype
-0000ad10: 6073 2e20 496e 2061 6464 6974 696f 6e2c  `s. In addition,
-0000ad20: 2074 6869 7320 6d65 7468 6f64 2077 696c   this method wil
-0000ad30: 6c0d 0a20 2020 2023 2020 2020 206f 6e6c  l..    #     onl
-0000ad40: 7920 6361 7374 2074 6865 2066 6c6f 6174  y cast the float
-0000ad50: 696e 6720 706f 696e 7420 6f72 2063 6f6d  ing point or com
-0000ad60: 706c 6578 2070 6172 616d 6574 6572 7320  plex parameters 
-0000ad70: 616e 6420 6275 6666 6572 7320 746f 203a  and buffers to :
-0000ad80: 6174 7472 3a60 6474 7970 6560 0d0a 2020  attr:`dtype`..  
-0000ad90: 2020 2320 2020 2020 2869 6620 6769 7665    #     (if give
-0000ada0: 6e29 2e20 5468 6520 696e 7465 6772 616c  n). The integral
-0000adb0: 2070 6172 616d 6574 6572 7320 616e 6420   parameters and 
-0000adc0: 6275 6666 6572 7320 7769 6c6c 2062 6520  buffers will be 
-0000add0: 6d6f 7665 640d 0a20 2020 2023 2020 2020  moved..    #    
-0000ade0: 203a 6174 7472 3a60 6465 7669 6365 602c   :attr:`device`,
-0000adf0: 2069 6620 7468 6174 2069 7320 6769 7665   if that is give
-0000ae00: 6e2c 2062 7574 2077 6974 6820 6474 7970  n, but with dtyp
-0000ae10: 6573 2075 6e63 6861 6e67 6564 2e20 5768  es unchanged. Wh
-0000ae20: 656e 0d0a 2020 2020 2320 2020 2020 3a61  en..    #     :a
-0000ae30: 7474 723a 606e 6f6e 5f62 6c6f 636b 696e  ttr:`non_blockin
-0000ae40: 6760 2069 7320 7365 742c 2069 7420 7472  g` is set, it tr
-0000ae50: 6965 7320 746f 2063 6f6e 7665 7274 2f6d  ies to convert/m
-0000ae60: 6f76 6520 6173 796e 6368 726f 6e6f 7573  ove asynchronous
-0000ae70: 6c79 0d0a 2020 2020 2320 2020 2020 7769  ly..    #     wi
-0000ae80: 7468 2072 6573 7065 6374 2074 6f20 7468  th respect to th
-0000ae90: 6520 686f 7374 2069 6620 706f 7373 6962  e host if possib
-0000aea0: 6c65 2c20 652e 672e 2c20 6d6f 7669 6e67  le, e.g., moving
-0000aeb0: 2043 5055 2054 656e 736f 7273 2077 6974   CPU Tensors wit
-0000aec0: 680d 0a20 2020 2023 2020 2020 2070 696e  h..    #     pin
-0000aed0: 6e65 6420 6d65 6d6f 7279 2074 6f20 4355  ned memory to CU
-0000aee0: 4441 2064 6576 6963 6573 2e0d 0a20 2020  DA devices...   
-0000aef0: 2023 0d0a 2020 2020 2320 2020 2020 5365   #..    #     Se
-0000af00: 6520 6265 6c6f 7720 666f 7220 6578 616d  e below for exam
-0000af10: 706c 6573 2e0d 0a20 2020 2023 0d0a 2020  ples...    #..  
-0000af20: 2020 2320 2020 2020 2e2e 206e 6f74 653a    #     .. note:
-0000af30: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0000af40: 2054 6869 7320 6d65 7468 6f64 206d 6f64   This method mod
-0000af50: 6966 6965 7320 7468 6520 6d6f 6475 6c65  ifies the module
-0000af60: 2069 6e2d 706c 6163 652e 0d0a 2020 2020   in-place...    
-0000af70: 230d 0a20 2020 2023 2020 2020 2041 7267  #..    #     Arg
-0000af80: 733a 0d0a 2020 2020 2320 2020 2020 2020  s:..    #       
-0000af90: 2020 6465 7669 6365 2028 3a63 6c61 7373    device (:class
-0000afa0: 3a60 746f 7263 682e 6465 7669 6365 6029  :`torch.device`)
-0000afb0: 3a20 7468 6520 6465 7369 7265 6420 6465  : the desired de
-0000afc0: 7669 6365 206f 6620 7468 6520 7061 7261  vice of the para
-0000afd0: 6d65 7465 7273 0d0a 2020 2020 2320 2020  meters..    #   
-0000afe0: 2020 2020 2020 2020 2020 616e 6420 6275            and bu
-0000aff0: 6666 6572 7320 696e 2074 6869 7320 6d6f  ffers in this mo
-0000b000: 6475 6c65 0d0a 2020 2020 2320 2020 2020  dule..    #     
-0000b010: 2020 2020 6474 7970 6520 283a 636c 6173      dtype (:clas
-0000b020: 733a 6074 6f72 6368 2e64 7479 7065 6029  s:`torch.dtype`)
-0000b030: 3a20 7468 6520 6465 7369 7265 6420 666c  : the desired fl
-0000b040: 6f61 7469 6e67 2070 6f69 6e74 206f 7220  oating point or 
-0000b050: 636f 6d70 6c65 7820 6474 7970 6520 6f66  complex dtype of
-0000b060: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000b070: 2020 2020 7468 6520 7061 7261 6d65 7465      the paramete
-0000b080: 7273 2061 6e64 2062 7566 6665 7273 2069  rs and buffers i
-0000b090: 6e20 7468 6973 206d 6f64 756c 650d 0a20  n this module.. 
-0000b0a0: 2020 2023 2020 2020 2020 2020 2074 656e     #         ten
-0000b0b0: 736f 7220 2874 6f72 6368 2e54 656e 736f  sor (torch.Tenso
-0000b0c0: 7229 3a20 5465 6e73 6f72 2077 686f 7365  r): Tensor whose
-0000b0d0: 2064 7479 7065 2061 6e64 2064 6576 6963   dtype and devic
-0000b0e0: 6520 6172 6520 7468 6520 6465 7369 7265  e are the desire
-0000b0f0: 640d 0a20 2020 2023 2020 2020 2020 2020  d..    #        
-0000b100: 2020 2020 2064 7479 7065 2061 6e64 2064       dtype and d
-0000b110: 6576 6963 6520 666f 7220 616c 6c20 7061  evice for all pa
-0000b120: 7261 6d65 7465 7273 2061 6e64 2062 7566  rameters and buf
-0000b130: 6665 7273 2069 6e20 7468 6973 206d 6f64  fers in this mod
-0000b140: 756c 650d 0a20 2020 2023 2020 2020 2020  ule..    #      
-0000b150: 2020 206d 656d 6f72 795f 666f 726d 6174     memory_format
-0000b160: 2028 3a63 6c61 7373 3a60 746f 7263 682e   (:class:`torch.
-0000b170: 6d65 6d6f 7279 5f66 6f72 6d61 7460 293a  memory_format`):
-0000b180: 2074 6865 2064 6573 6972 6564 206d 656d   the desired mem
-0000b190: 6f72 790d 0a20 2020 2023 2020 2020 2020  ory..    #      
-0000b1a0: 2020 2020 2020 2066 6f72 6d61 7420 666f         format fo
-0000b1b0: 7220 3444 2070 6172 616d 6574 6572 7320  r 4D parameters 
-0000b1c0: 616e 6420 6275 6666 6572 7320 696e 2074  and buffers in t
-0000b1d0: 6869 7320 6d6f 6475 6c65 2028 6b65 7977  his module (keyw
-0000b1e0: 6f72 640d 0a20 2020 2023 2020 2020 2020  ord..    #      
-0000b1f0: 2020 2020 2020 206f 6e6c 7920 6172 6775         only argu
-0000b200: 6d65 6e74 290d 0a20 2020 2023 0d0a 2020  ment)..    #..  
-0000b210: 2020 2320 2020 2020 5265 7475 726e 733a    #     Returns:
-0000b220: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000b230: 4d6f 6475 6c65 3a20 7365 6c66 0d0a 2020  Module: self..  
-0000b240: 2020 230d 0a20 2020 2023 2020 2020 2045    #..    #     E
-0000b250: 7861 6d70 6c65 733a 3a0d 0a20 2020 2023  xamples::..    #
-0000b260: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000b270: 3e3e 3e20 6c69 6e65 6172 203d 206e 6e2e  >>> linear = nn.
-0000b280: 4c69 6e65 6172 2832 2c20 3229 0d0a 2020  Linear(2, 2)..  
-0000b290: 2020 2320 2020 2020 2020 2020 3e3e 3e20    #         >>> 
-0000b2a0: 6c69 6e65 6172 2e77 6569 6768 740d 0a20  linear.weight.. 
-0000b2b0: 2020 2023 2020 2020 2020 2020 2050 6172     #         Par
-0000b2c0: 616d 6574 6572 2063 6f6e 7461 696e 696e  ameter containin
-0000b2d0: 673a 0d0a 2020 2020 2320 2020 2020 2020  g:..    #       
-0000b2e0: 2020 7465 6e73 6f72 285b 5b20 302e 3139    tensor([[ 0.19
-0000b2f0: 3133 2c20 2d30 2e33 3432 305d 2c0d 0a20  13, -0.3420],.. 
-0000b300: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b310: 2020 2020 205b 2d30 2e35 3131 332c 202d       [-0.5113, -
-0000b320: 302e 3233 3235 5d5d 290d 0a20 2020 2023  0.2325]])..    #
-0000b330: 2020 2020 2020 2020 203e 3e3e 206c 696e           >>> lin
-0000b340: 6561 722e 746f 2874 6f72 6368 2e64 6f75  ear.to(torch.dou
-0000b350: 626c 6529 0d0a 2020 2020 2320 2020 2020  ble)..    #     
-0000b360: 2020 2020 4c69 6e65 6172 2869 6e5f 6665      Linear(in_fe
-0000b370: 6174 7572 6573 3d32 2c20 6f75 745f 6665  atures=2, out_fe
-0000b380: 6174 7572 6573 3d32 2c20 6269 6173 3d54  atures=2, bias=T
-0000b390: 7275 6529 0d0a 2020 2020 2320 2020 2020  rue)..    #     
-0000b3a0: 2020 2020 3e3e 3e20 6c69 6e65 6172 2e77      >>> linear.w
-0000b3b0: 6569 6768 740d 0a20 2020 2023 2020 2020  eight..    #    
-0000b3c0: 2020 2020 2050 6172 616d 6574 6572 2063       Parameter c
-0000b3d0: 6f6e 7461 696e 696e 673a 0d0a 2020 2020  ontaining:..    
-0000b3e0: 2320 2020 2020 2020 2020 7465 6e73 6f72  #         tensor
-0000b3f0: 285b 5b20 302e 3139 3133 2c20 2d30 2e33  ([[ 0.1913, -0.3
-0000b400: 3432 305d 2c0d 0a20 2020 2023 2020 2020  420],..    #    
-0000b410: 2020 2020 2020 2020 2020 2020 205b 2d30               [-0
-0000b420: 2e35 3131 332c 202d 302e 3233 3235 5d5d  .5113, -0.2325]]
-0000b430: 2c20 6474 7970 653d 746f 7263 682e 666c  , dtype=torch.fl
-0000b440: 6f61 7436 3429 0d0a 2020 2020 2320 2020  oat64)..    #   
-0000b450: 2020 2020 2020 3e3e 3e20 6770 7531 203d        >>> gpu1 =
-0000b460: 2074 6f72 6368 2e64 6576 6963 6528 2263   torch.device("c
-0000b470: 7564 613a 3122 290d 0a20 2020 2023 2020  uda:1")..    #  
-0000b480: 2020 2020 2020 203e 3e3e 206c 696e 6561         >>> linea
-0000b490: 722e 746f 2867 7075 312c 2064 7479 7065  r.to(gpu1, dtype
-0000b4a0: 3d74 6f72 6368 2e68 616c 662c 206e 6f6e  =torch.half, non
-0000b4b0: 5f62 6c6f 636b 696e 673d 5472 7565 290d  _blocking=True).
-0000b4c0: 0a20 2020 2023 2020 2020 2020 2020 204c  .    #         L
-0000b4d0: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
-0000b4e0: 733d 322c 206f 7574 5f66 6561 7475 7265  s=2, out_feature
-0000b4f0: 733d 322c 2062 6961 733d 5472 7565 290d  s=2, bias=True).
-0000b500: 0a20 2020 2023 2020 2020 2020 2020 203e  .    #         >
-0000b510: 3e3e 206c 696e 6561 722e 7765 6967 6874  >> linear.weight
-0000b520: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000b530: 5061 7261 6d65 7465 7220 636f 6e74 6169  Parameter contai
-0000b540: 6e69 6e67 3a0d 0a20 2020 2023 2020 2020  ning:..    #    
-0000b550: 2020 2020 2074 656e 736f 7228 5b5b 2030       tensor([[ 0
-0000b560: 2e31 3931 342c 202d 302e 3334 3230 5d2c  .1914, -0.3420],
-0000b570: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000b580: 2020 2020 2020 2020 5b2d 302e 3531 3132          [-0.5112
-0000b590: 2c20 2d30 2e32 3332 345d 5d2c 2064 7479  , -0.2324]], dty
-0000b5a0: 7065 3d74 6f72 6368 2e66 6c6f 6174 3136  pe=torch.float16
-0000b5b0: 2c20 6465 7669 6365 3d27 6375 6461 3a31  , device='cuda:1
-0000b5c0: 2729 0d0a 2020 2020 2320 2020 2020 2020  ')..    #       
-0000b5d0: 2020 3e3e 3e20 6370 7520 3d20 746f 7263    >>> cpu = torc
-0000b5e0: 682e 6465 7669 6365 2822 6370 7522 290d  h.device("cpu").
-0000b5f0: 0a20 2020 2023 2020 2020 2020 2020 203e  .    #         >
-0000b600: 3e3e 206c 696e 6561 722e 746f 2863 7075  >> linear.to(cpu
-0000b610: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
-0000b620: 204c 696e 6561 7228 696e 5f66 6561 7475   Linear(in_featu
-0000b630: 7265 733d 322c 206f 7574 5f66 6561 7475  res=2, out_featu
-0000b640: 7265 733d 322c 2062 6961 733d 5472 7565  res=2, bias=True
-0000b650: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
-0000b660: 203e 3e3e 206c 696e 6561 722e 7765 6967   >>> linear.weig
-0000b670: 6874 0d0a 2020 2020 2320 2020 2020 2020  ht..    #       
-0000b680: 2020 5061 7261 6d65 7465 7220 636f 6e74    Parameter cont
-0000b690: 6169 6e69 6e67 3a0d 0a20 2020 2023 2020  aining:..    #  
-0000b6a0: 2020 2020 2020 2074 656e 736f 7228 5b5b         tensor([[
-0000b6b0: 2030 2e31 3931 342c 202d 302e 3334 3230   0.1914, -0.3420
-0000b6c0: 5d2c 0d0a 2020 2020 2320 2020 2020 2020  ],..    #       
-0000b6d0: 2020 2020 2020 2020 2020 5b2d 302e 3531            [-0.51
-0000b6e0: 3132 2c20 2d30 2e32 3332 345d 5d2c 2064  12, -0.2324]], d
-0000b6f0: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
-0000b700: 3136 290d 0a20 2020 2023 0d0a 2020 2020  16)..    #..    
-0000b710: 2320 2020 2020 2020 2020 3e3e 3e20 6c69  #         >>> li
-0000b720: 6e65 6172 203d 206e 6e2e 4c69 6e65 6172  near = nn.Linear
-0000b730: 2832 2c20 322c 2062 6961 733d 4e6f 6e65  (2, 2, bias=None
-0000b740: 292e 746f 2874 6f72 6368 2e63 646f 7562  ).to(torch.cdoub
-0000b750: 6c65 290d 0a20 2020 2023 2020 2020 2020  le)..    #      
-0000b760: 2020 203e 3e3e 206c 696e 6561 722e 7765     >>> linear.we
-0000b770: 6967 6874 0d0a 2020 2020 2320 2020 2020  ight..    #     
-0000b780: 2020 2020 5061 7261 6d65 7465 7220 636f      Parameter co
-0000b790: 6e74 6169 6e69 6e67 3a0d 0a20 2020 2023  ntaining:..    #
-0000b7a0: 2020 2020 2020 2020 2074 656e 736f 7228           tensor(
-0000b7b0: 5b5b 2030 2e33 3734 312b 302e 6a2c 2020  [[ 0.3741+0.j,  
-0000b7c0: 302e 3233 3832 2b30 2e6a 5d2c 0d0a 2020  0.2382+0.j],..  
-0000b7d0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000b7e0: 2020 2020 5b20 302e 3535 3933 2b30 2e6a      [ 0.5593+0.j
-0000b7f0: 2c20 2d30 2e34 3434 332b 302e 6a5d 5d2c  , -0.4443+0.j]],
-0000b800: 2064 7479 7065 3d74 6f72 6368 2e63 6f6d   dtype=torch.com
-0000b810: 706c 6578 3132 3829 0d0a 2020 2020 2320  plex128)..    # 
-0000b820: 2020 2020 2020 2020 3e3e 3e20 6c69 6e65          >>> line
-0000b830: 6172 2874 6f72 6368 2e6f 6e65 7328 332c  ar(torch.ones(3,
-0000b840: 2032 2c20 6474 7970 653d 746f 7263 682e   2, dtype=torch.
-0000b850: 6364 6f75 626c 6529 290d 0a20 2020 2023  cdouble))..    #
-0000b860: 2020 2020 2020 2020 2074 656e 736f 7228           tensor(
-0000b870: 5b5b 302e 3631 3232 2b30 2e6a 2c20 302e  [[0.6122+0.j, 0.
-0000b880: 3131 3530 2b30 2e6a 5d2c 0d0a 2020 2020  1150+0.j],..    
-0000b890: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000b8a0: 2020 5b30 2e36 3132 322b 302e 6a2c 2030    [0.6122+0.j, 0
-0000b8b0: 2e31 3135 302b 302e 6a5d 2c0d 0a20 2020  .1150+0.j],..   
-0000b8c0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b8d0: 2020 205b 302e 3631 3232 2b30 2e6a 2c20     [0.6122+0.j, 
-0000b8e0: 302e 3131 3530 2b30 2e6a 5d5d 2c20 6474  0.1150+0.j]], dt
-0000b8f0: 7970 653d 746f 7263 682e 636f 6d70 6c65  ype=torch.comple
-0000b900: 7831 3238 290d 0a20 2020 2023 0d0a 2020  x128)..    #..  
-0000b910: 2020 2320 2020 2020 2222 220d 0a20 2020    #     """..   
-0000b920: 2023 0d0a 2020 2020 2320 2020 2020 6465   #..    #     de
-0000b930: 7669 6365 2c20 6474 7970 652c 206e 6f6e  vice, dtype, non
-0000b940: 5f62 6c6f 636b 696e 672c 2063 6f6e 7665  _blocking, conve
-0000b950: 7274 5f74 6f5f 666f 726d 6174 203d 2074  rt_to_format = t
-0000b960: 6f72 6368 2e5f 432e 5f6e 6e2e 5f70 6172  orch._C._nn._par
-0000b970: 7365 5f74 6f28 2a61 7267 732c 202a 2a6b  se_to(*args, **k
-0000b980: 7761 7267 7329 0d0a 2020 2020 230d 0a20  wargs)..    #.. 
-0000b990: 2020 2023 2020 2020 2069 6620 6474 7970     #     if dtyp
-0000b9a0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-0000b9b0: 2020 2020 2320 2020 2020 2020 2020 6966      #         if
-0000b9c0: 206e 6f74 2028 6474 7970 652e 6973 5f66   not (dtype.is_f
-0000b9d0: 6c6f 6174 696e 675f 706f 696e 7420 6f72  loating_point or
-0000b9e0: 2064 7479 7065 2e69 735f 636f 6d70 6c65   dtype.is_comple
-0000b9f0: 7829 3a0d 0a20 2020 2023 2020 2020 2020  x):..    #      
-0000ba00: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-0000ba10: 6545 7272 6f72 2827 6e6e 2e4d 6f64 756c  eError('nn.Modul
-0000ba20: 652e 746f 206f 6e6c 7920 6163 6365 7074  e.to only accept
-0000ba30: 7320 666c 6f61 7469 6e67 2070 6f69 6e74  s floating point
-0000ba40: 206f 7220 636f 6d70 6c65 7820 270d 0a20   or complex '.. 
-0000ba50: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009c40: 2020 2020 2020 2020 2020 2020 2770 726f              'pro
+00009c50: 7669 6465 6420 7765 6967 6874 2073 6861  vided weight sha
+00009c60: 7065 2027 202b 2073 7472 2877 2e73 6861  pe ' + str(w.sha
+00009c70: 7065 2929 0d0a 2020 2020 2020 2020 2020  pe))..          
+00009c80: 2020 7765 6967 6874 5f76 616c 7565 5f74    weight_value_t
+00009c90: 7570 6c65 732e 6170 7065 6e64 2828 702c  uples.append((p,
+00009ca0: 2077 2929 0d0a 2020 2020 2020 2020 666f   w))..        fo
+00009cb0: 7220 702c 2077 2069 6e20 7765 6967 6874  r p, w in weight
+00009cc0: 5f76 616c 7565 5f74 7570 6c65 733a 0d0a  _value_tuples:..
+00009cd0: 2020 2020 2020 2020 2020 2020 702e 6461              p.da
+00009ce0: 7461 203d 2077 2e64 6174 610d 0a0d 0a20  ta = w.data.... 
+00009cf0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00009d00: 2020 6465 6620 7472 6169 6e61 626c 6528    def trainable(
+00009d10: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00009d20: 6966 206c 656e 2873 656c 662e 5f70 6172  if len(self._par
+00009d30: 616d 6574 6572 7329 203d 3d20 303a 0d0a  ameters) == 0:..
+00009d40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00009d50: 726e 2046 616c 7365 0d0a 0d0a 2020 2020  rn False....    
+00009d60: 2020 2020 656c 6966 206c 656e 2873 656c      elif len(sel
+00009d70: 662e 5f70 6172 616d 6574 6572 7329 203e  f._parameters) >
+00009d80: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00009d90: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+00009da0: 662e 5f70 6172 616d 6574 6572 732e 6974  f._parameters.it
+00009db0: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
+00009dc0: 2020 2020 2020 2020 6966 2076 2069 7320          if v is 
+00009dd0: 6e6f 7420 4e6f 6e65 2061 6e64 2076 2e72  not None and v.r
+00009de0: 6571 7569 7265 735f 6772 6164 203d 3d20  equires_grad == 
+00009df0: 4661 6c73 653a 0d0a 2020 2020 2020 2020  False:..        
+00009e00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00009e10: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
+00009e20: 2020 2020 2020 2020 2020 656c 6966 2076            elif v
+00009e30: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00009e40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00009e50: 6173 730d 0a20 2020 2020 2020 2020 2020  ass..           
+00009e60: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00009e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e80: 7061 7373 0d0a 2020 2020 2020 2020 2020  pass..          
+00009e90: 2020 7265 7475 726e 2054 7275 650d 0a0d    return True...
+00009ea0: 0a20 2020 2040 7472 6169 6e61 626c 652e  .    @trainable.
+00009eb0: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
+00009ec0: 7472 6169 6e61 626c 6528 7365 6c66 2c20  trainable(self, 
+00009ed0: 7661 6c75 653a 2062 6f6f 6c29 3a0d 0a20  value: bool):.. 
+00009ee0: 2020 2020 2020 206e 203d 2030 0d0a 2020         n = 0..  
+00009ef0: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+00009f00: 7061 7261 2069 6e20 7365 6c66 2e6e 616d  para in self.nam
+00009f10: 6564 5f70 6172 616d 6574 6572 7328 293a  ed_parameters():
+00009f20: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00009f30: 2070 6172 612e 7265 7175 6972 6573 5f67   para.requires_g
+00009f40: 7261 6420 213d 2076 616c 7565 3a0d 0a20  rad != value:.. 
+00009f50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00009f60: 6172 612e 7265 7175 6972 6573 5f67 7261  ara.requires_gra
+00009f70: 6420 3d20 7661 6c75 650d 0a20 2020 2020  d = value..     
+00009f80: 2020 2020 2020 2020 2020 206e 202b 3d20             n += 
+00009f90: 6e70 2e70 726f 6428 6c69 7374 2870 6172  np.prod(list(par
+00009fa0: 612e 7369 7a65 2829 2929 0d0a 2020 2020  a.size()))..    
+00009fb0: 2020 2020 6966 206e 3e30 3a0d 0a20 2020      if n>0:..   
+00009fc0: 2020 2020 2020 2020 2069 6620 7661 6c75           if valu
+00009fd0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00009fe0: 2020 2020 7072 696e 7428 277b 307d 2070      print('{0} p
+00009ff0: 6172 616d 6574 6572 7320 6861 7665 2073  arameters have s
+0000a000: 6574 2074 7261 696e 6162 6c65 272e 666f  et trainable'.fo
+0000a010: 726d 6174 286e 2929 0d0a 2020 2020 2020  rmat(n))..      
+0000a020: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000a030: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000a040: 6e74 2827 7b30 7d20 7061 7261 6d65 7465  nt('{0} paramete
+0000a050: 7273 2068 6176 6520 7365 7420 756e 7472  rs have set untr
+0000a060: 6169 6e61 626c 6527 2e66 6f72 6d61 7428  ainable'.format(
+0000a070: 6e29 290d 0a0d 0a20 2020 2040 7072 6f70  n))....    @prop
+0000a080: 6572 7479 0d0a 2020 2020 6465 6620 6465  erty..    def de
+0000a090: 7669 6365 2873 656c 6629 202d 3e20 7374  vice(self) -> st
+0000a0a0: 723a 0d0a 2020 2020 2020 2020 5f72 6f6f  r:..        _roo
+0000a0b0: 7420 3d20 7365 6c66 2e67 6574 5f72 6f6f  t = self.get_roo
+0000a0c0: 7428 290d 0a20 2020 2020 2020 2069 6620  t()..        if 
+0000a0d0: 7365 6c66 2e69 735f 726f 6f74 206f 7220  self.is_root or 
+0000a0e0: 5f72 6f6f 7420 6973 204e 6f6e 653a 0d0a  _root is None:..
+0000a0f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000a100: 656e 2873 656c 662e 7765 6967 6874 7329  en(self.weights)
+0000a110: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+0000a120: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000a130: 656c 662e 6661 6374 6f72 795f 6b77 6172  elf.factory_kwar
+0000a140: 6773 5b27 6465 7669 6365 275d 0d0a 2020  gs['device']..  
+0000a150: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0000a160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a170: 2072 6574 7572 6e20 7365 6c66 2e77 6569   return self.wei
+0000a180: 6768 7473 5b30 5d2e 6465 7669 6365 2e74  ghts[0].device.t
+0000a190: 7970 650d 0a20 2020 2020 2020 2065 6c73  ype..        els
+0000a1a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000a1b0: 7265 7475 726e 205f 726f 6f74 2e64 6576  return _root.dev
+0000a1c0: 6963 650d 0a0d 0a20 2020 2040 6465 7669  ice....    @devi
+0000a1d0: 6365 2e73 6574 7465 720d 0a20 2020 2064  ce.setter..    d
+0000a1e0: 6566 2064 6576 6963 6528 7365 6c66 2c20  ef device(self, 
+0000a1f0: 7661 6c75 653a 2073 7472 293a 0d0a 2020  value: str):..  
+0000a200: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000a210: 6e63 6528 7661 6c75 652c 2074 6f72 6368  nce(value, torch
+0000a220: 2e64 6576 6963 6529 3a0d 0a20 2020 2020  .device):..     
+0000a230: 2020 2020 2020 2076 616c 7565 203d 2076         value = v
+0000a240: 616c 7565 2e74 7970 650d 0a20 2020 2020  alue.type..     
+0000a250: 2020 2073 656c 662e 6661 6374 6f72 795f     self.factory_
+0000a260: 6b77 6172 6773 5b27 6465 7669 6365 275d  kwargs['device']
+0000a270: 203d 2076 616c 7565 0d0a 2020 2020 2020   = value..      
+0000a280: 2020 7365 6c66 2e74 6f28 7661 6c75 6529    self.to(value)
+0000a290: 0d0a 0d0a 2020 2020 6465 6620 6375 6461  ....    def cuda
+0000a2a0: 2873 656c 662c 2064 6576 6963 653a 204f  (self, device: O
+0000a2b0: 7074 696f 6e61 6c5b 556e 696f 6e5b 696e  ptional[Union[in
+0000a2c0: 742c 2074 6f72 6368 2e64 6576 6963 655d  t, torch.device]
+0000a2d0: 5d20 3d20 4e6f 6e65 293a 0d0a 2020 2020  ] = None):..    
+0000a2e0: 2020 2020 2222 224d 6f76 6573 2061 6c6c      """Moves all
+0000a2f0: 206d 6f64 656c 2070 6172 616d 6574 6572   model parameter
+0000a300: 7320 616e 6420 6275 6666 6572 7320 746f  s and buffers to
+0000a310: 2074 6865 2047 5055 2e0d 0a0d 0a20 2020   the GPU.....   
+0000a320: 2020 2020 2054 6869 7320 616c 736f 206d       This also m
+0000a330: 616b 6573 2061 7373 6f63 6961 7465 6420  akes associated 
+0000a340: 7061 7261 6d65 7465 7273 2061 6e64 2062  parameters and b
+0000a350: 7566 6665 7273 2064 6966 6665 7265 6e74  uffers different
+0000a360: 206f 626a 6563 7473 2e20 536f 0d0a 2020   objects. So..  
+0000a370: 2020 2020 2020 6974 2073 686f 756c 6420        it should 
+0000a380: 6265 2063 616c 6c65 6420 6265 666f 7265  be called before
+0000a390: 2063 6f6e 7374 7275 6374 696e 6720 6f70   constructing op
+0000a3a0: 7469 6d69 7a65 7220 6966 2074 6865 206d  timizer if the m
+0000a3b0: 6f64 756c 6520 7769 6c6c 0d0a 2020 2020  odule will..    
+0000a3c0: 2020 2020 6c69 7665 206f 6e20 4750 5520      live on GPU 
+0000a3d0: 7768 696c 6520 6265 696e 6720 6f70 7469  while being opti
+0000a3e0: 6d69 7a65 642e 0d0a 0d0a 2020 2020 2020  mized.....      
+0000a3f0: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+0000a400: 2020 2020 2064 6576 6963 6520 2869 6e74       device (int
+0000a410: 2c20 6f70 7469 6f6e 616c 293a 2069 6620  , optional): if 
+0000a420: 7370 6563 6966 6965 642c 2061 6c6c 2070  specified, all p
+0000a430: 6172 616d 6574 6572 7320 7769 6c6c 2062  arameters will b
+0000a440: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000a450: 2020 2063 6f70 6965 6420 746f 2074 6861     copied to tha
+0000a460: 7420 6465 7669 6365 0d0a 0d0a 2020 2020  t device....    
+0000a470: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
+0000a480: 2020 2020 2020 2020 2020 4d6f 6475 6c65            Module
+0000a490: 3a20 7365 6c66 0d0a 2020 2020 2020 2020  : self..        
+0000a4a0: 2222 220d 0a20 2020 2020 2020 2072 6574  """..        ret
+0000a4b0: 7572 6e20 7365 6c66 2e5f 6170 706c 7928  urn self._apply(
+0000a4c0: 6c61 6d62 6461 2074 3a20 742e 6375 6461  lambda t: t.cuda
+0000a4d0: 2864 6576 6963 6529 290d 0a0d 0a20 2020  (device))....   
+0000a4e0: 2064 6566 2078 7075 2873 656c 662c 2064   def xpu(self, d
+0000a4f0: 6576 6963 653a 204f 7074 696f 6e61 6c5b  evice: Optional[
+0000a500: 556e 696f 6e5b 696e 742c 2074 6f72 6368  Union[int, torch
+0000a510: 2e64 6576 6963 655d 5d20 3d20 4e6f 6e65  .device]] = None
+0000a520: 293a 0d0a 2020 2020 2020 2020 2222 224d  ):..        """M
+0000a530: 6f76 6573 2061 6c6c 206d 6f64 656c 2070  oves all model p
+0000a540: 6172 616d 6574 6572 7320 616e 6420 6275  arameters and bu
+0000a550: 6666 6572 7320 746f 2074 6865 2058 5055  ffers to the XPU
+0000a560: 2e0d 0a0d 0a20 2020 2020 2020 2054 6869  .....        Thi
+0000a570: 7320 616c 736f 206d 616b 6573 2061 7373  s also makes ass
+0000a580: 6f63 6961 7465 6420 7061 7261 6d65 7465  ociated paramete
+0000a590: 7273 2061 6e64 2062 7566 6665 7273 2064  rs and buffers d
+0000a5a0: 6966 6665 7265 6e74 206f 626a 6563 7473  ifferent objects
+0000a5b0: 2e20 536f 0d0a 2020 2020 2020 2020 6974  . So..        it
+0000a5c0: 2073 686f 756c 6420 6265 2063 616c 6c65   should be calle
+0000a5d0: 6420 6265 666f 7265 2063 6f6e 7374 7275  d before constru
+0000a5e0: 6374 696e 6720 6f70 7469 6d69 7a65 7220  cting optimizer 
+0000a5f0: 6966 2074 6865 206d 6f64 756c 6520 7769  if the module wi
+0000a600: 6c6c 0d0a 2020 2020 2020 2020 6c69 7665  ll..        live
+0000a610: 206f 6e20 5850 5520 7768 696c 6520 6265   on XPU while be
+0000a620: 696e 6720 6f70 7469 6d69 7a65 642e 0d0a  ing optimized...
+0000a630: 0d0a 2020 2020 2020 2020 4172 6775 6d65  ..        Argume
+0000a640: 6e74 733a 0d0a 2020 2020 2020 2020 2020  nts:..          
+0000a650: 2020 6465 7669 6365 2028 696e 742c 206f    device (int, o
+0000a660: 7074 696f 6e61 6c29 3a20 6966 2073 7065  ptional): if spe
+0000a670: 6369 6669 6564 2c20 616c 6c20 7061 7261  cified, all para
+0000a680: 6d65 7465 7273 2077 696c 6c20 6265 0d0a  meters will be..
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6a0: 636f 7069 6564 2074 6f20 7468 6174 2064  copied to that d
+0000a6b0: 6576 6963 650d 0a0d 0a20 2020 2020 2020  evice....       
+0000a6c0: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+0000a6d0: 2020 2020 2020 204d 6f64 756c 653a 2073         Module: s
+0000a6e0: 656c 660d 0a20 2020 2020 2020 2022 2222  elf..        """
+0000a6f0: 0d0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
+0000a700: 7470 755f 6176 6169 6c61 626c 6528 2920  tpu_available() 
+0000a710: 616e 6420 2864 6576 6963 6520 3d3d 2027  and (device == '
+0000a720: 7870 7527 206f 7220 6465 7669 6365 2069  xpu' or device i
+0000a730: 7320 4e6f 6e65 293a 0d0a 2020 2020 2020  s None):..      
+0000a740: 2020 2020 2020 696d 706f 7274 2074 6f72        import tor
+0000a750: 6368 5f78 6c61 2e63 6f72 652e 786c 615f  ch_xla.core.xla_
+0000a760: 6d6f 6465 6c20 6173 2078 6d0d 0a20 2020  model as xm..   
+0000a770: 2020 2020 2020 2020 2064 6576 6963 6520           device 
+0000a780: 3d20 786d 2e78 6c61 5f64 6576 6963 6528  = xm.xla_device(
+0000a790: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000a7a0: 6e20 7365 6c66 2e5f 6170 706c 7928 6c61  n self._apply(la
+0000a7b0: 6d62 6461 2074 3a20 742e 7870 7528 6465  mbda t: t.xpu(de
+0000a7c0: 7669 6365 2929 0d0a 0d0a 2020 2020 6465  vice))....    de
+0000a7d0: 6620 6370 7528 7365 6c66 293a 0d0a 2020  f cpu(self):..  
+0000a7e0: 2020 2020 2020 2222 224d 6f76 6573 2061        """Moves a
+0000a7f0: 6c6c 206d 6f64 656c 2070 6172 616d 6574  ll model paramet
+0000a800: 6572 7320 616e 6420 6275 6666 6572 7320  ers and buffers 
+0000a810: 746f 2074 6865 2043 5055 2e0d 0a0d 0a20  to the CPU..... 
+0000a820: 2020 2020 2020 2052 6574 7572 6e73 3a0d         Returns:.
+0000a830: 0a20 2020 2020 2020 2020 2020 204d 6f64  .            Mod
+0000a840: 756c 653a 2073 656c 660d 0a20 2020 2020  ule: self..     
+0000a850: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0000a860: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
+0000a870: 6c79 286c 616d 6264 6120 743a 2074 2e63  ly(lambda t: t.c
+0000a880: 7075 2829 290d 0a0d 0a20 2020 2064 6566  pu())....    def
+0000a890: 2067 7075 2873 656c 662c 2064 6576 6963   gpu(self, devic
+0000a8a0: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
+0000a8b0: 6e5b 696e 742c 2074 6f72 6368 2e64 6576  n[int, torch.dev
+0000a8c0: 6963 655d 5d20 3d20 4e6f 6e65 293a 0d0a  ice]] = None):..
+0000a8d0: 2020 2020 2020 2020 2222 224d 6f76 6573          """Moves
+0000a8e0: 2061 6c6c 206d 6f64 656c 2070 6172 616d   all model param
+0000a8f0: 6574 6572 7320 616e 6420 6275 6666 6572  eters and buffer
+0000a900: 7320 746f 2074 6865 2047 5055 2e0d 0a0d  s to the GPU....
+0000a910: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
+0000a920: 7320 616c 736f 206d 616b 6573 2061 7373  s also makes ass
+0000a930: 6f63 6961 7465 6420 7061 7261 6d65 7465  ociated paramete
+0000a940: 7273 2061 6e64 2062 7566 6665 7273 2064  rs and buffers d
+0000a950: 6966 6665 7265 6e74 206f 626a 6563 7473  ifferent objects
+0000a960: 2e20 536f 0d0a 2020 2020 2020 2020 2020  . So..          
+0000a970: 2020 6974 2073 686f 756c 6420 6265 2063    it should be c
+0000a980: 616c 6c65 6420 6265 666f 7265 2063 6f6e  alled before con
+0000a990: 7374 7275 6374 696e 6720 6f70 7469 6d69  structing optimi
+0000a9a0: 7a65 7220 6966 2074 6865 206d 6f64 756c  zer if the modul
+0000a9b0: 6520 7769 6c6c 0d0a 2020 2020 2020 2020  e will..        
+0000a9c0: 2020 2020 6c69 7665 206f 6e20 4750 5520      live on GPU 
+0000a9d0: 7768 696c 6520 6265 696e 6720 6f70 7469  while being opti
+0000a9e0: 6d69 7a65 642e 0d0a 0d0a 2020 2020 2020  mized.....      
+0000a9f0: 2020 2020 2020 4172 6773 3a0d 0a20 2020        Args:..   
+0000aa00: 2020 2020 2020 2020 2020 2020 2064 6576               dev
+0000aa10: 6963 6520 2869 6e74 2c20 6f70 7469 6f6e  ice (int, option
+0000aa20: 616c 293a 2069 6620 7370 6563 6966 6965  al): if specifie
+0000aa30: 642c 2061 6c6c 2070 6172 616d 6574 6572  d, all parameter
+0000aa40: 7320 7769 6c6c 2062 650d 0a20 2020 2020  s will be..     
+0000aa50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000aa60: 6f70 6965 6420 746f 2074 6861 7420 6465  opied to that de
+0000aa70: 7669 6365 0d0a 0d0a 2020 2020 2020 2020  vice....        
+0000aa80: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
+0000aa90: 2020 2020 2020 2020 2020 2020 2020 4d6f                Mo
+0000aaa0: 6475 6c65 3a20 7365 6c66 0d0a 2020 2020  dule: self..    
+0000aab0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0000aac0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000aad0: 2e5f 6170 706c 7928 6c61 6d62 6461 2074  ._apply(lambda t
+0000aae0: 3a20 742e 6375 6461 2864 6576 6963 6529  : t.cuda(device)
+0000aaf0: 290d 0a0d 0a20 2020 2023 2064 6566 2074  )....    # def t
+0000ab00: 6f28 7365 6c66 2c20 2a61 7267 732c 202a  o(self, *args, *
+0000ab10: 2a6b 7761 7267 7329 3a0d 0a20 2020 2023  *kwargs):..    #
+0000ab20: 2020 2020 2022 2222 4d6f 7665 7320 616e       """Moves an
+0000ab30: 642f 6f72 2063 6173 7473 2074 6865 2070  d/or casts the p
+0000ab40: 6172 616d 6574 6572 7320 616e 6420 6275  arameters and bu
+0000ab50: 6666 6572 732e 0d0a 2020 2020 230d 0a20  ffers...    #.. 
+0000ab60: 2020 2023 2020 2020 2054 6869 7320 6361     #     This ca
+0000ab70: 6e20 6265 2063 616c 6c65 6420 6173 0d0a  n be called as..
+0000ab80: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
+0000ab90: 202e 2e20 6675 6e63 7469 6f6e 3a3a 2074   .. function:: t
+0000aba0: 6f28 6465 7669 6365 3d4e 6f6e 652c 2064  o(device=None, d
+0000abb0: 7479 7065 3d4e 6f6e 652c 206e 6f6e 5f62  type=None, non_b
+0000abc0: 6c6f 636b 696e 673d 4661 6c73 6529 0d0a  locking=False)..
+0000abd0: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
+0000abe0: 202e 2e20 6675 6e63 7469 6f6e 3a3a 2074   .. function:: t
+0000abf0: 6f28 6474 7970 652c 206e 6f6e 5f62 6c6f  o(dtype, non_blo
+0000ac00: 636b 696e 673d 4661 6c73 6529 0d0a 2020  cking=False)..  
+0000ac10: 2020 230d 0a20 2020 2023 2020 2020 202e    #..    #     .
+0000ac20: 2e20 6675 6e63 7469 6f6e 3a3a 2074 6f28  . function:: to(
+0000ac30: 7465 6e73 6f72 2c20 6e6f 6e5f 626c 6f63  tensor, non_bloc
+0000ac40: 6b69 6e67 3d46 616c 7365 290d 0a20 2020  king=False)..   
+0000ac50: 2023 0d0a 2020 2020 2320 2020 2020 2e2e   #..    #     ..
+0000ac60: 2066 756e 6374 696f 6e3a 3a20 746f 286d   function:: to(m
+0000ac70: 656d 6f72 795f 666f 726d 6174 3d74 6f72  emory_format=tor
+0000ac80: 6368 2e63 6861 6e6e 656c 735f 6c61 7374  ch.channels_last
+0000ac90: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
+0000aca0: 2020 2020 4974 7320 7369 676e 6174 7572      Its signatur
+0000acb0: 6520 6973 2073 696d 696c 6172 2074 6f20  e is similar to 
+0000acc0: 3a6d 6574 683a 6074 6f72 6368 2e54 656e  :meth:`torch.Ten
+0000acd0: 736f 722e 746f 602c 2062 7574 206f 6e6c  sor.to`, but onl
+0000ace0: 7920 6163 6365 7074 730d 0a20 2020 2023  y accepts..    #
+0000acf0: 2020 2020 2066 6c6f 6174 696e 6720 706f       floating po
+0000ad00: 696e 7420 6f72 2063 6f6d 706c 6578 203a  int or complex :
+0000ad10: 6174 7472 3a60 6474 7970 6560 732e 2049  attr:`dtype`s. I
+0000ad20: 6e20 6164 6469 7469 6f6e 2c20 7468 6973  n addition, this
+0000ad30: 206d 6574 686f 6420 7769 6c6c 0d0a 2020   method will..  
+0000ad40: 2020 2320 2020 2020 6f6e 6c79 2063 6173    #     only cas
+0000ad50: 7420 7468 6520 666c 6f61 7469 6e67 2070  t the floating p
+0000ad60: 6f69 6e74 206f 7220 636f 6d70 6c65 7820  oint or complex 
+0000ad70: 7061 7261 6d65 7465 7273 2061 6e64 2062  parameters and b
+0000ad80: 7566 6665 7273 2074 6f20 3a61 7474 723a  uffers to :attr:
+0000ad90: 6064 7479 7065 600d 0a20 2020 2023 2020  `dtype`..    #  
+0000ada0: 2020 2028 6966 2067 6976 656e 292e 2054     (if given). T
+0000adb0: 6865 2069 6e74 6567 7261 6c20 7061 7261  he integral para
+0000adc0: 6d65 7465 7273 2061 6e64 2062 7566 6665  meters and buffe
+0000add0: 7273 2077 696c 6c20 6265 206d 6f76 6564  rs will be moved
+0000ade0: 0d0a 2020 2020 2320 2020 2020 3a61 7474  ..    #     :att
+0000adf0: 723a 6064 6576 6963 6560 2c20 6966 2074  r:`device`, if t
+0000ae00: 6861 7420 6973 2067 6976 656e 2c20 6275  hat is given, bu
+0000ae10: 7420 7769 7468 2064 7479 7065 7320 756e  t with dtypes un
+0000ae20: 6368 616e 6765 642e 2057 6865 6e0d 0a20  changed. When.. 
+0000ae30: 2020 2023 2020 2020 203a 6174 7472 3a60     #     :attr:`
+0000ae40: 6e6f 6e5f 626c 6f63 6b69 6e67 6020 6973  non_blocking` is
+0000ae50: 2073 6574 2c20 6974 2074 7269 6573 2074   set, it tries t
+0000ae60: 6f20 636f 6e76 6572 742f 6d6f 7665 2061  o convert/move a
+0000ae70: 7379 6e63 6872 6f6e 6f75 736c 790d 0a20  synchronously.. 
+0000ae80: 2020 2023 2020 2020 2077 6974 6820 7265     #     with re
+0000ae90: 7370 6563 7420 746f 2074 6865 2068 6f73  spect to the hos
+0000aea0: 7420 6966 2070 6f73 7369 626c 652c 2065  t if possible, e
+0000aeb0: 2e67 2e2c 206d 6f76 696e 6720 4350 5520  .g., moving CPU 
+0000aec0: 5465 6e73 6f72 7320 7769 7468 0d0a 2020  Tensors with..  
+0000aed0: 2020 2320 2020 2020 7069 6e6e 6564 206d    #     pinned m
+0000aee0: 656d 6f72 7920 746f 2043 5544 4120 6465  emory to CUDA de
+0000aef0: 7669 6365 732e 0d0a 2020 2020 230d 0a20  vices...    #.. 
+0000af00: 2020 2023 2020 2020 2053 6565 2062 656c     #     See bel
+0000af10: 6f77 2066 6f72 2065 7861 6d70 6c65 732e  ow for examples.
+0000af20: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+0000af30: 2020 202e 2e20 6e6f 7465 3a3a 0d0a 2020     .. note::..  
+0000af40: 2020 2320 2020 2020 2020 2020 5468 6973    #         This
+0000af50: 206d 6574 686f 6420 6d6f 6469 6669 6573   method modifies
+0000af60: 2074 6865 206d 6f64 756c 6520 696e 2d70   the module in-p
+0000af70: 6c61 6365 2e0d 0a20 2020 2023 0d0a 2020  lace...    #..  
+0000af80: 2020 2320 2020 2020 4172 6773 3a0d 0a20    #     Args:.. 
+0000af90: 2020 2023 2020 2020 2020 2020 2064 6576     #         dev
+0000afa0: 6963 6520 283a 636c 6173 733a 6074 6f72  ice (:class:`tor
+0000afb0: 6368 2e64 6576 6963 6560 293a 2074 6865  ch.device`): the
+0000afc0: 2064 6573 6972 6564 2064 6576 6963 6520   desired device 
+0000afd0: 6f66 2074 6865 2070 6172 616d 6574 6572  of the parameter
+0000afe0: 730d 0a20 2020 2023 2020 2020 2020 2020  s..    #        
+0000aff0: 2020 2020 2061 6e64 2062 7566 6665 7273       and buffers
+0000b000: 2069 6e20 7468 6973 206d 6f64 756c 650d   in this module.
+0000b010: 0a20 2020 2023 2020 2020 2020 2020 2064  .    #         d
+0000b020: 7479 7065 2028 3a63 6c61 7373 3a60 746f  type (:class:`to
+0000b030: 7263 682e 6474 7970 6560 293a 2074 6865  rch.dtype`): the
+0000b040: 2064 6573 6972 6564 2066 6c6f 6174 696e   desired floatin
+0000b050: 6720 706f 696e 7420 6f72 2063 6f6d 706c  g point or compl
+0000b060: 6578 2064 7479 7065 206f 660d 0a20 2020  ex dtype of..   
+0000b070: 2023 2020 2020 2020 2020 2020 2020 2074   #             t
+0000b080: 6865 2070 6172 616d 6574 6572 7320 616e  he parameters an
+0000b090: 6420 6275 6666 6572 7320 696e 2074 6869  d buffers in thi
+0000b0a0: 7320 6d6f 6475 6c65 0d0a 2020 2020 2320  s module..    # 
+0000b0b0: 2020 2020 2020 2020 7465 6e73 6f72 2028          tensor (
+0000b0c0: 746f 7263 682e 5465 6e73 6f72 293a 2054  torch.Tensor): T
+0000b0d0: 656e 736f 7220 7768 6f73 6520 6474 7970  ensor whose dtyp
+0000b0e0: 6520 616e 6420 6465 7669 6365 2061 7265  e and device are
+0000b0f0: 2074 6865 2064 6573 6972 6564 0d0a 2020   the desired..  
+0000b100: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000b110: 6474 7970 6520 616e 6420 6465 7669 6365  dtype and device
+0000b120: 2066 6f72 2061 6c6c 2070 6172 616d 6574   for all paramet
+0000b130: 6572 7320 616e 6420 6275 6666 6572 7320  ers and buffers 
+0000b140: 696e 2074 6869 7320 6d6f 6475 6c65 0d0a  in this module..
+0000b150: 2020 2020 2320 2020 2020 2020 2020 6d65      #         me
+0000b160: 6d6f 7279 5f66 6f72 6d61 7420 283a 636c  mory_format (:cl
+0000b170: 6173 733a 6074 6f72 6368 2e6d 656d 6f72  ass:`torch.memor
+0000b180: 795f 666f 726d 6174 6029 3a20 7468 6520  y_format`): the 
+0000b190: 6465 7369 7265 6420 6d65 6d6f 7279 0d0a  desired memory..
+0000b1a0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000b1b0: 2020 666f 726d 6174 2066 6f72 2034 4420    format for 4D 
+0000b1c0: 7061 7261 6d65 7465 7273 2061 6e64 2062  parameters and b
+0000b1d0: 7566 6665 7273 2069 6e20 7468 6973 206d  uffers in this m
+0000b1e0: 6f64 756c 6520 286b 6579 776f 7264 0d0a  odule (keyword..
+0000b1f0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000b200: 2020 6f6e 6c79 2061 7267 756d 656e 7429    only argument)
+0000b210: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+0000b220: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
+0000b230: 2023 2020 2020 2020 2020 204d 6f64 756c   #         Modul
+0000b240: 653a 2073 656c 660d 0a20 2020 2023 0d0a  e: self..    #..
+0000b250: 2020 2020 2320 2020 2020 4578 616d 706c      #     Exampl
+0000b260: 6573 3a3a 0d0a 2020 2020 230d 0a20 2020  es::..    #..   
+0000b270: 2023 2020 2020 2020 2020 203e 3e3e 206c   #         >>> l
+0000b280: 696e 6561 7220 3d20 6e6e 2e4c 696e 6561  inear = nn.Linea
+0000b290: 7228 322c 2032 290d 0a20 2020 2023 2020  r(2, 2)..    #  
+0000b2a0: 2020 2020 2020 203e 3e3e 206c 696e 6561         >>> linea
+0000b2b0: 722e 7765 6967 6874 0d0a 2020 2020 2320  r.weight..    # 
+0000b2c0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0000b2d0: 7220 636f 6e74 6169 6e69 6e67 3a0d 0a20  r containing:.. 
+0000b2e0: 2020 2023 2020 2020 2020 2020 2074 656e     #         ten
+0000b2f0: 736f 7228 5b5b 2030 2e31 3931 332c 202d  sor([[ 0.1913, -
+0000b300: 302e 3334 3230 5d2c 0d0a 2020 2020 2320  0.3420],..    # 
+0000b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b320: 5b2d 302e 3531 3133 2c20 2d30 2e32 3332  [-0.5113, -0.232
+0000b330: 355d 5d29 0d0a 2020 2020 2320 2020 2020  5]])..    #     
+0000b340: 2020 2020 3e3e 3e20 6c69 6e65 6172 2e74      >>> linear.t
+0000b350: 6f28 746f 7263 682e 646f 7562 6c65 290d  o(torch.double).
+0000b360: 0a20 2020 2023 2020 2020 2020 2020 204c  .    #         L
+0000b370: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
+0000b380: 733d 322c 206f 7574 5f66 6561 7475 7265  s=2, out_feature
+0000b390: 733d 322c 2062 6961 733d 5472 7565 290d  s=2, bias=True).
+0000b3a0: 0a20 2020 2023 2020 2020 2020 2020 203e  .    #         >
+0000b3b0: 3e3e 206c 696e 6561 722e 7765 6967 6874  >> linear.weight
+0000b3c0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+0000b3d0: 5061 7261 6d65 7465 7220 636f 6e74 6169  Parameter contai
+0000b3e0: 6e69 6e67 3a0d 0a20 2020 2023 2020 2020  ning:..    #    
+0000b3f0: 2020 2020 2074 656e 736f 7228 5b5b 2030       tensor([[ 0
+0000b400: 2e31 3931 332c 202d 302e 3334 3230 5d2c  .1913, -0.3420],
+0000b410: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+0000b420: 2020 2020 2020 2020 5b2d 302e 3531 3133          [-0.5113
+0000b430: 2c20 2d30 2e32 3332 355d 5d2c 2064 7479  , -0.2325]], dty
+0000b440: 7065 3d74 6f72 6368 2e66 6c6f 6174 3634  pe=torch.float64
+0000b450: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+0000b460: 203e 3e3e 2067 7075 3120 3d20 746f 7263   >>> gpu1 = torc
+0000b470: 682e 6465 7669 6365 2822 6375 6461 3a31  h.device("cuda:1
+0000b480: 2229 0d0a 2020 2020 2320 2020 2020 2020  ")..    #       
+0000b490: 2020 3e3e 3e20 6c69 6e65 6172 2e74 6f28    >>> linear.to(
+0000b4a0: 6770 7531 2c20 6474 7970 653d 746f 7263  gpu1, dtype=torc
+0000b4b0: 682e 6861 6c66 2c20 6e6f 6e5f 626c 6f63  h.half, non_bloc
+0000b4c0: 6b69 6e67 3d54 7275 6529 0d0a 2020 2020  king=True)..    
+0000b4d0: 2320 2020 2020 2020 2020 4c69 6e65 6172  #         Linear
+0000b4e0: 2869 6e5f 6665 6174 7572 6573 3d32 2c20  (in_features=2, 
+0000b4f0: 6f75 745f 6665 6174 7572 6573 3d32 2c20  out_features=2, 
+0000b500: 6269 6173 3d54 7275 6529 0d0a 2020 2020  bias=True)..    
+0000b510: 2320 2020 2020 2020 2020 3e3e 3e20 6c69  #         >>> li
+0000b520: 6e65 6172 2e77 6569 6768 740d 0a20 2020  near.weight..   
+0000b530: 2023 2020 2020 2020 2020 2050 6172 616d   #         Param
+0000b540: 6574 6572 2063 6f6e 7461 696e 696e 673a  eter containing:
+0000b550: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+0000b560: 7465 6e73 6f72 285b 5b20 302e 3139 3134  tensor([[ 0.1914
+0000b570: 2c20 2d30 2e33 3432 305d 2c0d 0a20 2020  , -0.3420],..   
+0000b580: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b590: 2020 205b 2d30 2e35 3131 322c 202d 302e     [-0.5112, -0.
+0000b5a0: 3233 3234 5d5d 2c20 6474 7970 653d 746f  2324]], dtype=to
+0000b5b0: 7263 682e 666c 6f61 7431 362c 2064 6576  rch.float16, dev
+0000b5c0: 6963 653d 2763 7564 613a 3127 290d 0a20  ice='cuda:1').. 
+0000b5d0: 2020 2023 2020 2020 2020 2020 203e 3e3e     #         >>>
+0000b5e0: 2063 7075 203d 2074 6f72 6368 2e64 6576   cpu = torch.dev
+0000b5f0: 6963 6528 2263 7075 2229 0d0a 2020 2020  ice("cpu")..    
+0000b600: 2320 2020 2020 2020 2020 3e3e 3e20 6c69  #         >>> li
+0000b610: 6e65 6172 2e74 6f28 6370 7529 0d0a 2020  near.to(cpu)..  
+0000b620: 2020 2320 2020 2020 2020 2020 4c69 6e65    #         Line
+0000b630: 6172 2869 6e5f 6665 6174 7572 6573 3d32  ar(in_features=2
+0000b640: 2c20 6f75 745f 6665 6174 7572 6573 3d32  , out_features=2
+0000b650: 2c20 6269 6173 3d54 7275 6529 0d0a 2020  , bias=True)..  
+0000b660: 2020 2320 2020 2020 2020 2020 3e3e 3e20    #         >>> 
+0000b670: 6c69 6e65 6172 2e77 6569 6768 740d 0a20  linear.weight.. 
+0000b680: 2020 2023 2020 2020 2020 2020 2050 6172     #         Par
+0000b690: 616d 6574 6572 2063 6f6e 7461 696e 696e  ameter containin
+0000b6a0: 673a 0d0a 2020 2020 2320 2020 2020 2020  g:..    #       
+0000b6b0: 2020 7465 6e73 6f72 285b 5b20 302e 3139    tensor([[ 0.19
+0000b6c0: 3134 2c20 2d30 2e33 3432 305d 2c0d 0a20  14, -0.3420],.. 
+0000b6d0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000b6e0: 2020 2020 205b 2d30 2e35 3131 322c 202d       [-0.5112, -
+0000b6f0: 302e 3233 3234 5d5d 2c20 6474 7970 653d  0.2324]], dtype=
+0000b700: 746f 7263 682e 666c 6f61 7431 3629 0d0a  torch.float16)..
+0000b710: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
+0000b720: 2020 2020 203e 3e3e 206c 696e 6561 7220       >>> linear 
+0000b730: 3d20 6e6e 2e4c 696e 6561 7228 322c 2032  = nn.Linear(2, 2
+0000b740: 2c20 6269 6173 3d4e 6f6e 6529 2e74 6f28  , bias=None).to(
+0000b750: 746f 7263 682e 6364 6f75 626c 6529 0d0a  torch.cdouble)..
+0000b760: 2020 2020 2320 2020 2020 2020 2020 3e3e      #         >>
+0000b770: 3e20 6c69 6e65 6172 2e77 6569 6768 740d  > linear.weight.
+0000b780: 0a20 2020 2023 2020 2020 2020 2020 2050  .    #         P
+0000b790: 6172 616d 6574 6572 2063 6f6e 7461 696e  arameter contain
+0000b7a0: 696e 673a 0d0a 2020 2020 2320 2020 2020  ing:..    #     
+0000b7b0: 2020 2020 7465 6e73 6f72 285b 5b20 302e      tensor([[ 0.
+0000b7c0: 3337 3431 2b30 2e6a 2c20 2030 2e32 3338  3741+0.j,  0.238
+0000b7d0: 322b 302e 6a5d 2c0d 0a20 2020 2023 2020  2+0.j],..    #  
+0000b7e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0000b7f0: 2030 2e35 3539 332b 302e 6a2c 202d 302e   0.5593+0.j, -0.
+0000b800: 3434 3433 2b30 2e6a 5d5d 2c20 6474 7970  4443+0.j]], dtyp
+0000b810: 653d 746f 7263 682e 636f 6d70 6c65 7831  e=torch.complex1
+0000b820: 3238 290d 0a20 2020 2023 2020 2020 2020  28)..    #      
+0000b830: 2020 203e 3e3e 206c 696e 6561 7228 746f     >>> linear(to
+0000b840: 7263 682e 6f6e 6573 2833 2c20 322c 2064  rch.ones(3, 2, d
+0000b850: 7479 7065 3d74 6f72 6368 2e63 646f 7562  type=torch.cdoub
+0000b860: 6c65 2929 0d0a 2020 2020 2320 2020 2020  le))..    #     
+0000b870: 2020 2020 7465 6e73 6f72 285b 5b30 2e36      tensor([[0.6
+0000b880: 3132 322b 302e 6a2c 2030 2e31 3135 302b  122+0.j, 0.1150+
+0000b890: 302e 6a5d 2c0d 0a20 2020 2023 2020 2020  0.j],..    #    
+0000b8a0: 2020 2020 2020 2020 2020 2020 205b 302e               [0.
+0000b8b0: 3631 3232 2b30 2e6a 2c20 302e 3131 3530  6122+0.j, 0.1150
+0000b8c0: 2b30 2e6a 5d2c 0d0a 2020 2020 2320 2020  +0.j],..    #   
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 5b30                [0
+0000b8e0: 2e36 3132 322b 302e 6a2c 2030 2e31 3135  .6122+0.j, 0.115
+0000b8f0: 302b 302e 6a5d 5d2c 2064 7479 7065 3d74  0+0.j]], dtype=t
+0000b900: 6f72 6368 2e63 6f6d 706c 6578 3132 3829  orch.complex128)
+0000b910: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+0000b920: 2020 2022 2222 0d0a 2020 2020 230d 0a20     """..    #.. 
+0000b930: 2020 2023 2020 2020 2064 6576 6963 652c     #     device,
+0000b940: 2064 7479 7065 2c20 6e6f 6e5f 626c 6f63   dtype, non_bloc
+0000b950: 6b69 6e67 2c20 636f 6e76 6572 745f 746f  king, convert_to
+0000b960: 5f66 6f72 6d61 7420 3d20 746f 7263 682e  _format = torch.
+0000b970: 5f43 2e5f 6e6e 2e5f 7061 7273 655f 746f  _C._nn._parse_to
+0000b980: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+0000b990: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
+0000b9a0: 2020 2020 6966 2064 7479 7065 2069 7320      if dtype is 
+0000b9b0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2023  not None:..    #
+0000b9c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000b9d0: 2864 7479 7065 2e69 735f 666c 6f61 7469  (dtype.is_floati
+0000b9e0: 6e67 5f70 6f69 6e74 206f 7220 6474 7970  ng_point or dtyp
+0000b9f0: 652e 6973 5f63 6f6d 706c 6578 293a 0d0a  e.is_complex):..
+0000ba00: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000ba10: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0000ba20: 7228 276e 6e2e 4d6f 6475 6c65 2e74 6f20  r('nn.Module.to 
+0000ba30: 6f6e 6c79 2061 6363 6570 7473 2066 6c6f  only accepts flo
+0000ba40: 6174 696e 6720 706f 696e 7420 6f72 2063  ating point or c
+0000ba50: 6f6d 706c 6578 2027 0d0a 2020 2020 2320  omplex '..    # 
 0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba70: 2027 6474 7970 6573 2c20 6275 7420 676f   'dtypes, but go
-0000ba80: 7420 6465 7369 7265 6420 6474 7970 653d  t desired dtype=
-0000ba90: 7b7d 272e 666f 726d 6174 2864 7479 7065  {}'.format(dtype
-0000baa0: 2929 0d0a 2020 2020 2320 2020 2020 2020  ))..    #       
-0000bab0: 2020 6966 2064 7479 7065 2e69 735f 636f    if dtype.is_co
-0000bac0: 6d70 6c65 783a 0d0a 2020 2020 2320 2020  mplex:..    #   
-0000bad0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000bae0: 6773 2e77 6172 6e28 0d0a 2020 2020 2320  gs.warn(..    # 
-0000baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb00: 2243 6f6d 706c 6578 206d 6f64 756c 6573  "Complex modules
-0000bb10: 2061 7265 2061 206e 6577 2066 6561 7475   are a new featu
-0000bb20: 7265 2075 6e64 6572 2061 6374 6976 6520  re under active 
-0000bb30: 6465 7665 6c6f 706d 656e 7420 7768 6f73  development whos
-0000bb40: 6520 6465 7369 676e 206d 6179 2063 6861  e design may cha
-0000bb50: 6e67 652c 2022 0d0a 2020 2020 2320 2020  nge, "..    #   
-0000bb60: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-0000bb70: 6e64 2073 6f6d 6520 6d6f 6475 6c65 7320  nd some modules 
-0000bb80: 6d69 6768 7420 6e6f 7420 776f 726b 2061  might not work a
-0000bb90: 7320 6578 7065 6374 6564 2077 6865 6e20  s expected when 
-0000bba0: 7573 696e 6720 636f 6d70 6c65 7820 7465  using complex te
-0000bbb0: 6e73 6f72 7320 6173 2070 6172 616d 6574  nsors as paramet
-0000bbc0: 6572 7320 6f72 2062 7566 6665 7273 2e20  ers or buffers. 
-0000bbd0: 220d 0a20 2020 2023 2020 2020 2020 2020  "..    #        
-0000bbe0: 2020 2020 2020 2020 2022 506c 6561 7365           "Please
-0000bbf0: 2066 696c 6520 616e 2069 7373 7565 2061   file an issue a
-0000bc00: 7420 6874 7470 733a 2f2f 6769 7468 7562  t https://github
-0000bc10: 2e63 6f6d 2f70 7974 6f72 6368 2f70 7974  .com/pytorch/pyt
-0000bc20: 6f72 6368 2f69 7373 7565 732f 6e65 773f  orch/issues/new?
-0000bc30: 7465 6d70 6c61 7465 3d62 7567 2d72 6570  template=bug-rep
-0000bc40: 6f72 742e 6d64 2022 0d0a 2020 2020 2320  ort.md "..    # 
-0000bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc60: 2269 6620 6120 636f 6d70 6c65 7820 6d6f  "if a complex mo
-0000bc70: 6475 6c65 2064 6f65 7320 6e6f 7420 776f  dule does not wo
-0000bc80: 726b 2061 7320 6578 7065 6374 6564 2e22  rk as expected."
-0000bc90: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
-0000bca0: 2020 2020 6465 6620 636f 6e76 6572 7428      def convert(
-0000bcb0: 7429 3a0d 0a20 2020 2023 2020 2020 2020  t):..    #      
-0000bcc0: 2020 2069 6620 636f 6e76 6572 745f 746f     if convert_to
-0000bcd0: 5f66 6f72 6d61 7420 6973 206e 6f74 204e  _format is not N
-0000bce0: 6f6e 6520 616e 6420 742e 6469 6d28 2920  one and t.dim() 
-0000bcf0: 696e 2028 342c 2035 293a 0d0a 2020 2020  in (4, 5):..    
-0000bd00: 2320 2020 2020 2020 2020 2020 2020 7265  #             re
-0000bd10: 7475 726e 2074 2e74 6f28 6465 7669 6365  turn t.to(device
-0000bd20: 2c20 6474 7970 6520 6966 2074 2e69 735f  , dtype if t.is_
-0000bd30: 666c 6f61 7469 6e67 5f70 6f69 6e74 2829  floating_point()
-0000bd40: 206f 7220 742e 6973 5f63 6f6d 706c 6578   or t.is_complex
-0000bd50: 2829 2065 6c73 6520 4e6f 6e65 2c0d 0a20  () else None,.. 
-0000bd60: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000bd70: 2020 2020 2020 2020 2020 2020 206e 6f6e               non
-0000bd80: 5f62 6c6f 636b 696e 672c 206d 656d 6f72  _blocking, memor
-0000bd90: 795f 666f 726d 6174 3d63 6f6e 7665 7274  y_format=convert
-0000bda0: 5f74 6f5f 666f 726d 6174 290d 0a20 2020  _to_format)..   
-0000bdb0: 2023 2020 2020 2020 2020 2072 6574 7572   #         retur
-0000bdc0: 6e20 742e 746f 2864 6576 6963 652c 2064  n t.to(device, d
-0000bdd0: 7479 7065 2069 6620 742e 6973 5f66 6c6f  type if t.is_flo
-0000bde0: 6174 696e 675f 706f 696e 7428 2920 6f72  ating_point() or
-0000bdf0: 2074 2e69 735f 636f 6d70 6c65 7828 2920   t.is_complex() 
-0000be00: 656c 7365 204e 6f6e 652c 206e 6f6e 5f62  else None, non_b
-0000be10: 6c6f 636b 696e 6729 0d0a 2020 2020 230d  locking)..    #.
-0000be20: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
-0000be30: 6e20 7365 6c66 2e5f 6170 706c 7928 636f  n self._apply(co
-0000be40: 6e76 6572 7429 0d0a 0d0a 0d0a 2020 2020  nvert)......    
-0000be50: 6465 6620 7265 6769 7374 6572 5f66 756c  def register_ful
-0000be60: 6c5f 6261 636b 7761 7264 5f70 7265 5f68  l_backward_pre_h
-0000be70: 6f6f 6b28 0d0a 2020 2020 2020 2020 7365  ook(..        se
-0000be80: 6c66 2c0d 0a20 2020 2020 2020 2068 6f6f  lf,..        hoo
-0000be90: 6b3a 2043 616c 6c61 626c 655b 5b22 4d6f  k: Callable[["Mo
-0000bea0: 6475 6c65 222c 205f 6772 6164 5f74 5d2c  dule", _grad_t],
-0000beb0: 2055 6e69 6f6e 5b4e 6f6e 652c 205f 6772   Union[None, _gr
-0000bec0: 6164 5f74 5d5d 2c0d 0a20 2020 2020 2020  ad_t]],..       
-0000bed0: 2070 7265 7065 6e64 3a20 626f 6f6c 203d   prepend: bool =
-0000bee0: 2046 616c 7365 2c0d 0a20 2020 2029 202d   False,..    ) -
-0000bef0: 3e20 5265 6d6f 7661 626c 6548 616e 646c  > RemovableHandl
-0000bf00: 653a 0d0a 2020 2020 2020 2020 7222 2222  e:..        r"""
-0000bf10: 5265 6769 7374 6572 7320 6120 6261 636b  Registers a back
-0000bf20: 7761 7264 2070 7265 2d68 6f6f 6b20 6f6e  ward pre-hook on
-0000bf30: 2074 6865 206d 6f64 756c 652e 0d0a 0d0a   the module.....
-0000bf40: 2020 2020 2020 2020 5468 6520 686f 6f6b          The hook
-0000bf50: 2077 696c 6c20 6265 2063 616c 6c65 6420   will be called 
-0000bf60: 6576 6572 7920 7469 6d65 2074 6865 2067  every time the g
-0000bf70: 7261 6469 656e 7473 2066 6f72 2074 6865  radients for the
-0000bf80: 206d 6f64 756c 6520 6172 6520 636f 6d70   module are comp
-0000bf90: 7574 6564 2e0d 0a20 2020 2020 2020 2054  uted...        T
-0000bfa0: 6865 2068 6f6f 6b20 7368 6f75 6c64 2068  he hook should h
-0000bfb0: 6176 6520 7468 6520 666f 6c6c 6f77 696e  ave the followin
-0000bfc0: 6720 7369 676e 6174 7572 653a 3a0d 0a0d  g signature::...
-0000bfd0: 0a20 2020 2020 2020 2020 2020 2068 6f6f  .            hoo
-0000bfe0: 6b28 6d6f 6475 6c65 2c20 6772 6164 5f6f  k(module, grad_o
-0000bff0: 7574 7075 7429 202d 3e20 5465 6e73 6f72  utput) -> Tensor
-0000c000: 206f 7220 4e6f 6e65 0d0a 0d0a 2020 2020   or None....    
-0000c010: 2020 2020 5468 6520 3a61 7474 723a 6067      The :attr:`g
-0000c020: 7261 645f 6f75 7470 7574 6020 6973 2061  rad_output` is a
-0000c030: 2074 7570 6c65 2e20 5468 6520 686f 6f6b   tuple. The hook
-0000c040: 2073 686f 756c 640d 0a20 2020 2020 2020   should..       
-0000c050: 206e 6f74 206d 6f64 6966 7920 6974 7320   not modify its 
-0000c060: 6172 6775 6d65 6e74 732c 2062 7574 2069  arguments, but i
-0000c070: 7420 6361 6e20 6f70 7469 6f6e 616c 6c79  t can optionally
-0000c080: 2072 6574 7572 6e20 6120 6e65 7720 6772   return a new gr
-0000c090: 6164 6965 6e74 2077 6974 680d 0a20 2020  adient with..   
-0000c0a0: 2020 2020 2072 6573 7065 6374 2074 6f20       respect to 
-0000c0b0: 7468 6520 6f75 7470 7574 2074 6861 7420  the output that 
-0000c0c0: 7769 6c6c 2062 6520 7573 6564 2069 6e20  will be used in 
-0000c0d0: 706c 6163 6520 6f66 203a 6174 7472 3a60  place of :attr:`
-0000c0e0: 6772 6164 5f6f 7574 7075 7460 2069 6e0d  grad_output` in.
-0000c0f0: 0a20 2020 2020 2020 2073 7562 7365 7175  .        subsequ
-0000c100: 656e 7420 636f 6d70 7574 6174 696f 6e73  ent computations
-0000c110: 2e20 456e 7472 6965 7320 696e 203a 6174  . Entries in :at
-0000c120: 7472 3a60 6772 6164 5f6f 7574 7075 7460  tr:`grad_output`
-0000c130: 2077 696c 6c20 6265 2060 604e 6f6e 6560   will be ``None`
-0000c140: 6020 666f 720d 0a20 2020 2020 2020 2061  ` for..        a
-0000c150: 6c6c 206e 6f6e 2d54 656e 736f 7220 6172  ll non-Tensor ar
-0000c160: 6775 6d65 6e74 732e 0d0a 0d0a 2020 2020  guments.....    
-0000c170: 2020 2020 466f 7220 7465 6368 6e69 6361      For technica
-0000c180: 6c20 7265 6173 6f6e 732c 2077 6865 6e20  l reasons, when 
-0000c190: 7468 6973 2068 6f6f 6b20 6973 2061 7070  this hook is app
-0000c1a0: 6c69 6564 2074 6f20 6120 4d6f 6475 6c65  lied to a Module
-0000c1b0: 2c20 6974 7320 666f 7277 6172 6420 6675  , its forward fu
-0000c1c0: 6e63 7469 6f6e 2077 696c 6c0d 0a20 2020  nction will..   
-0000c1d0: 2020 2020 2072 6563 6569 7665 2061 2076       receive a v
-0000c1e0: 6965 7720 6f66 2065 6163 6820 5465 6e73  iew of each Tens
-0000c1f0: 6f72 2070 6173 7365 6420 746f 2074 6865  or passed to the
-0000c200: 204d 6f64 756c 652e 2053 696d 696c 6172   Module. Similar
-0000c210: 6c79 2074 6865 2063 616c 6c65 7220 7769  ly the caller wi
-0000c220: 6c6c 2072 6563 6569 7665 2061 2076 6965  ll receive a vie
-0000c230: 770d 0a20 2020 2020 2020 206f 6620 6561  w..        of ea
-0000c240: 6368 2054 656e 736f 7220 7265 7475 726e  ch Tensor return
-0000c250: 6564 2062 7920 7468 6520 4d6f 6475 6c65  ed by the Module
-0000c260: 2773 2066 6f72 7761 7264 2066 756e 6374  's forward funct
-0000c270: 696f 6e2e 0d0a 0d0a 2020 2020 2020 2020  ion.....        
-0000c280: 2e2e 2077 6172 6e69 6e67 203a 3a0d 0a20  .. warning ::.. 
-0000c290: 2020 2020 2020 2020 2020 204d 6f64 6966             Modif
-0000c2a0: 7969 6e67 2069 6e70 7574 7320 696e 706c  ying inputs inpl
-0000c2b0: 6163 6520 6973 206e 6f74 2061 6c6c 6f77  ace is not allow
-0000c2c0: 6564 2077 6865 6e20 7573 696e 6720 6261  ed when using ba
-0000c2d0: 636b 7761 7264 2068 6f6f 6b73 2061 6e64  ckward hooks and
-0000c2e0: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
-0000c2f0: 6c6c 2072 6169 7365 2061 6e20 6572 726f  ll raise an erro
-0000c300: 722e 0d0a 0d0a 2020 2020 2020 2020 4172  r.....        Ar
-0000c310: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-0000c320: 2068 6f6f 6b20 2843 616c 6c61 626c 6529   hook (Callable)
-0000c330: 3a20 5468 6520 7573 6572 2d64 6566 696e  : The user-defin
-0000c340: 6564 2068 6f6f 6b20 746f 2062 6520 7265  ed hook to be re
-0000c350: 6769 7374 6572 6564 2e0d 0a20 2020 2020  gistered...     
-0000c360: 2020 2020 2020 2070 7265 7065 6e64 2028         prepend (
-0000c370: 626f 6f6c 293a 2049 6620 7472 7565 2c20  bool): If true, 
-0000c380: 7468 6520 7072 6f76 6964 6564 2060 6068  the provided ``h
-0000c390: 6f6f 6b60 6020 7769 6c6c 2062 6520 6669  ook`` will be fi
-0000c3a0: 7265 6420 6265 666f 7265 0d0a 2020 2020  red before..    
-0000c3b0: 2020 2020 2020 2020 2020 2020 616c 6c20              all 
-0000c3c0: 6578 6973 7469 6e67 2060 6062 6163 6b77  existing ``backw
-0000c3d0: 6172 645f 7072 6560 6020 686f 6f6b 7320  ard_pre`` hooks 
-0000c3e0: 6f6e 2074 6869 730d 0a20 2020 2020 2020  on this..       
-0000c3f0: 2020 2020 2020 2020 203a 636c 6173 733a           :class:
-0000c400: 6074 6f72 6368 2e6e 6e2e 6d6f 6475 6c65  `torch.nn.module
-0000c410: 732e 4d6f 6475 6c65 602e 204f 7468 6572  s.Module`. Other
-0000c420: 7769 7365 2c20 7468 6520 7072 6f76 6964  wise, the provid
-0000c430: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
-0000c440: 2020 2020 6060 686f 6f6b 6060 2077 696c      ``hook`` wil
-0000c450: 6c20 6265 2066 6972 6564 2061 6674 6572  l be fired after
-0000c460: 2061 6c6c 2065 7869 7374 696e 6720 6060   all existing ``
-0000c470: 6261 636b 7761 7264 5f70 7265 6060 2068  backward_pre`` h
-0000c480: 6f6f 6b73 0d0a 2020 2020 2020 2020 2020  ooks..          
-0000c490: 2020 2020 2020 6f6e 2074 6869 7320 3a63        on this :c
-0000c4a0: 6c61 7373 3a60 746f 7263 682e 6e6e 2e6d  lass:`torch.nn.m
-0000c4b0: 6f64 756c 6573 2e4d 6f64 756c 6560 2e20  odules.Module`. 
-0000c4c0: 4e6f 7465 2074 6861 7420 676c 6f62 616c  Note that global
-0000c4d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c4e0: 2020 6060 6261 636b 7761 7264 5f70 7265    ``backward_pre
-0000c4f0: 6060 2068 6f6f 6b73 2072 6567 6973 7465  `` hooks registe
-0000c500: 7265 6420 7769 7468 0d0a 2020 2020 2020  red with..      
-0000c510: 2020 2020 2020 2020 2020 3a66 756e 633a            :func:
-0000c520: 6072 6567 6973 7465 725f 6d6f 6475 6c65  `register_module
-0000c530: 5f66 756c 6c5f 6261 636b 7761 7264 5f70  _full_backward_p
-0000c540: 7265 5f68 6f6f 6b60 2077 696c 6c20 6669  re_hook` will fi
-0000c550: 7265 2062 6566 6f72 650d 0a20 2020 2020  re before..     
-0000c560: 2020 2020 2020 2020 2020 2061 6c6c 2068             all h
-0000c570: 6f6f 6b73 2072 6567 6973 7465 7265 6420  ooks registered 
-0000c580: 6279 2074 6869 7320 6d65 7468 6f64 2e0d  by this method..
-0000c590: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000c5a0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-0000c5b0: 203a 636c 6173 733a 6074 6f72 6368 2e75   :class:`torch.u
-0000c5c0: 7469 6c73 2e68 6f6f 6b73 2e52 656d 6f76  tils.hooks.Remov
-0000c5d0: 6162 6c65 4861 6e64 6c65 603a 0d0a 2020  ableHandle`:..  
-0000c5e0: 2020 2020 2020 2020 2020 2020 2020 6120                a 
-0000c5f0: 6861 6e64 6c65 2074 6861 7420 6361 6e20  handle that can 
-0000c600: 6265 2075 7365 6420 746f 2072 656d 6f76  be used to remov
-0000c610: 6520 7468 6520 6164 6465 6420 686f 6f6b  e the added hook
-0000c620: 2062 7920 6361 6c6c 696e 670d 0a20 2020   by calling..   
-0000c630: 2020 2020 2020 2020 2020 2020 2060 6068               ``h
-0000c640: 616e 646c 652e 7265 6d6f 7665 2829 6060  andle.remove()``
-0000c650: 0d0a 0d0a 2020 2020 2020 2020 2222 220d  ....        """.
-0000c660: 0a20 2020 2020 2020 2068 616e 646c 6520  .        handle 
-0000c670: 3d52 656d 6f76 6162 6c65 4861 6e64 6c65  =RemovableHandle
-0000c680: 2873 656c 662e 5f62 6163 6b77 6172 645f  (self._backward_
-0000c690: 7072 655f 686f 6f6b 7329 0d0a 2020 2020  pre_hooks)..    
-0000c6a0: 2020 2020 7365 6c66 2e5f 6261 636b 7761      self._backwa
-0000c6b0: 7264 5f70 7265 5f68 6f6f 6b73 5b68 616e  rd_pre_hooks[han
-0000c6c0: 646c 652e 6964 5d20 3d20 686f 6f6b 0d0a  dle.id] = hook..
-0000c6d0: 2020 2020 2020 2020 6966 2070 7265 7065          if prepe
-0000c6e0: 6e64 3a0d 0a20 2020 2020 2020 2020 2020  nd:..           
-0000c6f0: 2073 656c 662e 5f62 6163 6b77 6172 645f   self._backward_
-0000c700: 7072 655f 686f 6f6b 732e 6d6f 7665 5f74  pre_hooks.move_t
-0000c710: 6f5f 656e 6428 6861 6e64 6c65 2e69 642c  o_end(handle.id,
-0000c720: 206c 6173 743d 4661 6c73 6529 2020 2320   last=False)  # 
-0000c730: 7479 7065 3a20 6967 6e6f 7265 5b61 7474  type: ignore[att
-0000c740: 722d 6465 6669 6e65 645d 0d0a 2020 2020  r-defined]..    
-0000c750: 2020 2020 7265 7475 726e 2068 616e 646c      return handl
-0000c760: 650d 0a0d 0a20 2020 2064 6566 2072 6567  e....    def reg
-0000c770: 6973 7465 725f 6261 636b 7761 7264 5f68  ister_backward_h
-0000c780: 6f6f 6b28 0d0a 2020 2020 2020 2020 7365  ook(..        se
-0000c790: 6c66 2c20 686f 6f6b 3a20 4361 6c6c 6162  lf, hook: Callab
-0000c7a0: 6c65 5b5b 274d 6f64 756c 6527 2c20 5f67  le[['Module', _g
-0000c7b0: 7261 645f 742c 205f 6772 6164 5f74 5d2c  rad_t, _grad_t],
-0000c7c0: 2055 6e69 6f6e 5b4e 6f6e 652c 205f 6772   Union[None, _gr
-0000c7d0: 6164 5f74 5d5d 0d0a 2020 2020 2920 2d3e  ad_t]]..    ) ->
-0000c7e0: 2052 656d 6f76 6162 6c65 4861 6e64 6c65   RemovableHandle
-0000c7f0: 3a0d 0a20 2020 2020 2020 2072 2222 2252  :..        r"""R
-0000c800: 6567 6973 7465 7273 2061 2062 6163 6b77  egisters a backw
-0000c810: 6172 6420 686f 6f6b 206f 6e20 7468 6520  ard hook on the 
-0000c820: 6d6f 6475 6c65 2e0d 0a0d 0a20 2020 2020  module.....     
-0000c830: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
-0000c840: 2069 7320 6465 7072 6563 6174 6564 2069   is deprecated i
-0000c850: 6e20 6661 766f 7220 6f66 203a 6d65 7468  n favor of :meth
-0000c860: 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f 6475  :`~torch.nn.Modu
-0000c870: 6c65 2e72 6567 6973 7465 725f 6675 6c6c  le.register_full
-0000c880: 5f62 6163 6b77 6172 645f 686f 6f6b 6020  _backward_hook` 
-0000c890: 616e 640d 0a20 2020 2020 2020 2074 6865  and..        the
-0000c8a0: 2062 6568 6176 696f 7220 6f66 2074 6869   behavior of thi
-0000c8b0: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
-0000c8c0: 6368 616e 6765 2069 6e20 6675 7475 7265  change in future
-0000c8d0: 2076 6572 7369 6f6e 732e 0d0a 0d0a 2020   versions.....  
-0000c8e0: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
-0000c8f0: 2020 2020 2020 2020 2020 2020 3a63 6c61              :cla
-0000c900: 7373 3a60 746f 7263 682e 7574 696c 732e  ss:`torch.utils.
-0000c910: 686f 6f6b 732e 5265 6d6f 7661 626c 6548  hooks.RemovableH
-0000c920: 616e 646c 6560 3a0d 0a20 2020 2020 2020  andle`:..       
-0000c930: 2020 2020 2020 2020 2061 2068 616e 646c           a handl
-0000c940: 6520 7468 6174 2063 616e 2062 6520 7573  e that can be us
-0000c950: 6564 2074 6f20 7265 6d6f 7665 2074 6865  ed to remove the
-0000c960: 2061 6464 6564 2068 6f6f 6b20 6279 2063   added hook by c
-0000c970: 616c 6c69 6e67 0d0a 2020 2020 2020 2020  alling..        
-0000c980: 2020 2020 2020 2020 6060 6861 6e64 6c65          ``handle
-0000c990: 2e72 656d 6f76 6528 2960 600d 0a0d 0a20  .remove()``.... 
-0000c9a0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0000c9b0: 2020 2020 6966 2073 656c 662e 5f69 735f      if self._is_
-0000c9c0: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
-0000c9d0: 6f6b 2069 7320 5472 7565 3a0d 0a20 2020  ok is True:..   
-0000c9e0: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-0000c9f0: 756e 7469 6d65 4572 726f 7228 2243 616e  untimeError("Can
-0000ca00: 6e6f 7420 7573 6520 626f 7468 2072 6567  not use both reg
-0000ca10: 756c 6172 2062 6163 6b77 6172 6420 686f  ular backward ho
-0000ca20: 6f6b 7320 616e 6420 6675 6c6c 2062 6163  oks and full bac
-0000ca30: 6b77 6172 6420 686f 6f6b 7320 6f6e 2061  kward hooks on a
-0000ca40: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+0000ba70: 2020 2020 2020 2020 2020 2020 2764 7479              'dty
+0000ba80: 7065 732c 2062 7574 2067 6f74 2064 6573  pes, but got des
+0000ba90: 6972 6564 2064 7479 7065 3d7b 7d27 2e66  ired dtype={}'.f
+0000baa0: 6f72 6d61 7428 6474 7970 6529 290d 0a20  ormat(dtype)).. 
+0000bab0: 2020 2023 2020 2020 2020 2020 2069 6620     #         if 
+0000bac0: 6474 7970 652e 6973 5f63 6f6d 706c 6578  dtype.is_complex
+0000bad0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
+0000bae0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+0000baf0: 726e 280d 0a20 2020 2023 2020 2020 2020  rn(..    #      
+0000bb00: 2020 2020 2020 2020 2020 2022 436f 6d70             "Comp
+0000bb10: 6c65 7820 6d6f 6475 6c65 7320 6172 6520  lex modules are 
+0000bb20: 6120 6e65 7720 6665 6174 7572 6520 756e  a new feature un
+0000bb30: 6465 7220 6163 7469 7665 2064 6576 656c  der active devel
+0000bb40: 6f70 6d65 6e74 2077 686f 7365 2064 6573  opment whose des
+0000bb50: 6967 6e20 6d61 7920 6368 616e 6765 2c20  ign may change, 
+0000bb60: 220d 0a20 2020 2023 2020 2020 2020 2020  "..    #        
+0000bb70: 2020 2020 2020 2020 2022 616e 6420 736f           "and so
+0000bb80: 6d65 206d 6f64 756c 6573 206d 6967 6874  me modules might
+0000bb90: 206e 6f74 2077 6f72 6b20 6173 2065 7870   not work as exp
+0000bba0: 6563 7465 6420 7768 656e 2075 7369 6e67  ected when using
+0000bbb0: 2063 6f6d 706c 6578 2074 656e 736f 7273   complex tensors
+0000bbc0: 2061 7320 7061 7261 6d65 7465 7273 206f   as parameters o
+0000bbd0: 7220 6275 6666 6572 732e 2022 0d0a 2020  r buffers. "..  
+0000bbe0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000bbf0: 2020 2020 2250 6c65 6173 6520 6669 6c65      "Please file
+0000bc00: 2061 6e20 6973 7375 6520 6174 2068 7474   an issue at htt
+0000bc10: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0000bc20: 7079 746f 7263 682f 7079 746f 7263 682f  pytorch/pytorch/
+0000bc30: 6973 7375 6573 2f6e 6577 3f74 656d 706c  issues/new?templ
+0000bc40: 6174 653d 6275 672d 7265 706f 7274 2e6d  ate=bug-report.m
+0000bc50: 6420 220d 0a20 2020 2023 2020 2020 2020  d "..    #      
+0000bc60: 2020 2020 2020 2020 2020 2022 6966 2061             "if a
+0000bc70: 2063 6f6d 706c 6578 206d 6f64 756c 6520   complex module 
+0000bc80: 646f 6573 206e 6f74 2077 6f72 6b20 6173  does not work as
+0000bc90: 2065 7870 6563 7465 642e 2229 0d0a 2020   expected.")..  
+0000bca0: 2020 230d 0a20 2020 2023 2020 2020 2064    #..    #     d
+0000bcb0: 6566 2063 6f6e 7665 7274 2874 293a 0d0a  ef convert(t):..
+0000bcc0: 2020 2020 2320 2020 2020 2020 2020 6966      #         if
+0000bcd0: 2063 6f6e 7665 7274 5f74 6f5f 666f 726d   convert_to_form
+0000bce0: 6174 2069 7320 6e6f 7420 4e6f 6e65 2061  at is not None a
+0000bcf0: 6e64 2074 2e64 696d 2829 2069 6e20 2834  nd t.dim() in (4
+0000bd00: 2c20 3529 3a0d 0a20 2020 2023 2020 2020  , 5):..    #    
+0000bd10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000bd20: 742e 746f 2864 6576 6963 652c 2064 7479  t.to(device, dty
+0000bd30: 7065 2069 6620 742e 6973 5f66 6c6f 6174  pe if t.is_float
+0000bd40: 696e 675f 706f 696e 7428 2920 6f72 2074  ing_point() or t
+0000bd50: 2e69 735f 636f 6d70 6c65 7828 2920 656c  .is_complex() el
+0000bd60: 7365 204e 6f6e 652c 0d0a 2020 2020 2320  se None,..    # 
+0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd80: 2020 2020 2020 2020 6e6f 6e5f 626c 6f63          non_bloc
+0000bd90: 6b69 6e67 2c20 6d65 6d6f 7279 5f66 6f72  king, memory_for
+0000bda0: 6d61 743d 636f 6e76 6572 745f 746f 5f66  mat=convert_to_f
+0000bdb0: 6f72 6d61 7429 0d0a 2020 2020 2320 2020  ormat)..    #   
+0000bdc0: 2020 2020 2020 7265 7475 726e 2074 2e74        return t.t
+0000bdd0: 6f28 6465 7669 6365 2c20 6474 7970 6520  o(device, dtype 
+0000bde0: 6966 2074 2e69 735f 666c 6f61 7469 6e67  if t.is_floating
+0000bdf0: 5f70 6f69 6e74 2829 206f 7220 742e 6973  _point() or t.is
+0000be00: 5f63 6f6d 706c 6578 2829 2065 6c73 6520  _complex() else 
+0000be10: 4e6f 6e65 2c20 6e6f 6e5f 626c 6f63 6b69  None, non_blocki
+0000be20: 6e67 290d 0a20 2020 2023 0d0a 2020 2020  ng)..    #..    
+0000be30: 2320 2020 2020 7265 7475 726e 2073 656c  #     return sel
+0000be40: 662e 5f61 7070 6c79 2863 6f6e 7665 7274  f._apply(convert
+0000be50: 290d 0a0d 0a0d 0a20 2020 2064 6566 2072  )......    def r
+0000be60: 6567 6973 7465 725f 6675 6c6c 5f62 6163  egister_full_bac
+0000be70: 6b77 6172 645f 7072 655f 686f 6f6b 280d  kward_pre_hook(.
+0000be80: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+0000be90: 2020 2020 2020 2020 686f 6f6b 3a20 4361          hook: Ca
+0000bea0: 6c6c 6162 6c65 5b5b 224d 6f64 756c 6522  llable[["Module"
+0000beb0: 2c20 5f67 7261 645f 745d 2c20 556e 696f  , _grad_t], Unio
+0000bec0: 6e5b 4e6f 6e65 2c20 5f67 7261 645f 745d  n[None, _grad_t]
+0000bed0: 5d2c 0d0a 2020 2020 2020 2020 7072 6570  ],..        prep
+0000bee0: 656e 643a 2062 6f6f 6c20 3d20 4661 6c73  end: bool = Fals
+0000bef0: 652c 0d0a 2020 2020 2920 2d3e 2052 656d  e,..    ) -> Rem
+0000bf00: 6f76 6162 6c65 4861 6e64 6c65 3a0d 0a20  ovableHandle:.. 
+0000bf10: 2020 2020 2020 2072 2222 2252 6567 6973         r"""Regis
+0000bf20: 7465 7273 2061 2062 6163 6b77 6172 6420  ters a backward 
+0000bf30: 7072 652d 686f 6f6b 206f 6e20 7468 6520  pre-hook on the 
+0000bf40: 6d6f 6475 6c65 2e0d 0a0d 0a20 2020 2020  module.....     
+0000bf50: 2020 2054 6865 2068 6f6f 6b20 7769 6c6c     The hook will
+0000bf60: 2062 6520 6361 6c6c 6564 2065 7665 7279   be called every
+0000bf70: 2074 696d 6520 7468 6520 6772 6164 6965   time the gradie
+0000bf80: 6e74 7320 666f 7220 7468 6520 6d6f 6475  nts for the modu
+0000bf90: 6c65 2061 7265 2063 6f6d 7075 7465 642e  le are computed.
+0000bfa0: 0d0a 2020 2020 2020 2020 5468 6520 686f  ..        The ho
+0000bfb0: 6f6b 2073 686f 756c 6420 6861 7665 2074  ok should have t
+0000bfc0: 6865 2066 6f6c 6c6f 7769 6e67 2073 6967  he following sig
+0000bfd0: 6e61 7475 7265 3a3a 0d0a 0d0a 2020 2020  nature::....    
+0000bfe0: 2020 2020 2020 2020 686f 6f6b 286d 6f64          hook(mod
+0000bff0: 756c 652c 2067 7261 645f 6f75 7470 7574  ule, grad_output
+0000c000: 2920 2d3e 2054 656e 736f 7220 6f72 204e  ) -> Tensor or N
+0000c010: 6f6e 650d 0a0d 0a20 2020 2020 2020 2054  one....        T
+0000c020: 6865 203a 6174 7472 3a60 6772 6164 5f6f  he :attr:`grad_o
+0000c030: 7574 7075 7460 2069 7320 6120 7475 706c  utput` is a tupl
+0000c040: 652e 2054 6865 2068 6f6f 6b20 7368 6f75  e. The hook shou
+0000c050: 6c64 0d0a 2020 2020 2020 2020 6e6f 7420  ld..        not 
+0000c060: 6d6f 6469 6679 2069 7473 2061 7267 756d  modify its argum
+0000c070: 656e 7473 2c20 6275 7420 6974 2063 616e  ents, but it can
+0000c080: 206f 7074 696f 6e61 6c6c 7920 7265 7475   optionally retu
+0000c090: 726e 2061 206e 6577 2067 7261 6469 656e  rn a new gradien
+0000c0a0: 7420 7769 7468 0d0a 2020 2020 2020 2020  t with..        
+0000c0b0: 7265 7370 6563 7420 746f 2074 6865 206f  respect to the o
+0000c0c0: 7574 7075 7420 7468 6174 2077 696c 6c20  utput that will 
+0000c0d0: 6265 2075 7365 6420 696e 2070 6c61 6365  be used in place
+0000c0e0: 206f 6620 3a61 7474 723a 6067 7261 645f   of :attr:`grad_
+0000c0f0: 6f75 7470 7574 6020 696e 0d0a 2020 2020  output` in..    
+0000c100: 2020 2020 7375 6273 6571 7565 6e74 2063      subsequent c
+0000c110: 6f6d 7075 7461 7469 6f6e 732e 2045 6e74  omputations. Ent
+0000c120: 7269 6573 2069 6e20 3a61 7474 723a 6067  ries in :attr:`g
+0000c130: 7261 645f 6f75 7470 7574 6020 7769 6c6c  rad_output` will
+0000c140: 2062 6520 6060 4e6f 6e65 6060 2066 6f72   be ``None`` for
+0000c150: 0d0a 2020 2020 2020 2020 616c 6c20 6e6f  ..        all no
+0000c160: 6e2d 5465 6e73 6f72 2061 7267 756d 656e  n-Tensor argumen
+0000c170: 7473 2e0d 0a0d 0a20 2020 2020 2020 2046  ts.....        F
+0000c180: 6f72 2074 6563 686e 6963 616c 2072 6561  or technical rea
+0000c190: 736f 6e73 2c20 7768 656e 2074 6869 7320  sons, when this 
+0000c1a0: 686f 6f6b 2069 7320 6170 706c 6965 6420  hook is applied 
+0000c1b0: 746f 2061 204d 6f64 756c 652c 2069 7473  to a Module, its
+0000c1c0: 2066 6f72 7761 7264 2066 756e 6374 696f   forward functio
+0000c1d0: 6e20 7769 6c6c 0d0a 2020 2020 2020 2020  n will..        
+0000c1e0: 7265 6365 6976 6520 6120 7669 6577 206f  receive a view o
+0000c1f0: 6620 6561 6368 2054 656e 736f 7220 7061  f each Tensor pa
+0000c200: 7373 6564 2074 6f20 7468 6520 4d6f 6475  ssed to the Modu
+0000c210: 6c65 2e20 5369 6d69 6c61 726c 7920 7468  le. Similarly th
+0000c220: 6520 6361 6c6c 6572 2077 696c 6c20 7265  e caller will re
+0000c230: 6365 6976 6520 6120 7669 6577 0d0a 2020  ceive a view..  
+0000c240: 2020 2020 2020 6f66 2065 6163 6820 5465        of each Te
+0000c250: 6e73 6f72 2072 6574 7572 6e65 6420 6279  nsor returned by
+0000c260: 2074 6865 204d 6f64 756c 6527 7320 666f   the Module's fo
+0000c270: 7277 6172 6420 6675 6e63 7469 6f6e 2e0d  rward function..
+0000c280: 0a0d 0a20 2020 2020 2020 202e 2e20 7761  ...        .. wa
+0000c290: 726e 696e 6720 3a3a 0d0a 2020 2020 2020  rning ::..      
+0000c2a0: 2020 2020 2020 4d6f 6469 6679 696e 6720        Modifying 
+0000c2b0: 696e 7075 7473 2069 6e70 6c61 6365 2069  inputs inplace i
+0000c2c0: 7320 6e6f 7420 616c 6c6f 7765 6420 7768  s not allowed wh
+0000c2d0: 656e 2075 7369 6e67 2062 6163 6b77 6172  en using backwar
+0000c2e0: 6420 686f 6f6b 7320 616e 640d 0a20 2020  d hooks and..   
+0000c2f0: 2020 2020 2020 2020 2077 696c 6c20 7261           will ra
+0000c300: 6973 6520 616e 2065 7272 6f72 2e0d 0a0d  ise an error....
+0000c310: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
+0000c320: 2020 2020 2020 2020 2020 2020 686f 6f6b              hook
+0000c330: 2028 4361 6c6c 6162 6c65 293a 2054 6865   (Callable): The
+0000c340: 2075 7365 722d 6465 6669 6e65 6420 686f   user-defined ho
+0000c350: 6f6b 2074 6f20 6265 2072 6567 6973 7465  ok to be registe
+0000c360: 7265 642e 0d0a 2020 2020 2020 2020 2020  red...          
+0000c370: 2020 7072 6570 656e 6420 2862 6f6f 6c29    prepend (bool)
+0000c380: 3a20 4966 2074 7275 652c 2074 6865 2070  : If true, the p
+0000c390: 726f 7669 6465 6420 6060 686f 6f6b 6060  rovided ``hook``
+0000c3a0: 2077 696c 6c20 6265 2066 6972 6564 2062   will be fired b
+0000c3b0: 6566 6f72 650d 0a20 2020 2020 2020 2020  efore..         
+0000c3c0: 2020 2020 2020 2061 6c6c 2065 7869 7374         all exist
+0000c3d0: 696e 6720 6060 6261 636b 7761 7264 5f70  ing ``backward_p
+0000c3e0: 7265 6060 2068 6f6f 6b73 206f 6e20 7468  re`` hooks on th
+0000c3f0: 6973 0d0a 2020 2020 2020 2020 2020 2020  is..            
+0000c400: 2020 2020 3a63 6c61 7373 3a60 746f 7263      :class:`torc
+0000c410: 682e 6e6e 2e6d 6f64 756c 6573 2e4d 6f64  h.nn.modules.Mod
+0000c420: 756c 6560 2e20 4f74 6865 7277 6973 652c  ule`. Otherwise,
+0000c430: 2074 6865 2070 726f 7669 6465 640d 0a20   the provided.. 
+0000c440: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+0000c450: 6068 6f6f 6b60 6020 7769 6c6c 2062 6520  `hook`` will be 
+0000c460: 6669 7265 6420 6166 7465 7220 616c 6c20  fired after all 
+0000c470: 6578 6973 7469 6e67 2060 6062 6163 6b77  existing ``backw
+0000c480: 6172 645f 7072 6560 6020 686f 6f6b 730d  ard_pre`` hooks.
+0000c490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c4a0: 206f 6e20 7468 6973 203a 636c 6173 733a   on this :class:
+0000c4b0: 6074 6f72 6368 2e6e 6e2e 6d6f 6475 6c65  `torch.nn.module
+0000c4c0: 732e 4d6f 6475 6c65 602e 204e 6f74 6520  s.Module`. Note 
+0000c4d0: 7468 6174 2067 6c6f 6261 6c0d 0a20 2020  that global..   
+0000c4e0: 2020 2020 2020 2020 2020 2020 2060 6062               ``b
+0000c4f0: 6163 6b77 6172 645f 7072 6560 6020 686f  ackward_pre`` ho
+0000c500: 6f6b 7320 7265 6769 7374 6572 6564 2077  oks registered w
+0000c510: 6974 680d 0a20 2020 2020 2020 2020 2020  ith..           
+0000c520: 2020 2020 203a 6675 6e63 3a60 7265 6769       :func:`regi
+0000c530: 7374 6572 5f6d 6f64 756c 655f 6675 6c6c  ster_module_full
+0000c540: 5f62 6163 6b77 6172 645f 7072 655f 686f  _backward_pre_ho
+0000c550: 6f6b 6020 7769 6c6c 2066 6972 6520 6265  ok` will fire be
+0000c560: 666f 7265 0d0a 2020 2020 2020 2020 2020  fore..          
+0000c570: 2020 2020 2020 616c 6c20 686f 6f6b 7320        all hooks 
+0000c580: 7265 6769 7374 6572 6564 2062 7920 7468  registered by th
+0000c590: 6973 206d 6574 686f 642e 0d0a 0d0a 2020  is method.....  
+0000c5a0: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
+0000c5b0: 2020 2020 2020 2020 2020 2020 3a63 6c61              :cla
+0000c5c0: 7373 3a60 746f 7263 682e 7574 696c 732e  ss:`torch.utils.
+0000c5d0: 686f 6f6b 732e 5265 6d6f 7661 626c 6548  hooks.RemovableH
+0000c5e0: 616e 646c 6560 3a0d 0a20 2020 2020 2020  andle`:..       
+0000c5f0: 2020 2020 2020 2020 2061 2068 616e 646c           a handl
+0000c600: 6520 7468 6174 2063 616e 2062 6520 7573  e that can be us
+0000c610: 6564 2074 6f20 7265 6d6f 7665 2074 6865  ed to remove the
+0000c620: 2061 6464 6564 2068 6f6f 6b20 6279 2063   added hook by c
+0000c630: 616c 6c69 6e67 0d0a 2020 2020 2020 2020  alling..        
+0000c640: 2020 2020 2020 2020 6060 6861 6e64 6c65          ``handle
+0000c650: 2e72 656d 6f76 6528 2960 600d 0a0d 0a20  .remove()``.... 
+0000c660: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0000c670: 2020 2020 6861 6e64 6c65 203d 5265 6d6f      handle =Remo
+0000c680: 7661 626c 6548 616e 646c 6528 7365 6c66  vableHandle(self
+0000c690: 2e5f 6261 636b 7761 7264 5f70 7265 5f68  ._backward_pre_h
+0000c6a0: 6f6f 6b73 290d 0a20 2020 2020 2020 2073  ooks)..        s
+0000c6b0: 656c 662e 5f62 6163 6b77 6172 645f 7072  elf._backward_pr
+0000c6c0: 655f 686f 6f6b 735b 6861 6e64 6c65 2e69  e_hooks[handle.i
+0000c6d0: 645d 203d 2068 6f6f 6b0d 0a20 2020 2020  d] = hook..     
+0000c6e0: 2020 2069 6620 7072 6570 656e 643a 0d0a     if prepend:..
+0000c6f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c700: 2e5f 6261 636b 7761 7264 5f70 7265 5f68  ._backward_pre_h
+0000c710: 6f6f 6b73 2e6d 6f76 655f 746f 5f65 6e64  ooks.move_to_end
+0000c720: 2868 616e 646c 652e 6964 2c20 6c61 7374  (handle.id, last
+0000c730: 3d46 616c 7365 2920 2023 2074 7970 653a  =False)  # type:
+0000c740: 2069 676e 6f72 655b 6174 7472 2d64 6566   ignore[attr-def
+0000c750: 696e 6564 5d0d 0a20 2020 2020 2020 2072  ined]..        r
+0000c760: 6574 7572 6e20 6861 6e64 6c65 0d0a 0d0a  eturn handle....
+0000c770: 2020 2020 6465 6620 7265 6769 7374 6572      def register
+0000c780: 5f62 6163 6b77 6172 645f 686f 6f6b 280d  _backward_hook(.
+0000c790: 0a20 2020 2020 2020 2073 656c 662c 2068  .        self, h
+0000c7a0: 6f6f 6b3a 2043 616c 6c61 626c 655b 5b27  ook: Callable[['
+0000c7b0: 4d6f 6475 6c65 272c 205f 6772 6164 5f74  Module', _grad_t
+0000c7c0: 2c20 5f67 7261 645f 745d 2c20 556e 696f  , _grad_t], Unio
+0000c7d0: 6e5b 4e6f 6e65 2c20 5f67 7261 645f 745d  n[None, _grad_t]
+0000c7e0: 5d0d 0a20 2020 2029 202d 3e20 5265 6d6f  ]..    ) -> Remo
+0000c7f0: 7661 626c 6548 616e 646c 653a 0d0a 2020  vableHandle:..  
+0000c800: 2020 2020 2020 7222 2222 5265 6769 7374        r"""Regist
+0000c810: 6572 7320 6120 6261 636b 7761 7264 2068  ers a backward h
+0000c820: 6f6f 6b20 6f6e 2074 6865 206d 6f64 756c  ook on the modul
+0000c830: 652e 0d0a 0d0a 2020 2020 2020 2020 5468  e.....        Th
+0000c840: 6973 2066 756e 6374 696f 6e20 6973 2064  is function is d
+0000c850: 6570 7265 6361 7465 6420 696e 2066 6176  eprecated in fav
+0000c860: 6f72 206f 6620 3a6d 6574 683a 607e 746f  or of :meth:`~to
+0000c870: 7263 682e 6e6e 2e4d 6f64 756c 652e 7265  rch.nn.Module.re
+0000c880: 6769 7374 6572 5f66 756c 6c5f 6261 636b  gister_full_back
+0000c890: 7761 7264 5f68 6f6f 6b60 2061 6e64 0d0a  ward_hook` and..
+0000c8a0: 2020 2020 2020 2020 7468 6520 6265 6861          the beha
+0000c8b0: 7669 6f72 206f 6620 7468 6973 2066 756e  vior of this fun
+0000c8c0: 6374 696f 6e20 7769 6c6c 2063 6861 6e67  ction will chang
+0000c8d0: 6520 696e 2066 7574 7572 6520 7665 7273  e in future vers
+0000c8e0: 696f 6e73 2e0d 0a0d 0a20 2020 2020 2020  ions.....       
+0000c8f0: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+0000c900: 2020 2020 2020 203a 636c 6173 733a 6074         :class:`t
+0000c910: 6f72 6368 2e75 7469 6c73 2e68 6f6f 6b73  orch.utils.hooks
+0000c920: 2e52 656d 6f76 6162 6c65 4861 6e64 6c65  .RemovableHandle
+0000c930: 603a 0d0a 2020 2020 2020 2020 2020 2020  `:..            
+0000c940: 2020 2020 6120 6861 6e64 6c65 2074 6861      a handle tha
+0000c950: 7420 6361 6e20 6265 2075 7365 6420 746f  t can be used to
+0000c960: 2072 656d 6f76 6520 7468 6520 6164 6465   remove the adde
+0000c970: 6420 686f 6f6b 2062 7920 6361 6c6c 696e  d hook by callin
+0000c980: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
+0000c990: 2020 2060 6068 616e 646c 652e 7265 6d6f     ``handle.remo
+0000c9a0: 7665 2829 6060 0d0a 0d0a 2020 2020 2020  ve()``....      
+0000c9b0: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+0000c9c0: 6620 7365 6c66 2e5f 6973 5f66 756c 6c5f  f self._is_full_
+0000c9d0: 6261 636b 7761 7264 5f68 6f6f 6b20 6973  backward_hook is
+0000c9e0: 2054 7275 653a 0d0a 2020 2020 2020 2020   True:..        
+0000c9f0: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+0000ca00: 6545 7272 6f72 2822 4361 6e6e 6f74 2075  eError("Cannot u
+0000ca10: 7365 2062 6f74 6820 7265 6775 6c61 7220  se both regular 
+0000ca20: 6261 636b 7761 7264 2068 6f6f 6b73 2061  backward hooks a
+0000ca30: 6e64 2066 756c 6c20 6261 636b 7761 7264  nd full backward
+0000ca40: 2068 6f6f 6b73 206f 6e20 6120 220d 0a20   hooks on a ".. 
 0000ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca60: 2020 2022 7369 6e67 6c65 204d 6f64 756c     "single Modul
-0000ca70: 652e 2050 6c65 6173 6520 7573 6520 6f6e  e. Please use on
-0000ca80: 6c79 206f 6e65 206f 6620 7468 656d 2e22  ly one of them."
-0000ca90: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0000caa0: 662e 5f69 735f 6675 6c6c 5f62 6163 6b77  f._is_full_backw
-0000cab0: 6172 645f 686f 6f6b 203d 2046 616c 7365  ard_hook = False
-0000cac0: 0d0a 0d0a 2020 2020 2020 2020 6861 6e64  ....        hand
-0000cad0: 6c65 203d 5265 6d6f 7661 626c 6548 616e  le =RemovableHan
-0000cae0: 646c 6528 7365 6c66 2e5f 6261 636b 7761  dle(self._backwa
-0000caf0: 7264 5f68 6f6f 6b73 290d 0a20 2020 2020  rd_hooks)..     
-0000cb00: 2020 2073 656c 662e 5f62 6163 6b77 6172     self._backwar
-0000cb10: 645f 686f 6f6b 735b 6861 6e64 6c65 2e69  d_hooks[handle.i
-0000cb20: 645d 203d 2068 6f6f 6b0d 0a20 2020 2020  d] = hook..     
-0000cb30: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
-0000cb40: 0d0a 0d0a 2020 2020 6465 6620 7265 6769  ....    def regi
-0000cb50: 7374 6572 5f66 756c 6c5f 6261 636b 7761  ster_full_backwa
-0000cb60: 7264 5f68 6f6f 6b28 0d0a 2020 2020 2020  rd_hook(..      
-0000cb70: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-0000cb80: 2068 6f6f 6b3a 2043 616c 6c61 626c 655b   hook: Callable[
-0000cb90: 5b22 4d6f 6475 6c65 222c 205f 6772 6164  ["Module", _grad
-0000cba0: 5f74 2c20 5f67 7261 645f 745d 2c20 556e  _t, _grad_t], Un
-0000cbb0: 696f 6e5b 4e6f 6e65 2c20 5f67 7261 645f  ion[None, _grad_
-0000cbc0: 745d 5d2c 0d0a 2020 2020 2020 2020 7072  t]],..        pr
-0000cbd0: 6570 656e 643a 2062 6f6f 6c20 3d20 4661  epend: bool = Fa
-0000cbe0: 6c73 652c 0d0a 2020 2020 2920 2d3e 2052  lse,..    ) -> R
-0000cbf0: 656d 6f76 6162 6c65 4861 6e64 6c65 3a0d  emovableHandle:.
-0000cc00: 0a20 2020 2020 2020 2072 2222 2252 6567  .        r"""Reg
-0000cc10: 6973 7465 7273 2061 2062 6163 6b77 6172  isters a backwar
-0000cc20: 6420 686f 6f6b 206f 6e20 7468 6520 6d6f  d hook on the mo
-0000cc30: 6475 6c65 2e0d 0a0d 0a20 2020 2020 2020  dule.....       
-0000cc40: 2054 6865 2068 6f6f 6b20 7769 6c6c 2062   The hook will b
-0000cc50: 6520 6361 6c6c 6564 2065 7665 7279 2074  e called every t
-0000cc60: 696d 6520 7468 6520 6772 6164 6965 6e74  ime the gradient
-0000cc70: 7320 7769 7468 2072 6573 7065 6374 2074  s with respect t
-0000cc80: 6f20 6120 6d6f 6475 6c65 0d0a 2020 2020  o a module..    
-0000cc90: 2020 2020 6172 6520 636f 6d70 7574 6564      are computed
-0000cca0: 2c20 692e 652e 2074 6865 2068 6f6f 6b20  , i.e. the hook 
-0000ccb0: 7769 6c6c 2065 7865 6375 7465 2069 6620  will execute if 
-0000ccc0: 616e 6420 6f6e 6c79 2069 6620 7468 6520  and only if the 
-0000ccd0: 6772 6164 6965 6e74 7320 7769 7468 0d0a  gradients with..
-0000cce0: 2020 2020 2020 2020 7265 7370 6563 7420          respect 
-0000ccf0: 746f 206d 6f64 756c 6520 6f75 7470 7574  to module output
-0000cd00: 7320 6172 6520 636f 6d70 7574 6564 2e20  s are computed. 
-0000cd10: 5468 6520 686f 6f6b 2073 686f 756c 6420  The hook should 
-0000cd20: 6861 7665 2074 6865 2066 6f6c 6c6f 7769  have the followi
-0000cd30: 6e67 0d0a 2020 2020 2020 2020 7369 676e  ng..        sign
-0000cd40: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
-0000cd50: 2020 2020 2020 2068 6f6f 6b28 6d6f 6475         hook(modu
-0000cd60: 6c65 2c20 6772 6164 5f69 6e70 7574 2c20  le, grad_input, 
-0000cd70: 6772 6164 5f6f 7574 7075 7429 202d 3e20  grad_output) -> 
-0000cd80: 7475 706c 6528 5465 6e73 6f72 2920 6f72  tuple(Tensor) or
-0000cd90: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-0000cda0: 2054 6865 203a 6174 7472 3a60 6772 6164   The :attr:`grad
-0000cdb0: 5f69 6e70 7574 6020 616e 6420 3a61 7474  _input` and :att
-0000cdc0: 723a 6067 7261 645f 6f75 7470 7574 6020  r:`grad_output` 
-0000cdd0: 6172 6520 7475 706c 6573 2074 6861 7420  are tuples that 
-0000cde0: 636f 6e74 6169 6e20 7468 6520 6772 6164  contain the grad
-0000cdf0: 6965 6e74 730d 0a20 2020 2020 2020 2077  ients..        w
-0000ce00: 6974 6820 7265 7370 6563 7420 746f 2074  ith respect to t
-0000ce10: 6865 2069 6e70 7574 7320 616e 6420 6f75  he inputs and ou
-0000ce20: 7470 7574 7320 7265 7370 6563 7469 7665  tputs respective
-0000ce30: 6c79 2e20 5468 6520 686f 6f6b 2073 686f  ly. The hook sho
-0000ce40: 756c 640d 0a20 2020 2020 2020 206e 6f74  uld..        not
-0000ce50: 206d 6f64 6966 7920 6974 7320 6172 6775   modify its argu
-0000ce60: 6d65 6e74 732c 2062 7574 2069 7420 6361  ments, but it ca
-0000ce70: 6e20 6f70 7469 6f6e 616c 6c79 2072 6574  n optionally ret
-0000ce80: 7572 6e20 6120 6e65 7720 6772 6164 6965  urn a new gradie
-0000ce90: 6e74 2077 6974 680d 0a20 2020 2020 2020  nt with..       
-0000cea0: 2072 6573 7065 6374 2074 6f20 7468 6520   respect to the 
-0000ceb0: 696e 7075 7420 7468 6174 2077 696c 6c20  input that will 
-0000cec0: 6265 2075 7365 6420 696e 2070 6c61 6365  be used in place
-0000ced0: 206f 6620 3a61 7474 723a 6067 7261 645f   of :attr:`grad_
-0000cee0: 696e 7075 7460 2069 6e0d 0a20 2020 2020  input` in..     
-0000cef0: 2020 2073 7562 7365 7175 656e 7420 636f     subsequent co
-0000cf00: 6d70 7574 6174 696f 6e73 2e20 3a61 7474  mputations. :att
-0000cf10: 723a 6067 7261 645f 696e 7075 7460 2077  r:`grad_input` w
-0000cf20: 696c 6c20 6f6e 6c79 2063 6f72 7265 7370  ill only corresp
-0000cf30: 6f6e 6420 746f 2074 6865 2069 6e70 7574  ond to the input
-0000cf40: 7320 6769 7665 6e0d 0a20 2020 2020 2020  s given..       
-0000cf50: 2061 7320 706f 7369 7469 6f6e 616c 2061   as positional a
-0000cf60: 7267 756d 656e 7473 2061 6e64 2061 6c6c  rguments and all
-0000cf70: 206b 7761 7267 2061 7267 756d 656e 7473   kwarg arguments
-0000cf80: 2061 7265 2069 676e 6f72 6564 2e20 456e   are ignored. En
-0000cf90: 7472 6965 730d 0a20 2020 2020 2020 2069  tries..        i
-0000cfa0: 6e20 3a61 7474 723a 6067 7261 645f 696e  n :attr:`grad_in
-0000cfb0: 7075 7460 2061 6e64 203a 6174 7472 3a60  put` and :attr:`
-0000cfc0: 6772 6164 5f6f 7574 7075 7460 2077 696c  grad_output` wil
-0000cfd0: 6c20 6265 2060 604e 6f6e 6560 6020 666f  l be ``None`` fo
-0000cfe0: 7220 616c 6c20 6e6f 6e2d 5465 6e73 6f72  r all non-Tensor
-0000cff0: 0d0a 2020 2020 2020 2020 6172 6775 6d65  ..        argume
-0000d000: 6e74 732e 0d0a 0d0a 2020 2020 2020 2020  nts.....        
-0000d010: 466f 7220 7465 6368 6e69 6361 6c20 7265  For technical re
-0000d020: 6173 6f6e 732c 2077 6865 6e20 7468 6973  asons, when this
-0000d030: 2068 6f6f 6b20 6973 2061 7070 6c69 6564   hook is applied
-0000d040: 2074 6f20 6120 4d6f 6475 6c65 2c20 6974   to a Module, it
-0000d050: 7320 666f 7277 6172 6420 6675 6e63 7469  s forward functi
-0000d060: 6f6e 2077 696c 6c0d 0a20 2020 2020 2020  on will..       
-0000d070: 2072 6563 6569 7665 2061 2076 6965 7720   receive a view 
-0000d080: 6f66 2065 6163 6820 5465 6e73 6f72 2070  of each Tensor p
-0000d090: 6173 7365 6420 746f 2074 6865 204d 6f64  assed to the Mod
-0000d0a0: 756c 652e 2053 696d 696c 6172 6c79 2074  ule. Similarly t
-0000d0b0: 6865 2063 616c 6c65 7220 7769 6c6c 2072  he caller will r
-0000d0c0: 6563 6569 7665 2061 2076 6965 770d 0a20  eceive a view.. 
-0000d0d0: 2020 2020 2020 206f 6620 6561 6368 2054         of each T
-0000d0e0: 656e 736f 7220 7265 7475 726e 6564 2062  ensor returned b
-0000d0f0: 7920 7468 6520 4d6f 6475 6c65 2773 2066  y the Module's f
-0000d100: 6f72 7761 7264 2066 756e 6374 696f 6e2e  orward function.
-0000d110: 0d0a 0d0a 2020 2020 2020 2020 2e2e 2077  ....        .. w
-0000d120: 6172 6e69 6e67 203a 3a0d 0a20 2020 2020  arning ::..     
-0000d130: 2020 2020 2020 204d 6f64 6966 7969 6e67         Modifying
-0000d140: 2069 6e70 7574 7320 6f72 206f 7574 7075   inputs or outpu
-0000d150: 7473 2069 6e70 6c61 6365 2069 7320 6e6f  ts inplace is no
-0000d160: 7420 616c 6c6f 7765 6420 7768 656e 2075  t allowed when u
-0000d170: 7369 6e67 2062 6163 6b77 6172 6420 686f  sing backward ho
-0000d180: 6f6b 7320 616e 640d 0a20 2020 2020 2020  oks and..       
-0000d190: 2020 2020 2077 696c 6c20 7261 6973 6520       will raise 
-0000d1a0: 616e 2065 7272 6f72 2e0d 0a0d 0a20 2020  an error.....   
-0000d1b0: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
-0000d1c0: 2020 2020 2020 2020 686f 6f6b 2028 4361          hook (Ca
-0000d1d0: 6c6c 6162 6c65 293a 2054 6865 2075 7365  llable): The use
-0000d1e0: 722d 6465 6669 6e65 6420 686f 6f6b 2074  r-defined hook t
-0000d1f0: 6f20 6265 2072 6567 6973 7465 7265 642e  o be registered.
-0000d200: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0000d210: 6570 656e 6420 2862 6f6f 6c29 3a20 4966  epend (bool): If
-0000d220: 2074 7275 652c 2074 6865 2070 726f 7669   true, the provi
-0000d230: 6465 6420 6060 686f 6f6b 6060 2077 696c  ded ``hook`` wil
-0000d240: 6c20 6265 2066 6972 6564 2062 6566 6f72  l be fired befor
-0000d250: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000d260: 2020 2061 6c6c 2065 7869 7374 696e 6720     all existing 
-0000d270: 6060 6261 636b 7761 7264 6060 2068 6f6f  ``backward`` hoo
-0000d280: 6b73 206f 6e20 7468 6973 0d0a 2020 2020  ks on this..    
-0000d290: 2020 2020 2020 2020 2020 2020 3a63 6c61              :cla
-0000d2a0: 7373 3a60 746f 7263 682e 6e6e 2e6d 6f64  ss:`torch.nn.mod
-0000d2b0: 756c 6573 2e4d 6f64 756c 6560 2e20 4f74  ules.Module`. Ot
-0000d2c0: 6865 7277 6973 652c 2074 6865 2070 726f  herwise, the pro
-0000d2d0: 7669 6465 640d 0a20 2020 2020 2020 2020  vided..         
-0000d2e0: 2020 2020 2020 2060 6068 6f6f 6b60 6020         ``hook`` 
-0000d2f0: 7769 6c6c 2062 6520 6669 7265 6420 6166  will be fired af
-0000d300: 7465 7220 616c 6c20 6578 6973 7469 6e67  ter all existing
-0000d310: 2060 6062 6163 6b77 6172 6460 6020 686f   ``backward`` ho
-0000d320: 6f6b 7320 6f6e 0d0a 2020 2020 2020 2020  oks on..        
-0000d330: 2020 2020 2020 2020 7468 6973 203a 636c          this :cl
-0000d340: 6173 733a 6074 6f72 6368 2e6e 6e2e 6d6f  ass:`torch.nn.mo
-0000d350: 6475 6c65 732e 4d6f 6475 6c65 602e 204e  dules.Module`. N
-0000d360: 6f74 6520 7468 6174 2067 6c6f 6261 6c0d  ote that global.
-0000d370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d380: 2060 6062 6163 6b77 6172 6460 6020 686f   ``backward`` ho
-0000d390: 6f6b 7320 7265 6769 7374 6572 6564 2077  oks registered w
-0000d3a0: 6974 680d 0a20 2020 2020 2020 2020 2020  ith..           
-0000d3b0: 2020 2020 203a 6675 6e63 3a60 7265 6769       :func:`regi
-0000d3c0: 7374 6572 5f6d 6f64 756c 655f 6675 6c6c  ster_module_full
-0000d3d0: 5f62 6163 6b77 6172 645f 686f 6f6b 6020  _backward_hook` 
-0000d3e0: 7769 6c6c 2066 6972 6520 6265 666f 7265  will fire before
-0000d3f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d400: 2020 616c 6c20 686f 6f6b 7320 7265 6769    all hooks regi
-0000d410: 7374 6572 6564 2062 7920 7468 6973 206d  stered by this m
-0000d420: 6574 686f 642e 0d0a 0d0a 2020 2020 2020  ethod.....      
-0000d430: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-0000d440: 2020 2020 2020 2020 3a63 6c61 7373 3a60          :class:`
-0000d450: 746f 7263 682e 7574 696c 732e 686f 6f6b  torch.utils.hook
-0000d460: 732e 5265 6d6f 7661 626c 6548 616e 646c  s.RemovableHandl
-0000d470: 6560 3a0d 0a20 2020 2020 2020 2020 2020  e`:..           
-0000d480: 2020 2020 2061 2068 616e 646c 6520 7468       a handle th
-0000d490: 6174 2063 616e 2062 6520 7573 6564 2074  at can be used t
-0000d4a0: 6f20 7265 6d6f 7665 2074 6865 2061 6464  o remove the add
-0000d4b0: 6564 2068 6f6f 6b20 6279 2063 616c 6c69  ed hook by calli
-0000d4c0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-0000d4d0: 2020 2020 6060 6861 6e64 6c65 2e72 656d      ``handle.rem
-0000d4e0: 6f76 6528 2960 600d 0a0d 0a20 2020 2020  ove()``....     
-0000d4f0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000d500: 6966 2073 656c 662e 5f69 735f 6675 6c6c  if self._is_full
-0000d510: 5f62 6163 6b77 6172 645f 686f 6f6b 2069  _backward_hook i
-0000d520: 7320 4661 6c73 653a 0d0a 2020 2020 2020  s False:..      
-0000d530: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-0000d540: 696d 6545 7272 6f72 2822 4361 6e6e 6f74  imeError("Cannot
-0000d550: 2075 7365 2062 6f74 6820 7265 6775 6c61   use both regula
-0000d560: 7220 6261 636b 7761 7264 2068 6f6f 6b73  r backward hooks
-0000d570: 2061 6e64 2066 756c 6c20 6261 636b 7761   and full backwa
-0000d580: 7264 2068 6f6f 6b73 206f 6e20 6120 220d  rd hooks on a ".
-0000d590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ca60: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+0000ca70: 696e 676c 6520 4d6f 6475 6c65 2e20 506c  ingle Module. Pl
+0000ca80: 6561 7365 2075 7365 206f 6e6c 7920 6f6e  ease use only on
+0000ca90: 6520 6f66 2074 6865 6d2e 2229 0d0a 0d0a  e of them.")....
+0000caa0: 2020 2020 2020 2020 7365 6c66 2e5f 6973          self._is
+0000cab0: 5f66 756c 6c5f 6261 636b 7761 7264 5f68  _full_backward_h
+0000cac0: 6f6f 6b20 3d20 4661 6c73 650d 0a0d 0a20  ook = False.... 
+0000cad0: 2020 2020 2020 2068 616e 646c 6520 3d52         handle =R
+0000cae0: 656d 6f76 6162 6c65 4861 6e64 6c65 2873  emovableHandle(s
+0000caf0: 656c 662e 5f62 6163 6b77 6172 645f 686f  elf._backward_ho
+0000cb00: 6f6b 7329 0d0a 2020 2020 2020 2020 7365  oks)..        se
+0000cb10: 6c66 2e5f 6261 636b 7761 7264 5f68 6f6f  lf._backward_hoo
+0000cb20: 6b73 5b68 616e 646c 652e 6964 5d20 3d20  ks[handle.id] = 
+0000cb30: 686f 6f6b 0d0a 2020 2020 2020 2020 7265  hook..        re
+0000cb40: 7475 726e 2068 616e 646c 650d 0a0d 0a20  turn handle.... 
+0000cb50: 2020 2064 6566 2072 6567 6973 7465 725f     def register_
+0000cb60: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
+0000cb70: 6f6b 280d 0a20 2020 2020 2020 2073 656c  ok(..        sel
+0000cb80: 662c 0d0a 2020 2020 2020 2020 686f 6f6b  f,..        hook
+0000cb90: 3a20 4361 6c6c 6162 6c65 5b5b 224d 6f64  : Callable[["Mod
+0000cba0: 756c 6522 2c20 5f67 7261 645f 742c 205f  ule", _grad_t, _
+0000cbb0: 6772 6164 5f74 5d2c 2055 6e69 6f6e 5b4e  grad_t], Union[N
+0000cbc0: 6f6e 652c 205f 6772 6164 5f74 5d5d 2c0d  one, _grad_t]],.
+0000cbd0: 0a20 2020 2020 2020 2070 7265 7065 6e64  .        prepend
+0000cbe0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0d  : bool = False,.
+0000cbf0: 0a20 2020 2029 202d 3e20 5265 6d6f 7661  .    ) -> Remova
+0000cc00: 626c 6548 616e 646c 653a 0d0a 2020 2020  bleHandle:..    
+0000cc10: 2020 2020 7222 2222 5265 6769 7374 6572      r"""Register
+0000cc20: 7320 6120 6261 636b 7761 7264 2068 6f6f  s a backward hoo
+0000cc30: 6b20 6f6e 2074 6865 206d 6f64 756c 652e  k on the module.
+0000cc40: 0d0a 0d0a 2020 2020 2020 2020 5468 6520  ....        The 
+0000cc50: 686f 6f6b 2077 696c 6c20 6265 2063 616c  hook will be cal
+0000cc60: 6c65 6420 6576 6572 7920 7469 6d65 2074  led every time t
+0000cc70: 6865 2067 7261 6469 656e 7473 2077 6974  he gradients wit
+0000cc80: 6820 7265 7370 6563 7420 746f 2061 206d  h respect to a m
+0000cc90: 6f64 756c 650d 0a20 2020 2020 2020 2061  odule..        a
+0000cca0: 7265 2063 6f6d 7075 7465 642c 2069 2e65  re computed, i.e
+0000ccb0: 2e20 7468 6520 686f 6f6b 2077 696c 6c20  . the hook will 
+0000ccc0: 6578 6563 7574 6520 6966 2061 6e64 206f  execute if and o
+0000ccd0: 6e6c 7920 6966 2074 6865 2067 7261 6469  nly if the gradi
+0000cce0: 656e 7473 2077 6974 680d 0a20 2020 2020  ents with..     
+0000ccf0: 2020 2072 6573 7065 6374 2074 6f20 6d6f     respect to mo
+0000cd00: 6475 6c65 206f 7574 7075 7473 2061 7265  dule outputs are
+0000cd10: 2063 6f6d 7075 7465 642e 2054 6865 2068   computed. The h
+0000cd20: 6f6f 6b20 7368 6f75 6c64 2068 6176 6520  ook should have 
+0000cd30: 7468 6520 666f 6c6c 6f77 696e 670d 0a20  the following.. 
+0000cd40: 2020 2020 2020 2073 6967 6e61 7475 7265         signature
+0000cd50: 3a3a 0d0a 0d0a 2020 2020 2020 2020 2020  ::....          
+0000cd60: 2020 686f 6f6b 286d 6f64 756c 652c 2067    hook(module, g
+0000cd70: 7261 645f 696e 7075 742c 2067 7261 645f  rad_input, grad_
+0000cd80: 6f75 7470 7574 2920 2d3e 2074 7570 6c65  output) -> tuple
+0000cd90: 2854 656e 736f 7229 206f 7220 4e6f 6e65  (Tensor) or None
+0000cda0: 0d0a 0d0a 2020 2020 2020 2020 5468 6520  ....        The 
+0000cdb0: 3a61 7474 723a 6067 7261 645f 696e 7075  :attr:`grad_inpu
+0000cdc0: 7460 2061 6e64 203a 6174 7472 3a60 6772  t` and :attr:`gr
+0000cdd0: 6164 5f6f 7574 7075 7460 2061 7265 2074  ad_output` are t
+0000cde0: 7570 6c65 7320 7468 6174 2063 6f6e 7461  uples that conta
+0000cdf0: 696e 2074 6865 2067 7261 6469 656e 7473  in the gradients
+0000ce00: 0d0a 2020 2020 2020 2020 7769 7468 2072  ..        with r
+0000ce10: 6573 7065 6374 2074 6f20 7468 6520 696e  espect to the in
+0000ce20: 7075 7473 2061 6e64 206f 7574 7075 7473  puts and outputs
+0000ce30: 2072 6573 7065 6374 6976 656c 792e 2054   respectively. T
+0000ce40: 6865 2068 6f6f 6b20 7368 6f75 6c64 0d0a  he hook should..
+0000ce50: 2020 2020 2020 2020 6e6f 7420 6d6f 6469          not modi
+0000ce60: 6679 2069 7473 2061 7267 756d 656e 7473  fy its arguments
+0000ce70: 2c20 6275 7420 6974 2063 616e 206f 7074  , but it can opt
+0000ce80: 696f 6e61 6c6c 7920 7265 7475 726e 2061  ionally return a
+0000ce90: 206e 6577 2067 7261 6469 656e 7420 7769   new gradient wi
+0000cea0: 7468 0d0a 2020 2020 2020 2020 7265 7370  th..        resp
+0000ceb0: 6563 7420 746f 2074 6865 2069 6e70 7574  ect to the input
+0000cec0: 2074 6861 7420 7769 6c6c 2062 6520 7573   that will be us
+0000ced0: 6564 2069 6e20 706c 6163 6520 6f66 203a  ed in place of :
+0000cee0: 6174 7472 3a60 6772 6164 5f69 6e70 7574  attr:`grad_input
+0000cef0: 6020 696e 0d0a 2020 2020 2020 2020 7375  ` in..        su
+0000cf00: 6273 6571 7565 6e74 2063 6f6d 7075 7461  bsequent computa
+0000cf10: 7469 6f6e 732e 203a 6174 7472 3a60 6772  tions. :attr:`gr
+0000cf20: 6164 5f69 6e70 7574 6020 7769 6c6c 206f  ad_input` will o
+0000cf30: 6e6c 7920 636f 7272 6573 706f 6e64 2074  nly correspond t
+0000cf40: 6f20 7468 6520 696e 7075 7473 2067 6976  o the inputs giv
+0000cf50: 656e 0d0a 2020 2020 2020 2020 6173 2070  en..        as p
+0000cf60: 6f73 6974 696f 6e61 6c20 6172 6775 6d65  ositional argume
+0000cf70: 6e74 7320 616e 6420 616c 6c20 6b77 6172  nts and all kwar
+0000cf80: 6720 6172 6775 6d65 6e74 7320 6172 6520  g arguments are 
+0000cf90: 6967 6e6f 7265 642e 2045 6e74 7269 6573  ignored. Entries
+0000cfa0: 0d0a 2020 2020 2020 2020 696e 203a 6174  ..        in :at
+0000cfb0: 7472 3a60 6772 6164 5f69 6e70 7574 6020  tr:`grad_input` 
+0000cfc0: 616e 6420 3a61 7474 723a 6067 7261 645f  and :attr:`grad_
+0000cfd0: 6f75 7470 7574 6020 7769 6c6c 2062 6520  output` will be 
+0000cfe0: 6060 4e6f 6e65 6060 2066 6f72 2061 6c6c  ``None`` for all
+0000cff0: 206e 6f6e 2d54 656e 736f 720d 0a20 2020   non-Tensor..   
+0000d000: 2020 2020 2061 7267 756d 656e 7473 2e0d       arguments..
+0000d010: 0a0d 0a20 2020 2020 2020 2046 6f72 2074  ...        For t
+0000d020: 6563 686e 6963 616c 2072 6561 736f 6e73  echnical reasons
+0000d030: 2c20 7768 656e 2074 6869 7320 686f 6f6b  , when this hook
+0000d040: 2069 7320 6170 706c 6965 6420 746f 2061   is applied to a
+0000d050: 204d 6f64 756c 652c 2069 7473 2066 6f72   Module, its for
+0000d060: 7761 7264 2066 756e 6374 696f 6e20 7769  ward function wi
+0000d070: 6c6c 0d0a 2020 2020 2020 2020 7265 6365  ll..        rece
+0000d080: 6976 6520 6120 7669 6577 206f 6620 6561  ive a view of ea
+0000d090: 6368 2054 656e 736f 7220 7061 7373 6564  ch Tensor passed
+0000d0a0: 2074 6f20 7468 6520 4d6f 6475 6c65 2e20   to the Module. 
+0000d0b0: 5369 6d69 6c61 726c 7920 7468 6520 6361  Similarly the ca
+0000d0c0: 6c6c 6572 2077 696c 6c20 7265 6365 6976  ller will receiv
+0000d0d0: 6520 6120 7669 6577 0d0a 2020 2020 2020  e a view..      
+0000d0e0: 2020 6f66 2065 6163 6820 5465 6e73 6f72    of each Tensor
+0000d0f0: 2072 6574 7572 6e65 6420 6279 2074 6865   returned by the
+0000d100: 204d 6f64 756c 6527 7320 666f 7277 6172   Module's forwar
+0000d110: 6420 6675 6e63 7469 6f6e 2e0d 0a0d 0a20  d function..... 
+0000d120: 2020 2020 2020 202e 2e20 7761 726e 696e         .. warnin
+0000d130: 6720 3a3a 0d0a 2020 2020 2020 2020 2020  g ::..          
+0000d140: 2020 4d6f 6469 6679 696e 6720 696e 7075    Modifying inpu
+0000d150: 7473 206f 7220 6f75 7470 7574 7320 696e  ts or outputs in
+0000d160: 706c 6163 6520 6973 206e 6f74 2061 6c6c  place is not all
+0000d170: 6f77 6564 2077 6865 6e20 7573 696e 6720  owed when using 
+0000d180: 6261 636b 7761 7264 2068 6f6f 6b73 2061  backward hooks a
+0000d190: 6e64 0d0a 2020 2020 2020 2020 2020 2020  nd..            
+0000d1a0: 7769 6c6c 2072 6169 7365 2061 6e20 6572  will raise an er
+0000d1b0: 726f 722e 0d0a 0d0a 2020 2020 2020 2020  ror.....        
+0000d1c0: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+0000d1d0: 2020 2068 6f6f 6b20 2843 616c 6c61 626c     hook (Callabl
+0000d1e0: 6529 3a20 5468 6520 7573 6572 2d64 6566  e): The user-def
+0000d1f0: 696e 6564 2068 6f6f 6b20 746f 2062 6520  ined hook to be 
+0000d200: 7265 6769 7374 6572 6564 2e0d 0a20 2020  registered...   
+0000d210: 2020 2020 2020 2020 2070 7265 7065 6e64           prepend
+0000d220: 2028 626f 6f6c 293a 2049 6620 7472 7565   (bool): If true
+0000d230: 2c20 7468 6520 7072 6f76 6964 6564 2060  , the provided `
+0000d240: 6068 6f6f 6b60 6020 7769 6c6c 2062 6520  `hook`` will be 
+0000d250: 6669 7265 6420 6265 666f 7265 0d0a 2020  fired before..  
+0000d260: 2020 2020 2020 2020 2020 2020 2020 616c                al
+0000d270: 6c20 6578 6973 7469 6e67 2060 6062 6163  l existing ``bac
+0000d280: 6b77 6172 6460 6020 686f 6f6b 7320 6f6e  kward`` hooks on
+0000d290: 2074 6869 730d 0a20 2020 2020 2020 2020   this..         
+0000d2a0: 2020 2020 2020 203a 636c 6173 733a 6074         :class:`t
+0000d2b0: 6f72 6368 2e6e 6e2e 6d6f 6475 6c65 732e  orch.nn.modules.
+0000d2c0: 4d6f 6475 6c65 602e 204f 7468 6572 7769  Module`. Otherwi
+0000d2d0: 7365 2c20 7468 6520 7072 6f76 6964 6564  se, the provided
+0000d2e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d2f0: 2020 6060 686f 6f6b 6060 2077 696c 6c20    ``hook`` will 
+0000d300: 6265 2066 6972 6564 2061 6674 6572 2061  be fired after a
+0000d310: 6c6c 2065 7869 7374 696e 6720 6060 6261  ll existing ``ba
+0000d320: 636b 7761 7264 6060 2068 6f6f 6b73 206f  ckward`` hooks o
+0000d330: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+0000d340: 2020 2074 6869 7320 3a63 6c61 7373 3a60     this :class:`
+0000d350: 746f 7263 682e 6e6e 2e6d 6f64 756c 6573  torch.nn.modules
+0000d360: 2e4d 6f64 756c 6560 2e20 4e6f 7465 2074  .Module`. Note t
+0000d370: 6861 7420 676c 6f62 616c 0d0a 2020 2020  hat global..    
+0000d380: 2020 2020 2020 2020 2020 2020 6060 6261              ``ba
+0000d390: 636b 7761 7264 6060 2068 6f6f 6b73 2072  ckward`` hooks r
+0000d3a0: 6567 6973 7465 7265 6420 7769 7468 0d0a  egistered with..
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 3a66 756e 633a 6072 6567 6973 7465 725f  :func:`register_
+0000d3d0: 6d6f 6475 6c65 5f66 756c 6c5f 6261 636b  module_full_back
+0000d3e0: 7761 7264 5f68 6f6f 6b60 2077 696c 6c20  ward_hook` will 
+0000d3f0: 6669 7265 2062 6566 6f72 650d 0a20 2020  fire before..   
+0000d400: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
+0000d410: 2068 6f6f 6b73 2072 6567 6973 7465 7265   hooks registere
+0000d420: 6420 6279 2074 6869 7320 6d65 7468 6f64  d by this method
+0000d430: 2e0d 0a0d 0a20 2020 2020 2020 2052 6574  .....        Ret
+0000d440: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
+0000d450: 2020 203a 636c 6173 733a 6074 6f72 6368     :class:`torch
+0000d460: 2e75 7469 6c73 2e68 6f6f 6b73 2e52 656d  .utils.hooks.Rem
+0000d470: 6f76 6162 6c65 4861 6e64 6c65 603a 0d0a  ovableHandle`:..
+0000d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d490: 6120 6861 6e64 6c65 2074 6861 7420 6361  a handle that ca
+0000d4a0: 6e20 6265 2075 7365 6420 746f 2072 656d  n be used to rem
+0000d4b0: 6f76 6520 7468 6520 6164 6465 6420 686f  ove the added ho
+0000d4c0: 6f6b 2062 7920 6361 6c6c 696e 670d 0a20  ok by calling.. 
+0000d4d0: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+0000d4e0: 6068 616e 646c 652e 7265 6d6f 7665 2829  `handle.remove()
+0000d4f0: 6060 0d0a 0d0a 2020 2020 2020 2020 2222  ``....        ""
+0000d500: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+0000d510: 6c66 2e5f 6973 5f66 756c 6c5f 6261 636b  lf._is_full_back
+0000d520: 7761 7264 5f68 6f6f 6b20 6973 2046 616c  ward_hook is Fal
+0000d530: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000d540: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+0000d550: 726f 7228 2243 616e 6e6f 7420 7573 6520  ror("Cannot use 
+0000d560: 626f 7468 2072 6567 756c 6172 2062 6163  both regular bac
+0000d570: 6b77 6172 6420 686f 6f6b 7320 616e 6420  kward hooks and 
+0000d580: 6675 6c6c 2062 6163 6b77 6172 6420 686f  full backward ho
+0000d590: 6f6b 7320 6f6e 2061 2022 0d0a 2020 2020  oks on a "..    
 0000d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5b0: 2273 696e 676c 6520 4d6f 6475 6c65 2e20  "single Module. 
-0000d5c0: 506c 6561 7365 2075 7365 206f 6e6c 7920  Please use only 
-0000d5d0: 6f6e 6520 6f66 2074 6865 6d2e 2229 0d0a  one of them.")..
-0000d5e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000d5f0: 6973 5f66 756c 6c5f 6261 636b 7761 7264  is_full_backward
-0000d600: 5f68 6f6f 6b20 3d20 5472 7565 0d0a 0d0a  _hook = True....
-0000d610: 2020 2020 2020 2020 6861 6e64 6c65 203d          handle =
-0000d620: 5265 6d6f 7661 626c 6548 616e 646c 6528  RemovableHandle(
-0000d630: 7365 6c66 2e5f 6261 636b 7761 7264 5f68  self._backward_h
-0000d640: 6f6f 6b73 290d 0a20 2020 2020 2020 2073  ooks)..        s
-0000d650: 656c 662e 5f62 6163 6b77 6172 645f 686f  elf._backward_ho
-0000d660: 6f6b 735b 6861 6e64 6c65 2e69 645d 203d  oks[handle.id] =
-0000d670: 2068 6f6f 6b0d 0a20 2020 2020 2020 2069   hook..        i
-0000d680: 6620 7072 6570 656e 643a 0d0a 2020 2020  f prepend:..    
-0000d690: 2020 2020 2020 2020 7365 6c66 2e5f 6261          self._ba
-0000d6a0: 636b 7761 7264 5f68 6f6f 6b73 2e6d 6f76  ckward_hooks.mov
-0000d6b0: 655f 746f 5f65 6e64 2868 616e 646c 652e  e_to_end(handle.
-0000d6c0: 6964 2c20 6c61 7374 3d46 616c 7365 2920  id, last=False) 
-0000d6d0: 2023 2074 7970 653a 2069 676e 6f72 655b   # type: ignore[
-0000d6e0: 6174 7472 2d64 6566 696e 6564 5d0d 0a20  attr-defined].. 
-0000d6f0: 2020 2020 2020 2072 6574 7572 6e20 6861         return ha
-0000d700: 6e64 6c65 0d0a 0d0a 2020 2020 6465 6620  ndle....    def 
-0000d710: 5f67 6574 5f62 6163 6b77 6172 645f 686f  _get_backward_ho
-0000d720: 6f6b 7328 7365 6c66 293a 0d0a 2020 2020  oks(self):..    
-0000d730: 2020 2020 7222 2222 5265 7475 726e 7320      r"""Returns 
-0000d740: 7468 6520 6261 636b 7761 7264 2068 6f6f  the backward hoo
-0000d750: 6b73 2066 6f72 2075 7365 2069 6e20 7468  ks for use in th
-0000d760: 6520 6361 6c6c 2066 756e 6374 696f 6e2e  e call function.
-0000d770: 0d0a 2020 2020 2020 2020 4974 2072 6574  ..        It ret
-0000d780: 7572 6e73 2074 776f 206c 6973 7473 2c20  urns two lists, 
-0000d790: 6f6e 6520 7769 7468 2074 6865 2066 756c  one with the ful
-0000d7a0: 6c20 6261 636b 7761 7264 2068 6f6f 6b73  l backward hooks
-0000d7b0: 2061 6e64 206f 6e65 2077 6974 6820 7468   and one with th
-0000d7c0: 6520 6e6f 6e2d 6675 6c6c 0d0a 2020 2020  e non-full..    
-0000d7d0: 2020 2020 6261 636b 7761 7264 2068 6f6f      backward hoo
-0000d7e0: 6b73 2e0d 0a20 2020 2020 2020 2022 2222  ks...        """
-0000d7f0: 0d0a 2020 2020 2020 2020 6675 6c6c 5f62  ..        full_b
-0000d800: 6163 6b77 6172 645f 686f 6f6b 733a 204c  ackward_hooks: L
-0000d810: 6973 745b 4361 6c6c 6162 6c65 5d20 3d20  ist[Callable] = 
-0000d820: 5b5d 0d0a 2020 2020 2020 2020 6966 2028  []..        if (
-0000d830: 5f67 6c6f 6261 6c5f 6973 5f66 756c 6c5f  _global_is_full_
-0000d840: 6261 636b 7761 7264 5f68 6f6f 6b20 6973  backward_hook is
-0000d850: 2054 7275 6529 3a0d 0a20 2020 2020 2020   True):..       
-0000d860: 2020 2020 2066 756c 6c5f 6261 636b 7761       full_backwa
-0000d870: 7264 5f68 6f6f 6b73 202b 3d20 5f67 6c6f  rd_hooks += _glo
-0000d880: 6261 6c5f 6261 636b 7761 7264 5f68 6f6f  bal_backward_hoo
-0000d890: 6b73 2e76 616c 7565 7328 290d 0a20 2020  ks.values()..   
-0000d8a0: 2020 2020 2069 6620 2873 656c 662e 5f69       if (self._i
-0000d8b0: 735f 6675 6c6c 5f62 6163 6b77 6172 645f  s_full_backward_
-0000d8c0: 686f 6f6b 2069 7320 5472 7565 293a 0d0a  hook is True):..
-0000d8d0: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
-0000d8e0: 5f62 6163 6b77 6172 645f 686f 6f6b 7320  _backward_hooks 
-0000d8f0: 2b3d 2073 656c 662e 5f62 6163 6b77 6172  += self._backwar
-0000d900: 645f 686f 6f6b 732e 7661 6c75 6573 2829  d_hooks.values()
-0000d910: 0d0a 0d0a 2020 2020 2020 2020 6e6f 6e5f  ....        non_
-0000d920: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
-0000d930: 6f6b 733a 204c 6973 745b 4361 6c6c 6162  oks: List[Callab
-0000d940: 6c65 5d20 3d20 5b5d 0d0a 2020 2020 2020  le] = []..      
-0000d950: 2020 6966 2028 5f67 6c6f 6261 6c5f 6973    if (_global_is
-0000d960: 5f66 756c 6c5f 6261 636b 7761 7264 5f68  _full_backward_h
-0000d970: 6f6f 6b20 6973 2046 616c 7365 293a 0d0a  ook is False):..
-0000d980: 2020 2020 2020 2020 2020 2020 6e6f 6e5f              non_
-0000d990: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
-0000d9a0: 6f6b 7320 2b3d 205f 676c 6f62 616c 5f62  oks += _global_b
-0000d9b0: 6163 6b77 6172 645f 686f 6f6b 732e 7661  ackward_hooks.va
-0000d9c0: 6c75 6573 2829 0d0a 2020 2020 2020 2020  lues()..        
-0000d9d0: 6966 2028 7365 6c66 2e5f 6973 5f66 756c  if (self._is_ful
-0000d9e0: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b20  l_backward_hook 
-0000d9f0: 6973 2046 616c 7365 293a 0d0a 2020 2020  is False):..    
-0000da00: 2020 2020 2020 2020 6e6f 6e5f 6675 6c6c          non_full
-0000da10: 5f62 6163 6b77 6172 645f 686f 6f6b 7320  _backward_hooks 
-0000da20: 2b3d 2073 656c 662e 5f62 6163 6b77 6172  += self._backwar
-0000da30: 645f 686f 6f6b 732e 7661 6c75 6573 2829  d_hooks.values()
-0000da40: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-0000da50: 726e 2066 756c 6c5f 6261 636b 7761 7264  rn full_backward
-0000da60: 5f68 6f6f 6b73 2c20 6e6f 6e5f 6675 6c6c  _hooks, non_full
-0000da70: 5f62 6163 6b77 6172 645f 686f 6f6b 730d  _backward_hooks.
-0000da80: 0a0d 0a20 2020 2064 6566 205f 6765 745f  ...    def _get_
-0000da90: 6261 636b 7761 7264 5f70 7265 5f68 6f6f  backward_pre_hoo
-0000daa0: 6b73 2873 656c 6629 3a0d 0a20 2020 2020  ks(self):..     
-0000dab0: 2020 2062 6163 6b77 6172 645f 7072 655f     backward_pre_
-0000dac0: 686f 6f6b 733a 204c 6973 745b 4361 6c6c  hooks: List[Call
-0000dad0: 6162 6c65 5d20 3d20 5b5d 0d0a 2020 2020  able] = []..    
-0000dae0: 2020 2020 6261 636b 7761 7264 5f70 7265      backward_pre
-0000daf0: 5f68 6f6f 6b73 202b 3d20 5f67 6c6f 6261  _hooks += _globa
-0000db00: 6c5f 6261 636b 7761 7264 5f70 7265 5f68  l_backward_pre_h
-0000db10: 6f6f 6b73 2e76 616c 7565 7328 290d 0a20  ooks.values().. 
-0000db20: 2020 2020 2020 2062 6163 6b77 6172 645f         backward_
-0000db30: 7072 655f 686f 6f6b 7320 2b3d 2073 656c  pre_hooks += sel
-0000db40: 662e 5f62 6163 6b77 6172 645f 7072 655f  f._backward_pre_
-0000db50: 686f 6f6b 732e 7661 6c75 6573 2829 0d0a  hooks.values()..
-0000db60: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000db70: 2062 6163 6b77 6172 645f 7072 655f 686f   backward_pre_ho
-0000db80: 6f6b 730d 0a0d 0a20 2020 2064 6566 205f  oks....    def _
-0000db90: 6d61 7962 655f 7761 726e 5f6e 6f6e 5f66  maybe_warn_non_f
-0000dba0: 756c 6c5f 6261 636b 7761 7264 5f68 6f6f  ull_backward_hoo
-0000dbb0: 6b28 7365 6c66 2c20 696e 7075 7473 2c20  k(self, inputs, 
-0000dbc0: 7265 7375 6c74 2c20 6772 6164 5f66 6e29  result, grad_fn)
-0000dbd0: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
-0000dbe0: 7420 6973 696e 7374 616e 6365 2872 6573  t isinstance(res
-0000dbf0: 756c 742c 2074 6f72 6368 2e54 656e 736f  ult, torch.Tenso
-0000dc00: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-0000dc10: 2069 6620 6e6f 7420 2869 7369 6e73 7461   if not (isinsta
-0000dc20: 6e63 6528 7265 7375 6c74 2c20 7475 706c  nce(result, tupl
-0000dc30: 6529 2061 6e64 2061 6c6c 2869 7369 6e73  e) and all(isins
-0000dc40: 7461 6e63 6528 722c 2074 6f72 6368 2e54  tance(r, torch.T
-0000dc50: 656e 736f 7229 2066 6f72 2072 2069 6e20  ensor) for r in 
-0000dc60: 7265 7375 6c74 2929 3a0d 0a20 2020 2020  result)):..     
-0000dc70: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0000dc80: 6e67 732e 7761 726e 2822 5573 696e 6720  ngs.warn("Using 
-0000dc90: 6e6f 6e2d 6675 6c6c 2062 6163 6b77 6172  non-full backwar
-0000dca0: 6420 686f 6f6b 7320 6f6e 2061 204d 6f64  d hooks on a Mod
-0000dcb0: 756c 6520 7468 6174 2064 6f65 7320 6e6f  ule that does no
-0000dcc0: 7420 7265 7475 726e 2061 2022 0d0a 2020  t return a "..  
-0000dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dce0: 2020 2020 2020 2020 2020 2020 2273 696e              "sin
-0000dcf0: 676c 6520 5465 6e73 6f72 206f 7220 6120  gle Tensor or a 
-0000dd00: 7475 706c 6520 6f66 2054 656e 736f 7273  tuple of Tensors
-0000dd10: 2069 7320 6465 7072 6563 6174 6564 2061   is deprecated a
-0000dd20: 6e64 2077 696c 6c20 6265 2072 656d 6f76  nd will be remov
-0000dd30: 6564 2022 0d0a 2020 2020 2020 2020 2020  ed "..          
-0000dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd50: 2020 2020 2269 6e20 6675 7475 7265 2076      "in future v
-0000dd60: 6572 7369 6f6e 732e 2054 6869 7320 686f  ersions. This ho
-0000dd70: 6f6b 2077 696c 6c20 6265 206d 6973 7369  ok will be missi
-0000dd80: 6e67 2073 6f6d 6520 6f66 2074 6865 2067  ng some of the g
-0000dd90: 7261 645f 6f75 7470 7574 2e20 220d 0a20  rad_output. ".. 
-0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddb0: 2020 2020 2020 2020 2020 2020 2022 506c               "Pl
-0000ddc0: 6561 7365 2075 7365 2072 6567 6973 7465  ease use registe
-0000ddd0: 725f 6675 6c6c 5f62 6163 6b77 6172 645f  r_full_backward_
-0000dde0: 686f 6f6b 2074 6f20 6765 7420 7468 6520  hook to get the 
-0000ddf0: 646f 6375 6d65 6e74 6564 2062 6568 6176  documented behav
-0000de00: 696f 722e 2229 0d0a 2020 2020 2020 2020  ior.")..        
-0000de10: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-0000de20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000de30: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000de40: 7420 3d20 2872 6573 756c 742c 290d 0a0d  t = (result,)...
-0000de50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000de60: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
-0000de70: 732c 2074 6f72 6368 2e54 656e 736f 7229  s, torch.Tensor)
-0000de80: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000de90: 6620 6e6f 7420 2869 7369 6e73 7461 6e63  f not (isinstanc
-0000dea0: 6528 696e 7075 7473 2c20 7475 706c 6529  e(inputs, tuple)
-0000deb0: 2061 6e64 2061 6c6c 2869 7369 6e73 7461   and all(isinsta
-0000dec0: 6e63 6528 692c 2074 6f72 6368 2e54 656e  nce(i, torch.Ten
-0000ded0: 736f 7229 2066 6f72 2069 2069 6e20 696e  sor) for i in in
-0000dee0: 7075 7473 2929 3a0d 0a20 2020 2020 2020  puts)):..       
-0000def0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000df00: 732e 7761 726e 2822 5573 696e 6720 6e6f  s.warn("Using no
-0000df10: 6e2d 6675 6c6c 2062 6163 6b77 6172 6420  n-full backward 
-0000df20: 686f 6f6b 7320 6f6e 2061 204d 6f64 756c  hooks on a Modul
-0000df30: 6520 7468 6174 2064 6f65 7320 6e6f 7420  e that does not 
-0000df40: 7461 6b65 2061 7320 696e 7075 7420 6120  take as input a 
-0000df50: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000d5b0: 2020 2020 2020 2020 2020 2022 7369 6e67             "sing
+0000d5c0: 6c65 204d 6f64 756c 652e 2050 6c65 6173  le Module. Pleas
+0000d5d0: 6520 7573 6520 6f6e 6c79 206f 6e65 206f  e use only one o
+0000d5e0: 6620 7468 656d 2e22 290d 0a0d 0a20 2020  f them.")....   
+0000d5f0: 2020 2020 2073 656c 662e 5f69 735f 6675       self._is_fu
+0000d600: 6c6c 5f62 6163 6b77 6172 645f 686f 6f6b  ll_backward_hook
+0000d610: 203d 2054 7275 650d 0a0d 0a20 2020 2020   = True....     
+0000d620: 2020 2068 616e 646c 6520 3d52 656d 6f76     handle =Remov
+0000d630: 6162 6c65 4861 6e64 6c65 2873 656c 662e  ableHandle(self.
+0000d640: 5f62 6163 6b77 6172 645f 686f 6f6b 7329  _backward_hooks)
+0000d650: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0000d660: 6261 636b 7761 7264 5f68 6f6f 6b73 5b68  backward_hooks[h
+0000d670: 616e 646c 652e 6964 5d20 3d20 686f 6f6b  andle.id] = hook
+0000d680: 0d0a 2020 2020 2020 2020 6966 2070 7265  ..        if pre
+0000d690: 7065 6e64 3a0d 0a20 2020 2020 2020 2020  pend:..         
+0000d6a0: 2020 2073 656c 662e 5f62 6163 6b77 6172     self._backwar
+0000d6b0: 645f 686f 6f6b 732e 6d6f 7665 5f74 6f5f  d_hooks.move_to_
+0000d6c0: 656e 6428 6861 6e64 6c65 2e69 642c 206c  end(handle.id, l
+0000d6d0: 6173 743d 4661 6c73 6529 2020 2320 7479  ast=False)  # ty
+0000d6e0: 7065 3a20 6967 6e6f 7265 5b61 7474 722d  pe: ignore[attr-
+0000d6f0: 6465 6669 6e65 645d 0d0a 2020 2020 2020  defined]..      
+0000d700: 2020 7265 7475 726e 2068 616e 646c 650d    return handle.
+0000d710: 0a0d 0a20 2020 2064 6566 205f 6765 745f  ...    def _get_
+0000d720: 6261 636b 7761 7264 5f68 6f6f 6b73 2873  backward_hooks(s
+0000d730: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
+0000d740: 2222 2252 6574 7572 6e73 2074 6865 2062  """Returns the b
+0000d750: 6163 6b77 6172 6420 686f 6f6b 7320 666f  ackward hooks fo
+0000d760: 7220 7573 6520 696e 2074 6865 2063 616c  r use in the cal
+0000d770: 6c20 6675 6e63 7469 6f6e 2e0d 0a20 2020  l function...   
+0000d780: 2020 2020 2049 7420 7265 7475 726e 7320       It returns 
+0000d790: 7477 6f20 6c69 7374 732c 206f 6e65 2077  two lists, one w
+0000d7a0: 6974 6820 7468 6520 6675 6c6c 2062 6163  ith the full bac
+0000d7b0: 6b77 6172 6420 686f 6f6b 7320 616e 6420  kward hooks and 
+0000d7c0: 6f6e 6520 7769 7468 2074 6865 206e 6f6e  one with the non
+0000d7d0: 2d66 756c 6c0d 0a20 2020 2020 2020 2062  -full..        b
+0000d7e0: 6163 6b77 6172 6420 686f 6f6b 732e 0d0a  ackward hooks...
+0000d7f0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0000d800: 2020 2020 2066 756c 6c5f 6261 636b 7761       full_backwa
+0000d810: 7264 5f68 6f6f 6b73 3a20 4c69 7374 5b43  rd_hooks: List[C
+0000d820: 616c 6c61 626c 655d 203d 205b 5d0d 0a20  allable] = [].. 
+0000d830: 2020 2020 2020 2069 6620 285f 676c 6f62         if (_glob
+0000d840: 616c 5f69 735f 6675 6c6c 5f62 6163 6b77  al_is_full_backw
+0000d850: 6172 645f 686f 6f6b 2069 7320 5472 7565  ard_hook is True
+0000d860: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000d870: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
+0000d880: 6f6b 7320 2b3d 205f 676c 6f62 616c 5f62  oks += _global_b
+0000d890: 6163 6b77 6172 645f 686f 6f6b 732e 7661  ackward_hooks.va
+0000d8a0: 6c75 6573 2829 0d0a 2020 2020 2020 2020  lues()..        
+0000d8b0: 6966 2028 7365 6c66 2e5f 6973 5f66 756c  if (self._is_ful
+0000d8c0: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b20  l_backward_hook 
+0000d8d0: 6973 2054 7275 6529 3a0d 0a20 2020 2020  is True):..     
+0000d8e0: 2020 2020 2020 2066 756c 6c5f 6261 636b         full_back
+0000d8f0: 7761 7264 5f68 6f6f 6b73 202b 3d20 7365  ward_hooks += se
+0000d900: 6c66 2e5f 6261 636b 7761 7264 5f68 6f6f  lf._backward_hoo
+0000d910: 6b73 2e76 616c 7565 7328 290d 0a0d 0a20  ks.values().... 
+0000d920: 2020 2020 2020 206e 6f6e 5f66 756c 6c5f         non_full_
+0000d930: 6261 636b 7761 7264 5f68 6f6f 6b73 3a20  backward_hooks: 
+0000d940: 4c69 7374 5b43 616c 6c61 626c 655d 203d  List[Callable] =
+0000d950: 205b 5d0d 0a20 2020 2020 2020 2069 6620   []..        if 
+0000d960: 285f 676c 6f62 616c 5f69 735f 6675 6c6c  (_global_is_full
+0000d970: 5f62 6163 6b77 6172 645f 686f 6f6b 2069  _backward_hook i
+0000d980: 7320 4661 6c73 6529 3a0d 0a20 2020 2020  s False):..     
+0000d990: 2020 2020 2020 206e 6f6e 5f66 756c 6c5f         non_full_
+0000d9a0: 6261 636b 7761 7264 5f68 6f6f 6b73 202b  backward_hooks +
+0000d9b0: 3d20 5f67 6c6f 6261 6c5f 6261 636b 7761  = _global_backwa
+0000d9c0: 7264 5f68 6f6f 6b73 2e76 616c 7565 7328  rd_hooks.values(
+0000d9d0: 290d 0a20 2020 2020 2020 2069 6620 2873  )..        if (s
+0000d9e0: 656c 662e 5f69 735f 6675 6c6c 5f62 6163  elf._is_full_bac
+0000d9f0: 6b77 6172 645f 686f 6f6b 2069 7320 4661  kward_hook is Fa
+0000da00: 6c73 6529 3a0d 0a20 2020 2020 2020 2020  lse):..         
+0000da10: 2020 206e 6f6e 5f66 756c 6c5f 6261 636b     non_full_back
+0000da20: 7761 7264 5f68 6f6f 6b73 202b 3d20 7365  ward_hooks += se
+0000da30: 6c66 2e5f 6261 636b 7761 7264 5f68 6f6f  lf._backward_hoo
+0000da40: 6b73 2e76 616c 7565 7328 290d 0a0d 0a20  ks.values().... 
+0000da50: 2020 2020 2020 2072 6574 7572 6e20 6675         return fu
+0000da60: 6c6c 5f62 6163 6b77 6172 645f 686f 6f6b  ll_backward_hook
+0000da70: 732c 206e 6f6e 5f66 756c 6c5f 6261 636b  s, non_full_back
+0000da80: 7761 7264 5f68 6f6f 6b73 0d0a 0d0a 2020  ward_hooks....  
+0000da90: 2020 6465 6620 5f67 6574 5f62 6163 6b77    def _get_backw
+0000daa0: 6172 645f 7072 655f 686f 6f6b 7328 7365  ard_pre_hooks(se
+0000dab0: 6c66 293a 0d0a 2020 2020 2020 2020 6261  lf):..        ba
+0000dac0: 636b 7761 7264 5f70 7265 5f68 6f6f 6b73  ckward_pre_hooks
+0000dad0: 3a20 4c69 7374 5b43 616c 6c61 626c 655d  : List[Callable]
+0000dae0: 203d 205b 5d0d 0a20 2020 2020 2020 2062   = []..        b
+0000daf0: 6163 6b77 6172 645f 7072 655f 686f 6f6b  ackward_pre_hook
+0000db00: 7320 2b3d 205f 676c 6f62 616c 5f62 6163  s += _global_bac
+0000db10: 6b77 6172 645f 7072 655f 686f 6f6b 732e  kward_pre_hooks.
+0000db20: 7661 6c75 6573 2829 0d0a 2020 2020 2020  values()..      
+0000db30: 2020 6261 636b 7761 7264 5f70 7265 5f68    backward_pre_h
+0000db40: 6f6f 6b73 202b 3d20 7365 6c66 2e5f 6261  ooks += self._ba
+0000db50: 636b 7761 7264 5f70 7265 5f68 6f6f 6b73  ckward_pre_hooks
+0000db60: 2e76 616c 7565 7328 290d 0a0d 0a20 2020  .values()....   
+0000db70: 2020 2020 2072 6574 7572 6e20 6261 636b       return back
+0000db80: 7761 7264 5f70 7265 5f68 6f6f 6b73 0d0a  ward_pre_hooks..
+0000db90: 0d0a 2020 2020 6465 6620 5f6d 6179 6265  ..    def _maybe
+0000dba0: 5f77 6172 6e5f 6e6f 6e5f 6675 6c6c 5f62  _warn_non_full_b
+0000dbb0: 6163 6b77 6172 645f 686f 6f6b 2873 656c  ackward_hook(sel
+0000dbc0: 662c 2069 6e70 7574 732c 2072 6573 756c  f, inputs, resul
+0000dbd0: 742c 2067 7261 645f 666e 293a 0d0a 2020  t, grad_fn):..  
+0000dbe0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0000dbf0: 6e73 7461 6e63 6528 7265 7375 6c74 2c20  nstance(result, 
+0000dc00: 746f 7263 682e 5465 6e73 6f72 293a 0d0a  torch.Tensor):..
+0000dc10: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000dc20: 6f74 2028 6973 696e 7374 616e 6365 2872  ot (isinstance(r
+0000dc30: 6573 756c 742c 2074 7570 6c65 2920 616e  esult, tuple) an
+0000dc40: 6420 616c 6c28 6973 696e 7374 616e 6365  d all(isinstance
+0000dc50: 2872 2c20 746f 7263 682e 5465 6e73 6f72  (r, torch.Tensor
+0000dc60: 2920 666f 7220 7220 696e 2072 6573 756c  ) for r in resul
+0000dc70: 7429 293a 0d0a 2020 2020 2020 2020 2020  t)):..          
+0000dc80: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+0000dc90: 6172 6e28 2255 7369 6e67 206e 6f6e 2d66  arn("Using non-f
+0000dca0: 756c 6c20 6261 636b 7761 7264 2068 6f6f  ull backward hoo
+0000dcb0: 6b73 206f 6e20 6120 4d6f 6475 6c65 2074  ks on a Module t
+0000dcc0: 6861 7420 646f 6573 206e 6f74 2072 6574  hat does not ret
+0000dcd0: 7572 6e20 6120 220d 0a20 2020 2020 2020  urn a "..       
+0000dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcf0: 2020 2020 2020 2022 7369 6e67 6c65 2054         "single T
+0000dd00: 656e 736f 7220 6f72 2061 2074 7570 6c65  ensor or a tuple
+0000dd10: 206f 6620 5465 6e73 6f72 7320 6973 2064   of Tensors is d
+0000dd20: 6570 7265 6361 7465 6420 616e 6420 7769  eprecated and wi
+0000dd30: 6c6c 2062 6520 7265 6d6f 7665 6420 220d  ll be removed ".
+0000dd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd50: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000dd60: 696e 2066 7574 7572 6520 7665 7273 696f  in future versio
+0000dd70: 6e73 2e20 5468 6973 2068 6f6f 6b20 7769  ns. This hook wi
+0000dd80: 6c6c 2062 6520 6d69 7373 696e 6720 736f  ll be missing so
+0000dd90: 6d65 206f 6620 7468 6520 6772 6164 5f6f  me of the grad_o
+0000dda0: 7574 7075 742e 2022 0d0a 2020 2020 2020  utput. "..      
+0000ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddc0: 2020 2020 2020 2020 2250 6c65 6173 6520          "Please 
+0000ddd0: 7573 6520 7265 6769 7374 6572 5f66 756c  use register_ful
+0000dde0: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b20  l_backward_hook 
+0000ddf0: 746f 2067 6574 2074 6865 2064 6f63 756d  to get the docum
+0000de00: 656e 7465 6420 6265 6861 7669 6f72 2e22  ented behavior."
+0000de10: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000de20: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+0000de30: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000de40: 2020 2020 2020 7265 7375 6c74 203d 2028        result = (
+0000de50: 7265 7375 6c74 2c29 0d0a 0d0a 2020 2020  result,)....    
+0000de60: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+0000de70: 7461 6e63 6528 696e 7075 7473 2c20 746f  tance(inputs, to
+0000de80: 7263 682e 5465 6e73 6f72 293a 0d0a 2020  rch.Tensor):..  
+0000de90: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000dea0: 2028 6973 696e 7374 616e 6365 2869 6e70   (isinstance(inp
+0000deb0: 7574 732c 2074 7570 6c65 2920 616e 6420  uts, tuple) and 
+0000dec0: 616c 6c28 6973 696e 7374 616e 6365 2869  all(isinstance(i
+0000ded0: 2c20 746f 7263 682e 5465 6e73 6f72 2920  , torch.Tensor) 
+0000dee0: 666f 7220 6920 696e 2069 6e70 7574 7329  for i in inputs)
+0000def0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000df00: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0000df10: 6e28 2255 7369 6e67 206e 6f6e 2d66 756c  n("Using non-ful
+0000df20: 6c20 6261 636b 7761 7264 2068 6f6f 6b73  l backward hooks
+0000df30: 206f 6e20 6120 4d6f 6475 6c65 2074 6861   on a Module tha
+0000df40: 7420 646f 6573 206e 6f74 2074 616b 6520  t does not take 
+0000df50: 6173 2069 6e70 7574 2061 2022 0d0a 2020  as input a "..  
 0000df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df70: 2022 7369 6e67 6c65 2054 656e 736f 7220   "single Tensor 
-0000df80: 6f72 2061 2074 7570 6c65 206f 6620 5465  or a tuple of Te
-0000df90: 6e73 6f72 7320 6973 2064 6570 7265 6361  nsors is depreca
-0000dfa0: 7465 6420 616e 6420 7769 6c6c 2062 6520  ted and will be 
-0000dfb0: 7265 6d6f 7665 6420 220d 0a20 2020 2020  removed "..     
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 2020 2020 2020 2020 2022 696e 2066 7574           "in fut
-0000dfe0: 7572 6520 7665 7273 696f 6e73 2e20 5468  ure versions. Th
-0000dff0: 6973 2068 6f6f 6b20 7769 6c6c 2062 6520  is hook will be 
-0000e000: 6d69 7373 696e 6720 736f 6d65 206f 6620  missing some of 
-0000e010: 7468 6520 6772 6164 5f69 6e70 7574 2e20  the grad_input. 
-0000e020: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000df70: 2020 2020 2020 2020 2020 2020 2273 696e              "sin
+0000df80: 676c 6520 5465 6e73 6f72 206f 7220 6120  gle Tensor or a 
+0000df90: 7475 706c 6520 6f66 2054 656e 736f 7273  tuple of Tensors
+0000dfa0: 2069 7320 6465 7072 6563 6174 6564 2061   is deprecated a
+0000dfb0: 6e64 2077 696c 6c20 6265 2072 656d 6f76  nd will be remov
+0000dfc0: 6564 2022 0d0a 2020 2020 2020 2020 2020  ed "..          
+0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfe0: 2020 2020 2269 6e20 6675 7475 7265 2076      "in future v
+0000dff0: 6572 7369 6f6e 732e 2054 6869 7320 686f  ersions. This ho
+0000e000: 6f6b 2077 696c 6c20 6265 206d 6973 7369  ok will be missi
+0000e010: 6e67 2073 6f6d 6520 6f66 2074 6865 2067  ng some of the g
+0000e020: 7261 645f 696e 7075 742e 2022 0d0a 2020  rad_input. "..  
 0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e040: 2022 506c 6561 7365 2075 7365 2072 6567   "Please use reg
-0000e050: 6973 7465 725f 6675 6c6c 5f62 6163 6b77  ister_full_backw
-0000e060: 6172 645f 686f 6f6b 2074 6f20 6765 7420  ard_hook to get 
-0000e070: 7468 6520 646f 6375 6d65 6e74 6564 2062  the documented b
-0000e080: 6568 6176 696f 722e 2229 0d0a 2020 2020  ehavior.")..    
-0000e090: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e0a0: 726e 0d0a 2020 2020 2020 2020 656c 7365  rn..        else
-0000e0b0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000e0c0: 6e70 7574 7320 3d20 2869 6e70 7574 732c  nputs = (inputs,
-0000e0d0: 290d 0a0d 0a20 2020 2020 2020 2023 2041  )....        # A
-0000e0e0: 7420 7468 6973 2070 6f69 6e74 2077 6520  t this point we 
-0000e0f0: 6172 6520 7375 7265 2074 6861 7420 696e  are sure that in
-0000e100: 7075 7473 2061 6e64 2072 6573 756c 7420  puts and result 
-0000e110: 6172 6520 7475 706c 6520 6f66 2054 656e  are tuple of Ten
-0000e120: 736f 7273 0d0a 2020 2020 2020 2020 6f75  sors..        ou
-0000e130: 745f 6772 6164 5f66 6e20 3d20 7b72 2e67  t_grad_fn = {r.g
-0000e140: 7261 645f 666e 2066 6f72 2072 2069 6e20  rad_fn for r in 
-0000e150: 7265 7375 6c74 2069 6620 722e 6772 6164  result if r.grad
-0000e160: 5f66 6e20 6973 206e 6f74 204e 6f6e 657d  _fn is not None}
-0000e170: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-0000e180: 286f 7574 5f67 7261 645f 666e 2920 3d3d  (out_grad_fn) ==
-0000e190: 2030 206f 7220 286c 656e 286f 7574 5f67   0 or (len(out_g
-0000e1a0: 7261 645f 666e 2920 3d3d 2031 2061 6e64  rad_fn) == 1 and
-0000e1b0: 2067 7261 645f 666e 206e 6f74 2069 6e20   grad_fn not in 
-0000e1c0: 6f75 745f 6772 6164 5f66 6e29 3a0d 0a20  out_grad_fn):.. 
-0000e1d0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0000e1e0: 6e67 732e 7761 726e 2822 5573 696e 6720  ngs.warn("Using 
-0000e1f0: 6120 6e6f 6e2d 6675 6c6c 2062 6163 6b77  a non-full backw
-0000e200: 6172 6420 686f 6f6b 2077 6865 6e20 6f75  ard hook when ou
-0000e210: 7470 7574 7320 6172 6520 6e65 7374 6564  tputs are nested
-0000e220: 2069 6e20 7079 7468 6f6e 2064 6174 6120   in python data 
-0000e230: 7374 7275 6374 7572 6520 220d 0a20 2020  structure "..   
-0000e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e250: 2020 2020 2020 2022 6973 2064 6570 7265         "is depre
-0000e260: 6361 7465 6420 616e 6420 7769 6c6c 2062  cated and will b
-0000e270: 6520 7265 6d6f 7665 6420 696e 2066 7574  e removed in fut
-0000e280: 7572 6520 7665 7273 696f 6e73 2e20 5468  ure versions. Th
-0000e290: 6973 2068 6f6f 6b20 7769 6c6c 2062 6520  is hook will be 
-0000e2a0: 6d69 7373 696e 6720 220d 0a20 2020 2020  missing "..     
-0000e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2c0: 2020 2020 2022 736f 6d65 2067 7261 645f       "some grad_
-0000e2d0: 6f75 7470 7574 2e22 290d 0a20 2020 2020  output.")..     
-0000e2e0: 2020 2065 6c69 6620 6c65 6e28 6f75 745f     elif len(out_
-0000e2f0: 6772 6164 5f66 6e29 203e 2031 3a0d 0a20  grad_fn) > 1:.. 
-0000e300: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0000e310: 6e67 732e 7761 726e 2822 5573 696e 6720  ngs.warn("Using 
-0000e320: 6120 6e6f 6e2d 6675 6c6c 2062 6163 6b77  a non-full backw
-0000e330: 6172 6420 686f 6f6b 2077 6865 6e20 6f75  ard hook when ou
-0000e340: 7470 7574 7320 6172 6520 6765 6e65 7261  tputs are genera
-0000e350: 7465 6420 6279 2064 6966 6665 7265 6e74  ted by different
-0000e360: 2061 7574 6f67 7261 6420 4e6f 6465 7320   autograd Nodes 
-0000e370: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-0000e380: 2020 2020 2020 2020 2020 2020 2022 6973               "is
-0000e390: 2064 6570 7265 6361 7465 6420 616e 6420   deprecated and 
-0000e3a0: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
-0000e3b0: 696e 2066 7574 7572 6520 7665 7273 696f  in future versio
-0000e3c0: 6e73 2e20 5468 6973 2068 6f6f 6b20 7769  ns. This hook wi
-0000e3d0: 6c6c 2062 6520 6d69 7373 696e 6720 220d  ll be missing ".
-0000e3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e3f0: 2020 2020 2020 2020 2020 2022 736f 6d65             "some
-0000e400: 2067 7261 645f 6f75 7470 7574 2e20 506c   grad_output. Pl
-0000e410: 6561 7365 2075 7365 2072 6567 6973 7465  ease use registe
-0000e420: 725f 6675 6c6c 5f62 6163 6b77 6172 645f  r_full_backward_
-0000e430: 686f 6f6b 2074 6f20 6765 7420 7468 6520  hook to get the 
-0000e440: 646f 6375 6d65 6e74 6564 2062 6568 6176  documented behav
-0000e450: 696f 722e 2229 0d0a 2020 2020 2020 2020  ior.")..        
-0000e460: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000e470: 2020 2023 2041 7420 7468 6973 2070 6f69     # At this poi
-0000e480: 6e74 2074 6865 2067 7261 645f 6f75 7075  nt the grad_oupu
-0000e490: 7420 7061 7274 206f 6620 7468 6520 686f  t part of the ho
-0000e4a0: 6f6b 2077 696c 6c20 6d6f 7374 206c 696b  ok will most lik
-0000e4b0: 656c 7920 6265 2063 6f72 7265 6374 0d0a  ely be correct..
-0000e4c0: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-0000e4d0: 7473 5f67 7261 645f 666e 203d 207b 692e  ts_grad_fn = {i.
-0000e4e0: 6772 6164 5f66 6e20 666f 7220 6920 696e  grad_fn for i in
-0000e4f0: 2069 6e70 7574 7320 6966 2069 2e67 7261   inputs if i.gra
-0000e500: 645f 666e 2069 7320 6e6f 7420 4e6f 6e65  d_fn is not None
-0000e510: 7d0d 0a0d 0a20 2020 2020 2020 2020 2020  }....           
-0000e520: 206e 6578 745f 6675 6e63 7469 6f6e 7320   next_functions 
-0000e530: 3d20 7b6e 5b30 5d20 666f 7220 6e20 696e  = {n[0] for n in
-0000e540: 2067 7261 645f 666e 2e6e 6578 745f 6675   grad_fn.next_fu
-0000e550: 6e63 7469 6f6e 737d 0d0a 0d0a 2020 2020  nctions}....    
-0000e560: 2020 2020 2020 2020 6966 2069 6e70 7574          if input
-0000e570: 735f 6772 6164 5f66 6e20 213d 206e 6578  s_grad_fn != nex
-0000e580: 745f 6675 6e63 7469 6f6e 733a 0d0a 2020  t_functions:..  
-0000e590: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0000e5a0: 726e 696e 6773 2e77 6172 6e28 2255 7369  rnings.warn("Usi
-0000e5b0: 6e67 2061 206e 6f6e 2d66 756c 6c20 6261  ng a non-full ba
-0000e5c0: 636b 7761 7264 2068 6f6f 6b20 7768 656e  ckward hook when
-0000e5d0: 2074 6865 2066 6f72 7761 7264 2063 6f6e   the forward con
-0000e5e0: 7461 696e 7320 6d75 6c74 6970 6c65 2061  tains multiple a
-0000e5f0: 7574 6f67 7261 6420 4e6f 6465 7320 220d  utograd Nodes ".
-0000e600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e610: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000e620: 6973 2064 6570 7265 6361 7465 6420 616e  is deprecated an
-0000e630: 6420 7769 6c6c 2062 6520 7265 6d6f 7665  d will be remove
-0000e640: 6420 696e 2066 7574 7572 6520 7665 7273  d in future vers
-0000e650: 696f 6e73 2e20 5468 6973 2068 6f6f 6b20  ions. This hook 
-0000e660: 7769 6c6c 2062 6520 6d69 7373 696e 6720  will be missing 
-0000e670: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000e040: 2020 2020 2020 2020 2020 2020 2250 6c65              "Ple
+0000e050: 6173 6520 7573 6520 7265 6769 7374 6572  ase use register
+0000e060: 5f66 756c 6c5f 6261 636b 7761 7264 5f68  _full_backward_h
+0000e070: 6f6f 6b20 746f 2067 6574 2074 6865 2064  ook to get the d
+0000e080: 6f63 756d 656e 7465 6420 6265 6861 7669  ocumented behavi
+0000e090: 6f72 2e22 290d 0a20 2020 2020 2020 2020  or.")..         
+0000e0a0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+0000e0b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000e0c0: 2020 2020 2020 2020 2020 696e 7075 7473            inputs
+0000e0d0: 203d 2028 696e 7075 7473 2c29 0d0a 0d0a   = (inputs,)....
+0000e0e0: 2020 2020 2020 2020 2320 4174 2074 6869          # At thi
+0000e0f0: 7320 706f 696e 7420 7765 2061 7265 2073  s point we are s
+0000e100: 7572 6520 7468 6174 2069 6e70 7574 7320  ure that inputs 
+0000e110: 616e 6420 7265 7375 6c74 2061 7265 2074  and result are t
+0000e120: 7570 6c65 206f 6620 5465 6e73 6f72 730d  uple of Tensors.
+0000e130: 0a20 2020 2020 2020 206f 7574 5f67 7261  .        out_gra
+0000e140: 645f 666e 203d 207b 722e 6772 6164 5f66  d_fn = {r.grad_f
+0000e150: 6e20 666f 7220 7220 696e 2072 6573 756c  n for r in resul
+0000e160: 7420 6966 2072 2e67 7261 645f 666e 2069  t if r.grad_fn i
+0000e170: 7320 6e6f 7420 4e6f 6e65 7d0d 0a20 2020  s not None}..   
+0000e180: 2020 2020 2069 6620 6c65 6e28 6f75 745f       if len(out_
+0000e190: 6772 6164 5f66 6e29 203d 3d20 3020 6f72  grad_fn) == 0 or
+0000e1a0: 2028 6c65 6e28 6f75 745f 6772 6164 5f66   (len(out_grad_f
+0000e1b0: 6e29 203d 3d20 3120 616e 6420 6772 6164  n) == 1 and grad
+0000e1c0: 5f66 6e20 6e6f 7420 696e 206f 7574 5f67  _fn not in out_g
+0000e1d0: 7261 645f 666e 293a 0d0a 2020 2020 2020  rad_fn):..      
+0000e1e0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+0000e1f0: 6172 6e28 2255 7369 6e67 2061 206e 6f6e  arn("Using a non
+0000e200: 2d66 756c 6c20 6261 636b 7761 7264 2068  -full backward h
+0000e210: 6f6f 6b20 7768 656e 206f 7574 7075 7473  ook when outputs
+0000e220: 2061 7265 206e 6573 7465 6420 696e 2070   are nested in p
+0000e230: 7974 686f 6e20 6461 7461 2073 7472 7563  ython data struc
+0000e240: 7475 7265 2022 0d0a 2020 2020 2020 2020  ture "..        
+0000e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e260: 2020 2269 7320 6465 7072 6563 6174 6564    "is deprecated
+0000e270: 2061 6e64 2077 696c 6c20 6265 2072 656d   and will be rem
+0000e280: 6f76 6564 2069 6e20 6675 7475 7265 2076  oved in future v
+0000e290: 6572 7369 6f6e 732e 2054 6869 7320 686f  ersions. This ho
+0000e2a0: 6f6b 2077 696c 6c20 6265 206d 6973 7369  ok will be missi
+0000e2b0: 6e67 2022 0d0a 2020 2020 2020 2020 2020  ng "..          
+0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2d0: 2273 6f6d 6520 6772 6164 5f6f 7574 7075  "some grad_outpu
+0000e2e0: 742e 2229 0d0a 2020 2020 2020 2020 656c  t.")..        el
+0000e2f0: 6966 206c 656e 286f 7574 5f67 7261 645f  if len(out_grad_
+0000e300: 666e 2920 3e20 313a 0d0a 2020 2020 2020  fn) > 1:..      
+0000e310: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+0000e320: 6172 6e28 2255 7369 6e67 2061 206e 6f6e  arn("Using a non
+0000e330: 2d66 756c 6c20 6261 636b 7761 7264 2068  -full backward h
+0000e340: 6f6f 6b20 7768 656e 206f 7574 7075 7473  ook when outputs
+0000e350: 2061 7265 2067 656e 6572 6174 6564 2062   are generated b
+0000e360: 7920 6469 6666 6572 656e 7420 6175 746f  y different auto
+0000e370: 6772 6164 204e 6f64 6573 2022 0d0a 2020  grad Nodes "..  
+0000e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e390: 2020 2020 2020 2020 2269 7320 6465 7072          "is depr
+0000e3a0: 6563 6174 6564 2061 6e64 2077 696c 6c20  ecated and will 
+0000e3b0: 6265 2072 656d 6f76 6564 2069 6e20 6675  be removed in fu
+0000e3c0: 7475 7265 2076 6572 7369 6f6e 732e 2054  ture versions. T
+0000e3d0: 6869 7320 686f 6f6b 2077 696c 6c20 6265  his hook will be
+0000e3e0: 206d 6973 7369 6e67 2022 0d0a 2020 2020   missing "..    
+0000e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e400: 2020 2020 2020 2273 6f6d 6520 6772 6164        "some grad
+0000e410: 5f6f 7574 7075 742e 2050 6c65 6173 6520  _output. Please 
+0000e420: 7573 6520 7265 6769 7374 6572 5f66 756c  use register_ful
+0000e430: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b20  l_backward_hook 
+0000e440: 746f 2067 6574 2074 6865 2064 6f63 756d  to get the docum
+0000e450: 656e 7465 6420 6265 6861 7669 6f72 2e22  ented behavior."
+0000e460: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0000e470: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000e480: 4174 2074 6869 7320 706f 696e 7420 7468  At this point th
+0000e490: 6520 6772 6164 5f6f 7570 7574 2070 6172  e grad_ouput par
+0000e4a0: 7420 6f66 2074 6865 2068 6f6f 6b20 7769  t of the hook wi
+0000e4b0: 6c6c 206d 6f73 7420 6c69 6b65 6c79 2062  ll most likely b
+0000e4c0: 6520 636f 7272 6563 740d 0a20 2020 2020  e correct..     
+0000e4d0: 2020 2020 2020 2069 6e70 7574 735f 6772         inputs_gr
+0000e4e0: 6164 5f66 6e20 3d20 7b69 2e67 7261 645f  ad_fn = {i.grad_
+0000e4f0: 666e 2066 6f72 2069 2069 6e20 696e 7075  fn for i in inpu
+0000e500: 7473 2069 6620 692e 6772 6164 5f66 6e20  ts if i.grad_fn 
+0000e510: 6973 206e 6f74 204e 6f6e 657d 0d0a 0d0a  is not None}....
+0000e520: 2020 2020 2020 2020 2020 2020 6e65 7874              next
+0000e530: 5f66 756e 6374 696f 6e73 203d 207b 6e5b  _functions = {n[
+0000e540: 305d 2066 6f72 206e 2069 6e20 6772 6164  0] for n in grad
+0000e550: 5f66 6e2e 6e65 7874 5f66 756e 6374 696f  _fn.next_functio
+0000e560: 6e73 7d0d 0a0d 0a20 2020 2020 2020 2020  ns}....         
+0000e570: 2020 2069 6620 696e 7075 7473 5f67 7261     if inputs_gra
+0000e580: 645f 666e 2021 3d20 6e65 7874 5f66 756e  d_fn != next_fun
+0000e590: 6374 696f 6e73 3a0d 0a20 2020 2020 2020  ctions:..       
+0000e5a0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0000e5b0: 732e 7761 726e 2822 5573 696e 6720 6120  s.warn("Using a 
+0000e5c0: 6e6f 6e2d 6675 6c6c 2062 6163 6b77 6172  non-full backwar
+0000e5d0: 6420 686f 6f6b 2077 6865 6e20 7468 6520  d hook when the 
+0000e5e0: 666f 7277 6172 6420 636f 6e74 6169 6e73  forward contains
+0000e5f0: 206d 756c 7469 706c 6520 6175 746f 6772   multiple autogr
+0000e600: 6164 204e 6f64 6573 2022 0d0a 2020 2020  ad Nodes "..    
+0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e620: 2020 2020 2020 2020 2020 2269 7320 6465            "is de
+0000e630: 7072 6563 6174 6564 2061 6e64 2077 696c  precated and wil
+0000e640: 6c20 6265 2072 656d 6f76 6564 2069 6e20  l be removed in 
+0000e650: 6675 7475 7265 2076 6572 7369 6f6e 732e  future versions.
+0000e660: 2054 6869 7320 686f 6f6b 2077 696c 6c20   This hook will 
+0000e670: 6265 206d 6973 7369 6e67 2022 0d0a 2020  be missing "..  
 0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e690: 2022 736f 6d65 2067 7261 645f 696e 7075   "some grad_inpu
-0000e6a0: 742e 2050 6c65 6173 6520 7573 6520 7265  t. Please use re
-0000e6b0: 6769 7374 6572 5f66 756c 6c5f 6261 636b  gister_full_back
-0000e6c0: 7761 7264 5f68 6f6f 6b20 746f 2067 6574  ward_hook to get
-0000e6d0: 2074 6865 2064 6f63 756d 656e 7465 6420   the documented 
-0000e6e0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000e690: 2020 2020 2020 2020 2020 2020 2273 6f6d              "som
+0000e6a0: 6520 6772 6164 5f69 6e70 7574 2e20 506c  e grad_input. Pl
+0000e6b0: 6561 7365 2075 7365 2072 6567 6973 7465  ease use registe
+0000e6c0: 725f 6675 6c6c 5f62 6163 6b77 6172 645f  r_full_backward_
+0000e6d0: 686f 6f6b 2074 6f20 6765 7420 7468 6520  hook to get the 
+0000e6e0: 646f 6375 6d65 6e74 6564 2022 0d0a 2020  documented "..  
 0000e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e700: 2022 6265 6861 7669 6f72 2e22 290d 0a0d   "behavior.")...
-0000e710: 0a20 2020 2064 6566 2072 6567 6973 7465  .    def registe
-0000e720: 725f 666f 7277 6172 645f 7072 655f 686f  r_forward_pre_ho
-0000e730: 6f6b 280d 0a20 2020 2020 2020 2073 656c  ok(..        sel
-0000e740: 662c 0d0a 2020 2020 2020 2020 686f 6f6b  f,..        hook
-0000e750: 3a20 556e 696f 6e5b 0d0a 2020 2020 2020  : Union[..      
-0000e760: 2020 2020 2020 4361 6c6c 6162 6c65 5b5b        Callable[[
-0000e770: 542c 2054 7570 6c65 5b41 6e79 2c20 2e2e  T, Tuple[Any, ..
-0000e780: 2e5d 5d2c 204f 7074 696f 6e61 6c5b 416e  .]], Optional[An
-0000e790: 795d 5d2c 0d0a 2020 2020 2020 2020 2020  y]],..          
-0000e7a0: 2020 4361 6c6c 6162 6c65 5b5b 542c 2054    Callable[[T, T
-0000e7b0: 7570 6c65 5b41 6e79 2c20 2e2e 2e5d 2c20  uple[Any, ...], 
-0000e7c0: 4469 6374 5b73 7472 2c20 416e 795d 5d2c  Dict[str, Any]],
-0000e7d0: 204f 7074 696f 6e61 6c5b 5475 706c 655b   Optional[Tuple[
-0000e7e0: 416e 792c 2044 6963 745b 7374 722c 2041  Any, Dict[str, A
-0000e7f0: 6e79 5d5d 5d5d 2c0d 0a20 2020 2020 2020  ny]]]],..       
-0000e800: 205d 2c0d 0a20 2020 2020 2020 202a 2c0d   ],..        *,.
-0000e810: 0a20 2020 2020 2020 2070 7265 7065 6e64  .        prepend
-0000e820: 3a20 626f 6f6c 203d 2046 616c 7365 2c0d  : bool = False,.
-0000e830: 0a20 2020 2020 2020 2077 6974 685f 6b77  .        with_kw
-0000e840: 6172 6773 3a20 626f 6f6c 203d 2046 616c  args: bool = Fal
-0000e850: 7365 2c0d 0a20 2020 2029 202d 3e20 5265  se,..    ) -> Re
-0000e860: 6d6f 7661 626c 6548 616e 646c 653a 0d0a  movableHandle:..
-0000e870: 2020 2020 2020 2020 7222 2222 5265 6769          r"""Regi
-0000e880: 7374 6572 7320 6120 666f 7277 6172 6420  sters a forward 
-0000e890: 7072 652d 686f 6f6b 206f 6e20 7468 6520  pre-hook on the 
-0000e8a0: 6d6f 6475 6c65 2e0d 0a0d 0a20 2020 2020  module.....     
-0000e8b0: 2020 2054 6865 2068 6f6f 6b20 7769 6c6c     The hook will
-0000e8c0: 2062 6520 6361 6c6c 6564 2065 7665 7279   be called every
-0000e8d0: 2074 696d 6520 6265 666f 7265 203a 6675   time before :fu
-0000e8e0: 6e63 3a60 666f 7277 6172 6460 2069 7320  nc:`forward` is 
-0000e8f0: 696e 766f 6b65 642e 0d0a 0d0a 0d0a 2020  invoked.......  
-0000e900: 2020 2020 2020 4966 2060 6077 6974 685f        If ``with_
-0000e910: 6b77 6172 6773 6060 2069 7320 6661 6c73  kwargs`` is fals
-0000e920: 6520 6f72 206e 6f74 2073 7065 6369 6669  e or not specifi
-0000e930: 6564 2c20 7468 6520 696e 7075 7420 636f  ed, the input co
-0000e940: 6e74 6169 6e73 206f 6e6c 790d 0a20 2020  ntains only..   
-0000e950: 2020 2020 2074 6865 2070 6f73 6974 696f       the positio
-0000e960: 6e61 6c20 6172 6775 6d65 6e74 7320 6769  nal arguments gi
-0000e970: 7665 6e20 746f 2074 6865 206d 6f64 756c  ven to the modul
-0000e980: 652e 204b 6579 776f 7264 2061 7267 756d  e. Keyword argum
-0000e990: 656e 7473 2077 6f6e 2774 2062 650d 0a20  ents won't be.. 
-0000e9a0: 2020 2020 2020 2070 6173 7365 6420 746f         passed to
-0000e9b0: 2074 6865 2068 6f6f 6b73 2061 6e64 206f   the hooks and o
-0000e9c0: 6e6c 7920 746f 2074 6865 2060 6066 6f72  nly to the ``for
-0000e9d0: 7761 7264 6060 2e20 5468 6520 686f 6f6b  ward``. The hook
-0000e9e0: 2063 616e 206d 6f64 6966 7920 7468 650d   can modify the.
-0000e9f0: 0a20 2020 2020 2020 2069 6e70 7574 2e20  .        input. 
-0000ea00: 5573 6572 2063 616e 2065 6974 6865 7220  User can either 
-0000ea10: 7265 7475 726e 2061 2074 7570 6c65 206f  return a tuple o
-0000ea20: 7220 6120 7369 6e67 6c65 206d 6f64 6966  r a single modif
-0000ea30: 6965 6420 7661 6c75 6520 696e 2074 6865  ied value in the
-0000ea40: 0d0a 2020 2020 2020 2020 686f 6f6b 2e20  ..        hook. 
-0000ea50: 5765 2077 696c 6c20 7772 6170 2074 6865  We will wrap the
-0000ea60: 2076 616c 7565 2069 6e74 6f20 6120 7475   value into a tu
-0000ea70: 706c 6520 6966 2061 2073 696e 676c 6520  ple if a single 
-0000ea80: 7661 6c75 6520 6973 2072 6574 7572 6e65  value is returne
-0000ea90: 640d 0a20 2020 2020 2020 2028 756e 6c65  d..        (unle
-0000eaa0: 7373 2074 6861 7420 7661 6c75 6520 6973  ss that value is
-0000eab0: 2061 6c72 6561 6479 2061 2074 7570 6c65   already a tuple
-0000eac0: 292e 2054 6865 2068 6f6f 6b20 7368 6f75  ). The hook shou
-0000ead0: 6c64 2068 6176 6520 7468 650d 0a20 2020  ld have the..   
-0000eae0: 2020 2020 2066 6f6c 6c6f 7769 6e67 2073       following s
-0000eaf0: 6967 6e61 7475 7265 3a3a 0d0a 0d0a 2020  ignature::....  
-0000eb00: 2020 2020 2020 2020 2020 686f 6f6b 286d            hook(m
-0000eb10: 6f64 756c 652c 2061 7267 7329 202d 3e20  odule, args) -> 
-0000eb20: 4e6f 6e65 206f 7220 6d6f 6469 6669 6564  None or modified
-0000eb30: 2069 6e70 7574 0d0a 0d0a 2020 2020 2020   input....      
-0000eb40: 2020 4966 2060 6077 6974 685f 6b77 6172    If ``with_kwar
-0000eb50: 6773 6060 2069 7320 7472 7565 2c20 7468  gs`` is true, th
-0000eb60: 6520 666f 7277 6172 6420 7072 652d 686f  e forward pre-ho
-0000eb70: 6f6b 2077 696c 6c20 6265 2070 6173 7365  ok will be passe
-0000eb80: 6420 7468 650d 0a20 2020 2020 2020 206b  d the..        k
-0000eb90: 7761 7267 7320 6769 7665 6e20 746f 2074  wargs given to t
-0000eba0: 6865 2066 6f72 7761 7264 2066 756e 6374  he forward funct
-0000ebb0: 696f 6e2e 2041 6e64 2069 6620 7468 6520  ion. And if the 
-0000ebc0: 686f 6f6b 206d 6f64 6966 6965 7320 7468  hook modifies th
-0000ebd0: 650d 0a20 2020 2020 2020 2069 6e70 7574  e..        input
-0000ebe0: 2c20 626f 7468 2074 6865 2061 7267 7320  , both the args 
-0000ebf0: 616e 6420 6b77 6172 6773 2073 686f 756c  and kwargs shoul
-0000ec00: 6420 6265 2072 6574 7572 6e65 642e 2054  d be returned. T
-0000ec10: 6865 2068 6f6f 6b20 7368 6f75 6c64 2068  he hook should h
-0000ec20: 6176 650d 0a20 2020 2020 2020 2074 6865  ave..        the
-0000ec30: 2066 6f6c 6c6f 7769 6e67 2073 6967 6e61   following signa
-0000ec40: 7475 7265 3a3a 0d0a 0d0a 2020 2020 2020  ture::....      
-0000ec50: 2020 2020 2020 686f 6f6b 286d 6f64 756c        hook(modul
-0000ec60: 652c 2061 7267 732c 206b 7761 7267 7329  e, args, kwargs)
-0000ec70: 202d 3e20 4e6f 6e65 206f 7220 6120 7475   -> None or a tu
-0000ec80: 706c 6520 6f66 206d 6f64 6966 6965 6420  ple of modified 
-0000ec90: 696e 7075 7420 616e 6420 6b77 6172 6773  input and kwargs
-0000eca0: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
-0000ecb0: 3a0d 0a20 2020 2020 2020 2020 2020 2068  :..            h
-0000ecc0: 6f6f 6b20 2843 616c 6c61 626c 6529 3a20  ook (Callable): 
-0000ecd0: 5468 6520 7573 6572 2064 6566 696e 6564  The user defined
-0000ece0: 2068 6f6f 6b20 746f 2062 6520 7265 6769   hook to be regi
-0000ecf0: 7374 6572 6564 2e0d 0a20 2020 2020 2020  stered...       
-0000ed00: 2020 2020 2070 7265 7065 6e64 2028 626f       prepend (bo
-0000ed10: 6f6c 293a 2049 6620 7472 7565 2c20 7468  ol): If true, th
-0000ed20: 6520 7072 6f76 6964 6564 2060 6068 6f6f  e provided ``hoo
-0000ed30: 6b60 6020 7769 6c6c 2062 6520 6669 7265  k`` will be fire
-0000ed40: 6420 6265 666f 7265 0d0a 2020 2020 2020  d before..      
-0000ed50: 2020 2020 2020 2020 2020 616c 6c20 6578            all ex
-0000ed60: 6973 7469 6e67 2060 6066 6f72 7761 7264  isting ``forward
-0000ed70: 5f70 7265 6060 2068 6f6f 6b73 206f 6e20  _pre`` hooks on 
-0000ed80: 7468 6973 0d0a 2020 2020 2020 2020 2020  this..          
-0000ed90: 2020 2020 2020 3a63 6c61 7373 3a60 746f        :class:`to
-0000eda0: 7263 682e 6e6e 2e6d 6f64 756c 6573 2e4d  rch.nn.modules.M
-0000edb0: 6f64 756c 6560 2e20 4f74 6865 7277 6973  odule`. Otherwis
-0000edc0: 652c 2074 6865 2070 726f 7669 6465 640d  e, the provided.
-0000edd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ede0: 2060 6068 6f6f 6b60 6020 7769 6c6c 2062   ``hook`` will b
-0000edf0: 6520 6669 7265 6420 6166 7465 7220 616c  e fired after al
-0000ee00: 6c20 6578 6973 7469 6e67 2060 6066 6f72  l existing ``for
-0000ee10: 7761 7264 5f70 7265 6060 2068 6f6f 6b73  ward_pre`` hooks
-0000ee20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ee30: 2020 6f6e 2074 6869 7320 3a63 6c61 7373    on this :class
-0000ee40: 3a60 746f 7263 682e 6e6e 2e6d 6f64 756c  :`torch.nn.modul
-0000ee50: 6573 2e4d 6f64 756c 6560 2e20 4e6f 7465  es.Module`. Note
-0000ee60: 2074 6861 7420 676c 6f62 616c 0d0a 2020   that global..  
-0000ee70: 2020 2020 2020 2020 2020 2020 2020 6060                ``
-0000ee80: 666f 7277 6172 645f 7072 6560 6020 686f  forward_pre`` ho
-0000ee90: 6f6b 7320 7265 6769 7374 6572 6564 2077  oks registered w
-0000eea0: 6974 680d 0a20 2020 2020 2020 2020 2020  ith..           
-0000eeb0: 2020 2020 203a 6675 6e63 3a60 7265 6769       :func:`regi
-0000eec0: 7374 6572 5f6d 6f64 756c 655f 666f 7277  ster_module_forw
-0000eed0: 6172 645f 7072 655f 686f 6f6b 6020 7769  ard_pre_hook` wi
-0000eee0: 6c6c 2066 6972 6520 6265 666f 7265 2061  ll fire before a
-0000eef0: 6c6c 0d0a 2020 2020 2020 2020 2020 2020  ll..            
-0000ef00: 2020 2020 686f 6f6b 7320 7265 6769 7374      hooks regist
-0000ef10: 6572 6564 2062 7920 7468 6973 206d 6574  ered by this met
-0000ef20: 686f 642e 0d0a 2020 2020 2020 2020 2020  hod...          
-0000ef30: 2020 2020 2020 4465 6661 756c 743a 2060        Default: `
-0000ef40: 6046 616c 7365 6060 0d0a 2020 2020 2020  `False``..      
-0000ef50: 2020 2020 2020 7769 7468 5f6b 7761 7267        with_kwarg
-0000ef60: 7320 2862 6f6f 6c29 3a20 4966 2074 7275  s (bool): If tru
-0000ef70: 652c 2074 6865 2060 6068 6f6f 6b60 6020  e, the ``hook`` 
-0000ef80: 7769 6c6c 2062 6520 7061 7373 6564 2074  will be passed t
-0000ef90: 6865 206b 7761 7267 730d 0a20 2020 2020  he kwargs..     
-0000efa0: 2020 2020 2020 2020 2020 2067 6976 656e             given
-0000efb0: 2074 6f20 7468 6520 666f 7277 6172 6420   to the forward 
-0000efc0: 6675 6e63 7469 6f6e 2e0d 0a20 2020 2020  function...     
-0000efd0: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-0000efe0: 6c74 3a20 6060 4661 6c73 6560 600d 0a0d  lt: ``False``...
-0000eff0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0000f000: 3a0d 0a20 2020 2020 2020 2020 2020 203a  :..            :
-0000f010: 636c 6173 733a 6074 6f72 6368 2e75 7469  class:`torch.uti
-0000f020: 6c73 2e68 6f6f 6b73 2e52 656d 6f76 6162  ls.hooks.Removab
-0000f030: 6c65 4861 6e64 6c65 603a 0d0a 2020 2020  leHandle`:..    
-0000f040: 2020 2020 2020 2020 2020 2020 6120 6861              a ha
-0000f050: 6e64 6c65 2074 6861 7420 6361 6e20 6265  ndle that can be
-0000f060: 2075 7365 6420 746f 2072 656d 6f76 6520   used to remove 
-0000f070: 7468 6520 6164 6465 6420 686f 6f6b 2062  the added hook b
-0000f080: 7920 6361 6c6c 696e 670d 0a20 2020 2020  y calling..     
-0000f090: 2020 2020 2020 2020 2020 2060 6068 616e             ``han
-0000f0a0: 646c 652e 7265 6d6f 7665 2829 6060 0d0a  dle.remove()``..
-0000f0b0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0000f0c0: 2020 2020 2068 616e 646c 6520 3d52 656d       handle =Rem
-0000f0d0: 6f76 6162 6c65 4861 6e64 6c65 280d 0a20  ovableHandle(.. 
-0000f0e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f0f0: 5f66 6f72 7761 7264 5f70 7265 5f68 6f6f  _forward_pre_hoo
-0000f100: 6b73 2c0d 0a20 2020 2020 2020 2020 2020  ks,..           
-0000f110: 2065 7874 7261 5f64 6963 743d 7365 6c66   extra_dict=self
-0000f120: 2e5f 666f 7277 6172 645f 7072 655f 686f  ._forward_pre_ho
-0000f130: 6f6b 735f 7769 7468 5f6b 7761 7267 730d  oks_with_kwargs.
-0000f140: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0000f150: 2020 2020 7365 6c66 2e5f 666f 7277 6172      self._forwar
-0000f160: 645f 7072 655f 686f 6f6b 735b 6861 6e64  d_pre_hooks[hand
-0000f170: 6c65 2e69 645d 203d 2068 6f6f 6b0d 0a20  le.id] = hook.. 
-0000f180: 2020 2020 2020 2069 6620 7769 7468 5f6b         if with_k
-0000f190: 7761 7267 733a 0d0a 2020 2020 2020 2020  wargs:..        
-0000f1a0: 2020 2020 7365 6c66 2e5f 666f 7277 6172      self._forwar
-0000f1b0: 645f 7072 655f 686f 6f6b 735f 7769 7468  d_pre_hooks_with
-0000f1c0: 5f6b 7761 7267 735b 6861 6e64 6c65 2e69  _kwargs[handle.i
-0000f1d0: 645d 203d 2054 7275 650d 0a0d 0a20 2020  d] = True....   
-0000f1e0: 2020 2020 2069 6620 7072 6570 656e 643a       if prepend:
-0000f1f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000f200: 6c66 2e5f 666f 7277 6172 645f 7072 655f  lf._forward_pre_
-0000f210: 686f 6f6b 732e 6d6f 7665 5f74 6f5f 656e  hooks.move_to_en
-0000f220: 6428 6861 6e64 6c65 2e69 642c 206c 6173  d(handle.id, las
-0000f230: 743d 4661 6c73 6529 2020 2320 7479 7065  t=False)  # type
-0000f240: 3a20 6967 6e6f 7265 5b61 7474 722d 6465  : ignore[attr-de
-0000f250: 6669 6e65 645d 0d0a 2020 2020 2020 2020  fined]..        
-0000f260: 7265 7475 726e 2068 616e 646c 650d 0a0d  return handle...
-0000f270: 0a20 2020 2064 6566 2072 6567 6973 7465  .    def registe
-0000f280: 725f 666f 7277 6172 645f 686f 6f6b 280d  r_forward_hook(.
-0000f290: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
-0000f2a0: 2020 2020 2020 2020 686f 6f6b 3a20 556e          hook: Un
-0000f2b0: 696f 6e5b 0d0a 2020 2020 2020 2020 2020  ion[..          
-0000f2c0: 2020 4361 6c6c 6162 6c65 5b5b 542c 2054    Callable[[T, T
-0000f2d0: 7570 6c65 5b41 6e79 2c20 2e2e 2e5d 2c20  uple[Any, ...], 
-0000f2e0: 416e 795d 2c20 4f70 7469 6f6e 616c 5b41  Any], Optional[A
-0000f2f0: 6e79 5d5d 2c0d 0a20 2020 2020 2020 2020  ny]],..         
-0000f300: 2020 2043 616c 6c61 626c 655b 5b54 2c20     Callable[[T, 
-0000f310: 5475 706c 655b 416e 792c 202e 2e2e 5d2c  Tuple[Any, ...],
-0000f320: 2044 6963 745b 7374 722c 2041 6e79 5d2c   Dict[str, Any],
-0000f330: 2041 6e79 5d2c 204f 7074 696f 6e61 6c5b   Any], Optional[
-0000f340: 416e 795d 5d2c 0d0a 2020 2020 2020 2020  Any]],..        
-0000f350: 5d2c 0d0a 2020 2020 2020 2020 2a2c 0d0a  ],..        *,..
-0000f360: 2020 2020 2020 2020 7072 6570 656e 643a          prepend:
-0000f370: 2062 6f6f 6c20 3d20 4661 6c73 652c 0d0a   bool = False,..
-0000f380: 2020 2020 2020 2020 7769 7468 5f6b 7761          with_kwa
-0000f390: 7267 733a 2062 6f6f 6c20 3d20 4661 6c73  rgs: bool = Fals
-0000f3a0: 652c 0d0a 2020 2020 2920 2d3e 2052 656d  e,..    ) -> Rem
-0000f3b0: 6f76 6162 6c65 4861 6e64 6c65 3a0d 0a20  ovableHandle:.. 
-0000f3c0: 2020 2020 2020 2072 2222 2252 6567 6973         r"""Regis
-0000f3d0: 7465 7273 2061 2066 6f72 7761 7264 2068  ters a forward h
-0000f3e0: 6f6f 6b20 6f6e 2074 6865 206d 6f64 756c  ook on the modul
-0000f3f0: 652e 0d0a 0d0a 2020 2020 2020 2020 5468  e.....        Th
-0000f400: 6520 686f 6f6b 2077 696c 6c20 6265 2063  e hook will be c
-0000f410: 616c 6c65 6420 6576 6572 7920 7469 6d65  alled every time
-0000f420: 2061 6674 6572 203a 6675 6e63 3a60 666f   after :func:`fo
-0000f430: 7277 6172 6460 2068 6173 2063 6f6d 7075  rward` has compu
-0000f440: 7465 6420 616e 206f 7574 7075 742e 0d0a  ted an output...
-0000f450: 0d0a 2020 2020 2020 2020 4966 2060 6077  ..        If ``w
-0000f460: 6974 685f 6b77 6172 6773 6060 2069 7320  ith_kwargs`` is 
-0000f470: 6060 4661 6c73 6560 6020 6f72 206e 6f74  ``False`` or not
-0000f480: 2073 7065 6369 6669 6564 2c20 7468 6520   specified, the 
-0000f490: 696e 7075 7420 636f 6e74 6169 6e73 206f  input contains o
-0000f4a0: 6e6c 790d 0a20 2020 2020 2020 2074 6865  nly..        the
-0000f4b0: 2070 6f73 6974 696f 6e61 6c20 6172 6775   positional argu
-0000f4c0: 6d65 6e74 7320 6769 7665 6e20 746f 2074  ments given to t
-0000f4d0: 6865 206d 6f64 756c 652e 204b 6579 776f  he module. Keywo
-0000f4e0: 7264 2061 7267 756d 656e 7473 2077 6f6e  rd arguments won
-0000f4f0: 2774 2062 650d 0a20 2020 2020 2020 2070  't be..        p
-0000f500: 6173 7365 6420 746f 2074 6865 2068 6f6f  assed to the hoo
-0000f510: 6b73 2061 6e64 206f 6e6c 7920 746f 2074  ks and only to t
-0000f520: 6865 2060 6066 6f72 7761 7264 6060 2e20  he ``forward``. 
-0000f530: 5468 6520 686f 6f6b 2063 616e 206d 6f64  The hook can mod
-0000f540: 6966 7920 7468 650d 0a20 2020 2020 2020  ify the..       
-0000f550: 206f 7574 7075 742e 2049 7420 6361 6e20   output. It can 
-0000f560: 6d6f 6469 6679 2074 6865 2069 6e70 7574  modify the input
-0000f570: 2069 6e70 6c61 6365 2062 7574 2069 7420   inplace but it 
-0000f580: 7769 6c6c 206e 6f74 2068 6176 6520 6566  will not have ef
-0000f590: 6665 6374 206f 6e0d 0a20 2020 2020 2020  fect on..       
-0000f5a0: 2066 6f72 7761 7264 2073 696e 6365 2074   forward since t
-0000f5b0: 6869 7320 6973 2063 616c 6c65 6420 6166  his is called af
-0000f5c0: 7465 7220 3a66 756e 633a 6066 6f72 7761  ter :func:`forwa
-0000f5d0: 7264 6020 6973 2063 616c 6c65 642e 2054  rd` is called. T
-0000f5e0: 6865 2068 6f6f 6b0d 0a20 2020 2020 2020  he hook..       
-0000f5f0: 2073 686f 756c 6420 6861 7665 2074 6865   should have the
-0000f600: 2066 6f6c 6c6f 7769 6e67 2073 6967 6e61   following signa
-0000f610: 7475 7265 3a3a 0d0a 0d0a 2020 2020 2020  ture::....      
-0000f620: 2020 2020 2020 686f 6f6b 286d 6f64 756c        hook(modul
-0000f630: 652c 2061 7267 732c 206f 7574 7075 7429  e, args, output)
-0000f640: 202d 3e20 4e6f 6e65 206f 7220 6d6f 6469   -> None or modi
-0000f650: 6669 6564 206f 7574 7075 740d 0a0d 0a20  fied output.... 
-0000f660: 2020 2020 2020 2049 6620 6060 7769 7468         If ``with
-0000f670: 5f6b 7761 7267 7360 6020 6973 2060 6054  _kwargs`` is ``T
-0000f680: 7275 6560 602c 2074 6865 2066 6f72 7761  rue``, the forwa
-0000f690: 7264 2068 6f6f 6b20 7769 6c6c 2062 6520  rd hook will be 
-0000f6a0: 7061 7373 6564 2074 6865 0d0a 2020 2020  passed the..    
-0000f6b0: 2020 2020 6060 6b77 6172 6773 6060 2067      ``kwargs`` g
-0000f6c0: 6976 656e 2074 6f20 7468 6520 666f 7277  iven to the forw
-0000f6d0: 6172 6420 6675 6e63 7469 6f6e 2061 6e64  ard function and
-0000f6e0: 2062 6520 6578 7065 6374 6564 2074 6f20   be expected to 
-0000f6f0: 7265 7475 726e 2074 6865 0d0a 2020 2020  return the..    
-0000f700: 2020 2020 6f75 7470 7574 2070 6f73 7369      output possi
-0000f710: 626c 7920 6d6f 6469 6669 6564 2e20 5468  bly modified. Th
-0000f720: 6520 686f 6f6b 2073 686f 756c 6420 6861  e hook should ha
-0000f730: 7665 2074 6865 2066 6f6c 6c6f 7769 6e67  ve the following
-0000f740: 2073 6967 6e61 7475 7265 3a3a 0d0a 0d0a   signature::....
-0000f750: 2020 2020 2020 2020 2020 2020 686f 6f6b              hook
-0000f760: 286d 6f64 756c 652c 2061 7267 732c 206b  (module, args, k
-0000f770: 7761 7267 732c 206f 7574 7075 7429 202d  wargs, output) -
-0000f780: 3e20 4e6f 6e65 206f 7220 6d6f 6469 6669  > None or modifi
-0000f790: 6564 206f 7574 7075 740d 0a0d 0a20 2020  ed output....   
-0000f7a0: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
-0000f7b0: 2020 2020 2020 2020 686f 6f6b 2028 4361          hook (Ca
-0000f7c0: 6c6c 6162 6c65 293a 2054 6865 2075 7365  llable): The use
-0000f7d0: 7220 6465 6669 6e65 6420 686f 6f6b 2074  r defined hook t
-0000f7e0: 6f20 6265 2072 6567 6973 7465 7265 642e  o be registered.
-0000f7f0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0000f800: 6570 656e 6420 2862 6f6f 6c29 3a20 4966  epend (bool): If
-0000f810: 2060 6054 7275 6560 602c 2074 6865 2070   ``True``, the p
-0000f820: 726f 7669 6465 6420 6060 686f 6f6b 6060  rovided ``hook``
-0000f830: 2077 696c 6c20 6265 2066 6972 6564 0d0a   will be fired..
-0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f850: 6265 666f 7265 2061 6c6c 2065 7869 7374  before all exist
-0000f860: 696e 6720 6060 666f 7277 6172 6460 6020  ing ``forward`` 
-0000f870: 686f 6f6b 7320 6f6e 2074 6869 730d 0a20  hooks on this.. 
-0000f880: 2020 2020 2020 2020 2020 2020 2020 203a                 :
-0000f890: 636c 6173 733a 6074 6f72 6368 2e6e 6e2e  class:`torch.nn.
-0000f8a0: 6d6f 6475 6c65 732e 4d6f 6475 6c65 602e  modules.Module`.
-0000f8b0: 204f 7468 6572 7769 7365 2c20 7468 6520   Otherwise, the 
-0000f8c0: 7072 6f76 6964 6564 0d0a 2020 2020 2020  provided..      
-0000f8d0: 2020 2020 2020 2020 2020 6060 686f 6f6b            ``hook
-0000f8e0: 6060 2077 696c 6c20 6265 2066 6972 6564  `` will be fired
-0000f8f0: 2061 6674 6572 2061 6c6c 2065 7869 7374   after all exist
-0000f900: 696e 6720 6060 666f 7277 6172 6460 6020  ing ``forward`` 
-0000f910: 686f 6f6b 7320 6f6e 0d0a 2020 2020 2020  hooks on..      
-0000f920: 2020 2020 2020 2020 2020 7468 6973 203a            this :
-0000f930: 636c 6173 733a 6074 6f72 6368 2e6e 6e2e  class:`torch.nn.
-0000f940: 6d6f 6475 6c65 732e 4d6f 6475 6c65 602e  modules.Module`.
-0000f950: 204e 6f74 6520 7468 6174 2067 6c6f 6261   Note that globa
-0000f960: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
-0000f970: 2020 2060 6066 6f72 7761 7264 6060 2068     ``forward`` h
-0000f980: 6f6f 6b73 2072 6567 6973 7465 7265 6420  ooks registered 
-0000f990: 7769 7468 0d0a 2020 2020 2020 2020 2020  with..          
-0000f9a0: 2020 2020 2020 3a66 756e 633a 6072 6567        :func:`reg
-0000f9b0: 6973 7465 725f 6d6f 6475 6c65 5f66 6f72  ister_module_for
-0000f9c0: 7761 7264 5f68 6f6f 6b60 2077 696c 6c20  ward_hook` will 
-0000f9d0: 6669 7265 2062 6566 6f72 6520 616c 6c20  fire before all 
-0000f9e0: 686f 6f6b 730d 0a20 2020 2020 2020 2020  hooks..         
-0000f9f0: 2020 2020 2020 2072 6567 6973 7465 7265         registere
-0000fa00: 6420 6279 2074 6869 7320 6d65 7468 6f64  d by this method
-0000fa10: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0000fa20: 2020 2044 6566 6175 6c74 3a20 6060 4661     Default: ``Fa
-0000fa30: 6c73 6560 600d 0a20 2020 2020 2020 2020  lse``..         
-0000fa40: 2020 2077 6974 685f 6b77 6172 6773 2028     with_kwargs (
-0000fa50: 626f 6f6c 293a 2049 6620 6060 5472 7565  bool): If ``True
-0000fa60: 6060 2c20 7468 6520 6060 686f 6f6b 6060  ``, the ``hook``
-0000fa70: 2077 696c 6c20 6265 2070 6173 7365 6420   will be passed 
-0000fa80: 7468 650d 0a20 2020 2020 2020 2020 2020  the..           
-0000fa90: 2020 2020 206b 7761 7267 7320 6769 7665       kwargs give
-0000faa0: 6e20 746f 2074 6865 2066 6f72 7761 7264  n to the forward
-0000fab0: 2066 756e 6374 696f 6e2e 0d0a 2020 2020   function...    
-0000fac0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
-0000fad0: 756c 743a 2060 6046 616c 7365 6060 0d0a  ult: ``False``..
-0000fae0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000faf0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000fb00: 3a63 6c61 7373 3a60 746f 7263 682e 7574  :class:`torch.ut
-0000fb10: 696c 732e 686f 6f6b 732e 5265 6d6f 7661  ils.hooks.Remova
-0000fb20: 626c 6548 616e 646c 6560 3a0d 0a20 2020  bleHandle`:..   
-0000fb30: 2020 2020 2020 2020 2020 2020 2061 2068               a h
-0000fb40: 616e 646c 6520 7468 6174 2063 616e 2062  andle that can b
-0000fb50: 6520 7573 6564 2074 6f20 7265 6d6f 7665  e used to remove
-0000fb60: 2074 6865 2061 6464 6564 2068 6f6f 6b20   the added hook 
-0000fb70: 6279 2063 616c 6c69 6e67 0d0a 2020 2020  by calling..    
-0000fb80: 2020 2020 2020 2020 2020 2020 6060 6861              ``ha
-0000fb90: 6e64 6c65 2e72 656d 6f76 6528 2960 600d  ndle.remove()``.
-0000fba0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0000fbb0: 2020 2020 2020 6861 6e64 6c65 203d 5265        handle =Re
-0000fbc0: 6d6f 7661 626c 6548 616e 646c 6528 0d0a  movableHandle(..
-0000fbd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fbe0: 2e5f 666f 7277 6172 645f 686f 6f6b 732c  ._forward_hooks,
-0000fbf0: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-0000fc00: 7472 615f 6469 6374 3d73 656c 662e 5f66  tra_dict=self._f
-0000fc10: 6f72 7761 7264 5f68 6f6f 6b73 5f77 6974  orward_hooks_wit
-0000fc20: 685f 6b77 6172 6773 0d0a 2020 2020 2020  h_kwargs..      
-0000fc30: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
-0000fc40: 662e 5f66 6f72 7761 7264 5f68 6f6f 6b73  f._forward_hooks
-0000fc50: 5b68 616e 646c 652e 6964 5d20 3d20 686f  [handle.id] = ho
-0000fc60: 6f6b 0d0a 2020 2020 2020 2020 6966 2077  ok..        if w
-0000fc70: 6974 685f 6b77 6172 6773 3a0d 0a20 2020  ith_kwargs:..   
-0000fc80: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-0000fc90: 6f72 7761 7264 5f68 6f6f 6b73 5f77 6974  orward_hooks_wit
-0000fca0: 685f 6b77 6172 6773 5b68 616e 646c 652e  h_kwargs[handle.
-0000fcb0: 6964 5d20 3d20 5472 7565 0d0a 0d0a 2020  id] = True....  
-0000fcc0: 2020 2020 2020 6966 2070 7265 7065 6e64        if prepend
-0000fcd0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000fce0: 656c 662e 5f66 6f72 7761 7264 5f68 6f6f  elf._forward_hoo
-0000fcf0: 6b73 2e6d 6f76 655f 746f 5f65 6e64 2868  ks.move_to_end(h
-0000fd00: 616e 646c 652e 6964 2c20 6c61 7374 3d46  andle.id, last=F
-0000fd10: 616c 7365 2920 2023 2074 7970 653a 2069  alse)  # type: i
-0000fd20: 676e 6f72 655b 6174 7472 2d64 6566 696e  gnore[attr-defin
-0000fd30: 6564 5d0d 0a20 2020 2020 2020 2072 6574  ed]..        ret
-0000fd40: 7572 6e20 6861 6e64 6c65 0d0a 2020 2020  urn handle..    
-0000fd50: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0000fd60: 6566 2062 7569 6c74 2873 656c 6629 3a0d  ef built(self):.
-0000fd70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fd80: 7365 6c66 2e5f 6275 696c 740d 0a0d 0a20  self._built.... 
-0000fd90: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-0000fda0: 2020 6465 6620 696e 7075 745f 7368 6170    def input_shap
-0000fdb0: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-0000fdc0: 2020 2222 2253 6861 7065 206f 6620 696e    """Shape of in
-0000fdd0: 7075 7420 7465 6e73 6f72 2c6e 6f74 2069  put tensor,not i
-0000fde0: 6e63 6c75 6469 6e67 2074 6865 2062 6174  ncluding the bat
-0000fdf0: 6368 2061 7869 732e 2222 220d 0a20 2020  ch axis."""..   
-0000fe00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000fe10: 2e5f 696e 7075 745f 7368 6170 650d 0a0d  ._input_shape...
-0000fe20: 0a20 2020 2040 696e 7075 745f 7368 6170  .    @input_shap
-0000fe30: 652e 7365 7474 6572 0d0a 2020 2020 6465  e.setter..    de
-0000fe40: 6620 696e 7075 745f 7368 6170 6528 7365  f input_shape(se
-0000fe50: 6c66 2c20 7661 6c75 6529 202d 3e20 5465  lf, value) -> Te
-0000fe60: 6e73 6f72 5368 6170 653a 0d0a 2020 2020  nsorShape:..    
-0000fe70: 2020 2020 2222 2220 5365 7474 696e 6720      """ Setting 
-0000fe80: 7468 6520 696e 7075 745f 7368 6170 652c  the input_shape,
-0000fe90: 206d 6561 6e73 2074 6865 206c 6179 6572   means the layer
-0000fea0: 2067 6574 2073 6861 7065 2069 6e66 6f72   get shape infor
-0000feb0: 6d61 7469 6f6e 2061 6e64 2073 7461 7274  mation and start
-0000fec0: 2074 6f20 646f 2074 6865 2073 6861 7065   to do the shape
-0000fed0: 2069 6e66 6572 7265 6e63 6520 2222 220d   inferrence """.
-0000fee0: 0a0d 0a20 2020 2020 2020 2069 6620 6973  ...        if is
-0000fef0: 5f74 656e 736f 7228 7661 6c75 6529 2061  _tensor(value) a
-0000ff00: 6e64 2076 616c 7565 2e6e 6469 6d20 3d3d  nd value.ndim ==
-0000ff10: 2031 2061 6e64 2076 616c 7565 2e64 7479   1 and value.dty
-0000ff20: 7065 203d 3d20 746f 7263 682e 696e 7433  pe == torch.int3
-0000ff30: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
-0000ff40: 7661 6c75 6520 3d20 5465 6e73 6f72 5368  value = TensorSh
-0000ff50: 6170 6528 5b4e 6f6e 652c 205d 202b 2074  ape([None, ] + t
-0000ff60: 6f5f 6c69 7374 2874 6f5f 6e75 6d70 7928  o_list(to_numpy(
-0000ff70: 7661 6c75 6529 2929 0d0a 2020 2020 2020  value)))..      
-0000ff80: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0000ff90: 6528 7661 6c75 652c 2074 6f72 6368 2e53  e(value, torch.S
-0000ffa0: 697a 6529 3a0d 0a20 2020 2020 2020 2020  ize):..         
-0000ffb0: 2020 2064 696d 7320 3d20 5b4e 6f6e 652c     dims = [None,
-0000ffc0: 205d 202b 205b 6420 666f 7220 6420 696e   ] + [d for d in
-0000ffd0: 2076 616c 7565 5d0d 0a20 2020 2020 2020   value]..       
-0000ffe0: 2020 2020 2076 616c 7565 203d 2054 656e       value = Ten
-0000fff0: 736f 7253 6861 7065 2864 696d 7329 0d0a  sorShape(dims)..
-00010000: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00010010: 6e73 7461 6e63 6528 7661 6c75 652c 2028  nstance(value, (
-00010020: 6c69 7374 2c20 7475 706c 6529 2920 616e  list, tuple)) an
-00010030: 6420 6c65 6e28 7661 6c75 6529 203e 2030  d len(value) > 0
-00010040: 2061 6e64 2061 6c6c 280d 0a20 2020 2020   and all(..     
-00010050: 2020 2020 2020 2020 2020 205b 6973 696e             [isin
-00010060: 7374 616e 6365 2869 7465 6d2c 206e 756d  stance(item, num
-00010070: 6265 7273 2e49 6e74 6567 7261 6c29 2066  bers.Integral) f
-00010080: 6f72 2069 7465 6d20 696e 2076 616c 7565  or item in value
-00010090: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
-000100a0: 2076 616c 7565 203d 2054 656e 736f 7253   value = TensorS
-000100b0: 6861 7065 2828 4e6f 6e65 2c29 202b 2076  hape((None,) + v
-000100c0: 616c 7565 290d 0a20 2020 2020 2020 2065  alue)..        e
-000100d0: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
-000100e0: 616c 7565 2c20 286c 6973 742c 2074 7570  alue, (list, tup
-000100f0: 6c65 2929 2061 6e64 206c 656e 2876 616c  le)) and len(val
-00010100: 7565 2920 3e20 3020 616e 6420 616c 6c28  ue) > 0 and all(
-00010110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010120: 2020 5b69 735f 7465 6e73 6f72 2869 7465    [is_tensor(ite
-00010130: 6d29 2061 6e64 206e 6469 6d28 6974 656d  m) and ndim(item
-00010140: 2920 3d3d 2031 2061 6e64 2069 7465 6d2e  ) == 1 and item.
-00010150: 6474 7970 6520 3d3d 2074 6f72 6368 2e69  dtype == torch.i
-00010160: 6e74 3332 2066 6f72 2069 7465 6d20 696e  nt32 for item in
-00010170: 2076 616c 7565 5d29 3a0d 0a20 2020 2020   value]):..     
-00010180: 2020 2020 2020 2076 616c 7565 203d 205b         value = [
-00010190: 5465 6e73 6f72 5368 6170 6528 7368 2920  TensorShape(sh) 
-000101a0: 666f 7220 7368 2069 6e20 7661 6c75 655d  for sh in value]
-000101b0: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-000101c0: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-000101d0: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
-000101e0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000101f0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00010200: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00010210: 7565 203d 2054 656e 736f 7253 6861 7065  ue = TensorShape
-00010220: 2876 616c 7565 290d 0a0d 0a20 2020 2020  (value)....     
-00010230: 2020 2069 6620 7365 6c66 2e5f 6275 696c     if self._buil
-00010240: 7420 3d3d 2046 616c 7365 206f 7220 7365  t == False or se
-00010250: 6c66 2e5f 696e 7075 745f 7368 6170 6520  lf._input_shape 
-00010260: 6973 204e 6f6e 6520 6f72 2073 656c 662e  is None or self.
-00010270: 696e 7075 745f 6669 6c74 6572 7320 6973  input_filters is
-00010280: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00010290: 2020 2020 7365 6c66 2e5f 696e 7075 745f      self._input_
-000102a0: 7368 6170 6520 3d20 7661 6c75 650d 0a20  shape = value.. 
-000102b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000102c0: 696e 7075 745f 6669 6c74 6572 7320 3d20  input_filters = 
-000102d0: 7365 6c66 2e5f 696e 7075 745f 7368 6170  self._input_shap
-000102e0: 655b 7365 6c66 2e66 696c 7465 725f 696e  e[self.filter_in
-000102f0: 6465 785d 0d0a 2020 2020 2020 2020 2020  dex]..          
-00010300: 2020 7365 6c66 2e62 7569 6c64 2876 616c    self.build(val
-00010310: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00010320: 2073 656c 662e 5f62 7569 6c74 203d 2054   self._built = T
-00010330: 7275 650d 0a0d 0a20 2020 2040 7072 6f70  rue....    @prop
-00010340: 6572 7479 0d0a 2020 2020 6465 6620 696e  erty..    def in
-00010350: 7075 745f 7370 6563 2873 656c 6629 3a0d  put_spec(self):.
-00010360: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00010370: 2e69 735f 726f 6f74 2061 6e64 2073 656c  .is_root and sel
-00010380: 662e 5f73 6967 6e61 7475 7265 2069 7320  f._signature is 
-00010390: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000103a0: 2020 2020 2020 2072 6574 7572 6e20 756e         return un
-000103b0: 7061 636b 5f73 696e 676c 6574 6f6e 2873  pack_singleton(s
-000103c0: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
-000103d0: 6e70 7574 732e 7661 6c75 655f 6c69 7374  nputs.value_list
-000103e0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
-000103f0: 7479 0d0a 2020 2020 6465 6620 6f75 7470  ty..    def outp
-00010400: 7574 5f73 6861 7065 2873 656c 6629 3a0d  ut_shape(self):.
-00010410: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010420: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
-00010430: 7065 0d0a 0d0a 2020 2020 406f 7574 7075  pe....    @outpu
-00010440: 745f 7368 6170 652e 7365 7474 6572 0d0a  t_shape.setter..
-00010450: 2020 2020 6465 6620 6f75 7470 7574 5f73      def output_s
-00010460: 6861 7065 2873 656c 662c 2076 616c 7565  hape(self, value
-00010470: 293a 0d0a 2020 2020 2020 2020 6966 2069  ):..        if i
-00010480: 735f 7465 6e73 6f72 2876 616c 7565 2920  s_tensor(value) 
-00010490: 616e 6420 7661 6c75 652e 6e64 696d 203d  and value.ndim =
-000104a0: 3d20 3120 616e 6420 7661 6c75 652e 6474  = 1 and value.dt
-000104b0: 7970 6520 3d3d 2074 6f72 6368 2e69 6e74  ype == torch.int
-000104c0: 3332 3a0d 0a20 2020 2020 2020 2020 2020  32:..           
-000104d0: 2076 616c 7565 203d 2054 656e 736f 7253   value = TensorS
-000104e0: 6861 7065 285b 4e6f 6e65 2c20 5d20 2b20  hape([None, ] + 
-000104f0: 746f 5f6c 6973 7428 746f 5f6e 756d 7079  to_list(to_numpy
-00010500: 2876 616c 7565 2929 290d 0a20 2020 2020  (value)))..     
-00010510: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00010520: 6365 2876 616c 7565 2c20 746f 7263 682e  ce(value, torch.
-00010530: 5369 7a65 293a 0d0a 2020 2020 2020 2020  Size):..        
-00010540: 2020 2020 6469 6d73 203d 205b 4e6f 6e65      dims = [None
-00010550: 2c20 5d20 2b20 5b64 2066 6f72 2064 2069  , ] + [d for d i
-00010560: 6e20 7661 6c75 655d 0d0a 2020 2020 2020  n value]..      
-00010570: 2020 2020 2020 7661 6c75 6520 3d20 5465        value = Te
-00010580: 6e73 6f72 5368 6170 6528 6469 6d73 290d  nsorShape(dims).
-00010590: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-000105a0: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
-000105b0: 286c 6973 742c 2074 7570 6c65 2929 2061  (list, tuple)) a
-000105c0: 6e64 206c 656e 2876 616c 7565 2920 3e20  nd len(value) > 
-000105d0: 3020 616e 6420 616c 6c28 0d0a 2020 2020  0 and all(..    
-000105e0: 2020 2020 2020 2020 2020 2020 5b69 7369              [isi
-000105f0: 6e73 7461 6e63 6528 6974 656d 2c20 6e75  nstance(item, nu
-00010600: 6d62 6572 732e 496e 7465 6772 616c 2920  mbers.Integral) 
-00010610: 666f 7220 6974 656d 2069 6e20 7661 6c75  for item in valu
-00010620: 655d 293a 0d0a 2020 2020 2020 2020 2020  e]):..          
-00010630: 2020 7661 6c75 6520 3d20 5465 6e73 6f72    value = Tensor
-00010640: 5368 6170 6528 284e 6f6e 652c 2920 2b20  Shape((None,) + 
-00010650: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
-00010660: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00010670: 7661 6c75 652c 2028 6c69 7374 2c20 7475  value, (list, tu
-00010680: 706c 6529 2920 616e 6420 6c65 6e28 7661  ple)) and len(va
-00010690: 6c75 6529 203e 2030 2061 6e64 2061 6c6c  lue) > 0 and all
-000106a0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000106b0: 2020 205b 6973 5f74 656e 736f 7228 6974     [is_tensor(it
-000106c0: 656d 2920 616e 6420 6e64 696d 2869 7465  em) and ndim(ite
-000106d0: 6d29 203d 3d20 3120 616e 6420 6974 656d  m) == 1 and item
-000106e0: 2e64 7479 7065 203d 3d20 746f 7263 682e  .dtype == torch.
-000106f0: 696e 7433 3220 666f 7220 6974 656d 2069  int32 for item i
-00010700: 6e20 7661 6c75 655d 293a 0d0a 2020 2020  n value]):..    
-00010710: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-00010720: 5b54 656e 736f 7253 6861 7065 2873 6829  [TensorShape(sh)
-00010730: 2066 6f72 2073 6820 696e 2076 616c 7565   for sh in value
-00010740: 5d0d 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
-00010750: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-00010760: 2c20 5465 6e73 6f72 5368 6170 6529 3a0d  , TensorShape):.
-00010770: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00010780: 730d 0a20 2020 2020 2020 2065 6c73 653a  s..        else:
-00010790: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-000107a0: 6c75 6520 3d20 5465 6e73 6f72 5368 6170  lue = TensorShap
-000107b0: 6528 7661 6c75 6529 0d0a 0d0a 2020 2020  e(value)....    
-000107c0: 2020 2020 7365 6c66 2e5f 6f75 7470 7574      self._output
-000107d0: 5f73 6861 7065 203d 2076 616c 7565 0d0a  _shape = value..
-000107e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000107f0: 6973 5f72 6f6f 743a 0d0a 2020 2020 2020  is_root:..      
-00010800: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
-00010810: 6967 6e61 7475 7265 2069 7320 4e6f 6e65  ignature is None
-00010820: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00010830: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
-00010840: 7265 203d 2053 6967 6e61 7475 7265 286e  re = Signature(n
-00010850: 616d 653d 7365 6c66 2e6e 616d 6529 0d0a  ame=self.name)..
-00010860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010870: 2e5f 7369 676e 6174 7572 652e 6f75 7470  ._signature.outp
-00010880: 7574 7320 3d20 4f72 6465 7265 6444 6963  uts = OrderedDic
-00010890: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-000108a0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-000108b0: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
-000108c0: 652c 2054 656e 736f 7253 6861 7065 293a  e, TensorShape):
-000108d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000108e0: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
-000108f0: 652e 6f75 7470 7574 735b 276f 7574 7075  e.outputs['outpu
-00010900: 7427 5d20 3d20 5465 6e73 6f72 5370 6563  t'] = TensorSpec
-00010910: 2873 6861 7065 3d73 656c 662e 5f6f 7574  (shape=self._out
-00010920: 7075 745f 7368 6170 652c 206e 616d 653d  put_shape, name=
-00010930: 276f 7574 7075 7427 290d 0a0d 0a20 2020  'output')....   
-00010940: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-00010950: 5f74 656e 736f 7228 7365 6c66 2e5f 6f75  _tensor(self._ou
-00010960: 7470 7574 5f73 6861 7065 293a 0d0a 2020  tput_shape):..  
-00010970: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010980: 6c66 2e5f 7369 676e 6174 7572 652e 6f75  lf._signature.ou
-00010990: 7470 7574 735b 276f 7574 7075 7427 5d20  tputs['output'] 
-000109a0: 3d20 5465 6e73 6f72 5370 6563 2873 6861  = TensorSpec(sha
-000109b0: 7065 3d54 656e 736f 7253 6861 7065 2874  pe=TensorShape(t
-000109c0: 6f5f 6c69 7374 2874 6f5f 6e75 6d70 7928  o_list(to_numpy(
-000109d0: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
-000109e0: 7065 2929 292c 0d0a 2020 2020 2020 2020  pe))),..        
-000109f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e700: 2020 2020 2020 2020 2020 2020 2262 6568              "beh
+0000e710: 6176 696f 722e 2229 0d0a 0d0a 2020 2020  avior.")....    
+0000e720: 6465 6620 7265 6769 7374 6572 5f66 6f72  def register_for
+0000e730: 7761 7264 5f70 7265 5f68 6f6f 6b28 0d0a  ward_pre_hook(..
+0000e740: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
+0000e750: 2020 2020 2020 2068 6f6f 6b3a 2055 6e69         hook: Uni
+0000e760: 6f6e 5b0d 0a20 2020 2020 2020 2020 2020  on[..           
+0000e770: 2043 616c 6c61 626c 655b 5b54 2c20 5475   Callable[[T, Tu
+0000e780: 706c 655b 416e 792c 202e 2e2e 5d5d 2c20  ple[Any, ...]], 
+0000e790: 4f70 7469 6f6e 616c 5b41 6e79 5d5d 2c0d  Optional[Any]],.
+0000e7a0: 0a20 2020 2020 2020 2020 2020 2043 616c  .            Cal
+0000e7b0: 6c61 626c 655b 5b54 2c20 5475 706c 655b  lable[[T, Tuple[
+0000e7c0: 416e 792c 202e 2e2e 5d2c 2044 6963 745b  Any, ...], Dict[
+0000e7d0: 7374 722c 2041 6e79 5d5d 2c20 4f70 7469  str, Any]], Opti
+0000e7e0: 6f6e 616c 5b54 7570 6c65 5b41 6e79 2c20  onal[Tuple[Any, 
+0000e7f0: 4469 6374 5b73 7472 2c20 416e 795d 5d5d  Dict[str, Any]]]
+0000e800: 5d2c 0d0a 2020 2020 2020 2020 5d2c 0d0a  ],..        ],..
+0000e810: 2020 2020 2020 2020 2a2c 0d0a 2020 2020          *,..    
+0000e820: 2020 2020 7072 6570 656e 643a 2062 6f6f      prepend: boo
+0000e830: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
+0000e840: 2020 2020 7769 7468 5f6b 7761 7267 733a      with_kwargs:
+0000e850: 2062 6f6f 6c20 3d20 4661 6c73 652c 0d0a   bool = False,..
+0000e860: 2020 2020 2920 2d3e 2052 656d 6f76 6162      ) -> Removab
+0000e870: 6c65 4861 6e64 6c65 3a0d 0a20 2020 2020  leHandle:..     
+0000e880: 2020 2072 2222 2252 6567 6973 7465 7273     r"""Registers
+0000e890: 2061 2066 6f72 7761 7264 2070 7265 2d68   a forward pre-h
+0000e8a0: 6f6f 6b20 6f6e 2074 6865 206d 6f64 756c  ook on the modul
+0000e8b0: 652e 0d0a 0d0a 2020 2020 2020 2020 5468  e.....        Th
+0000e8c0: 6520 686f 6f6b 2077 696c 6c20 6265 2063  e hook will be c
+0000e8d0: 616c 6c65 6420 6576 6572 7920 7469 6d65  alled every time
+0000e8e0: 2062 6566 6f72 6520 3a66 756e 633a 6066   before :func:`f
+0000e8f0: 6f72 7761 7264 6020 6973 2069 6e76 6f6b  orward` is invok
+0000e900: 6564 2e0d 0a0d 0a0d 0a20 2020 2020 2020  ed.......       
+0000e910: 2049 6620 6060 7769 7468 5f6b 7761 7267   If ``with_kwarg
+0000e920: 7360 6020 6973 2066 616c 7365 206f 7220  s`` is false or 
+0000e930: 6e6f 7420 7370 6563 6966 6965 642c 2074  not specified, t
+0000e940: 6865 2069 6e70 7574 2063 6f6e 7461 696e  he input contain
+0000e950: 7320 6f6e 6c79 0d0a 2020 2020 2020 2020  s only..        
+0000e960: 7468 6520 706f 7369 7469 6f6e 616c 2061  the positional a
+0000e970: 7267 756d 656e 7473 2067 6976 656e 2074  rguments given t
+0000e980: 6f20 7468 6520 6d6f 6475 6c65 2e20 4b65  o the module. Ke
+0000e990: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+0000e9a0: 776f 6e27 7420 6265 0d0a 2020 2020 2020  won't be..      
+0000e9b0: 2020 7061 7373 6564 2074 6f20 7468 6520    passed to the 
+0000e9c0: 686f 6f6b 7320 616e 6420 6f6e 6c79 2074  hooks and only t
+0000e9d0: 6f20 7468 6520 6060 666f 7277 6172 6460  o the ``forward`
+0000e9e0: 602e 2054 6865 2068 6f6f 6b20 6361 6e20  `. The hook can 
+0000e9f0: 6d6f 6469 6679 2074 6865 0d0a 2020 2020  modify the..    
+0000ea00: 2020 2020 696e 7075 742e 2055 7365 7220      input. User 
+0000ea10: 6361 6e20 6569 7468 6572 2072 6574 7572  can either retur
+0000ea20: 6e20 6120 7475 706c 6520 6f72 2061 2073  n a tuple or a s
+0000ea30: 696e 676c 6520 6d6f 6469 6669 6564 2076  ingle modified v
+0000ea40: 616c 7565 2069 6e20 7468 650d 0a20 2020  alue in the..   
+0000ea50: 2020 2020 2068 6f6f 6b2e 2057 6520 7769       hook. We wi
+0000ea60: 6c6c 2077 7261 7020 7468 6520 7661 6c75  ll wrap the valu
+0000ea70: 6520 696e 746f 2061 2074 7570 6c65 2069  e into a tuple i
+0000ea80: 6620 6120 7369 6e67 6c65 2076 616c 7565  f a single value
+0000ea90: 2069 7320 7265 7475 726e 6564 0d0a 2020   is returned..  
+0000eaa0: 2020 2020 2020 2875 6e6c 6573 7320 7468        (unless th
+0000eab0: 6174 2076 616c 7565 2069 7320 616c 7265  at value is alre
+0000eac0: 6164 7920 6120 7475 706c 6529 2e20 5468  ady a tuple). Th
+0000ead0: 6520 686f 6f6b 2073 686f 756c 6420 6861  e hook should ha
+0000eae0: 7665 2074 6865 0d0a 2020 2020 2020 2020  ve the..        
+0000eaf0: 666f 6c6c 6f77 696e 6720 7369 676e 6174  following signat
+0000eb00: 7572 653a 3a0d 0a0d 0a20 2020 2020 2020  ure::....       
+0000eb10: 2020 2020 2068 6f6f 6b28 6d6f 6475 6c65       hook(module
+0000eb20: 2c20 6172 6773 2920 2d3e 204e 6f6e 6520  , args) -> None 
+0000eb30: 6f72 206d 6f64 6966 6965 6420 696e 7075  or modified inpu
+0000eb40: 740d 0a0d 0a20 2020 2020 2020 2049 6620  t....        If 
+0000eb50: 6060 7769 7468 5f6b 7761 7267 7360 6020  ``with_kwargs`` 
+0000eb60: 6973 2074 7275 652c 2074 6865 2066 6f72  is true, the for
+0000eb70: 7761 7264 2070 7265 2d68 6f6f 6b20 7769  ward pre-hook wi
+0000eb80: 6c6c 2062 6520 7061 7373 6564 2074 6865  ll be passed the
+0000eb90: 0d0a 2020 2020 2020 2020 6b77 6172 6773  ..        kwargs
+0000eba0: 2067 6976 656e 2074 6f20 7468 6520 666f   given to the fo
+0000ebb0: 7277 6172 6420 6675 6e63 7469 6f6e 2e20  rward function. 
+0000ebc0: 416e 6420 6966 2074 6865 2068 6f6f 6b20  And if the hook 
+0000ebd0: 6d6f 6469 6669 6573 2074 6865 0d0a 2020  modifies the..  
+0000ebe0: 2020 2020 2020 696e 7075 742c 2062 6f74        input, bot
+0000ebf0: 6820 7468 6520 6172 6773 2061 6e64 206b  h the args and k
+0000ec00: 7761 7267 7320 7368 6f75 6c64 2062 6520  wargs should be 
+0000ec10: 7265 7475 726e 6564 2e20 5468 6520 686f  returned. The ho
+0000ec20: 6f6b 2073 686f 756c 6420 6861 7665 0d0a  ok should have..
+0000ec30: 2020 2020 2020 2020 7468 6520 666f 6c6c          the foll
+0000ec40: 6f77 696e 6720 7369 676e 6174 7572 653a  owing signature:
+0000ec50: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+0000ec60: 2068 6f6f 6b28 6d6f 6475 6c65 2c20 6172   hook(module, ar
+0000ec70: 6773 2c20 6b77 6172 6773 2920 2d3e 204e  gs, kwargs) -> N
+0000ec80: 6f6e 6520 6f72 2061 2074 7570 6c65 206f  one or a tuple o
+0000ec90: 6620 6d6f 6469 6669 6564 2069 6e70 7574  f modified input
+0000eca0: 2061 6e64 206b 7761 7267 730d 0a0d 0a20   and kwargs.... 
+0000ecb0: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
+0000ecc0: 2020 2020 2020 2020 2020 686f 6f6b 2028            hook (
+0000ecd0: 4361 6c6c 6162 6c65 293a 2054 6865 2075  Callable): The u
+0000ece0: 7365 7220 6465 6669 6e65 6420 686f 6f6b  ser defined hook
+0000ecf0: 2074 6f20 6265 2072 6567 6973 7465 7265   to be registere
+0000ed00: 642e 0d0a 2020 2020 2020 2020 2020 2020  d...            
+0000ed10: 7072 6570 656e 6420 2862 6f6f 6c29 3a20  prepend (bool): 
+0000ed20: 4966 2074 7275 652c 2074 6865 2070 726f  If true, the pro
+0000ed30: 7669 6465 6420 6060 686f 6f6b 6060 2077  vided ``hook`` w
+0000ed40: 696c 6c20 6265 2066 6972 6564 2062 6566  ill be fired bef
+0000ed50: 6f72 650d 0a20 2020 2020 2020 2020 2020  ore..           
+0000ed60: 2020 2020 2061 6c6c 2065 7869 7374 696e       all existin
+0000ed70: 6720 6060 666f 7277 6172 645f 7072 6560  g ``forward_pre`
+0000ed80: 6020 686f 6f6b 7320 6f6e 2074 6869 730d  ` hooks on this.
+0000ed90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eda0: 203a 636c 6173 733a 6074 6f72 6368 2e6e   :class:`torch.n
+0000edb0: 6e2e 6d6f 6475 6c65 732e 4d6f 6475 6c65  n.modules.Module
+0000edc0: 602e 204f 7468 6572 7769 7365 2c20 7468  `. Otherwise, th
+0000edd0: 6520 7072 6f76 6964 6564 0d0a 2020 2020  e provided..    
+0000ede0: 2020 2020 2020 2020 2020 2020 6060 686f              ``ho
+0000edf0: 6f6b 6060 2077 696c 6c20 6265 2066 6972  ok`` will be fir
+0000ee00: 6564 2061 6674 6572 2061 6c6c 2065 7869  ed after all exi
+0000ee10: 7374 696e 6720 6060 666f 7277 6172 645f  sting ``forward_
+0000ee20: 7072 6560 6020 686f 6f6b 730d 0a20 2020  pre`` hooks..   
+0000ee30: 2020 2020 2020 2020 2020 2020 206f 6e20               on 
+0000ee40: 7468 6973 203a 636c 6173 733a 6074 6f72  this :class:`tor
+0000ee50: 6368 2e6e 6e2e 6d6f 6475 6c65 732e 4d6f  ch.nn.modules.Mo
+0000ee60: 6475 6c65 602e 204e 6f74 6520 7468 6174  dule`. Note that
+0000ee70: 2067 6c6f 6261 6c0d 0a20 2020 2020 2020   global..       
+0000ee80: 2020 2020 2020 2020 2060 6066 6f72 7761           ``forwa
+0000ee90: 7264 5f70 7265 6060 2068 6f6f 6b73 2072  rd_pre`` hooks r
+0000eea0: 6567 6973 7465 7265 6420 7769 7468 0d0a  egistered with..
+0000eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eec0: 3a66 756e 633a 6072 6567 6973 7465 725f  :func:`register_
+0000eed0: 6d6f 6475 6c65 5f66 6f72 7761 7264 5f70  module_forward_p
+0000eee0: 7265 5f68 6f6f 6b60 2077 696c 6c20 6669  re_hook` will fi
+0000eef0: 7265 2062 6566 6f72 6520 616c 6c0d 0a20  re before all.. 
+0000ef00: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000ef10: 6f6f 6b73 2072 6567 6973 7465 7265 6420  ooks registered 
+0000ef20: 6279 2074 6869 7320 6d65 7468 6f64 2e0d  by this method..
+0000ef30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef40: 2044 6566 6175 6c74 3a20 6060 4661 6c73   Default: ``Fals
+0000ef50: 6560 600d 0a20 2020 2020 2020 2020 2020  e``..           
+0000ef60: 2077 6974 685f 6b77 6172 6773 2028 626f   with_kwargs (bo
+0000ef70: 6f6c 293a 2049 6620 7472 7565 2c20 7468  ol): If true, th
+0000ef80: 6520 6060 686f 6f6b 6060 2077 696c 6c20  e ``hook`` will 
+0000ef90: 6265 2070 6173 7365 6420 7468 6520 6b77  be passed the kw
+0000efa0: 6172 6773 0d0a 2020 2020 2020 2020 2020  args..          
+0000efb0: 2020 2020 2020 6769 7665 6e20 746f 2074        given to t
+0000efc0: 6865 2066 6f72 7761 7264 2066 756e 6374  he forward funct
+0000efd0: 696f 6e2e 0d0a 2020 2020 2020 2020 2020  ion...          
+0000efe0: 2020 2020 2020 4465 6661 756c 743a 2060        Default: `
+0000eff0: 6046 616c 7365 6060 0d0a 0d0a 2020 2020  `False``....    
+0000f000: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
+0000f010: 2020 2020 2020 2020 2020 3a63 6c61 7373            :class
+0000f020: 3a60 746f 7263 682e 7574 696c 732e 686f  :`torch.utils.ho
+0000f030: 6f6b 732e 5265 6d6f 7661 626c 6548 616e  oks.RemovableHan
+0000f040: 646c 6560 3a0d 0a20 2020 2020 2020 2020  dle`:..         
+0000f050: 2020 2020 2020 2061 2068 616e 646c 6520         a handle 
+0000f060: 7468 6174 2063 616e 2062 6520 7573 6564  that can be used
+0000f070: 2074 6f20 7265 6d6f 7665 2074 6865 2061   to remove the a
+0000f080: 6464 6564 2068 6f6f 6b20 6279 2063 616c  dded hook by cal
+0000f090: 6c69 6e67 0d0a 2020 2020 2020 2020 2020  ling..          
+0000f0a0: 2020 2020 2020 6060 6861 6e64 6c65 2e72        ``handle.r
+0000f0b0: 656d 6f76 6528 2960 600d 0a20 2020 2020  emove()``..     
+0000f0c0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0000f0d0: 6861 6e64 6c65 203d 5265 6d6f 7661 626c  handle =Removabl
+0000f0e0: 6548 616e 646c 6528 0d0a 2020 2020 2020  eHandle(..      
+0000f0f0: 2020 2020 2020 7365 6c66 2e5f 666f 7277        self._forw
+0000f100: 6172 645f 7072 655f 686f 6f6b 732c 0d0a  ard_pre_hooks,..
+0000f110: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+0000f120: 615f 6469 6374 3d73 656c 662e 5f66 6f72  a_dict=self._for
+0000f130: 7761 7264 5f70 7265 5f68 6f6f 6b73 5f77  ward_pre_hooks_w
+0000f140: 6974 685f 6b77 6172 6773 0d0a 2020 2020  ith_kwargs..    
+0000f150: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+0000f160: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
+0000f170: 5f68 6f6f 6b73 5b68 616e 646c 652e 6964  _hooks[handle.id
+0000f180: 5d20 3d20 686f 6f6b 0d0a 2020 2020 2020  ] = hook..      
+0000f190: 2020 6966 2077 6974 685f 6b77 6172 6773    if with_kwargs
+0000f1a0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000f1b0: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
+0000f1c0: 5f68 6f6f 6b73 5f77 6974 685f 6b77 6172  _hooks_with_kwar
+0000f1d0: 6773 5b68 616e 646c 652e 6964 5d20 3d20  gs[handle.id] = 
+0000f1e0: 5472 7565 0d0a 0d0a 2020 2020 2020 2020  True....        
+0000f1f0: 6966 2070 7265 7065 6e64 3a0d 0a20 2020  if prepend:..   
+0000f200: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+0000f210: 6f72 7761 7264 5f70 7265 5f68 6f6f 6b73  orward_pre_hooks
+0000f220: 2e6d 6f76 655f 746f 5f65 6e64 2868 616e  .move_to_end(han
+0000f230: 646c 652e 6964 2c20 6c61 7374 3d46 616c  dle.id, last=Fal
+0000f240: 7365 2920 2023 2074 7970 653a 2069 676e  se)  # type: ign
+0000f250: 6f72 655b 6174 7472 2d64 6566 696e 6564  ore[attr-defined
+0000f260: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+0000f270: 6e20 6861 6e64 6c65 0d0a 0d0a 2020 2020  n handle....    
+0000f280: 6465 6620 7265 6769 7374 6572 5f66 6f72  def register_for
+0000f290: 7761 7264 5f68 6f6f 6b28 0d0a 2020 2020  ward_hook(..    
+0000f2a0: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+0000f2b0: 2020 2068 6f6f 6b3a 2055 6e69 6f6e 5b0d     hook: Union[.
+0000f2c0: 0a20 2020 2020 2020 2020 2020 2043 616c  .            Cal
+0000f2d0: 6c61 626c 655b 5b54 2c20 5475 706c 655b  lable[[T, Tuple[
+0000f2e0: 416e 792c 202e 2e2e 5d2c 2041 6e79 5d2c  Any, ...], Any],
+0000f2f0: 204f 7074 696f 6e61 6c5b 416e 795d 5d2c   Optional[Any]],
+0000f300: 0d0a 2020 2020 2020 2020 2020 2020 4361  ..            Ca
+0000f310: 6c6c 6162 6c65 5b5b 542c 2054 7570 6c65  llable[[T, Tuple
+0000f320: 5b41 6e79 2c20 2e2e 2e5d 2c20 4469 6374  [Any, ...], Dict
+0000f330: 5b73 7472 2c20 416e 795d 2c20 416e 795d  [str, Any], Any]
+0000f340: 2c20 4f70 7469 6f6e 616c 5b41 6e79 5d5d  , Optional[Any]]
+0000f350: 2c0d 0a20 2020 2020 2020 205d 2c0d 0a20  ,..        ],.. 
+0000f360: 2020 2020 2020 202a 2c0d 0a20 2020 2020         *,..     
+0000f370: 2020 2070 7265 7065 6e64 3a20 626f 6f6c     prepend: bool
+0000f380: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+0000f390: 2020 2077 6974 685f 6b77 6172 6773 3a20     with_kwargs: 
+0000f3a0: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+0000f3b0: 2020 2029 202d 3e20 5265 6d6f 7661 626c     ) -> Removabl
+0000f3c0: 6548 616e 646c 653a 0d0a 2020 2020 2020  eHandle:..      
+0000f3d0: 2020 7222 2222 5265 6769 7374 6572 7320    r"""Registers 
+0000f3e0: 6120 666f 7277 6172 6420 686f 6f6b 206f  a forward hook o
+0000f3f0: 6e20 7468 6520 6d6f 6475 6c65 2e0d 0a0d  n the module....
+0000f400: 0a20 2020 2020 2020 2054 6865 2068 6f6f  .        The hoo
+0000f410: 6b20 7769 6c6c 2062 6520 6361 6c6c 6564  k will be called
+0000f420: 2065 7665 7279 2074 696d 6520 6166 7465   every time afte
+0000f430: 7220 3a66 756e 633a 6066 6f72 7761 7264  r :func:`forward
+0000f440: 6020 6861 7320 636f 6d70 7574 6564 2061  ` has computed a
+0000f450: 6e20 6f75 7470 7574 2e0d 0a0d 0a20 2020  n output.....   
+0000f460: 2020 2020 2049 6620 6060 7769 7468 5f6b       If ``with_k
+0000f470: 7761 7267 7360 6020 6973 2060 6046 616c  wargs`` is ``Fal
+0000f480: 7365 6060 206f 7220 6e6f 7420 7370 6563  se`` or not spec
+0000f490: 6966 6965 642c 2074 6865 2069 6e70 7574  ified, the input
+0000f4a0: 2063 6f6e 7461 696e 7320 6f6e 6c79 0d0a   contains only..
+0000f4b0: 2020 2020 2020 2020 7468 6520 706f 7369          the posi
+0000f4c0: 7469 6f6e 616c 2061 7267 756d 656e 7473  tional arguments
+0000f4d0: 2067 6976 656e 2074 6f20 7468 6520 6d6f   given to the mo
+0000f4e0: 6475 6c65 2e20 4b65 7977 6f72 6420 6172  dule. Keyword ar
+0000f4f0: 6775 6d65 6e74 7320 776f 6e27 7420 6265  guments won't be
+0000f500: 0d0a 2020 2020 2020 2020 7061 7373 6564  ..        passed
+0000f510: 2074 6f20 7468 6520 686f 6f6b 7320 616e   to the hooks an
+0000f520: 6420 6f6e 6c79 2074 6f20 7468 6520 6060  d only to the ``
+0000f530: 666f 7277 6172 6460 602e 2054 6865 2068  forward``. The h
+0000f540: 6f6f 6b20 6361 6e20 6d6f 6469 6679 2074  ook can modify t
+0000f550: 6865 0d0a 2020 2020 2020 2020 6f75 7470  he..        outp
+0000f560: 7574 2e20 4974 2063 616e 206d 6f64 6966  ut. It can modif
+0000f570: 7920 7468 6520 696e 7075 7420 696e 706c  y the input inpl
+0000f580: 6163 6520 6275 7420 6974 2077 696c 6c20  ace but it will 
+0000f590: 6e6f 7420 6861 7665 2065 6666 6563 7420  not have effect 
+0000f5a0: 6f6e 0d0a 2020 2020 2020 2020 666f 7277  on..        forw
+0000f5b0: 6172 6420 7369 6e63 6520 7468 6973 2069  ard since this i
+0000f5c0: 7320 6361 6c6c 6564 2061 6674 6572 203a  s called after :
+0000f5d0: 6675 6e63 3a60 666f 7277 6172 6460 2069  func:`forward` i
+0000f5e0: 7320 6361 6c6c 6564 2e20 5468 6520 686f  s called. The ho
+0000f5f0: 6f6b 0d0a 2020 2020 2020 2020 7368 6f75  ok..        shou
+0000f600: 6c64 2068 6176 6520 7468 6520 666f 6c6c  ld have the foll
+0000f610: 6f77 696e 6720 7369 676e 6174 7572 653a  owing signature:
+0000f620: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+0000f630: 2068 6f6f 6b28 6d6f 6475 6c65 2c20 6172   hook(module, ar
+0000f640: 6773 2c20 6f75 7470 7574 2920 2d3e 204e  gs, output) -> N
+0000f650: 6f6e 6520 6f72 206d 6f64 6966 6965 6420  one or modified 
+0000f660: 6f75 7470 7574 0d0a 0d0a 2020 2020 2020  output....      
+0000f670: 2020 4966 2060 6077 6974 685f 6b77 6172    If ``with_kwar
+0000f680: 6773 6060 2069 7320 6060 5472 7565 6060  gs`` is ``True``
+0000f690: 2c20 7468 6520 666f 7277 6172 6420 686f  , the forward ho
+0000f6a0: 6f6b 2077 696c 6c20 6265 2070 6173 7365  ok will be passe
+0000f6b0: 6420 7468 650d 0a20 2020 2020 2020 2060  d the..        `
+0000f6c0: 606b 7761 7267 7360 6020 6769 7665 6e20  `kwargs`` given 
+0000f6d0: 746f 2074 6865 2066 6f72 7761 7264 2066  to the forward f
+0000f6e0: 756e 6374 696f 6e20 616e 6420 6265 2065  unction and be e
+0000f6f0: 7870 6563 7465 6420 746f 2072 6574 7572  xpected to retur
+0000f700: 6e20 7468 650d 0a20 2020 2020 2020 206f  n the..        o
+0000f710: 7574 7075 7420 706f 7373 6962 6c79 206d  utput possibly m
+0000f720: 6f64 6966 6965 642e 2054 6865 2068 6f6f  odified. The hoo
+0000f730: 6b20 7368 6f75 6c64 2068 6176 6520 7468  k should have th
+0000f740: 6520 666f 6c6c 6f77 696e 6720 7369 676e  e following sign
+0000f750: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
+0000f760: 2020 2020 2020 2068 6f6f 6b28 6d6f 6475         hook(modu
+0000f770: 6c65 2c20 6172 6773 2c20 6b77 6172 6773  le, args, kwargs
+0000f780: 2c20 6f75 7470 7574 2920 2d3e 204e 6f6e  , output) -> Non
+0000f790: 6520 6f72 206d 6f64 6966 6965 6420 6f75  e or modified ou
+0000f7a0: 7470 7574 0d0a 0d0a 2020 2020 2020 2020  tput....        
+0000f7b0: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+0000f7c0: 2020 2068 6f6f 6b20 2843 616c 6c61 626c     hook (Callabl
+0000f7d0: 6529 3a20 5468 6520 7573 6572 2064 6566  e): The user def
+0000f7e0: 696e 6564 2068 6f6f 6b20 746f 2062 6520  ined hook to be 
+0000f7f0: 7265 6769 7374 6572 6564 2e0d 0a20 2020  registered...   
+0000f800: 2020 2020 2020 2020 2070 7265 7065 6e64           prepend
+0000f810: 2028 626f 6f6c 293a 2049 6620 6060 5472   (bool): If ``Tr
+0000f820: 7565 6060 2c20 7468 6520 7072 6f76 6964  ue``, the provid
+0000f830: 6564 2060 6068 6f6f 6b60 6020 7769 6c6c  ed ``hook`` will
+0000f840: 2062 6520 6669 7265 640d 0a20 2020 2020   be fired..     
+0000f850: 2020 2020 2020 2020 2020 2062 6566 6f72             befor
+0000f860: 6520 616c 6c20 6578 6973 7469 6e67 2060  e all existing `
+0000f870: 6066 6f72 7761 7264 6060 2068 6f6f 6b73  `forward`` hooks
+0000f880: 206f 6e20 7468 6973 0d0a 2020 2020 2020   on this..      
+0000f890: 2020 2020 2020 2020 2020 3a63 6c61 7373            :class
+0000f8a0: 3a60 746f 7263 682e 6e6e 2e6d 6f64 756c  :`torch.nn.modul
+0000f8b0: 6573 2e4d 6f64 756c 6560 2e20 4f74 6865  es.Module`. Othe
+0000f8c0: 7277 6973 652c 2074 6865 2070 726f 7669  rwise, the provi
+0000f8d0: 6465 640d 0a20 2020 2020 2020 2020 2020  ded..           
+0000f8e0: 2020 2020 2060 6068 6f6f 6b60 6020 7769       ``hook`` wi
+0000f8f0: 6c6c 2062 6520 6669 7265 6420 6166 7465  ll be fired afte
+0000f900: 7220 616c 6c20 6578 6973 7469 6e67 2060  r all existing `
+0000f910: 6066 6f72 7761 7264 6060 2068 6f6f 6b73  `forward`` hooks
+0000f920: 206f 6e0d 0a20 2020 2020 2020 2020 2020   on..           
+0000f930: 2020 2020 2074 6869 7320 3a63 6c61 7373       this :class
+0000f940: 3a60 746f 7263 682e 6e6e 2e6d 6f64 756c  :`torch.nn.modul
+0000f950: 6573 2e4d 6f64 756c 6560 2e20 4e6f 7465  es.Module`. Note
+0000f960: 2074 6861 7420 676c 6f62 616c 0d0a 2020   that global..  
+0000f970: 2020 2020 2020 2020 2020 2020 2020 6060                ``
+0000f980: 666f 7277 6172 6460 6020 686f 6f6b 7320  forward`` hooks 
+0000f990: 7265 6769 7374 6572 6564 2077 6974 680d  registered with.
+0000f9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f9b0: 203a 6675 6e63 3a60 7265 6769 7374 6572   :func:`register
+0000f9c0: 5f6d 6f64 756c 655f 666f 7277 6172 645f  _module_forward_
+0000f9d0: 686f 6f6b 6020 7769 6c6c 2066 6972 6520  hook` will fire 
+0000f9e0: 6265 666f 7265 2061 6c6c 2068 6f6f 6b73  before all hooks
+0000f9f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fa00: 2020 7265 6769 7374 6572 6564 2062 7920    registered by 
+0000fa10: 7468 6973 206d 6574 686f 642e 0d0a 2020  this method...  
+0000fa20: 2020 2020 2020 2020 2020 2020 2020 4465                De
+0000fa30: 6661 756c 743a 2060 6046 616c 7365 6060  fault: ``False``
+0000fa40: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
+0000fa50: 7468 5f6b 7761 7267 7320 2862 6f6f 6c29  th_kwargs (bool)
+0000fa60: 3a20 4966 2060 6054 7275 6560 602c 2074  : If ``True``, t
+0000fa70: 6865 2060 6068 6f6f 6b60 6020 7769 6c6c  he ``hook`` will
+0000fa80: 2062 6520 7061 7373 6564 2074 6865 0d0a   be passed the..
+0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000faa0: 6b77 6172 6773 2067 6976 656e 2074 6f20  kwargs given to 
+0000fab0: 7468 6520 666f 7277 6172 6420 6675 6e63  the forward func
+0000fac0: 7469 6f6e 2e0d 0a20 2020 2020 2020 2020  tion...         
+0000fad0: 2020 2020 2020 2044 6566 6175 6c74 3a20         Default: 
+0000fae0: 6060 4661 6c73 6560 600d 0a0d 0a20 2020  ``False``....   
+0000faf0: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+0000fb00: 2020 2020 2020 2020 2020 203a 636c 6173             :clas
+0000fb10: 733a 6074 6f72 6368 2e75 7469 6c73 2e68  s:`torch.utils.h
+0000fb20: 6f6f 6b73 2e52 656d 6f76 6162 6c65 4861  ooks.RemovableHa
+0000fb30: 6e64 6c65 603a 0d0a 2020 2020 2020 2020  ndle`:..        
+0000fb40: 2020 2020 2020 2020 6120 6861 6e64 6c65          a handle
+0000fb50: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
+0000fb60: 6420 746f 2072 656d 6f76 6520 7468 6520  d to remove the 
+0000fb70: 6164 6465 6420 686f 6f6b 2062 7920 6361  added hook by ca
+0000fb80: 6c6c 696e 670d 0a20 2020 2020 2020 2020  lling..         
+0000fb90: 2020 2020 2020 2060 6068 616e 646c 652e         ``handle.
+0000fba0: 7265 6d6f 7665 2829 6060 0d0a 2020 2020  remove()``..    
+0000fbb0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000fbc0: 2068 616e 646c 6520 3d52 656d 6f76 6162   handle =Removab
+0000fbd0: 6c65 4861 6e64 6c65 280d 0a20 2020 2020  leHandle(..     
+0000fbe0: 2020 2020 2020 2073 656c 662e 5f66 6f72         self._for
+0000fbf0: 7761 7264 5f68 6f6f 6b73 2c0d 0a20 2020  ward_hooks,..   
+0000fc00: 2020 2020 2020 2020 2065 7874 7261 5f64           extra_d
+0000fc10: 6963 743d 7365 6c66 2e5f 666f 7277 6172  ict=self._forwar
+0000fc20: 645f 686f 6f6b 735f 7769 7468 5f6b 7761  d_hooks_with_kwa
+0000fc30: 7267 730d 0a20 2020 2020 2020 2029 0d0a  rgs..        )..
+0000fc40: 2020 2020 2020 2020 7365 6c66 2e5f 666f          self._fo
+0000fc50: 7277 6172 645f 686f 6f6b 735b 6861 6e64  rward_hooks[hand
+0000fc60: 6c65 2e69 645d 203d 2068 6f6f 6b0d 0a20  le.id] = hook.. 
+0000fc70: 2020 2020 2020 2069 6620 7769 7468 5f6b         if with_k
+0000fc80: 7761 7267 733a 0d0a 2020 2020 2020 2020  wargs:..        
+0000fc90: 2020 2020 7365 6c66 2e5f 666f 7277 6172      self._forwar
+0000fca0: 645f 686f 6f6b 735f 7769 7468 5f6b 7761  d_hooks_with_kwa
+0000fcb0: 7267 735b 6861 6e64 6c65 2e69 645d 203d  rgs[handle.id] =
+0000fcc0: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
+0000fcd0: 2069 6620 7072 6570 656e 643a 0d0a 2020   if prepend:..  
+0000fce0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000fcf0: 666f 7277 6172 645f 686f 6f6b 732e 6d6f  forward_hooks.mo
+0000fd00: 7665 5f74 6f5f 656e 6428 6861 6e64 6c65  ve_to_end(handle
+0000fd10: 2e69 642c 206c 6173 743d 4661 6c73 6529  .id, last=False)
+0000fd20: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
+0000fd30: 5b61 7474 722d 6465 6669 6e65 645d 0d0a  [attr-defined]..
+0000fd40: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+0000fd50: 616e 646c 650d 0a20 2020 2040 7072 6f70  andle..    @prop
+0000fd60: 6572 7479 0d0a 2020 2020 6465 6620 6275  erty..    def bu
+0000fd70: 696c 7428 7365 6c66 293a 0d0a 2020 2020  ilt(self):..    
+0000fd80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000fd90: 5f62 7569 6c74 0d0a 0d0a 2020 2020 4070  _built....    @p
+0000fda0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0000fdb0: 2069 6e70 7574 5f73 6861 7065 2873 656c   input_shape(sel
+0000fdc0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+0000fdd0: 5368 6170 6520 6f66 2069 6e70 7574 2074  Shape of input t
+0000fde0: 656e 736f 722c 6e6f 7420 696e 636c 7564  ensor,not includ
+0000fdf0: 696e 6720 7468 6520 6261 7463 6820 6178  ing the batch ax
+0000fe00: 6973 2e22 2222 0d0a 2020 2020 2020 2020  is."""..        
+0000fe10: 7265 7475 726e 2073 656c 662e 5f69 6e70  return self._inp
+0000fe20: 7574 5f73 6861 7065 0d0a 0d0a 2020 2020  ut_shape....    
+0000fe30: 4069 6e70 7574 5f73 6861 7065 2e73 6574  @input_shape.set
+0000fe40: 7465 720d 0a20 2020 2064 6566 2069 6e70  ter..    def inp
+0000fe50: 7574 5f73 6861 7065 2873 656c 662c 2076  ut_shape(self, v
+0000fe60: 616c 7565 2920 2d3e 2054 656e 736f 7253  alue) -> TensorS
+0000fe70: 6861 7065 3a0d 0a20 2020 2020 2020 2022  hape:..        "
+0000fe80: 2222 2053 6574 7469 6e67 2074 6865 2069  "" Setting the i
+0000fe90: 6e70 7574 5f73 6861 7065 2c20 6d65 616e  nput_shape, mean
+0000fea0: 7320 7468 6520 6c61 7965 7220 6765 7420  s the layer get 
+0000feb0: 7368 6170 6520 696e 666f 726d 6174 696f  shape informatio
+0000fec0: 6e20 616e 6420 7374 6172 7420 746f 2064  n and start to d
+0000fed0: 6f20 7468 6520 7368 6170 6520 696e 6665  o the shape infe
+0000fee0: 7272 656e 6365 2022 2222 0d0a 0d0a 2020  rrence """....  
+0000fef0: 2020 2020 2020 6966 2069 735f 7465 6e73        if is_tens
+0000ff00: 6f72 2876 616c 7565 2920 616e 6420 7661  or(value) and va
+0000ff10: 6c75 652e 6e64 696d 203d 3d20 3120 616e  lue.ndim == 1 an
+0000ff20: 6420 7661 6c75 652e 6474 7970 6520 3d3d  d value.dtype ==
+0000ff30: 2074 6f72 6368 2e69 6e74 3332 3a0d 0a20   torch.int32:.. 
+0000ff40: 2020 2020 2020 2020 2020 2076 616c 7565             value
+0000ff50: 203d 2054 656e 736f 7253 6861 7065 285b   = TensorShape([
+0000ff60: 4e6f 6e65 2c20 5d20 2b20 746f 5f6c 6973  None, ] + to_lis
+0000ff70: 7428 746f 5f6e 756d 7079 2876 616c 7565  t(to_numpy(value
+0000ff80: 2929 290d 0a20 2020 2020 2020 2065 6c69  )))..        eli
+0000ff90: 6620 6973 696e 7374 616e 6365 2876 616c  f isinstance(val
+0000ffa0: 7565 2c20 746f 7263 682e 5369 7a65 293a  ue, torch.Size):
+0000ffb0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0000ffc0: 6d73 203d 205b 4e6f 6e65 2c20 5d20 2b20  ms = [None, ] + 
+0000ffd0: 5b64 2066 6f72 2064 2069 6e20 7661 6c75  [d for d in valu
+0000ffe0: 655d 0d0a 2020 2020 2020 2020 2020 2020  e]..            
+0000fff0: 7661 6c75 6520 3d20 5465 6e73 6f72 5368  value = TensorSh
+00010000: 6170 6528 6469 6d73 290d 0a20 2020 2020  ape(dims)..     
+00010010: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00010020: 6365 2876 616c 7565 2c20 286c 6973 742c  ce(value, (list,
+00010030: 2074 7570 6c65 2929 2061 6e64 206c 656e   tuple)) and len
+00010040: 2876 616c 7565 2920 3e20 3020 616e 6420  (value) > 0 and 
+00010050: 616c 6c28 0d0a 2020 2020 2020 2020 2020  all(..          
+00010060: 2020 2020 2020 5b69 7369 6e73 7461 6e63        [isinstanc
+00010070: 6528 6974 656d 2c20 6e75 6d62 6572 732e  e(item, numbers.
+00010080: 496e 7465 6772 616c 2920 666f 7220 6974  Integral) for it
+00010090: 656d 2069 6e20 7661 6c75 655d 293a 0d0a  em in value]):..
+000100a0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000100b0: 6520 3d20 5465 6e73 6f72 5368 6170 6528  e = TensorShape(
+000100c0: 284e 6f6e 652c 2920 2b20 7661 6c75 6529  (None,) + value)
+000100d0: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+000100e0: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
+000100f0: 2028 6c69 7374 2c20 7475 706c 6529 2920   (list, tuple)) 
+00010100: 616e 6420 6c65 6e28 7661 6c75 6529 203e  and len(value) >
+00010110: 2030 2061 6e64 2061 6c6c 280d 0a20 2020   0 and all(..   
+00010120: 2020 2020 2020 2020 2020 2020 205b 6973               [is
+00010130: 5f74 656e 736f 7228 6974 656d 2920 616e  _tensor(item) an
+00010140: 6420 6e64 696d 2869 7465 6d29 203d 3d20  d ndim(item) == 
+00010150: 3120 616e 6420 6974 656d 2e64 7479 7065  1 and item.dtype
+00010160: 203d 3d20 746f 7263 682e 696e 7433 3220   == torch.int32 
+00010170: 666f 7220 6974 656d 2069 6e20 7661 6c75  for item in valu
+00010180: 655d 293a 0d0a 2020 2020 2020 2020 2020  e]):..          
+00010190: 2020 7661 6c75 6520 3d20 5b54 656e 736f    value = [Tenso
+000101a0: 7253 6861 7065 2873 6829 2066 6f72 2073  rShape(sh) for s
+000101b0: 6820 696e 2076 616c 7565 5d0d 0a20 2020  h in value]..   
+000101c0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+000101d0: 616e 6365 2876 616c 7565 2c20 5465 6e73  ance(value, Tens
+000101e0: 6f72 5368 6170 6529 3a0d 0a20 2020 2020  orShape):..     
+000101f0: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
+00010200: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00010210: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
+00010220: 5465 6e73 6f72 5368 6170 6528 7661 6c75  TensorShape(valu
+00010230: 6529 0d0a 0d0a 2020 2020 2020 2020 6966  e)....        if
+00010240: 2073 656c 662e 5f62 7569 6c74 203d 3d20   self._built == 
+00010250: 4661 6c73 6520 6f72 2073 656c 662e 5f69  False or self._i
+00010260: 6e70 7574 5f73 6861 7065 2069 7320 4e6f  nput_shape is No
+00010270: 6e65 206f 7220 7365 6c66 2e69 6e70 7574  ne or self.input
+00010280: 5f66 696c 7465 7273 2069 7320 4e6f 6e65  _filters is None
+00010290: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000102a0: 656c 662e 5f69 6e70 7574 5f73 6861 7065  elf._input_shape
+000102b0: 203d 2076 616c 7565 0d0a 2020 2020 2020   = value..      
+000102c0: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
+000102d0: 5f66 696c 7465 7273 203d 2073 656c 662e  _filters = self.
+000102e0: 5f69 6e70 7574 5f73 6861 7065 5b73 656c  _input_shape[sel
+000102f0: 662e 6669 6c74 6572 5f69 6e64 6578 5d0d  f.filter_index].
+00010300: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00010310: 662e 6275 696c 6428 7661 6c75 6529 0d0a  f.build(value)..
+00010320: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010330: 2e5f 6275 696c 7420 3d20 5472 7565 0d0a  ._built = True..
+00010340: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+00010350: 0a20 2020 2064 6566 2069 6e70 7574 5f73  .    def input_s
+00010360: 7065 6328 7365 6c66 293a 0d0a 2020 2020  pec(self):..    
+00010370: 2020 2020 6966 2073 656c 662e 6973 5f72      if self.is_r
+00010380: 6f6f 7420 616e 6420 7365 6c66 2e5f 7369  oot and self._si
+00010390: 676e 6174 7572 6520 6973 206e 6f74 204e  gnature is not N
+000103a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000103b0: 2020 7265 7475 726e 2075 6e70 6163 6b5f    return unpack_
+000103c0: 7369 6e67 6c65 746f 6e28 7365 6c66 2e5f  singleton(self._
+000103d0: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
+000103e0: 2e76 616c 7565 5f6c 6973 7429 0d0a 0d0a  .value_list)....
+000103f0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00010400: 2020 2064 6566 206f 7574 7075 745f 7368     def output_sh
+00010410: 6170 6528 7365 6c66 293a 0d0a 2020 2020  ape(self):..    
+00010420: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00010430: 5f6f 7574 7075 745f 7368 6170 650d 0a0d  _output_shape...
+00010440: 0a20 2020 2040 6f75 7470 7574 5f73 6861  .    @output_sha
+00010450: 7065 2e73 6574 7465 720d 0a20 2020 2064  pe.setter..    d
+00010460: 6566 206f 7574 7075 745f 7368 6170 6528  ef output_shape(
+00010470: 7365 6c66 2c20 7661 6c75 6529 3a0d 0a20  self, value):.. 
+00010480: 2020 2020 2020 2069 6620 6973 5f74 656e         if is_ten
+00010490: 736f 7228 7661 6c75 6529 2061 6e64 2076  sor(value) and v
+000104a0: 616c 7565 2e6e 6469 6d20 3d3d 2031 2061  alue.ndim == 1 a
+000104b0: 6e64 2076 616c 7565 2e64 7479 7065 203d  nd value.dtype =
+000104c0: 3d20 746f 7263 682e 696e 7433 323a 0d0a  = torch.int32:..
+000104d0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000104e0: 6520 3d20 5465 6e73 6f72 5368 6170 6528  e = TensorShape(
+000104f0: 5b4e 6f6e 652c 205d 202b 2074 6f5f 6c69  [None, ] + to_li
+00010500: 7374 2874 6f5f 6e75 6d70 7928 7661 6c75  st(to_numpy(valu
+00010510: 6529 2929 0d0a 2020 2020 2020 2020 656c  e)))..        el
+00010520: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
+00010530: 6c75 652c 2074 6f72 6368 2e53 697a 6529  lue, torch.Size)
+00010540: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00010550: 696d 7320 3d20 5b4e 6f6e 652c 205d 202b  ims = [None, ] +
+00010560: 205b 6420 666f 7220 6420 696e 2076 616c   [d for d in val
+00010570: 7565 5d0d 0a20 2020 2020 2020 2020 2020  ue]..           
+00010580: 2076 616c 7565 203d 2054 656e 736f 7253   value = TensorS
+00010590: 6861 7065 2864 696d 7329 0d0a 2020 2020  hape(dims)..    
+000105a0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+000105b0: 6e63 6528 7661 6c75 652c 2028 6c69 7374  nce(value, (list
+000105c0: 2c20 7475 706c 6529 2920 616e 6420 6c65  , tuple)) and le
+000105d0: 6e28 7661 6c75 6529 203e 2030 2061 6e64  n(value) > 0 and
+000105e0: 2061 6c6c 280d 0a20 2020 2020 2020 2020   all(..         
+000105f0: 2020 2020 2020 205b 6973 696e 7374 616e         [isinstan
+00010600: 6365 2869 7465 6d2c 206e 756d 6265 7273  ce(item, numbers
+00010610: 2e49 6e74 6567 7261 6c29 2066 6f72 2069  .Integral) for i
+00010620: 7465 6d20 696e 2076 616c 7565 5d29 3a0d  tem in value]):.
+00010630: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00010640: 7565 203d 2054 656e 736f 7253 6861 7065  ue = TensorShape
+00010650: 2828 4e6f 6e65 2c29 202b 2076 616c 7565  ((None,) + value
+00010660: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+00010670: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
+00010680: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+00010690: 2061 6e64 206c 656e 2876 616c 7565 2920   and len(value) 
+000106a0: 3e20 3020 616e 6420 616c 6c28 0d0a 2020  > 0 and all(..  
+000106b0: 2020 2020 2020 2020 2020 2020 2020 5b69                [i
+000106c0: 735f 7465 6e73 6f72 2869 7465 6d29 2061  s_tensor(item) a
+000106d0: 6e64 206e 6469 6d28 6974 656d 2920 3d3d  nd ndim(item) ==
+000106e0: 2031 2061 6e64 2069 7465 6d2e 6474 7970   1 and item.dtyp
+000106f0: 6520 3d3d 2074 6f72 6368 2e69 6e74 3332  e == torch.int32
+00010700: 2066 6f72 2069 7465 6d20 696e 2076 616c   for item in val
+00010710: 7565 5d29 3a0d 0a20 2020 2020 2020 2020  ue]):..         
+00010720: 2020 2076 616c 7565 203d 205b 5465 6e73     value = [Tens
+00010730: 6f72 5368 6170 6528 7368 2920 666f 7220  orShape(sh) for 
+00010740: 7368 2069 6e20 7661 6c75 655d 0d0a 2020  sh in value]..  
+00010750: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00010760: 7461 6e63 6528 7661 6c75 652c 2054 656e  tance(value, Ten
+00010770: 736f 7253 6861 7065 293a 0d0a 2020 2020  sorShape):..    
+00010780: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+00010790: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000107a0: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+000107b0: 2054 656e 736f 7253 6861 7065 2876 616c   TensorShape(val
+000107c0: 7565 290d 0a0d 0a20 2020 2020 2020 2073  ue)....        s
+000107d0: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
+000107e0: 6520 3d20 7661 6c75 650d 0a20 2020 2020  e = value..     
+000107f0: 2020 2069 6620 7365 6c66 2e69 735f 726f     if self.is_ro
+00010800: 6f74 3a0d 0a20 2020 2020 2020 2020 2020  ot:..           
+00010810: 2069 6620 7365 6c66 2e5f 7369 676e 6174   if self._signat
+00010820: 7572 6520 6973 204e 6f6e 653a 0d0a 2020  ure is None:..  
+00010830: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00010840: 6c66 2e5f 7369 676e 6174 7572 6520 3d20  lf._signature = 
+00010850: 5369 676e 6174 7572 6528 6e61 6d65 3d73  Signature(name=s
+00010860: 656c 662e 6e61 6d65 290d 0a20 2020 2020  elf.name)..     
+00010870: 2020 2020 2020 2073 656c 662e 5f73 6967         self._sig
+00010880: 6e61 7475 7265 2e6f 7574 7075 7473 203d  nature.outputs =
+00010890: 204f 7264 6572 6564 4469 6374 2829 0d0a   OrderedDict()..
+000108a0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000108b0: 7369 6e73 7461 6e63 6528 7365 6c66 2e5f  sinstance(self._
+000108c0: 6f75 7470 7574 5f73 6861 7065 2c20 5465  output_shape, Te
+000108d0: 6e73 6f72 5368 6170 6529 3a0d 0a20 2020  nsorShape):..   
+000108e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000108f0: 662e 5f73 6967 6e61 7475 7265 2e6f 7574  f._signature.out
+00010900: 7075 7473 5b27 6f75 7470 7574 275d 203d  puts['output'] =
+00010910: 2054 656e 736f 7253 7065 6328 7368 6170   TensorSpec(shap
+00010920: 653d 7365 6c66 2e5f 6f75 7470 7574 5f73  e=self._output_s
+00010930: 6861 7065 2c20 6e61 6d65 3d27 6f75 7470  hape, name='outp
+00010940: 7574 2729 0d0a 0d0a 2020 2020 2020 2020  ut')....        
+00010950: 2020 2020 656c 6966 2069 735f 7465 6e73      elif is_tens
+00010960: 6f72 2873 656c 662e 5f6f 7574 7075 745f  or(self._output_
+00010970: 7368 6170 6529 3a0d 0a20 2020 2020 2020  shape):..       
+00010980: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00010990: 6967 6e61 7475 7265 2e6f 7574 7075 7473  ignature.outputs
+000109a0: 5b27 6f75 7470 7574 275d 203d 2054 656e  ['output'] = Ten
+000109b0: 736f 7253 7065 6328 7368 6170 653d 5465  sorSpec(shape=Te
+000109c0: 6e73 6f72 5368 6170 6528 746f 5f6c 6973  nsorShape(to_lis
+000109d0: 7428 746f 5f6e 756d 7079 2873 656c 662e  t(to_numpy(self.
+000109e0: 5f6f 7574 7075 745f 7368 6170 6529 2929  _output_shape)))
+000109f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00010a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a20: 2020 2020 2020 206e 616d 653d 276f 7574         name='out
-00010a30: 7075 7427 290d 0a20 2020 2020 2020 2020  put')..         
-00010a40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00010a50: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-00010a60: 696e 2072 616e 6765 286c 656e 2873 656c  in range(len(sel
-00010a70: 662e 5f6f 7574 7075 745f 7368 6170 6529  f._output_shape)
-00010a80: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00010a90: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
-00010aa0: 676e 6174 7572 652e 6f75 7470 7574 735b  gnature.outputs[
-00010ab0: 276f 7574 7075 745f 7b30 7d27 2e66 6f72  'output_{0}'.for
-00010ac0: 6d61 7428 6b29 5d20 3d20 5465 6e73 6f72  mat(k)] = Tensor
-00010ad0: 5370 6563 2873 6861 7065 3d73 656c 662e  Spec(shape=self.
-00010ae0: 5f6f 7574 7075 745f 7368 6170 655b 6b5d  _output_shape[k]
-00010af0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a30: 2020 6e61 6d65 3d27 6f75 7470 7574 2729    name='output')
+00010a40: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00010a50: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00010a60: 2020 2020 2066 6f72 206b 2069 6e20 7261       for k in ra
+00010a70: 6e67 6528 6c65 6e28 7365 6c66 2e5f 6f75  nge(len(self._ou
+00010a80: 7470 7574 5f73 6861 7065 2929 3a0d 0a20  tput_shape)):.. 
+00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010aa0: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
+00010ab0: 7265 2e6f 7574 7075 7473 5b27 6f75 7470  re.outputs['outp
+00010ac0: 7574 5f7b 307d 272e 666f 726d 6174 286b  ut_{0}'.format(k
+00010ad0: 295d 203d 2054 656e 736f 7253 7065 6328  )] = TensorSpec(
+00010ae0: 7368 6170 653d 7365 6c66 2e5f 6f75 7470  shape=self._outp
+00010af0: 7574 5f73 6861 7065 5b6b 5d2c 0d0a 2020  ut_shape[k],..  
 00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b40: 2020 2020 6e61 6d65 3d27 6f75 7470 7574      name='output
-00010b50: 5f7b 307d 272e 666f 726d 6174 286b 2929  _{0}'.format(k))
-00010b60: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00010b70: 790d 0a20 2020 2064 6566 2073 6967 6e61  y..    def signa
-00010b80: 7475 7265 2873 656c 6629 3a0d 0a20 2020  ture(self):..   
-00010b90: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
-00010ba0: 2020 2020 5265 7475 726e 733a 0d0a 0d0a      Returns:....
-00010bb0: 2020 2020 2020 2020 2222 220d 0a0d 0a20          """.... 
-00010bc0: 2020 2020 2020 2061 7267 5f73 7065 6320         arg_spec 
-00010bd0: 3d20 6765 745f 6172 6773 5f73 7065 6328  = get_args_spec(
-00010be0: 7365 6c66 2e66 6f72 7761 7264 290d 0a20  self.forward).. 
-00010bf0: 2020 2020 2020 2069 6e73 7065 6374 5f61         inspect_a
-00010c00: 7267 7320 3d20 5b61 7267 2066 6f72 2061  rgs = [arg for a
-00010c10: 7267 2069 6e20 6c69 7374 2861 7267 5f73  rg in list(arg_s
-00010c20: 7065 632e 6172 6773 2920 6966 2061 7267  pec.args) if arg
-00010c30: 206e 6f74 2069 6e20 5b27 7365 6c66 272c   not in ['self',
-00010c40: 2027 6b77 6172 6773 275d 5d0d 0a20 2020   'kwargs']]..   
-00010c50: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00010c60: 6365 2861 7267 5f73 7065 632e 7661 7261  ce(arg_spec.vara
-00010c70: 7267 732c 2073 7472 293a 0d0a 2020 2020  rgs, str):..    
-00010c80: 2020 2020 2020 2020 696e 7370 6563 745f          inspect_
-00010c90: 6172 6773 2e61 7070 656e 6428 6172 675f  args.append(arg_
-00010ca0: 7370 6563 2e76 6172 6172 6773 290d 0a20  spec.varargs).. 
-00010cb0: 2020 2020 2020 2069 6e73 7065 6374 5f61         inspect_a
-00010cc0: 7267 7320 3d20 756e 7061 636b 5f73 696e  rgs = unpack_sin
-00010cd0: 676c 6574 6f6e 2869 6e73 7065 6374 5f61  gleton(inspect_a
-00010ce0: 7267 7329 0d0a 0d0a 2020 2020 2020 2020  rgs)....        
-00010cf0: 6966 2073 656c 662e 5f73 6967 6e61 7475  if self._signatu
-00010d00: 7265 2069 7320 4e6f 6e65 206f 7220 6c65  re is None or le
-00010d10: 6e28 7365 6c66 2e5f 7369 676e 6174 7572  n(self._signatur
-00010d20: 6529 203d 3d20 3020 6f72 206c 656e 2873  e) == 0 or len(s
-00010d30: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
-00010d40: 6e70 7574 7329 203d 3d20 303a 0d0a 2020  nputs) == 0:..  
-00010d50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00010d60: 7369 676e 6174 7572 6520 3d20 5369 676e  signature = Sign
-00010d70: 6174 7572 6528 6e61 6d65 3d73 656c 662e  ature(name=self.
-00010d80: 6e61 6d65 290d 0a0d 0a20 2020 2020 2020  name)....       
-00010d90: 2020 2020 2069 6620 7365 6c66 2e5f 696e       if self._in
-00010da0: 7075 745f 7368 6170 6520 6973 206e 6f74  put_shape is not
-00010db0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00010dc0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00010dd0: 7461 6e63 6528 7365 6c66 2e5f 696e 7075  tance(self._inpu
-00010de0: 745f 7368 6170 652c 2054 656e 736f 7253  t_shape, TensorS
-00010df0: 6861 7065 2920 616e 6420 6973 696e 7374  hape) and isinst
-00010e00: 616e 6365 2869 6e73 7065 6374 5f61 7267  ance(inspect_arg
-00010e10: 732c 2073 7472 293a 0d0a 2020 2020 2020  s, str):..      
-00010e20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010e30: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
-00010e40: 7075 7473 5b69 6e73 7065 6374 5f61 7267  puts[inspect_arg
-00010e50: 735d 203d 2054 656e 736f 7253 7065 6328  s] = TensorSpec(
-00010e60: 7368 6170 653d 5465 6e73 6f72 5368 6170  shape=TensorShap
-00010e70: 6528 7365 6c66 2e5f 696e 7075 745f 7368  e(self._input_sh
-00010e80: 6170 6529 2c0d 0a20 2020 2020 2020 2020  ape),..         
-00010e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b40: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00010b50: 616d 653d 276f 7574 7075 745f 7b30 7d27  ame='output_{0}'
+00010b60: 2e66 6f72 6d61 7428 6b29 290d 0a0d 0a20  .format(k)).... 
+00010b70: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00010b80: 2020 6465 6620 7369 676e 6174 7572 6528    def signature(
+00010b90: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00010ba0: 2222 220d 0a0d 0a20 2020 2020 2020 2052  """....        R
+00010bb0: 6574 7572 6e73 3a0d 0a0d 0a20 2020 2020  eturns:....     
+00010bc0: 2020 2022 2222 0d0a 0d0a 2020 2020 2020     """....      
+00010bd0: 2020 6172 675f 7370 6563 203d 2067 6574    arg_spec = get
+00010be0: 5f61 7267 735f 7370 6563 2873 656c 662e  _args_spec(self.
+00010bf0: 666f 7277 6172 6429 0d0a 2020 2020 2020  forward)..      
+00010c00: 2020 696e 7370 6563 745f 6172 6773 203d    inspect_args =
+00010c10: 205b 6172 6720 666f 7220 6172 6720 696e   [arg for arg in
+00010c20: 206c 6973 7428 6172 675f 7370 6563 2e61   list(arg_spec.a
+00010c30: 7267 7329 2069 6620 6172 6720 6e6f 7420  rgs) if arg not 
+00010c40: 696e 205b 2773 656c 6627 2c20 276b 7761  in ['self', 'kwa
+00010c50: 7267 7327 5d5d 0d0a 2020 2020 2020 2020  rgs']]..        
+00010c60: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
+00010c70: 675f 7370 6563 2e76 6172 6172 6773 2c20  g_spec.varargs, 
+00010c80: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
+00010c90: 2020 2069 6e73 7065 6374 5f61 7267 732e     inspect_args.
+00010ca0: 6170 7065 6e64 2861 7267 5f73 7065 632e  append(arg_spec.
+00010cb0: 7661 7261 7267 7329 0d0a 2020 2020 2020  varargs)..      
+00010cc0: 2020 696e 7370 6563 745f 6172 6773 203d    inspect_args =
+00010cd0: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+00010ce0: 6e28 696e 7370 6563 745f 6172 6773 290d  n(inspect_args).
+00010cf0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+00010d00: 6c66 2e5f 7369 676e 6174 7572 6520 6973  lf._signature is
+00010d10: 204e 6f6e 6520 6f72 206c 656e 2873 656c   None or len(sel
+00010d20: 662e 5f73 6967 6e61 7475 7265 2920 3d3d  f._signature) ==
+00010d30: 2030 206f 7220 6c65 6e28 7365 6c66 2e5f   0 or len(self._
+00010d40: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
+00010d50: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
+00010d60: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
+00010d70: 7475 7265 203d 2053 6967 6e61 7475 7265  ture = Signature
+00010d80: 286e 616d 653d 7365 6c66 2e6e 616d 6529  (name=self.name)
+00010d90: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00010da0: 6966 2073 656c 662e 5f69 6e70 7574 5f73  if self._input_s
+00010db0: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
+00010dc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00010dd0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00010de0: 2873 656c 662e 5f69 6e70 7574 5f73 6861  (self._input_sha
+00010df0: 7065 2c20 5465 6e73 6f72 5368 6170 6529  pe, TensorShape)
+00010e00: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00010e10: 696e 7370 6563 745f 6172 6773 2c20 7374  inspect_args, st
+00010e20: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+00010e30: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00010e40: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
+00010e50: 696e 7370 6563 745f 6172 6773 5d20 3d20  inspect_args] = 
+00010e60: 5465 6e73 6f72 5370 6563 2873 6861 7065  TensorSpec(shape
+00010e70: 3d54 656e 736f 7253 6861 7065 2873 656c  =TensorShape(sel
+00010e80: 662e 5f69 6e70 7574 5f73 6861 7065 292c  f._input_shape),
+00010e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00010ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ec0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00010ed0: 653d 696e 7370 6563 745f 6172 6773 290d  e=inspect_args).
-00010ee0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00010ef0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00010f00: 6365 2873 656c 662e 5f69 6e70 7574 5f73  ce(self._input_s
-00010f10: 6861 7065 2c20 7475 706c 6529 3a0d 0a20  hape, tuple):.. 
-00010f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f30: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00010f40: 6528 6c65 6e28 7365 6c66 2e5f 696e 7075  e(len(self._inpu
-00010f50: 745f 7368 6170 6529 293a 0d0a 2020 2020  t_shape)):..    
-00010f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f70: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
-00010f80: 7572 652e 696e 7075 7473 5b22 696e 7075  ure.inputs["inpu
-00010f90: 745f 7b30 7d22 2e66 6f72 6d61 7428 6929  t_{0}".format(i)
-00010fa0: 5d20 3d20 5465 6e73 6f72 5370 6563 280d  ] = TensorSpec(.
-00010fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010fc0: 2020 2020 2020 2020 2020 2020 2073 6861               sha
-00010fd0: 7065 3d54 656e 736f 7253 6861 7065 2873  pe=TensorShape(s
-00010fe0: 656c 662e 5f69 6e70 7574 5f73 6861 7065  elf._input_shape
-00010ff0: 5b69 5d29 2c20 6e61 6d65 3d22 696e 7075  [i]), name="inpu
-00011000: 745f 7b30 7d22 2e66 6f72 6d61 7428 6929  t_{0}".format(i)
-00011010: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00011020: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00011030: 2020 2020 2020 666f 7220 6172 6720 696e        for arg in
-00011040: 2069 6e73 7065 6374 5f61 7267 733a 0d0a   inspect_args:..
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
-00011070: 7572 652e 696e 7075 7473 5b61 7267 5d20  ure.inputs[arg] 
-00011080: 3d20 5465 6e73 6f72 5370 6563 2873 6861  = TensorSpec(sha
-00011090: 7065 3d4e 6f6e 6529 0d0a 0d0a 2020 2020  pe=None)....    
-000110a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000110b0: 5f6f 7574 7075 745f 7368 6170 6520 6973  _output_shape is
-000110c0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-000110d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000110e0: 7369 6e73 7461 6e63 6528 7365 6c66 2e5f  sinstance(self._
-000110f0: 6f75 7470 7574 5f73 6861 7065 2c20 5465  output_shape, Te
-00011100: 6e73 6f72 5368 6170 6529 3a0d 0a20 2020  nsorShape):..   
-00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011120: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
-00011130: 2e6f 7574 7075 7473 5b22 6f75 7470 7574  .outputs["output
-00011140: 225d 203d 2054 656e 736f 7253 7065 6328  "] = TensorSpec(
-00011150: 7368 6170 653d 5465 6e73 6f72 5368 6170  shape=TensorShap
-00011160: 6528 7365 6c66 2e5f 6f75 7470 7574 5f73  e(self._output_s
-00011170: 6861 7065 292c 206e 616d 653d 226f 7574  hape), name="out
-00011180: 7075 7422 290d 0a20 2020 2020 2020 2020  put")..         
-00011190: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-000111a0: 7374 616e 6365 2873 656c 662e 5f6f 7574  stance(self._out
-000111b0: 7075 745f 7368 6170 652c 2074 7570 6c65  put_shape, tuple
-000111c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000111d0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-000111e0: 2072 616e 6765 286c 656e 2873 656c 662e   range(len(self.
-000111f0: 5f6f 7574 7075 745f 7368 6170 6529 293a  _output_shape)):
-00011200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011210: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00011220: 7369 676e 6174 7572 652e 6f75 7470 7574  signature.output
-00011230: 735b 226f 7574 7075 745f 7b30 7d22 2e66  s["output_{0}".f
-00011240: 6f72 6d61 7428 6929 5d20 3d20 5465 6e73  ormat(i)] = Tens
-00011250: 6f72 5370 6563 280d 0a20 2020 2020 2020  orSpec(..       
-00011260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011270: 2020 2020 2073 6861 7065 3d74 6f5f 7465       shape=to_te
-00011280: 6e73 6f72 2873 656c 662e 5f6f 7574 7075  nsor(self._outpu
-00011290: 745f 7368 6170 655b 695d 292c 206e 616d  t_shape[i]), nam
-000112a0: 653d 226f 7574 7075 745f 7b30 7d22 2e66  e="output_{0}".f
-000112b0: 6f72 6d61 7428 6929 290d 0a20 2020 2020  ormat(i))..     
-000112c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000112d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000112e0: 6c66 2e5f 7369 676e 6174 7572 652e 6f75  lf._signature.ou
-000112f0: 7470 7574 735b 226f 7574 7075 7422 5d20  tputs["output"] 
-00011300: 3d20 5465 6e73 6f72 5370 6563 2873 6861  = TensorSpec(sha
-00011310: 7065 3d4e 6f6e 6529 0d0a 2020 2020 2020  pe=None)..      
-00011320: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00011330: 696e 7370 6563 745f 6172 6773 2c20 7374  inspect_args, st
-00011340: 7229 2061 6e64 206c 656e 2873 656c 662e  r) and len(self.
-00011350: 5f73 6967 6e61 7475 7265 2e69 6e70 7574  _signature.input
-00011360: 7329 203d 3d20 3120 616e 6420 7365 6c66  s) == 1 and self
-00011370: 2e5f 7369 676e 6174 7572 652e 696e 7075  ._signature.inpu
-00011380: 7473 2e6b 6579 5f6c 6973 745b 305d 2021  ts.key_list[0] !
-00011390: 3d20 696e 7370 6563 745f 6172 6773 3a0d  = inspect_args:.
-000113a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000113b0: 662e 5f73 6967 6e61 7475 7265 2e69 6e70  f._signature.inp
-000113c0: 7574 735b 696e 7370 6563 745f 6172 6773  uts[inspect_args
-000113d0: 5d20 3d20 7365 6c66 2e5f 7369 676e 6174  ] = self._signat
-000113e0: 7572 652e 696e 7075 7473 2e76 616c 7565  ure.inputs.value
-000113f0: 5f6c 6973 745b 305d 0d0a 2020 2020 2020  _list[0]..      
-00011400: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
-00011410: 6174 7572 652e 696e 7075 7473 2e70 6f70  ature.inputs.pop
-00011420: 2873 656c 662e 5f73 6967 6e61 7475 7265  (self._signature
-00011430: 2e69 6e70 7574 732e 6b65 795f 6c69 7374  .inputs.key_list
-00011440: 5b30 5d29 0d0a 2020 2020 2020 2020 656c  [0])..        el
-00011450: 6966 2069 7369 6e73 7461 6e63 6528 696e  if isinstance(in
-00011460: 7370 6563 745f 6172 6773 2c20 6c69 7374  spect_args, list
-00011470: 2920 616e 6420 6c65 6e28 7365 6c66 2e5f  ) and len(self._
-00011480: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
-00011490: 2920 3d3d 206c 656e 2869 6e73 7065 6374  ) == len(inspect
-000114a0: 5f61 7267 7329 3a0d 0a20 2020 2020 2020  _args):..       
-000114b0: 2020 2020 2066 6f72 206b 312c 206b 3220       for k1, k2 
-000114c0: 696e 207a 6970 2869 6e73 7065 6374 5f61  in zip(inspect_a
-000114d0: 7267 732c 2073 656c 662e 5f73 6967 6e61  rgs, self._signa
-000114e0: 7475 7265 2e69 6e70 7574 732e 6b65 795f  ture.inputs.key_
-000114f0: 6c69 7374 2e63 6f70 7928 2929 3a0d 0a20  list.copy()):.. 
-00011500: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011510: 6620 6b31 2021 3d20 6b32 3a0d 0a20 2020  f k1 != k2:..   
-00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011530: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
-00011540: 2e69 6e70 7574 735b 6b31 5d20 3d20 7365  .inputs[k1] = se
-00011550: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
-00011560: 7075 7473 5b6b 325d 0d0a 2020 2020 2020  puts[k2]..      
-00011570: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00011580: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
-00011590: 7075 7473 2e70 6f70 286b 3229 0d0a 2020  puts.pop(k2)..  
-000115a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000115b0: 662e 5f73 6967 6e61 7475 7265 0d0a 0d0a  f._signature....
-000115c0: 2020 2020 4073 6967 6e61 7475 7265 2e73      @signature.s
-000115d0: 6574 7465 720d 0a20 2020 2064 6566 2073  etter..    def s
-000115e0: 6967 6e61 7475 7265 2873 656c 662c 2076  ignature(self, v
-000115f0: 616c 7565 293a 0d0a 2020 2020 2020 2020  alue):..        
-00011600: 7365 6c66 2e5f 7369 676e 6174 7572 6520  self._signature 
-00011610: 3d20 7661 6c75 650d 0a0d 0a20 2020 2023  = value....    #
-00011620: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00011630: 2320 6465 6620 696e 7075 7428 7365 6c66  # def input(self
-00011640: 293a 0d0a 2020 2020 2320 2020 2020 7265  ):..    #     re
-00011650: 7475 726e 204e 6f74 496d 706c 656d 656e  turn NotImplemen
-00011660: 7465 640d 0a0d 0a20 2020 2040 7072 6f70  ted....    @prop
-00011670: 6572 7479 0d0a 2020 2020 6465 6620 6f75  erty..    def ou
-00011680: 7470 7574 2873 656c 6629 3a0d 0a20 2020  tput(self):..   
-00011690: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000116a0: 2020 2020 2020 5265 7472 6965 7665 7320        Retrieves 
-000116b0: 7468 6520 6f75 7470 7574 2074 656e 736f  the output tenso
-000116c0: 7228 7329 206f 6620 6120 6c61 7965 722e  r(s) of a layer.
-000116d0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-000116e0: 7220 6d65 6d6f 7279 2073 6176 696e 6720  r memory saving 
-000116f0: 6973 7375 652c 2077 6520 646f 6e27 7420  issue, we don't 
-00011700: 7072 6566 6572 2074 6f20 6b65 6570 2065  prefer to keep e
-00011710: 7665 7279 2069 6e70 7574 2f6f 7574 7075  very input/outpu
-00011720: 740d 0a20 2020 2020 2020 2020 2020 2074  t..            t
-00011730: 656e 736f 7220 696e 2065 7665 7279 206c  ensor in every l
-00011740: 6179 6572 2e59 6f75 2073 686f 756c 6420  ayer.You should 
-00011750: 7365 7420 7365 6c66 2e6b 6565 705f 6f75  set self.keep_ou
-00011760: 7470 7574 2066 6c61 6720 746f 2054 7275  tput flag to Tru
-00011770: 652c 2061 6e64 2074 6865 6e0d 0a20 2020  e, and then..   
-00011780: 2020 2020 2020 2020 2072 6574 7269 7665           retrive
-00011790: 2074 6865 206f 7574 7075 7420 7465 6e73   the output tens
-000117a0: 6f72 2077 6865 6e20 7468 6520 6361 6c6c  or when the call
-000117b0: 6c28 2920 6973 2065 7865 6375 7469 6e67  l() is executing
-000117c0: 2e0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-000117d0: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
-000117e0: 4f75 7470 7574 2074 656e 736f 7220 6f72  Output tensor or
-000117f0: 206c 6973 7420 6f66 206f 7574 7075 7420   list of output 
-00011800: 7465 6e73 6f72 732e 0d0a 0d0a 2020 2020  tensors.....    
-00011810: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00011820: 2069 6620 6e6f 7420 7365 6c66 2e6b 6565   if not self.kee
-00011830: 705f 6f75 7470 7574 3a0d 0a20 2020 2020  p_output:..     
-00011840: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00011850: 6e65 0d0a 2020 2020 2020 2020 7265 7475  ne..        retu
-00011860: 726e 206c 6973 7428 7365 6c66 2e5f 6f75  rn list(self._ou
-00011870: 7470 7574 5f74 656e 736f 7229 2069 6620  tput_tensor) if 
-00011880: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-00011890: 5f6f 7574 7075 745f 7465 6e73 6f72 2c20  _output_tensor, 
-000118a0: 7475 706c 6529 2065 6c73 6520 7365 6c66  tuple) else self
-000118b0: 2e5f 6f75 7470 7574 5f74 656e 736f 720d  ._output_tensor.
-000118c0: 0a0d 0a20 2020 2064 6566 2072 6573 6574  ...    def reset
-000118d0: 5f70 6172 616d 6574 6572 7328 7365 6c66  _parameters(self
-000118e0: 293a 0d0a 2020 2020 2020 2020 7061 7373  ):..        pass
-000118f0: 0d0a 0d0a 2020 2020 6465 6620 636f 7079  ....    def copy
-00011900: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00011910: 2022 2222 4372 6561 7465 2061 206e 6577   """Create a new
-00011920: 2046 726f 7a65 6e44 6963 7420 7769 7468   FrozenDict with
-00011930: 2061 6464 6974 696f 6e61 6c20 6f72 2072   additional or r
-00011940: 6570 6c61 6365 6420 656e 7472 6965 732e  eplaced entries.
-00011950: 2222 220d 0a20 2020 2020 2020 2073 6967  """..        sig
-00011960: 203d 2067 6574 5f73 6967 6e61 7475 7265   = get_signature
-00011970: 2874 7970 6528 7365 6c66 292e 5f5f 696e  (type(self).__in
-00011980: 6974 5f5f 290d 0a20 2020 2020 2020 205f  it__)..        _
-00011990: 6172 6773 203d 204f 7264 6572 6564 4469  args = OrderedDi
-000119a0: 6374 2829 0d0a 2020 2020 2020 2020 666f  ct()..        fo
-000119b0: 7220 696e 7020 696e 2073 6967 2e69 6e70  r inp in sig.inp
-000119c0: 7574 732e 6b65 795f 6c69 7374 3a0d 0a20  uts.key_list:.. 
-000119d0: 2020 2020 2020 2020 2020 2069 6620 696e             if in
-000119e0: 7020 696e 2073 656c 662e 5f5f 6469 6374  p in self.__dict
-000119f0: 5f5f 3a0d 0a20 2020 2020 2020 2020 2020  __:..           
-00011a00: 2020 2020 205f 6172 6773 5b69 6e70 5d20       _args[inp] 
-00011a10: 3d20 7365 6c66 2e5f 5f64 6963 745f 5f5b  = self.__dict__[
-00011a20: 696e 705d 0d0a 2020 2020 2020 2020 7368  inp]..        sh
-00011a30: 6164 6f77 203d 2074 7970 6528 7365 6c66  adow = type(self
-00011a40: 2928 2a2a 5f61 7267 7329 0d0a 2020 2020  )(**_args)..    
-00011a50: 2020 2020 7368 6164 6f77 2e62 7569 6c64      shadow.build
-00011a60: 2873 656c 662e 5f69 6e70 7574 5f73 6861  (self._input_sha
-00011a70: 7065 290d 0a20 2020 2020 2020 2066 6f72  pe)..        for
-00011a80: 206b 2c20 7620 696e 2073 656c 662e 5f5f   k, v in self.__
-00011a90: 6469 6374 5f5f 2e69 7465 6d73 2829 3a0d  dict__.items():.
-00011aa0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011ab0: 6b20 6e6f 7420 696e 205f 6172 6773 2061  k not in _args a
-00011ac0: 6e64 206b 206e 6f74 2069 6e20 5b27 5f6d  nd k not in ['_m
-00011ad0: 6f64 756c 6573 272c 2027 5f70 6172 616d  odules', '_param
-00011ae0: 6574 6572 7327 2c20 275f 6275 6666 6572  eters', '_buffer
-00011af0: 7327 5d3a 0d0a 2020 2020 2020 2020 2020  s']:..          
-00011b00: 2020 2020 2020 6966 2069 735f 7465 6e73        if is_tens
-00011b10: 6f72 2876 293a 0d0a 2020 2020 2020 2020  or(v):..        
-00011b20: 2020 2020 2020 2020 2020 2020 7368 6164              shad
-00011b30: 6f77 2e5f 5f64 6963 745f 5f5b 6b5d 203d  ow.__dict__[k] =
-00011b40: 2074 6f5f 7465 6e73 6f72 2874 6f5f 6e75   to_tensor(to_nu
-00011b50: 6d70 7928 7629 2c20 6474 7970 653d 762e  mpy(v), dtype=v.
-00011b60: 6474 7970 652c 2064 6576 6963 653d 762e  dtype, device=v.
-00011b70: 6465 7669 6365 2c0d 0a20 2020 2020 2020  device,..       
-00011b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ed0: 2020 2020 2020 2020 6e61 6d65 3d69 6e73          name=ins
+00010ee0: 7065 6374 5f61 7267 7329 0d0a 0d0a 2020  pect_args)....  
+00010ef0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00010f00: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+00010f10: 6c66 2e5f 696e 7075 745f 7368 6170 652c  lf._input_shape,
+00010f20: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
+00010f30: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00010f40: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+00010f50: 2873 656c 662e 5f69 6e70 7574 5f73 6861  (self._input_sha
+00010f60: 7065 2929 3a0d 0a20 2020 2020 2020 2020  pe)):..         
+00010f70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010f80: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
+00010f90: 6e70 7574 735b 2269 6e70 7574 5f7b 307d  nputs["input_{0}
+00010fa0: 222e 666f 726d 6174 2869 295d 203d 2054  ".format(i)] = T
+00010fb0: 656e 736f 7253 7065 6328 0d0a 2020 2020  ensorSpec(..    
+00010fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fd0: 2020 2020 2020 2020 7368 6170 653d 5465          shape=Te
+00010fe0: 6e73 6f72 5368 6170 6528 7365 6c66 2e5f  nsorShape(self._
+00010ff0: 696e 7075 745f 7368 6170 655b 695d 292c  input_shape[i]),
+00011000: 206e 616d 653d 2269 6e70 7574 5f7b 307d   name="input_{0}
+00011010: 222e 666f 726d 6174 2869 2929 0d0a 2020  ".format(i))..  
+00011020: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00011030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011040: 2066 6f72 2061 7267 2069 6e20 696e 7370   for arg in insp
+00011050: 6563 745f 6172 6773 3a0d 0a20 2020 2020  ect_args:..     
+00011060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00011070: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
+00011080: 6e70 7574 735b 6172 675d 203d 2054 656e  nputs[arg] = Ten
+00011090: 736f 7253 7065 6328 7368 6170 653d 4e6f  sorSpec(shape=No
+000110a0: 6e65 290d 0a0d 0a20 2020 2020 2020 2020  ne)....         
+000110b0: 2020 2069 6620 7365 6c66 2e5f 6f75 7470     if self._outp
+000110c0: 7574 5f73 6861 7065 2069 7320 6e6f 7420  ut_shape is not 
+000110d0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000110e0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000110f0: 616e 6365 2873 656c 662e 5f6f 7574 7075  ance(self._outpu
+00011100: 745f 7368 6170 652c 2054 656e 736f 7253  t_shape, TensorS
+00011110: 6861 7065 293a 0d0a 2020 2020 2020 2020  hape):..        
+00011120: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011130: 2e5f 7369 676e 6174 7572 652e 6f75 7470  ._signature.outp
+00011140: 7574 735b 226f 7574 7075 7422 5d20 3d20  uts["output"] = 
+00011150: 5465 6e73 6f72 5370 6563 2873 6861 7065  TensorSpec(shape
+00011160: 3d54 656e 736f 7253 6861 7065 2873 656c  =TensorShape(sel
+00011170: 662e 5f6f 7574 7075 745f 7368 6170 6529  f._output_shape)
+00011180: 2c20 6e61 6d65 3d22 6f75 7470 7574 2229  , name="output")
+00011190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000111a0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+000111b0: 6528 7365 6c66 2e5f 6f75 7470 7574 5f73  e(self._output_s
+000111c0: 6861 7065 2c20 7475 706c 6529 3a0d 0a20  hape, tuple):.. 
+000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111e0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000111f0: 6528 6c65 6e28 7365 6c66 2e5f 6f75 7470  e(len(self._outp
+00011200: 7574 5f73 6861 7065 2929 3a0d 0a20 2020  ut_shape)):..   
+00011210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011220: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
+00011230: 7475 7265 2e6f 7574 7075 7473 5b22 6f75  ture.outputs["ou
+00011240: 7470 7574 5f7b 307d 222e 666f 726d 6174  tput_{0}".format
+00011250: 2869 295d 203d 2054 656e 736f 7253 7065  (i)] = TensorSpe
+00011260: 6328 0d0a 2020 2020 2020 2020 2020 2020  c(..            
+00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011280: 7368 6170 653d 746f 5f74 656e 736f 7228  shape=to_tensor(
+00011290: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
+000112a0: 7065 5b69 5d29 2c20 6e61 6d65 3d22 6f75  pe[i]), name="ou
+000112b0: 7470 7574 5f7b 307d 222e 666f 726d 6174  tput_{0}".format
+000112c0: 2869 2929 0d0a 2020 2020 2020 2020 2020  (i))..          
+000112d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000112e0: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+000112f0: 6967 6e61 7475 7265 2e6f 7574 7075 7473  ignature.outputs
+00011300: 5b22 6f75 7470 7574 225d 203d 2054 656e  ["output"] = Ten
+00011310: 736f 7253 7065 6328 7368 6170 653d 4e6f  sorSpec(shape=No
+00011320: 6e65 290d 0a20 2020 2020 2020 2069 6620  ne)..        if 
+00011330: 6973 696e 7374 616e 6365 2869 6e73 7065  isinstance(inspe
+00011340: 6374 5f61 7267 732c 2073 7472 2920 616e  ct_args, str) an
+00011350: 6420 6c65 6e28 7365 6c66 2e5f 7369 676e  d len(self._sign
+00011360: 6174 7572 652e 696e 7075 7473 2920 3d3d  ature.inputs) ==
+00011370: 2031 2061 6e64 2073 656c 662e 5f73 6967   1 and self._sig
+00011380: 6e61 7475 7265 2e69 6e70 7574 732e 6b65  nature.inputs.ke
+00011390: 795f 6c69 7374 5b30 5d20 213d 2069 6e73  y_list[0] != ins
+000113a0: 7065 6374 5f61 7267 733a 0d0a 2020 2020  pect_args:..    
+000113b0: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
+000113c0: 676e 6174 7572 652e 696e 7075 7473 5b69  gnature.inputs[i
+000113d0: 6e73 7065 6374 5f61 7267 735d 203d 2073  nspect_args] = s
+000113e0: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
+000113f0: 6e70 7574 732e 7661 6c75 655f 6c69 7374  nputs.value_list
+00011400: 5b30 5d0d 0a20 2020 2020 2020 2020 2020  [0]..           
+00011410: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
+00011420: 2e69 6e70 7574 732e 706f 7028 7365 6c66  .inputs.pop(self
+00011430: 2e5f 7369 676e 6174 7572 652e 696e 7075  ._signature.inpu
+00011440: 7473 2e6b 6579 5f6c 6973 745b 305d 290d  ts.key_list[0]).
+00011450: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00011460: 696e 7374 616e 6365 2869 6e73 7065 6374  instance(inspect
+00011470: 5f61 7267 732c 206c 6973 7429 2061 6e64  _args, list) and
+00011480: 206c 656e 2873 656c 662e 5f73 6967 6e61   len(self._signa
+00011490: 7475 7265 2e69 6e70 7574 7329 203d 3d20  ture.inputs) == 
+000114a0: 6c65 6e28 696e 7370 6563 745f 6172 6773  len(inspect_args
+000114b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000114c0: 666f 7220 6b31 2c20 6b32 2069 6e20 7a69  for k1, k2 in zi
+000114d0: 7028 696e 7370 6563 745f 6172 6773 2c20  p(inspect_args, 
+000114e0: 7365 6c66 2e5f 7369 676e 6174 7572 652e  self._signature.
+000114f0: 696e 7075 7473 2e6b 6579 5f6c 6973 742e  inputs.key_list.
+00011500: 636f 7079 2829 293a 0d0a 2020 2020 2020  copy()):..      
+00011510: 2020 2020 2020 2020 2020 6966 206b 3120            if k1 
+00011520: 213d 206b 323a 0d0a 2020 2020 2020 2020  != k2:..        
+00011530: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011540: 2e5f 7369 676e 6174 7572 652e 696e 7075  ._signature.inpu
+00011550: 7473 5b6b 315d 203d 2073 656c 662e 5f73  ts[k1] = self._s
+00011560: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
+00011570: 6b32 5d0d 0a20 2020 2020 2020 2020 2020  k2]..           
+00011580: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00011590: 6967 6e61 7475 7265 2e69 6e70 7574 732e  ignature.inputs.
+000115a0: 706f 7028 6b32 290d 0a20 2020 2020 2020  pop(k2)..       
+000115b0: 2072 6574 7572 6e20 7365 6c66 2e5f 7369   return self._si
+000115c0: 676e 6174 7572 650d 0a0d 0a20 2020 2040  gnature....    @
+000115d0: 7369 676e 6174 7572 652e 7365 7474 6572  signature.setter
+000115e0: 0d0a 2020 2020 6465 6620 7369 676e 6174  ..    def signat
+000115f0: 7572 6528 7365 6c66 2c20 7661 6c75 6529  ure(self, value)
+00011600: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00011610: 5f73 6967 6e61 7475 7265 203d 2076 616c  _signature = val
+00011620: 7565 0d0a 0d0a 2020 2020 2320 4070 726f  ue....    # @pro
+00011630: 7065 7274 790d 0a20 2020 2023 2064 6566  perty..    # def
+00011640: 2069 6e70 7574 2873 656c 6629 3a0d 0a20   input(self):.. 
+00011650: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+00011660: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0d0a  NotImplemented..
+00011670: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+00011680: 0a20 2020 2064 6566 206f 7574 7075 7428  .    def output(
+00011690: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+000116a0: 2222 220d 0a20 2020 2020 2020 2020 2020  """..           
+000116b0: 2052 6574 7269 6576 6573 2074 6865 206f   Retrieves the o
+000116c0: 7574 7075 7420 7465 6e73 6f72 2873 2920  utput tensor(s) 
+000116d0: 6f66 2061 206c 6179 6572 2e0d 0a20 2020  of a layer...   
+000116e0: 2020 2020 2020 2020 2066 6f72 206d 656d           for mem
+000116f0: 6f72 7920 7361 7669 6e67 2069 7373 7565  ory saving issue
+00011700: 2c20 7765 2064 6f6e 2774 2070 7265 6665  , we don't prefe
+00011710: 7220 746f 206b 6565 7020 6576 6572 7920  r to keep every 
+00011720: 696e 7075 742f 6f75 7470 7574 0d0a 2020  input/output..  
+00011730: 2020 2020 2020 2020 2020 7465 6e73 6f72            tensor
+00011740: 2069 6e20 6576 6572 7920 6c61 7965 722e   in every layer.
+00011750: 596f 7520 7368 6f75 6c64 2073 6574 2073  You should set s
+00011760: 656c 662e 6b65 6570 5f6f 7574 7075 7420  elf.keep_output 
+00011770: 666c 6167 2074 6f20 5472 7565 2c20 616e  flag to True, an
+00011780: 6420 7468 656e 0d0a 2020 2020 2020 2020  d then..        
+00011790: 2020 2020 7265 7472 6976 6520 7468 6520      retrive the 
+000117a0: 6f75 7470 7574 2074 656e 736f 7220 7768  output tensor wh
+000117b0: 656e 2074 6865 2063 616c 6c6c 2829 2069  en the calll() i
+000117c0: 7320 6578 6563 7574 696e 672e 0d0a 2020  s executing...  
+000117d0: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+000117e0: 2020 2020 2020 2020 2020 204f 7574 7075             Outpu
+000117f0: 7420 7465 6e73 6f72 206f 7220 6c69 7374  t tensor or list
+00011800: 206f 6620 6f75 7470 7574 2074 656e 736f   of output tenso
+00011810: 7273 2e0d 0a0d 0a20 2020 2020 2020 2022  rs.....        "
+00011820: 2222 0d0a 2020 2020 2020 2020 6966 206e  ""..        if n
+00011830: 6f74 2073 656c 662e 6b65 6570 5f6f 7574  ot self.keep_out
+00011840: 7075 743a 0d0a 2020 2020 2020 2020 2020  put:..          
+00011850: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+00011860: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
+00011870: 7374 2873 656c 662e 5f6f 7574 7075 745f  st(self._output_
+00011880: 7465 6e73 6f72 2920 6966 2069 7369 6e73  tensor) if isins
+00011890: 7461 6e63 6528 7365 6c66 2e5f 6f75 7470  tance(self._outp
+000118a0: 7574 5f74 656e 736f 722c 2074 7570 6c65  ut_tensor, tuple
+000118b0: 2920 656c 7365 2073 656c 662e 5f6f 7574  ) else self._out
+000118c0: 7075 745f 7465 6e73 6f72 0d0a 0d0a 2020  put_tensor....  
+000118d0: 2020 6465 6620 7265 7365 745f 7061 7261    def reset_para
+000118e0: 6d65 7465 7273 2873 656c 6629 3a0d 0a20  meters(self):.. 
+000118f0: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+00011900: 2020 2064 6566 2063 6f70 7928 7365 6c66     def copy(self
+00011910: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
+00011920: 7265 6174 6520 6120 6e65 7720 4672 6f7a  reate a new Froz
+00011930: 656e 4469 6374 2077 6974 6820 6164 6469  enDict with addi
+00011940: 7469 6f6e 616c 206f 7220 7265 706c 6163  tional or replac
+00011950: 6564 2065 6e74 7269 6573 2e22 2222 0d0a  ed entries."""..
+00011960: 2020 2020 2020 2020 7369 6720 3d20 6765          sig = ge
+00011970: 745f 7369 676e 6174 7572 6528 7479 7065  t_signature(type
+00011980: 2873 656c 6629 2e5f 5f69 6e69 745f 5f29  (self).__init__)
+00011990: 0d0a 2020 2020 2020 2020 5f61 7267 7320  ..        _args 
+000119a0: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
+000119b0: 0a20 2020 2020 2020 2066 6f72 2069 6e70  .        for inp
+000119c0: 2069 6e20 7369 672e 696e 7075 7473 2e6b   in sig.inputs.k
+000119d0: 6579 5f6c 6973 743a 0d0a 2020 2020 2020  ey_list:..      
+000119e0: 2020 2020 2020 6966 2069 6e70 2069 6e20        if inp in 
+000119f0: 7365 6c66 2e5f 5f64 6963 745f 5f3a 0d0a  self.__dict__:..
+00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a10: 5f61 7267 735b 696e 705d 203d 2073 656c  _args[inp] = sel
+00011a20: 662e 5f5f 6469 6374 5f5f 5b69 6e70 5d0d  f.__dict__[inp].
+00011a30: 0a20 2020 2020 2020 2073 6861 646f 7720  .        shadow 
+00011a40: 3d20 7479 7065 2873 656c 6629 282a 2a5f  = type(self)(**_
+00011a50: 6172 6773 290d 0a20 2020 2020 2020 2073  args)..        s
+00011a60: 6861 646f 772e 6275 696c 6428 7365 6c66  hadow.build(self
+00011a70: 2e5f 696e 7075 745f 7368 6170 6529 0d0a  ._input_shape)..
+00011a80: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+00011a90: 2069 6e20 7365 6c66 2e5f 5f64 6963 745f   in self.__dict_
+00011aa0: 5f2e 6974 656d 7328 293a 0d0a 2020 2020  _.items():..    
+00011ab0: 2020 2020 2020 2020 6966 206b 206e 6f74          if k not
+00011ac0: 2069 6e20 5f61 7267 7320 616e 6420 6b20   in _args and k 
+00011ad0: 6e6f 7420 696e 205b 275f 6d6f 6475 6c65  not in ['_module
+00011ae0: 7327 2c20 275f 7061 7261 6d65 7465 7273  s', '_parameters
+00011af0: 272c 2027 5f62 7566 6665 7273 275d 3a0d  ', '_buffers']:.
+00011b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011b10: 2069 6620 6973 5f74 656e 736f 7228 7629   if is_tensor(v)
+00011b20: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00011b30: 2020 2020 2020 2073 6861 646f 772e 5f5f         shadow.__
+00011b40: 6469 6374 5f5f 5b6b 5d20 3d20 746f 5f74  dict__[k] = to_t
+00011b50: 656e 736f 7228 746f 5f6e 756d 7079 2876  ensor(to_numpy(v
+00011b60: 292c 2064 7479 7065 3d76 2e64 7479 7065  ), dtype=v.dtype
+00011b70: 2c20 6465 7669 6365 3d76 2e64 6576 6963  , device=v.devic
+00011b80: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
 00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ba0: 2020 2020 2020 2020 2020 2020 7265 7175              requ
-00011bb0: 6972 6573 5f67 7261 643d 762e 7265 7175  ires_grad=v.requ
-00011bc0: 6972 6573 5f67 7261 6429 0d0a 2020 2020  ires_grad)..    
-00011bd0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00011be0: 2069 7369 6e73 7461 6e63 6528 762c 2028   isinstance(v, (
-00011bf0: 7374 722c 2062 6f6f 6c2c 206e 756d 6265  str, bool, numbe
-00011c00: 7273 2e4e 756d 6265 7229 2920 6f72 206b  rs.Number)) or k
-00011c10: 2069 6e20 5b27 5f6e 6f64 6573 275d 3a0d   in ['_nodes']:.
-00011c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011c30: 2020 2020 2073 6574 6174 7472 2873 6861       setattr(sha
-00011c40: 646f 772c 206b 2c20 7629 0d0a 2020 2020  dow, k, v)..    
-00011c50: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00011c60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011c70: 2020 2020 2020 2073 6574 6174 7472 2873         setattr(s
-00011c80: 6861 646f 772c 206b 2c20 636f 7079 2e64  hadow, k, copy.d
-00011c90: 6565 7063 6f70 7928 7629 290d 0a20 2020  eepcopy(v))..   
-00011ca0: 2020 2020 2073 6861 646f 772e 6c6f 6164       shadow.load
-00011cb0: 5f73 7461 7465 5f64 6963 7428 7365 6c66  _state_dict(self
-00011cc0: 2e73 7461 7465 5f64 6963 7428 2929 0d0a  .state_dict())..
-00011cd0: 2020 2020 2020 2020 7368 6164 6f77 2e74          shadow.t
-00011ce0: 6f28 7365 6c66 2e64 6576 6963 6529 0d0a  o(self.device)..
-00011cf0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00011d00: 6861 646f 770d 0a0d 0a20 2020 2064 6566  hadow....    def
-00011d10: 2073 6176 655f 6f6e 6e78 2873 656c 662c   save_onnx(self,
-00011d20: 2066 696c 655f 7061 7468 3d27 2729 3a0d   file_path=''):.
-00011d30: 0a20 2020 2020 2020 2069 6e70 7574 5f73  .        input_s
-00011d40: 6861 7065 203d 2073 656c 662e 5f73 6967  hape = self._sig
-00011d50: 6e61 7475 7265 2e69 6e70 7574 732e 7661  nature.inputs.va
-00011d60: 6c75 655f 6c69 7374 5b30 5d2e 7368 6170  lue_list[0].shap
-00011d70: 652e 6469 6d73 0d0a 2020 2020 2020 2020  e.dims..        
-00011d80: 696e 7075 745f 7368 6170 655b 305d 203d  input_shape[0] =
-00011d90: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
-00011da0: 2e65 7661 6c28 290d 0a20 2020 2020 2020  .eval()..       
-00011db0: 2078 203d 2063 6173 7428 746f 7263 682e   x = cast(torch.
-00011dc0: 7261 6e64 6e28 2a69 6e70 7574 5f73 6861  randn(*input_sha
-00011dd0: 7065 2c20 7265 7175 6972 6573 5f67 7261  pe, requires_gra
-00011de0: 643d 4661 6c73 6529 2c20 7365 6c66 2e69  d=False), self.i
-00011df0: 6e70 7574 5f73 7065 632e 6474 7970 6529  nput_spec.dtype)
-00011e00: 0d0a 2020 2020 2020 2020 5f6f 7574 203d  ..        _out =
-00011e10: 2073 656c 6628 7829 0d0a 2020 2020 2020   self(x)..      
-00011e20: 2020 666f 6c64 6572 2c20 6669 6c65 6e61    folder, filena
-00011e30: 6d65 2c20 6578 7420 3d20 7370 6c69 745f  me, ext = split_
-00011e40: 7061 7468 2866 696c 655f 7061 7468 290d  path(file_path).
-00011e50: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
-00011e60: 6e61 6d65 203d 3d20 2727 3a0d 0a20 2020  name == '':..   
-00011e70: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
-00011e80: 6520 3d20 7365 6c66 2e6e 616d 650d 0a20  e = self.name.. 
-00011e90: 2020 2020 2020 2065 7874 203d 2027 2e6f         ext = '.o
-00011ea0: 6e6e 785f 270d 0a20 2020 2020 2020 2073  nnx_'..        s
-00011eb0: 6176 655f 7061 7468 203d 2073 616e 6974  ave_path = sanit
-00011ec0: 697a 655f 7061 7468 286f 732e 7061 7468  ize_path(os.path
-00011ed0: 2e6a 6f69 6e28 666f 6c64 6572 2c20 6669  .join(folder, fi
-00011ee0: 6c65 6e61 6d65 202b 2065 7874 2929 0d0a  lename + ext))..
-00011ef0: 2020 2020 2020 2020 6d61 6b65 5f64 6972          make_dir
-00011f00: 5f69 665f 6e65 6564 2873 6176 655f 7061  _if_need(save_pa
-00011f10: 7468 290d 0a0d 0a20 2020 2020 2020 2023  th)....        #
-00011f20: 2045 7870 6f72 7420 7468 6520 6d6f 6465   Export the mode
-00011f30: 6c0d 0a20 2020 2020 2020 2074 6f72 6368  l..        torch
-00011f40: 2e6f 6e6e 782e 6578 706f 7274 2873 656c  .onnx.export(sel
-00011f50: 662c 2020 2320 6d6f 6465 6c20 6265 696e  f,  # model bein
-00011f60: 6720 7275 6e0d 0a20 2020 2020 2020 2020  g run..         
-00011f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f80: 2078 2c20 2023 206d 6f64 656c 2069 6e70   x,  # model inp
-00011f90: 7574 2028 6f72 2061 2074 7570 6c65 2066  ut (or a tuple f
-00011fa0: 6f72 206d 756c 7469 706c 6520 696e 7075  or multiple inpu
-00011fb0: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
-00011fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00011fd0: 6176 655f 7061 7468 2c20 2023 2077 6865  ave_path,  # whe
-00011fe0: 7265 2074 6f20 7361 7665 2074 6865 206d  re to save the m
-00011ff0: 6f64 656c 2028 6361 6e20 6265 2061 2066  odel (can be a f
-00012000: 696c 6520 6f72 2066 696c 652d 6c69 6b65  ile or file-like
-00012010: 206f 626a 6563 7429 0d0a 2020 2020 2020   object)..      
-00012020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012030: 2020 2020 6578 706f 7274 5f70 6172 616d      export_param
-00012040: 733d 5472 7565 2c20 2023 2073 746f 7265  s=True,  # store
-00012050: 2074 6865 2074 7261 696e 6564 2070 6172   the trained par
-00012060: 616d 6574 6572 2077 6569 6768 7473 2069  ameter weights i
-00012070: 6e73 6964 6520 7468 6520 6d6f 6465 6c20  nside the model 
-00012080: 6669 6c65 0d0a 2020 2020 2020 2020 2020  file..          
-00012090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120a0: 6f70 7365 745f 7665 7273 696f 6e3d 3131  opset_version=11
-000120b0: 2c20 2023 2074 6865 204f 4e4e 5820 7665  ,  # the ONNX ve
-000120c0: 7273 696f 6e20 746f 2065 7870 6f72 7420  rsion to export 
-000120d0: 7468 6520 6d6f 6465 6c20 746f 0d0a 2020  the model to..  
-000120e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120f0: 2020 2020 2020 2020 646f 5f63 6f6e 7374          do_const
-00012100: 616e 745f 666f 6c64 696e 673d 5472 7565  ant_folding=True
-00012110: 2c20 2023 2077 6865 7468 6572 2074 6f20  ,  # whether to 
-00012120: 6578 6563 7574 6520 636f 6e73 7461 6e74  execute constant
-00012130: 2066 6f6c 6469 6e67 2066 6f72 206f 7074   folding for opt
-00012140: 696d 697a 6174 696f 6e0d 0a20 2020 2020  imization..     
-00012150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012160: 2020 2020 2069 6e70 7574 5f6e 616d 6573       input_names
-00012170: 3d5b 2769 6e70 7574 275d 2c20 2023 2074  =['input'],  # t
-00012180: 6865 206d 6f64 656c 2773 2069 6e70 7574  he model's input
-00012190: 206e 616d 6573 0d0a 2020 2020 2020 2020   names..        
-000121a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121b0: 2020 6f75 7470 7574 5f6e 616d 6573 3d5b    output_names=[
-000121c0: 276f 7574 7075 7427 5d2c 2020 2320 7468  'output'],  # th
-000121d0: 6520 6d6f 6465 6c27 7320 6f75 7470 7574  e model's output
-000121e0: 206e 616d 6573 0d0a 2020 2020 2020 2020   names..        
-000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012200: 2020 6479 6e61 6d69 635f 6178 6573 3d7b    dynamic_axes={
-00012210: 2769 6e70 7574 273a 207b 303a 2027 6261  'input': {0: 'ba
-00012220: 7463 685f 7369 7a65 277d 2c20 2023 2076  tch_size'},  # v
-00012230: 6172 6961 626c 6520 6c65 6e67 6874 2061  ariable lenght a
-00012240: 7865 730d 0a20 2020 2020 2020 2020 2020  xes..           
+00011ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bb0: 2020 2020 2020 2072 6571 7569 7265 735f         requires_
+00011bc0: 6772 6164 3d76 2e72 6571 7569 7265 735f  grad=v.requires_
+00011bd0: 6772 6164 290d 0a20 2020 2020 2020 2020  grad)..         
+00011be0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+00011bf0: 7374 616e 6365 2876 2c20 2873 7472 2c20  stance(v, (str, 
+00011c00: 626f 6f6c 2c20 6e75 6d62 6572 732e 4e75  bool, numbers.Nu
+00011c10: 6d62 6572 2929 206f 7220 6b20 696e 205b  mber)) or k in [
+00011c20: 275f 6e6f 6465 7327 5d3a 0d0a 2020 2020  '_nodes']:..    
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c40: 7365 7461 7474 7228 7368 6164 6f77 2c20  setattr(shadow, 
+00011c50: 6b2c 2076 290d 0a20 2020 2020 2020 2020  k, v)..         
+00011c60: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00011c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c80: 2020 7365 7461 7474 7228 7368 6164 6f77    setattr(shadow
+00011c90: 2c20 6b2c 2063 6f70 792e 6465 6570 636f  , k, copy.deepco
+00011ca0: 7079 2876 2929 0d0a 2020 2020 2020 2020  py(v))..        
+00011cb0: 7368 6164 6f77 2e6c 6f61 645f 7374 6174  shadow.load_stat
+00011cc0: 655f 6469 6374 2873 656c 662e 7374 6174  e_dict(self.stat
+00011cd0: 655f 6469 6374 2829 290d 0a20 2020 2020  e_dict())..     
+00011ce0: 2020 2073 6861 646f 772e 746f 2873 656c     shadow.to(sel
+00011cf0: 662e 6465 7669 6365 290d 0a20 2020 2020  f.device)..     
+00011d00: 2020 2072 6574 7572 6e20 7368 6164 6f77     return shadow
+00011d10: 0d0a 0d0a 2020 2020 6465 6620 7361 7665  ....    def save
+00011d20: 5f6f 6e6e 7828 7365 6c66 2c20 6669 6c65  _onnx(self, file
+00011d30: 5f70 6174 683d 2727 293a 0d0a 2020 2020  _path=''):..    
+00011d40: 2020 2020 696e 7075 745f 7368 6170 6520      input_shape 
+00011d50: 3d20 7365 6c66 2e5f 7369 676e 6174 7572  = self._signatur
+00011d60: 652e 696e 7075 7473 2e76 616c 7565 5f6c  e.inputs.value_l
+00011d70: 6973 745b 305d 2e73 6861 7065 2e64 696d  ist[0].shape.dim
+00011d80: 730d 0a20 2020 2020 2020 2069 6e70 7574  s..        input
+00011d90: 5f73 6861 7065 5b30 5d20 3d20 310d 0a20  _shape[0] = 1.. 
+00011da0: 2020 2020 2020 2073 656c 662e 6576 616c         self.eval
+00011db0: 2829 0d0a 2020 2020 2020 2020 7820 3d20  ()..        x = 
+00011dc0: 6361 7374 2874 6f72 6368 2e72 616e 646e  cast(torch.randn
+00011dd0: 282a 696e 7075 745f 7368 6170 652c 2072  (*input_shape, r
+00011de0: 6571 7569 7265 735f 6772 6164 3d46 616c  equires_grad=Fal
+00011df0: 7365 292c 2073 656c 662e 696e 7075 745f  se), self.input_
+00011e00: 7370 6563 2e64 7479 7065 290d 0a20 2020  spec.dtype)..   
+00011e10: 2020 2020 205f 6f75 7420 3d20 7365 6c66       _out = self
+00011e20: 2878 290d 0a20 2020 2020 2020 2066 6f6c  (x)..        fol
+00011e30: 6465 722c 2066 696c 656e 616d 652c 2065  der, filename, e
+00011e40: 7874 203d 2073 706c 6974 5f70 6174 6828  xt = split_path(
+00011e50: 6669 6c65 5f70 6174 6829 0d0a 2020 2020  file_path)..    
+00011e60: 2020 2020 6966 2066 696c 656e 616d 6520      if filename 
+00011e70: 3d3d 2027 273a 0d0a 2020 2020 2020 2020  == '':..        
+00011e80: 2020 2020 6669 6c65 6e61 6d65 203d 2073      filename = s
+00011e90: 656c 662e 6e61 6d65 0d0a 2020 2020 2020  elf.name..      
+00011ea0: 2020 6578 7420 3d20 272e 6f6e 6e78 5f27    ext = '.onnx_'
+00011eb0: 0d0a 2020 2020 2020 2020 7361 7665 5f70  ..        save_p
+00011ec0: 6174 6820 3d20 7361 6e69 7469 7a65 5f70  ath = sanitize_p
+00011ed0: 6174 6828 6f73 2e70 6174 682e 6a6f 696e  ath(os.path.join
+00011ee0: 2866 6f6c 6465 722c 2066 696c 656e 616d  (folder, filenam
+00011ef0: 6520 2b20 6578 7429 290d 0a20 2020 2020  e + ext))..     
+00011f00: 2020 206d 616b 655f 6469 725f 6966 5f6e     make_dir_if_n
+00011f10: 6565 6428 7361 7665 5f70 6174 6829 0d0a  eed(save_path)..
+00011f20: 0d0a 2020 2020 2020 2020 2320 4578 706f  ..        # Expo
+00011f30: 7274 2074 6865 206d 6f64 656c 0d0a 2020  rt the model..  
+00011f40: 2020 2020 2020 746f 7263 682e 6f6e 6e78        torch.onnx
+00011f50: 2e65 7870 6f72 7428 7365 6c66 2c20 2023  .export(self,  #
+00011f60: 206d 6f64 656c 2062 6569 6e67 2072 756e   model being run
+00011f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011f80: 2020 2020 2020 2020 2020 2020 782c 2020              x,  
+00011f90: 2320 6d6f 6465 6c20 696e 7075 7420 286f  # model input (o
+00011fa0: 7220 6120 7475 706c 6520 666f 7220 6d75  r a tuple for mu
+00011fb0: 6c74 6970 6c65 2069 6e70 7574 7329 0d0a  ltiple inputs)..
+00011fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fd0: 2020 2020 2020 2020 2020 7361 7665 5f70            save_p
+00011fe0: 6174 682c 2020 2320 7768 6572 6520 746f  ath,  # where to
+00011ff0: 2073 6176 6520 7468 6520 6d6f 6465 6c20   save the model 
+00012000: 2863 616e 2062 6520 6120 6669 6c65 206f  (can be a file o
+00012010: 7220 6669 6c65 2d6c 696b 6520 6f62 6a65  r file-like obje
+00012020: 6374 290d 0a20 2020 2020 2020 2020 2020  ct)..           
+00012030: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00012040: 7870 6f72 745f 7061 7261 6d73 3d54 7275  xport_params=Tru
+00012050: 652c 2020 2320 7374 6f72 6520 7468 6520  e,  # store the 
+00012060: 7472 6169 6e65 6420 7061 7261 6d65 7465  trained paramete
+00012070: 7220 7765 6967 6874 7320 696e 7369 6465  r weights inside
+00012080: 2074 6865 206d 6f64 656c 2066 696c 650d   the model file.
+00012090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000120a0: 2020 2020 2020 2020 2020 206f 7073 6574             opset
+000120b0: 5f76 6572 7369 6f6e 3d31 312c 2020 2320  _version=11,  # 
+000120c0: 7468 6520 4f4e 4e58 2076 6572 7369 6f6e  the ONNX version
+000120d0: 2074 6f20 6578 706f 7274 2074 6865 206d   to export the m
+000120e0: 6f64 656c 2074 6f0d 0a20 2020 2020 2020  odel to..       
+000120f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012100: 2020 2064 6f5f 636f 6e73 7461 6e74 5f66     do_constant_f
+00012110: 6f6c 6469 6e67 3d54 7275 652c 2020 2320  olding=True,  # 
+00012120: 7768 6574 6865 7220 746f 2065 7865 6375  whether to execu
+00012130: 7465 2063 6f6e 7374 616e 7420 666f 6c64  te constant fold
+00012140: 696e 6720 666f 7220 6f70 7469 6d69 7a61  ing for optimiza
+00012150: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
+00012160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012170: 696e 7075 745f 6e61 6d65 733d 5b27 696e  input_names=['in
+00012180: 7075 7427 5d2c 2020 2320 7468 6520 6d6f  put'],  # the mo
+00012190: 6465 6c27 7320 696e 7075 7420 6e61 6d65  del's input name
+000121a0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+000121b0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+000121c0: 7075 745f 6e61 6d65 733d 5b27 6f75 7470  put_names=['outp
+000121d0: 7574 275d 2c20 2023 2074 6865 206d 6f64  ut'],  # the mod
+000121e0: 656c 2773 206f 7574 7075 7420 6e61 6d65  el's output name
+000121f0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00012200: 2020 2020 2020 2020 2020 2020 2064 796e               dyn
+00012210: 616d 6963 5f61 7865 733d 7b27 696e 7075  amic_axes={'inpu
+00012220: 7427 3a20 7b30 3a20 2762 6174 6368 5f73  t': {0: 'batch_s
+00012230: 697a 6527 7d2c 2020 2320 7661 7269 6162  ize'},  # variab
+00012240: 6c65 206c 656e 6768 7420 6178 6573 0d0a  le lenght axes..
 00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2020 2020 2020 2020 2020 2020 2027 6f75               'ou
-00012270: 7470 7574 273a 207b 303a 2027 6261 7463  tput': {0: 'batc
-00012280: 685f 7369 7a65 277d 7d29 0d0a 2020 2020  h_size'}})..    
-00012290: 2020 2020 7365 6c66 2e74 7261 696e 2829      self.train()
-000122a0: 0d0a 2020 2020 2020 2020 7368 7574 696c  ..        shutil
-000122b0: 2e63 6f70 7928 7361 7665 5f70 6174 682c  .copy(save_path,
-000122c0: 2073 6176 655f 7061 7468 2e72 6570 6c61   save_path.repla
-000122d0: 6365 2827 2e6f 6e6e 785f 272c 2027 2e6f  ce('.onnx_', '.o
-000122e0: 6e6e 7827 2929 0d0a 2020 2020 2020 2020  nnx'))..        
-000122f0: 6f73 2e72 656d 6f76 6528 7361 7665 5f70  os.remove(save_p
-00012300: 6174 6829 0d0a 0d0a 2020 2020 6465 6620  ath)....    def 
-00012310: 5f73 6c6f 775f 666f 7277 6172 6428 7365  _slow_forward(se
-00012320: 6c66 2c20 2a69 6e70 7574 2c20 2a2a 6b77  lf, *input, **kw
-00012330: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00012340: 7472 6163 696e 675f 7374 6174 6520 3d20  tracing_state = 
-00012350: 746f 7263 682e 5f43 2e5f 6765 745f 7472  torch._C._get_tr
-00012360: 6163 696e 675f 7374 6174 6528 290d 0a20  acing_state().. 
-00012370: 2020 2020 2020 2069 6620 6e6f 7420 7472         if not tr
-00012380: 6163 696e 675f 7374 6174 6520 6f72 2069  acing_state or i
-00012390: 7369 6e73 7461 6e63 6528 7365 6c66 2e66  sinstance(self.f
-000123a0: 6f72 7761 7264 2c20 746f 7263 682e 5f43  orward, torch._C
-000123b0: 2e53 6372 6970 744d 6574 686f 6429 3a0d  .ScriptMethod):.
-000123c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000123d0: 7572 6e20 7365 6c66 2e66 6f72 7761 7264  urn self.forward
-000123e0: 282a 696e 7075 742c 202a 2a6b 7761 7267  (*input, **kwarg
-000123f0: 7329 0d0a 2020 2020 2020 2020 7265 636f  s)..        reco
-00012400: 7264 696e 675f 7363 6f70 6573 203d 2074  rding_scopes = t
-00012410: 6f72 6368 2e6a 6974 2e5f 7472 6163 652e  orch.jit._trace.
-00012420: 5f74 7261 6365 5f6d 6f64 756c 655f 6d61  _trace_module_ma
-00012430: 7020 6973 206e 6f74 204e 6f6e 650d 0a20  p is not None.. 
-00012440: 2020 2020 2020 2069 6620 7265 636f 7264         if record
-00012450: 696e 675f 7363 6f70 6573 3a0d 0a20 2020  ing_scopes:..   
-00012460: 2020 2020 2020 2020 2023 2074 7970 6520           # type 
-00012470: 6967 6e6f 7265 2077 6173 2061 6464 6564  ignore was added
-00012480: 2062 6563 6175 7365 2061 7420 7468 6973   because at this
-00012490: 2070 6f69 6e74 206f 6e65 206b 6e6f 7773   point one knows
-000124a0: 2074 6861 740d 0a20 2020 2020 2020 2020   that..         
-000124b0: 2020 2023 2074 6f72 6368 2e6a 6974 2e5f     # torch.jit._
-000124c0: 7472 6163 652e 5f74 7261 6365 5f6d 6f64  trace._trace_mod
-000124d0: 756c 655f 6d61 7020 6973 206e 6f74 204f  ule_map is not O
-000124e0: 7074 696f 6e61 6c20 616e 6420 6861 7320  ptional and has 
-000124f0: 7479 7065 2044 6963 745b 416e 792c 2041  type Dict[Any, A
-00012500: 6e79 5d0d 0a20 2020 2020 2020 2020 2020  ny]..           
-00012510: 206e 616d 6520 3d20 746f 7263 682e 6a69   name = torch.ji
-00012520: 742e 5f74 7261 6365 2e5f 7472 6163 655f  t._trace._trace_
-00012530: 6d6f 6475 6c65 5f6d 6170 5b0d 0a20 2020  module_map[..   
-00012540: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012550: 665d 2069 6620 7365 6c66 2069 6e20 746f  f] if self in to
-00012560: 7263 682e 6a69 742e 5f74 7261 6365 2e5f  rch.jit._trace._
-00012570: 7472 6163 655f 6d6f 6475 6c65 5f6d 6170  trace_module_map
-00012580: 2065 6c73 6520 4e6f 6e65 2020 2320 7479   else None  # ty
-00012590: 7065 3a20 6967 6e6f 7265 5b69 6e64 6578  pe: ignore[index
-000125a0: 2c20 6f70 6572 6174 6f72 5d20 2320 6e6f  , operator] # no
-000125b0: 7161 3a20 4239 3530 0d0a 2020 2020 2020  qa: B950..      
-000125c0: 2020 2020 2020 6966 206e 616d 653a 0d0a        if name:..
-000125d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125e0: 7472 6163 696e 675f 7374 6174 652e 7075  tracing_state.pu
-000125f0: 7368 5f73 636f 7065 286e 616d 6529 0d0a  sh_scope(name)..
-00012600: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00012610: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00012620: 2020 2072 6563 6f72 6469 6e67 5f73 636f     recording_sco
-00012630: 7065 7320 3d20 4661 6c73 650d 0a20 2020  pes = False..   
-00012640: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00012650: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00012660: 7365 6c66 2e66 6f72 7761 7264 282a 696e  self.forward(*in
-00012670: 7075 742c 202a 2a6b 7761 7267 7329 0d0a  put, **kwargs)..
-00012680: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
-00012690: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000126a0: 2072 6563 6f72 6469 6e67 5f73 636f 7065   recording_scope
-000126b0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000126c0: 2020 2020 7472 6163 696e 675f 7374 6174      tracing_stat
-000126d0: 652e 706f 705f 7363 6f70 6528 290d 0a20  e.pop_scope().. 
-000126e0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000126f0: 7375 6c74 0d0a 0d0a 2020 2020 6465 6620  sult....    def 
-00012700: 5f63 616c 6c5f 696d 706c 2873 656c 662c  _call_impl(self,
-00012710: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00012720: 293a 0d0a 2020 2020 2020 2020 666f 7277  ):..        forw
-00012730: 6172 645f 6361 6c6c 203d 2028 7365 6c66  ard_call = (self
-00012740: 2e5f 736c 6f77 5f66 6f72 7761 7264 2069  ._slow_forward i
-00012750: 6620 746f 7263 682e 5f43 2e5f 6765 745f  f torch._C._get_
-00012760: 7472 6163 696e 675f 7374 6174 6528 2920  tracing_state() 
-00012770: 656c 7365 2073 656c 662e 666f 7277 6172  else self.forwar
-00012780: 6429 0d0a 0d0a 2020 2020 2020 2020 6973  d)....        is
-00012790: 5f61 6c6c 5f6e 756d 7079 203d 2046 616c  _all_numpy = Fal
-000127a0: 7365 0d0a 2020 2020 2020 2020 6973 5f62  se..        is_b
-000127b0: 7569 6c74 203d 2073 656c 662e 5f62 7569  uilt = self._bui
-000127c0: 6c74 0d0a 0d0a 2020 2020 2020 2020 2320  lt....        # 
-000127d0: 6f6e 6c79 2064 6f20 696e 2074 6865 2072  only do in the r
-000127e0: 6f6f 740d 0a20 2020 2020 2020 2069 6620  oot..        if 
-000127f0: 7365 6c66 2e69 735f 726f 6f74 3a0d 0a0d  self.is_root:...
-00012800: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00012810: 6973 696e 7374 616e 6365 2861 7267 732c  isinstance(args,
-00012820: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
-00012830: 2020 2020 2020 2020 2020 6973 5f61 6c6c            is_all
-00012840: 5f6e 756d 7079 203d 2061 6c6c 285b 6973  _numpy = all([is
-00012850: 696e 7374 616e 6365 2869 6e70 2c20 6e70  instance(inp, np
-00012860: 2e6e 6461 7272 6179 2920 666f 7220 696e  .ndarray) for in
-00012870: 7020 696e 2061 7267 735d 290d 0a20 2020  p in args])..   
-00012880: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-00012890: 7320 3d20 7475 706c 6528 5b74 6f5f 7465  s = tuple([to_te
-000128a0: 6e73 6f72 2869 6e70 2c20 6465 7669 6365  nsor(inp, device
-000128b0: 3d67 6574 5f64 6576 6963 6528 2929 2066  =get_device()) f
-000128c0: 6f72 2069 6e70 2069 6e20 6172 6773 5d29  or inp in args])
-000128d0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000128e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000128f0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00012900: 6365 2861 7267 732c 206e 702e 6e64 6172  ce(args, np.ndar
-00012910: 7261 7929 3a0d 0a20 2020 2020 2020 2020  ray):..         
-00012920: 2020 2020 2020 2020 2020 2069 735f 616c             is_al
-00012930: 6c5f 6e75 6d70 7920 3d20 5472 7565 0d0a  l_numpy = True..
-00012940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012950: 6172 6773 203d 2074 6f5f 7465 6e73 6f72  args = to_tensor
-00012960: 2861 7267 732c 2064 6576 6963 653d 6765  (args, device=ge
-00012970: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
-00012980: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-00012990: 7320 3d20 2861 7267 732c 290d 0a0d 0a20  s = (args,).... 
-000129a0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-000129b0: 6c66 2e5f 6275 696c 743a 0d0a 2020 2020  lf._built:..    
-000129c0: 2020 2020 2020 2020 696e 7020 3d20 756e          inp = un
-000129d0: 7061 636b 5f73 696e 676c 6574 6f6e 2861  pack_singleton(a
-000129e0: 7267 7329 0d0a 2020 2020 2020 2020 2020  rgs)..          
-000129f0: 2020 6966 2069 735f 7465 6e73 6f72 2869    if is_tensor(i
-00012a00: 6e70 293a 0d0a 2020 2020 2020 2020 2020  np):..          
-00012a10: 2020 2020 2020 7368 7020 3d20 7465 6e73        shp = tens
-00012a20: 6f72 5f74 6f5f 7368 6170 6528 696e 702c  or_to_shape(inp,
-00012a30: 206e 6565 645f 6578 636c 7564 655f 6261   need_exclude_ba
-00012a40: 7463 685f 6178 6973 3d54 7275 6529 0d0a  tch_axis=True)..
-00012a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a60: 7365 6c66 2e69 6e70 7574 5f73 6861 7065  self.input_shape
-00012a70: 203d 2073 6870 0d0a 0d0a 2020 2020 2020   = shp....      
-00012a80: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00012a90: 662e 6973 5f72 6f6f 743a 0d0a 2020 2020  f.is_root:..    
-00012aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ab0: 6966 2073 656c 662e 5f73 6967 6e61 7475  if self._signatu
-00012ac0: 7265 2069 7320 4e6f 6e65 3a0d 0a20 2020  re is None:..   
-00012ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ae0: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
-00012af0: 7475 7265 203d 2067 6574 5f73 6967 6e61  ture = get_signa
-00012b00: 7475 7265 2873 656c 6629 0d0a 2020 2020  ture(self)..    
-00012b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b20: 6966 2073 656c 662e 5f73 6967 6e61 7475  if self._signatu
-00012b30: 7265 2069 7320 6e6f 7420 4e6f 6e65 2061  re is not None a
-00012b40: 6e64 206c 656e 2873 656c 662e 5f73 6967  nd len(self._sig
-00012b50: 6e61 7475 7265 2e69 6e70 7574 7329 203e  nature.inputs) >
-00012b60: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00012b70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012b80: 662e 5f73 6967 6e61 7475 7265 2e69 6e70  f._signature.inp
-00012b90: 7574 735b 7365 6c66 2e5f 7369 676e 6174  uts[self._signat
-00012ba0: 7572 652e 696e 7075 7473 2e6b 6579 5f6c  ure.inputs.key_l
-00012bb0: 6973 745b 305d 5d2e 7368 6170 6520 3d20  ist[0]].shape = 
-00012bc0: 7465 6e73 6f72 5f74 6f5f 7368 6170 6528  tensor_to_shape(
-00012bd0: 696e 702c 0d0a 2020 2020 2020 2020 2020  inp,..          
-00012be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012270: 2020 2020 2020 2020 276f 7574 7075 7427          'output'
+00012280: 3a20 7b30 3a20 2762 6174 6368 5f73 697a  : {0: 'batch_siz
+00012290: 6527 7d7d 290d 0a20 2020 2020 2020 2073  e'}})..        s
+000122a0: 656c 662e 7472 6169 6e28 290d 0a20 2020  elf.train()..   
+000122b0: 2020 2020 2073 6875 7469 6c2e 636f 7079       shutil.copy
+000122c0: 2873 6176 655f 7061 7468 2c20 7361 7665  (save_path, save
+000122d0: 5f70 6174 682e 7265 706c 6163 6528 272e  _path.replace('.
+000122e0: 6f6e 6e78 5f27 2c20 272e 6f6e 6e78 2729  onnx_', '.onnx')
+000122f0: 290d 0a20 2020 2020 2020 206f 732e 7265  )..        os.re
+00012300: 6d6f 7665 2873 6176 655f 7061 7468 290d  move(save_path).
+00012310: 0a0d 0a20 2020 2064 6566 205f 736c 6f77  ...    def _slow
+00012320: 5f66 6f72 7761 7264 2873 656c 662c 202a  _forward(self, *
+00012330: 696e 7075 742c 202a 2a6b 7761 7267 7329  input, **kwargs)
+00012340: 3a0d 0a20 2020 2020 2020 2074 7261 6369  :..        traci
+00012350: 6e67 5f73 7461 7465 203d 2074 6f72 6368  ng_state = torch
+00012360: 2e5f 432e 5f67 6574 5f74 7261 6369 6e67  ._C._get_tracing
+00012370: 5f73 7461 7465 2829 0d0a 2020 2020 2020  _state()..      
+00012380: 2020 6966 206e 6f74 2074 7261 6369 6e67    if not tracing
+00012390: 5f73 7461 7465 206f 7220 6973 696e 7374  _state or isinst
+000123a0: 616e 6365 2873 656c 662e 666f 7277 6172  ance(self.forwar
+000123b0: 642c 2074 6f72 6368 2e5f 432e 5363 7269  d, torch._C.Scri
+000123c0: 7074 4d65 7468 6f64 293a 0d0a 2020 2020  ptMethod):..    
+000123d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000123e0: 656c 662e 666f 7277 6172 6428 2a69 6e70  elf.forward(*inp
+000123f0: 7574 2c20 2a2a 6b77 6172 6773 290d 0a20  ut, **kwargs).. 
+00012400: 2020 2020 2020 2072 6563 6f72 6469 6e67         recording
+00012410: 5f73 636f 7065 7320 3d20 746f 7263 682e  _scopes = torch.
+00012420: 6a69 742e 5f74 7261 6365 2e5f 7472 6163  jit._trace._trac
+00012430: 655f 6d6f 6475 6c65 5f6d 6170 2069 7320  e_module_map is 
+00012440: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+00012450: 2020 6966 2072 6563 6f72 6469 6e67 5f73    if recording_s
+00012460: 636f 7065 733a 0d0a 2020 2020 2020 2020  copes:..        
+00012470: 2020 2020 2320 7479 7065 2069 676e 6f72      # type ignor
+00012480: 6520 7761 7320 6164 6465 6420 6265 6361  e was added beca
+00012490: 7573 6520 6174 2074 6869 7320 706f 696e  use at this poin
+000124a0: 7420 6f6e 6520 6b6e 6f77 7320 7468 6174  t one knows that
+000124b0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000124c0: 746f 7263 682e 6a69 742e 5f74 7261 6365  torch.jit._trace
+000124d0: 2e5f 7472 6163 655f 6d6f 6475 6c65 5f6d  ._trace_module_m
+000124e0: 6170 2069 7320 6e6f 7420 4f70 7469 6f6e  ap is not Option
+000124f0: 616c 2061 6e64 2068 6173 2074 7970 6520  al and has type 
+00012500: 4469 6374 5b41 6e79 2c20 416e 795d 0d0a  Dict[Any, Any]..
+00012510: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00012520: 203d 2074 6f72 6368 2e6a 6974 2e5f 7472   = torch.jit._tr
+00012530: 6163 652e 5f74 7261 6365 5f6d 6f64 756c  ace._trace_modul
+00012540: 655f 6d61 705b 0d0a 2020 2020 2020 2020  e_map[..        
+00012550: 2020 2020 2020 2020 7365 6c66 5d20 6966          self] if
+00012560: 2073 656c 6620 696e 2074 6f72 6368 2e6a   self in torch.j
+00012570: 6974 2e5f 7472 6163 652e 5f74 7261 6365  it._trace._trace
+00012580: 5f6d 6f64 756c 655f 6d61 7020 656c 7365  _module_map else
+00012590: 204e 6f6e 6520 2023 2074 7970 653a 2069   None  # type: i
+000125a0: 676e 6f72 655b 696e 6465 782c 206f 7065  gnore[index, ope
+000125b0: 7261 746f 725d 2023 206e 6f71 613a 2042  rator] # noqa: B
+000125c0: 3935 300d 0a20 2020 2020 2020 2020 2020  950..           
+000125d0: 2069 6620 6e61 6d65 3a0d 0a20 2020 2020   if name:..     
+000125e0: 2020 2020 2020 2020 2020 2074 7261 6369             traci
+000125f0: 6e67 5f73 7461 7465 2e70 7573 685f 7363  ng_state.push_sc
+00012600: 6f70 6528 6e61 6d65 290d 0a20 2020 2020  ope(name)..     
+00012610: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00012620: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00012630: 636f 7264 696e 675f 7363 6f70 6573 203d  cording_scopes =
+00012640: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00012650: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00012660: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+00012670: 666f 7277 6172 6428 2a69 6e70 7574 2c20  forward(*input, 
+00012680: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00012690: 2020 2066 696e 616c 6c79 3a0d 0a20 2020     finally:..   
+000126a0: 2020 2020 2020 2020 2069 6620 7265 636f           if reco
+000126b0: 7264 696e 675f 7363 6f70 6573 3a0d 0a20  rding_scopes:.. 
+000126c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000126d0: 7261 6369 6e67 5f73 7461 7465 2e70 6f70  racing_state.pop
+000126e0: 5f73 636f 7065 2829 0d0a 2020 2020 2020  _scope()..      
+000126f0: 2020 7265 7475 726e 2072 6573 756c 740d    return result.
+00012700: 0a0d 0a20 2020 2064 6566 205f 6361 6c6c  ...    def _call
+00012710: 5f69 6d70 6c28 7365 6c66 2c20 2a61 7267  _impl(self, *arg
+00012720: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
+00012730: 2020 2020 2020 2066 6f72 7761 7264 5f63         forward_c
+00012740: 616c 6c20 3d20 2873 656c 662e 5f73 6c6f  all = (self._slo
+00012750: 775f 666f 7277 6172 6420 6966 2074 6f72  w_forward if tor
+00012760: 6368 2e5f 432e 5f67 6574 5f74 7261 6369  ch._C._get_traci
+00012770: 6e67 5f73 7461 7465 2829 2065 6c73 6520  ng_state() else 
+00012780: 7365 6c66 2e66 6f72 7761 7264 290d 0a0d  self.forward)...
+00012790: 0a20 2020 2020 2020 2069 735f 616c 6c5f  .        is_all_
+000127a0: 6e75 6d70 7920 3d20 4661 6c73 650d 0a20  numpy = False.. 
+000127b0: 2020 2020 2020 2069 735f 6275 696c 7420         is_built 
+000127c0: 3d20 7365 6c66 2e5f 6275 696c 740d 0a0d  = self._built...
+000127d0: 0a20 2020 2020 2020 2023 206f 6e6c 7920  .        # only 
+000127e0: 646f 2069 6e20 7468 6520 726f 6f74 0d0a  do in the root..
+000127f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00012800: 6973 5f72 6f6f 743a 0d0a 0d0a 2020 2020  is_root:....    
+00012810: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00012820: 7461 6e63 6528 6172 6773 2c20 7475 706c  tance(args, tupl
+00012830: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+00012840: 2020 2020 2069 735f 616c 6c5f 6e75 6d70       is_all_nump
+00012850: 7920 3d20 616c 6c28 5b69 7369 6e73 7461  y = all([isinsta
+00012860: 6e63 6528 696e 702c 206e 702e 6e64 6172  nce(inp, np.ndar
+00012870: 7261 7929 2066 6f72 2069 6e70 2069 6e20  ray) for inp in 
+00012880: 6172 6773 5d29 0d0a 2020 2020 2020 2020  args])..        
+00012890: 2020 2020 2020 2020 6172 6773 203d 2074          args = t
+000128a0: 7570 6c65 285b 746f 5f74 656e 736f 7228  uple([to_tensor(
+000128b0: 696e 702c 2064 6576 6963 653d 6765 745f  inp, device=get_
+000128c0: 6465 7669 6365 2829 2920 666f 7220 696e  device()) for in
+000128d0: 7020 696e 2061 7267 735d 290d 0a20 2020  p in args])..   
+000128e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012900: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
+00012910: 6773 2c20 6e70 2e6e 6461 7272 6179 293a  gs, np.ndarray):
+00012920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012930: 2020 2020 2020 6973 5f61 6c6c 5f6e 756d        is_all_num
+00012940: 7079 203d 2054 7275 650d 0a20 2020 2020  py = True..     
+00012950: 2020 2020 2020 2020 2020 2061 7267 7320             args 
+00012960: 3d20 746f 5f74 656e 736f 7228 6172 6773  = to_tensor(args
+00012970: 2c20 6465 7669 6365 3d67 6574 5f64 6576  , device=get_dev
+00012980: 6963 6528 2929 0d0a 2020 2020 2020 2020  ice())..        
+00012990: 2020 2020 2020 2020 6172 6773 203d 2028          args = (
+000129a0: 6172 6773 2c29 0d0a 0d0a 2020 2020 2020  args,)....      
+000129b0: 2020 6966 206e 6f74 2073 656c 662e 5f62    if not self._b
+000129c0: 7569 6c74 3a0d 0a20 2020 2020 2020 2020  uilt:..         
+000129d0: 2020 2069 6e70 203d 2075 6e70 6163 6b5f     inp = unpack_
+000129e0: 7369 6e67 6c65 746f 6e28 6172 6773 290d  singleton(args).
+000129f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012a00: 6973 5f74 656e 736f 7228 696e 7029 3a0d  is_tensor(inp):.
+00012a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012a20: 2073 6870 203d 2074 656e 736f 725f 746f   shp = tensor_to
+00012a30: 5f73 6861 7065 2869 6e70 2c20 6e65 6564  _shape(inp, need
+00012a40: 5f65 7863 6c75 6465 5f62 6174 6368 5f61  _exclude_batch_a
+00012a50: 7869 733d 5472 7565 290d 0a20 2020 2020  xis=True)..     
+00012a60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012a70: 696e 7075 745f 7368 6170 6520 3d20 7368  input_shape = sh
+00012a80: 700d 0a0d 0a20 2020 2020 2020 2020 2020  p....           
+00012a90: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+00012aa0: 726f 6f74 3a0d 0a20 2020 2020 2020 2020  root:..         
+00012ab0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00012ac0: 6c66 2e5f 7369 676e 6174 7572 6520 6973  lf._signature is
+00012ad0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012af0: 7365 6c66 2e5f 7369 676e 6174 7572 6520  self._signature 
+00012b00: 3d20 6765 745f 7369 676e 6174 7572 6528  = get_signature(
+00012b10: 7365 6c66 290d 0a20 2020 2020 2020 2020  self)..         
+00012b20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00012b30: 6c66 2e5f 7369 676e 6174 7572 6520 6973  lf._signature is
+00012b40: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
+00012b50: 6e28 7365 6c66 2e5f 7369 676e 6174 7572  n(self._signatur
+00012b60: 652e 696e 7075 7473 2920 3e20 303a 0d0a  e.inputs) > 0:..
+00012b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b80: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
+00012b90: 676e 6174 7572 652e 696e 7075 7473 5b73  gnature.inputs[s
+00012ba0: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
+00012bb0: 6e70 7574 732e 6b65 795f 6c69 7374 5b30  nputs.key_list[0
+00012bc0: 5d5d 2e73 6861 7065 203d 2074 656e 736f  ]].shape = tenso
+00012bd0: 725f 746f 5f73 6861 7065 2869 6e70 2c0d  r_to_shape(inp,.
+00012be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00012bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c40: 206e 6565 645f 6578 636c 7564 655f 6261   need_exclude_ba
-00012c50: 7463 685f 6178 6973 3d54 7275 652c 0d0a  tch_axis=True,..
-00012c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c40: 2020 2020 2020 2020 2020 2020 6e65 6564              need
+00012c50: 5f65 7863 6c75 6465 5f62 6174 6368 5f61  _exclude_batch_a
+00012c60: 7869 733d 5472 7565 2c0d 0a20 2020 2020  xis=True,..     
 00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cc0: 2020 2020 2020 2020 2020 2069 735f 7369             is_si
-00012cd0: 6e67 6c65 746f 6e3d 4661 6c73 6529 0d0a  ngleton=False)..
-00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cf0: 6465 6c20 696e 700d 0a20 2020 2020 2020  del inp..       
-00012d00: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00012d10: 616e 6365 2869 6e70 2c20 2874 7570 6c65  ance(inp, (tuple
-00012d20: 2c20 6c69 7374 2929 3a0d 0a20 2020 2020  , list)):..     
-00012d30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00012d40: 696e 7374 616e 6365 2869 6e70 5b30 5d2c  instance(inp[0],
-00012d50: 206e 756d 6265 7273 2e4e 756d 6265 7229   numbers.Number)
-00012d60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00012d70: 2020 2020 2020 2073 656c 662e 696e 7075         self.inpu
-00012d80: 745f 7368 6170 6520 3d20 5465 6e73 6f72  t_shape = Tensor
-00012d90: 5368 6170 6528 6c69 7374 2869 6e70 2929  Shape(list(inp))
-00012da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012db0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00012dc0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00012dd0: 203d 2073 656c 662e 666f 7277 6172 6428   = self.forward(
-00012de0: 2a69 6e70 2c20 2a2a 6b77 6172 6773 290d  *inp, **kwargs).
-00012df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012e00: 2020 2020 2023 2073 6870 203d 5b20 7465       # shp =[ te
-00012e10: 6e73 6f72 5f74 6f5f 7368 6170 6528 692c  nsor_to_shape(i,
-00012e20: 206e 6565 645f 6578 636c 7564 655f 6261   need_exclude_ba
-00012e30: 7463 685f 6178 6973 3d54 7275 652c 6973  tch_axis=True,is
-00012e40: 5f73 696e 676c 6574 6f6e 3d46 616c 7365  _singleton=False
-00012e50: 2920 666f 7220 6920 696e 2069 6e70 5d0d  ) for i in inp].
-00012e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012e70: 2020 2020 2023 2073 656c 662e 6275 696c       # self.buil
-00012e80: 6428 2a73 6870 290d 0a20 2020 2020 2020  d(*shp)..       
-00012e90: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00012ea0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012eb0: 2e69 6e70 7574 5f73 6861 7065 203d 2054  .input_shape = T
-00012ec0: 656e 736f 7253 6861 7065 286c 6973 7428  ensorShape(list(
-00012ed0: 696e 7029 290d 0a20 2020 2020 2020 2020  inp))..         
-00012ee0: 2020 2020 2020 2070 7269 6e74 2827 696e         print('in
-00012ef0: 7075 7420 7368 6f75 2062 6520 7465 6e73  put shou be tens
-00012f00: 6f72 206f 7220 7475 706c 6520 6f66 2074  or or tuple of t
-00012f10: 656e 736f 7227 290d 0a0d 0a20 2020 2020  ensor')....     
-00012f20: 2020 2020 2020 2073 656c 662e 5f62 7569         self._bui
-00012f30: 6c74 203d 2054 7275 650d 0a0d 0a0d 0a20  lt = True...... 
-00012f40: 2020 2020 2020 2069 6620 6e6f 7420 2873         if not (s
-00012f50: 656c 662e 5f62 6163 6b77 6172 645f 686f  elf._backward_ho
-00012f60: 6f6b 7320 6f72 2073 656c 662e 5f62 6163  oks or self._bac
-00012f70: 6b77 6172 645f 7072 655f 686f 6f6b 7320  kward_pre_hooks 
-00012f80: 6f72 2073 656c 662e 5f66 6f72 7761 7264  or self._forward
-00012f90: 5f68 6f6f 6b73 206f 7220 7365 6c66 2e5f  _hooks or self._
-00012fa0: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
-00012fb0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00012fc0: 2020 206f 7220 5f67 6c6f 6261 6c5f 6261     or _global_ba
-00012fd0: 636b 7761 7264 5f70 7265 5f68 6f6f 6b73  ckward_pre_hooks
-00012fe0: 206f 7220 5f67 6c6f 6261 6c5f 6261 636b   or _global_back
-00012ff0: 7761 7264 5f68 6f6f 6b73 0d0a 2020 2020  ward_hooks..    
-00013000: 2020 2020 2020 2020 2020 2020 6f72 205f              or _
-00013010: 676c 6f62 616c 5f66 6f72 7761 7264 5f68  global_forward_h
-00013020: 6f6f 6b73 206f 7220 5f67 6c6f 6261 6c5f  ooks or _global_
-00013030: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
-00013040: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-00013050: 2072 6573 756c 7420 3d20 666f 7277 6172   result = forwar
-00013060: 645f 6361 6c6c 282a 6172 6773 2c20 2a2a  d_call(*args, **
-00013070: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-00013080: 2020 2020 2072 6573 756c 7420 3d20 756e       result = un
-00013090: 7061 636b 5f73 696e 676c 6574 6f6e 2872  pack_singleton(r
-000130a0: 6573 756c 7429 0d0a 0d0a 2020 2020 2020  esult)....      
-000130b0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-000130c0: 2873 656c 662c 2027 6b65 6570 5f6f 7574  (self, 'keep_out
-000130d0: 7075 7427 2920 616e 6420 7365 6c66 2e6b  put') and self.k
-000130e0: 6565 705f 6f75 7470 7574 203d 3d20 5472  eep_output == Tr
-000130f0: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
-00013100: 2020 2020 2023 206d 616b 6520 6120 6f70       # make a op
-00013110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013120: 2020 7365 6c66 2e5f 6f75 7470 7574 5f74    self._output_t
-00013130: 656e 736f 7220 3d20 7265 7375 6c74 0d0a  ensor = result..
-00013140: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00013150: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
-00013160: 6520 6973 204e 6f6e 6520 6f72 2069 735f  e is None or is_
-00013170: 6275 696c 7420 3d3d 2046 616c 7365 3a0d  built == False:.
-00013180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013190: 206f 7574 7075 7420 3d20 7265 7375 6c74   output = result
-000131a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000131b0: 2020 6966 2069 735f 7465 6e73 6f72 286f    if is_tensor(o
-000131c0: 7574 7075 7429 3a20 2023 206f 6e65 206f  utput):  # one o
-000131d0: 7574 7075 740d 0a20 2020 2020 2020 2020  utput..         
-000131e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000131f0: 5f6f 7574 7075 745f 7368 6170 6520 3d20  _output_shape = 
-00013200: 7465 6e73 6f72 5f74 6f5f 7368 6170 6528  tensor_to_shape(
-00013210: 6f75 7470 7574 290d 0a20 2020 2020 2020  output)..       
-00013220: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-00013230: 696e 7374 616e 6365 286f 7574 7075 742c  instance(output,
-00013240: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
-00013250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013260: 2020 2020 2020 6f75 7470 7574 5f73 6861        output_sha
-00013270: 7065 203d 2074 7570 6c65 285b 7465 6e73  pe = tuple([tens
-00013280: 6f72 5f74 6f5f 7368 6170 6528 6974 656d  or_to_shape(item
-00013290: 2920 666f 7220 6974 656d 2069 6e20 6f75  ) for item in ou
-000132a0: 7470 7574 2069 660d 0a20 2020 2020 2020  tput if..       
-000132b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cd0: 2020 2020 2020 6973 5f73 696e 676c 6574        is_singlet
+00012ce0: 6f6e 3d46 616c 7365 290d 0a20 2020 2020  on=False)..     
+00012cf0: 2020 2020 2020 2020 2020 2064 656c 2069             del i
+00012d00: 6e70 0d0a 2020 2020 2020 2020 2020 2020  np..            
+00012d10: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00012d20: 696e 702c 2028 7475 706c 652c 206c 6973  inp, (tuple, lis
+00012d30: 7429 293a 0d0a 2020 2020 2020 2020 2020  t)):..          
+00012d40: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00012d50: 6e63 6528 696e 705b 305d 2c20 6e75 6d62  nce(inp[0], numb
+00012d60: 6572 732e 4e75 6d62 6572 293a 0d0a 2020  ers.Number):..  
+00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d80: 2020 7365 6c66 2e69 6e70 7574 5f73 6861    self.input_sha
+00012d90: 7065 203d 2054 656e 736f 7253 6861 7065  pe = TensorShape
+00012da0: 286c 6973 7428 696e 7029 290d 0a20 2020  (list(inp))..   
+00012db0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00012dc0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00012dd0: 2020 2020 2020 2020 6f75 7420 3d20 7365          out = se
+00012de0: 6c66 2e66 6f72 7761 7264 282a 696e 702c  lf.forward(*inp,
+00012df0: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
+00012e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e10: 2320 7368 7020 3d5b 2074 656e 736f 725f  # shp =[ tensor_
+00012e20: 746f 5f73 6861 7065 2869 2c20 6e65 6564  to_shape(i, need
+00012e30: 5f65 7863 6c75 6465 5f62 6174 6368 5f61  _exclude_batch_a
+00012e40: 7869 733d 5472 7565 2c69 735f 7369 6e67  xis=True,is_sing
+00012e50: 6c65 746f 6e3d 4661 6c73 6529 2066 6f72  leton=False) for
+00012e60: 2069 2069 6e20 696e 705d 0d0a 2020 2020   i in inp]..    
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e80: 2320 7365 6c66 2e62 7569 6c64 282a 7368  # self.build(*sh
+00012e90: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
+00012ea0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00012eb0: 2020 2020 2020 2073 656c 662e 696e 7075         self.inpu
+00012ec0: 745f 7368 6170 6520 3d20 5465 6e73 6f72  t_shape = Tensor
+00012ed0: 5368 6170 6528 6c69 7374 2869 6e70 2929  Shape(list(inp))
+00012ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012ef0: 2020 7072 696e 7428 2769 6e70 7574 2073    print('input s
+00012f00: 686f 7520 6265 2074 656e 736f 7220 6f72  hou be tensor or
+00012f10: 2074 7570 6c65 206f 6620 7465 6e73 6f72   tuple of tensor
+00012f20: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
+00012f30: 2020 7365 6c66 2e5f 6275 696c 7420 3d20    self._built = 
+00012f40: 5472 7565 0d0a 0d0a 0d0a 2020 2020 2020  True......      
+00012f50: 2020 6966 206e 6f74 2028 7365 6c66 2e5f    if not (self._
+00012f60: 6261 636b 7761 7264 5f68 6f6f 6b73 206f  backward_hooks o
+00012f70: 7220 7365 6c66 2e5f 6261 636b 7761 7264  r self._backward
+00012f80: 5f70 7265 5f68 6f6f 6b73 206f 7220 7365  _pre_hooks or se
+00012f90: 6c66 2e5f 666f 7277 6172 645f 686f 6f6b  lf._forward_hook
+00012fa0: 7320 6f72 2073 656c 662e 5f66 6f72 7761  s or self._forwa
+00012fb0: 7264 5f70 7265 5f68 6f6f 6b73 0d0a 2020  rd_pre_hooks..  
+00012fc0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00012fd0: 205f 676c 6f62 616c 5f62 6163 6b77 6172   _global_backwar
+00012fe0: 645f 7072 655f 686f 6f6b 7320 6f72 205f  d_pre_hooks or _
+00012ff0: 676c 6f62 616c 5f62 6163 6b77 6172 645f  global_backward_
+00013000: 686f 6f6b 730d 0a20 2020 2020 2020 2020  hooks..         
+00013010: 2020 2020 2020 206f 7220 5f67 6c6f 6261         or _globa
+00013020: 6c5f 666f 7277 6172 645f 686f 6f6b 7320  l_forward_hooks 
+00013030: 6f72 205f 676c 6f62 616c 5f66 6f72 7761  or _global_forwa
+00013040: 7264 5f70 7265 5f68 6f6f 6b73 293a 0d0a  rd_pre_hooks):..
+00013050: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00013060: 6c74 203d 2066 6f72 7761 7264 5f63 616c  lt = forward_cal
+00013070: 6c28 2a61 7267 732c 202a 2a6b 7761 7267  l(*args, **kwarg
+00013080: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00013090: 7265 7375 6c74 203d 2075 6e70 6163 6b5f  result = unpack_
+000130a0: 7369 6e67 6c65 746f 6e28 7265 7375 6c74  singleton(result
+000130b0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+000130c0: 2069 6620 6861 7361 7474 7228 7365 6c66   if hasattr(self
+000130d0: 2c20 276b 6565 705f 6f75 7470 7574 2729  , 'keep_output')
+000130e0: 2061 6e64 2073 656c 662e 6b65 6570 5f6f   and self.keep_o
+000130f0: 7574 7075 7420 3d3d 2054 7275 653a 0d0a  utput == True:..
+00013100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013110: 2320 6d61 6b65 2061 206f 700d 0a20 2020  # make a op..   
+00013120: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013130: 662e 5f6f 7574 7075 745f 7465 6e73 6f72  f._output_tensor
+00013140: 203d 2072 6573 756c 740d 0a20 2020 2020   = result..     
+00013150: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00013160: 6f75 7470 7574 5f73 6861 7065 2069 7320  output_shape is 
+00013170: 4e6f 6e65 206f 7220 6973 5f62 7569 6c74  None or is_built
+00013180: 203d 3d20 4661 6c73 653a 0d0a 2020 2020   == False:..    
+00013190: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+000131a0: 7574 203d 2072 6573 756c 740d 0a20 2020  ut = result..   
+000131b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000131c0: 6973 5f74 656e 736f 7228 6f75 7470 7574  is_tensor(output
+000131d0: 293a 2020 2320 6f6e 6520 6f75 7470 7574  ):  # one output
+000131e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000131f0: 2020 2020 2020 7365 6c66 2e5f 6f75 7470        self._outp
+00013200: 7574 5f73 6861 7065 203d 2074 656e 736f  ut_shape = tenso
+00013210: 725f 746f 5f73 6861 7065 286f 7574 7075  r_to_shape(outpu
+00013220: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00013230: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00013240: 6e63 6528 6f75 7470 7574 2c20 286c 6973  nce(output, (lis
+00013250: 742c 2074 7570 6c65 2929 3a0d 0a20 2020  t, tuple)):..   
+00013260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013270: 206f 7574 7075 745f 7368 6170 6520 3d20   output_shape = 
+00013280: 7475 706c 6528 5b74 656e 736f 725f 746f  tuple([tensor_to
+00013290: 5f73 6861 7065 2869 7465 6d29 2066 6f72  _shape(item) for
+000132a0: 2069 7465 6d20 696e 206f 7574 7075 7420   item in output 
+000132b0: 6966 0d0a 2020 2020 2020 2020 2020 2020  if..            
 000132c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132d0: 2020 2069 7465 6d20 6973 206e 6f74 204e     item is not N
-000132e0: 6f6e 6520 616e 6420 6e6f 7420 6973 696e  one and not isin
-000132f0: 7374 616e 6365 2869 7465 6d2c 2028 6c69  stance(item, (li
-00013300: 7374 2c20 7475 706c 6529 295d 290d 0a20  st, tuple))]).. 
-00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013320: 2020 2023 2069 6620 6e6f 7420 6973 696e     # if not isin
-00013330: 7374 616e 6365 2869 7465 6d2c 2028 6c69  stance(item, (li
-00013340: 7374 2c74 7570 6c65 2929 206c 7374 6d0d  st,tuple)) lstm.
-00013350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013360: 2020 2020 2073 656c 662e 5f6f 7574 7075       self._outpu
-00013370: 745f 7368 6170 6520 3d20 756e 7061 636b  t_shape = unpack
-00013380: 5f73 696e 676c 6574 6f6e 286f 7574 7075  _singleton(outpu
-00013390: 745f 7368 6170 6529 0d0a 2020 2020 2020  t_shape)..      
-000133a0: 2020 2020 2020 6966 2069 735f 616c 6c5f        if is_all_
-000133b0: 6e75 6d70 7920 3d3d 2054 7275 6520 616e  numpy == True an
-000133c0: 6420 7365 6c66 2e74 7261 696e 696e 6720  d self.training 
-000133d0: 3d3d 2046 616c 7365 2061 6e64 2073 656c  == False and sel
-000133e0: 662e 6973 5f72 6f6f 7420 3d3d 2054 7275  f.is_root == Tru
-000133f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00013400: 2020 2020 6966 2069 735f 7465 6e73 6f72      if is_tensor
-00013410: 2872 6573 756c 7429 3a0d 0a20 2020 2020  (result):..     
-00013420: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00013430: 6574 7572 6e20 746f 5f6e 756d 7079 2872  eturn to_numpy(r
-00013440: 6573 756c 7429 0d0a 2020 2020 2020 2020  esult)..        
-00013450: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00013460: 6e73 7461 6e63 6528 7265 7375 6c74 2c20  nstance(result, 
-00013470: 286c 6973 742c 2074 7570 6c65 2929 3a0d  (list, tuple)):.
-00013480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013490: 2020 2020 2072 6573 756c 7420 3d20 6c69       result = li
-000134a0: 7374 2872 6573 756c 7429 0d0a 2020 2020  st(result)..    
-000134b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134c0: 7265 7475 726e 2074 7570 6c65 285b 746f  return tuple([to
-000134d0: 5f6e 756d 7079 2872 6573 2920 6966 2069  _numpy(res) if i
-000134e0: 735f 7465 6e73 6f72 2872 6573 2920 656c  s_tensor(res) el
-000134f0: 7365 2072 6573 2066 6f72 2072 6573 2069  se res for res i
-00013500: 6e20 7265 7375 6c74 5d29 0d0a 2020 2020  n result])..    
-00013510: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00013520: 6573 756c 740d 0a0d 0a20 2020 2020 2020  esult....       
-00013530: 2023 2044 6f20 6e6f 7420 6361 6c6c 2066   # Do not call f
-00013540: 756e 6374 696f 6e73 2077 6865 6e20 6a69  unctions when ji
-00013550: 7420 6973 2075 7365 640d 0a20 2020 2020  t is used..     
-00013560: 2020 2066 756c 6c5f 6261 636b 7761 7264     full_backward
-00013570: 5f68 6f6f 6b73 2c20 6e6f 6e5f 6675 6c6c  _hooks, non_full
-00013580: 5f62 6163 6b77 6172 645f 686f 6f6b 7320  _backward_hooks 
-00013590: 3d20 5b5d 2c20 5b5d 0d0a 2020 2020 2020  = [], []..      
-000135a0: 2020 6261 636b 7761 7264 5f70 7265 5f68    backward_pre_h
-000135b0: 6f6f 6b73 203d 205b 5d0d 0a20 2020 2020  ooks = []..     
-000135c0: 2020 2069 6620 7365 6c66 2e5f 6261 636b     if self._back
-000135d0: 7761 7264 5f70 7265 5f68 6f6f 6b73 206f  ward_pre_hooks o
-000135e0: 7220 5f67 6c6f 6261 6c5f 6261 636b 7761  r _global_backwa
-000135f0: 7264 5f70 7265 5f68 6f6f 6b73 3a0d 0a20  rd_pre_hooks:.. 
-00013600: 2020 2020 2020 2020 2020 2062 6163 6b77             backw
-00013610: 6172 645f 7072 655f 686f 6f6b 7320 3d20  ard_pre_hooks = 
-00013620: 7365 6c66 2e5f 6765 745f 6261 636b 7761  self._get_backwa
-00013630: 7264 5f70 7265 5f68 6f6f 6b73 2829 0d0a  rd_pre_hooks()..
-00013640: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00013650: 662e 5f62 6163 6b77 6172 645f 686f 6f6b  f._backward_hook
-00013660: 7320 6f72 205f 676c 6f62 616c 5f62 6163  s or _global_bac
-00013670: 6b77 6172 645f 686f 6f6b 733a 0d0a 2020  kward_hooks:..  
-00013680: 2020 2020 2020 2020 2020 6675 6c6c 5f62            full_b
-00013690: 6163 6b77 6172 645f 686f 6f6b 732c 206e  ackward_hooks, n
-000136a0: 6f6e 5f66 756c 6c5f 6261 636b 7761 7264  on_full_backward
-000136b0: 5f68 6f6f 6b73 203d 2073 656c 662e 5f67  _hooks = self._g
-000136c0: 6574 5f62 6163 6b77 6172 645f 686f 6f6b  et_backward_hook
-000136d0: 7328 290d 0a0d 0a0d 0a0d 0a20 2020 2020  s()........     
-000136e0: 2020 2069 6620 5f67 6c6f 6261 6c5f 666f     if _global_fo
-000136f0: 7277 6172 645f 7072 655f 686f 6f6b 7320  rward_pre_hooks 
-00013700: 6f72 2073 656c 662e 5f66 6f72 7761 7264  or self._forward
-00013710: 5f70 7265 5f68 6f6f 6b73 3a0d 0a20 2020  _pre_hooks:..   
-00013720: 2020 2020 2020 2020 2066 6f72 2068 6f6f           for hoo
-00013730: 6b5f 6964 2c20 686f 6f6b 2069 6e20 280d  k_id, hook in (.
-00013740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013750: 2020 2020 202a 5f67 6c6f 6261 6c5f 666f       *_global_fo
-00013760: 7277 6172 645f 7072 655f 686f 6f6b 732e  rward_pre_hooks.
-00013770: 6974 656d 7328 292c 0d0a 2020 2020 2020  items(),..      
-00013780: 2020 2020 2020 2020 2020 2020 2020 2a73                *s
-00013790: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
-000137a0: 5f68 6f6f 6b73 2e69 7465 6d73 2829 2c0d  _hooks.items(),.
-000137b0: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
-000137c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000137d0: 2069 6620 686f 6f6b 5f69 6420 696e 2073   if hook_id in s
-000137e0: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
-000137f0: 5f68 6f6f 6b73 5f77 6974 685f 6b77 6172  _hooks_with_kwar
-00013800: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00013810: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00013820: 3d20 686f 6f6b 2873 656c 662c 2061 7267  = hook(self, arg
-00013830: 732c 206b 7761 7267 7329 2020 2320 7479  s, kwargs)  # ty
-00013840: 7065 3a20 6967 6e6f 7265 5b6d 6973 635d  pe: ignore[misc]
-00013850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013860: 2020 2020 2020 6966 2072 6573 756c 7420        if result 
-00013870: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00013880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013890: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000138a0: 6e63 6528 7265 7375 6c74 2c20 7475 706c  nce(result, tupl
-000138b0: 6529 2061 6e64 206c 656e 2872 6573 756c  e) and len(resul
-000138c0: 7429 203d 3d20 323a 0d0a 2020 2020 2020  t) == 2:..      
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 2020 2020 6172 6773 2c20 6b77 6172        args, kwar
-000138f0: 6773 203d 2072 6573 756c 740d 0a20 2020  gs = result..   
-00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013910: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00013920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013930: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-00013940: 6e74 696d 6545 7272 6f72 280d 0a20 2020  ntimeError(..   
-00013950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013960: 2020 2020 2020 2020 2020 2020 2022 666f               "fo
-00013970: 7277 6172 6420 7072 652d 686f 6f6b 206d  rward pre-hook m
-00013980: 7573 7420 7265 7475 726e 204e 6f6e 6520  ust return None 
-00013990: 6f72 2061 2074 7570 6c65 2022 0d0a 2020  or a tuple "..  
-000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139b0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000139c0: 6f66 2028 6e65 775f 6172 6773 2c20 6e65  of (new_args, ne
-000139d0: 775f 6b77 6172 6773 292c 2062 7574 2067  w_kwargs), but g
-000139e0: 6f74 207b 7265 7375 6c74 7d2e 220d 0a20  ot {result}.".. 
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a00: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00013a10: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00013a20: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00013a30: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00013a40: 3d20 686f 6f6b 2873 656c 662c 2061 7267  = hook(self, arg
-00013a50: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-00013a60: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
-00013a70: 7420 6973 206e 6f74 204e 6f6e 653a 0d0a  t is not None:..
-00013a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a90: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00013aa0: 7369 6e73 7461 6e63 6528 7265 7375 6c74  sinstance(result
-00013ab0: 2c20 7475 706c 6529 3a0d 0a20 2020 2020  , tuple):..     
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00013ae0: 2872 6573 756c 742c 290d 0a20 2020 2020  (result,)..     
-00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b00: 2020 2061 7267 7320 3d20 7265 7375 6c74     args = result
-00013b10: 0d0a 0d0a 0d0a 0d0a 2020 2020 2020 2020  ........        
-00013b20: 6277 5f68 6f6f 6b20 3d20 4e6f 6e65 0d0a  bw_hook = None..
-00013b30: 2020 2020 2020 2020 6966 2066 756c 6c5f          if full_
-00013b40: 6261 636b 7761 7264 5f68 6f6f 6b73 206f  backward_hooks o
-00013b50: 7220 6261 636b 7761 7264 5f70 7265 5f68  r backward_pre_h
-00013b60: 6f6f 6b73 3a0d 0a20 2020 2020 2020 2020  ooks:..         
-00013b70: 2020 2062 775f 686f 6f6b 203d 2042 6163     bw_hook = Bac
-00013b80: 6b77 6172 6448 6f6f 6b28 7365 6c66 2c20  kwardHook(self, 
-00013b90: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
-00013ba0: 6f6b 732c 2062 6163 6b77 6172 645f 7072  oks, backward_pr
-00013bb0: 655f 686f 6f6b 7329 0d0a 2020 2020 2020  e_hooks)..      
-00013bc0: 2020 2020 2020 6172 6773 203d 2062 775f        args = bw_
-00013bd0: 686f 6f6b 2e73 6574 7570 5f69 6e70 7574  hook.setup_input
-00013be0: 5f68 6f6f 6b28 6172 6773 290d 0a20 2020  _hook(args)..   
-00013bf0: 2020 2020 2023 206f 7269 675f 696e 7075       # orig_inpu
-00013c00: 743d 5b69 6e70 2e63 6f70 7928 292e 6465  t=[inp.copy().de
-00013c10: 7461 6368 2829 2066 6f72 2069 6e70 2069  tach() for inp i
-00013c20: 6e20 696e 7075 745d 0d0a 2020 2020 2020  n input]..      
-00013c30: 2020 2320 6973 5f61 626e 6f72 6d61 6c3d    # is_abnormal=
-00013c40: 616e 7928 5b61 6e79 5f61 626e 6f72 6d61  any([any_abnorma
-00013c50: 6c5f 6e75 6d62 6572 2869 6e70 2966 6f72  l_number(inp)for
-00013c60: 2069 6e70 2069 6e20 6f72 6967 5f69 6e70   inp in orig_inp
-00013c70: 7574 5d29 0d0a 2020 2020 2020 2020 2320  ut])..        # 
-00013c80: 6966 206c 656e 2873 656c 662e 7765 6967  if len(self.weig
-00013c90: 6874 7329 3e30 2061 6e64 2073 656c 662e  hts)>0 and self.
-00013ca0: 7765 6967 6874 735b 305d 2069 7320 6e6f  weights[0] is no
-00013cb0: 7420 4e6f 6e65 2061 6e64 206e 6f74 2073  t None and not s
-00013cc0: 656c 662e 7765 6967 6874 735b 305d 2e72  elf.weights[0].r
-00013cd0: 6571 7569 7265 735f 6772 6164 3a0d 0a20  equires_grad:.. 
-00013ce0: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
-00013cf0: 6e74 2873 656c 662e 7265 6c61 7469 7665  nt(self.relative
-00013d00: 5f6e 616d 652c 2777 6569 6768 7473 2072  _name,'weights r
-00013d10: 6571 7569 7265 735f 6772 6164 272c 7365  equires_grad',se
-00013d20: 6c66 2e77 6569 6768 7473 5b30 5d2e 7265  lf.weights[0].re
-00013d30: 7175 6972 6573 5f67 7261 6429 0d0a 0d0a  quires_grad)....
-00013d40: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00013d50: 2066 6f72 7761 7264 5f63 616c 6c28 2a61   forward_call(*a
-00013d60: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-00013d70: 2020 2020 2020 2020 2320 6966 206e 6f74          # if not
-00013d80: 2069 735f 6162 6e6f 726d 616c 2061 6e64   is_abnormal and
-00013d90: 2061 6e79 285b 616e 795f 6162 6e6f 726d   any([any_abnorm
-00013da0: 616c 5f6e 756d 6265 7228 696e 7029 666f  al_number(inp)fo
-00013db0: 7220 696e 7020 696e 2072 6573 756c 745d  r inp in result]
-00013dc0: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
-00013dd0: 2020 7072 696e 7428 2761 626e 6f72 6d61    print('abnorma
-00013de0: 6c5f 6e75 6d62 6572 272c 7365 6c66 2e72  l_number',self.r
-00013df0: 656c 6174 6976 655f 6e61 6d65 2c27 6265  elative_name,'be
-00013e00: 666f 7265 3a27 2c69 735f 6162 6e6f 726d  fore:',is_abnorm
-00013e10: 616c 290d 0a20 2020 2020 2020 2023 2020  al)..        #  
-00013e20: 2020 2070 7269 6e74 2827 6f72 6967 5f69     print('orig_i
-00013e30: 6e70 7574 272c 5b69 6e70 5b30 2c3a 5d20  nput',[inp[0,:] 
-00013e40: 666f 7220 696e 7020 696e 206f 7269 675f  for inp in orig_
-00013e50: 696e 7075 745d 290d 0a20 2020 2020 2020  input])..       
-00013e60: 2023 2020 2020 2070 7269 6e74 2827 7265   #     print('re
-00013e70: 7375 6c74 272c 205b 696e 705b 302c 3a5d  sult', [inp[0,:]
-00013e80: 2066 6f72 2069 6e70 2069 6e20 7265 7375   for inp in resu
-00013e90: 6c74 5d29 0d0a 2020 2020 2020 2020 2320  lt])..        # 
-00013ea0: 2020 2020 7072 696e 7428 2777 6569 6768      print('weigh
-00013eb0: 7427 2c6c 6973 7428 7365 6c66 2e6e 616d  t',list(self.nam
-00013ec0: 6564 5f70 6172 616d 6574 6572 7328 2929  ed_parameters())
-00013ed0: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-00013ee0: 2070 7269 6e74 2827 6163 7469 7661 7469   print('activati
-00013ef0: 6f6e 272c 7365 6c66 2e61 6374 6976 6174  on',self.activat
-00013f00: 696f 6e29 0d0a 2020 2020 2020 2020 2320  ion)..        # 
-00013f10: 2020 2020 6f75 743d 666f 7277 6172 645f      out=forward_
-00013f20: 6361 6c6c 282a 6f72 6967 5f69 6e70 7574  call(*orig_input
-00013f30: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
-00013f40: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00013f50: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
-00013f60: 2872 6573 756c 7429 0d0a 0d0a 2020 2020  (result)....    
-00013f70: 2020 2020 6966 2068 6173 6174 7472 2873      if hasattr(s
-00013f80: 656c 662c 2027 6b65 6570 5f6f 7574 7075  elf, 'keep_outpu
-00013f90: 7427 2920 616e 6420 7365 6c66 2e6b 6565  t') and self.kee
-00013fa0: 705f 6f75 7470 7574 203d 3d20 5472 7565  p_output == True
-00013fb0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00013fc0: 206d 616b 6520 6120 6f70 0d0a 2020 2020   make a op..    
-00013fd0: 2020 2020 2020 2020 7365 6c66 2e5f 6f75          self._ou
-00013fe0: 7470 7574 5f74 656e 736f 7220 3d20 7265  tput_tensor = re
-00013ff0: 7375 6c74 0d0a 2020 2020 2020 2020 6966  sult..        if
-00014000: 2073 656c 662e 5f6f 7574 7075 745f 7368   self._output_sh
-00014010: 6170 6520 6973 204e 6f6e 6520 6f72 2069  ape is None or i
-00014020: 735f 6275 696c 7420 3d3d 2046 616c 7365  s_built == False
-00014030: 3a0d 0a20 2020 2020 2020 2020 2020 206f  :..            o
-00014040: 7574 7075 7420 3d20 7265 7375 6c74 0d0a  utput = result..
-00014050: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00014060: 735f 7465 6e73 6f72 286f 7574 7075 7429  s_tensor(output)
-00014070: 3a20 2023 206f 6e65 206f 7574 7075 740d  :  # one output.
-00014080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014090: 2073 656c 662e 5f6f 7574 7075 745f 7368   self._output_sh
-000140a0: 6170 6520 3d20 7465 6e73 6f72 5f74 6f5f  ape = tensor_to_
-000140b0: 7368 6170 6528 6f75 7470 7574 290d 0a20  shape(output).. 
-000140c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000140d0: 6973 696e 7374 616e 6365 286f 7574 7075  isinstance(outpu
-000140e0: 742c 2028 6c69 7374 2c20 7475 706c 6529  t, (list, tuple)
-000140f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00014100: 2020 2020 6f75 7470 7574 5f73 6861 7065      output_shape
-00014110: 203d 2074 7570 6c65 285b 7465 6e73 6f72   = tuple([tensor
-00014120: 5f74 6f5f 7368 6170 6528 6974 656d 2920  _to_shape(item) 
-00014130: 666f 7220 6974 656d 2069 6e20 6f75 7470  for item in outp
-00014140: 7574 2069 660d 0a20 2020 2020 2020 2020  ut if..         
-00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014160: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-00014170: 6d20 6973 206e 6f74 204e 6f6e 6520 616e  m is not None an
-00014180: 6420 6e6f 7420 6973 696e 7374 616e 6365  d not isinstance
-00014190: 2869 7465 6d2c 2028 6c69 7374 2c20 7475  (item, (list, tu
-000141a0: 706c 6529 295d 290d 0a20 2020 2020 2020  ple))])..       
-000141b0: 2020 2020 2020 2020 2023 2069 6620 6e6f           # if no
-000141c0: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
-000141d0: 6d2c 2028 6c69 7374 2c74 7570 6c65 2929  m, (list,tuple))
-000141e0: 206c 7374 6d0d 0a20 2020 2020 2020 2020   lstm..         
-000141f0: 2020 2020 2020 2073 656c 662e 5f6f 7574         self._out
-00014200: 7075 745f 7368 6170 6520 3d20 756e 7061  put_shape = unpa
-00014210: 636b 5f73 696e 676c 6574 6f6e 286f 7574  ck_singleton(out
-00014220: 7075 745f 7368 6170 6529 0d0a 0d0a 2020  put_shape)....  
-00014230: 2020 2020 2020 6966 205f 676c 6f62 616c        if _global
-00014240: 5f66 6f72 7761 7264 5f68 6f6f 6b73 206f  _forward_hooks o
-00014250: 7220 7365 6c66 2e5f 666f 7277 6172 645f  r self._forward_
-00014260: 686f 6f6b 733a 0d0a 2020 2020 2020 2020  hooks:..        
-00014270: 2020 2020 666f 7220 686f 6f6b 5f69 642c      for hook_id,
-00014280: 2068 6f6f 6b20 696e 2028 0d0a 2020 2020   hook in (..    
-00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142a0: 2a5f 676c 6f62 616c 5f66 6f72 7761 7264  *_global_forward
-000142b0: 5f68 6f6f 6b73 2e69 7465 6d73 2829 2c0d  _hooks.items(),.
-000142c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000142d0: 2020 2020 202a 7365 6c66 2e5f 666f 7277       *self._forw
-000142e0: 6172 645f 686f 6f6b 732e 6974 656d 7328  ard_hooks.items(
-000142f0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00014300: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00014310: 2020 2020 6966 2068 6f6f 6b5f 6964 2069      if hook_id i
-00014320: 6e20 7365 6c66 2e5f 666f 7277 6172 645f  n self._forward_
-00014330: 686f 6f6b 735f 7769 7468 5f6b 7761 7267  hooks_with_kwarg
-00014340: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00014350: 2020 2020 2020 2020 686f 6f6b 5f72 6573          hook_res
-00014360: 756c 7420 3d20 686f 6f6b 2873 656c 662c  ult = hook(self,
-00014370: 2061 7267 732c 206b 7761 7267 732c 2072   args, kwargs, r
-00014380: 6573 756c 7429 0d0a 2020 2020 2020 2020  esult)..        
-00014390: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000143a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143b0: 2020 2068 6f6f 6b5f 7265 7375 6c74 203d     hook_result =
-000143c0: 2068 6f6f 6b28 7365 6c66 2c20 6172 6773   hook(self, args
-000143d0: 2c20 7265 7375 6c74 290d 0a0d 0a20 2020  , result)....   
-000143e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000143f0: 686f 6f6b 5f72 6573 756c 7420 6973 206e  hook_result is n
-00014400: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00014410: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00014420: 7375 6c74 203d 2068 6f6f 6b5f 7265 7375  sult = hook_resu
-00014430: 6c74 0d0a 0d0a 2020 2020 2020 2020 6966  lt....        if
-00014440: 2062 775f 686f 6f6b 3a0d 0a20 2020 2020   bw_hook:..     
-00014450: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00014460: 696e 7374 616e 6365 2872 6573 756c 742c  instance(result,
-00014470: 2028 746f 7263 682e 5465 6e73 6f72 2c20   (torch.Tensor, 
-00014480: 7475 706c 6529 293a 0d0a 2020 2020 2020  tuple)):..      
-00014490: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-000144a0: 6773 2e77 6172 6e28 2246 6f72 2062 6163  gs.warn("For bac
-000144b0: 6b77 6172 6420 686f 6f6b 7320 746f 2062  kward hooks to b
-000144c0: 6520 6361 6c6c 6564 2c22 0d0a 2020 2020  e called,"..    
-000144d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144e0: 2020 2020 2020 2020 2020 2220 6d6f 6475            " modu
-000144f0: 6c65 206f 7574 7075 7420 7368 6f75 6c64  le output should
-00014500: 2062 6520 6120 5465 6e73 6f72 206f 7220   be a Tensor or 
-00014510: 6120 7475 706c 6520 6f66 2054 656e 736f  a tuple of Tenso
-00014520: 7273 220d 0a20 2020 2020 2020 2020 2020  rs"..           
+000132d0: 2020 2020 2020 2020 2020 2020 2020 6974                it
+000132e0: 656d 2069 7320 6e6f 7420 4e6f 6e65 2061  em is not None a
+000132f0: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
+00013300: 6528 6974 656d 2c20 286c 6973 742c 2074  e(item, (list, t
+00013310: 7570 6c65 2929 5d29 0d0a 2020 2020 2020  uple))])..      
+00013320: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00013330: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00013340: 6528 6974 656d 2c20 286c 6973 742c 7475  e(item, (list,tu
+00013350: 706c 6529 2920 6c73 746d 0d0a 2020 2020  ple)) lstm..    
+00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013370: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
+00013380: 7065 203d 2075 6e70 6163 6b5f 7369 6e67  pe = unpack_sing
+00013390: 6c65 746f 6e28 6f75 7470 7574 5f73 6861  leton(output_sha
+000133a0: 7065 290d 0a20 2020 2020 2020 2020 2020  pe)..           
+000133b0: 2069 6620 6973 5f61 6c6c 5f6e 756d 7079   if is_all_numpy
+000133c0: 203d 3d20 5472 7565 2061 6e64 2073 656c   == True and sel
+000133d0: 662e 7472 6169 6e69 6e67 203d 3d20 4661  f.training == Fa
+000133e0: 6c73 6520 616e 6420 7365 6c66 2e69 735f  lse and self.is_
+000133f0: 726f 6f74 203d 3d20 5472 7565 3a0d 0a20  root == True:.. 
+00013400: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013410: 6620 6973 5f74 656e 736f 7228 7265 7375  f is_tensor(resu
+00013420: 6c74 293a 0d0a 2020 2020 2020 2020 2020  lt):..          
+00013430: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013440: 2074 6f5f 6e75 6d70 7928 7265 7375 6c74   to_numpy(result
+00013450: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013460: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00013470: 6365 2872 6573 756c 742c 2028 6c69 7374  ce(result, (list
+00013480: 2c20 7475 706c 6529 293a 0d0a 2020 2020  , tuple)):..    
+00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134a0: 7265 7375 6c74 203d 206c 6973 7428 7265  result = list(re
+000134b0: 7375 6c74 290d 0a20 2020 2020 2020 2020  sult)..         
+000134c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000134d0: 6e20 7475 706c 6528 5b74 6f5f 6e75 6d70  n tuple([to_nump
+000134e0: 7928 7265 7329 2069 6620 6973 5f74 656e  y(res) if is_ten
+000134f0: 736f 7228 7265 7329 2065 6c73 6520 7265  sor(res) else re
+00013500: 7320 666f 7220 7265 7320 696e 2072 6573  s for res in res
+00013510: 756c 745d 290d 0a20 2020 2020 2020 2020  ult])..         
+00013520: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00013530: 0d0a 0d0a 2020 2020 2020 2020 2320 446f  ....        # Do
+00013540: 206e 6f74 2063 616c 6c20 6675 6e63 7469   not call functi
+00013550: 6f6e 7320 7768 656e 206a 6974 2069 7320  ons when jit is 
+00013560: 7573 6564 0d0a 2020 2020 2020 2020 6675  used..        fu
+00013570: 6c6c 5f62 6163 6b77 6172 645f 686f 6f6b  ll_backward_hook
+00013580: 732c 206e 6f6e 5f66 756c 6c5f 6261 636b  s, non_full_back
+00013590: 7761 7264 5f68 6f6f 6b73 203d 205b 5d2c  ward_hooks = [],
+000135a0: 205b 5d0d 0a20 2020 2020 2020 2062 6163   []..        bac
+000135b0: 6b77 6172 645f 7072 655f 686f 6f6b 7320  kward_pre_hooks 
+000135c0: 3d20 5b5d 0d0a 2020 2020 2020 2020 6966  = []..        if
+000135d0: 2073 656c 662e 5f62 6163 6b77 6172 645f   self._backward_
+000135e0: 7072 655f 686f 6f6b 7320 6f72 205f 676c  pre_hooks or _gl
+000135f0: 6f62 616c 5f62 6163 6b77 6172 645f 7072  obal_backward_pr
+00013600: 655f 686f 6f6b 733a 0d0a 2020 2020 2020  e_hooks:..      
+00013610: 2020 2020 2020 6261 636b 7761 7264 5f70        backward_p
+00013620: 7265 5f68 6f6f 6b73 203d 2073 656c 662e  re_hooks = self.
+00013630: 5f67 6574 5f62 6163 6b77 6172 645f 7072  _get_backward_pr
+00013640: 655f 686f 6f6b 7328 290d 0a0d 0a20 2020  e_hooks()....   
+00013650: 2020 2020 2069 6620 7365 6c66 2e5f 6261       if self._ba
+00013660: 636b 7761 7264 5f68 6f6f 6b73 206f 7220  ckward_hooks or 
+00013670: 5f67 6c6f 6261 6c5f 6261 636b 7761 7264  _global_backward
+00013680: 5f68 6f6f 6b73 3a0d 0a20 2020 2020 2020  _hooks:..       
+00013690: 2020 2020 2066 756c 6c5f 6261 636b 7761       full_backwa
+000136a0: 7264 5f68 6f6f 6b73 2c20 6e6f 6e5f 6675  rd_hooks, non_fu
+000136b0: 6c6c 5f62 6163 6b77 6172 645f 686f 6f6b  ll_backward_hook
+000136c0: 7320 3d20 7365 6c66 2e5f 6765 745f 6261  s = self._get_ba
+000136d0: 636b 7761 7264 5f68 6f6f 6b73 2829 0d0a  ckward_hooks()..
+000136e0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
+000136f0: 205f 676c 6f62 616c 5f66 6f72 7761 7264   _global_forward
+00013700: 5f70 7265 5f68 6f6f 6b73 206f 7220 7365  _pre_hooks or se
+00013710: 6c66 2e5f 666f 7277 6172 645f 7072 655f  lf._forward_pre_
+00013720: 686f 6f6b 733a 0d0a 2020 2020 2020 2020  hooks:..        
+00013730: 2020 2020 666f 7220 686f 6f6b 5f69 642c      for hook_id,
+00013740: 2068 6f6f 6b20 696e 2028 0d0a 2020 2020   hook in (..    
+00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013760: 2a5f 676c 6f62 616c 5f66 6f72 7761 7264  *_global_forward
+00013770: 5f70 7265 5f68 6f6f 6b73 2e69 7465 6d73  _pre_hooks.items
+00013780: 2829 2c0d 0a20 2020 2020 2020 2020 2020  (),..           
+00013790: 2020 2020 2020 2020 202a 7365 6c66 2e5f           *self._
+000137a0: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+000137b0: 732e 6974 656d 7328 292c 0d0a 2020 2020  s.items(),..    
+000137c0: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+000137d0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+000137e0: 6f6f 6b5f 6964 2069 6e20 7365 6c66 2e5f  ook_id in self._
+000137f0: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+00013800: 735f 7769 7468 5f6b 7761 7267 733a 0d0a  s_with_kwargs:..
+00013810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013820: 2020 2020 7265 7375 6c74 203d 2068 6f6f      result = hoo
+00013830: 6b28 7365 6c66 2c20 6172 6773 2c20 6b77  k(self, args, kw
+00013840: 6172 6773 2920 2023 2074 7970 653a 2069  args)  # type: i
+00013850: 676e 6f72 655b 6d69 7363 5d0d 0a20 2020  gnore[misc]..   
+00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013870: 2069 6620 7265 7375 6c74 2069 7320 6e6f   if result is no
+00013880: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00013890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138a0: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
+000138b0: 6573 756c 742c 2074 7570 6c65 2920 616e  esult, tuple) an
+000138c0: 6420 6c65 6e28 7265 7375 6c74 2920 3d3d  d len(result) ==
+000138d0: 2032 3a0d 0a20 2020 2020 2020 2020 2020   2:..           
+000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138f0: 2061 7267 732c 206b 7761 7267 7320 3d20   args, kwargs = 
+00013900: 7265 7375 6c74 0d0a 2020 2020 2020 2020  result..        
+00013910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013920: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013940: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
+00013950: 4572 726f 7228 0d0a 2020 2020 2020 2020  Error(..        
+00013960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013970: 2020 2020 2020 2020 2266 6f72 7761 7264          "forward
+00013980: 2070 7265 2d68 6f6f 6b20 6d75 7374 2072   pre-hook must r
+00013990: 6574 7572 6e20 4e6f 6e65 206f 7220 6120  eturn None or a 
+000139a0: 7475 706c 6520 220d 0a20 2020 2020 2020  tuple "..       
+000139b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139c0: 2020 2020 2020 2020 2066 226f 6620 286e           f"of (n
+000139d0: 6577 5f61 7267 732c 206e 6577 5f6b 7761  ew_args, new_kwa
+000139e0: 7267 7329 2c20 6275 7420 676f 7420 7b72  rgs), but got {r
+000139f0: 6573 756c 747d 2e22 0d0a 2020 2020 2020  esult}."..      
+00013a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a10: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00013a20: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a40: 2020 2020 7265 7375 6c74 203d 2068 6f6f      result = hoo
+00013a50: 6b28 7365 6c66 2c20 6172 6773 290d 0a20  k(self, args).. 
+00013a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a70: 2020 2069 6620 7265 7375 6c74 2069 7320     if result is 
+00013a80: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00013a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013aa0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+00013ab0: 616e 6365 2872 6573 756c 742c 2074 7570  ance(result, tup
+00013ac0: 6c65 293a 0d0a 2020 2020 2020 2020 2020  le):..          
+00013ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ae0: 2020 7265 7375 6c74 203d 2028 7265 7375    result = (resu
+00013af0: 6c74 2c29 0d0a 2020 2020 2020 2020 2020  lt,)..          
+00013b00: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+00013b10: 6773 203d 2072 6573 756c 740d 0a0d 0a0d  gs = result.....
+00013b20: 0a0d 0a20 2020 2020 2020 2062 775f 686f  ...        bw_ho
+00013b30: 6f6b 203d 204e 6f6e 650d 0a20 2020 2020  ok = None..     
+00013b40: 2020 2069 6620 6675 6c6c 5f62 6163 6b77     if full_backw
+00013b50: 6172 645f 686f 6f6b 7320 6f72 2062 6163  ard_hooks or bac
+00013b60: 6b77 6172 645f 7072 655f 686f 6f6b 733a  kward_pre_hooks:
+00013b70: 0d0a 2020 2020 2020 2020 2020 2020 6277  ..            bw
+00013b80: 5f68 6f6f 6b20 3d20 4261 636b 7761 7264  _hook = Backward
+00013b90: 486f 6f6b 2873 656c 662c 2066 756c 6c5f  Hook(self, full_
+00013ba0: 6261 636b 7761 7264 5f68 6f6f 6b73 2c20  backward_hooks, 
+00013bb0: 6261 636b 7761 7264 5f70 7265 5f68 6f6f  backward_pre_hoo
+00013bc0: 6b73 290d 0a20 2020 2020 2020 2020 2020  ks)..           
+00013bd0: 2061 7267 7320 3d20 6277 5f68 6f6f 6b2e   args = bw_hook.
+00013be0: 7365 7475 705f 696e 7075 745f 686f 6f6b  setup_input_hook
+00013bf0: 2861 7267 7329 0d0a 2020 2020 2020 2020  (args)..        
+00013c00: 2320 6f72 6967 5f69 6e70 7574 3d5b 696e  # orig_input=[in
+00013c10: 702e 636f 7079 2829 2e64 6574 6163 6828  p.copy().detach(
+00013c20: 2920 666f 7220 696e 7020 696e 2069 6e70  ) for inp in inp
+00013c30: 7574 5d0d 0a20 2020 2020 2020 2023 2069  ut]..        # i
+00013c40: 735f 6162 6e6f 726d 616c 3d61 6e79 285b  s_abnormal=any([
+00013c50: 616e 795f 6162 6e6f 726d 616c 5f6e 756d  any_abnormal_num
+00013c60: 6265 7228 696e 7029 666f 7220 696e 7020  ber(inp)for inp 
+00013c70: 696e 206f 7269 675f 696e 7075 745d 290d  in orig_input]).
+00013c80: 0a20 2020 2020 2020 2023 2069 6620 6c65  .        # if le
+00013c90: 6e28 7365 6c66 2e77 6569 6768 7473 293e  n(self.weights)>
+00013ca0: 3020 616e 6420 7365 6c66 2e77 6569 6768  0 and self.weigh
+00013cb0: 7473 5b30 5d20 6973 206e 6f74 204e 6f6e  ts[0] is not Non
+00013cc0: 6520 616e 6420 6e6f 7420 7365 6c66 2e77  e and not self.w
+00013cd0: 6569 6768 7473 5b30 5d2e 7265 7175 6972  eights[0].requir
+00013ce0: 6573 5f67 7261 643a 0d0a 2020 2020 2020  es_grad:..      
+00013cf0: 2020 2320 2020 2020 7072 696e 7428 7365    #     print(se
+00013d00: 6c66 2e72 656c 6174 6976 655f 6e61 6d65  lf.relative_name
+00013d10: 2c27 7765 6967 6874 7320 7265 7175 6972  ,'weights requir
+00013d20: 6573 5f67 7261 6427 2c73 656c 662e 7765  es_grad',self.we
+00013d30: 6967 6874 735b 305d 2e72 6571 7569 7265  ights[0].require
+00013d40: 735f 6772 6164 290d 0a0d 0a20 2020 2020  s_grad)....     
+00013d50: 2020 2072 6573 756c 7420 3d20 666f 7277     result = forw
+00013d60: 6172 645f 6361 6c6c 282a 6172 6773 2c20  ard_call(*args, 
+00013d70: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00013d80: 2020 2023 2069 6620 6e6f 7420 6973 5f61     # if not is_a
+00013d90: 626e 6f72 6d61 6c20 616e 6420 616e 7928  bnormal and any(
+00013da0: 5b61 6e79 5f61 626e 6f72 6d61 6c5f 6e75  [any_abnormal_nu
+00013db0: 6d62 6572 2869 6e70 2966 6f72 2069 6e70  mber(inp)for inp
+00013dc0: 2069 6e20 7265 7375 6c74 5d29 3a0d 0a20   in result]):.. 
+00013dd0: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
+00013de0: 6e74 2827 6162 6e6f 726d 616c 5f6e 756d  nt('abnormal_num
+00013df0: 6265 7227 2c73 656c 662e 7265 6c61 7469  ber',self.relati
+00013e00: 7665 5f6e 616d 652c 2762 6566 6f72 653a  ve_name,'before:
+00013e10: 272c 6973 5f61 626e 6f72 6d61 6c29 0d0a  ',is_abnormal)..
+00013e20: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
+00013e30: 696e 7428 276f 7269 675f 696e 7075 7427  int('orig_input'
+00013e40: 2c5b 696e 705b 302c 3a5d 2066 6f72 2069  ,[inp[0,:] for i
+00013e50: 6e70 2069 6e20 6f72 6967 5f69 6e70 7574  np in orig_input
+00013e60: 5d29 0d0a 2020 2020 2020 2020 2320 2020  ])..        #   
+00013e70: 2020 7072 696e 7428 2772 6573 756c 7427    print('result'
+00013e80: 2c20 5b69 6e70 5b30 2c3a 5d20 666f 7220  , [inp[0,:] for 
+00013e90: 696e 7020 696e 2072 6573 756c 745d 290d  inp in result]).
+00013ea0: 0a20 2020 2020 2020 2023 2020 2020 2070  .        #     p
+00013eb0: 7269 6e74 2827 7765 6967 6874 272c 6c69  rint('weight',li
+00013ec0: 7374 2873 656c 662e 6e61 6d65 645f 7061  st(self.named_pa
+00013ed0: 7261 6d65 7465 7273 2829 2929 0d0a 2020  rameters()))..  
+00013ee0: 2020 2020 2020 2320 2020 2020 7072 696e        #     prin
+00013ef0: 7428 2761 6374 6976 6174 696f 6e27 2c73  t('activation',s
+00013f00: 656c 662e 6163 7469 7661 7469 6f6e 290d  elf.activation).
+00013f10: 0a20 2020 2020 2020 2023 2020 2020 206f  .        #     o
+00013f20: 7574 3d66 6f72 7761 7264 5f63 616c 6c28  ut=forward_call(
+00013f30: 2a6f 7269 675f 696e 7075 742c 202a 2a6b  *orig_input, **k
+00013f40: 7761 7267 7329 0d0a 0d0a 2020 2020 2020  wargs)....      
+00013f50: 2020 7265 7375 6c74 203d 2075 6e70 6163    result = unpac
+00013f60: 6b5f 7369 6e67 6c65 746f 6e28 7265 7375  k_singleton(resu
+00013f70: 6c74 290d 0a0d 0a20 2020 2020 2020 2069  lt)....        i
+00013f80: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
+00013f90: 276b 6565 705f 6f75 7470 7574 2729 2061  'keep_output') a
+00013fa0: 6e64 2073 656c 662e 6b65 6570 5f6f 7574  nd self.keep_out
+00013fb0: 7075 7420 3d3d 2054 7275 653a 0d0a 2020  put == True:..  
+00013fc0: 2020 2020 2020 2020 2020 2320 6d61 6b65            # make
+00013fd0: 2061 206f 700d 0a20 2020 2020 2020 2020   a op..         
+00013fe0: 2020 2073 656c 662e 5f6f 7574 7075 745f     self._output_
+00013ff0: 7465 6e73 6f72 203d 2072 6573 756c 740d  tensor = result.
+00014000: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00014010: 2e5f 6f75 7470 7574 5f73 6861 7065 2069  ._output_shape i
+00014020: 7320 4e6f 6e65 206f 7220 6973 5f62 7569  s None or is_bui
+00014030: 6c74 203d 3d20 4661 6c73 653a 0d0a 2020  lt == False:..  
+00014040: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00014050: 203d 2072 6573 756c 740d 0a20 2020 2020   = result..     
+00014060: 2020 2020 2020 2069 6620 6973 5f74 656e         if is_ten
+00014070: 736f 7228 6f75 7470 7574 293a 2020 2320  sor(output):  # 
+00014080: 6f6e 6520 6f75 7470 7574 0d0a 2020 2020  one output..    
+00014090: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000140a0: 2e5f 6f75 7470 7574 5f73 6861 7065 203d  ._output_shape =
+000140b0: 2074 656e 736f 725f 746f 5f73 6861 7065   tensor_to_shape
+000140c0: 286f 7574 7075 7429 0d0a 2020 2020 2020  (output)..      
+000140d0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+000140e0: 7461 6e63 6528 6f75 7470 7574 2c20 286c  tance(output, (l
+000140f0: 6973 742c 2074 7570 6c65 2929 3a0d 0a20  ist, tuple)):.. 
+00014100: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00014110: 7574 7075 745f 7368 6170 6520 3d20 7475  utput_shape = tu
+00014120: 706c 6528 5b74 656e 736f 725f 746f 5f73  ple([tensor_to_s
+00014130: 6861 7065 2869 7465 6d29 2066 6f72 2069  hape(item) for i
+00014140: 7465 6d20 696e 206f 7574 7075 7420 6966  tem in output if
+00014150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014170: 2020 2020 2020 2020 6974 656d 2069 7320          item is 
+00014180: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
+00014190: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+000141a0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+000141b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+000141c0: 2020 2020 2320 6966 206e 6f74 2069 7369      # if not isi
+000141d0: 6e73 7461 6e63 6528 6974 656d 2c20 286c  nstance(item, (l
+000141e0: 6973 742c 7475 706c 6529 2920 6c73 746d  ist,tuple)) lstm
+000141f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014200: 2020 7365 6c66 2e5f 6f75 7470 7574 5f73    self._output_s
+00014210: 6861 7065 203d 2075 6e70 6163 6b5f 7369  hape = unpack_si
+00014220: 6e67 6c65 746f 6e28 6f75 7470 7574 5f73  ngleton(output_s
+00014230: 6861 7065 290d 0a0d 0a20 2020 2020 2020  hape)....       
+00014240: 2069 6620 5f67 6c6f 6261 6c5f 666f 7277   if _global_forw
+00014250: 6172 645f 686f 6f6b 7320 6f72 2073 656c  ard_hooks or sel
+00014260: 662e 5f66 6f72 7761 7264 5f68 6f6f 6b73  f._forward_hooks
+00014270: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+00014280: 6f72 2068 6f6f 6b5f 6964 2c20 686f 6f6b  or hook_id, hook
+00014290: 2069 6e20 280d 0a20 2020 2020 2020 2020   in (..         
+000142a0: 2020 2020 2020 2020 2020 202a 5f67 6c6f             *_glo
+000142b0: 6261 6c5f 666f 7277 6172 645f 686f 6f6b  bal_forward_hook
+000142c0: 732e 6974 656d 7328 292c 0d0a 2020 2020  s.items(),..    
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 2a73 656c 662e 5f66 6f72 7761 7264 5f68  *self._forward_h
+000142f0: 6f6f 6b73 2e69 7465 6d73 2829 2c0d 0a20  ooks.items(),.. 
+00014300: 2020 2020 2020 2020 2020 2029 3a0d 0a20             ):.. 
+00014310: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014320: 6620 686f 6f6b 5f69 6420 696e 2073 656c  f hook_id in sel
+00014330: 662e 5f66 6f72 7761 7264 5f68 6f6f 6b73  f._forward_hooks
+00014340: 5f77 6974 685f 6b77 6172 6773 3a0d 0a20  _with_kwargs:.. 
+00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014360: 2020 2068 6f6f 6b5f 7265 7375 6c74 203d     hook_result =
+00014370: 2068 6f6f 6b28 7365 6c66 2c20 6172 6773   hook(self, args
+00014380: 2c20 6b77 6172 6773 2c20 7265 7375 6c74  , kwargs, result
+00014390: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000143a0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000143b0: 2020 2020 2020 2020 2020 2020 2020 686f                ho
+000143c0: 6f6b 5f72 6573 756c 7420 3d20 686f 6f6b  ok_result = hook
+000143d0: 2873 656c 662c 2061 7267 732c 2072 6573  (self, args, res
+000143e0: 756c 7429 0d0a 0d0a 2020 2020 2020 2020  ult)....        
+000143f0: 2020 2020 2020 2020 6966 2068 6f6f 6b5f          if hook_
+00014400: 7265 7375 6c74 2069 7320 6e6f 7420 4e6f  result is not No
+00014410: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00014420: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00014430: 3d20 686f 6f6b 5f72 6573 756c 740d 0a0d  = hook_result...
+00014440: 0a20 2020 2020 2020 2069 6620 6277 5f68  .        if bw_h
+00014450: 6f6f 6b3a 0d0a 2020 2020 2020 2020 2020  ook:..          
+00014460: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00014470: 6e63 6528 7265 7375 6c74 2c20 2874 6f72  nce(result, (tor
+00014480: 6368 2e54 656e 736f 722c 2074 7570 6c65  ch.Tensor, tuple
+00014490: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+000144a0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+000144b0: 726e 2822 466f 7220 6261 636b 7761 7264  rn("For backward
+000144c0: 2068 6f6f 6b73 2074 6f20 6265 2063 616c   hooks to be cal
+000144d0: 6c65 642c 220d 0a20 2020 2020 2020 2020  led,"..         
+000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144f0: 2020 2020 2022 206d 6f64 756c 6520 6f75       " module ou
+00014500: 7470 7574 2073 686f 756c 6420 6265 2061  tput should be a
+00014510: 2054 656e 736f 7220 6f72 2061 2074 7570   Tensor or a tup
+00014520: 6c65 206f 6620 5465 6e73 6f72 7322 0d0a  le of Tensors"..
 00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014540: 2020 2066 2220 6275 7420 7265 6365 6976     f" but receiv
-00014550: 6564 207b 7479 7065 2872 6573 756c 7429  ed {type(result)
-00014560: 7d22 290d 0a20 2020 2020 2020 2020 2020  }")..           
-00014570: 2072 6573 756c 7420 3d20 6277 5f68 6f6f   result = bw_hoo
-00014580: 6b2e 7365 7475 705f 6f75 7470 7574 5f68  k.setup_output_h
-00014590: 6f6f 6b28 7265 7375 6c74 290d 0a0d 0a20  ook(result).... 
-000145a0: 2020 2020 2020 2023 2048 616e 646c 6520         # Handle 
-000145b0: 7468 6520 6e6f 6e2d 6675 6c6c 2062 6163  the non-full bac
-000145c0: 6b77 6172 6420 686f 6f6b 730d 0a20 2020  kward hooks..   
-000145d0: 2020 2020 2069 6620 6e6f 6e5f 6675 6c6c       if non_full
-000145e0: 5f62 6163 6b77 6172 645f 686f 6f6b 733a  _backward_hooks:
-000145f0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00014600: 7220 3d20 7265 7375 6c74 0d0a 2020 2020  r = result..    
-00014610: 2020 2020 2020 2020 7768 696c 6520 6e6f          while no
-00014620: 7420 6973 696e 7374 616e 6365 2876 6172  t isinstance(var
-00014630: 2c20 746f 7263 682e 5465 6e73 6f72 293a  , torch.Tensor):
-00014640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014650: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00014660: 7661 722c 2064 6963 7429 3a0d 0a20 2020  var, dict):..   
-00014670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014680: 2076 6172 203d 206e 6578 7428 2876 2066   var = next((v f
-00014690: 6f72 2076 2069 6e20 7661 722e 7661 6c75  or v in var.valu
-000146a0: 6573 2829 2069 6620 6973 696e 7374 616e  es() if isinstan
-000146b0: 6365 2876 2c20 746f 7263 682e 5465 6e73  ce(v, torch.Tens
-000146c0: 6f72 2929 290d 0a20 2020 2020 2020 2020  or)))..         
-000146d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146f0: 2020 7661 7220 3d20 7661 725b 305d 0d0a    var = var[0]..
-00014700: 2020 2020 2020 2020 2020 2020 6772 6164              grad
-00014710: 5f66 6e20 3d20 7661 722e 6772 6164 5f66  _fn = var.grad_f
-00014720: 6e0d 0a20 2020 2020 2020 2020 2020 2069  n..            i
-00014730: 6620 6772 6164 5f66 6e20 6973 206e 6f74  f grad_fn is not
-00014740: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00014750: 2020 2020 2020 2020 666f 7220 686f 6f6b          for hook
-00014760: 2069 6e20 6e6f 6e5f 6675 6c6c 5f62 6163   in non_full_bac
-00014770: 6b77 6172 645f 686f 6f6b 733a 0d0a 2020  kward_hooks:..  
-00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014790: 2020 6772 6164 5f66 6e2e 7265 6769 7374    grad_fn.regist
-000147a0: 6572 5f68 6f6f 6b28 5f57 7261 7070 6564  er_hook(_Wrapped
-000147b0: 486f 6f6b 2868 6f6f 6b2c 2073 656c 6629  Hook(hook, self)
-000147c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000147d0: 2020 2073 656c 662e 5f6d 6179 6265 5f77     self._maybe_w
-000147e0: 6172 6e5f 6e6f 6e5f 6675 6c6c 5f62 6163  arn_non_full_bac
-000147f0: 6b77 6172 645f 686f 6f6b 2861 7267 732c  kward_hook(args,
-00014800: 2072 6573 756c 742c 2067 7261 645f 666e   result, grad_fn
-00014810: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-00014820: 6973 5f61 6c6c 5f6e 756d 7079 203d 3d20  is_all_numpy == 
-00014830: 5472 7565 2061 6e64 2073 656c 662e 7472  True and self.tr
-00014840: 6169 6e69 6e67 203d 3d20 4661 6c73 6520  aining == False 
-00014850: 616e 6420 7365 6c66 2e69 735f 726f 6f74  and self.is_root
-00014860: 203d 3d20 5472 7565 3a0d 0a20 2020 2020   == True:..     
-00014870: 2020 2020 2020 2069 6620 6973 5f74 656e         if is_ten
-00014880: 736f 7228 7265 7375 6c74 293a 0d0a 2020  sor(result):..  
-00014890: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000148a0: 7475 726e 2074 6f5f 6e75 6d70 7928 7265  turn to_numpy(re
-000148b0: 7375 6c74 290d 0a20 2020 2020 2020 2020  sult)..         
-000148c0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000148d0: 6365 2872 6573 756c 742c 2028 6c69 7374  ce(result, (list
-000148e0: 2c20 7475 706c 6529 293a 0d0a 2020 2020  , tuple)):..    
-000148f0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00014900: 6c74 203d 206c 6973 7428 7265 7375 6c74  lt = list(result
-00014910: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00014920: 2020 2072 6574 7572 6e20 7475 706c 6528     return tuple(
-00014930: 5b74 6f5f 6e75 6d70 7928 7265 7329 2069  [to_numpy(res) i
-00014940: 6620 6973 5f74 656e 736f 7228 7265 7329  f is_tensor(res)
-00014950: 2065 6c73 6520 7265 7320 666f 7220 7265   else res for re
-00014960: 7320 696e 2072 6573 756c 745d 290d 0a20  s in result]).. 
-00014970: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00014980: 7375 6c74 0d0a 0d0a 2020 2020 5f5f 6361  sult....    __ca
-00014990: 6c6c 5f5f 3a20 4361 6c6c 6162 6c65 5b2e  ll__: Callable[.
-000149a0: 2e2e 2c20 416e 795d 203d 205f 6361 6c6c  .., Any] = _call
-000149b0: 5f69 6d70 6c0d 0a0d 0a20 2020 2064 6566  _impl....    def
-000149c0: 205f 5f67 6574 6174 7472 5f5f 2873 656c   __getattr__(sel
-000149d0: 662c 206e 616d 6529 3a0d 0a20 2020 2020  f, name):..     
-000149e0: 2020 2069 6620 275f 7061 7261 6d65 7465     if '_paramete
-000149f0: 7273 2720 696e 2073 656c 662e 5f5f 6469  rs' in self.__di
-00014a00: 6374 5f5f 3a0d 0a20 2020 2020 2020 2020  ct__:..         
-00014a10: 2020 205f 7061 7261 6d65 7465 7273 203d     _parameters =
-00014a20: 2073 656c 662e 5f5f 6469 6374 5f5f 5b27   self.__dict__['
-00014a30: 5f70 6172 616d 6574 6572 7327 5d0d 0a20  _parameters'].. 
-00014a40: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-00014a50: 6d65 2069 6e20 5f70 6172 616d 6574 6572  me in _parameter
-00014a60: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00014a70: 2020 2020 7265 7475 726e 205f 7061 7261      return _para
-00014a80: 6d65 7465 7273 5b6e 616d 655d 0d0a 2020  meters[name]..  
-00014a90: 2020 2020 2020 6966 2027 5f62 7566 6665        if '_buffe
-00014aa0: 7273 2720 696e 2073 656c 662e 5f5f 6469  rs' in self.__di
-00014ab0: 6374 5f5f 3a0d 0a20 2020 2020 2020 2020  ct__:..         
-00014ac0: 2020 205f 6275 6666 6572 7320 3d20 7365     _buffers = se
-00014ad0: 6c66 2e5f 5f64 6963 745f 5f5b 275f 6275  lf.__dict__['_bu
-00014ae0: 6666 6572 7327 5d0d 0a20 2020 2020 2020  ffers']..       
-00014af0: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
-00014b00: 5f62 7566 6665 7273 3a0d 0a20 2020 2020  _buffers:..     
-00014b10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014b20: 6e20 5f62 7566 6665 7273 5b6e 616d 655d  n _buffers[name]
-00014b30: 0d0a 2020 2020 2020 2020 6966 2027 5f6d  ..        if '_m
-00014b40: 6f64 756c 6573 2720 696e 2073 656c 662e  odules' in self.
-00014b50: 5f5f 6469 6374 5f5f 3a0d 0a20 2020 2020  __dict__:..     
-00014b60: 2020 2020 2020 206d 6f64 756c 6573 203d         modules =
-00014b70: 2073 656c 662e 5f5f 6469 6374 5f5f 5b27   self.__dict__['
-00014b80: 5f6d 6f64 756c 6573 275d 0d0a 2020 2020  _modules']..    
-00014b90: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00014ba0: 696e 206d 6f64 756c 6573 3a0d 0a20 2020  in modules:..   
-00014bb0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00014bc0: 7572 6e20 6d6f 6475 6c65 735b 6e61 6d65  urn modules[name
-00014bd0: 5d0d 0a20 2020 2020 2020 2069 6620 6e61  ]..        if na
-00014be0: 6d65 2069 6e20 7365 6c66 2e5f 5f64 6963  me in self.__dic
-00014bf0: 745f 5f3a 0d0a 2020 2020 2020 2020 2020  t__:..          
-00014c00: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
-00014c10: 6469 6374 5f5f 5b6e 616d 655d 0d0a 2020  dict__[name]..  
-00014c20: 2020 2020 2020 7261 6973 6520 4174 7472        raise Attr
-00014c30: 6962 7574 6545 7272 6f72 2822 277b 7d27  ibuteError("'{}'
-00014c40: 206f 626a 6563 7420 6861 7320 6e6f 2061   object has no a
-00014c50: 7474 7269 6275 7465 2027 7b7d 2722 2e66  ttribute '{}'".f
-00014c60: 6f72 6d61 7428 7479 7065 2873 656c 6629  ormat(type(self)
-00014c70: 2e5f 5f6e 616d 655f 5f2c 206e 616d 6529  .__name__, name)
-00014c80: 290d 0a0d 0a20 2020 2064 6566 205f 5f73  )....    def __s
-00014c90: 6574 6174 7472 5f5f 2873 656c 662c 206e  etattr__(self, n
-00014ca0: 616d 653a 2073 7472 2c20 7661 6c75 6529  ame: str, value)
-00014cb0: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
-00014cc0: 2020 2064 6566 2072 656d 6f76 655f 6672     def remove_fr
-00014cd0: 6f6d 282a 6469 6374 735f 6f72 5f73 6574  om(*dicts_or_set
-00014ce0: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-00014cf0: 2066 6f72 2064 2069 6e20 6469 6374 735f   for d in dicts_
-00014d00: 6f72 5f73 6574 733a 0d0a 2020 2020 2020  or_sets:..      
-00014d10: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00014d20: 6520 696e 2064 3a0d 0a20 2020 2020 2020  e in d:..       
-00014d30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014d40: 6973 696e 7374 616e 6365 2864 2c20 6469  isinstance(d, di
-00014d50: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
-00014d60: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00014d70: 6c20 645b 6e61 6d65 5d0d 0a20 2020 2020  l d[name]..     
-00014d80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00014d90: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00014da0: 2020 2020 2020 2020 2020 2020 2020 642e                d.
-00014db0: 6469 7363 6172 6428 6e61 6d65 290d 0a0d  discard(name)...
-00014dc0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00014dd0: 3d20 7365 6c66 2e5f 5f64 6963 745f 5f2e  = self.__dict__.
-00014de0: 6765 7428 275f 7061 7261 6d65 7465 7273  get('_parameters
-00014df0: 2729 0d0a 2020 2020 2020 2020 6966 2069  ')..        if i
-00014e00: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-00014e10: 2050 6172 616d 6574 6572 293a 0d0a 2020   Parameter):..  
-00014e20: 2020 2020 2020 2020 2020 6966 2070 6172            if par
-00014e30: 616d 7320 6973 204e 6f6e 653a 0d0a 2020  ams is None:..  
-00014e40: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00014e50: 6973 6520 4174 7472 6962 7574 6545 7272  ise AttributeErr
-00014e60: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
-00014e70: 2020 2020 2020 2020 2022 6361 6e6e 6f74           "cannot
-00014e80: 2061 7373 6967 6e20 7061 7261 6d65 7465   assign paramete
-00014e90: 7273 2062 6566 6f72 6520 4d6f 6475 6c65  rs before Module
-00014ea0: 2e5f 5f69 6e69 745f 5f28 2920 6361 6c6c  .__init__() call
-00014eb0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00014ec0: 7265 6d6f 7665 5f66 726f 6d28 7365 6c66  remove_from(self
-00014ed0: 2e5f 5f64 6963 745f 5f2c 2073 656c 662e  .__dict__, self.
-00014ee0: 5f62 7566 6665 7273 2c20 7365 6c66 2e5f  _buffers, self._
-00014ef0: 6d6f 6475 6c65 732c 2073 656c 662e 5f6e  modules, self._n
-00014f00: 6f6e 5f70 6572 7369 7374 656e 745f 6275  on_persistent_bu
-00014f10: 6666 6572 735f 7365 7429 0d0a 2020 2020  ffers_set)..    
-00014f20: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
-00014f30: 6973 7465 725f 7061 7261 6d65 7465 7228  ister_parameter(
-00014f40: 6e61 6d65 2c20 7661 6c75 6529 0d0a 2020  name, value)..  
-00014f50: 2020 2020 2020 656c 6966 2070 6172 616d        elif param
-00014f60: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
-00014f70: 6420 6e61 6d65 2069 6e20 7061 7261 6d73  d name in params
-00014f80: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00014f90: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
-00014fa0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00014fb0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00014fc0: 4572 726f 7228 2263 616e 6e6f 7420 6173  Error("cannot as
-00014fd0: 7369 676e 2027 7b7d 2720 6173 2070 6172  sign '{}' as par
-00014fe0: 616d 6574 6572 2027 7b7d 2720 220d 0a20  ameter '{}' ".. 
-00014ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015000: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00015010: 2874 6f72 6368 2e6e 6e2e 5061 7261 6d65  (torch.nn.Parame
-00015020: 7465 7220 6f72 204e 6f6e 6520 6578 7065  ter or None expe
-00015030: 6374 6564 2922 0d0a 2020 2020 2020 2020  cted)"..        
-00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015050: 2020 2020 2020 2020 2e66 6f72 6d61 7428          .format(
-00015060: 746f 7263 682e 7479 7065 6e61 6d65 2876  torch.typename(v
-00015070: 616c 7565 292c 206e 616d 6529 290d 0a20  alue), name)).. 
-00015080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015090: 7265 6769 7374 6572 5f70 6172 616d 6574  register_paramet
-000150a0: 6572 286e 616d 652c 2076 616c 7565 290d  er(name, value).
-000150b0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000150c0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-000150d0: 6c65 7320 3d20 7365 6c66 2e5f 5f64 6963  les = self.__dic
-000150e0: 745f 5f2e 6765 7428 275f 6d6f 6475 6c65  t__.get('_module
-000150f0: 7327 290d 0a20 2020 2020 2020 2020 2020  s')..           
-00015100: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
-00015110: 616c 7565 2c20 4c61 7965 7229 3a0d 0a20  alue, Layer):.. 
-00015120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015130: 6620 6d6f 6475 6c65 7320 6973 204e 6f6e  f modules is Non
-00015140: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00015150: 2020 2020 2020 2020 7261 6973 6520 4174          raise At
-00015160: 7472 6962 7574 6545 7272 6f72 280d 0a20  tributeError(.. 
-00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 2020 2020 2020 2022 6361 6e6e 6f74 2061         "cannot a
-00015190: 7373 6967 6e20 6d6f 6475 6c65 2062 6566  ssign module bef
-000151a0: 6f72 6520 4d6f 6475 6c65 2e5f 5f69 6e69  ore Module.__ini
-000151b0: 745f 5f28 2920 6361 6c6c 2229 0d0a 2020  t__() call")..  
-000151c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000151d0: 6d6f 7665 5f66 726f 6d28 7365 6c66 2e5f  move_from(self._
-000151e0: 5f64 6963 745f 5f2c 2073 656c 662e 5f70  _dict__, self._p
-000151f0: 6172 616d 6574 6572 732c 2073 656c 662e  arameters, self.
-00015200: 5f62 7566 6665 7273 2c20 7365 6c66 2e5f  _buffers, self._
-00015210: 6e6f 6e5f 7065 7273 6973 7465 6e74 5f62  non_persistent_b
-00015220: 7566 6665 7273 5f73 6574 290d 0a20 2020  uffers_set)..   
-00015230: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00015240: 756c 6573 5b6e 616d 655d 203d 2076 616c  ules[name] = val
-00015250: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00015260: 2020 2020 7661 6c75 652e 6973 5f72 6f6f      value.is_roo
-00015270: 7420 3d20 4661 6c73 650d 0a20 2020 2020  t = False..     
-00015280: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-00015290: 6f64 2069 6e20 7661 6c75 652e 6d6f 6475  od in value.modu
-000152a0: 6c65 7328 293a 0d0a 2020 2020 2020 2020  les():..        
-000152b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000152c0: 7369 6e73 7461 6e63 6528 6d6f 642c 204c  sinstance(mod, L
-000152d0: 6179 6572 2920 616e 6420 6d6f 642e 7575  ayer) and mod.uu
-000152e0: 6964 2021 3d20 7661 6c75 652e 7575 6964  id != value.uuid
-000152f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00015300: 2020 2020 2020 2020 2020 206d 6f64 2e69             mod.i
-00015310: 735f 726f 6f74 203d 2046 616c 7365 0d0a  s_root = False..
-00015320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015330: 7265 7365 745f 6e61 6d65 2876 616c 7565  reset_name(value
-00015340: 2c20 7365 6c66 2e5f 7569 645f 7072 6566  , self._uid_pref
-00015350: 6978 7329 0d0a 2020 2020 2020 2020 2020  ixs)..          
-00015360: 2020 2020 2020 7661 6c75 652e 7265 6c61        value.rela
-00015370: 7469 7665 5f6e 616d 6520 3d20 6e61 6d65  tive_name = name
-00015380: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00015390: 7661 6c75 652c 0d0a 2020 2020 2020 2020  value,..        
-000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00014550: 2062 7574 2072 6563 6569 7665 6420 7b74   but received {t
+00014560: 7970 6528 7265 7375 6c74 297d 2229 0d0a  ype(result)}")..
+00014570: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00014580: 6c74 203d 2062 775f 686f 6f6b 2e73 6574  lt = bw_hook.set
+00014590: 7570 5f6f 7574 7075 745f 686f 6f6b 2872  up_output_hook(r
+000145a0: 6573 756c 7429 0d0a 0d0a 2020 2020 2020  esult)....      
+000145b0: 2020 2320 4861 6e64 6c65 2074 6865 206e    # Handle the n
+000145c0: 6f6e 2d66 756c 6c20 6261 636b 7761 7264  on-full backward
+000145d0: 2068 6f6f 6b73 0d0a 2020 2020 2020 2020   hooks..        
+000145e0: 6966 206e 6f6e 5f66 756c 6c5f 6261 636b  if non_full_back
+000145f0: 7761 7264 5f68 6f6f 6b73 3a0d 0a20 2020  ward_hooks:..   
+00014600: 2020 2020 2020 2020 2076 6172 203d 2072           var = r
+00014610: 6573 756c 740d 0a20 2020 2020 2020 2020  esult..         
+00014620: 2020 2077 6869 6c65 206e 6f74 2069 7369     while not isi
+00014630: 6e73 7461 6e63 6528 7661 722c 2074 6f72  nstance(var, tor
+00014640: 6368 2e54 656e 736f 7229 3a0d 0a20 2020  ch.Tensor):..   
+00014650: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014660: 6973 696e 7374 616e 6365 2876 6172 2c20  isinstance(var, 
+00014670: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
+00014680: 2020 2020 2020 2020 2020 2020 7661 7220              var 
+00014690: 3d20 6e65 7874 2828 7620 666f 7220 7620  = next((v for v 
+000146a0: 696e 2076 6172 2e76 616c 7565 7328 2920  in var.values() 
+000146b0: 6966 2069 7369 6e73 7461 6e63 6528 762c  if isinstance(v,
+000146c0: 2074 6f72 6368 2e54 656e 736f 7229 2929   torch.Tensor)))
+000146d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000146e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000146f0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00014700: 203d 2076 6172 5b30 5d0d 0a20 2020 2020   = var[0]..     
+00014710: 2020 2020 2020 2067 7261 645f 666e 203d         grad_fn =
+00014720: 2076 6172 2e67 7261 645f 666e 0d0a 2020   var.grad_fn..  
+00014730: 2020 2020 2020 2020 2020 6966 2067 7261            if gra
+00014740: 645f 666e 2069 7320 6e6f 7420 4e6f 6e65  d_fn is not None
+00014750: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00014760: 2020 2066 6f72 2068 6f6f 6b20 696e 206e     for hook in n
+00014770: 6f6e 5f66 756c 6c5f 6261 636b 7761 7264  on_full_backward
+00014780: 5f68 6f6f 6b73 3a0d 0a20 2020 2020 2020  _hooks:..       
+00014790: 2020 2020 2020 2020 2020 2020 2067 7261               gra
+000147a0: 645f 666e 2e72 6567 6973 7465 725f 686f  d_fn.register_ho
+000147b0: 6f6b 285f 5772 6170 7065 6448 6f6f 6b28  ok(_WrappedHook(
+000147c0: 686f 6f6b 2c20 7365 6c66 2929 0d0a 2020  hook, self))..  
+000147d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000147e0: 6c66 2e5f 6d61 7962 655f 7761 726e 5f6e  lf._maybe_warn_n
+000147f0: 6f6e 5f66 756c 6c5f 6261 636b 7761 7264  on_full_backward
+00014800: 5f68 6f6f 6b28 6172 6773 2c20 7265 7375  _hook(args, resu
+00014810: 6c74 2c20 6772 6164 5f66 6e29 0d0a 0d0a  lt, grad_fn)....
+00014820: 2020 2020 2020 2020 6966 2069 735f 616c          if is_al
+00014830: 6c5f 6e75 6d70 7920 3d3d 2054 7275 6520  l_numpy == True 
+00014840: 616e 6420 7365 6c66 2e74 7261 696e 696e  and self.trainin
+00014850: 6720 3d3d 2046 616c 7365 2061 6e64 2073  g == False and s
+00014860: 656c 662e 6973 5f72 6f6f 7420 3d3d 2054  elf.is_root == T
+00014870: 7275 653a 0d0a 2020 2020 2020 2020 2020  rue:..          
+00014880: 2020 6966 2069 735f 7465 6e73 6f72 2872    if is_tensor(r
+00014890: 6573 756c 7429 3a0d 0a20 2020 2020 2020  esult):..       
+000148a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000148b0: 746f 5f6e 756d 7079 2872 6573 756c 7429  to_numpy(result)
+000148c0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000148d0: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
+000148e0: 7375 6c74 2c20 286c 6973 742c 2074 7570  sult, (list, tup
+000148f0: 6c65 2929 3a0d 0a20 2020 2020 2020 2020  le)):..         
+00014900: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00014910: 6c69 7374 2872 6573 756c 7429 0d0a 2020  list(result)..  
+00014920: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00014930: 7475 726e 2074 7570 6c65 285b 746f 5f6e  turn tuple([to_n
+00014940: 756d 7079 2872 6573 2920 6966 2069 735f  umpy(res) if is_
+00014950: 7465 6e73 6f72 2872 6573 2920 656c 7365  tensor(res) else
+00014960: 2072 6573 2066 6f72 2072 6573 2069 6e20   res for res in 
+00014970: 7265 7375 6c74 5d29 0d0a 2020 2020 2020  result])..      
+00014980: 2020 7265 7475 726e 2072 6573 756c 740d    return result.
+00014990: 0a0d 0a20 2020 205f 5f63 616c 6c5f 5f3a  ...    __call__:
+000149a0: 2043 616c 6c61 626c 655b 2e2e 2e2c 2041   Callable[..., A
+000149b0: 6e79 5d20 3d20 5f63 616c 6c5f 696d 706c  ny] = _call_impl
+000149c0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6765  ....    def __ge
+000149d0: 7461 7474 725f 5f28 7365 6c66 2c20 6e61  tattr__(self, na
+000149e0: 6d65 293a 0d0a 2020 2020 2020 2020 6966  me):..        if
+000149f0: 2027 5f70 6172 616d 6574 6572 7327 2069   '_parameters' i
+00014a00: 6e20 7365 6c66 2e5f 5f64 6963 745f 5f3a  n self.__dict__:
+00014a10: 0d0a 2020 2020 2020 2020 2020 2020 5f70  ..            _p
+00014a20: 6172 616d 6574 6572 7320 3d20 7365 6c66  arameters = self
+00014a30: 2e5f 5f64 6963 745f 5f5b 275f 7061 7261  .__dict__['_para
+00014a40: 6d65 7465 7273 275d 0d0a 2020 2020 2020  meters']..      
+00014a50: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+00014a60: 205f 7061 7261 6d65 7465 7273 3a0d 0a20   _parameters:.. 
+00014a70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014a80: 6574 7572 6e20 5f70 6172 616d 6574 6572  eturn _parameter
+00014a90: 735b 6e61 6d65 5d0d 0a20 2020 2020 2020  s[name]..       
+00014aa0: 2069 6620 275f 6275 6666 6572 7327 2069   if '_buffers' i
+00014ab0: 6e20 7365 6c66 2e5f 5f64 6963 745f 5f3a  n self.__dict__:
+00014ac0: 0d0a 2020 2020 2020 2020 2020 2020 5f62  ..            _b
+00014ad0: 7566 6665 7273 203d 2073 656c 662e 5f5f  uffers = self.__
+00014ae0: 6469 6374 5f5f 5b27 5f62 7566 6665 7273  dict__['_buffers
+00014af0: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
+00014b00: 6966 206e 616d 6520 696e 205f 6275 6666  if name in _buff
+00014b10: 6572 733a 0d0a 2020 2020 2020 2020 2020  ers:..          
+00014b20: 2020 2020 2020 7265 7475 726e 205f 6275        return _bu
+00014b30: 6666 6572 735b 6e61 6d65 5d0d 0a20 2020  ffers[name]..   
+00014b40: 2020 2020 2069 6620 275f 6d6f 6475 6c65       if '_module
+00014b50: 7327 2069 6e20 7365 6c66 2e5f 5f64 6963  s' in self.__dic
+00014b60: 745f 5f3a 0d0a 2020 2020 2020 2020 2020  t__:..          
+00014b70: 2020 6d6f 6475 6c65 7320 3d20 7365 6c66    modules = self
+00014b80: 2e5f 5f64 6963 745f 5f5b 275f 6d6f 6475  .__dict__['_modu
+00014b90: 6c65 7327 5d0d 0a20 2020 2020 2020 2020  les']..         
+00014ba0: 2020 2069 6620 6e61 6d65 2069 6e20 6d6f     if name in mo
+00014bb0: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+00014bc0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00014bd0: 6f64 756c 6573 5b6e 616d 655d 0d0a 2020  odules[name]..  
+00014be0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+00014bf0: 2073 656c 662e 5f5f 6469 6374 5f5f 3a0d   self.__dict__:.
+00014c00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014c10: 7572 6e20 7365 6c66 2e5f 5f64 6963 745f  urn self.__dict_
+00014c20: 5f5b 6e61 6d65 5d0d 0a20 2020 2020 2020  _[name]..       
+00014c30: 2072 6169 7365 2041 7474 7269 6275 7465   raise Attribute
+00014c40: 4572 726f 7228 2227 7b7d 2720 6f62 6a65  Error("'{}' obje
+00014c50: 6374 2068 6173 206e 6f20 6174 7472 6962  ct has no attrib
+00014c60: 7574 6520 277b 7d27 222e 666f 726d 6174  ute '{}'".format
+00014c70: 2874 7970 6528 7365 6c66 292e 5f5f 6e61  (type(self).__na
+00014c80: 6d65 5f5f 2c20 6e61 6d65 2929 0d0a 0d0a  me__, name))....
+00014c90: 2020 2020 6465 6620 5f5f 7365 7461 7474      def __setatt
+00014ca0: 725f 5f28 7365 6c66 2c20 6e61 6d65 3a20  r__(self, name: 
+00014cb0: 7374 722c 2076 616c 7565 2920 2d3e 204e  str, value) -> N
+00014cc0: 6f6e 653a 0d0a 2020 2020 2020 2020 6465  one:..        de
+00014cd0: 6620 7265 6d6f 7665 5f66 726f 6d28 2a64  f remove_from(*d
+00014ce0: 6963 7473 5f6f 725f 7365 7473 293a 0d0a  icts_or_sets):..
+00014cf0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00014d00: 6420 696e 2064 6963 7473 5f6f 725f 7365  d in dicts_or_se
+00014d10: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+00014d20: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
+00014d30: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00014d40: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00014d50: 7461 6e63 6528 642c 2064 6963 7429 3a0d  tance(d, dict):.
+00014d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014d70: 2020 2020 2020 2020 2064 656c 2064 5b6e           del d[n
+00014d80: 616d 655d 0d0a 2020 2020 2020 2020 2020  ame]..          
+00014d90: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00014da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014db0: 2020 2020 2020 2020 2064 2e64 6973 6361           d.disca
+00014dc0: 7264 286e 616d 6529 0d0a 0d0a 2020 2020  rd(name)....    
+00014dd0: 2020 2020 7061 7261 6d73 203d 2073 656c      params = sel
+00014de0: 662e 5f5f 6469 6374 5f5f 2e67 6574 2827  f.__dict__.get('
+00014df0: 5f70 6172 616d 6574 6572 7327 290d 0a20  _parameters').. 
+00014e00: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00014e10: 616e 6365 2876 616c 7565 2c20 5061 7261  ance(value, Para
+00014e20: 6d65 7465 7229 3a0d 0a20 2020 2020 2020  meter):..       
+00014e30: 2020 2020 2069 6620 7061 7261 6d73 2069       if params i
+00014e40: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00014e50: 2020 2020 2020 2020 2072 6169 7365 2041           raise A
+00014e60: 7474 7269 6275 7465 4572 726f 7228 0d0a  ttributeError(..
+00014e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e80: 2020 2020 2263 616e 6e6f 7420 6173 7369      "cannot assi
+00014e90: 676e 2070 6172 616d 6574 6572 7320 6265  gn parameters be
+00014ea0: 666f 7265 204d 6f64 756c 652e 5f5f 696e  fore Module.__in
+00014eb0: 6974 5f5f 2829 2063 616c 6c22 290d 0a20  it__() call").. 
+00014ec0: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00014ed0: 655f 6672 6f6d 2873 656c 662e 5f5f 6469  e_from(self.__di
+00014ee0: 6374 5f5f 2c20 7365 6c66 2e5f 6275 6666  ct__, self._buff
+00014ef0: 6572 732c 2073 656c 662e 5f6d 6f64 756c  ers, self._modul
+00014f00: 6573 2c20 7365 6c66 2e5f 6e6f 6e5f 7065  es, self._non_pe
+00014f10: 7273 6973 7465 6e74 5f62 7566 6665 7273  rsistent_buffers
+00014f20: 5f73 6574 290d 0a20 2020 2020 2020 2020  _set)..         
+00014f30: 2020 2073 656c 662e 7265 6769 7374 6572     self.register
+00014f40: 5f70 6172 616d 6574 6572 286e 616d 652c  _parameter(name,
+00014f50: 2076 616c 7565 290d 0a20 2020 2020 2020   value)..       
+00014f60: 2065 6c69 6620 7061 7261 6d73 2069 7320   elif params is 
+00014f70: 6e6f 7420 4e6f 6e65 2061 6e64 206e 616d  not None and nam
+00014f80: 6520 696e 2070 6172 616d 733a 0d0a 2020  e in params:..  
+00014f90: 2020 2020 2020 2020 2020 6966 2076 616c            if val
+00014fa0: 7565 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ue is not None:.
+00014fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fc0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00014fd0: 2822 6361 6e6e 6f74 2061 7373 6967 6e20  ("cannot assign 
+00014fe0: 277b 7d27 2061 7320 7061 7261 6d65 7465  '{}' as paramete
+00014ff0: 7220 277b 7d27 2022 0d0a 2020 2020 2020  r '{}' "..      
+00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015010: 2020 2020 2020 2020 2020 2228 746f 7263            "(torc
+00015020: 682e 6e6e 2e50 6172 616d 6574 6572 206f  h.nn.Parameter o
+00015030: 7220 4e6f 6e65 2065 7870 6563 7465 6429  r None expected)
+00015040: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015060: 2020 202e 666f 726d 6174 2874 6f72 6368     .format(torch
+00015070: 2e74 7970 656e 616d 6528 7661 6c75 6529  .typename(value)
+00015080: 2c20 6e61 6d65 2929 0d0a 2020 2020 2020  , name))..      
+00015090: 2020 2020 2020 7365 6c66 2e72 6567 6973        self.regis
+000150a0: 7465 725f 7061 7261 6d65 7465 7228 6e61  ter_parameter(na
+000150b0: 6d65 2c20 7661 6c75 6529 0d0a 2020 2020  me, value)..    
+000150c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000150d0: 2020 2020 2020 206d 6f64 756c 6573 203d         modules =
+000150e0: 2073 656c 662e 5f5f 6469 6374 5f5f 2e67   self.__dict__.g
+000150f0: 6574 2827 5f6d 6f64 756c 6573 2729 0d0a  et('_modules')..
+00015100: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00015110: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
+00015120: 204c 6179 6572 293a 0d0a 2020 2020 2020   Layer):..      
+00015130: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
+00015140: 756c 6573 2069 7320 4e6f 6e65 3a0d 0a20  ules is None:.. 
+00015150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015160: 2020 2072 6169 7365 2041 7474 7269 6275     raise Attribu
+00015170: 7465 4572 726f 7228 0d0a 2020 2020 2020  teError(..      
+00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015190: 2020 2263 616e 6e6f 7420 6173 7369 676e    "cannot assign
+000151a0: 206d 6f64 756c 6520 6265 666f 7265 204d   module before M
+000151b0: 6f64 756c 652e 5f5f 696e 6974 5f5f 2829  odule.__init__()
+000151c0: 2063 616c 6c22 290d 0a20 2020 2020 2020   call")..       
+000151d0: 2020 2020 2020 2020 2072 656d 6f76 655f           remove_
+000151e0: 6672 6f6d 2873 656c 662e 5f5f 6469 6374  from(self.__dict
+000151f0: 5f5f 2c20 7365 6c66 2e5f 7061 7261 6d65  __, self._parame
+00015200: 7465 7273 2c20 7365 6c66 2e5f 6275 6666  ters, self._buff
+00015210: 6572 732c 2073 656c 662e 5f6e 6f6e 5f70  ers, self._non_p
+00015220: 6572 7369 7374 656e 745f 6275 6666 6572  ersistent_buffer
+00015230: 735f 7365 7429 0d0a 2020 2020 2020 2020  s_set)..        
+00015240: 2020 2020 2020 2020 6d6f 6475 6c65 735b          modules[
+00015250: 6e61 6d65 5d20 3d20 7661 6c75 650d 0a20  name] = value.. 
+00015260: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00015270: 616c 7565 2e69 735f 726f 6f74 203d 2046  alue.is_root = F
+00015280: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00015290: 2020 2020 2020 666f 7220 6d6f 6420 696e        for mod in
+000152a0: 2076 616c 7565 2e6d 6f64 756c 6573 2829   value.modules()
+000152b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000152c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000152d0: 616e 6365 286d 6f64 2c20 4c61 7965 7229  ance(mod, Layer)
+000152e0: 2061 6e64 206d 6f64 2e75 7569 6420 213d   and mod.uuid !=
+000152f0: 2076 616c 7565 2e75 7569 643a 0d0a 2020   value.uuid:..  
+00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015310: 2020 2020 2020 6d6f 642e 6973 5f72 6f6f        mod.is_roo
+00015320: 7420 3d20 4661 6c73 650d 0a20 2020 2020  t = False..     
+00015330: 2020 2020 2020 2020 2020 2072 6573 6574             reset
+00015340: 5f6e 616d 6528 7661 6c75 652c 2073 656c  _name(value, sel
+00015350: 662e 5f75 6964 5f70 7265 6669 7873 290d  f._uid_prefixs).
+00015360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015370: 2076 616c 7565 2e72 656c 6174 6976 655f   value.relative_
+00015380: 6e61 6d65 203d 206e 616d 6520 6966 206e  name = name if n
+00015390: 6f74 2068 6173 6174 7472 2876 616c 7565  ot hasattr(value
+000153a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153d0: 2020 2772 656c 6174 6976 655f 6e61 6d65    'relative_name
-000153e0: 2729 206f 7220 7661 6c75 652e 7265 6c61  ') or value.rela
-000153f0: 7469 7665 5f6e 616d 6520 3d3d 2027 2720  tive_name == '' 
-00015400: 656c 7365 206e 616d 6520 2b20 272e 2720  else name + '.' 
-00015410: 2b20 7661 6c75 652e 7265 6c61 7469 7665  + value.relative
-00015420: 5f6e 616d 650d 0a20 2020 2020 2020 2020  _name..         
-00015430: 2020 2065 6c69 6620 6d6f 6475 6c65 7320     elif modules 
-00015440: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00015450: 6e61 6d65 2069 6e20 6d6f 6475 6c65 733a  name in modules:
-00015460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015470: 2020 6966 2076 616c 7565 2069 7320 6e6f    if value is no
-00015480: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00015490: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000154a0: 7365 2054 7970 6545 7272 6f72 2822 6361  se TypeError("ca
-000154b0: 6e6e 6f74 2061 7373 6967 6e20 277b 7d27  nnot assign '{}'
-000154c0: 2061 7320 6368 696c 6420 6d6f 6475 6c65   as child module
-000154d0: 2027 7b7d 2720 220d 0a20 2020 2020 2020   '{}' "..       
-000154e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154f0: 2020 2020 2020 2020 2020 2020 2022 2874               "(t
-00015500: 6f72 6368 2e6e 6e2e 4d6f 6475 6c65 206f  orch.nn.Module o
-00015510: 7220 4e6f 6e65 2065 7870 6563 7465 6429  r None expected)
-00015520: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+000153d0: 2020 2020 2020 2020 2020 2020 2027 7265               're
+000153e0: 6c61 7469 7665 5f6e 616d 6527 2920 6f72  lative_name') or
+000153f0: 2076 616c 7565 2e72 656c 6174 6976 655f   value.relative_
+00015400: 6e61 6d65 203d 3d20 2727 2065 6c73 6520  name == '' else 
+00015410: 6e61 6d65 202b 2027 2e27 202b 2076 616c  name + '.' + val
+00015420: 7565 2e72 656c 6174 6976 655f 6e61 6d65  ue.relative_name
+00015430: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00015440: 6966 206d 6f64 756c 6573 2069 7320 6e6f  if modules is no
+00015450: 7420 4e6f 6e65 2061 6e64 206e 616d 6520  t None and name 
+00015460: 696e 206d 6f64 756c 6573 3a0d 0a20 2020  in modules:..   
+00015470: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015480: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
+00015490: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000154a0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+000154b0: 7065 4572 726f 7228 2263 616e 6e6f 7420  peError("cannot 
+000154c0: 6173 7369 676e 2027 7b7d 2720 6173 2063  assign '{}' as c
+000154d0: 6869 6c64 206d 6f64 756c 6520 277b 7d27  hild module '{}'
+000154e0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015500: 2020 2020 2020 2020 2228 746f 7263 682e          "(torch.
+00015510: 6e6e 2e4d 6f64 756c 6520 6f72 204e 6f6e  nn.Module or Non
+00015520: 6520 6578 7065 6374 6564 2922 0d0a 2020  e expected)"..  
 00015530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015540: 2020 2020 2020 202e 666f 726d 6174 2874         .format(t
-00015550: 6f72 6368 2e74 7970 656e 616d 6528 7661  orch.typename(va
-00015560: 6c75 6529 2c20 6e61 6d65 2929 0d0a 2020  lue), name))..  
-00015570: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00015580: 6475 6c65 735b 6e61 6d65 5d20 3d20 7661  dules[name] = va
-00015590: 6c75 650d 0a20 2020 2020 2020 2020 2020  lue..           
-000155a0: 2020 2020 2076 616c 7565 2e69 735f 726f       value.is_ro
-000155b0: 6f74 203d 2046 616c 7365 0d0a 2020 2020  ot = False..    
-000155c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000155d0: 6d6f 6420 696e 2076 616c 7565 2e6d 6f64  mod in value.mod
-000155e0: 756c 6573 2829 3a0d 0a20 2020 2020 2020  ules():..       
-000155f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015600: 6973 696e 7374 616e 6365 286d 6f64 2c20  isinstance(mod, 
-00015610: 4c61 7965 7229 2061 6e64 206d 6f64 2e75  Layer) and mod.u
-00015620: 7569 6420 213d 2076 616c 7565 2e75 7569  uid != value.uui
-00015630: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00015640: 2020 2020 2020 2020 2020 2020 6d6f 642e              mod.
-00015650: 6973 5f72 6f6f 7420 3d20 4661 6c73 650d  is_root = False.
-00015660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015670: 2072 6573 6574 5f6e 616d 6528 7661 6c75   reset_name(valu
-00015680: 652c 2073 656c 662e 5f75 6964 5f70 7265  e, self._uid_pre
-00015690: 6669 7873 290d 0a20 2020 2020 2020 2020  fixs)..         
-000156a0: 2020 2020 2020 2076 616c 7565 2e72 656c         value.rel
-000156b0: 6174 6976 655f 6e61 6d65 203d 206e 616d  ative_name = nam
-000156c0: 6520 6966 206e 6f74 2068 6173 6174 7472  e if not hasattr
-000156d0: 2876 616c 7565 2c0d 0a20 2020 2020 2020  (value,..       
-000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015550: 2020 2e66 6f72 6d61 7428 746f 7263 682e    .format(torch.
+00015560: 7479 7065 6e61 6d65 2876 616c 7565 292c  typename(value),
+00015570: 206e 616d 6529 290d 0a20 2020 2020 2020   name))..       
+00015580: 2020 2020 2020 2020 206d 6f64 756c 6573           modules
+00015590: 5b6e 616d 655d 203d 2076 616c 7565 0d0a  [name] = value..
+000155a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155b0: 7661 6c75 652e 6973 5f72 6f6f 7420 3d20  value.is_root = 
+000155c0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+000155d0: 2020 2020 2020 2066 6f72 206d 6f64 2069         for mod i
+000155e0: 6e20 7661 6c75 652e 6d6f 6475 6c65 7328  n value.modules(
+000155f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00015600: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00015610: 7461 6e63 6528 6d6f 642c 204c 6179 6572  tance(mod, Layer
+00015620: 2920 616e 6420 6d6f 642e 7575 6964 2021  ) and mod.uuid !
+00015630: 3d20 7661 6c75 652e 7575 6964 3a0d 0a20  = value.uuid:.. 
+00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015650: 2020 2020 2020 206d 6f64 2e69 735f 726f         mod.is_ro
+00015660: 6f74 203d 2046 616c 7365 0d0a 2020 2020  ot = False..    
+00015670: 2020 2020 2020 2020 2020 2020 7265 7365              rese
+00015680: 745f 6e61 6d65 2876 616c 7565 2c20 7365  t_name(value, se
+00015690: 6c66 2e5f 7569 645f 7072 6566 6978 7329  lf._uid_prefixs)
+000156a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000156b0: 2020 7661 6c75 652e 7265 6c61 7469 7665    value.relative
+000156c0: 5f6e 616d 6520 3d20 6e61 6d65 2069 6620  _name = name if 
+000156d0: 6e6f 7420 6861 7361 7474 7228 7661 6c75  not hasattr(valu
+000156e0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
 000156f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015710: 2020 2027 7265 6c61 7469 7665 5f6e 616d     'relative_nam
-00015720: 6527 2920 6f72 2076 616c 7565 2e72 656c  e') or value.rel
-00015730: 6174 6976 655f 6e61 6d65 203d 3d20 2727  ative_name == ''
-00015740: 2065 6c73 6520 6e61 6d65 202b 2027 2e27   else name + '.'
-00015750: 202b 2076 616c 7565 2e72 656c 6174 6976   + value.relativ
-00015760: 655f 6e61 6d65 0d0a 2020 2020 2020 2020  e_name..        
-00015770: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00015780: 2020 2020 2020 2020 2020 2062 7566 6665             buffe
-00015790: 7273 203d 2073 656c 662e 5f5f 6469 6374  rs = self.__dict
-000157a0: 5f5f 2e67 6574 2827 5f62 7566 6665 7273  __.get('_buffers
-000157b0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-000157c0: 2020 2020 6966 2062 7566 6665 7273 2069      if buffers i
-000157d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206e  s not None and n
-000157e0: 616d 6520 696e 2062 7566 6665 7273 3a0d  ame in buffers:.
-000157f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015800: 2020 2020 2069 6620 7661 6c75 6520 6973       if value is
-00015810: 206e 6f74 204e 6f6e 6520 616e 6420 6e6f   not None and no
-00015820: 7420 6973 696e 7374 616e 6365 2876 616c  t isinstance(val
-00015830: 7565 2c20 746f 7263 682e 5465 6e73 6f72  ue, torch.Tensor
-00015840: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00015850: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00015860: 6520 5479 7065 4572 726f 7228 2263 616e  e TypeError("can
-00015870: 6e6f 7420 6173 7369 676e 2027 7b7d 2720  not assign '{}' 
-00015880: 6173 2062 7566 6665 7220 277b 7d27 2022  as buffer '{}' "
-00015890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015710: 2020 2020 2020 2020 2020 2020 2020 2772                'r
+00015720: 656c 6174 6976 655f 6e61 6d65 2729 206f  elative_name') o
+00015730: 7220 7661 6c75 652e 7265 6c61 7469 7665  r value.relative
+00015740: 5f6e 616d 6520 3d3d 2027 2720 656c 7365  _name == '' else
+00015750: 206e 616d 6520 2b20 272e 2720 2b20 7661   name + '.' + va
+00015760: 6c75 652e 7265 6c61 7469 7665 5f6e 616d  lue.relative_nam
+00015770: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+00015780: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00015790: 2020 2020 2020 6275 6666 6572 7320 3d20        buffers = 
+000157a0: 7365 6c66 2e5f 5f64 6963 745f 5f2e 6765  self.__dict__.ge
+000157b0: 7428 275f 6275 6666 6572 7327 290d 0a20  t('_buffers').. 
+000157c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000157d0: 6620 6275 6666 6572 7320 6973 206e 6f74  f buffers is not
+000157e0: 204e 6f6e 6520 616e 6420 6e61 6d65 2069   None and name i
+000157f0: 6e20 6275 6666 6572 733a 0d0a 2020 2020  n buffers:..    
+00015800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015810: 6966 2076 616c 7565 2069 7320 6e6f 7420  if value is not 
+00015820: 4e6f 6e65 2061 6e64 206e 6f74 2069 7369  None and not isi
+00015830: 6e73 7461 6e63 6528 7661 6c75 652c 2074  nstance(value, t
+00015840: 6f72 6368 2e54 656e 736f 7229 3a0d 0a20  orch.Tensor):.. 
+00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015860: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00015870: 6545 7272 6f72 2822 6361 6e6e 6f74 2061  eError("cannot a
+00015880: 7373 6967 6e20 277b 7d27 2061 7320 6275  ssign '{}' as bu
+00015890: 6666 6572 2027 7b7d 2720 220d 0a20 2020  ffer '{}' "..   
 000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158b0: 2020 2020 2020 2020 2020 2228 746f 7263            "(torc
-000158c0: 682e 5465 6e73 6f72 206f 7220 4e6f 6e65  h.Tensor or None
-000158d0: 2065 7870 6563 7465 6429 220d 0a20 2020   expected)"..   
-000158e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158c0: 2020 2020 2022 2874 6f72 6368 2e54 656e       "(torch.Ten
+000158d0: 736f 7220 6f72 204e 6f6e 6520 6578 7065  sor or None expe
+000158e0: 6374 6564 2922 0d0a 2020 2020 2020 2020  cted)"..        
 000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015900: 2020 2020 202e 666f 726d 6174 2874 6f72       .format(tor
-00015910: 6368 2e74 7970 656e 616d 6528 7661 6c75  ch.typename(valu
-00015920: 6529 2c20 6e61 6d65 2929 0d0a 2020 2020  e), name))..    
-00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015940: 6275 6666 6572 735b 6e61 6d65 5d20 3d20  buffers[name] = 
-00015950: 7661 6c75 650d 0a20 2020 2020 2020 2020  value..         
-00015960: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015980: 2020 6f62 6a65 6374 2e5f 5f73 6574 6174    object.__setat
-00015990: 7472 5f5f 2873 656c 662c 206e 616d 652c  tr__(self, name,
-000159a0: 2076 616c 7565 290d 0a0d 0a20 2020 2064   value)....    d
-000159b0: 6566 205f 5f67 6574 7374 6174 655f 5f28  ef __getstate__(
-000159c0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000159d0: 2320 4f76 6572 7269 6465 2074 6f20 7375  # Override to su
-000159e0: 7070 6f72 7420 6063 6f70 792e 6465 6570  pport `copy.deep
-000159f0: 636f 7079 6020 616e 6420 7069 636b 6c69  copy` and pickli
-00015a00: 6e67 2e0d 0a20 2020 2020 2020 2023 2054  ng...        # T
-00015a10: 6872 6561 642d 6c6f 6361 6c20 6f62 6a65  hread-local obje
-00015a20: 6374 7320 6361 6e6e 6f74 2062 6520 636f  cts cannot be co
-00015a30: 7069 6564 2069 6e20 5079 7468 6f6e 2033  pied in Python 3
-00015a40: 2c20 736f 2070 6f70 2074 6865 7365 2e0d  , so pop these..
-00015a50: 0a20 2020 2020 2020 2023 2073 6f20 7368  .        # so sh
-00015a60: 6f75 6c64 6e27 7420 6265 2063 6f70 6965  ouldn't be copie
-00015a70: 642e 0d0a 2020 2020 2020 2020 7374 6174  d...        stat
-00015a80: 6520 3d20 7365 6c66 2e5f 5f64 6963 745f  e = self.__dict_
-00015a90: 5f2e 636f 7079 2829 0d0a 2020 2020 2020  _.copy()..      
-00015aa0: 2020 2320 7374 6174 652e 706f 7028 275f    # state.pop('_
-00015ab0: 7468 7265 6164 5f6c 6f63 616c 272c 204e  thread_local', N
-00015ac0: 6f6e 6529 0d0a 2020 2020 2020 2020 2320  one)..        # 
-00015ad0: 7374 6174 652e 706f 7028 275f 6d65 7472  state.pop('_metr
-00015ae0: 6963 735f 6c6f 636b 272c 204e 6f6e 6529  ics_lock', None)
-00015af0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00015b00: 2073 7461 7465 0d0a 0d0a 2020 2020 6465   state....    de
-00015b10: 6620 5f5f 7365 7473 7461 7465 5f5f 2873  f __setstate__(s
-00015b20: 656c 662c 2073 7461 7465 293a 0d0a 2020  elf, state):..  
-00015b30: 2020 2020 2020 2320 7374 6174 655b 275f        # state['_
-00015b40: 7468 7265 6164 5f6c 6f63 616c 275d 203d  thread_local'] =
-00015b50: 2074 6872 6561 6469 6e67 2e6c 6f63 616c   threading.local
-00015b60: 2829 0d0a 2020 2020 2020 2020 2320 7374  ()..        # st
-00015b70: 6174 655b 275f 6d65 7472 6963 735f 6c6f  ate['_metrics_lo
-00015b80: 636b 275d 203d 2074 6872 6561 6469 6e67  ck'] = threading
-00015b90: 2e4c 6f63 6b28 290d 0a20 2020 2020 2020  .Lock()..       
-00015ba0: 2023 2042 7970 6173 7320 5472 6163 6b61   # Bypass Tracka
-00015bb0: 626c 6520 6c6f 6769 6320 6173 2060 5f5f  ble logic as `__
-00015bc0: 6469 6374 5f5f 6020 616c 7265 6164 7920  dict__` already 
-00015bd0: 636f 6e74 6169 6e73 2074 6869 7320 696e  contains this in
-00015be0: 666f 2e0d 0a20 2020 2020 2020 206f 626a  fo...        obj
-00015bf0: 6563 742e 5f5f 7365 7461 7474 725f 5f28  ect.__setattr__(
-00015c00: 7365 6c66 2c20 275f 5f64 6963 745f 5f27  self, '__dict__'
-00015c10: 2c20 7374 6174 6529 0d0a 0d0a 2020 2020  , state)....    
-00015c20: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-00015c30: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00015c40: 7572 6e20 7375 7065 7228 292e 5f5f 7265  urn super().__re
-00015c50: 7072 5f5f 2829 0d0a 0d0a 0d0a 0d0a 0d0a  pr__()..........
-00015c60: 0d0a 636c 6173 7320 5365 7175 656e 7469  ..class Sequenti
-00015c70: 616c 284c 6179 6572 293a 0d0a 2020 2020  al(Layer):..    
-00015c80: 2222 2241 2073 6571 7565 6e74 6961 6c20  """A sequential 
-00015c90: 636f 6e74 6169 6e65 722e 0d0a 2020 2020  container...    
-00015ca0: 4d6f 6475 6c65 7320 7769 6c6c 2062 6520  Modules will be 
-00015cb0: 6164 6465 6420 746f 2069 7420 696e 2074  added to it in t
-00015cc0: 6865 206f 7264 6572 2074 6865 7920 6172  he order they ar
-00015cd0: 6520 7061 7373 6564 2069 6e20 7468 6520  e passed in the 
-00015ce0: 636f 6e73 7472 7563 746f 722e 0d0a 2020  constructor...  
-00015cf0: 2020 416c 7465 726e 6174 6976 656c 792c    Alternatively,
-00015d00: 2061 6e20 6f72 6465 7265 6420 6469 6374   an ordered dict
-00015d10: 206f 6620 6d6f 6475 6c65 7320 6361 6e20   of modules can 
-00015d20: 616c 736f 2062 6520 7061 7373 6564 2069  also be passed i
-00015d30: 6e2e 0d0a 0d0a 2020 2020 546f 206d 616b  n.....    To mak
-00015d40: 6520 6974 2065 6173 6965 7220 746f 2075  e it easier to u
-00015d50: 6e64 6572 7374 616e 642c 2068 6572 6520  nderstand, here 
-00015d60: 6973 2061 2073 6d61 6c6c 2065 7861 6d70  is a small examp
-00015d70: 6c65 3a3a 0d0a 0d0a 2020 2020 2020 2020  le::....        
-00015d80: 2320 4578 616d 706c 6520 6f66 2075 7369  # Example of usi
-00015d90: 6e67 2053 6571 7565 6e74 6961 6c0d 0a20  ng Sequential.. 
-00015da0: 2020 2020 2020 206d 6f64 656c 203d 206e         model = n
-00015db0: 6e2e 5365 7175 656e 7469 616c 280d 0a20  n.Sequential(.. 
-00015dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015dd0: 206e 6e2e 436f 6e76 3264 2831 2c32 302c   nn.Conv2d(1,20,
-00015de0: 3529 2c0d 0a20 2020 2020 2020 2020 2020  5),..           
-00015df0: 2020 2020 2020 206e 6e2e 5265 4c55 2829         nn.ReLU()
-00015e00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00015e10: 2020 2020 206e 6e2e 436f 6e76 3264 2832       nn.Conv2d(2
-00015e20: 302c 3634 2c35 292c 0d0a 2020 2020 2020  0,64,5),..      
-00015e30: 2020 2020 2020 2020 2020 2020 6e6e 2e52              nn.R
-00015e40: 654c 5528 290d 0a20 2020 2020 2020 2020  eLU()..         
-00015e50: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-00015e60: 2020 2020 2320 4578 616d 706c 6520 6f66      # Example of
-00015e70: 2075 7369 6e67 2053 6571 7565 6e74 6961   using Sequentia
-00015e80: 6c20 7769 7468 204f 7264 6572 6564 4469  l with OrderedDi
-00015e90: 6374 0d0a 2020 2020 2020 2020 6d6f 6465  ct..        mode
-00015ea0: 6c20 3d20 6e6e 2e53 6571 7565 6e74 6961  l = nn.Sequentia
-00015eb0: 6c28 4f72 6465 7265 6444 6963 7428 5b0d  l(OrderedDict([.
-00015ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ed0: 2020 2028 2763 6f6e 7631 272c 206e 6e2e     ('conv1', nn.
-00015ee0: 436f 6e76 3264 2831 2c32 302c 3529 292c  Conv2d(1,20,5)),
-00015ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015f00: 2020 2020 2827 7265 6c75 3127 2c20 6e6e      ('relu1', nn
-00015f10: 2e52 654c 5528 2929 2c0d 0a20 2020 2020  .ReLU()),..     
-00015f20: 2020 2020 2020 2020 2020 2020 2028 2763               ('c
-00015f30: 6f6e 7632 272c 206e 6e2e 436f 6e76 3264  onv2', nn.Conv2d
-00015f40: 2832 302c 3634 2c35 2929 2c0d 0a20 2020  (20,64,5)),..   
-00015f50: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00015f60: 2772 656c 7532 272c 206e 6e2e 5265 4c55  'relu2', nn.ReLU
-00015f70: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-00015f80: 2020 2020 205d 2929 0d0a 2020 2020 2222       ]))..    ""
-00015f90: 220d 0a0d 0a20 2020 205f 6d6f 6475 6c65  "....    _module
-00015fa0: 733a 2044 6963 745b 7374 722c 206e 6e2e  s: Dict[str, nn.
-00015fb0: 4d6f 6475 6c65 5d20 2023 2074 7970 653a  Module]  # type:
-00015fc0: 2069 676e 6f72 655b 6173 7369 676e 6d65   ignore[assignme
-00015fd0: 6e74 5d0d 0a0d 0a20 2020 2040 6f76 6572  nt]....    @over
-00015fe0: 6c6f 6164 0d0a 2020 2020 6465 6620 5f5f  load..    def __
-00015ff0: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
-00016000: 6773 3a20 6e6e 2e4d 6f64 756c 6529 202d  gs: nn.Module) -
-00016010: 3e20 4e6f 6e65 3a0d 0a20 2020 2020 2020  > None:..       
-00016020: 202e 2e2e 0d0a 0d0a 2020 2020 406f 7665   .......    @ove
-00016030: 726c 6f61 640d 0a20 2020 2064 6566 205f  rload..    def _
-00016040: 5f69 6e69 745f 5f28 7365 6c66 2c20 6172  _init__(self, ar
-00016050: 673a 2044 6963 745b 7374 722c 206e 6e2e  g: Dict[str, nn.
-00016060: 4d6f 6475 6c65 5d29 202d 3e20 4e6f 6e65  Module]) -> None
-00016070: 3a0d 0a20 2020 2020 2020 202e 2e2e 0d0a  :..        .....
-00016080: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00016090: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
-000160a0: 6e61 6d65 3d4e 6f6e 652c 206b 6565 705f  name=None, keep_
-000160b0: 6f75 7470 7574 3d46 616c 7365 293a 0d0a  output=False):..
-000160c0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-000160d0: 5f5f 7365 7461 7474 725f 5f28 275f 6d6f  __setattr__('_mo
-000160e0: 6475 6c65 7327 2c20 4f72 6465 7265 6444  dules', OrderedD
-000160f0: 6963 7428 2929 0d0a 2020 2020 2020 2020  ict())..        
-00016100: 7375 7065 7228 5365 7175 656e 7469 616c  super(Sequential
-00016110: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-00016120: 286e 616d 653d 6e61 6d65 2c6b 6565 705f  (name=name,keep_
-00016130: 6f75 7470 7574 3d6b 6565 705f 6f75 7470  output=keep_outp
-00016140: 7574 290d 0a20 2020 2020 2020 2073 656c  ut)..        sel
-00016150: 662e 5f6e 616d 6520 3d20 6e61 6d65 0d0a  f._name = name..
-00016160: 2020 2020 2020 2020 7365 6c66 2e5f 6275          self._bu
-00016170: 696c 7420 3d20 4661 6c73 650d 0a20 2020  ilt = False..   
-00016180: 2020 2020 2073 656c 662e 7575 6964 203d       self.uuid =
-00016190: 2075 7569 642e 7575 6964 3428 292e 6e6f   uuid.uuid4().no
-000161a0: 6465 0d0a 0d0a 2020 2020 2020 2020 6172  de....        ar
-000161b0: 6773 203d 2075 6e70 6163 6b5f 7369 6e67  gs = unpack_sing
-000161c0: 6c65 746f 6e28 6172 6773 290d 0a0d 0a20  leton(args).... 
-000161d0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000161e0: 616e 6365 2861 7267 732c 204f 7264 6572  ance(args, Order
-000161f0: 6564 4469 6374 293a 0d0a 2020 2020 2020  edDict):..      
-00016200: 2020 2020 2020 666f 7220 6b65 792c 206d        for key, m
-00016210: 6f64 756c 6520 696e 2061 7267 732e 6974  odule in args.it
-00016220: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00016230: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00016240: 5f6d 6f64 756c 6528 6b65 792c 206d 6f64  _module(key, mod
-00016250: 756c 6529 0d0a 2020 2020 2020 2020 656c  ule)..        el
-00016260: 6966 206c 656e 2861 7267 7329 3d3d 3120  if len(args)==1 
-00016270: 616e 6420 6973 696e 7374 616e 6365 2861  and isinstance(a
-00016280: 7267 732c 204f 7264 6572 6564 4469 6374  rgs, OrderedDict
-00016290: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000162a0: 666f 7220 6b65 792c 206d 6f64 756c 6520  for key, module 
-000162b0: 696e 2061 7267 735b 305d 2e69 7465 6d73  in args[0].items
-000162c0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-000162d0: 2020 2020 2073 656c 662e 6164 645f 6d6f       self.add_mo
-000162e0: 6475 6c65 286b 6579 2c20 6d6f 6475 6c65  dule(key, module
-000162f0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00016300: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00016310: 7220 6964 782c 206d 6f64 756c 6520 696e  r idx, module in
-00016320: 2065 6e75 6d65 7261 7465 2861 7267 7329   enumerate(args)
-00016330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00016340: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
-00016350: 6c65 2873 7472 2869 6478 292c 206d 6f64  le(str(idx), mod
-00016360: 756c 6529 0d0a 0d0a 0d0a 0d0a 0d0a 0d0a  ule)............
-00016370: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-00016380: 6428 7365 6c66 2c20 696e 7075 745f 7368  d(self, input_sh
-00016390: 6170 653a 2054 656e 736f 7253 6861 7065  ape: TensorShape
-000163a0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-000163b0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-000163c0: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-000163d0: 7075 745f 7368 6170 6520 2874 6f72 6368  put_shape (torch
-000163e0: 2e53 697a 652c 2074 656e 736f 722c 206c  .Size, tensor, l
-000163f0: 6973 7428 696e 7429 2c20 7475 706c 6528  ist(int), tuple(
-00016400: 696e 7429 293a 2054 6865 2069 6e70 7574  int)): The input
-00016410: 5f73 6861 7065 2069 6e66 6f72 6d61 7469  _shape informati
-00016420: 6f6e 2c20 6e6f 7420 696e 636c 7564 696e  on, not includin
-00016430: 6720 6261 7463 6820 6178 6973 2e0d 0a0d  g batch axis....
-00016440: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00016450: 3a0d 0a0d 0a20 2020 2020 2020 2022 2222  :....        """
-00016460: 0d0a 2020 2020 2020 2020 2320 6966 2073  ..        # if s
-00016470: 656c 662e 5f62 7569 6c74 203d 3d20 4661  elf._built == Fa
-00016480: 6c73 6520 616e 6420 6c65 6e28 7365 6c66  lse and len(self
-00016490: 2e5f 6d6f 6475 6c65 7329 203e 2030 3a0d  ._modules) > 0:.
-000164a0: 0a20 2020 2020 2020 2023 2020 2020 2073  .        #     s
-000164b0: 656c 662e 5f5f 6765 7469 7465 6d5f 5f28  elf.__getitem__(
-000164c0: 3029 2e69 6e70 7574 5f73 6861 7065 203d  0).input_shape =
-000164d0: 2069 6e70 7574 5f73 6861 7065 0d0a 2020   input_shape..  
-000164e0: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
-000164f0: 2e5f 6275 696c 7420 3d20 5472 7565 0d0a  ._built = True..
-00016500: 0d0a 2020 2020 6465 6620 6164 645f 6d6f  ..    def add_mo
-00016510: 6475 6c65 2873 656c 662c 206e 616d 652c  dule(self, name,
-00016520: 206d 6f64 756c 6529 3a0d 0a20 2020 2020   module):..     
-00016530: 2020 2022 2222 4164 6473 2061 2063 6869     """Adds a chi
-00016540: 6c64 206d 6f64 756c 6520 746f 2074 6865  ld module to the
-00016550: 2063 7572 7265 6e74 206d 6f64 756c 652e   current module.
-00016560: 0d0a 0d0a 2020 2020 2020 2020 5468 6520  ....        The 
-00016570: 6d6f 6475 6c65 2063 616e 2062 6520 6163  module can be ac
-00016580: 6365 7373 6564 2061 7320 616e 2061 7474  cessed as an att
-00016590: 7269 6275 7465 2075 7369 6e67 2074 6865  ribute using the
-000165a0: 2067 6976 656e 206e 616d 652e 0d0a 0d0a   given name.....
-000165b0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
-000165c0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-000165d0: 2873 7472 696e 6729 3a20 6e61 6d65 206f  (string): name o
-000165e0: 6620 7468 6520 6368 696c 6420 6d6f 6475  f the child modu
-000165f0: 6c65 2e20 5468 6520 6368 696c 6420 6d6f  le. The child mo
-00016600: 6475 6c65 2063 616e 2062 650d 0a20 2020  dule can be..   
-00016610: 2020 2020 2020 2020 2020 2020 2061 6363               acc
-00016620: 6573 7365 6420 6672 6f6d 2074 6869 7320  essed from this 
-00016630: 6d6f 6475 6c65 2075 7369 6e67 2074 6865  module using the
-00016640: 2067 6976 656e 206e 616d 650d 0a20 2020   given name..   
-00016650: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
-00016660: 284d 6f64 756c 6529 3a20 6368 696c 6420  (Module): child 
-00016670: 6d6f 6475 6c65 2074 6f20 6265 2061 6464  module to be add
-00016680: 6564 2074 6f20 7468 6520 6d6f 6475 6c65  ed to the module
-00016690: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-000166a0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-000166b0: 2873 656c 662e 5f6d 6f64 756c 6573 2920  (self._modules) 
-000166c0: 3e20 3020 616e 6420 7365 6c66 2e5f 696e  > 0 and self._in
-000166d0: 7075 745f 7368 6170 6520 6973 206e 6f74  put_shape is not
-000166e0: 204e 6f6e 6520 616e 6420 7365 6c66 5b2d   None and self[-
-000166f0: 315d 2e62 7569 6c74 2061 6e64 2073 656c  1].built and sel
-00016700: 665b 2d31 5d2e 5f6f 7574 7075 745f 7368  f[-1]._output_sh
-00016710: 6170 6520 6973 206e 6f74 204e 6f6e 653a  ape is not None:
-00016720: 0d0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-00016730: 7374 5f6f 7574 7075 7420 3d20 7365 6c66  st_output = self
-00016740: 5b2d 315d 2e5f 6f75 7470 7574 5f73 6861  [-1]._output_sha
-00016750: 7065 0d0a 2020 2020 2020 2020 2020 2020  pe..            
-00016760: 6475 6d6d 6179 5f69 6e70 7574 203d 2074  dummay_input = t
-00016770: 6f5f 7465 6e73 6f72 286c 6173 745f 6f75  o_tensor(last_ou
-00016780: 7470 7574 2e67 6574 5f64 756d 6d79 5f74  tput.get_dummy_t
-00016790: 656e 736f 7228 2929 2e74 6f28 7365 6c66  ensor()).to(self
-000167a0: 2e64 6576 6963 6529 0d0a 2020 2020 2020  .device)..      
-000167b0: 2020 2020 2020 6f75 7420 3d20 6d6f 6475        out = modu
-000167c0: 6c65 2864 756d 6d61 795f 696e 7075 7429  le(dummay_input)
-000167d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000167e0: 6c66 2e5f 6d6f 6475 6c65 735b 6e61 6d65  lf._modules[name
-000167f0: 5d20 3d20 6d6f 6475 6c65 0d0a 2020 2020  ] = module..    
-00016800: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00016810: 7461 6e63 6528 6f75 742c 204f 7264 6572  tance(out, Order
-00016820: 6564 4469 6374 293a 0d0a 0d0a 2020 2020  edDict):....    
-00016830: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016840: 2e5f 6f75 7470 7574 5f73 6861 7065 203d  ._output_shape =
-00016850: 2074 7570 6c65 280d 0a20 2020 2020 2020   tuple(..       
-00016860: 2020 2020 2020 2020 2020 2020 205b 7465               [te
-00016870: 6e73 6f72 5f74 6f5f 7368 6170 6528 6f2c  nsor_to_shape(o,
-00016880: 206e 6565 645f 6578 636c 7564 655f 6261   need_exclude_ba
-00016890: 7463 685f 6178 6973 3d54 7275 652c 2069  tch_axis=True, i
-000168a0: 735f 7369 6e67 6c65 746f 6e3d 4661 6c73  s_singleton=Fals
-000168b0: 6529 2066 6f72 206f 2069 6e20 6f75 742e  e) for o in out.
-000168c0: 7661 6c75 655f 6c69 7374 5d29 0d0a 2020  value_list])..  
-000168d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000168e0: 6c66 2e67 6574 5f72 6f6f 7428 292e 7369  lf.get_root().si
-000168f0: 676e 6174 7572 652e 6f75 7470 7574 7320  gnature.outputs 
-00016900: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
-00016910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016920: 2066 6f72 206b 2c20 7620 696e 206f 7574   for k, v in out
-00016930: 2e69 7465 6d5f 6c69 7374 3a0d 0a20 2020  .item_list:..   
-00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016950: 2073 656c 662e 6765 745f 726f 6f74 2829   self.get_root()
-00016960: 2e73 6967 6e61 7475 7265 2e6f 7574 7075  .signature.outpu
-00016970: 7473 5b6b 5d20 3d20 7465 6e73 6f72 5f74  ts[k] = tensor_t
-00016980: 6f5f 7368 6170 6528 762c 206e 6565 645f  o_shape(v, need_
-00016990: 6578 636c 7564 655f 6261 7463 685f 6178  exclude_batch_ax
-000169a0: 6973 3d54 7275 652c 0d0a 2020 2020 2020  is=True,..      
+00015900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015910: 2e66 6f72 6d61 7428 746f 7263 682e 7479  .format(torch.ty
+00015920: 7065 6e61 6d65 2876 616c 7565 292c 206e  pename(value), n
+00015930: 616d 6529 290d 0a20 2020 2020 2020 2020  ame))..         
+00015940: 2020 2020 2020 2020 2020 2062 7566 6665             buffe
+00015950: 7273 5b6e 616d 655d 203d 2076 616c 7565  rs[name] = value
+00015960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015970: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00015980: 2020 2020 2020 2020 2020 2020 206f 626a               obj
+00015990: 6563 742e 5f5f 7365 7461 7474 725f 5f28  ect.__setattr__(
+000159a0: 7365 6c66 2c20 6e61 6d65 2c20 7661 6c75  self, name, valu
+000159b0: 6529 0d0a 0d0a 2020 2020 6465 6620 5f5f  e)....    def __
+000159c0: 6765 7473 7461 7465 5f5f 2873 656c 6629  getstate__(self)
+000159d0: 3a0d 0a20 2020 2020 2020 2023 204f 7665  :..        # Ove
+000159e0: 7272 6964 6520 746f 2073 7570 706f 7274  rride to support
+000159f0: 2060 636f 7079 2e64 6565 7063 6f70 7960   `copy.deepcopy`
+00015a00: 2061 6e64 2070 6963 6b6c 696e 672e 0d0a   and pickling...
+00015a10: 2020 2020 2020 2020 2320 5468 7265 6164          # Thread
+00015a20: 2d6c 6f63 616c 206f 626a 6563 7473 2063  -local objects c
+00015a30: 616e 6e6f 7420 6265 2063 6f70 6965 6420  annot be copied 
+00015a40: 696e 2050 7974 686f 6e20 332c 2073 6f20  in Python 3, so 
+00015a50: 706f 7020 7468 6573 652e 0d0a 2020 2020  pop these...    
+00015a60: 2020 2020 2320 736f 2073 686f 756c 646e      # so shouldn
+00015a70: 2774 2062 6520 636f 7069 6564 2e0d 0a20  't be copied... 
+00015a80: 2020 2020 2020 2073 7461 7465 203d 2073         state = s
+00015a90: 656c 662e 5f5f 6469 6374 5f5f 2e63 6f70  elf.__dict__.cop
+00015aa0: 7928 290d 0a20 2020 2020 2020 2023 2073  y()..        # s
+00015ab0: 7461 7465 2e70 6f70 2827 5f74 6872 6561  tate.pop('_threa
+00015ac0: 645f 6c6f 6361 6c27 2c20 4e6f 6e65 290d  d_local', None).
+00015ad0: 0a20 2020 2020 2020 2023 2073 7461 7465  .        # state
+00015ae0: 2e70 6f70 2827 5f6d 6574 7269 6373 5f6c  .pop('_metrics_l
+00015af0: 6f63 6b27 2c20 4e6f 6e65 290d 0a20 2020  ock', None)..   
+00015b00: 2020 2020 2072 6574 7572 6e20 7374 6174       return stat
+00015b10: 650d 0a0d 0a20 2020 2064 6566 205f 5f73  e....    def __s
+00015b20: 6574 7374 6174 655f 5f28 7365 6c66 2c20  etstate__(self, 
+00015b30: 7374 6174 6529 3a0d 0a20 2020 2020 2020  state):..       
+00015b40: 2023 2073 7461 7465 5b27 5f74 6872 6561   # state['_threa
+00015b50: 645f 6c6f 6361 6c27 5d20 3d20 7468 7265  d_local'] = thre
+00015b60: 6164 696e 672e 6c6f 6361 6c28 290d 0a20  ading.local().. 
+00015b70: 2020 2020 2020 2023 2073 7461 7465 5b27         # state['
+00015b80: 5f6d 6574 7269 6373 5f6c 6f63 6b27 5d20  _metrics_lock'] 
+00015b90: 3d20 7468 7265 6164 696e 672e 4c6f 636b  = threading.Lock
+00015ba0: 2829 0d0a 2020 2020 2020 2020 2320 4279  ()..        # By
+00015bb0: 7061 7373 2054 7261 636b 6162 6c65 206c  pass Trackable l
+00015bc0: 6f67 6963 2061 7320 605f 5f64 6963 745f  ogic as `__dict_
+00015bd0: 5f60 2061 6c72 6561 6479 2063 6f6e 7461  _` already conta
+00015be0: 696e 7320 7468 6973 2069 6e66 6f2e 0d0a  ins this info...
+00015bf0: 2020 2020 2020 2020 6f62 6a65 6374 2e5f          object._
+00015c00: 5f73 6574 6174 7472 5f5f 2873 656c 662c  _setattr__(self,
+00015c10: 2027 5f5f 6469 6374 5f5f 272c 2073 7461   '__dict__', sta
+00015c20: 7465 290d 0a0d 0a20 2020 2064 6566 205f  te)....    def _
+00015c30: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
+00015c40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00015c50: 7570 6572 2829 2e5f 5f72 6570 725f 5f28  uper().__repr__(
+00015c60: 290d 0a0d 0a0d 0a0d 0a0d 0a0d 0a63 6c61  )............cla
+00015c70: 7373 2053 6571 7565 6e74 6961 6c28 4c61  ss Sequential(La
+00015c80: 7965 7229 3a0d 0a20 2020 2022 2222 4120  yer):..    """A 
+00015c90: 7365 7175 656e 7469 616c 2063 6f6e 7461  sequential conta
+00015ca0: 696e 6572 2e0d 0a20 2020 204d 6f64 756c  iner...    Modul
+00015cb0: 6573 2077 696c 6c20 6265 2061 6464 6564  es will be added
+00015cc0: 2074 6f20 6974 2069 6e20 7468 6520 6f72   to it in the or
+00015cd0: 6465 7220 7468 6579 2061 7265 2070 6173  der they are pas
+00015ce0: 7365 6420 696e 2074 6865 2063 6f6e 7374  sed in the const
+00015cf0: 7275 6374 6f72 2e0d 0a20 2020 2041 6c74  ructor...    Alt
+00015d00: 6572 6e61 7469 7665 6c79 2c20 616e 206f  ernatively, an o
+00015d10: 7264 6572 6564 2064 6963 7420 6f66 206d  rdered dict of m
+00015d20: 6f64 756c 6573 2063 616e 2061 6c73 6f20  odules can also 
+00015d30: 6265 2070 6173 7365 6420 696e 2e0d 0a0d  be passed in....
+00015d40: 0a20 2020 2054 6f20 6d61 6b65 2069 7420  .    To make it 
+00015d50: 6561 7369 6572 2074 6f20 756e 6465 7273  easier to unders
+00015d60: 7461 6e64 2c20 6865 7265 2069 7320 6120  tand, here is a 
+00015d70: 736d 616c 6c20 6578 616d 706c 653a 3a0d  small example::.
+00015d80: 0a0d 0a20 2020 2020 2020 2023 2045 7861  ...        # Exa
+00015d90: 6d70 6c65 206f 6620 7573 696e 6720 5365  mple of using Se
+00015da0: 7175 656e 7469 616c 0d0a 2020 2020 2020  quential..      
+00015db0: 2020 6d6f 6465 6c20 3d20 6e6e 2e53 6571    model = nn.Seq
+00015dc0: 7565 6e74 6961 6c28 0d0a 2020 2020 2020  uential(..      
+00015dd0: 2020 2020 2020 2020 2020 2020 6e6e 2e43              nn.C
+00015de0: 6f6e 7632 6428 312c 3230 2c35 292c 0d0a  onv2d(1,20,5),..
+00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e00: 2020 6e6e 2e52 654c 5528 292c 0d0a 2020    nn.ReLU(),..  
+00015e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e20: 6e6e 2e43 6f6e 7632 6428 3230 2c36 342c  nn.Conv2d(20,64,
+00015e30: 3529 2c0d 0a20 2020 2020 2020 2020 2020  5),..           
+00015e40: 2020 2020 2020 206e 6e2e 5265 4c55 2829         nn.ReLU()
+00015e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015e60: 2020 290d 0a0d 0a20 2020 2020 2020 2023    )....        #
+00015e70: 2045 7861 6d70 6c65 206f 6620 7573 696e   Example of usin
+00015e80: 6720 5365 7175 656e 7469 616c 2077 6974  g Sequential wit
+00015e90: 6820 4f72 6465 7265 6444 6963 740d 0a20  h OrderedDict.. 
+00015ea0: 2020 2020 2020 206d 6f64 656c 203d 206e         model = n
+00015eb0: 6e2e 5365 7175 656e 7469 616c 284f 7264  n.Sequential(Ord
+00015ec0: 6572 6564 4469 6374 285b 0d0a 2020 2020  eredDict([..    
+00015ed0: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+00015ee0: 636f 6e76 3127 2c20 6e6e 2e43 6f6e 7632  conv1', nn.Conv2
+00015ef0: 6428 312c 3230 2c35 2929 2c0d 0a20 2020  d(1,20,5)),..   
+00015f00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00015f10: 2772 656c 7531 272c 206e 6e2e 5265 4c55  'relu1', nn.ReLU
+00015f20: 2829 292c 0d0a 2020 2020 2020 2020 2020  ()),..          
+00015f30: 2020 2020 2020 2020 2827 636f 6e76 3227          ('conv2'
+00015f40: 2c20 6e6e 2e43 6f6e 7632 6428 3230 2c36  , nn.Conv2d(20,6
+00015f50: 342c 3529 292c 0d0a 2020 2020 2020 2020  4,5)),..        
+00015f60: 2020 2020 2020 2020 2020 2827 7265 6c75            ('relu
+00015f70: 3227 2c20 6e6e 2e52 654c 5528 2929 0d0a  2', nn.ReLU())..
+00015f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f90: 5d29 290d 0a20 2020 2022 2222 0d0a 0d0a  ]))..    """....
+00015fa0: 2020 2020 5f6d 6f64 756c 6573 3a20 4469      _modules: Di
+00015fb0: 6374 5b73 7472 2c20 6e6e 2e4d 6f64 756c  ct[str, nn.Modul
+00015fc0: 655d 2020 2320 7479 7065 3a20 6967 6e6f  e]  # type: igno
+00015fd0: 7265 5b61 7373 6967 6e6d 656e 745d 0d0a  re[assignment]..
+00015fe0: 0d0a 2020 2020 406f 7665 726c 6f61 640d  ..    @overload.
+00015ff0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00016000: 5f28 7365 6c66 2c20 2a61 7267 733a 206e  _(self, *args: n
+00016010: 6e2e 4d6f 6475 6c65 2920 2d3e 204e 6f6e  n.Module) -> Non
+00016020: 653a 0d0a 2020 2020 2020 2020 2e2e 2e0d  e:..        ....
+00016030: 0a0d 0a20 2020 2040 6f76 6572 6c6f 6164  ...    @overload
+00016040: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00016050: 5f5f 2873 656c 662c 2061 7267 3a20 4469  __(self, arg: Di
+00016060: 6374 5b73 7472 2c20 6e6e 2e4d 6f64 756c  ct[str, nn.Modul
+00016070: 655d 2920 2d3e 204e 6f6e 653a 0d0a 2020  e]) -> None:..  
+00016080: 2020 2020 2020 2e2e 2e0d 0a0d 0a20 2020        .......   
+00016090: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+000160a0: 6c66 2c20 2a61 7267 732c 206e 616d 653d  lf, *args, name=
+000160b0: 4e6f 6e65 2c20 6b65 6570 5f6f 7574 7075  None, keep_outpu
+000160c0: 743d 4661 6c73 6529 3a0d 0a20 2020 2020  t=False):..     
+000160d0: 2020 2073 7570 6572 2829 2e5f 5f73 6574     super().__set
+000160e0: 6174 7472 5f5f 2827 5f6d 6f64 756c 6573  attr__('_modules
+000160f0: 272c 204f 7264 6572 6564 4469 6374 2829  ', OrderedDict()
+00016100: 290d 0a20 2020 2020 2020 2073 7570 6572  )..        super
+00016110: 2853 6571 7565 6e74 6961 6c2c 2073 656c  (Sequential, sel
+00016120: 6629 2e5f 5f69 6e69 745f 5f28 6e61 6d65  f).__init__(name
+00016130: 3d6e 616d 652c 6b65 6570 5f6f 7574 7075  =name,keep_outpu
+00016140: 743d 6b65 6570 5f6f 7574 7075 7429 0d0a  t=keep_output)..
+00016150: 2020 2020 2020 2020 7365 6c66 2e5f 6e61          self._na
+00016160: 6d65 203d 206e 616d 650d 0a20 2020 2020  me = name..     
+00016170: 2020 2073 656c 662e 5f62 7569 6c74 203d     self._built =
+00016180: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00016190: 7365 6c66 2e75 7569 6420 3d20 7575 6964  self.uuid = uuid
+000161a0: 2e75 7569 6434 2829 2e6e 6f64 650d 0a0d  .uuid4().node...
+000161b0: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
+000161c0: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
+000161d0: 2861 7267 7329 0d0a 0d0a 2020 2020 2020  (args)....      
+000161e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000161f0: 6172 6773 2c20 4f72 6465 7265 6444 6963  args, OrderedDic
+00016200: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00016210: 2066 6f72 206b 6579 2c20 6d6f 6475 6c65   for key, module
+00016220: 2069 6e20 6172 6773 2e69 7465 6d73 2829   in args.items()
+00016230: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00016240: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
+00016250: 6c65 286b 6579 2c20 6d6f 6475 6c65 290d  le(key, module).
+00016260: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
+00016270: 6e28 6172 6773 293d 3d31 2061 6e64 2069  n(args)==1 and i
+00016280: 7369 6e73 7461 6e63 6528 6172 6773 2c20  sinstance(args, 
+00016290: 4f72 6465 7265 6444 6963 7429 3a0d 0a20  OrderedDict):.. 
+000162a0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+000162b0: 6579 2c20 6d6f 6475 6c65 2069 6e20 6172  ey, module in ar
+000162c0: 6773 5b30 5d2e 6974 656d 7328 293a 0d0a  gs[0].items():..
+000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162e0: 7365 6c66 2e61 6464 5f6d 6f64 756c 6528  self.add_module(
+000162f0: 6b65 792c 206d 6f64 756c 6529 0d0a 2020  key, module)..  
+00016300: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00016310: 2020 2020 2020 2020 2066 6f72 2069 6478           for idx
+00016320: 2c20 6d6f 6475 6c65 2069 6e20 656e 756d  , module in enum
+00016330: 6572 6174 6528 6172 6773 293a 0d0a 2020  erate(args):..  
+00016340: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00016350: 6c66 2e61 6464 5f6d 6f64 756c 6528 7374  lf.add_module(st
+00016360: 7228 6964 7829 2c20 6d6f 6475 6c65 290d  r(idx), module).
+00016370: 0a0d 0a0d 0a0d 0a0d 0a20 2020 2064 6566  .........    def
+00016380: 2062 7569 6c64 2873 656c 662c 2069 6e70   build(self, inp
+00016390: 7574 5f73 6861 7065 3a20 5465 6e73 6f72  ut_shape: Tensor
+000163a0: 5368 6170 6529 3a0d 0a20 2020 2020 2020  Shape):..       
+000163b0: 2022 2222 0d0a 0d0a 2020 2020 2020 2020   """....        
+000163c0: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+000163d0: 2020 2069 6e70 7574 5f73 6861 7065 2028     input_shape (
+000163e0: 746f 7263 682e 5369 7a65 2c20 7465 6e73  torch.Size, tens
+000163f0: 6f72 2c20 6c69 7374 2869 6e74 292c 2074  or, list(int), t
+00016400: 7570 6c65 2869 6e74 2929 3a20 5468 6520  uple(int)): The 
+00016410: 696e 7075 745f 7368 6170 6520 696e 666f  input_shape info
+00016420: 726d 6174 696f 6e2c 206e 6f74 2069 6e63  rmation, not inc
+00016430: 6c75 6469 6e67 2062 6174 6368 2061 7869  luding batch axi
+00016440: 732e 0d0a 0d0a 2020 2020 2020 2020 5265  s.....        Re
+00016450: 7475 726e 733a 0d0a 0d0a 2020 2020 2020  turns:....      
+00016460: 2020 2222 220d 0a20 2020 2020 2020 2023    """..        #
+00016470: 2069 6620 7365 6c66 2e5f 6275 696c 7420   if self._built 
+00016480: 3d3d 2046 616c 7365 2061 6e64 206c 656e  == False and len
+00016490: 2873 656c 662e 5f6d 6f64 756c 6573 2920  (self._modules) 
+000164a0: 3e20 303a 0d0a 2020 2020 2020 2020 2320  > 0:..        # 
+000164b0: 2020 2020 7365 6c66 2e5f 5f67 6574 6974      self.__getit
+000164c0: 656d 5f5f 2830 292e 696e 7075 745f 7368  em__(0).input_sh
+000164d0: 6170 6520 3d20 696e 7075 745f 7368 6170  ape = input_shap
+000164e0: 650d 0a20 2020 2020 2020 2023 2020 2020  e..        #    
+000164f0: 2073 656c 662e 5f62 7569 6c74 203d 2054   self._built = T
+00016500: 7275 650d 0a0d 0a20 2020 2064 6566 2061  rue....    def a
+00016510: 6464 5f6d 6f64 756c 6528 7365 6c66 2c20  dd_module(self, 
+00016520: 6e61 6d65 2c20 6d6f 6475 6c65 293a 0d0a  name, module):..
+00016530: 2020 2020 2020 2020 2222 2241 6464 7320          """Adds 
+00016540: 6120 6368 696c 6420 6d6f 6475 6c65 2074  a child module t
+00016550: 6f20 7468 6520 6375 7272 656e 7420 6d6f  o the current mo
+00016560: 6475 6c65 2e0d 0a0d 0a20 2020 2020 2020  dule.....       
+00016570: 2054 6865 206d 6f64 756c 6520 6361 6e20   The module can 
+00016580: 6265 2061 6363 6573 7365 6420 6173 2061  be accessed as a
+00016590: 6e20 6174 7472 6962 7574 6520 7573 696e  n attribute usin
+000165a0: 6720 7468 6520 6769 7665 6e20 6e61 6d65  g the given name
+000165b0: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+000165c0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000165d0: 6e61 6d65 2028 7374 7269 6e67 293a 206e  name (string): n
+000165e0: 616d 6520 6f66 2074 6865 2063 6869 6c64  ame of the child
+000165f0: 206d 6f64 756c 652e 2054 6865 2063 6869   module. The chi
+00016600: 6c64 206d 6f64 756c 6520 6361 6e20 6265  ld module can be
+00016610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016620: 2020 6163 6365 7373 6564 2066 726f 6d20    accessed from 
+00016630: 7468 6973 206d 6f64 756c 6520 7573 696e  this module usin
+00016640: 6720 7468 6520 6769 7665 6e20 6e61 6d65  g the given name
+00016650: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00016660: 6475 6c65 2028 4d6f 6475 6c65 293a 2063  dule (Module): c
+00016670: 6869 6c64 206d 6f64 756c 6520 746f 2062  hild module to b
+00016680: 6520 6164 6465 6420 746f 2074 6865 206d  e added to the m
+00016690: 6f64 756c 652e 0d0a 2020 2020 2020 2020  odule...        
+000166a0: 2222 220d 0a0d 0a20 2020 2020 2020 2069  """....        i
+000166b0: 6620 6c65 6e28 7365 6c66 2e5f 6d6f 6475  f len(self._modu
+000166c0: 6c65 7329 203e 2030 2061 6e64 2073 656c  les) > 0 and sel
+000166d0: 662e 5f69 6e70 7574 5f73 6861 7065 2069  f._input_shape i
+000166e0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+000166f0: 656c 665b 2d31 5d2e 6275 696c 7420 616e  elf[-1].built an
+00016700: 6420 7365 6c66 5b2d 315d 2e5f 6f75 7470  d self[-1]._outp
+00016710: 7574 5f73 6861 7065 2069 7320 6e6f 7420  ut_shape is not 
+00016720: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00016730: 2020 206c 6173 745f 6f75 7470 7574 203d     last_output =
+00016740: 2073 656c 665b 2d31 5d2e 5f6f 7574 7075   self[-1]._outpu
+00016750: 745f 7368 6170 650d 0a20 2020 2020 2020  t_shape..       
+00016760: 2020 2020 2064 756d 6d61 795f 696e 7075       dummay_inpu
+00016770: 7420 3d20 746f 5f74 656e 736f 7228 6c61  t = to_tensor(la
+00016780: 7374 5f6f 7574 7075 742e 6765 745f 6475  st_output.get_du
+00016790: 6d6d 795f 7465 6e73 6f72 2829 292e 746f  mmy_tensor()).to
+000167a0: 2873 656c 662e 6465 7669 6365 290d 0a20  (self.device).. 
+000167b0: 2020 2020 2020 2020 2020 206f 7574 203d             out =
+000167c0: 206d 6f64 756c 6528 6475 6d6d 6179 5f69   module(dummay_i
+000167d0: 6e70 7574 290d 0a20 2020 2020 2020 2020  nput)..         
+000167e0: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
+000167f0: 5b6e 616d 655d 203d 206d 6f64 756c 650d  [name] = module.
+00016800: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016810: 6973 696e 7374 616e 6365 286f 7574 2c20  isinstance(out, 
+00016820: 4f72 6465 7265 6444 6963 7429 3a0d 0a0d  OrderedDict):...
+00016830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016840: 2073 656c 662e 5f6f 7574 7075 745f 7368   self._output_sh
+00016850: 6170 6520 3d20 7475 706c 6528 0d0a 2020  ape = tuple(..  
+00016860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016870: 2020 5b74 656e 736f 725f 746f 5f73 6861    [tensor_to_sha
+00016880: 7065 286f 2c20 6e65 6564 5f65 7863 6c75  pe(o, need_exclu
+00016890: 6465 5f62 6174 6368 5f61 7869 733d 5472  de_batch_axis=Tr
+000168a0: 7565 2c20 6973 5f73 696e 676c 6574 6f6e  ue, is_singleton
+000168b0: 3d46 616c 7365 2920 666f 7220 6f20 696e  =False) for o in
+000168c0: 206f 7574 2e76 616c 7565 5f6c 6973 745d   out.value_list]
+000168d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000168e0: 2020 2073 656c 662e 6765 745f 726f 6f74     self.get_root
+000168f0: 2829 2e73 6967 6e61 7475 7265 2e6f 7574  ().signature.out
+00016900: 7075 7473 203d 204f 7264 6572 6564 4469  puts = OrderedDi
+00016910: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
+00016920: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+00016930: 6e20 6f75 742e 6974 656d 5f6c 6973 743a  n out.item_list:
+00016940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016950: 2020 2020 2020 7365 6c66 2e67 6574 5f72        self.get_r
+00016960: 6f6f 7428 292e 7369 676e 6174 7572 652e  oot().signature.
+00016970: 6f75 7470 7574 735b 6b5d 203d 2074 656e  outputs[k] = ten
+00016980: 736f 725f 746f 5f73 6861 7065 2876 2c20  sor_to_shape(v, 
+00016990: 6e65 6564 5f65 7863 6c75 6465 5f62 6174  need_exclude_bat
+000169a0: 6368 5f61 7869 733d 5472 7565 2c0d 0a20  ch_axis=True,.. 
 000169b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000169e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169f0: 2020 2020 2069 735f 7369 6e67 6c65 746f       is_singleto
-00016a00: 6e3d 4661 6c73 6529 0d0a 2020 2020 2020  n=False)..      
-00016a10: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00016a20: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00016a30: 203d 2065 6e66 6f72 6365 5f73 696e 676c   = enforce_singl
-00016a40: 6574 6f6e 286f 7574 290d 0a20 2020 2020  eton(out)..     
-00016a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016a60: 5f6f 7574 7075 745f 7368 6170 6520 3d20  _output_shape = 
-00016a70: 7465 6e73 6f72 5f74 6f5f 7368 6170 6528  tensor_to_shape(
-00016a80: 6f75 742c 206e 6565 645f 6578 636c 7564  out, need_exclud
-00016a90: 655f 6261 7463 685f 6178 6973 3d54 7275  e_batch_axis=Tru
-00016aa0: 652c 2069 735f 7369 6e67 6c65 746f 6e3d  e, is_singleton=
-00016ab0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00016ac0: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
-00016ad0: 676e 6174 7572 652e 6f75 7470 7574 735b  gnature.outputs[
-00016ae0: 7365 6c66 2e5f 7369 676e 6174 7572 652e  self._signature.
-00016af0: 6f75 7470 7574 732e 6b65 795f 6c69 7374  outputs.key_list
-00016b00: 5b30 5d5d 2e73 6861 7065 203d 2073 656c  [0]].shape = sel
-00016b10: 662e 5f6f 7574 7075 745f 7368 6170 650d  f._output_shape.
-00016b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016b30: 2023 2069 6620 6c65 6e28 7365 6c66 2e67   # if len(self.g
-00016b40: 6574 5f72 6f6f 7428 292e 7369 676e 6174  et_root().signat
-00016b50: 7572 652e 6f75 7470 7574 7329 203e 2030  ure.outputs) > 0
-00016b60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00016b70: 2020 2023 2020 2020 2073 656c 662e 6765     #     self.ge
-00016b80: 745f 726f 6f74 2829 2e73 6967 6e61 7475  t_root().signatu
-00016b90: 7265 3d67 6574 5f73 6967 6e61 7475 7265  re=get_signature
-00016ba0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-00016bb0: 2020 2020 2020 2020 2320 656c 7365 3a0d          # else:.
-00016bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016bd0: 2023 2020 2020 2073 656c 662e 6765 745f   #     self.get_
-00016be0: 726f 6f74 2829 2e73 6967 6e61 7475 7265  root().signature
-00016bf0: 2e6f 7574 7075 7473 5b27 6f75 7470 7574  .outputs['output
-00016c00: 275d 203d 2073 656c 662e 5f6f 7574 7075  '] = self._outpu
-00016c10: 745f 7368 6170 652e 636f 7079 2829 0d0a  t_shape.copy()..
-00016c20: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00016c30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016c40: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
-00016c50: 6c65 2c20 275f 7369 676e 6174 7572 6527  le, '_signature'
-00016c60: 2920 6f72 206d 6f64 756c 652e 5f73 6967  ) or module._sig
-00016c70: 6e61 7475 7265 2069 7320 4e6f 6e65 3a0d  nature is None:.
-00016c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c90: 206d 6f64 756c 652e 5f73 6967 6e61 7475   module._signatu
-00016ca0: 7265 203d 2067 6574 5f73 6967 6e61 7475  re = get_signatu
-00016cb0: 7265 286d 6f64 756c 6529 0d0a 2020 2020  re(module)..    
-00016cc0: 2020 2020 2020 2020 7369 6720 3d20 636f          sig = co
-00016cd0: 7079 2e64 6565 7063 6f70 7928 6d6f 6475  py.deepcopy(modu
-00016ce0: 6c65 2e5f 7369 676e 6174 7572 6529 0d0a  le._signature)..
-00016cf0: 2020 2020 2020 2020 2020 2020 7375 7065              supe
-00016d00: 7228 5365 7175 656e 7469 616c 2c20 7365  r(Sequential, se
-00016d10: 6c66 292e 6164 645f 6d6f 6475 6c65 286e  lf).add_module(n
-00016d20: 616d 652c 206d 6f64 756c 6529 0d0a 2020  ame, module)..  
-00016d30: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00016d40: 2873 656c 6629 203d 3d20 3120 6f72 2073  (self) == 1 or s
-00016d50: 656c 662e 5f73 6967 6e61 7475 7265 2069  elf._signature i
-00016d60: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00016d70: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-00016d80: 6967 6e61 7475 7265 203d 2073 6967 0d0a  ignature = sig..
-00016d90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00016da0: 206c 656e 2873 656c 6629 203e 2031 3a0d   len(self) > 1:.
-00016db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016dc0: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
-00016dd0: 2e6f 7574 7075 7473 203d 2063 6f70 792e  .outputs = copy.
-00016de0: 6465 6570 636f 7079 2873 6967 2e6f 7574  deepcopy(sig.out
-00016df0: 7075 7473 290d 0a0d 0a20 2020 2064 6566  puts)....    def
-00016e00: 2072 656d 6f76 655f 6174 2873 656c 662c   remove_at(self,
-00016e10: 2069 6478 293a 0d0a 2020 2020 2020 2020   idx):..        
-00016e20: 7365 6c66 2e5f 5f64 656c 6974 656d 5f5f  self.__delitem__
-00016e30: 2869 6478 290d 0a0d 0a20 2020 2020 2020  (idx)....       
-00016e40: 2069 6620 6c65 6e28 7365 6c66 2e5f 6d6f   if len(self._mo
-00016e50: 6475 6c65 7329 203e 2030 3a0d 0a20 2020  dules) > 0:..   
-00016e60: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
-00016e70: 7574 7075 745f 7368 6170 6520 3d20 7365  utput_shape = se
-00016e80: 6c66 5b2d 315d 2e5f 6f75 7470 7574 5f73  lf[-1]._output_s
-00016e90: 6861 7065 0d0a 2020 2020 2020 2020 2020  hape..          
-00016ea0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00016eb0: 7365 6c66 2e5f 7369 676e 6174 7572 652c  self._signature,
-00016ec0: 2053 6967 6e61 7475 7265 293a 0d0a 2020   Signature):..  
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00016ee0: 6c66 2e5f 7369 676e 6174 7572 652e 6f75  lf._signature.ou
-00016ef0: 7470 7574 735b 7365 6c66 2e5f 7369 676e  tputs[self._sign
-00016f00: 6174 7572 652e 6f75 7470 7574 732e 6b65  ature.outputs.ke
-00016f10: 795f 6c69 7374 5b30 5d5d 2e73 6861 7065  y_list[0]].shape
-00016f20: 203d 2073 656c 665b 2d31 5d2e 5f6f 7574   = self[-1]._out
-00016f30: 7075 745f 7368 6170 650d 0a0d 0a0d 0a20  put_shape...... 
-00016f40: 2020 2064 6566 205f 6765 745f 6974 656d     def _get_item
-00016f50: 5f62 795f 6964 7828 7365 6c66 2c20 6974  _by_idx(self, it
-00016f60: 6572 6174 6f72 2c20 6964 7829 202d 3e20  erator, idx) -> 
-00016f70: 543a 0d0a 2020 2020 2020 2020 2222 2247  T:..        """G
-00016f80: 6574 2074 6865 2069 6478 2d74 6820 6974  et the idx-th it
-00016f90: 656d 206f 6620 7468 6520 6974 6572 6174  em of the iterat
-00016fa0: 6f72 2222 220d 0a20 2020 2020 2020 2073  or"""..        s
-00016fb0: 697a 6520 3d20 6c65 6e28 7365 6c66 290d  ize = len(self).
-00016fc0: 0a20 2020 2020 2020 2069 6478 203d 206f  .        idx = o
-00016fd0: 7065 7261 746f 722e 696e 6465 7828 6964  perator.index(id
-00016fe0: 7829 0d0a 2020 2020 2020 2020 6966 206e  x)..        if n
-00016ff0: 6f74 202d 7369 7a65 203c 3d20 6964 7820  ot -size <= idx 
-00017000: 3c20 7369 7a65 3a0d 0a20 2020 2020 2020  < size:..       
-00017010: 2020 2020 2072 6169 7365 2049 6e64 6578       raise Index
-00017020: 4572 726f 7228 2769 6e64 6578 207b 7d20  Error('index {} 
-00017030: 6973 206f 7574 206f 6620 7261 6e67 6527  is out of range'
-00017040: 2e66 6f72 6d61 7428 6964 7829 290d 0a20  .format(idx)).. 
-00017050: 2020 2020 2020 2069 6478 2025 3d20 7369         idx %= si
-00017060: 7a65 0d0a 2020 2020 2020 2020 7265 7475  ze..        retu
-00017070: 726e 206e 6578 7428 6973 6c69 6365 2869  rn next(islice(i
-00017080: 7465 7261 746f 722c 2069 6478 2c20 4e6f  terator, idx, No
-00017090: 6e65 2929 0d0a 0d0a 0d0a 0d0a 2020 2020  ne))........    
-000170a0: 405f 636f 7079 5f74 6f5f 7363 7269 7074  @_copy_to_script
-000170b0: 5f77 7261 7070 6572 0d0a 2020 2020 6465  _wrapper..    de
-000170c0: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
-000170d0: 6c66 2c20 6964 7829 3a0d 0a20 2020 2020  lf, idx):..     
-000170e0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-000170f0: 2869 6478 2c20 736c 6963 6529 3a0d 0a20  (idx, slice):.. 
-00017100: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017110: 6e20 7365 6c66 2e5f 5f63 6c61 7373 5f5f  n self.__class__
-00017120: 284f 7264 6572 6564 4469 6374 286c 6973  (OrderedDict(lis
-00017130: 7428 7365 6c66 2e5f 6d6f 6475 6c65 732e  t(self._modules.
-00017140: 6974 656d 7328 2929 5b69 6478 5d29 290d  items())[idx])).
-00017150: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00017160: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00017170: 726e 2073 656c 662e 5f67 6574 5f69 7465  rn self._get_ite
-00017180: 6d5f 6279 5f69 6478 2873 656c 662e 5f6d  m_by_idx(self._m
-00017190: 6f64 756c 6573 2e76 616c 7565 7328 292c  odules.values(),
-000171a0: 2069 6478 290d 0a0d 0a0d 0a0d 0a20 2020   idx)........   
-000171b0: 2064 6566 205f 5f73 6574 6974 656d 5f5f   def __setitem__
-000171c0: 2873 656c 662c 2069 6478 2c20 6d6f 6475  (self, idx, modu
-000171d0: 6c65 293a 0d0a 2020 2020 2020 2020 6b65  le):..        ke
-000171e0: 793a 2073 7472 203d 2073 656c 662e 5f67  y: str = self._g
-000171f0: 6574 5f69 7465 6d5f 6279 5f69 6478 2873  et_item_by_idx(s
-00017200: 656c 662e 5f6d 6f64 756c 6573 2e6b 6579  elf._modules.key
-00017210: 7328 292c 2069 6478 290d 0a20 2020 2020  s(), idx)..     
-00017220: 2020 2072 6574 7572 6e20 7365 7461 7474     return setatt
-00017230: 7228 7365 6c66 2c20 6b65 792c 206d 6f64  r(self, key, mod
-00017240: 756c 6529 0d0a 0d0a 2020 2020 6465 6620  ule)....    def 
-00017250: 5f5f 6465 6c69 7465 6d5f 5f28 7365 6c66  __delitem__(self
-00017260: 2c20 6964 7829 3a0d 0a20 2020 2020 2020  , idx):..       
-00017270: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
-00017280: 6478 2c20 736c 6963 6529 3a0d 0a20 2020  dx, slice):..   
-00017290: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
-000172a0: 2069 6e20 6c69 7374 2873 656c 662e 5f6d   in list(self._m
-000172b0: 6f64 756c 6573 2e6b 6579 7328 2929 5b69  odules.keys())[i
-000172c0: 6478 5d3a 0d0a 2020 2020 2020 2020 2020  dx]:..          
-000172d0: 2020 2020 2020 6465 6c61 7474 7228 7365        delattr(se
-000172e0: 6c66 2c20 6b65 7929 0d0a 2020 2020 2020  lf, key)..      
-000172f0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00017300: 2020 2020 206b 6579 203d 2073 656c 662e       key = self.
-00017310: 5f67 6574 5f69 7465 6d5f 6279 5f69 6478  _get_item_by_idx
-00017320: 2873 656c 662e 5f6d 6f64 756c 6573 2e6b  (self._modules.k
-00017330: 6579 7328 292c 2069 6478 290d 0a20 2020  eys(), idx)..   
-00017340: 2020 2020 2020 2020 2064 656c 6174 7472           delattr
-00017350: 2873 656c 662c 206b 6579 290d 0a0d 0a20  (self, key).... 
-00017360: 2020 2020 2020 2023 2054 6f20 7072 6573         # To pres
-00017370: 6572 7665 206e 756d 6265 7269 6e67 0d0a  erve numbering..
-00017380: 2020 2020 2020 2020 7374 725f 696e 6469          str_indi
-00017390: 6365 7320 3d20 5b73 7472 2869 2920 666f  ces = [str(i) fo
-000173a0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-000173b0: 2873 656c 662e 5f6d 6f64 756c 6573 2929  (self._modules))
-000173c0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-000173d0: 5f6d 6f64 756c 6573 203d 204f 7264 6572  _modules = Order
-000173e0: 6564 4469 6374 286c 6973 7428 7a69 7028  edDict(list(zip(
-000173f0: 7374 725f 696e 6469 6365 732c 2073 656c  str_indices, sel
-00017400: 662e 5f6d 6f64 756c 6573 2e76 616c 7565  f._modules.value
-00017410: 7328 2929 2929 0d0a 0d0a 2020 2020 405f  s())))....    @_
-00017420: 636f 7079 5f74 6f5f 7363 7269 7074 5f77  copy_to_script_w
-00017430: 7261 7070 6572 0d0a 2020 2020 6465 6620  rapper..    def 
-00017440: 5f5f 6c65 6e5f 5f28 7365 6c66 2920 2d3e  __len__(self) ->
-00017450: 2069 6e74 3a0d 0a20 2020 2020 2020 2072   int:..        r
-00017460: 6574 7572 6e20 6c65 6e28 7365 6c66 2e5f  eturn len(self._
-00017470: 6d6f 6475 6c65 7329 0d0a 0d0a 0d0a 2020  modules)......  
-00017480: 2020 6465 6620 5f5f 6164 645f 5f28 7365    def __add__(se
-00017490: 6c66 2c20 6f74 6865 7229 202d 3e20 2753  lf, other) -> 'S
-000174a0: 6571 7565 6e74 6961 6c27 3a0d 0a20 2020  equential':..   
-000174b0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000174c0: 6365 286f 7468 6572 2c20 5365 7175 656e  ce(other, Sequen
-000174d0: 7469 616c 293a 0d0a 2020 2020 2020 2020  tial):..        
-000174e0: 2020 2020 7265 7420 3d20 5365 7175 656e      ret = Sequen
-000174f0: 7469 616c 2829 0d0a 2020 2020 2020 2020  tial()..        
-00017500: 2020 2020 666f 7220 6c61 7965 7220 696e      for layer in
-00017510: 2073 656c 663a 0d0a 2020 2020 2020 2020   self:..        
-00017520: 2020 2020 2020 2020 7265 742e 6170 7065          ret.appe
-00017530: 6e64 286c 6179 6572 290d 0a20 2020 2020  nd(layer)..     
-00017540: 2020 2020 2020 2066 6f72 206c 6179 6572         for layer
-00017550: 2069 6e20 6f74 6865 723a 0d0a 2020 2020   in other:..    
-00017560: 2020 2020 2020 2020 2020 2020 7265 742e              ret.
-00017570: 6170 7065 6e64 286c 6179 6572 290d 0a20  append(layer).. 
-00017580: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017590: 6e20 7265 740d 0a20 2020 2020 2020 2065  n ret..        e
-000175a0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000175b0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000175c0: 6f72 2827 6164 6420 6f70 6572 6174 6f72  or('add operator
-000175d0: 2073 7570 706f 7274 7320 6f6e 6c79 206f   supports only o
-000175e0: 626a 6563 7473 2027 0d0a 2020 2020 2020  bjects '..      
-000175f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017600: 2020 2020 2020 2027 6f66 2053 6571 7565         'of Seque
-00017610: 6e74 6961 6c20 636c 6173 732c 2062 7574  ntial class, but
-00017620: 207b 7d20 6973 2067 6976 656e 2e27 2e66   {} is given.'.f
-00017630: 6f72 6d61 7428 0d0a 2020 2020 2020 2020  ormat(..        
-00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017650: 2020 2020 2020 2020 2073 7472 2874 7970           str(typ
-00017660: 6528 6f74 6865 7229 2929 290d 0a0d 0a20  e(other)))).... 
-00017670: 2020 2064 6566 2070 6f70 2873 656c 662c     def pop(self,
-00017680: 206b 6579 3a20 556e 696f 6e5b 696e 742c   key: Union[int,
-00017690: 2073 6c69 6365 5d29 202d 3e20 6e6e 2e4d   slice]) -> nn.M
-000176a0: 6f64 756c 653a 0d0a 2020 2020 2020 2020  odule:..        
-000176b0: 7620 3d20 7365 6c66 5b6b 6579 5d0d 0a20  v = self[key].. 
-000176c0: 2020 2020 2020 2064 656c 2073 656c 665b         del self[
-000176d0: 6b65 795d 0d0a 2020 2020 2020 2020 7265  key]..        re
-000176e0: 7475 726e 2076 0d0a 0d0a 2020 2020 6465  turn v....    de
-000176f0: 6620 5f5f 6961 6464 5f5f 2873 656c 662c  f __iadd__(self,
-00017700: 206f 7468 6572 2920 2d3e 2027 5365 7175   other) -> 'Sequ
-00017710: 656e 7469 616c 273a 0d0a 2020 2020 2020  ential':..      
-00017720: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00017730: 6f74 6865 722c 2053 6571 7565 6e74 6961  other, Sequentia
-00017740: 6c29 3a0d 0a20 2020 2020 2020 2020 2020  l):..           
-00017750: 206f 6666 7365 7420 3d20 6c65 6e28 7365   offset = len(se
-00017760: 6c66 290d 0a20 2020 2020 2020 2020 2020  lf)..           
-00017770: 2066 6f72 2069 2c20 6d6f 6475 6c65 2069   for i, module i
-00017780: 6e20 656e 756d 6572 6174 6528 6f74 6865  n enumerate(othe
-00017790: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-000177a0: 2020 2020 2073 656c 662e 6164 645f 6d6f       self.add_mo
-000177b0: 6475 6c65 2873 7472 2869 202b 206f 6666  dule(str(i + off
-000177c0: 7365 7429 2c20 6d6f 6475 6c65 290d 0a20  set), module).. 
-000177d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000177e0: 6e20 7365 6c66 0d0a 2020 2020 2020 2020  n self..        
-000177f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00017800: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00017810: 726f 7228 2761 6464 206f 7065 7261 746f  ror('add operato
-00017820: 7220 7375 7070 6f72 7473 206f 6e6c 7920  r supports only 
-00017830: 6f62 6a65 6374 7320 270d 0a20 2020 2020  objects '..     
-00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017850: 2020 2020 2020 2020 276f 6620 5365 7175          'of Sequ
-00017860: 656e 7469 616c 2063 6c61 7373 2c20 6275  ential class, bu
-00017870: 7420 7b7d 2069 7320 6769 7665 6e2e 272e  t {} is given.'.
-00017880: 666f 726d 6174 280d 0a20 2020 2020 2020  format(..       
-00017890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178a0: 2020 2020 2020 2020 2020 7374 7228 7479            str(ty
-000178b0: 7065 286f 7468 6572 2929 2929 0d0a 0d0a  pe(other))))....
-000178c0: 2020 2020 6465 6620 5f5f 6d75 6c5f 5f28      def __mul__(
-000178d0: 7365 6c66 2c20 6f74 6865 723a 2069 6e74  self, other: int
-000178e0: 2920 2d3e 2027 5365 7175 656e 7469 616c  ) -> 'Sequential
-000178f0: 273a 0d0a 2020 2020 2020 2020 6966 206e  ':..        if n
-00017900: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
-00017910: 6865 722c 2069 6e74 293a 0d0a 2020 2020  her, int):..    
-00017920: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00017930: 7065 4572 726f 7228 6622 756e 7375 7070  peError(f"unsupp
-00017940: 6f72 7465 6420 6f70 6572 616e 6420 7479  orted operand ty
-00017950: 7065 2873 2920 666f 7220 2a3a 207b 7479  pe(s) for *: {ty
-00017960: 7065 2873 656c 6629 7d20 616e 6420 7b74  pe(self)} and {t
-00017970: 7970 6528 6f74 6865 7229 7d22 290d 0a20  ype(other)}").. 
-00017980: 2020 2020 2020 2065 6c69 6620 286f 7468         elif (oth
-00017990: 6572 203c 3d20 3029 3a0d 0a20 2020 2020  er <= 0):..     
-000179a0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000179b0: 7565 4572 726f 7228 6622 4e6f 6e2d 706f  ueError(f"Non-po
-000179c0: 7369 7469 7665 206d 756c 7469 706c 6963  sitive multiplic
-000179d0: 6174 696f 6e20 6661 6374 6f72 207b 6f74  ation factor {ot
-000179e0: 6865 727d 2066 6f72 207b 7479 7065 2873  her} for {type(s
-000179f0: 656c 6629 7d22 290d 0a20 2020 2020 2020  elf)}")..       
-00017a00: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00017a10: 2020 2020 636f 6d62 696e 6564 203d 2053      combined = S
-00017a20: 6571 7565 6e74 6961 6c28 290d 0a20 2020  equential()..   
-00017a30: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
-00017a40: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-00017a50: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
-00017a60: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
-00017a70: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
-00017a80: 756c 6520 696e 2073 656c 663a 0d0a 2020  ule in self:..  
-00017a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017aa0: 2020 636f 6d62 696e 6564 2e61 6464 5f6d    combined.add_m
-00017ab0: 6f64 756c 6528 7374 7228 6f66 6673 6574  odule(str(offset
-00017ac0: 292c 206d 6f64 756c 6529 0d0a 2020 2020  ), module)..    
-00017ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ae0: 6f66 6673 6574 202b 3d20 310d 0a20 2020  offset += 1..   
-00017af0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00017b00: 636f 6d62 696e 6564 0d0a 0d0a 2020 2020  combined....    
-00017b10: 6465 6620 5f5f 726d 756c 5f5f 2873 656c  def __rmul__(sel
-00017b20: 662c 206f 7468 6572 3a20 696e 7429 202d  f, other: int) -
-00017b30: 3e20 2753 6571 7565 6e74 6961 6c27 3a0d  > 'Sequential':.
-00017b40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00017b50: 7365 6c66 2e5f 5f6d 756c 5f5f 286f 7468  self.__mul__(oth
-00017b60: 6572 290d 0a0d 0a20 2020 2064 6566 205f  er)....    def _
-00017b70: 5f69 6d75 6c5f 5f28 7365 6c66 2c20 6f74  _imul__(self, ot
-00017b80: 6865 723a 2069 6e74 2920 2d3e 2027 5365  her: int) -> 'Se
-00017b90: 7175 656e 7469 616c 273a 0d0a 2020 2020  quential':..    
-00017ba0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00017bb0: 7461 6e63 6528 6f74 6865 722c 2069 6e74  tance(other, int
-00017bc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00017bd0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-00017be0: 6622 756e 7375 7070 6f72 7465 6420 6f70  f"unsupported op
-00017bf0: 6572 616e 6420 7479 7065 2873 2920 666f  erand type(s) fo
-00017c00: 7220 2a3a 207b 7479 7065 2873 656c 6629  r *: {type(self)
-00017c10: 7d20 616e 6420 7b74 7970 6528 6f74 6865  } and {type(othe
-00017c20: 7229 7d22 290d 0a20 2020 2020 2020 2065  r)}")..        e
-00017c30: 6c69 6620 286f 7468 6572 203c 3d20 3029  lif (other <= 0)
-00017c40: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00017c50: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00017c60: 6622 4e6f 6e2d 706f 7369 7469 7665 206d  f"Non-positive m
-00017c70: 756c 7469 706c 6963 6174 696f 6e20 6661  ultiplication fa
-00017c80: 6374 6f72 207b 6f74 6865 727d 2066 6f72  ctor {other} for
-00017c90: 207b 7479 7065 2873 656c 6629 7d22 290d   {type(self)}").
-00017ca0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00017cb0: 2020 2020 2020 2020 2020 2020 6c65 6e5f              len_
-00017cc0: 6f72 6967 696e 616c 203d 206c 656e 2873  original = len(s
-00017cd0: 656c 6629 0d0a 2020 2020 2020 2020 2020  elf)..          
-00017ce0: 2020 6f66 6673 6574 203d 206c 656e 2873    offset = len(s
-00017cf0: 656c 6629 0d0a 2020 2020 2020 2020 2020  elf)..          
-00017d00: 2020 666f 7220 5f20 696e 2072 616e 6765    for _ in range
-00017d10: 286f 7468 6572 202d 2031 293a 0d0a 2020  (other - 1):..  
-00017d20: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00017d30: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-00017d40: 5f6f 7269 6769 6e61 6c29 3a0d 0a20 2020  _original):..   
-00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d60: 2073 656c 662e 6164 645f 6d6f 6475 6c65   self.add_module
-00017d70: 2873 7472 2869 202b 206f 6666 7365 7429  (str(i + offset)
-00017d80: 2c20 7365 6c66 2e5f 6d6f 6475 6c65 735b  , self._modules[
-00017d90: 7374 7228 6929 5d29 0d0a 2020 2020 2020  str(i)])..      
-00017da0: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
-00017db0: 202b 3d20 6c65 6e5f 6f72 6967 696e 616c   += len_original
-00017dc0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00017dd0: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
-00017de0: 2040 5f63 6f70 795f 746f 5f73 6372 6970   @_copy_to_scrip
-00017df0: 745f 7772 6170 7065 720d 0a20 2020 2064  t_wrapper..    d
-00017e00: 6566 205f 5f64 6972 5f5f 2873 656c 6629  ef __dir__(self)
-00017e10: 3a0d 0a20 2020 2020 2020 206b 6579 7320  :..        keys 
-00017e20: 3d20 7375 7065 7228 5365 7175 656e 7469  = super(Sequenti
-00017e30: 616c 2c20 7365 6c66 292e 5f5f 6469 725f  al, self).__dir_
-00017e40: 5f28 290d 0a20 2020 2020 2020 206b 6579  _()..        key
-00017e50: 7320 3d20 5b6b 6579 2066 6f72 206b 6579  s = [key for key
-00017e60: 2069 6e20 6b65 7973 2069 6620 6e6f 7420   in keys if not 
-00017e70: 6b65 792e 6973 6469 6769 7428 295d 0d0a  key.isdigit()]..
-00017e80: 2020 2020 2020 2020 7265 7475 726e 206b          return k
-00017e90: 6579 730d 0a0d 0a0d 0a0d 0a0d 0a20 2020  eys..........   
-00017ea0: 2040 5f63 6f70 795f 746f 5f73 6372 6970   @_copy_to_scrip
-00017eb0: 745f 7772 6170 7065 720d 0a20 2020 2064  t_wrapper..    d
-00017ec0: 6566 205f 5f69 7465 725f 5f28 7365 6c66  ef __iter__(self
-00017ed0: 2920 2d3e 2049 7465 7261 746f 725b 6e6e  ) -> Iterator[nn
-00017ee0: 2e4d 6f64 756c 655d 3a0d 0a20 2020 2020  .Module]:..     
-00017ef0: 2020 2072 6574 7572 6e20 6974 6572 2873     return iter(s
-00017f00: 656c 662e 5f6d 6f64 756c 6573 2e76 616c  elf._modules.val
-00017f10: 7565 7328 2929 0d0a 0d0a 0d0a 2020 2020  ues())......    
-00017f20: 2320 4e42 3a20 5765 2063 616e 2774 2072  # NB: We can't r
-00017f30: 6561 6c6c 7920 7479 7065 2063 6865 636b  eally type check
-00017f40: 2074 6869 7320 6675 6e63 7469 6f6e 2061   this function a
-00017f50: 7320 7468 6520 7479 7065 206f 6620 696e  s the type of in
-00017f60: 7075 740d 0a20 2020 2023 206d 6179 2063  put..    # may c
-00017f70: 6861 6e67 6520 6479 6e61 6d69 6361 6c6c  hange dynamicall
-00017f80: 7920 2861 7320 6973 2074 6573 7465 6420  y (as is tested 
-00017f90: 696e 0d0a 2020 2020 2320 5465 7374 5363  in..    # TestSc
-00017fa0: 7269 7074 2e74 6573 745f 7365 7175 656e  ript.test_sequen
-00017fb0: 7469 616c 5f69 6e74 6572 6d65 6469 6172  tial_intermediar
-00017fc0: 795f 7479 7065 7329 2e20 2043 616e 6e6f  y_types).  Canno
-00017fd0: 7420 616e 6e6f 7461 7465 0d0a 2020 2020  t annotate..    
-00017fe0: 2320 7769 7468 2041 6e79 2061 7320 546f  # with Any as To
-00017ff0: 7263 6853 6372 6970 7420 6578 7065 6374  rchScript expect
-00018000: 7320 6120 6d6f 7265 2070 7265 6369 7365  s a more precise
-00018010: 2074 7970 650d 0a20 2020 2023 2064 6566   type..    # def
-00018020: 2066 6f72 7761 7264 2873 656c 662c 2069   forward(self, i
-00018030: 6e70 7574 293a 0d0a 2020 2020 2320 2020  nput):..    #   
-00018040: 2020 666f 7220 6d6f 6475 6c65 2069 6e20    for module in 
-00018050: 7365 6c66 3a0d 0a20 2020 2023 2020 2020  self:..    #    
-00018060: 2020 2020 2069 6e70 7574 203d 206d 6f64       input = mod
-00018070: 756c 6528 696e 7075 7429 0d0a 2020 2020  ule(input)..    
-00018080: 2320 2020 2020 7265 7475 726e 2069 6e70  #     return inp
-00018090: 7574 0d0a 0d0a 2020 2020 6465 6620 666f  ut....    def fo
-000180a0: 7277 6172 6428 7365 6c66 2c20 2a78 2c20  rward(self, *x, 
-000180b0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-000180c0: 2020 2020 7820 3d20 756e 7061 636b 5f73      x = unpack_s
-000180d0: 696e 676c 6574 6f6e 2878 290d 0a20 2020  ingleton(x)..   
-000180e0: 2020 2020 2066 6f72 206d 6f64 756c 6520       for module 
-000180f0: 696e 2073 656c 662e 5f6d 6f64 756c 6573  in self._modules
-00018100: 2e76 616c 7565 7328 293a 0d0a 2020 2020  .values():..    
-00018110: 2020 2020 2020 2020 2320 7820 3d20 656e          # x = en
-00018120: 666f 7263 655f 7369 6e67 6c65 746f 6e28  force_singleton(
-00018130: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-00018140: 6966 2069 7369 6e73 7461 6e63 6528 782c  if isinstance(x,
-00018150: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
-00018160: 2020 2020 2020 2020 2020 7820 3d20 6d6f            x = mo
-00018170: 6475 6c65 282a 782c 202a 2a6b 7761 7267  dule(*x, **kwarg
-00018180: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-00018190: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-000181a0: 2020 2020 2020 2078 203d 206d 6f64 756c         x = modul
-000181b0: 6528 782c 202a 2a6b 7761 7267 7329 0d0a  e(x, **kwargs)..
-000181c0: 2020 2020 2020 2020 2020 2020 2320 636c              # cl
-000181d0: 6173 735f 6e61 6d65 3d6d 6f64 756c 652e  ass_name=module.
-000181e0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-000181f0: 5f5f 2e6c 6f77 6572 2829 0d0a 2020 2020  __.lower()..    
-00018200: 2020 2020 2020 2020 2320 6966 2027 6c73          # if 'ls
-00018210: 746d 2720 696e 2063 6c61 7373 5f6e 616d  tm' in class_nam
-00018220: 6520 6f72 2027 6772 7527 2069 6e20 636c  e or 'gru' in cl
-00018230: 6173 735f 6e61 6d65 3a0d 0a20 2020 2020  ass_name:..     
-00018240: 2020 2020 2020 2023 2020 2020 2069 6620         #     if 
-00018250: 6973 696e 7374 616e 6365 2878 2c74 7570  isinstance(x,tup
-00018260: 6c65 293a 0d0a 2020 2020 2020 2020 2020  le):..          
-00018270: 2020 2320 2020 2020 2020 2020 782c 6878    #         x,hx
-00018280: 3d78 0d0a 2020 2020 2020 2020 2020 2020  =x..            
-00018290: 2320 2020 2020 2020 2020 6b77 6172 6773  #         kwargs
-000182a0: 5b27 6878 275d 3d68 780d 0a0d 0a20 2020  ['hx']=hx....   
-000182b0: 2020 2020 2072 6574 7572 6e20 780d 0a0d       return x...
-000182c0: 0a0d 0a20 2020 2064 6566 2061 7070 656e  ...    def appen
-000182d0: 6428 7365 6c66 2c20 6d6f 6475 6c65 3a20  d(self, module: 
-000182e0: 6e6e 2e4d 6f64 756c 6529 202d 3e20 2753  nn.Module) -> 'S
-000182f0: 6571 7565 6e74 6961 6c27 3a0d 0a20 2020  equential':..   
-00018300: 2020 2020 2072 2222 2241 7070 656e 6473       r"""Appends
-00018310: 2061 2067 6976 656e 206d 6f64 756c 6520   a given module 
-00018320: 746f 2074 6865 2065 6e64 2e0d 0a0d 0a20  to the end..... 
-00018330: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-00018340: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-00018350: 2028 6e6e 2e4d 6f64 756c 6529 3a20 6d6f   (nn.Module): mo
-00018360: 6475 6c65 2074 6f20 6170 7065 6e64 0d0a  dule to append..
-00018370: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00018380: 2020 2020 2073 656c 662e 6164 645f 6d6f       self.add_mo
-00018390: 6475 6c65 2873 7472 286c 656e 2873 656c  dule(str(len(sel
-000183a0: 6629 292c 206d 6f64 756c 6529 0d0a 2020  f)), module)..  
-000183b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000183c0: 660d 0a0d 0a20 2020 2064 6566 2069 6e73  f....    def ins
-000183d0: 6572 7428 7365 6c66 2c20 696e 6465 783a  ert(self, index:
-000183e0: 2069 6e74 2c20 6d6f 6475 6c65 3a20 6e6e   int, module: nn
-000183f0: 2e4d 6f64 756c 6529 202d 3e20 2753 6571  .Module) -> 'Seq
-00018400: 7565 6e74 6961 6c27 3a0d 0a20 2020 2020  uential':..     
-00018410: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00018420: 616e 6365 286d 6f64 756c 652c 204d 6f64  ance(module, Mod
-00018430: 756c 6529 3a0d 0a20 2020 2020 2020 2020  ule):..         
-00018440: 2020 2072 6169 7365 2041 7373 6572 7469     raise Asserti
-00018450: 6f6e 4572 726f 7228 0d0a 2020 2020 2020  onError(..      
-00018460: 2020 2020 2020 2020 2020 276d 6f64 756c            'modul
-00018470: 6520 7368 6f75 6c64 2062 6520 6f66 2074  e should be of t
-00018480: 7970 653a 207b 7d27 2e66 6f72 6d61 7428  ype: {}'.format(
-00018490: 4d6f 6475 6c65 2929 0d0a 2020 2020 2020  Module))..      
-000184a0: 2020 6e20 3d20 6c65 6e28 7365 6c66 2e5f    n = len(self._
-000184b0: 6d6f 6475 6c65 7329 0d0a 2020 2020 2020  modules)..      
-000184c0: 2020 6966 206e 6f74 2028 2d6e 203c 3d20    if not (-n <= 
-000184d0: 696e 6465 7820 3c3d 206e 293a 0d0a 2020  index <= n):..  
-000184e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000184f0: 496e 6465 7845 7272 6f72 280d 0a20 2020  IndexError(..   
-00018500: 2020 2020 2020 2020 2020 2020 2027 496e               'In
-00018510: 6465 7820 6f75 7420 6f66 2072 616e 6765  dex out of range
-00018520: 3a20 7b7d 272e 666f 726d 6174 2869 6e64  : {}'.format(ind
-00018530: 6578 2929 0d0a 2020 2020 2020 2020 6966  ex))..        if
-00018540: 2069 6e64 6578 203c 2030 3a0d 0a20 2020   index < 0:..   
-00018550: 2020 2020 2020 2020 2069 6e64 6578 202b           index +
-00018560: 3d20 6e0d 0a20 2020 2020 2020 2066 6f72  = n..        for
-00018570: 2069 2069 6e20 7261 6e67 6528 6e2c 2069   i in range(n, i
-00018580: 6e64 6578 2c20 2d31 293a 0d0a 2020 2020  ndex, -1):..    
-00018590: 2020 2020 2020 2020 7365 6c66 2e5f 6d6f          self._mo
-000185a0: 6475 6c65 735b 7374 7228 6929 5d20 3d20  dules[str(i)] = 
-000185b0: 7365 6c66 2e5f 6d6f 6475 6c65 735b 7374  self._modules[st
-000185c0: 7228 6920 2d20 3129 5d0d 0a20 2020 2020  r(i - 1)]..     
-000185d0: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
-000185e0: 5b73 7472 2869 6e64 6578 295d 203d 206d  [str(index)] = m
-000185f0: 6f64 756c 650d 0a20 2020 2020 2020 2072  odule..        r
-00018600: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
-00018610: 2020 6465 6620 6578 7465 6e64 2873 656c    def extend(sel
-00018620: 662c 2073 6571 7565 6e74 6961 6c29 202d  f, sequential) -
-00018630: 3e20 2753 6571 7565 6e74 6961 6c27 3a0d  > 'Sequential':.
-00018640: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
-00018650: 6572 2069 6e20 7365 7175 656e 7469 616c  er in sequential
-00018660: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00018670: 656c 662e 6170 7065 6e64 286c 6179 6572  elf.append(layer
-00018680: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00018690: 6e20 7365 6c66 0d0a 0d0a 0d0a 0d0a 0d0a  n self..........
-000186a0: 636c 6173 7320 4d6f 6475 6c65 4c69 7374  class ModuleList
-000186b0: 284c 6179 6572 293a 0d0a 2020 2020 2222  (Layer):..    ""
-000186c0: 2248 6f6c 6473 2073 7562 6d6f 6475 6c65  "Holds submodule
-000186d0: 7320 696e 2061 206c 6973 742e 0d0a 0d0a  s in a list.....
-000186e0: 2020 2020 3a63 6c61 7373 3a60 7e74 6f72      :class:`~tor
-000186f0: 6368 2e6e 6e2e 4d6f 6475 6c65 4c69 7374  ch.nn.ModuleList
-00018700: 6020 6361 6e20 6265 2069 6e64 6578 6564  ` can be indexed
-00018710: 206c 696b 6520 6120 7265 6775 6c61 7220   like a regular 
-00018720: 5079 7468 6f6e 206c 6973 742c 2062 7574  Python list, but
-00018730: 0d0a 2020 2020 6d6f 6475 6c65 7320 6974  ..    modules it
-00018740: 2063 6f6e 7461 696e 7320 6172 6520 7072   contains are pr
-00018750: 6f70 6572 6c79 2072 6567 6973 7465 7265  operly registere
-00018760: 642c 2061 6e64 2077 696c 6c20 6265 2076  d, and will be v
-00018770: 6973 6962 6c65 2062 7920 616c 6c0d 0a20  isible by all.. 
-00018780: 2020 203a 636c 6173 733a 607e 746f 7263     :class:`~torc
-00018790: 682e 6e6e 2e4d 6f64 756c 6560 206d 6574  h.nn.Module` met
-000187a0: 686f 6473 2e0d 0a0d 0a20 2020 2041 7267  hods.....    Arg
-000187b0: 733a 0d0a 2020 2020 2020 2020 6d6f 6475  s:..        modu
-000187c0: 6c65 7320 2869 7465 7261 626c 652c 206f  les (iterable, o
-000187d0: 7074 696f 6e61 6c29 3a20 616e 2069 7465  ptional): an ite
-000187e0: 7261 626c 6520 6f66 206d 6f64 756c 6573  rable of modules
-000187f0: 2074 6f20 6164 640d 0a0d 0a20 2020 2045   to add....    E
-00018800: 7861 6d70 6c65 733a 0d0a 0d0a 2020 2020  xamples:....    
-00018810: 2020 2020 636c 6173 7320 4d79 4d6f 6475      class MyModu
-00018820: 6c65 286e 6e2e 4d6f 6475 6c65 293a 0d0a  le(nn.Module):..
-00018830: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-00018840: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0d  __init__(self):.
-00018850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018860: 2073 7570 6572 284d 794d 6f64 756c 652c   super(MyModule,
-00018870: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-00018880: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00018890: 2020 2073 656c 662e 6c69 6e65 6172 7320     self.linears 
-000188a0: 3d20 6e6e 2e4d 6f64 756c 654c 6973 7428  = nn.ModuleList(
-000188b0: 5b6e 6e2e 4c69 6e65 6172 2831 302c 2031  [nn.Linear(10, 1
-000188c0: 3029 2066 6f72 2069 2069 6e20 7261 6e67  0) for i in rang
-000188d0: 6528 3130 295d 290d 0a0d 0a20 2020 2020  e(10)])....     
-000188e0: 2020 2020 2020 2064 6566 2066 6f72 7761         def forwa
-000188f0: 7264 2873 656c 662c 2078 2c20 2a2a 6b77  rd(self, x, **kw
-00018900: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00018910: 2020 2020 2020 2020 2320 4d6f 6475 6c65          # Module
-00018920: 4c69 7374 2063 616e 2061 6374 2061 7320  List can act as 
-00018930: 616e 2069 7465 7261 626c 652c 206f 7220  an iterable, or 
-00018940: 6265 2069 6e64 6578 6564 2075 7369 6e67  be indexed using
-00018950: 2069 6e74 730d 0a20 2020 2020 2020 2020   ints..         
-00018960: 2020 2020 2020 2066 6f72 2069 2c20 6c20         for i, l 
-00018970: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-00018980: 662e 6c69 6e65 6172 7329 3a0d 0a20 2020  f.linears):..   
-00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189a0: 2078 203d 2073 656c 662e 6c69 6e65 6172   x = self.linear
-000189b0: 735b 6920 2f2f 2032 5d28 7829 202b 206c  s[i // 2](x) + l
-000189c0: 2878 290d 0a20 2020 2020 2020 2020 2020  (x)..           
-000189d0: 2020 2020 2072 6574 7572 6e20 780d 0a20       return x.. 
-000189e0: 2020 2022 2222 0d0a 0d0a 0d0a 2020 2020     """......    
-000189f0: 5f6d 6f64 756c 6573 3a20 4469 6374 5b73  _modules: Dict[s
-00018a00: 7472 2c20 6e6e 2e4d 6f64 756c 655d 2020  tr, nn.Module]  
-00018a10: 2320 7479 7065 3a20 6967 6e6f 7265 5b61  # type: ignore[a
-00018a20: 7373 6967 6e6d 656e 745d 0d0a 2020 2020  ssignment]..    
-00018a30: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00018a40: 662c 2020 6d6f 6475 6c65 733a 204f 7074  f,  modules: Opt
-00018a50: 696f 6e61 6c5b 4974 6572 6162 6c65 5b6e  ional[Iterable[n
-00018a60: 6e2e 4d6f 6475 6c65 5d5d 203d 204e 6f6e  n.Module]] = Non
-00018a70: 652c 206e 616d 653d 4e6f 6e65 2c20 6b65  e, name=None, ke
-00018a80: 6570 5f6f 7574 7075 743d 4661 6c73 6529  ep_output=False)
-00018a90: 3a0d 0a20 2020 2020 2020 2073 7570 6572  :..        super
-00018aa0: 2829 2e5f 5f73 6574 6174 7472 5f5f 2827  ().__setattr__('
-00018ab0: 5f6d 6f64 756c 6573 272c 204f 7264 6572  _modules', Order
-00018ac0: 6564 4469 6374 2829 290d 0a20 2020 2020  edDict())..     
-00018ad0: 2020 2073 7570 6572 284d 6f64 756c 654c     super(ModuleL
-00018ae0: 6973 742c 2073 656c 6629 2e5f 5f69 6e69  ist, self).__ini
-00018af0: 745f 5f28 6e61 6d65 3d6e 616d 652c 206b  t__(name=name, k
-00018b00: 6565 705f 6f75 7470 7574 3d6b 6565 705f  eep_output=keep_
-00018b10: 6f75 7470 7574 290d 0a20 2020 2020 2020  output)..       
-00018b20: 2073 656c 662e 7575 6964 203d 2075 7569   self.uuid = uui
-00018b30: 642e 7575 6964 3428 292e 6e6f 6465 0d0a  d.uuid4().node..
-00018b40: 2020 2020 2020 2020 7365 6c66 2e5f 6e61          self._na
-00018b50: 6d65 203d 206e 616d 650d 0a0d 0a20 2020  me = name....   
-00018b60: 2020 2020 2073 7461 7274 5f69 6478 203d       start_idx =
-00018b70: 206c 656e 2873 656c 662e 5f6d 6f64 756c   len(self._modul
-00018b80: 6573 290d 0a20 2020 2020 2020 2066 6f72  es)..        for
-00018b90: 206d 6f64 756c 6520 696e 206d 6f64 756c   module in modul
-00018ba0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00018bb0: 206d 6f64 756c 652e 6973 5f72 6f6f 7420   module.is_root 
-00018bc0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00018bd0: 2020 2020 2069 6620 6d6f 6475 6c65 2e75       if module.u
-00018be0: 7569 6420 213d 2073 656c 662e 7575 6964  uid != self.uuid
-00018bf0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00018c00: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
-00018c10: 6c65 2873 7472 2873 7461 7274 5f69 6478  le(str(start_idx
-00018c20: 292c 206d 6f64 756c 6529 0d0a 2020 2020  ), module)..    
-00018c30: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00018c40: 745f 6964 7820 2b3d 2031 0d0a 0d0a 2020  t_idx += 1....  
-00018c50: 2020 6465 6620 5f67 6574 5f61 6273 5f73    def _get_abs_s
-00018c60: 7472 696e 675f 696e 6465 7828 7365 6c66  tring_index(self
-00018c70: 2c20 6964 7829 3a0d 0a20 2020 2020 2020  , idx):..       
-00018c80: 2022 2222 4765 7420 7468 6520 6162 736f   """Get the abso
-00018c90: 6c75 7465 2069 6e64 6578 2066 6f72 2074  lute index for t
-00018ca0: 6865 206c 6973 7420 6f66 206d 6f64 756c  he list of modul
-00018cb0: 6573 2222 220d 0a20 2020 2020 2020 2069  es"""..        i
-00018cc0: 6478 203d 206f 7065 7261 746f 722e 696e  dx = operator.in
-00018cd0: 6465 7828 6964 7829 0d0a 2020 2020 2020  dex(idx)..      
-00018ce0: 2020 6966 206e 6f74 2028 2d6c 656e 2873    if not (-len(s
-00018cf0: 656c 6629 203c 3d20 6964 7820 3c20 6c65  elf) <= idx < le
-00018d00: 6e28 7365 6c66 2929 3a0d 0a20 2020 2020  n(self)):..     
-00018d10: 2020 2020 2020 2072 6169 7365 2049 6e64         raise Ind
-00018d20: 6578 4572 726f 7228 2769 6e64 6578 207b  exError('index {
-00018d30: 7d20 6973 206f 7574 206f 6620 7261 6e67  } is out of rang
-00018d40: 6527 2e66 6f72 6d61 7428 6964 7829 290d  e'.format(idx)).
-00018d50: 0a20 2020 2020 2020 2069 6620 6964 7820  .        if idx 
-00018d60: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
-00018d70: 2020 6964 7820 2b3d 206c 656e 2873 656c    idx += len(sel
-00018d80: 6629 0d0a 2020 2020 2020 2020 7265 7475  f)..        retu
-00018d90: 726e 2073 7472 2869 6478 290d 0a0d 0a20  rn str(idx).... 
-00018da0: 2020 2040 5f63 6f70 795f 746f 5f73 6372     @_copy_to_scr
-00018db0: 6970 745f 7772 6170 7065 720d 0a20 2020  ipt_wrapper..   
-00018dc0: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-00018dd0: 2873 656c 662c 2069 6478 293a 0d0a 2020  (self, idx):..  
-00018de0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00018df0: 6e63 6528 6964 782c 2073 6c69 6365 293a  nce(idx, slice):
-00018e00: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00018e10: 7475 726e 2073 656c 662e 5f5f 636c 6173  turn self.__clas
-00018e20: 735f 5f28 6c69 7374 2873 656c 662e 5f6d  s__(list(self._m
-00018e30: 6f64 756c 6573 2e76 616c 7565 7328 2929  odules.values())
-00018e40: 5b69 6478 5d29 0d0a 2020 2020 2020 2020  [idx])..        
-00018e50: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00018e60: 2020 206c 6179 6572 203d 2073 656c 662e     layer = self.
-00018e70: 5f6d 6f64 756c 6573 5b73 656c 662e 5f67  _modules[self._g
-00018e80: 6574 5f61 6273 5f73 7472 696e 675f 696e  et_abs_string_in
-00018e90: 6465 7828 6964 7829 5d0d 0a20 2020 2020  dex(idx)]..     
-00018ea0: 2020 2020 2020 2072 6574 7572 6e20 6c61         return la
-00018eb0: 7965 720d 0a0d 0a20 2020 2064 6566 205f  yer....    def _
-00018ec0: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
-00018ed0: 2069 6478 2c20 6d6f 6475 6c65 293a 0d0a   idx, module):..
-00018ee0: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
-00018ef0: 6c66 2e5f 6765 745f 6162 735f 7374 7269  lf._get_abs_stri
-00018f00: 6e67 5f69 6e64 6578 2869 6478 290d 0a20  ng_index(idx).. 
-00018f10: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00018f20: 7461 7474 7228 7365 6c66 2c20 7374 7228  tattr(self, str(
-00018f30: 6964 7829 2c20 6d6f 6475 6c65 290d 0a0d  idx), module)...
-00018f40: 0a20 2020 2064 6566 205f 5f64 656c 6974  .    def __delit
-00018f50: 656d 5f5f 2873 656c 662c 2069 6478 293a  em__(self, idx):
-00018f60: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00018f70: 6e73 7461 6e63 6528 6964 782c 2073 6c69  nstance(idx, sli
-00018f80: 6365 293a 0d0a 2020 2020 2020 2020 2020  ce):..          
-00018f90: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-00018fa0: 286c 656e 2873 656c 662e 5f6d 6f64 756c  (len(self._modul
-00018fb0: 6573 2929 5b69 6478 5d3a 0d0a 2020 2020  es))[idx]:..    
-00018fc0: 2020 2020 2020 2020 2020 2020 6465 6c61              dela
-00018fd0: 7474 7228 7365 6c66 2c20 7374 7228 6b29  ttr(self, str(k)
-00018fe0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00018ff0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00019000: 6c61 7474 7228 7365 6c66 2c20 7365 6c66  lattr(self, self
-00019010: 2e5f 6765 745f 6162 735f 7374 7269 6e67  ._get_abs_string
-00019020: 5f69 6e64 6578 2869 6478 2929 0d0a 2020  _index(idx))..  
-00019030: 2020 2020 2020 2320 546f 2070 7265 7365        # To prese
-00019040: 7276 6520 6e75 6d62 6572 696e 672c 2073  rve numbering, s
-00019050: 656c 662e 5f6d 6f64 756c 6573 2069 7320  elf._modules is 
-00019060: 6265 696e 6720 7265 636f 6e73 7472 7563  being reconstruc
-00019070: 7465 6420 7769 7468 206d 6f64 756c 6573  ted with modules
-00019080: 2061 6674 6572 2064 656c 6574 696f 6e0d   after deletion.
-00019090: 0a20 2020 2020 2020 2073 7472 5f69 6e64  .        str_ind
-000190a0: 6963 6573 203d 205b 7374 7228 6929 2066  ices = [str(i) f
-000190b0: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
-000190c0: 6e28 7365 6c66 2e5f 6d6f 6475 6c65 7329  n(self._modules)
-000190d0: 295d 0d0a 2020 2020 2020 2020 7365 6c66  )]..        self
-000190e0: 2e5f 6d6f 6475 6c65 7320 3d20 4f72 6465  ._modules = Orde
-000190f0: 7265 6444 6963 7428 6c69 7374 287a 6970  redDict(list(zip
-00019100: 2873 7472 5f69 6e64 6963 6573 2c20 7365  (str_indices, se
-00019110: 6c66 2e5f 6d6f 6475 6c65 732e 7661 6c75  lf._modules.valu
-00019120: 6573 2829 2929 290d 0a0d 0a20 2020 2040  es())))....    @
-00019130: 5f63 6f70 795f 746f 5f73 6372 6970 745f  _copy_to_script_
-00019140: 7772 6170 7065 720d 0a20 2020 2064 6566  wrapper..    def
-00019150: 205f 5f6c 656e 5f5f 2873 656c 6629 3a0d   __len__(self):.
-00019160: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019170: 6c65 6e28 7365 6c66 2e5f 6d6f 6475 6c65  len(self._module
-00019180: 7329 0d0a 0d0a 2020 2020 405f 636f 7079  s)....    @_copy
-00019190: 5f74 6f5f 7363 7269 7074 5f77 7261 7070  _to_script_wrapp
-000191a0: 6572 0d0a 2020 2020 6465 6620 5f5f 6974  er..    def __it
-000191b0: 6572 5f5f 2873 656c 6629 3a0d 0a20 2020  er__(self):..   
-000191c0: 2020 2020 2072 6574 7572 6e20 6974 6572       return iter
-000191d0: 2873 656c 662e 5f6d 6f64 756c 6573 2e76  (self._modules.v
-000191e0: 616c 7565 7328 2929 0d0a 0d0a 2020 2020  alues())....    
-000191f0: 6465 6620 5f5f 6961 6464 5f5f 2873 656c  def __iadd__(sel
-00019200: 662c 206d 6f64 756c 6573 293a 0d0a 2020  f, modules):..  
-00019210: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00019220: 662e 6578 7465 6e64 286d 6f64 756c 6573  f.extend(modules
-00019230: 290d 0a0d 0a20 2020 2040 5f63 6f70 795f  )....    @_copy_
-00019240: 746f 5f73 6372 6970 745f 7772 6170 7065  to_script_wrappe
-00019250: 720d 0a20 2020 2064 6566 205f 5f64 6972  r..    def __dir
-00019260: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-00019270: 2020 206b 6579 7320 3d20 7375 7065 7228     keys = super(
-00019280: 4d6f 6475 6c65 4c69 7374 2c20 7365 6c66  ModuleList, self
-00019290: 292e 5f5f 6469 725f 5f28 290d 0a20 2020  ).__dir__()..   
-000192a0: 2020 2020 206b 6579 7320 3d20 5b6b 6579       keys = [key
-000192b0: 2066 6f72 206b 6579 2069 6e20 6b65 7973   for key in keys
-000192c0: 2069 6620 6e6f 7420 6b65 792e 6973 6469   if not key.isdi
-000192d0: 6769 7428 295d 0d0a 2020 2020 2020 2020  git()]..        
-000192e0: 7265 7475 726e 206b 6579 730d 0a0d 0a0d  return keys.....
-000192f0: 0a20 2020 2064 6566 2069 6e73 6572 7428  .    def insert(
-00019300: 7365 6c66 2c20 696e 6465 783a 2069 6e74  self, index: int
-00019310: 2c20 6d6f 6475 6c65 3a20 6e6e 2e4d 6f64  , module: nn.Mod
-00019320: 756c 6529 202d 3e20 4e6f 6e65 3a0d 0a20  ule) -> None:.. 
-00019330: 2020 2020 2020 2072 2222 2249 6e73 6572         r"""Inser
-00019340: 7420 6120 6769 7665 6e20 6d6f 6475 6c65  t a given module
-00019350: 2062 6566 6f72 6520 6120 6769 7665 6e20   before a given 
-00019360: 696e 6465 7820 696e 2074 6865 206c 6973  index in the lis
-00019370: 742e 0d0a 0d0a 2020 2020 2020 2020 4172  t.....        Ar
-00019380: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00019390: 2069 6e64 6578 2028 696e 7429 3a20 696e   index (int): in
-000193a0: 6465 7820 746f 2069 6e73 6572 742e 0d0a  dex to insert...
-000193b0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-000193c0: 6c65 2028 6e6e 2e4d 6f64 756c 6529 3a20  le (nn.Module): 
-000193d0: 6d6f 6475 6c65 2074 6f20 696e 7365 7274  module to insert
-000193e0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000193f0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00019400: 7261 6e67 6528 6c65 6e28 7365 6c66 2e5f  range(len(self._
-00019410: 6d6f 6475 6c65 7329 2c20 696e 6465 782c  modules), index,
-00019420: 202d 3129 3a0d 0a20 2020 2020 2020 2020   -1):..         
-00019430: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
-00019440: 5b73 7472 2869 295d 203d 2073 656c 662e  [str(i)] = self.
-00019450: 5f6d 6f64 756c 6573 5b73 7472 2869 202d  _modules[str(i -
-00019460: 2031 295d 0d0a 2020 2020 2020 2020 7365   1)]..        se
-00019470: 6c66 2e5f 6d6f 6475 6c65 735b 7374 7228  lf._modules[str(
-00019480: 696e 6465 7829 5d20 3d20 6d6f 6475 6c65  index)] = module
-00019490: 0d0a 0d0a 2020 2020 6465 6620 6170 7065  ....    def appe
-000194a0: 6e64 2873 656c 662c 206d 6f64 756c 653a  nd(self, module:
-000194b0: 206e 6e2e 4d6f 6475 6c65 2920 2d3e 2027   nn.Module) -> '
-000194c0: 4d6f 6475 6c65 4c69 7374 273a 0d0a 2020  ModuleList':..  
-000194d0: 2020 2020 2020 7222 2222 4170 7065 6e64        r"""Append
-000194e0: 7320 6120 6769 7665 6e20 6d6f 6475 6c65  s a given module
-000194f0: 2074 6f20 7468 6520 656e 6420 6f66 2074   to the end of t
-00019500: 6865 206c 6973 742e 0d0a 0d0a 2020 2020  he list.....    
-00019510: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-00019520: 2020 2020 2020 206d 6f64 756c 6520 286e         module (n
-00019530: 6e2e 4d6f 6475 6c65 293a 206d 6f64 756c  n.Module): modul
-00019540: 6520 746f 2061 7070 656e 640d 0a20 2020  e to append..   
-00019550: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00019560: 2020 7365 6c66 2e61 6464 5f6d 6f64 756c    self.add_modul
-00019570: 6528 7374 7228 6c65 6e28 7365 6c66 2929  e(str(len(self))
-00019580: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
-00019590: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-000195a0: 0d0a 2020 2020 6465 6620 706f 7028 7365  ..    def pop(se
-000195b0: 6c66 2c20 6b65 793a 2055 6e69 6f6e 5b69  lf, key: Union[i
-000195c0: 6e74 2c20 736c 6963 655d 2920 2d3e 206e  nt, slice]) -> n
-000195d0: 6e2e 4d6f 6475 6c65 3a0d 0a20 2020 2020  n.Module:..     
-000195e0: 2020 2076 203d 2073 656c 665b 6b65 795d     v = self[key]
-000195f0: 0d0a 2020 2020 2020 2020 6465 6c20 7365  ..        del se
-00019600: 6c66 5b6b 6579 5d0d 0a20 2020 2020 2020  lf[key]..       
-00019610: 2072 6574 7572 6e20 760d 0a0d 0a20 2020   return v....   
-00019620: 2064 6566 2065 7874 656e 6428 7365 6c66   def extend(self
-00019630: 2c20 6d6f 6475 6c65 733a 2049 7465 7261  , modules: Itera
-00019640: 626c 655b 6e6e 2e4d 6f64 756c 655d 2920  ble[nn.Module]) 
-00019650: 2d3e 2027 4d6f 6475 6c65 4c69 7374 273a  -> 'ModuleList':
-00019660: 0d0a 2020 2020 2020 2020 7222 2222 4170  ..        r"""Ap
-00019670: 7065 6e64 7320 6d6f 6475 6c65 7320 6672  pends modules fr
-00019680: 6f6d 2061 2050 7974 686f 6e20 6974 6572  om a Python iter
-00019690: 6162 6c65 2074 6f20 7468 6520 656e 6420  able to the end 
-000196a0: 6f66 2074 6865 206c 6973 742e 0d0a 0d0a  of the list.....
-000196b0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
-000196c0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-000196d0: 6573 2028 6974 6572 6162 6c65 293a 2069  es (iterable): i
-000196e0: 7465 7261 626c 6520 6f66 206d 6f64 756c  terable of modul
-000196f0: 6573 2074 6f20 6170 7065 6e64 0d0a 2020  es to append..  
-00019700: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00019710: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00019720: 616e 6365 286d 6f64 756c 6573 2c20 636f  ance(modules, co
-00019730: 6e74 6169 6e65 725f 6162 6373 2e49 7465  ntainer_abcs.Ite
-00019740: 7261 626c 6529 3a0d 0a20 2020 2020 2020  rable):..       
-00019750: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00019760: 7272 6f72 2822 4d6f 6475 6c65 4c69 7374  rror("ModuleList
-00019770: 2e65 7874 656e 6420 7368 6f75 6c64 2062  .extend should b
-00019780: 6520 6361 6c6c 6564 2077 6974 6820 616e  e called with an
-00019790: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+000169f0: 2020 2020 2020 2020 2020 6973 5f73 696e            is_sin
+00016a00: 676c 6574 6f6e 3d46 616c 7365 290d 0a20  gleton=False).. 
+00016a10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00016a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016a30: 2020 6f75 7420 3d20 656e 666f 7263 655f    out = enforce_
+00016a40: 7369 6e67 6c65 746f 6e28 6f75 7429 0d0a  singleton(out)..
+00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a60: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
+00016a70: 7065 203d 2074 656e 736f 725f 746f 5f73  pe = tensor_to_s
+00016a80: 6861 7065 286f 7574 2c20 6e65 6564 5f65  hape(out, need_e
+00016a90: 7863 6c75 6465 5f62 6174 6368 5f61 7869  xclude_batch_axi
+00016aa0: 733d 5472 7565 2c20 6973 5f73 696e 676c  s=True, is_singl
+00016ab0: 6574 6f6e 3d46 616c 7365 290d 0a20 2020  eton=False)..   
+00016ac0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00016ad0: 662e 5f73 6967 6e61 7475 7265 2e6f 7574  f._signature.out
+00016ae0: 7075 7473 5b73 656c 662e 5f73 6967 6e61  puts[self._signa
+00016af0: 7475 7265 2e6f 7574 7075 7473 2e6b 6579  ture.outputs.key
+00016b00: 5f6c 6973 745b 305d 5d2e 7368 6170 6520  _list[0]].shape 
+00016b10: 3d20 7365 6c66 2e5f 6f75 7470 7574 5f73  = self._output_s
+00016b20: 6861 7065 0d0a 2020 2020 2020 2020 2020  hape..          
+00016b30: 2020 2020 2020 2320 6966 206c 656e 2873        # if len(s
+00016b40: 656c 662e 6765 745f 726f 6f74 2829 2e73  elf.get_root().s
+00016b50: 6967 6e61 7475 7265 2e6f 7574 7075 7473  ignature.outputs
+00016b60: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
+00016b70: 2020 2020 2020 2020 2320 2020 2020 7365          #     se
+00016b80: 6c66 2e67 6574 5f72 6f6f 7428 292e 7369  lf.get_root().si
+00016b90: 676e 6174 7572 653d 6765 745f 7369 676e  gnature=get_sign
+00016ba0: 6174 7572 6528 7365 6c66 290d 0a20 2020  ature(self)..   
+00016bb0: 2020 2020 2020 2020 2020 2020 2023 2065               # e
+00016bc0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00016bd0: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
+00016be0: 2e67 6574 5f72 6f6f 7428 292e 7369 676e  .get_root().sign
+00016bf0: 6174 7572 652e 6f75 7470 7574 735b 276f  ature.outputs['o
+00016c00: 7574 7075 7427 5d20 3d20 7365 6c66 2e5f  utput'] = self._
+00016c10: 6f75 7470 7574 5f73 6861 7065 2e63 6f70  output_shape.cop
+00016c20: 7928 290d 0a0d 0a20 2020 2020 2020 2065  y()....        e
+00016c30: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00016c40: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00016c50: 286d 6f64 756c 652c 2027 5f73 6967 6e61  (module, '_signa
+00016c60: 7475 7265 2729 206f 7220 6d6f 6475 6c65  ture') or module
+00016c70: 2e5f 7369 676e 6174 7572 6520 6973 204e  ._signature is N
+00016c80: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00016c90: 2020 2020 2020 6d6f 6475 6c65 2e5f 7369        module._si
+00016ca0: 676e 6174 7572 6520 3d20 6765 745f 7369  gnature = get_si
+00016cb0: 676e 6174 7572 6528 6d6f 6475 6c65 290d  gnature(module).
+00016cc0: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
+00016cd0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+00016ce0: 286d 6f64 756c 652e 5f73 6967 6e61 7475  (module._signatu
+00016cf0: 7265 290d 0a20 2020 2020 2020 2020 2020  re)..           
+00016d00: 2073 7570 6572 2853 6571 7565 6e74 6961   super(Sequentia
+00016d10: 6c2c 2073 656c 6629 2e61 6464 5f6d 6f64  l, self).add_mod
+00016d20: 756c 6528 6e61 6d65 2c20 6d6f 6475 6c65  ule(name, module
+00016d30: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00016d40: 6620 6c65 6e28 7365 6c66 2920 3d3d 2031  f len(self) == 1
+00016d50: 206f 7220 7365 6c66 2e5f 7369 676e 6174   or self._signat
+00016d60: 7572 6520 6973 204e 6f6e 653a 0d0a 2020  ure is None:..  
+00016d70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00016d80: 6c66 2e5f 7369 676e 6174 7572 6520 3d20  lf._signature = 
+00016d90: 7369 670d 0a20 2020 2020 2020 2020 2020  sig..           
+00016da0: 2065 6c69 6620 6c65 6e28 7365 6c66 2920   elif len(self) 
+00016db0: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
+00016dc0: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
+00016dd0: 6174 7572 652e 6f75 7470 7574 7320 3d20  ature.outputs = 
+00016de0: 636f 7079 2e64 6565 7063 6f70 7928 7369  copy.deepcopy(si
+00016df0: 672e 6f75 7470 7574 7329 0d0a 0d0a 2020  g.outputs)....  
+00016e00: 2020 6465 6620 7265 6d6f 7665 5f61 7428    def remove_at(
+00016e10: 7365 6c66 2c20 6964 7829 3a0d 0a20 2020  self, idx):..   
+00016e20: 2020 2020 2073 656c 662e 5f5f 6465 6c69       self.__deli
+00016e30: 7465 6d5f 5f28 6964 7829 0d0a 0d0a 2020  tem__(idx)....  
+00016e40: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00016e50: 662e 5f6d 6f64 756c 6573 2920 3e20 303a  f._modules) > 0:
+00016e60: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00016e70: 6c66 2e5f 6f75 7470 7574 5f73 6861 7065  lf._output_shape
+00016e80: 203d 2073 656c 665b 2d31 5d2e 5f6f 7574   = self[-1]._out
+00016e90: 7075 745f 7368 6170 650d 0a20 2020 2020  put_shape..     
+00016ea0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00016eb0: 616e 6365 2873 656c 662e 5f73 6967 6e61  ance(self._signa
+00016ec0: 7475 7265 2c20 5369 676e 6174 7572 6529  ture, Signature)
+00016ed0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00016ee0: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
+00016ef0: 7265 2e6f 7574 7075 7473 5b73 656c 662e  re.outputs[self.
+00016f00: 5f73 6967 6e61 7475 7265 2e6f 7574 7075  _signature.outpu
+00016f10: 7473 2e6b 6579 5f6c 6973 745b 305d 5d2e  ts.key_list[0]].
+00016f20: 7368 6170 6520 3d20 7365 6c66 5b2d 315d  shape = self[-1]
+00016f30: 2e5f 6f75 7470 7574 5f73 6861 7065 0d0a  ._output_shape..
+00016f40: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
+00016f50: 5f69 7465 6d5f 6279 5f69 6478 2873 656c  _item_by_idx(sel
+00016f60: 662c 2069 7465 7261 746f 722c 2069 6478  f, iterator, idx
+00016f70: 2920 2d3e 2054 3a0d 0a20 2020 2020 2020  ) -> T:..       
+00016f80: 2022 2222 4765 7420 7468 6520 6964 782d   """Get the idx-
+00016f90: 7468 2069 7465 6d20 6f66 2074 6865 2069  th item of the i
+00016fa0: 7465 7261 746f 7222 2222 0d0a 2020 2020  terator"""..    
+00016fb0: 2020 2020 7369 7a65 203d 206c 656e 2873      size = len(s
+00016fc0: 656c 6629 0d0a 2020 2020 2020 2020 6964  elf)..        id
+00016fd0: 7820 3d20 6f70 6572 6174 6f72 2e69 6e64  x = operator.ind
+00016fe0: 6578 2869 6478 290d 0a20 2020 2020 2020  ex(idx)..       
+00016ff0: 2069 6620 6e6f 7420 2d73 697a 6520 3c3d   if not -size <=
+00017000: 2069 6478 203c 2073 697a 653a 0d0a 2020   idx < size:..  
+00017010: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00017020: 496e 6465 7845 7272 6f72 2827 696e 6465  IndexError('inde
+00017030: 7820 7b7d 2069 7320 6f75 7420 6f66 2072  x {} is out of r
+00017040: 616e 6765 272e 666f 726d 6174 2869 6478  ange'.format(idx
+00017050: 2929 0d0a 2020 2020 2020 2020 6964 7820  ))..        idx 
+00017060: 253d 2073 697a 650d 0a20 2020 2020 2020  %= size..       
+00017070: 2072 6574 7572 6e20 6e65 7874 2869 736c   return next(isl
+00017080: 6963 6528 6974 6572 6174 6f72 2c20 6964  ice(iterator, id
+00017090: 782c 204e 6f6e 6529 290d 0a0d 0a0d 0a0d  x, None)).......
+000170a0: 0a20 2020 2040 5f63 6f70 795f 746f 5f73  .    @_copy_to_s
+000170b0: 6372 6970 745f 7772 6170 7065 720d 0a20  cript_wrapper.. 
+000170c0: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
+000170d0: 5f5f 2873 656c 662c 2069 6478 293a 0d0a  __(self, idx):..
+000170e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000170f0: 7461 6e63 6528 6964 782c 2073 6c69 6365  tance(idx, slice
+00017100: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00017110: 7265 7475 726e 2073 656c 662e 5f5f 636c  return self.__cl
+00017120: 6173 735f 5f28 4f72 6465 7265 6444 6963  ass__(OrderedDic
+00017130: 7428 6c69 7374 2873 656c 662e 5f6d 6f64  t(list(self._mod
+00017140: 756c 6573 2e69 7465 6d73 2829 295b 6964  ules.items())[id
+00017150: 785d 2929 0d0a 2020 2020 2020 2020 656c  x]))..        el
+00017160: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00017170: 2072 6574 7572 6e20 7365 6c66 2e5f 6765   return self._ge
+00017180: 745f 6974 656d 5f62 795f 6964 7828 7365  t_item_by_idx(se
+00017190: 6c66 2e5f 6d6f 6475 6c65 732e 7661 6c75  lf._modules.valu
+000171a0: 6573 2829 2c20 6964 7829 0d0a 0d0a 0d0a  es(), idx)......
+000171b0: 0d0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
+000171c0: 7465 6d5f 5f28 7365 6c66 2c20 6964 782c  tem__(self, idx,
+000171d0: 206d 6f64 756c 6529 3a0d 0a20 2020 2020   module):..     
+000171e0: 2020 206b 6579 3a20 7374 7220 3d20 7365     key: str = se
+000171f0: 6c66 2e5f 6765 745f 6974 656d 5f62 795f  lf._get_item_by_
+00017200: 6964 7828 7365 6c66 2e5f 6d6f 6475 6c65  idx(self._module
+00017210: 732e 6b65 7973 2829 2c20 6964 7829 0d0a  s.keys(), idx)..
+00017220: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00017230: 6574 6174 7472 2873 656c 662c 206b 6579  etattr(self, key
+00017240: 2c20 6d6f 6475 6c65 290d 0a0d 0a20 2020  , module)....   
+00017250: 2064 6566 205f 5f64 656c 6974 656d 5f5f   def __delitem__
+00017260: 2873 656c 662c 2069 6478 293a 0d0a 2020  (self, idx):..  
+00017270: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00017280: 6e63 6528 6964 782c 2073 6c69 6365 293a  nce(idx, slice):
+00017290: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+000172a0: 7220 6b65 7920 696e 206c 6973 7428 7365  r key in list(se
+000172b0: 6c66 2e5f 6d6f 6475 6c65 732e 6b65 7973  lf._modules.keys
+000172c0: 2829 295b 6964 785d 3a0d 0a20 2020 2020  ())[idx]:..     
+000172d0: 2020 2020 2020 2020 2020 2064 656c 6174             delat
+000172e0: 7472 2873 656c 662c 206b 6579 290d 0a20  tr(self, key).. 
+000172f0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00017300: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
+00017310: 7365 6c66 2e5f 6765 745f 6974 656d 5f62  self._get_item_b
+00017320: 795f 6964 7828 7365 6c66 2e5f 6d6f 6475  y_idx(self._modu
+00017330: 6c65 732e 6b65 7973 2829 2c20 6964 7829  les.keys(), idx)
+00017340: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00017350: 6c61 7474 7228 7365 6c66 2c20 6b65 7929  lattr(self, key)
+00017360: 0d0a 0d0a 2020 2020 2020 2020 2320 546f  ....        # To
+00017370: 2070 7265 7365 7276 6520 6e75 6d62 6572   preserve number
+00017380: 696e 670d 0a20 2020 2020 2020 2023 2073  ing..        # s
+00017390: 7472 5f69 6e64 6963 6573 203d 205b 7374  tr_indices = [st
+000173a0: 7228 6929 2066 6f72 2069 2069 6e20 7261  r(i) for i in ra
+000173b0: 6e67 6528 6c65 6e28 7365 6c66 2e5f 6d6f  nge(len(self._mo
+000173c0: 6475 6c65 7329 295d 0d0a 2020 2020 2020  dules))]..      
+000173d0: 2020 2320 7365 6c66 2e5f 6d6f 6475 6c65    # self._module
+000173e0: 7320 3d20 4f72 6465 7265 6444 6963 7428  s = OrderedDict(
+000173f0: 6c69 7374 287a 6970 2873 7472 5f69 6e64  list(zip(str_ind
+00017400: 6963 6573 2c20 7365 6c66 2e5f 6d6f 6475  ices, self._modu
+00017410: 6c65 732e 7661 6c75 6573 2829 2929 290d  les.values()))).
+00017420: 0a0d 0a20 2020 2040 5f63 6f70 795f 746f  ...    @_copy_to
+00017430: 5f73 6372 6970 745f 7772 6170 7065 720d  _script_wrapper.
+00017440: 0a20 2020 2064 6566 205f 5f6c 656e 5f5f  .    def __len__
+00017450: 2873 656c 6629 202d 3e20 696e 743a 0d0a  (self) -> int:..
+00017460: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00017470: 656e 2873 656c 662e 5f6d 6f64 756c 6573  en(self._modules
+00017480: 290d 0a0d 0a0d 0a20 2020 2064 6566 205f  )......    def _
+00017490: 5f61 6464 5f5f 2873 656c 662c 206f 7468  _add__(self, oth
+000174a0: 6572 2920 2d3e 2027 5365 7175 656e 7469  er) -> 'Sequenti
+000174b0: 616c 273a 0d0a 2020 2020 2020 2020 6966  al':..        if
+000174c0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+000174d0: 722c 2053 6571 7565 6e74 6961 6c29 3a0d  r, Sequential):.
+000174e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000174f0: 203d 2053 6571 7565 6e74 6961 6c28 290d   = Sequential().
+00017500: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00017510: 206c 6179 6572 2069 6e20 7365 6c66 3a0d   layer in self:.
+00017520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017530: 2072 6574 2e61 7070 656e 6428 6c61 7965   ret.append(laye
+00017540: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+00017550: 666f 7220 6c61 7965 7220 696e 206f 7468  for layer in oth
+00017560: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
+00017570: 2020 2020 2072 6574 2e61 7070 656e 6428       ret.append(
+00017580: 6c61 7965 7229 0d0a 2020 2020 2020 2020  layer)..        
+00017590: 2020 2020 7265 7475 726e 2072 6574 0d0a      return ret..
+000175a0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000175b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000175c0: 2056 616c 7565 4572 726f 7228 2761 6464   ValueError('add
+000175d0: 206f 7065 7261 746f 7220 7375 7070 6f72   operator suppor
+000175e0: 7473 206f 6e6c 7920 6f62 6a65 6374 7320  ts only objects 
+000175f0: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017610: 276f 6620 5365 7175 656e 7469 616c 2063  'of Sequential c
+00017620: 6c61 7373 2c20 6275 7420 7b7d 2069 7320  lass, but {} is 
+00017630: 6769 7665 6e2e 272e 666f 726d 6174 280d  given.'.format(.
+00017640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017660: 2020 7374 7228 7479 7065 286f 7468 6572    str(type(other
+00017670: 2929 2929 0d0a 0d0a 2020 2020 6465 6620  ))))....    def 
+00017680: 706f 7028 7365 6c66 2c20 6b65 793a 2055  pop(self, key: U
+00017690: 6e69 6f6e 5b69 6e74 2c20 736c 6963 655d  nion[int, slice]
+000176a0: 2920 2d3e 206e 6e2e 4d6f 6475 6c65 3a0d  ) -> nn.Module:.
+000176b0: 0a20 2020 2020 2020 2076 203d 2073 656c  .        v = sel
+000176c0: 665b 6b65 795d 0d0a 2020 2020 2020 2020  f[key]..        
+000176d0: 6465 6c20 7365 6c66 5b6b 6579 5d0d 0a20  del self[key].. 
+000176e0: 2020 2020 2020 2072 6574 7572 6e20 760d         return v.
+000176f0: 0a0d 0a20 2020 2064 6566 205f 5f69 6164  ...    def __iad
+00017700: 645f 5f28 7365 6c66 2c20 6f74 6865 7229  d__(self, other)
+00017710: 202d 3e20 2753 6571 7565 6e74 6961 6c27   -> 'Sequential'
+00017720: 3a0d 0a20 2020 2020 2020 2069 6620 6973  :..        if is
+00017730: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
+00017740: 5365 7175 656e 7469 616c 293a 0d0a 2020  Sequential):..  
+00017750: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
+00017760: 203d 206c 656e 2873 656c 6629 0d0a 2020   = len(self)..  
+00017770: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+00017780: 206d 6f64 756c 6520 696e 2065 6e75 6d65   module in enume
+00017790: 7261 7465 286f 7468 6572 293a 0d0a 2020  rate(other):..  
+000177a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000177b0: 6c66 2e61 6464 5f6d 6f64 756c 6528 7374  lf.add_module(st
+000177c0: 7228 6920 2b20 6f66 6673 6574 292c 206d  r(i + offset), m
+000177d0: 6f64 756c 6529 0d0a 2020 2020 2020 2020  odule)..        
+000177e0: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+000177f0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00017800: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00017810: 6520 5661 6c75 6545 7272 6f72 2827 6164  e ValueError('ad
+00017820: 6420 6f70 6572 6174 6f72 2073 7570 706f  d operator suppo
+00017830: 7274 7320 6f6e 6c79 206f 626a 6563 7473  rts only objects
+00017840: 2027 0d0a 2020 2020 2020 2020 2020 2020   '..            
+00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017860: 2027 6f66 2053 6571 7565 6e74 6961 6c20   'of Sequential 
+00017870: 636c 6173 732c 2062 7574 207b 7d20 6973  class, but {} is
+00017880: 2067 6976 656e 2e27 2e66 6f72 6d61 7428   given.'.format(
+00017890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000178a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178b0: 2020 2073 7472 2874 7970 6528 6f74 6865     str(type(othe
+000178c0: 7229 2929 290d 0a0d 0a20 2020 2064 6566  r))))....    def
+000178d0: 205f 5f6d 756c 5f5f 2873 656c 662c 206f   __mul__(self, o
+000178e0: 7468 6572 3a20 696e 7429 202d 3e20 2753  ther: int) -> 'S
+000178f0: 6571 7565 6e74 6961 6c27 3a0d 0a20 2020  equential':..   
+00017900: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00017910: 7374 616e 6365 286f 7468 6572 2c20 696e  stance(other, in
+00017920: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00017930: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00017940: 2866 2275 6e73 7570 706f 7274 6564 206f  (f"unsupported o
+00017950: 7065 7261 6e64 2074 7970 6528 7329 2066  perand type(s) f
+00017960: 6f72 202a 3a20 7b74 7970 6528 7365 6c66  or *: {type(self
+00017970: 297d 2061 6e64 207b 7479 7065 286f 7468  )} and {type(oth
+00017980: 6572 297d 2229 0d0a 2020 2020 2020 2020  er)}")..        
+00017990: 656c 6966 2028 6f74 6865 7220 3c3d 2030  elif (other <= 0
+000179a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000179b0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000179c0: 2866 224e 6f6e 2d70 6f73 6974 6976 6520  (f"Non-positive 
+000179d0: 6d75 6c74 6970 6c69 6361 7469 6f6e 2066  multiplication f
+000179e0: 6163 746f 7220 7b6f 7468 6572 7d20 666f  actor {other} fo
+000179f0: 7220 7b74 7970 6528 7365 6c66 297d 2229  r {type(self)}")
+00017a00: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00017a10: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+00017a20: 6269 6e65 6420 3d20 5365 7175 656e 7469  bined = Sequenti
+00017a30: 616c 2829 0d0a 2020 2020 2020 2020 2020  al()..          
+00017a40: 2020 6f66 6673 6574 203d 2030 0d0a 2020    offset = 0..  
+00017a50: 2020 2020 2020 2020 2020 666f 7220 5f20            for _ 
+00017a60: 696e 2072 616e 6765 286f 7468 6572 293a  in range(other):
+00017a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017a80: 2020 666f 7220 6d6f 6475 6c65 2069 6e20    for module in 
+00017a90: 7365 6c66 3a0d 0a20 2020 2020 2020 2020  self:..         
+00017aa0: 2020 2020 2020 2020 2020 2063 6f6d 6269             combi
+00017ab0: 6e65 642e 6164 645f 6d6f 6475 6c65 2873  ned.add_module(s
+00017ac0: 7472 286f 6666 7365 7429 2c20 6d6f 6475  tr(offset), modu
+00017ad0: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+00017ae0: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
+00017af0: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00017b00: 2020 7265 7475 726e 2063 6f6d 6269 6e65    return combine
+00017b10: 640d 0a0d 0a20 2020 2064 6566 205f 5f72  d....    def __r
+00017b20: 6d75 6c5f 5f28 7365 6c66 2c20 6f74 6865  mul__(self, othe
+00017b30: 723a 2069 6e74 2920 2d3e 2027 5365 7175  r: int) -> 'Sequ
+00017b40: 656e 7469 616c 273a 0d0a 2020 2020 2020  ential':..      
+00017b50: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+00017b60: 6d75 6c5f 5f28 6f74 6865 7229 0d0a 0d0a  mul__(other)....
+00017b70: 2020 2020 6465 6620 5f5f 696d 756c 5f5f      def __imul__
+00017b80: 2873 656c 662c 206f 7468 6572 3a20 696e  (self, other: in
+00017b90: 7429 202d 3e20 2753 6571 7565 6e74 6961  t) -> 'Sequentia
+00017ba0: 6c27 3a0d 0a20 2020 2020 2020 2069 6620  l':..        if 
+00017bb0: 6e6f 7420 6973 696e 7374 616e 6365 286f  not isinstance(o
+00017bc0: 7468 6572 2c20 696e 7429 3a0d 0a20 2020  ther, int):..   
+00017bd0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00017be0: 7970 6545 7272 6f72 2866 2275 6e73 7570  ypeError(f"unsup
+00017bf0: 706f 7274 6564 206f 7065 7261 6e64 2074  ported operand t
+00017c00: 7970 6528 7329 2066 6f72 202a 3a20 7b74  ype(s) for *: {t
+00017c10: 7970 6528 7365 6c66 297d 2061 6e64 207b  ype(self)} and {
+00017c20: 7479 7065 286f 7468 6572 297d 2229 0d0a  type(other)}")..
+00017c30: 2020 2020 2020 2020 656c 6966 2028 6f74          elif (ot
+00017c40: 6865 7220 3c3d 2030 293a 0d0a 2020 2020  her <= 0):..    
+00017c50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00017c60: 6c75 6545 7272 6f72 2866 224e 6f6e 2d70  lueError(f"Non-p
+00017c70: 6f73 6974 6976 6520 6d75 6c74 6970 6c69  ositive multipli
+00017c80: 6361 7469 6f6e 2066 6163 746f 7220 7b6f  cation factor {o
+00017c90: 7468 6572 7d20 666f 7220 7b74 7970 6528  ther} for {type(
+00017ca0: 7365 6c66 297d 2229 0d0a 2020 2020 2020  self)}")..      
+00017cb0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00017cc0: 2020 2020 206c 656e 5f6f 7269 6769 6e61       len_origina
+00017cd0: 6c20 3d20 6c65 6e28 7365 6c66 290d 0a20  l = len(self).. 
+00017ce0: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+00017cf0: 7420 3d20 6c65 6e28 7365 6c66 290d 0a20  t = len(self).. 
+00017d00: 2020 2020 2020 2020 2020 2066 6f72 205f             for _
+00017d10: 2069 6e20 7261 6e67 6528 6f74 6865 7220   in range(other 
+00017d20: 2d20 3129 3a0d 0a20 2020 2020 2020 2020  - 1):..         
+00017d30: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00017d40: 7261 6e67 6528 6c65 6e5f 6f72 6967 696e  range(len_origin
+00017d50: 616c 293a 0d0a 2020 2020 2020 2020 2020  al):..          
+00017d60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00017d70: 6464 5f6d 6f64 756c 6528 7374 7228 6920  dd_module(str(i 
+00017d80: 2b20 6f66 6673 6574 292c 2073 656c 662e  + offset), self.
+00017d90: 5f6d 6f64 756c 6573 5b73 7472 2869 295d  _modules[str(i)]
+00017da0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00017db0: 2020 206f 6666 7365 7420 2b3d 206c 656e     offset += len
+00017dc0: 5f6f 7269 6769 6e61 6c0d 0a20 2020 2020  _original..     
+00017dd0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00017de0: 6c66 0d0a 0d0a 2020 2020 405f 636f 7079  lf....    @_copy
+00017df0: 5f74 6f5f 7363 7269 7074 5f77 7261 7070  _to_script_wrapp
+00017e00: 6572 0d0a 2020 2020 6465 6620 5f5f 6469  er..    def __di
+00017e10: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
+00017e20: 2020 2020 6b65 7973 203d 2073 7570 6572      keys = super
+00017e30: 2853 6571 7565 6e74 6961 6c2c 2073 656c  (Sequential, sel
+00017e40: 6629 2e5f 5f64 6972 5f5f 2829 0d0a 2020  f).__dir__()..  
+00017e50: 2020 2020 2020 6b65 7973 203d 205b 6b65        keys = [ke
+00017e60: 7920 666f 7220 6b65 7920 696e 206b 6579  y for key in key
+00017e70: 7320 6966 206e 6f74 206b 6579 2e69 7364  s if not key.isd
+00017e80: 6967 6974 2829 5d0d 0a20 2020 2020 2020  igit()]..       
+00017e90: 2072 6574 7572 6e20 6b65 7973 0d0a 0d0a   return keys....
+00017ea0: 0d0a 0d0a 0d0a 2020 2020 405f 636f 7079  ......    @_copy
+00017eb0: 5f74 6f5f 7363 7269 7074 5f77 7261 7070  _to_script_wrapp
+00017ec0: 6572 0d0a 2020 2020 6465 6620 5f5f 6974  er..    def __it
+00017ed0: 6572 5f5f 2873 656c 6629 202d 3e20 4974  er__(self) -> It
+00017ee0: 6572 6174 6f72 5b6e 6e2e 4d6f 6475 6c65  erator[nn.Module
+00017ef0: 5d3a 0d0a 2020 2020 2020 2020 7265 7475  ]:..        retu
+00017f00: 726e 2069 7465 7228 7365 6c66 2e5f 6d6f  rn iter(self._mo
+00017f10: 6475 6c65 732e 7661 6c75 6573 2829 290d  dules.values()).
+00017f20: 0a0d 0a0d 0a20 2020 2023 204e 423a 2057  .....    # NB: W
+00017f30: 6520 6361 6e27 7420 7265 616c 6c79 2074  e can't really t
+00017f40: 7970 6520 6368 6563 6b20 7468 6973 2066  ype check this f
+00017f50: 756e 6374 696f 6e20 6173 2074 6865 2074  unction as the t
+00017f60: 7970 6520 6f66 2069 6e70 7574 0d0a 2020  ype of input..  
+00017f70: 2020 2320 6d61 7920 6368 616e 6765 2064    # may change d
+00017f80: 796e 616d 6963 616c 6c79 2028 6173 2069  ynamically (as i
+00017f90: 7320 7465 7374 6564 2069 6e0d 0a20 2020  s tested in..   
+00017fa0: 2023 2054 6573 7453 6372 6970 742e 7465   # TestScript.te
+00017fb0: 7374 5f73 6571 7565 6e74 6961 6c5f 696e  st_sequential_in
+00017fc0: 7465 726d 6564 6961 7279 5f74 7970 6573  termediary_types
+00017fd0: 292e 2020 4361 6e6e 6f74 2061 6e6e 6f74  ).  Cannot annot
+00017fe0: 6174 650d 0a20 2020 2023 2077 6974 6820  ate..    # with 
+00017ff0: 416e 7920 6173 2054 6f72 6368 5363 7269  Any as TorchScri
+00018000: 7074 2065 7870 6563 7473 2061 206d 6f72  pt expects a mor
+00018010: 6520 7072 6563 6973 6520 7479 7065 0d0a  e precise type..
+00018020: 2020 2020 2320 6465 6620 666f 7277 6172      # def forwar
+00018030: 6428 7365 6c66 2c20 696e 7075 7429 3a0d  d(self, input):.
+00018040: 0a20 2020 2023 2020 2020 2066 6f72 206d  .    #     for m
+00018050: 6f64 756c 6520 696e 2073 656c 663a 0d0a  odule in self:..
+00018060: 2020 2020 2320 2020 2020 2020 2020 696e      #         in
+00018070: 7075 7420 3d20 6d6f 6475 6c65 2869 6e70  put = module(inp
+00018080: 7574 290d 0a20 2020 2023 2020 2020 2072  ut)..    #     r
+00018090: 6574 7572 6e20 696e 7075 740d 0a0d 0a20  eturn input.... 
+000180a0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+000180b0: 656c 662c 202a 782c 202a 2a6b 7761 7267  elf, *x, **kwarg
+000180c0: 7329 3a0d 0a20 2020 2020 2020 2078 203d  s):..        x =
+000180d0: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+000180e0: 6e28 7829 0d0a 2020 2020 2020 2020 666f  n(x)..        fo
+000180f0: 7220 6d6f 6475 6c65 2069 6e20 7365 6c66  r module in self
+00018100: 2e5f 6d6f 6475 6c65 732e 7661 6c75 6573  ._modules.values
+00018110: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00018120: 2023 2078 203d 2065 6e66 6f72 6365 5f73   # x = enforce_s
+00018130: 696e 676c 6574 6f6e 2878 290d 0a20 2020  ingleton(x)..   
+00018140: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00018150: 7374 616e 6365 2878 2c20 7475 706c 6529  stance(x, tuple)
+00018160: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00018170: 2020 2078 203d 206d 6f64 756c 6528 2a78     x = module(*x
+00018180: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
+00018190: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000181a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181b0: 7820 3d20 6d6f 6475 6c65 2878 2c20 2a2a  x = module(x, **
+000181c0: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+000181d0: 2020 2020 2023 2063 6c61 7373 5f6e 616d       # class_nam
+000181e0: 653d 6d6f 6475 6c65 2e5f 5f63 6c61 7373  e=module.__class
+000181f0: 5f5f 2e5f 5f6e 616d 655f 5f2e 6c6f 7765  __.__name__.lowe
+00018200: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+00018210: 2023 2069 6620 276c 7374 6d27 2069 6e20   # if 'lstm' in 
+00018220: 636c 6173 735f 6e61 6d65 206f 7220 2767  class_name or 'g
+00018230: 7275 2720 696e 2063 6c61 7373 5f6e 616d  ru' in class_nam
+00018240: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00018250: 2320 2020 2020 6966 2069 7369 6e73 7461  #     if isinsta
+00018260: 6e63 6528 782c 7475 706c 6529 3a0d 0a20  nce(x,tuple):.. 
+00018270: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00018280: 2020 2020 2078 2c68 783d 780d 0a20 2020       x,hx=x..   
+00018290: 2020 2020 2020 2020 2023 2020 2020 2020           #      
+000182a0: 2020 206b 7761 7267 735b 2768 7827 5d3d     kwargs['hx']=
+000182b0: 6878 0d0a 0d0a 2020 2020 2020 2020 7265  hx....        re
+000182c0: 7475 726e 2078 0d0a 0d0a 0d0a 2020 2020  turn x......    
+000182d0: 6465 6620 6170 7065 6e64 2873 656c 662c  def append(self,
+000182e0: 206d 6f64 756c 653a 206e 6e2e 4d6f 6475   module: nn.Modu
+000182f0: 6c65 2920 2d3e 2027 5365 7175 656e 7469  le) -> 'Sequenti
+00018300: 616c 273a 0d0a 2020 2020 2020 2020 7222  al':..        r"
+00018310: 2222 4170 7065 6e64 7320 6120 6769 7665  ""Appends a give
+00018320: 6e20 6d6f 6475 6c65 2074 6f20 7468 6520  n module to the 
+00018330: 656e 642e 0d0a 0d0a 2020 2020 2020 2020  end.....        
+00018340: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+00018350: 2020 206d 6f64 756c 6520 286e 6e2e 4d6f     module (nn.Mo
+00018360: 6475 6c65 293a 206d 6f64 756c 6520 746f  dule): module to
+00018370: 2061 7070 656e 640d 0a20 2020 2020 2020   append..       
+00018380: 2022 2222 0d0a 2020 2020 2020 2020 7365   """..        se
+00018390: 6c66 2e61 6464 5f6d 6f64 756c 6528 7374  lf.add_module(st
+000183a0: 7228 6c65 6e28 7365 6c66 2929 2c20 6d6f  r(len(self)), mo
+000183b0: 6475 6c65 290d 0a20 2020 2020 2020 2072  dule)..        r
+000183c0: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
+000183d0: 2020 6465 6620 696e 7365 7274 2873 656c    def insert(sel
+000183e0: 662c 2069 6e64 6578 3a20 696e 742c 206d  f, index: int, m
+000183f0: 6f64 756c 653a 206e 6e2e 4d6f 6475 6c65  odule: nn.Module
+00018400: 2920 2d3e 2027 5365 7175 656e 7469 616c  ) -> 'Sequential
+00018410: 273a 0d0a 2020 2020 2020 2020 6966 206e  ':..        if n
+00018420: 6f74 2069 7369 6e73 7461 6e63 6528 6d6f  ot isinstance(mo
+00018430: 6475 6c65 2c20 4d6f 6475 6c65 293a 0d0a  dule, Module):..
+00018440: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00018450: 6520 4173 7365 7274 696f 6e45 7272 6f72  e AssertionError
+00018460: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00018470: 2020 2027 6d6f 6475 6c65 2073 686f 756c     'module shoul
+00018480: 6420 6265 206f 6620 7479 7065 3a20 7b7d  d be of type: {}
+00018490: 272e 666f 726d 6174 284d 6f64 756c 6529  '.format(Module)
+000184a0: 290d 0a20 2020 2020 2020 206e 203d 206c  )..        n = l
+000184b0: 656e 2873 656c 662e 5f6d 6f64 756c 6573  en(self._modules
+000184c0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+000184d0: 7420 282d 6e20 3c3d 2069 6e64 6578 203c  t (-n <= index <
+000184e0: 3d20 6e29 3a0d 0a20 2020 2020 2020 2020  = n):..         
+000184f0: 2020 2072 6169 7365 2049 6e64 6578 4572     raise IndexEr
+00018500: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
+00018510: 2020 2020 2020 2749 6e64 6578 206f 7574        'Index out
+00018520: 206f 6620 7261 6e67 653a 207b 7d27 2e66   of range: {}'.f
+00018530: 6f72 6d61 7428 696e 6465 7829 290d 0a20  ormat(index)).. 
+00018540: 2020 2020 2020 2069 6620 696e 6465 7820         if index 
+00018550: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
+00018560: 2020 696e 6465 7820 2b3d 206e 0d0a 2020    index += n..  
+00018570: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00018580: 616e 6765 286e 2c20 696e 6465 782c 202d  ange(n, index, -
+00018590: 3129 3a0d 0a20 2020 2020 2020 2020 2020  1):..           
+000185a0: 2073 656c 662e 5f6d 6f64 756c 6573 5b73   self._modules[s
+000185b0: 7472 2869 295d 203d 2073 656c 662e 5f6d  tr(i)] = self._m
+000185c0: 6f64 756c 6573 5b73 7472 2869 202d 2031  odules[str(i - 1
+000185d0: 295d 0d0a 2020 2020 2020 2020 7365 6c66  )]..        self
+000185e0: 2e5f 6d6f 6475 6c65 735b 7374 7228 696e  ._modules[str(in
+000185f0: 6465 7829 5d20 3d20 6d6f 6475 6c65 0d0a  dex)] = module..
+00018600: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00018610: 656c 660d 0a0d 0a20 2020 2064 6566 2065  elf....    def e
+00018620: 7874 656e 6428 7365 6c66 2c20 7365 7175  xtend(self, sequ
+00018630: 656e 7469 616c 2920 2d3e 2027 5365 7175  ential) -> 'Sequ
+00018640: 656e 7469 616c 273a 0d0a 2020 2020 2020  ential':..      
+00018650: 2020 666f 7220 6c61 7965 7220 696e 2073    for layer in s
+00018660: 6571 7565 6e74 6961 6c3a 0d0a 2020 2020  equential:..    
+00018670: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
+00018680: 656e 6428 6c61 7965 7229 0d0a 2020 2020  end(layer)..    
+00018690: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+000186a0: 0a0d 0a0d 0a0d 0a0d 0a63 6c61 7373 204d  .........class M
+000186b0: 6f64 756c 654c 6973 7428 4c61 7965 7229  oduleList(Layer)
+000186c0: 3a0d 0a20 2020 2022 2222 486f 6c64 7320  :..    """Holds 
+000186d0: 7375 626d 6f64 756c 6573 2069 6e20 6120  submodules in a 
+000186e0: 6c69 7374 2e0d 0a0d 0a20 2020 203a 636c  list.....    :cl
+000186f0: 6173 733a 607e 746f 7263 682e 6e6e 2e4d  ass:`~torch.nn.M
+00018700: 6f64 756c 654c 6973 7460 2063 616e 2062  oduleList` can b
+00018710: 6520 696e 6465 7865 6420 6c69 6b65 2061  e indexed like a
+00018720: 2072 6567 756c 6172 2050 7974 686f 6e20   regular Python 
+00018730: 6c69 7374 2c20 6275 740d 0a20 2020 206d  list, but..    m
+00018740: 6f64 756c 6573 2069 7420 636f 6e74 6169  odules it contai
+00018750: 6e73 2061 7265 2070 726f 7065 726c 7920  ns are properly 
+00018760: 7265 6769 7374 6572 6564 2c20 616e 6420  registered, and 
+00018770: 7769 6c6c 2062 6520 7669 7369 626c 6520  will be visible 
+00018780: 6279 2061 6c6c 0d0a 2020 2020 3a63 6c61  by all..    :cla
+00018790: 7373 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f  ss:`~torch.nn.Mo
+000187a0: 6475 6c65 6020 6d65 7468 6f64 732e 0d0a  dule` methods...
+000187b0: 0d0a 2020 2020 4172 6773 3a0d 0a20 2020  ..    Args:..   
+000187c0: 2020 2020 206d 6f64 756c 6573 2028 6974       modules (it
+000187d0: 6572 6162 6c65 2c20 6f70 7469 6f6e 616c  erable, optional
+000187e0: 293a 2061 6e20 6974 6572 6162 6c65 206f  ): an iterable o
+000187f0: 6620 6d6f 6475 6c65 7320 746f 2061 6464  f modules to add
+00018800: 0d0a 0d0a 2020 2020 4578 616d 706c 6573  ....    Examples
+00018810: 3a0d 0a0d 0a20 2020 2020 2020 2063 6c61  :....        cla
+00018820: 7373 204d 794d 6f64 756c 6528 6e6e 2e4d  ss MyModule(nn.M
+00018830: 6f64 756c 6529 3a0d 0a20 2020 2020 2020  odule):..       
+00018840: 2020 2020 2064 6566 205f 5f69 6e69 745f       def __init_
+00018850: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00018860: 2020 2020 2020 2020 2020 7375 7065 7228            super(
+00018870: 4d79 4d6f 6475 6c65 2c20 7365 6c66 292e  MyModule, self).
+00018880: 5f5f 696e 6974 5f5f 2829 0d0a 2020 2020  __init__()..    
+00018890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000188a0: 2e6c 696e 6561 7273 203d 206e 6e2e 4d6f  .linears = nn.Mo
+000188b0: 6475 6c65 4c69 7374 285b 6e6e 2e4c 696e  duleList([nn.Lin
+000188c0: 6561 7228 3130 2c20 3130 2920 666f 7220  ear(10, 10) for 
+000188d0: 6920 696e 2072 616e 6765 2831 3029 5d29  i in range(10)])
+000188e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000188f0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
+00018900: 2c20 782c 202a 2a6b 7761 7267 7329 3a0d  , x, **kwargs):.
+00018910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018920: 2023 204d 6f64 756c 654c 6973 7420 6361   # ModuleList ca
+00018930: 6e20 6163 7420 6173 2061 6e20 6974 6572  n act as an iter
+00018940: 6162 6c65 2c20 6f72 2062 6520 696e 6465  able, or be inde
+00018950: 7865 6420 7573 696e 6720 696e 7473 0d0a  xed using ints..
+00018960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018970: 666f 7220 692c 206c 2069 6e20 656e 756d  for i, l in enum
+00018980: 6572 6174 6528 7365 6c66 2e6c 696e 6561  erate(self.linea
+00018990: 7273 293a 0d0a 2020 2020 2020 2020 2020  rs):..          
+000189a0: 2020 2020 2020 2020 2020 7820 3d20 7365            x = se
+000189b0: 6c66 2e6c 696e 6561 7273 5b69 202f 2f20  lf.linears[i // 
+000189c0: 325d 2878 2920 2b20 6c28 7829 0d0a 2020  2](x) + l(x)..  
+000189d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000189e0: 7475 726e 2078 0d0a 2020 2020 2222 220d  turn x..    """.
+000189f0: 0a0d 0a0d 0a20 2020 205f 6d6f 6475 6c65  .....    _module
+00018a00: 733a 2044 6963 745b 7374 722c 206e 6e2e  s: Dict[str, nn.
+00018a10: 4d6f 6475 6c65 5d20 2023 2074 7970 653a  Module]  # type:
+00018a20: 2069 676e 6f72 655b 6173 7369 676e 6d65   ignore[assignme
+00018a30: 6e74 5d0d 0a20 2020 2064 6566 205f 5f69  nt]..    def __i
+00018a40: 6e69 745f 5f28 7365 6c66 2c20 206d 6f64  nit__(self,  mod
+00018a50: 756c 6573 3a20 4f70 7469 6f6e 616c 5b49  ules: Optional[I
+00018a60: 7465 7261 626c 655b 6e6e 2e4d 6f64 756c  terable[nn.Modul
+00018a70: 655d 5d20 3d20 4e6f 6e65 2c20 6e61 6d65  e]] = None, name
+00018a80: 3d4e 6f6e 652c 206b 6565 705f 6f75 7470  =None, keep_outp
+00018a90: 7574 3d46 616c 7365 293a 0d0a 2020 2020  ut=False):..    
+00018aa0: 2020 2020 7375 7065 7228 292e 5f5f 7365      super().__se
+00018ab0: 7461 7474 725f 5f28 275f 6d6f 6475 6c65  tattr__('_module
+00018ac0: 7327 2c20 4f72 6465 7265 6444 6963 7428  s', OrderedDict(
+00018ad0: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
+00018ae0: 7228 4d6f 6475 6c65 4c69 7374 2c20 7365  r(ModuleList, se
+00018af0: 6c66 292e 5f5f 696e 6974 5f5f 286e 616d  lf).__init__(nam
+00018b00: 653d 6e61 6d65 2c20 6b65 6570 5f6f 7574  e=name, keep_out
+00018b10: 7075 743d 6b65 6570 5f6f 7574 7075 7429  put=keep_output)
+00018b20: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
+00018b30: 7569 6420 3d20 7575 6964 2e75 7569 6434  uid = uuid.uuid4
+00018b40: 2829 2e6e 6f64 650d 0a20 2020 2020 2020  ().node..       
+00018b50: 2073 656c 662e 5f6e 616d 6520 3d20 6e61   self._name = na
+00018b60: 6d65 0d0a 0d0a 2020 2020 2020 2020 7374  me....        st
+00018b70: 6172 745f 6964 7820 3d20 6c65 6e28 7365  art_idx = len(se
+00018b80: 6c66 2e5f 6d6f 6475 6c65 7329 0d0a 2020  lf._modules)..  
+00018b90: 2020 2020 2020 666f 7220 6d6f 6475 6c65        for module
+00018ba0: 2069 6e20 6d6f 6475 6c65 733a 0d0a 2020   in modules:..  
+00018bb0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+00018bc0: 2e69 735f 726f 6f74 203d 2046 616c 7365  .is_root = False
+00018bd0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00018be0: 206d 6f64 756c 652e 7575 6964 2021 3d20   module.uuid != 
+00018bf0: 7365 6c66 2e75 7569 643a 0d0a 2020 2020  self.uuid:..    
+00018c00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018c10: 2e61 6464 5f6d 6f64 756c 6528 7374 7228  .add_module(str(
+00018c20: 7374 6172 745f 6964 7829 2c20 6d6f 6475  start_idx), modu
+00018c30: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+00018c40: 2020 2020 2073 7461 7274 5f69 6478 202b       start_idx +
+00018c50: 3d20 310d 0a0d 0a20 2020 2064 6566 205f  = 1....    def _
+00018c60: 6765 745f 6162 735f 7374 7269 6e67 5f69  get_abs_string_i
+00018c70: 6e64 6578 2873 656c 662c 2069 6478 293a  ndex(self, idx):
+00018c80: 0d0a 2020 2020 2020 2020 2222 2247 6574  ..        """Get
+00018c90: 2074 6865 2061 6273 6f6c 7574 6520 696e   the absolute in
+00018ca0: 6465 7820 666f 7220 7468 6520 6c69 7374  dex for the list
+00018cb0: 206f 6620 6d6f 6475 6c65 7322 2222 0d0a   of modules"""..
+00018cc0: 2020 2020 2020 2020 6964 7820 3d20 6f70          idx = op
+00018cd0: 6572 6174 6f72 2e69 6e64 6578 2869 6478  erator.index(idx
+00018ce0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00018cf0: 7420 282d 6c65 6e28 7365 6c66 2920 3c3d  t (-len(self) <=
+00018d00: 2069 6478 203c 206c 656e 2873 656c 6629   idx < len(self)
+00018d10: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00018d20: 7261 6973 6520 496e 6465 7845 7272 6f72  raise IndexError
+00018d30: 2827 696e 6465 7820 7b7d 2069 7320 6f75  ('index {} is ou
+00018d40: 7420 6f66 2072 616e 6765 272e 666f 726d  t of range'.form
+00018d50: 6174 2869 6478 2929 0d0a 2020 2020 2020  at(idx))..      
+00018d60: 2020 6966 2069 6478 203c 2030 3a0d 0a20    if idx < 0:.. 
+00018d70: 2020 2020 2020 2020 2020 2069 6478 202b             idx +
+00018d80: 3d20 6c65 6e28 7365 6c66 290d 0a20 2020  = len(self)..   
+00018d90: 2020 2020 2072 6574 7572 6e20 7374 7228       return str(
+00018da0: 6964 7829 0d0a 0d0a 2020 2020 405f 636f  idx)....    @_co
+00018db0: 7079 5f74 6f5f 7363 7269 7074 5f77 7261  py_to_script_wra
+00018dc0: 7070 6572 0d0a 2020 2020 6465 6620 5f5f  pper..    def __
+00018dd0: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
+00018de0: 6964 7829 3a0d 0a20 2020 2020 2020 2069  idx):..        i
+00018df0: 6620 6973 696e 7374 616e 6365 2869 6478  f isinstance(idx
+00018e00: 2c20 736c 6963 6529 3a0d 0a20 2020 2020  , slice):..     
+00018e10: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00018e20: 6c66 2e5f 5f63 6c61 7373 5f5f 286c 6973  lf.__class__(lis
+00018e30: 7428 7365 6c66 2e5f 6d6f 6475 6c65 732e  t(self._modules.
+00018e40: 7661 6c75 6573 2829 295b 6964 785d 290d  values())[idx]).
+00018e50: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00018e60: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00018e70: 7220 3d20 7365 6c66 2e5f 6d6f 6475 6c65  r = self._module
+00018e80: 735b 7365 6c66 2e5f 6765 745f 6162 735f  s[self._get_abs_
+00018e90: 7374 7269 6e67 5f69 6e64 6578 2869 6478  string_index(idx
+00018ea0: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
+00018eb0: 7265 7475 726e 206c 6179 6572 0d0a 0d0a  return layer....
+00018ec0: 2020 2020 6465 6620 5f5f 7365 7469 7465      def __setite
+00018ed0: 6d5f 5f28 7365 6c66 2c20 6964 782c 206d  m__(self, idx, m
+00018ee0: 6f64 756c 6529 3a0d 0a20 2020 2020 2020  odule):..       
+00018ef0: 2069 6478 203d 2073 656c 662e 5f67 6574   idx = self._get
+00018f00: 5f61 6273 5f73 7472 696e 675f 696e 6465  _abs_string_inde
+00018f10: 7828 6964 7829 0d0a 2020 2020 2020 2020  x(idx)..        
+00018f20: 7265 7475 726e 2073 6574 6174 7472 2873  return setattr(s
+00018f30: 656c 662c 2073 7472 2869 6478 292c 206d  elf, str(idx), m
+00018f40: 6f64 756c 6529 0d0a 0d0a 2020 2020 6465  odule)....    de
+00018f50: 6620 5f5f 6465 6c69 7465 6d5f 5f28 7365  f __delitem__(se
+00018f60: 6c66 2c20 6964 7829 3a0d 0a20 2020 2020  lf, idx):..     
+00018f70: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00018f80: 2869 6478 2c20 736c 6963 6529 3a0d 0a20  (idx, slice):.. 
+00018f90: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00018fa0: 2069 6e20 7261 6e67 6528 6c65 6e28 7365   in range(len(se
+00018fb0: 6c66 2e5f 6d6f 6475 6c65 7329 295b 6964  lf._modules))[id
+00018fc0: 785d 3a0d 0a20 2020 2020 2020 2020 2020  x]:..           
+00018fd0: 2020 2020 2064 656c 6174 7472 2873 656c       delattr(sel
+00018fe0: 662c 2073 7472 286b 2929 0d0a 2020 2020  f, str(k))..    
+00018ff0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00019000: 2020 2020 2020 2064 656c 6174 7472 2873         delattr(s
+00019010: 656c 662c 2073 656c 662e 5f67 6574 5f61  elf, self._get_a
+00019020: 6273 5f73 7472 696e 675f 696e 6465 7828  bs_string_index(
+00019030: 6964 7829 290d 0a20 2020 2020 2020 2023  idx))..        #
+00019040: 2054 6f20 7072 6573 6572 7665 206e 756d   To preserve num
+00019050: 6265 7269 6e67 2c20 7365 6c66 2e5f 6d6f  bering, self._mo
+00019060: 6475 6c65 7320 6973 2062 6569 6e67 2072  dules is being r
+00019070: 6563 6f6e 7374 7275 6374 6564 2077 6974  econstructed wit
+00019080: 6820 6d6f 6475 6c65 7320 6166 7465 7220  h modules after 
+00019090: 6465 6c65 7469 6f6e 0d0a 2020 2020 2020  deletion..      
+000190a0: 2020 7374 725f 696e 6469 6365 7320 3d20    str_indices = 
+000190b0: 5b73 7472 2869 2920 666f 7220 6920 696e  [str(i) for i in
+000190c0: 2072 616e 6765 286c 656e 2873 656c 662e   range(len(self.
+000190d0: 5f6d 6f64 756c 6573 2929 5d0d 0a20 2020  _modules))]..   
+000190e0: 2020 2020 2073 656c 662e 5f6d 6f64 756c       self._modul
+000190f0: 6573 203d 204f 7264 6572 6564 4469 6374  es = OrderedDict
+00019100: 286c 6973 7428 7a69 7028 7374 725f 696e  (list(zip(str_in
+00019110: 6469 6365 732c 2073 656c 662e 5f6d 6f64  dices, self._mod
+00019120: 756c 6573 2e76 616c 7565 7328 2929 2929  ules.values())))
+00019130: 0d0a 0d0a 2020 2020 405f 636f 7079 5f74  ....    @_copy_t
+00019140: 6f5f 7363 7269 7074 5f77 7261 7070 6572  o_script_wrapper
+00019150: 0d0a 2020 2020 6465 6620 5f5f 6c65 6e5f  ..    def __len_
+00019160: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00019170: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
+00019180: 662e 5f6d 6f64 756c 6573 290d 0a0d 0a20  f._modules).... 
+00019190: 2020 2040 5f63 6f70 795f 746f 5f73 6372     @_copy_to_scr
+000191a0: 6970 745f 7772 6170 7065 720d 0a20 2020  ipt_wrapper..   
+000191b0: 2064 6566 205f 5f69 7465 725f 5f28 7365   def __iter__(se
+000191c0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+000191d0: 7475 726e 2069 7465 7228 7365 6c66 2e5f  turn iter(self._
+000191e0: 6d6f 6475 6c65 732e 7661 6c75 6573 2829  modules.values()
+000191f0: 290d 0a0d 0a20 2020 2064 6566 205f 5f69  )....    def __i
+00019200: 6164 645f 5f28 7365 6c66 2c20 6d6f 6475  add__(self, modu
+00019210: 6c65 7329 3a0d 0a20 2020 2020 2020 2072  les):..        r
+00019220: 6574 7572 6e20 7365 6c66 2e65 7874 656e  eturn self.exten
+00019230: 6428 6d6f 6475 6c65 7329 0d0a 0d0a 2020  d(modules)....  
+00019240: 2020 405f 636f 7079 5f74 6f5f 7363 7269    @_copy_to_scri
+00019250: 7074 5f77 7261 7070 6572 0d0a 2020 2020  pt_wrapper..    
+00019260: 6465 6620 5f5f 6469 725f 5f28 7365 6c66  def __dir__(self
+00019270: 293a 0d0a 2020 2020 2020 2020 6b65 7973  ):..        keys
+00019280: 203d 2073 7570 6572 284d 6f64 756c 654c   = super(ModuleL
+00019290: 6973 742c 2073 656c 6629 2e5f 5f64 6972  ist, self).__dir
+000192a0: 5f5f 2829 0d0a 2020 2020 2020 2020 6b65  __()..        ke
+000192b0: 7973 203d 205b 6b65 7920 666f 7220 6b65  ys = [key for ke
+000192c0: 7920 696e 206b 6579 7320 6966 206e 6f74  y in keys if not
+000192d0: 206b 6579 2e69 7364 6967 6974 2829 5d0d   key.isdigit()].
+000192e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000192f0: 6b65 7973 0d0a 0d0a 0d0a 2020 2020 6465  keys......    de
+00019300: 6620 696e 7365 7274 2873 656c 662c 2069  f insert(self, i
+00019310: 6e64 6578 3a20 696e 742c 206d 6f64 756c  ndex: int, modul
+00019320: 653a 206e 6e2e 4d6f 6475 6c65 2920 2d3e  e: nn.Module) ->
+00019330: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00019340: 7222 2222 496e 7365 7274 2061 2067 6976  r"""Insert a giv
+00019350: 656e 206d 6f64 756c 6520 6265 666f 7265  en module before
+00019360: 2061 2067 6976 656e 2069 6e64 6578 2069   a given index i
+00019370: 6e20 7468 6520 6c69 7374 2e0d 0a0d 0a20  n the list..... 
+00019380: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
+00019390: 2020 2020 2020 2020 2020 696e 6465 7820            index 
+000193a0: 2869 6e74 293a 2069 6e64 6578 2074 6f20  (int): index to 
+000193b0: 696e 7365 7274 2e0d 0a20 2020 2020 2020  insert...       
+000193c0: 2020 2020 206d 6f64 756c 6520 286e 6e2e       module (nn.
+000193d0: 4d6f 6475 6c65 293a 206d 6f64 756c 6520  Module): module 
+000193e0: 746f 2069 6e73 6572 740d 0a20 2020 2020  to insert..     
+000193f0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00019400: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00019410: 656e 2873 656c 662e 5f6d 6f64 756c 6573  en(self._modules
+00019420: 292c 2069 6e64 6578 2c20 2d31 293a 0d0a  ), index, -1):..
+00019430: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00019440: 2e5f 6d6f 6475 6c65 735b 7374 7228 6929  ._modules[str(i)
+00019450: 5d20 3d20 7365 6c66 2e5f 6d6f 6475 6c65  ] = self._module
+00019460: 735b 7374 7228 6920 2d20 3129 5d0d 0a20  s[str(i - 1)].. 
+00019470: 2020 2020 2020 2073 656c 662e 5f6d 6f64         self._mod
+00019480: 756c 6573 5b73 7472 2869 6e64 6578 295d  ules[str(index)]
+00019490: 203d 206d 6f64 756c 650d 0a0d 0a20 2020   = module....   
+000194a0: 2064 6566 2061 7070 656e 6428 7365 6c66   def append(self
+000194b0: 2c20 6d6f 6475 6c65 3a20 6e6e 2e4d 6f64  , module: nn.Mod
+000194c0: 756c 6529 202d 3e20 274d 6f64 756c 654c  ule) -> 'ModuleL
+000194d0: 6973 7427 3a0d 0a20 2020 2020 2020 2072  ist':..        r
+000194e0: 2222 2241 7070 656e 6473 2061 2067 6976  """Appends a giv
+000194f0: 656e 206d 6f64 756c 6520 746f 2074 6865  en module to the
+00019500: 2065 6e64 206f 6620 7468 6520 6c69 7374   end of the list
+00019510: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+00019520: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00019530: 6d6f 6475 6c65 2028 6e6e 2e4d 6f64 756c  module (nn.Modul
+00019540: 6529 3a20 6d6f 6475 6c65 2074 6f20 6170  e): module to ap
+00019550: 7065 6e64 0d0a 2020 2020 2020 2020 2222  pend..        ""
+00019560: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+00019570: 6164 645f 6d6f 6475 6c65 2873 7472 286c  add_module(str(l
+00019580: 656e 2873 656c 6629 292c 206d 6f64 756c  en(self)), modul
+00019590: 6529 0d0a 2020 2020 2020 2020 7265 7475  e)..        retu
+000195a0: 726e 2073 656c 660d 0a0d 0a20 2020 2064  rn self....    d
+000195b0: 6566 2070 6f70 2873 656c 662c 206b 6579  ef pop(self, key
+000195c0: 3a20 556e 696f 6e5b 696e 742c 2073 6c69  : Union[int, sli
+000195d0: 6365 5d29 202d 3e20 6e6e 2e4d 6f64 756c  ce]) -> nn.Modul
+000195e0: 653a 0d0a 2020 2020 2020 2020 7620 3d20  e:..        v = 
+000195f0: 7365 6c66 5b6b 6579 5d0d 0a20 2020 2020  self[key]..     
+00019600: 2020 2064 656c 2073 656c 665b 6b65 795d     del self[key]
+00019610: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00019620: 2076 0d0a 0d0a 2020 2020 6465 6620 6578   v....    def ex
+00019630: 7465 6e64 2873 656c 662c 206d 6f64 756c  tend(self, modul
+00019640: 6573 3a20 4974 6572 6162 6c65 5b6e 6e2e  es: Iterable[nn.
+00019650: 4d6f 6475 6c65 5d29 202d 3e20 274d 6f64  Module]) -> 'Mod
+00019660: 756c 654c 6973 7427 3a0d 0a20 2020 2020  uleList':..     
+00019670: 2020 2072 2222 2241 7070 656e 6473 206d     r"""Appends m
+00019680: 6f64 756c 6573 2066 726f 6d20 6120 5079  odules from a Py
+00019690: 7468 6f6e 2069 7465 7261 626c 6520 746f  thon iterable to
+000196a0: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
+000196b0: 6c69 7374 2e0d 0a0d 0a20 2020 2020 2020  list.....       
+000196c0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
+000196d0: 2020 2020 6d6f 6475 6c65 7320 2869 7465      modules (ite
+000196e0: 7261 626c 6529 3a20 6974 6572 6162 6c65  rable): iterable
+000196f0: 206f 6620 6d6f 6475 6c65 7320 746f 2061   of modules to a
+00019700: 7070 656e 640d 0a20 2020 2020 2020 2022  ppend..        "
+00019710: 2222 0d0a 2020 2020 2020 2020 6966 206e  ""..        if n
+00019720: 6f74 2069 7369 6e73 7461 6e63 6528 6d6f  ot isinstance(mo
+00019730: 6475 6c65 732c 2063 6f6e 7461 696e 6572  dules, container
+00019740: 5f61 6263 732e 4974 6572 6162 6c65 293a  _abcs.Iterable):
+00019750: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00019760: 6973 6520 5479 7065 4572 726f 7228 224d  ise TypeError("M
+00019770: 6f64 756c 654c 6973 742e 6578 7465 6e64  oduleList.extend
+00019780: 2073 686f 756c 6420 6265 2063 616c 6c65   should be calle
+00019790: 6420 7769 7468 2061 6e20 220d 0a20 2020  d with an "..   
 000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197b0: 2269 7465 7261 626c 652c 2062 7574 2067  "iterable, but g
-000197c0: 6f74 2022 202b 2074 7970 6528 6d6f 6475  ot " + type(modu
-000197d0: 6c65 7329 2e5f 5f6e 616d 655f 5f29 0d0a  les).__name__)..
-000197e0: 2020 2020 2020 2020 6f66 6673 6574 203d          offset =
-000197f0: 206c 656e 2873 656c 6629 0d0a 2020 2020   len(self)..    
-00019800: 2020 2020 666f 7220 692c 206d 6f64 756c      for i, modul
-00019810: 6520 696e 2065 6e75 6d65 7261 7465 286d  e in enumerate(m
-00019820: 6f64 756c 6573 293a 0d0a 2020 2020 2020  odules):..      
-00019830: 2020 2020 2020 7365 6c66 2e61 6464 5f6d        self.add_m
-00019840: 6f64 756c 6528 7374 7228 6f66 6673 6574  odule(str(offset
-00019850: 202b 2069 292c 206d 6f64 756c 6529 0d0a   + i), module)..
-00019860: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00019870: 656c 660d 0a0d 0a20 2020 2023 2072 656d  elf....    # rem
-00019880: 6f76 6520 666f 7277 6172 6420 616c 6c74  ove forward allt
-00019890: 6f67 6574 6865 7220 746f 2066 616c 6c62  ogether to fallb
-000198a0: 6163 6b20 6f6e 204d 6f64 756c 6527 7320  ack on Module's 
-000198b0: 5f66 6f72 7761 7264 5f75 6e69 6d70 6c65  _forward_unimple
-000198c0: 6d65 6e74 6564 0d0a 0d0a 0d0a 0d0a 0d0a  mented..........
-000198d0: 0d0a 636c 6173 7320 4d6f 6475 6c65 4469  ..class ModuleDi
-000198e0: 6374 284c 6179 6572 293a 0d0a 2020 2020  ct(Layer):..    
-000198f0: 2222 2248 6f6c 6473 2073 7562 6d6f 6475  """Holds submodu
-00019900: 6c65 7320 696e 2061 2064 6963 7469 6f6e  les in a diction
-00019910: 6172 792e 0d0a 0d0a 2020 2020 3a63 6c61  ary.....    :cla
-00019920: 7373 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f  ss:`~torch.nn.Mo
-00019930: 6475 6c65 4469 6374 6020 6361 6e20 6265  duleDict` can be
-00019940: 2069 6e64 6578 6564 206c 696b 6520 6120   indexed like a 
-00019950: 7265 6775 6c61 7220 5079 7468 6f6e 2064  regular Python d
-00019960: 6963 7469 6f6e 6172 792c 0d0a 2020 2020  ictionary,..    
-00019970: 6275 7420 6d6f 6475 6c65 7320 6974 2063  but modules it c
-00019980: 6f6e 7461 696e 7320 6172 6520 7072 6f70  ontains are prop
-00019990: 6572 6c79 2072 6567 6973 7465 7265 642c  erly registered,
-000199a0: 2061 6e64 2077 696c 6c20 6265 2076 6973   and will be vis
-000199b0: 6962 6c65 2062 7920 616c 6c0d 0a20 2020  ible by all..   
-000199c0: 203a 636c 6173 733a 607e 746f 7263 682e   :class:`~torch.
-000199d0: 6e6e 2e4d 6f64 756c 6560 206d 6574 686f  nn.Module` metho
-000199e0: 6473 2e0d 0a0d 0a20 2020 203a 636c 6173  ds.....    :clas
-000199f0: 733a 607e 746f 7263 682e 6e6e 2e4d 6f64  s:`~torch.nn.Mod
-00019a00: 756c 6544 6963 7460 2069 7320 616e 202a  uleDict` is an *
-00019a10: 2a6f 7264 6572 6564 2a2a 2064 6963 7469  *ordered** dicti
-00019a20: 6f6e 6172 7920 7468 6174 2072 6573 7065  onary that respe
-00019a30: 6374 730d 0a0d 0a20 2020 202a 2074 6865  cts....    * the
-00019a40: 206f 7264 6572 206f 6620 696e 7365 7274   order of insert
-00019a50: 696f 6e2c 2061 6e64 0d0a 0d0a 2020 2020  ion, and....    
-00019a60: 2a20 696e 203a 6d65 7468 3a60 7e74 6f72  * in :meth:`~tor
-00019a70: 6368 2e6e 6e2e 4d6f 6475 6c65 4469 6374  ch.nn.ModuleDict
-00019a80: 2e75 7064 6174 6560 2c20 7468 6520 6f72  .update`, the or
-00019a90: 6465 7220 6f66 2074 6865 206d 6572 6765  der of the merge
-00019aa0: 6420 6060 4f72 6465 7265 6444 6963 7460  d ``OrderedDict`
-00019ab0: 600d 0a20 2020 2020 206f 7220 616e 6f74  `..      or anot
-00019ac0: 6865 7220 3a63 6c61 7373 3a60 7e74 6f72  her :class:`~tor
-00019ad0: 6368 2e6e 6e2e 4d6f 6475 6c65 4469 6374  ch.nn.ModuleDict
-00019ae0: 6020 2874 6865 2061 7267 756d 656e 7420  ` (the argument 
-00019af0: 746f 203a 6d65 7468 3a60 7e74 6f72 6368  to :meth:`~torch
-00019b00: 2e6e 6e2e 4d6f 6475 6c65 4469 6374 2e75  .nn.ModuleDict.u
-00019b10: 7064 6174 6560 292e 0d0a 0d0a 2020 2020  pdate`).....    
-00019b20: 4e6f 7465 2074 6861 7420 3a6d 6574 683a  Note that :meth:
-00019b30: 607e 746f 7263 682e 6e6e 2e4d 6f64 756c  `~torch.nn.Modul
-00019b40: 6544 6963 742e 7570 6461 7465 6020 7769  eDict.update` wi
-00019b50: 7468 206f 7468 6572 2075 6e6f 7264 6572  th other unorder
-00019b60: 6564 206d 6170 7069 6e67 0d0a 2020 2020  ed mapping..    
-00019b70: 7479 7065 7320 2865 2e67 2e2c 2050 7974  types (e.g., Pyt
-00019b80: 686f 6e27 7320 706c 6169 6e20 6060 6469  hon's plain ``di
-00019b90: 6374 6060 2920 646f 6573 206e 6f74 2070  ct``) does not p
-00019ba0: 7265 7365 7276 6520 7468 6520 6f72 6465  reserve the orde
-00019bb0: 7220 6f66 2074 6865 0d0a 2020 2020 6d65  r of the..    me
-00019bc0: 7267 6564 206d 6170 7069 6e67 2e0d 0a0d  rged mapping....
-00019bd0: 0a20 2020 2041 7267 756d 656e 7473 3a0d  .    Arguments:.
-00019be0: 0a20 2020 2020 2020 206d 6f64 756c 6573  .        modules
-00019bf0: 2028 6974 6572 6162 6c65 2c20 6f70 7469   (iterable, opti
-00019c00: 6f6e 616c 293a 2061 206d 6170 7069 6e67  onal): a mapping
-00019c10: 2028 6469 6374 696f 6e61 7279 2920 6f66   (dictionary) of
-00019c20: 2028 7374 7269 6e67 3a20 6d6f 6475 6c65   (string: module
-00019c30: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
-00019c40: 7220 616e 2069 7465 7261 626c 6520 6f66  r an iterable of
-00019c50: 206b 6579 2d76 616c 7565 2070 6169 7273   key-value pairs
-00019c60: 206f 6620 7479 7065 2028 7374 7269 6e67   of type (string
-00019c70: 2c20 6d6f 6475 6c65 290d 0a0d 0a20 2020  , module)....   
-00019c80: 2045 7861 6d70 6c65 3a3a 0d0a 0d0a 2020   Example::....  
-00019c90: 2020 2020 2020 636c 6173 7320 4d79 4d6f        class MyMo
-00019ca0: 6475 6c65 286e 6e2e 4d6f 6475 6c65 293a  dule(nn.Module):
-00019cb0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00019cc0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
-00019cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00019ce0: 2020 2073 7570 6572 284d 794d 6f64 756c     super(MyModul
-00019cf0: 652c 2073 656c 6629 2e5f 5f69 6e69 745f  e, self).__init_
-00019d00: 5f28 290d 0a20 2020 2020 2020 2020 2020  _()..           
-00019d10: 2020 2020 2073 656c 662e 6368 6f69 6365       self.choice
-00019d20: 7320 3d20 6e6e 2e4d 6f64 756c 6544 6963  s = nn.ModuleDic
-00019d30: 7428 7b0d 0a20 2020 2020 2020 2020 2020  t({..           
-00019d40: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-00019d50: 6e76 273a 206e 6e2e 436f 6e76 3264 2831  nv': nn.Conv2d(1
-00019d60: 302c 2031 302c 2033 292c 0d0a 2020 2020  0, 10, 3),..    
-00019d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d80: 2020 2020 2770 6f6f 6c27 3a20 6e6e 2e4d      'pool': nn.M
-00019d90: 6178 506f 6f6c 3264 2833 290d 0a20 2020  axPool2d(3)..   
-00019da0: 2020 2020 2020 2020 2020 2020 207d 290d               }).
-00019db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019dc0: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
-00019dd0: 7320 3d20 6e6e 2e4d 6f64 756c 6544 6963  s = nn.ModuleDic
-00019de0: 7428 5b0d 0a20 2020 2020 2020 2020 2020  t([..           
-00019df0: 2020 2020 2020 2020 2020 2020 205b 276c               ['l
-00019e00: 7265 6c75 272c 206e 6e2e 4c65 616b 7952  relu', nn.LeakyR
-00019e10: 654c 5528 295d 2c0d 0a20 2020 2020 2020  eLU()],..       
-00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e30: 205b 2770 7265 6c75 272c 206e 6e2e 5052   ['prelu', nn.PR
-00019e40: 654c 5528 295d 0d0a 2020 2020 2020 2020  eLU()]..        
-00019e50: 2020 2020 2020 2020 5d29 0d0a 0d0a 2020          ])....  
-00019e60: 2020 2020 2020 2020 2020 6465 6620 666f            def fo
-00019e70: 7277 6172 6428 7365 6c66 2c20 782c 2063  rward(self, x, c
-00019e80: 686f 6963 652c 2061 6374 293a 0d0a 2020  hoice, act):..  
-00019e90: 2020 2020 2020 2020 2020 2020 2020 7820                x 
-00019ea0: 3d20 7365 6c66 2e63 686f 6963 6573 5b63  = self.choices[c
-00019eb0: 686f 6963 655d 2878 290d 0a20 2020 2020  hoice](x)..     
-00019ec0: 2020 2020 2020 2020 2020 2078 203d 2073             x = s
-00019ed0: 656c 662e 6163 7469 7661 7469 6f6e 735b  elf.activations[
-00019ee0: 6163 745d 2878 290d 0a20 2020 2020 2020  act](x)..       
-00019ef0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019f00: 780d 0a20 2020 2022 2222 0d0a 0d0a 2020  x..    """....  
-00019f10: 2020 5f6d 6f64 756c 6573 3a20 4469 6374    _modules: Dict
-00019f20: 5b73 7472 2c20 6e6e 2e4d 6f64 756c 655d  [str, nn.Module]
-00019f30: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-00019f40: 5b61 7373 6967 6e6d 656e 745d 0d0a 2020  [assignment]..  
-00019f50: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00019f60: 656c 662c 206d 6f64 756c 6573 3a20 4f70  elf, modules: Op
-00019f70: 7469 6f6e 616c 5b4d 6170 7069 6e67 5b73  tional[Mapping[s
-00019f80: 7472 2c20 4c61 7965 725d 5d20 3d20 4e6f  tr, Layer]] = No
-00019f90: 6e65 2c20 6e61 6d65 3d4e 6f6e 652c 206b  ne, name=None, k
-00019fa0: 6565 705f 6f75 7470 7574 3d46 616c 7365  eep_output=False
-00019fb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00019fc0: 2020 2020 6973 5f6d 756c 7469 6361 7374      is_multicast
-00019fd0: 696e 673d 5472 7565 2c20 2a2a 6b77 6172  ing=True, **kwar
-00019fe0: 6773 2920 2d3e 204e 6f6e 653a 0d0a 2020  gs) -> None:..  
-00019ff0: 2020 2020 2020 7375 7065 7228 4d6f 6475        super(Modu
-0001a000: 6c65 4469 6374 2c20 7365 6c66 292e 5f5f  leDict, self).__
-0001a010: 696e 6974 5f5f 286e 616d 653d 6e61 6d65  init__(name=name
-0001a020: 2c20 6b65 6570 5f6f 7574 7075 743d 6b65  , keep_output=ke
-0001a030: 6570 5f6f 7574 7075 742c 202a 2a6b 7761  ep_output, **kwa
-0001a040: 7267 7329 0d0a 2020 2020 2020 2020 7365  rgs)..        se
-0001a050: 6c66 2e75 7569 6420 3d20 7575 6964 2e75  lf.uuid = uuid.u
-0001a060: 7569 6434 2829 2e6e 6f64 650d 0a0d 0a20  uid4().node.... 
-0001a070: 2020 2020 2020 2073 656c 662e 6973 5f6d         self.is_m
-0001a080: 756c 7469 6361 7374 696e 6720 3d20 6973  ulticasting = is
-0001a090: 5f6d 756c 7469 6361 7374 696e 670d 0a20  _multicasting.. 
-0001a0a0: 2020 2020 2020 2069 6620 6d6f 6475 6c65         if module
-0001a0b0: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
-0001a0c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001a0d0: 656e 286d 6f64 756c 6573 2920 3e20 303a  en(modules) > 0:
-0001a0e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a0f0: 2020 7365 6c66 2e75 7064 6174 6528 6d6f    self.update(mo
-0001a100: 6475 6c65 7329 0d0a 0d0a 2020 2020 2320  dules)....    # 
-0001a110: 405f 636f 7079 5f74 6f5f 7363 7269 7074  @_copy_to_script
-0001a120: 5f77 7261 7070 6572 0d0a 2020 2020 6465  _wrapper..    de
-0001a130: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
-0001a140: 6c66 2c20 6b65 793a 2073 7472 2920 2d3e  lf, key: str) ->
-0001a150: 204c 6179 6572 3a0d 0a20 2020 2020 2020   Layer:..       
-0001a160: 2072 6574 7572 6e20 7365 6c66 2e5f 6d6f   return self._mo
-0001a170: 6475 6c65 735b 6b65 795d 0d0a 0d0a 2020  dules[key]....  
-0001a180: 2020 6465 6620 5f5f 7365 7469 7465 6d5f    def __setitem_
-0001a190: 5f28 7365 6c66 2c20 6b65 793a 2073 7472  _(self, key: str
-0001a1a0: 2c20 6d6f 6475 6c65 3a20 4c61 7965 7229  , module: Layer)
-0001a1b0: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
-0001a1c0: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
-0001a1d0: 6c65 286b 6579 2c20 6d6f 6475 6c65 290d  le(key, module).
-0001a1e0: 0a0d 0a20 2020 2064 6566 205f 5f64 656c  ...    def __del
-0001a1f0: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-0001a200: 3a20 7374 7229 202d 3e20 4e6f 6e65 3a0d  : str) -> None:.
-0001a210: 0a20 2020 2020 2020 2064 656c 2073 656c  .        del sel
-0001a220: 662e 5f6d 6f64 756c 6573 5b6b 6579 5d0d  f._modules[key].
-0001a230: 0a0d 0a20 2020 2040 5f63 6f70 795f 746f  ...    @_copy_to
-0001a240: 5f73 6372 6970 745f 7772 6170 7065 720d  _script_wrapper.
-0001a250: 0a20 2020 2064 6566 205f 5f6c 656e 5f5f  .    def __len__
-0001a260: 2873 656c 6629 202d 3e20 696e 743a 0d0a  (self) -> int:..
-0001a270: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-0001a280: 656e 2873 656c 662e 5f6d 6f64 756c 6573  en(self._modules
-0001a290: 290d 0a0d 0a20 2020 2040 5f63 6f70 795f  )....    @_copy_
-0001a2a0: 746f 5f73 6372 6970 745f 7772 6170 7065  to_script_wrappe
-0001a2b0: 720d 0a20 2020 2064 6566 205f 5f69 7465  r..    def __ite
-0001a2c0: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
-0001a2d0: 2020 2020 7265 7475 726e 2069 7465 7228      return iter(
-0001a2e0: 7365 6c66 2e5f 6d6f 6475 6c65 7329 0d0a  self._modules)..
-0001a2f0: 0d0a 2020 2020 405f 636f 7079 5f74 6f5f  ..    @_copy_to_
-0001a300: 7363 7269 7074 5f77 7261 7070 6572 0d0a  script_wrapper..
-0001a310: 2020 2020 6465 6620 5f5f 636f 6e74 6169      def __contai
-0001a320: 6e73 5f5f 2873 656c 662c 206b 6579 3a20  ns__(self, key: 
-0001a330: 7374 7229 202d 3e20 626f 6f6c 3a0d 0a20  str) -> bool:.. 
-0001a340: 2020 2020 2020 2072 6574 7572 6e20 6b65         return ke
-0001a350: 7920 696e 2073 656c 662e 5f6d 6f64 756c  y in self._modul
-0001a360: 6573 0d0a 0d0a 2020 2020 6465 6620 636c  es....    def cl
-0001a370: 6561 7228 7365 6c66 2920 2d3e 204e 6f6e  ear(self) -> Non
-0001a380: 653a 0d0a 2020 2020 2020 2020 2222 2252  e:..        """R
-0001a390: 656d 6f76 6520 616c 6c20 6974 656d 7320  emove all items 
-0001a3a0: 6672 6f6d 2074 6865 204d 6f64 756c 6544  from the ModuleD
-0001a3b0: 6963 742e 0d0a 2020 2020 2020 2020 2222  ict...        ""
-0001a3c0: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0001a3d0: 5f6d 6f64 756c 6573 2e63 6c65 6172 2829  _modules.clear()
-0001a3e0: 0d0a 0d0a 2020 2020 6465 6620 706f 7028  ....    def pop(
-0001a3f0: 7365 6c66 2c20 6b65 793a 2073 7472 2920  self, key: str) 
-0001a400: 2d3e 204c 6179 6572 3a0d 0a20 2020 2020  -> Layer:..     
-0001a410: 2020 2022 2222 5265 6d6f 7665 206b 6579     """Remove key
-0001a420: 2066 726f 6d20 7468 6520 4d6f 6475 6c65   from the Module
-0001a430: 4469 6374 2061 6e64 2072 6574 7572 6e20  Dict and return 
-0001a440: 6974 7320 6d6f 6475 6c65 2e0d 0a0d 0a20  its module..... 
-0001a450: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
-0001a460: 3a0d 0a20 2020 2020 2020 2020 2020 206b  :..            k
-0001a470: 6579 2028 7374 7269 6e67 293a 206b 6579  ey (string): key
-0001a480: 2074 6f20 706f 7020 6672 6f6d 2074 6865   to pop from the
-0001a490: 204d 6f64 756c 6544 6963 740d 0a20 2020   ModuleDict..   
-0001a4a0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0001a4b0: 2020 7620 3d20 7365 6c66 5b6b 6579 5d0d    v = self[key].
-0001a4c0: 0a20 2020 2020 2020 2064 656c 2073 656c  .        del sel
-0001a4d0: 665b 6b65 795d 0d0a 2020 2020 2020 2020  f[key]..        
-0001a4e0: 7265 7475 726e 2076 0d0a 0d0a 2020 2020  return v....    
-0001a4f0: 2320 405f 636f 7079 5f74 6f5f 7363 7269  # @_copy_to_scri
-0001a500: 7074 5f77 7261 7070 6572 0d0a 2020 2020  pt_wrapper..    
-0001a510: 6465 6620 6b65 7973 2873 656c 6629 202d  def keys(self) -
-0001a520: 3e20 4974 6572 6162 6c65 5b73 7472 5d3a  > Iterable[str]:
-0001a530: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
-0001a540: 7572 6e20 616e 2069 7465 7261 626c 6520  urn an iterable 
-0001a550: 6f66 2074 6865 204d 6f64 756c 6544 6963  of the ModuleDic
-0001a560: 7420 6b65 7973 2e0d 0a20 2020 2020 2020  t keys...       
-0001a570: 2022 2222 0d0a 2020 2020 2020 2020 7265   """..        re
-0001a580: 7475 726e 2073 656c 662e 5f6d 6f64 756c  turn self._modul
-0001a590: 6573 2e6b 6579 7328 290d 0a0d 0a20 2020  es.keys()....   
-0001a5a0: 2023 2040 5f63 6f70 795f 746f 5f73 6372   # @_copy_to_scr
-0001a5b0: 6970 745f 7772 6170 7065 720d 0a20 2020  ipt_wrapper..   
-0001a5c0: 2064 6566 2069 7465 6d73 2873 656c 6629   def items(self)
-0001a5d0: 202d 3e20 4974 6572 6162 6c65 5b54 7570   -> Iterable[Tup
-0001a5e0: 6c65 5b73 7472 2c20 4c61 7965 725d 5d3a  le[str, Layer]]:
-0001a5f0: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
-0001a600: 7572 6e20 616e 2069 7465 7261 626c 6520  urn an iterable 
-0001a610: 6f66 2074 6865 204d 6f64 756c 6544 6963  of the ModuleDic
-0001a620: 7420 6b65 792f 7661 6c75 6520 7061 6972  t key/value pair
-0001a630: 732e 0d0a 2020 2020 2020 2020 2222 220d  s...        """.
-0001a640: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a650: 7365 6c66 2e5f 6d6f 6475 6c65 732e 6974  self._modules.it
-0001a660: 656d 7328 290d 0a0d 0a20 2020 2023 2040  ems()....    # @
-0001a670: 5f63 6f70 795f 746f 5f73 6372 6970 745f  _copy_to_script_
-0001a680: 7772 6170 7065 720d 0a20 2020 2064 6566  wrapper..    def
-0001a690: 2076 616c 7565 7328 7365 6c66 2920 2d3e   values(self) ->
-0001a6a0: 2049 7465 7261 626c 655b 4c61 7965 725d   Iterable[Layer]
-0001a6b0: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0001a6c0: 7475 726e 2061 6e20 6974 6572 6162 6c65  turn an iterable
-0001a6d0: 206f 6620 7468 6520 4d6f 6475 6c65 4469   of the ModuleDi
-0001a6e0: 6374 2076 616c 7565 732e 0d0a 2020 2020  ct values...    
-0001a6f0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0001a700: 2072 6574 7572 6e20 7365 6c66 2e5f 6d6f   return self._mo
-0001a710: 6475 6c65 732e 7661 6c75 6573 2829 0d0a  dules.values()..
-0001a720: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
-0001a730: 2873 656c 662c 206d 6f64 756c 6573 3a20  (self, modules: 
-0001a740: 4d61 7070 696e 675b 7374 722c 204c 6179  Mapping[str, Lay
-0001a750: 6572 5d29 202d 3e20 4e6f 6e65 3a0d 0a20  er]) -> None:.. 
-0001a760: 2020 2020 2020 2022 2222 5570 6461 7465         """Update
-0001a770: 2074 6865 203a 636c 6173 733a 607e 746f   the :class:`~to
-0001a780: 7263 682e 6e6e 2e4d 6f64 756c 6544 6963  rch.nn.ModuleDic
-0001a790: 7460 2077 6974 6820 7468 6520 6b65 792d  t` with the key-
-0001a7a0: 7661 6c75 6520 7061 6972 7320 6672 6f6d  value pairs from
-0001a7b0: 2061 0d0a 2020 2020 2020 2020 6d61 7070   a..        mapp
-0001a7c0: 696e 6720 6f72 2061 6e20 6974 6572 6162  ing or an iterab
-0001a7d0: 6c65 2c20 6f76 6572 7772 6974 696e 6720  le, overwriting 
-0001a7e0: 6578 6973 7469 6e67 206b 6579 732e 0d0a  existing keys...
-0001a7f0: 0d0a 2020 2020 2020 2020 6e6f 7465 3a3a  ..        note::
-0001a800: 0d0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-0001a810: 203a 6174 7472 3a60 6d6f 6475 6c65 7360   :attr:`modules`
-0001a820: 2069 7320 616e 2060 604f 7264 6572 6564   is an ``Ordered
-0001a830: 4469 6374 6060 2c20 6120 3a63 6c61 7373  Dict``, a :class
-0001a840: 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f 6475  :`~torch.nn.Modu
-0001a850: 6c65 4469 6374 602c 206f 720d 0a20 2020  leDict`, or..   
-0001a860: 2020 2020 2020 2020 2061 6e20 6974 6572           an iter
-0001a870: 6162 6c65 206f 6620 6b65 792d 7661 6c75  able of key-valu
-0001a880: 6520 7061 6972 732c 2074 6865 206f 7264  e pairs, the ord
-0001a890: 6572 206f 6620 6e65 7720 656c 656d 656e  er of new elemen
-0001a8a0: 7473 2069 6e20 6974 2069 7320 7072 6573  ts in it is pres
-0001a8b0: 6572 7665 642e 0d0a 0d0a 2020 2020 2020  erved.....      
-0001a8c0: 2020 4172 6775 6d65 6e74 733a 0d0a 2020    Arguments:..  
-0001a8d0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-0001a8e0: 7320 2869 7465 7261 626c 6529 3a20 6120  s (iterable): a 
-0001a8f0: 6d61 7070 696e 6720 2864 6963 7469 6f6e  mapping (diction
-0001a900: 6172 7929 2066 726f 6d20 7374 7269 6e67  ary) from string
-0001a910: 2074 6f20 3a63 6c61 7373 3a60 7e74 6f72   to :class:`~tor
-0001a920: 6368 2e6e 6e2e 4d6f 6475 6c65 602c 0d0a  ch.nn.Module`,..
-0001a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a940: 6f72 2061 6e20 6974 6572 6162 6c65 206f  or an iterable o
-0001a950: 6620 6b65 792d 7661 6c75 6520 7061 6972  f key-value pair
-0001a960: 7320 6f66 2074 7970 6520 2873 7472 696e  s of type (strin
-0001a970: 672c 203a 636c 6173 733a 607e 746f 7263  g, :class:`~torc
-0001a980: 682e 6e6e 2e4d 6f64 756c 6560 290d 0a20  h.nn.Module`).. 
-0001a990: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0001a9a0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-0001a9b0: 7461 6e63 6528 6d6f 6475 6c65 732c 2061  tance(modules, a
-0001a9c0: 6263 2e49 7465 7261 626c 6529 3a0d 0a20  bc.Iterable):.. 
-0001a9d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001a9e0: 2054 7970 6545 7272 6f72 2822 4d6f 6475   TypeError("Modu
-0001a9f0: 6c65 4469 6374 2e75 7064 6174 6520 7368  leDict.update sh
-0001aa00: 6f75 6c64 2062 6520 6361 6c6c 6564 2077  ould be called w
-0001aa10: 6974 6820 616e 2022 0d0a 2020 2020 2020  ith an "..      
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa30: 2020 2020 2020 2269 7465 7261 626c 6520        "iterable 
-0001aa40: 6f66 206b 6579 2f76 616c 7565 2070 6169  of key/value pai
-0001aa50: 7273 2c20 6275 7420 676f 7420 2220 2b0d  rs, but got " +.
-0001aa60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa70: 2020 2020 2020 2020 2020 2020 2074 7970               typ
-0001aa80: 6528 6d6f 6475 6c65 7329 2e5f 5f6e 616d  e(modules).__nam
-0001aa90: 655f 5f29 0d0a 0d0a 2020 2020 2020 2020  e__)....        
-0001aaa0: 6966 2069 7369 6e73 7461 6e63 6528 6d6f  if isinstance(mo
-0001aab0: 6475 6c65 732c 2028 4f72 6465 7265 6444  dules, (OrderedD
-0001aac0: 6963 742c 204d 6f64 756c 6544 6963 7429  ict, ModuleDict)
-0001aad0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001aae0: 666f 7220 6b65 792c 206d 6f64 756c 6520  for key, module 
-0001aaf0: 696e 206d 6f64 756c 6573 2e69 7465 6d73  in modules.items
-0001ab00: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0001ab10: 2020 2020 2073 656c 665b 6b65 795d 203d       self[key] =
-0001ab20: 206d 6f64 756c 650d 0a20 2020 2020 2020   module..       
-0001ab30: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0001ab40: 286d 6f64 756c 6573 2c20 6162 632e 4d61  (modules, abc.Ma
-0001ab50: 7070 696e 6729 3a0d 0a20 2020 2020 2020  pping):..       
-0001ab60: 2020 2020 2066 6f72 206b 6579 2c20 6d6f       for key, mo
-0001ab70: 6475 6c65 2069 6e20 736f 7274 6564 286d  dule in sorted(m
-0001ab80: 6f64 756c 6573 2e69 7465 6d73 2829 293a  odules.items()):
-0001ab90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001aba0: 2020 7365 6c66 5b6b 6579 5d20 3d20 6d6f    self[key] = mo
-0001abb0: 6475 6c65 0d0a 2020 2020 2020 2020 656c  dule..        el
-0001abc0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0001abd0: 2066 6f72 206a 2c20 6d20 696e 2065 6e75   for j, m in enu
-0001abe0: 6d65 7261 7465 286d 6f64 756c 6573 293a  merate(modules):
-0001abf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ac00: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001ac10: 6e63 6528 6d2c 2061 6263 2e49 7465 7261  nce(m, abc.Itera
-0001ac20: 626c 6529 3a0d 0a20 2020 2020 2020 2020  ble):..         
-0001ac30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001ac40: 2054 7970 6545 7272 6f72 2822 4d6f 6475   TypeError("Modu
-0001ac50: 6c65 4469 6374 2075 7064 6174 6520 7365  leDict update se
-0001ac60: 7175 656e 6365 2065 6c65 6d65 6e74 2022  quence element "
-0001ac70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000197b0: 2020 2020 2020 2020 2022 6974 6572 6162           "iterab
+000197c0: 6c65 2c20 6275 7420 676f 7420 2220 2b20  le, but got " + 
+000197d0: 7479 7065 286d 6f64 756c 6573 292e 5f5f  type(modules).__
+000197e0: 6e61 6d65 5f5f 290d 0a20 2020 2020 2020  name__)..       
+000197f0: 206f 6666 7365 7420 3d20 6c65 6e28 7365   offset = len(se
+00019800: 6c66 290d 0a20 2020 2020 2020 2066 6f72  lf)..        for
+00019810: 2069 2c20 6d6f 6475 6c65 2069 6e20 656e   i, module in en
+00019820: 756d 6572 6174 6528 6d6f 6475 6c65 7329  umerate(modules)
+00019830: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00019840: 656c 662e 6164 645f 6d6f 6475 6c65 2873  elf.add_module(s
+00019850: 7472 286f 6666 7365 7420 2b20 6929 2c20  tr(offset + i), 
+00019860: 6d6f 6475 6c65 290d 0a20 2020 2020 2020  module)..       
+00019870: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
+00019880: 2020 2020 2320 7265 6d6f 7665 2066 6f72      # remove for
+00019890: 7761 7264 2061 6c6c 746f 6765 7468 6572  ward alltogether
+000198a0: 2074 6f20 6661 6c6c 6261 636b 206f 6e20   to fallback on 
+000198b0: 4d6f 6475 6c65 2773 205f 666f 7277 6172  Module's _forwar
+000198c0: 645f 756e 696d 706c 656d 656e 7465 640d  d_unimplemented.
+000198d0: 0a0d 0a0d 0a0d 0a0d 0a0d 0a63 6c61 7373  ...........class
+000198e0: 204d 6f64 756c 6544 6963 7428 4c61 7965   ModuleDict(Laye
+000198f0: 7229 3a0d 0a20 2020 2022 2222 486f 6c64  r):..    """Hold
+00019900: 7320 7375 626d 6f64 756c 6573 2069 6e20  s submodules in 
+00019910: 6120 6469 6374 696f 6e61 7279 2e0d 0a0d  a dictionary....
+00019920: 0a20 2020 203a 636c 6173 733a 607e 746f  .    :class:`~to
+00019930: 7263 682e 6e6e 2e4d 6f64 756c 6544 6963  rch.nn.ModuleDic
+00019940: 7460 2063 616e 2062 6520 696e 6465 7865  t` can be indexe
+00019950: 6420 6c69 6b65 2061 2072 6567 756c 6172  d like a regular
+00019960: 2050 7974 686f 6e20 6469 6374 696f 6e61   Python dictiona
+00019970: 7279 2c0d 0a20 2020 2062 7574 206d 6f64  ry,..    but mod
+00019980: 756c 6573 2069 7420 636f 6e74 6169 6e73  ules it contains
+00019990: 2061 7265 2070 726f 7065 726c 7920 7265   are properly re
+000199a0: 6769 7374 6572 6564 2c20 616e 6420 7769  gistered, and wi
+000199b0: 6c6c 2062 6520 7669 7369 626c 6520 6279  ll be visible by
+000199c0: 2061 6c6c 0d0a 2020 2020 3a63 6c61 7373   all..    :class
+000199d0: 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f 6475  :`~torch.nn.Modu
+000199e0: 6c65 6020 6d65 7468 6f64 732e 0d0a 0d0a  le` methods.....
+000199f0: 2020 2020 3a63 6c61 7373 3a60 7e74 6f72      :class:`~tor
+00019a00: 6368 2e6e 6e2e 4d6f 6475 6c65 4469 6374  ch.nn.ModuleDict
+00019a10: 6020 6973 2061 6e20 2a2a 6f72 6465 7265  ` is an **ordere
+00019a20: 642a 2a20 6469 6374 696f 6e61 7279 2074  d** dictionary t
+00019a30: 6861 7420 7265 7370 6563 7473 0d0a 0d0a  hat respects....
+00019a40: 2020 2020 2a20 7468 6520 6f72 6465 7220      * the order 
+00019a50: 6f66 2069 6e73 6572 7469 6f6e 2c20 616e  of insertion, an
+00019a60: 640d 0a0d 0a20 2020 202a 2069 6e20 3a6d  d....    * in :m
+00019a70: 6574 683a 607e 746f 7263 682e 6e6e 2e4d  eth:`~torch.nn.M
+00019a80: 6f64 756c 6544 6963 742e 7570 6461 7465  oduleDict.update
+00019a90: 602c 2074 6865 206f 7264 6572 206f 6620  `, the order of 
+00019aa0: 7468 6520 6d65 7267 6564 2060 604f 7264  the merged ``Ord
+00019ab0: 6572 6564 4469 6374 6060 0d0a 2020 2020  eredDict``..    
+00019ac0: 2020 6f72 2061 6e6f 7468 6572 203a 636c    or another :cl
+00019ad0: 6173 733a 607e 746f 7263 682e 6e6e 2e4d  ass:`~torch.nn.M
+00019ae0: 6f64 756c 6544 6963 7460 2028 7468 6520  oduleDict` (the 
+00019af0: 6172 6775 6d65 6e74 2074 6f20 3a6d 6574  argument to :met
+00019b00: 683a 607e 746f 7263 682e 6e6e 2e4d 6f64  h:`~torch.nn.Mod
+00019b10: 756c 6544 6963 742e 7570 6461 7465 6029  uleDict.update`)
+00019b20: 2e0d 0a0d 0a20 2020 204e 6f74 6520 7468  .....    Note th
+00019b30: 6174 203a 6d65 7468 3a60 7e74 6f72 6368  at :meth:`~torch
+00019b40: 2e6e 6e2e 4d6f 6475 6c65 4469 6374 2e75  .nn.ModuleDict.u
+00019b50: 7064 6174 6560 2077 6974 6820 6f74 6865  pdate` with othe
+00019b60: 7220 756e 6f72 6465 7265 6420 6d61 7070  r unordered mapp
+00019b70: 696e 670d 0a20 2020 2074 7970 6573 2028  ing..    types (
+00019b80: 652e 672e 2c20 5079 7468 6f6e 2773 2070  e.g., Python's p
+00019b90: 6c61 696e 2060 6064 6963 7460 6029 2064  lain ``dict``) d
+00019ba0: 6f65 7320 6e6f 7420 7072 6573 6572 7665  oes not preserve
+00019bb0: 2074 6865 206f 7264 6572 206f 6620 7468   the order of th
+00019bc0: 650d 0a20 2020 206d 6572 6765 6420 6d61  e..    merged ma
+00019bd0: 7070 696e 672e 0d0a 0d0a 2020 2020 4172  pping.....    Ar
+00019be0: 6775 6d65 6e74 733a 0d0a 2020 2020 2020  guments:..      
+00019bf0: 2020 6d6f 6475 6c65 7320 2869 7465 7261    modules (itera
+00019c00: 626c 652c 206f 7074 696f 6e61 6c29 3a20  ble, optional): 
+00019c10: 6120 6d61 7070 696e 6720 2864 6963 7469  a mapping (dicti
+00019c20: 6f6e 6172 7929 206f 6620 2873 7472 696e  onary) of (strin
+00019c30: 673a 206d 6f64 756c 6529 0d0a 2020 2020  g: module)..    
+00019c40: 2020 2020 2020 2020 6f72 2061 6e20 6974          or an it
+00019c50: 6572 6162 6c65 206f 6620 6b65 792d 7661  erable of key-va
+00019c60: 6c75 6520 7061 6972 7320 6f66 2074 7970  lue pairs of typ
+00019c70: 6520 2873 7472 696e 672c 206d 6f64 756c  e (string, modul
+00019c80: 6529 0d0a 0d0a 2020 2020 4578 616d 706c  e)....    Exampl
+00019c90: 653a 3a0d 0a0d 0a20 2020 2020 2020 2063  e::....        c
+00019ca0: 6c61 7373 204d 794d 6f64 756c 6528 6e6e  lass MyModule(nn
+00019cb0: 2e4d 6f64 756c 6529 3a0d 0a20 2020 2020  .Module):..     
+00019cc0: 2020 2020 2020 2064 6566 205f 5f69 6e69         def __ini
+00019cd0: 745f 5f28 7365 6c66 293a 0d0a 2020 2020  t__(self):..    
+00019ce0: 2020 2020 2020 2020 2020 2020 7375 7065              supe
+00019cf0: 7228 4d79 4d6f 6475 6c65 2c20 7365 6c66  r(MyModule, self
+00019d00: 292e 5f5f 696e 6974 5f5f 2829 0d0a 2020  ).__init__()..  
+00019d10: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00019d20: 6c66 2e63 686f 6963 6573 203d 206e 6e2e  lf.choices = nn.
+00019d30: 4d6f 6475 6c65 4469 6374 287b 0d0a 2020  ModuleDict({..  
+00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d50: 2020 2020 2020 2763 6f6e 7627 3a20 6e6e        'conv': nn
+00019d60: 2e43 6f6e 7632 6428 3130 2c20 3130 2c20  .Conv2d(10, 10, 
+00019d70: 3329 2c0d 0a20 2020 2020 2020 2020 2020  3),..           
+00019d80: 2020 2020 2020 2020 2020 2020 2027 706f               'po
+00019d90: 6f6c 273a 206e 6e2e 4d61 7850 6f6f 6c32  ol': nn.MaxPool2
+00019da0: 6428 3329 0d0a 2020 2020 2020 2020 2020  d(3)..          
+00019db0: 2020 2020 2020 7d29 0d0a 2020 2020 2020        })..      
+00019dc0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00019dd0: 6374 6976 6174 696f 6e73 203d 206e 6e2e  ctivations = nn.
+00019de0: 4d6f 6475 6c65 4469 6374 285b 0d0a 2020  ModuleDict([..  
+00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e00: 2020 2020 2020 5b27 6c72 656c 7527 2c20        ['lrelu', 
+00019e10: 6e6e 2e4c 6561 6b79 5265 4c55 2829 5d2c  nn.LeakyReLU()],
+00019e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019e30: 2020 2020 2020 2020 2020 5b27 7072 656c            ['prel
+00019e40: 7527 2c20 6e6e 2e50 5265 4c55 2829 5d0d  u', nn.PReLU()].
+00019e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019e60: 205d 290d 0a0d 0a20 2020 2020 2020 2020   ])....         
+00019e70: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+00019e80: 656c 662c 2078 2c20 6368 6f69 6365 2c20  elf, x, choice, 
+00019e90: 6163 7429 3a0d 0a20 2020 2020 2020 2020  act):..         
+00019ea0: 2020 2020 2020 2078 203d 2073 656c 662e         x = self.
+00019eb0: 6368 6f69 6365 735b 6368 6f69 6365 5d28  choices[choice](
+00019ec0: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+00019ed0: 2020 2020 7820 3d20 7365 6c66 2e61 6374      x = self.act
+00019ee0: 6976 6174 696f 6e73 5b61 6374 5d28 7829  ivations[act](x)
+00019ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019f00: 2020 7265 7475 726e 2078 0d0a 2020 2020    return x..    
+00019f10: 2222 220d 0a0d 0a20 2020 205f 6d6f 6475  """....    _modu
+00019f20: 6c65 733a 2044 6963 745b 7374 722c 206e  les: Dict[str, n
+00019f30: 6e2e 4d6f 6475 6c65 5d20 2023 2074 7970  n.Module]  # typ
+00019f40: 653a 2069 676e 6f72 655b 6173 7369 676e  e: ignore[assign
+00019f50: 6d65 6e74 5d0d 0a20 2020 2064 6566 205f  ment]..    def _
+00019f60: 5f69 6e69 745f 5f28 7365 6c66 2c20 6d6f  _init__(self, mo
+00019f70: 6475 6c65 733a 204f 7074 696f 6e61 6c5b  dules: Optional[
+00019f80: 4d61 7070 696e 675b 7374 722c 204c 6179  Mapping[str, Lay
+00019f90: 6572 5d5d 203d 204e 6f6e 652c 206e 616d  er]] = None, nam
+00019fa0: 653d 4e6f 6e65 2c20 6b65 6570 5f6f 7574  e=None, keep_out
+00019fb0: 7075 743d 4661 6c73 652c 0d0a 2020 2020  put=False,..    
+00019fc0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+00019fd0: 6d75 6c74 6963 6173 7469 6e67 3d54 7275  multicasting=Tru
+00019fe0: 652c 202a 2a6b 7761 7267 7329 202d 3e20  e, **kwargs) -> 
+00019ff0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2073  None:..        s
+0001a000: 7570 6572 284d 6f64 756c 6544 6963 742c  uper(ModuleDict,
+0001a010: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+0001a020: 6e61 6d65 3d6e 616d 652c 206b 6565 705f  name=name, keep_
+0001a030: 6f75 7470 7574 3d6b 6565 705f 6f75 7470  output=keep_outp
+0001a040: 7574 2c20 2a2a 6b77 6172 6773 290d 0a20  ut, **kwargs).. 
+0001a050: 2020 2020 2020 2073 656c 662e 7575 6964         self.uuid
+0001a060: 203d 2075 7569 642e 7575 6964 3428 292e   = uuid.uuid4().
+0001a070: 6e6f 6465 0d0a 0d0a 2020 2020 2020 2020  node....        
+0001a080: 7365 6c66 2e69 735f 6d75 6c74 6963 6173  self.is_multicas
+0001a090: 7469 6e67 203d 2069 735f 6d75 6c74 6963  ting = is_multic
+0001a0a0: 6173 7469 6e67 0d0a 2020 2020 2020 2020  asting..        
+0001a0b0: 6966 206d 6f64 756c 6573 2069 7320 6e6f  if modules is no
+0001a0c0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0001a0d0: 2020 2020 2069 6620 6c65 6e28 6d6f 6475       if len(modu
+0001a0e0: 6c65 7329 203e 2030 3a0d 0a20 2020 2020  les) > 0:..     
+0001a0f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001a100: 7570 6461 7465 286d 6f64 756c 6573 290d  update(modules).
+0001a110: 0a0d 0a20 2020 2023 2040 5f63 6f70 795f  ...    # @_copy_
+0001a120: 746f 5f73 6372 6970 745f 7772 6170 7065  to_script_wrappe
+0001a130: 720d 0a20 2020 2064 6566 205f 5f67 6574  r..    def __get
+0001a140: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
+0001a150: 3a20 7374 7229 202d 3e20 4c61 7965 723a  : str) -> Layer:
+0001a160: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a170: 2073 656c 662e 5f6d 6f64 756c 6573 5b6b   self._modules[k
+0001a180: 6579 5d0d 0a0d 0a20 2020 2064 6566 205f  ey]....    def _
+0001a190: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
+0001a1a0: 206b 6579 3a20 7374 722c 206d 6f64 756c   key: str, modul
+0001a1b0: 653a 204c 6179 6572 2920 2d3e 204e 6f6e  e: Layer) -> Non
+0001a1c0: 653a 0d0a 2020 2020 2020 2020 7365 6c66  e:..        self
+0001a1d0: 2e61 6464 5f6d 6f64 756c 6528 6b65 792c  .add_module(key,
+0001a1e0: 206d 6f64 756c 6529 0d0a 0d0a 2020 2020   module)....    
+0001a1f0: 6465 6620 5f5f 6465 6c69 7465 6d5f 5f28  def __delitem__(
+0001a200: 7365 6c66 2c20 6b65 793a 2073 7472 2920  self, key: str) 
+0001a210: 2d3e 204e 6f6e 653a 0d0a 2020 2020 2020  -> None:..      
+0001a220: 2020 6465 6c20 7365 6c66 2e5f 6d6f 6475    del self._modu
+0001a230: 6c65 735b 6b65 795d 0d0a 0d0a 2020 2020  les[key]....    
+0001a240: 405f 636f 7079 5f74 6f5f 7363 7269 7074  @_copy_to_script
+0001a250: 5f77 7261 7070 6572 0d0a 2020 2020 6465  _wrapper..    de
+0001a260: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 2920  f __len__(self) 
+0001a270: 2d3e 2069 6e74 3a0d 0a20 2020 2020 2020  -> int:..       
+0001a280: 2072 6574 7572 6e20 6c65 6e28 7365 6c66   return len(self
+0001a290: 2e5f 6d6f 6475 6c65 7329 0d0a 0d0a 2020  ._modules)....  
+0001a2a0: 2020 405f 636f 7079 5f74 6f5f 7363 7269    @_copy_to_scri
+0001a2b0: 7074 5f77 7261 7070 6572 0d0a 2020 2020  pt_wrapper..    
+0001a2c0: 6465 6620 5f5f 6974 6572 5f5f 2873 656c  def __iter__(sel
+0001a2d0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+0001a2e0: 7572 6e20 6974 6572 2873 656c 662e 5f6d  urn iter(self._m
+0001a2f0: 6f64 756c 6573 290d 0a0d 0a20 2020 2040  odules)....    @
+0001a300: 5f63 6f70 795f 746f 5f73 6372 6970 745f  _copy_to_script_
+0001a310: 7772 6170 7065 720d 0a20 2020 2064 6566  wrapper..    def
+0001a320: 205f 5f63 6f6e 7461 696e 735f 5f28 7365   __contains__(se
+0001a330: 6c66 2c20 6b65 793a 2073 7472 2920 2d3e  lf, key: str) ->
+0001a340: 2062 6f6f 6c3a 0d0a 2020 2020 2020 2020   bool:..        
+0001a350: 7265 7475 726e 206b 6579 2069 6e20 7365  return key in se
+0001a360: 6c66 2e5f 6d6f 6475 6c65 730d 0a0d 0a20  lf._modules.... 
+0001a370: 2020 2064 6566 2063 6c65 6172 2873 656c     def clear(sel
+0001a380: 6629 202d 3e20 4e6f 6e65 3a0d 0a20 2020  f) -> None:..   
+0001a390: 2020 2020 2022 2222 5265 6d6f 7665 2061       """Remove a
+0001a3a0: 6c6c 2069 7465 6d73 2066 726f 6d20 7468  ll items from th
+0001a3b0: 6520 4d6f 6475 6c65 4469 6374 2e0d 0a20  e ModuleDict... 
+0001a3c0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0001a3d0: 2020 2020 7365 6c66 2e5f 6d6f 6475 6c65      self._module
+0001a3e0: 732e 636c 6561 7228 290d 0a0d 0a20 2020  s.clear()....   
+0001a3f0: 2064 6566 2070 6f70 2873 656c 662c 206b   def pop(self, k
+0001a400: 6579 3a20 7374 7229 202d 3e20 4c61 7965  ey: str) -> Laye
+0001a410: 723a 0d0a 2020 2020 2020 2020 2222 2252  r:..        """R
+0001a420: 656d 6f76 6520 6b65 7920 6672 6f6d 2074  emove key from t
+0001a430: 6865 204d 6f64 756c 6544 6963 7420 616e  he ModuleDict an
+0001a440: 6420 7265 7475 726e 2069 7473 206d 6f64  d return its mod
+0001a450: 756c 652e 0d0a 0d0a 2020 2020 2020 2020  ule.....        
+0001a460: 4172 6775 6d65 6e74 733a 0d0a 2020 2020  Arguments:..    
+0001a470: 2020 2020 2020 2020 6b65 7920 2873 7472          key (str
+0001a480: 696e 6729 3a20 6b65 7920 746f 2070 6f70  ing): key to pop
+0001a490: 2066 726f 6d20 7468 6520 4d6f 6475 6c65   from the Module
+0001a4a0: 4469 6374 0d0a 2020 2020 2020 2020 2222  Dict..        ""
+0001a4b0: 220d 0a20 2020 2020 2020 2076 203d 2073  "..        v = s
+0001a4c0: 656c 665b 6b65 795d 0d0a 2020 2020 2020  elf[key]..      
+0001a4d0: 2020 6465 6c20 7365 6c66 5b6b 6579 5d0d    del self[key].
+0001a4e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001a4f0: 760d 0a0d 0a20 2020 2023 2040 5f63 6f70  v....    # @_cop
+0001a500: 795f 746f 5f73 6372 6970 745f 7772 6170  y_to_script_wrap
+0001a510: 7065 720d 0a20 2020 2064 6566 206b 6579  per..    def key
+0001a520: 7328 7365 6c66 2920 2d3e 2049 7465 7261  s(self) -> Itera
+0001a530: 626c 655b 7374 725d 3a0d 0a20 2020 2020  ble[str]:..     
+0001a540: 2020 2022 2222 5265 7475 726e 2061 6e20     """Return an 
+0001a550: 6974 6572 6162 6c65 206f 6620 7468 6520  iterable of the 
+0001a560: 4d6f 6475 6c65 4469 6374 206b 6579 732e  ModuleDict keys.
+0001a570: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0001a580: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001a590: 6c66 2e5f 6d6f 6475 6c65 732e 6b65 7973  lf._modules.keys
+0001a5a0: 2829 0d0a 0d0a 2020 2020 2320 405f 636f  ()....    # @_co
+0001a5b0: 7079 5f74 6f5f 7363 7269 7074 5f77 7261  py_to_script_wra
+0001a5c0: 7070 6572 0d0a 2020 2020 6465 6620 6974  pper..    def it
+0001a5d0: 656d 7328 7365 6c66 2920 2d3e 2049 7465  ems(self) -> Ite
+0001a5e0: 7261 626c 655b 5475 706c 655b 7374 722c  rable[Tuple[str,
+0001a5f0: 204c 6179 6572 5d5d 3a0d 0a20 2020 2020   Layer]]:..     
+0001a600: 2020 2022 2222 5265 7475 726e 2061 6e20     """Return an 
+0001a610: 6974 6572 6162 6c65 206f 6620 7468 6520  iterable of the 
+0001a620: 4d6f 6475 6c65 4469 6374 206b 6579 2f76  ModuleDict key/v
+0001a630: 616c 7565 2070 6169 7273 2e0d 0a20 2020  alue pairs...   
+0001a640: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0001a650: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001a660: 6f64 756c 6573 2e69 7465 6d73 2829 0d0a  odules.items()..
+0001a670: 0d0a 2020 2020 2320 405f 636f 7079 5f74  ..    # @_copy_t
+0001a680: 6f5f 7363 7269 7074 5f77 7261 7070 6572  o_script_wrapper
+0001a690: 0d0a 2020 2020 6465 6620 7661 6c75 6573  ..    def values
+0001a6a0: 2873 656c 6629 202d 3e20 4974 6572 6162  (self) -> Iterab
+0001a6b0: 6c65 5b4c 6179 6572 5d3a 0d0a 2020 2020  le[Layer]:..    
+0001a6c0: 2020 2020 2222 2252 6574 7572 6e20 616e      """Return an
+0001a6d0: 2069 7465 7261 626c 6520 6f66 2074 6865   iterable of the
+0001a6e0: 204d 6f64 756c 6544 6963 7420 7661 6c75   ModuleDict valu
+0001a6f0: 6573 2e0d 0a20 2020 2020 2020 2022 2222  es...        """
+0001a700: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a710: 2073 656c 662e 5f6d 6f64 756c 6573 2e76   self._modules.v
+0001a720: 616c 7565 7328 290d 0a0d 0a20 2020 2064  alues()....    d
+0001a730: 6566 2075 7064 6174 6528 7365 6c66 2c20  ef update(self, 
+0001a740: 6d6f 6475 6c65 733a 204d 6170 7069 6e67  modules: Mapping
+0001a750: 5b73 7472 2c20 4c61 7965 725d 2920 2d3e  [str, Layer]) ->
+0001a760: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0001a770: 2222 2255 7064 6174 6520 7468 6520 3a63  """Update the :c
+0001a780: 6c61 7373 3a60 7e74 6f72 6368 2e6e 6e2e  lass:`~torch.nn.
+0001a790: 4d6f 6475 6c65 4469 6374 6020 7769 7468  ModuleDict` with
+0001a7a0: 2074 6865 206b 6579 2d76 616c 7565 2070   the key-value p
+0001a7b0: 6169 7273 2066 726f 6d20 610d 0a20 2020  airs from a..   
+0001a7c0: 2020 2020 206d 6170 7069 6e67 206f 7220       mapping or 
+0001a7d0: 616e 2069 7465 7261 626c 652c 206f 7665  an iterable, ove
+0001a7e0: 7277 7269 7469 6e67 2065 7869 7374 696e  rwriting existin
+0001a7f0: 6720 6b65 7973 2e0d 0a0d 0a20 2020 2020  g keys.....     
+0001a800: 2020 206e 6f74 653a 3a0d 0a20 2020 2020     note::..     
+0001a810: 2020 2020 2020 2049 6620 3a61 7474 723a         If :attr:
+0001a820: 606d 6f64 756c 6573 6020 6973 2061 6e20  `modules` is an 
+0001a830: 6060 4f72 6465 7265 6444 6963 7460 602c  ``OrderedDict``,
+0001a840: 2061 203a 636c 6173 733a 607e 746f 7263   a :class:`~torc
+0001a850: 682e 6e6e 2e4d 6f64 756c 6544 6963 7460  h.nn.ModuleDict`
+0001a860: 2c20 6f72 0d0a 2020 2020 2020 2020 2020  , or..          
+0001a870: 2020 616e 2069 7465 7261 626c 6520 6f66    an iterable of
+0001a880: 206b 6579 2d76 616c 7565 2070 6169 7273   key-value pairs
+0001a890: 2c20 7468 6520 6f72 6465 7220 6f66 206e  , the order of n
+0001a8a0: 6577 2065 6c65 6d65 6e74 7320 696e 2069  ew elements in i
+0001a8b0: 7420 6973 2070 7265 7365 7276 6564 2e0d  t is preserved..
+0001a8c0: 0a0d 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
+0001a8d0: 656e 7473 3a0d 0a20 2020 2020 2020 2020  ents:..         
+0001a8e0: 2020 206d 6f64 756c 6573 2028 6974 6572     modules (iter
+0001a8f0: 6162 6c65 293a 2061 206d 6170 7069 6e67  able): a mapping
+0001a900: 2028 6469 6374 696f 6e61 7279 2920 6672   (dictionary) fr
+0001a910: 6f6d 2073 7472 696e 6720 746f 203a 636c  om string to :cl
+0001a920: 6173 733a 607e 746f 7263 682e 6e6e 2e4d  ass:`~torch.nn.M
+0001a930: 6f64 756c 6560 2c0d 0a20 2020 2020 2020  odule`,..       
+0001a940: 2020 2020 2020 2020 206f 7220 616e 2069           or an i
+0001a950: 7465 7261 626c 6520 6f66 206b 6579 2d76  terable of key-v
+0001a960: 616c 7565 2070 6169 7273 206f 6620 7479  alue pairs of ty
+0001a970: 7065 2028 7374 7269 6e67 2c20 3a63 6c61  pe (string, :cla
+0001a980: 7373 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f  ss:`~torch.nn.Mo
+0001a990: 6475 6c65 6029 0d0a 2020 2020 2020 2020  dule`)..        
+0001a9a0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+0001a9b0: 6e6f 7420 6973 696e 7374 616e 6365 286d  not isinstance(m
+0001a9c0: 6f64 756c 6573 2c20 6162 632e 4974 6572  odules, abc.Iter
+0001a9d0: 6162 6c65 293a 0d0a 2020 2020 2020 2020  able):..        
+0001a9e0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0001a9f0: 726f 7228 224d 6f64 756c 6544 6963 742e  ror("ModuleDict.
+0001aa00: 7570 6461 7465 2073 686f 756c 6420 6265  update should be
+0001aa10: 2063 616c 6c65 6420 7769 7468 2061 6e20   called with an 
+0001aa20: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0001aa30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001aa40: 6974 6572 6162 6c65 206f 6620 6b65 792f  iterable of key/
+0001aa50: 7661 6c75 6520 7061 6972 732c 2062 7574  value pairs, but
+0001aa60: 2067 6f74 2022 202b 0d0a 2020 2020 2020   got " +..      
+0001aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa80: 2020 2020 2020 7479 7065 286d 6f64 756c        type(modul
+0001aa90: 6573 292e 5f5f 6e61 6d65 5f5f 290d 0a0d  es).__name__)...
+0001aaa0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0001aab0: 7374 616e 6365 286d 6f64 756c 6573 2c20  stance(modules, 
+0001aac0: 284f 7264 6572 6564 4469 6374 2c20 4d6f  (OrderedDict, Mo
+0001aad0: 6475 6c65 4469 6374 2929 3a0d 0a20 2020  duleDict)):..   
+0001aae0: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+0001aaf0: 2c20 6d6f 6475 6c65 2069 6e20 6d6f 6475  , module in modu
+0001ab00: 6c65 732e 6974 656d 7328 293a 0d0a 2020  les.items():..  
+0001ab10: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001ab20: 6c66 5b6b 6579 5d20 3d20 6d6f 6475 6c65  lf[key] = module
+0001ab30: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+0001ab40: 7369 6e73 7461 6e63 6528 6d6f 6475 6c65  sinstance(module
+0001ab50: 732c 2061 6263 2e4d 6170 7069 6e67 293a  s, abc.Mapping):
+0001ab60: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0001ab70: 7220 6b65 792c 206d 6f64 756c 6520 696e  r key, module in
+0001ab80: 2073 6f72 7465 6428 6d6f 6475 6c65 732e   sorted(modules.
+0001ab90: 6974 656d 7328 2929 3a0d 0a20 2020 2020  items()):..     
+0001aba0: 2020 2020 2020 2020 2020 2073 656c 665b             self[
+0001abb0: 6b65 795d 203d 206d 6f64 756c 650d 0a20  key] = module.. 
+0001abc0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0001abd0: 2020 2020 2020 2020 2020 666f 7220 6a2c            for j,
+0001abe0: 206d 2069 6e20 656e 756d 6572 6174 6528   m in enumerate(
+0001abf0: 6d6f 6475 6c65 7329 3a0d 0a20 2020 2020  modules):..     
+0001ac00: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001ac10: 7420 6973 696e 7374 616e 6365 286d 2c20  t isinstance(m, 
+0001ac20: 6162 632e 4974 6572 6162 6c65 293a 0d0a  abc.Iterable):..
+0001ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac40: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0001ac50: 726f 7228 224d 6f64 756c 6544 6963 7420  ror("ModuleDict 
+0001ac60: 7570 6461 7465 2073 6571 7565 6e63 6520  update sequence 
+0001ac70: 656c 656d 656e 7420 220d 0a20 2020 2020  element "..     
 0001ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac90: 2020 2020 2020 2223 2220 2b20 7374 7228        "#" + str(
-0001aca0: 6a29 202b 2022 2073 686f 756c 6420 6265  j) + " should be
-0001acb0: 2049 7465 7261 626c 653b 2069 7322 202b   Iterable; is" +
-0001acc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001aca0: 2322 202b 2073 7472 286a 2920 2b20 2220  #" + str(j) + " 
+0001acb0: 7368 6f75 6c64 2062 6520 4974 6572 6162  should be Iterab
+0001acc0: 6c65 3b20 6973 2220 2b0d 0a20 2020 2020  le; is" +..     
 0001acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ace0: 2020 2020 2020 7479 7065 286d 292e 5f5f        type(m).__
-0001acf0: 6e61 6d65 5f5f 290d 0a20 2020 2020 2020  name__)..       
-0001ad00: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001ad10: 6c65 6e28 6d29 203d 3d20 323a 0d0a 2020  len(m) == 2:..  
-0001ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad30: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001ad40: 6f72 2822 4d6f 6475 6c65 4469 6374 2075  or("ModuleDict u
-0001ad50: 7064 6174 6520 7365 7175 656e 6365 2065  pdate sequence e
-0001ad60: 6c65 6d65 6e74 2022 0d0a 2020 2020 2020  lement "..      
-0001ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad80: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001ad90: 2322 202b 2073 7472 286a 2920 2b20 2220  #" + str(j) + " 
-0001ada0: 6861 7320 6c65 6e67 7468 2022 202b 2073  has length " + s
-0001adb0: 7472 286c 656e 286d 2929 202b 0d0a 2020  tr(len(m)) +..  
-0001adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001acf0: 7970 6528 6d29 2e5f 5f6e 616d 655f 5f29  ype(m).__name__)
+0001ad00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ad10: 2020 6966 206e 6f74 206c 656e 286d 2920    if not len(m) 
+0001ad20: 3d3d 2032 3a0d 0a20 2020 2020 2020 2020  == 2:..         
+0001ad30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001ad40: 2056 616c 7565 4572 726f 7228 224d 6f64   ValueError("Mod
+0001ad50: 756c 6544 6963 7420 7570 6461 7465 2073  uleDict update s
+0001ad60: 6571 7565 6e63 6520 656c 656d 656e 7420  equence element 
+0001ad70: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0001ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad90: 2020 2020 2020 2020 2223 2220 2b20 7374          "#" + st
+0001ada0: 7228 6a29 202b 2022 2068 6173 206c 656e  r(j) + " has len
+0001adb0: 6774 6820 2220 2b20 7374 7228 6c65 6e28  gth " + str(len(
+0001adc0: 6d29 2920 2b0d 0a20 2020 2020 2020 2020  m)) +..         
 0001add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ade0: 2020 2022 3b20 3220 6973 2072 6571 7569     "; 2 is requi
-0001adf0: 7265 6422 290d 0a20 2020 2020 2020 2020  red")..         
-0001ae00: 2020 2020 2020 2073 656c 665b 6d5b 305d         self[m[0]
-0001ae10: 5d20 3d20 6d5b 315d 0d0a 0d0a 2020 2020  ] = m[1]....    
-0001ae20: 6465 6620 6275 696c 6428 7365 6c66 2c20  def build(self, 
-0001ae30: 696e 7075 745f 7368 6170 653a 2054 656e  input_shape: Ten
-0001ae40: 736f 7253 6861 7065 293a 0d0a 2020 2020  sorShape):..    
-0001ae50: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
-0001ae60: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-0001ae70: 2020 2020 2020 696e 7075 745f 7368 6170        input_shap
-0001ae80: 6520 2874 6f72 6368 2e53 697a 652c 2074  e (torch.Size, t
-0001ae90: 656e 736f 722c 206c 6973 7428 696e 7429  ensor, list(int)
-0001aea0: 2c20 7475 706c 6528 696e 7429 293a 2054  , tuple(int)): T
-0001aeb0: 6865 2069 6e70 7574 5f73 6861 7065 2069  he input_shape i
-0001aec0: 6e66 6f72 6d61 7469 6f6e 2c20 6e6f 7420  nformation, not 
-0001aed0: 696e 636c 7564 696e 6720 6261 7463 6820  including batch 
-0001aee0: 6178 6973 2e0d 0a0d 0a20 2020 2020 2020  axis.....       
-0001aef0: 2052 6574 7572 6e73 3a0d 0a0d 0a20 2020   Returns:....   
-0001af00: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0001af10: 2020 6966 2073 656c 662e 5f62 7569 6c74    if self._built
-0001af20: 203d 3d20 4661 6c73 6520 616e 6420 6c65   == False and le
-0001af30: 6e28 7365 6c66 2e5f 6d6f 6475 6c65 7329  n(self._modules)
-0001af40: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-0001af50: 2020 2069 6620 7365 6c66 2e69 735f 726f     if self.is_ro
-0001af60: 6f74 3a0d 0a20 2020 2020 2020 2020 2020  ot:..           
-0001af70: 2020 2020 2073 656c 662e 5f69 6e70 7574       self._input
-0001af80: 5f73 6861 7065 203d 2069 6e70 7574 5f73  _shape = input_s
-0001af90: 6861 7065 0d0a 0d0a 2020 2020 2020 2020  hape....        
-0001afa0: 2020 2020 2020 2020 6475 6d6d 6179 5f69          dummay_i
-0001afb0: 6e70 7574 203d 2074 6f5f 7465 6e73 6f72  nput = to_tensor
-0001afc0: 2873 656c 662e 696e 7075 745f 7368 6170  (self.input_shap
-0001afd0: 652e 6765 745f 6475 6d6d 795f 7465 6e73  e.get_dummy_tens
-0001afe0: 6f72 2829 292e 746f 2873 656c 662e 6465  or()).to(self.de
-0001aff0: 7669 6365 290d 0a0d 0a20 2020 2020 2020  vice)....       
-0001b000: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
-0001b010: 652c 206d 6f64 756c 6520 696e 2073 656c  e, module in sel
-0001b020: 662e 6974 656d 7328 293a 0d0a 2020 2020  f.items():..    
-0001b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b040: 6f75 7420 3d20 6d6f 6475 6c65 2864 756d  out = module(dum
-0001b050: 6d61 795f 696e 7075 7429 0d0a 2020 2020  may_input)..    
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b070: 6d6f 6475 6c65 2e69 6e70 7574 5f73 6861  module.input_sha
-0001b080: 7065 203d 2069 6e70 7574 5f73 6861 7065  pe = input_shape
-0001b090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b0a0: 2020 2020 2020 6d6f 6475 6c65 2e6f 7574        module.out
-0001b0b0: 7075 745f 7368 6170 6520 3d20 7465 6e73  put_shape = tens
-0001b0c0: 6f72 5f74 6f5f 7368 6170 6528 6f75 7429  or_to_shape(out)
-0001b0d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b0e0: 2020 7365 6c66 2e5f 6275 696c 7420 3d20    self._built = 
-0001b0f0: 5472 7565 0d0a 0d0a 2020 2020 6465 6620  True....    def 
-0001b100: 666f 7277 6172 6428 7365 6c66 2c20 782c  forward(self, x,
-0001b110: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0001b120: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-0001b130: 6d75 6c74 6963 6173 7469 6e67 3a0d 0a20  multicasting:.. 
-0001b140: 2020 2020 2020 2020 2020 2023 2078 203d             # x =
-0001b150: 2065 6e66 6f72 6365 5f73 696e 676c 6574   enforce_singlet
-0001b160: 6f6e 2878 290d 0a20 2020 2020 2020 2020  on(x)..         
-0001b170: 2020 2072 6573 756c 7473 203d 204f 7264     results = Ord
-0001b180: 6572 6564 4469 6374 2829 0d0a 2020 2020  eredDict()..    
-0001b190: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-0001b1a0: 2c20 6d6f 6475 6c65 2069 6e20 7365 6c66  , module in self
-0001b1b0: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-0001b1c0: 2020 2020 2020 2020 2020 206f 7574 203d             out =
-0001b1d0: 206d 6f64 756c 6528 782c 202a 2a6b 7761   module(x, **kwa
-0001b1e0: 7267 7329 0d0a 2020 2020 2020 2020 2020  rgs)..          
-0001b1f0: 2020 2020 2020 7265 7375 6c74 735b 6e61        results[na
-0001b200: 6d65 5d20 3d20 6f75 740d 0a20 2020 2020  me] = out..     
-0001b210: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0001b220: 7375 6c74 730d 0a20 2020 2020 2020 2065  sults..        e
-0001b230: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0001b240: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0001b250: 6d65 6e74 6564 4572 726f 7228 290d 0a0d  mentedError()...
-0001b260: 0a0d 0a63 6c61 7373 2043 6f6d 6269 6e65  ...class Combine
-0001b270: 284c 6179 6572 293a 0d0a 2020 2020 2222  (Layer):..    ""
-0001b280: 2241 2073 6571 7565 6e74 6961 6c20 636f  "A sequential co
-0001b290: 6e74 6169 6e65 722e 0d0a 2020 2020 4d6f  ntainer...    Mo
-0001b2a0: 6475 6c65 7320 7769 6c6c 2062 6520 6164  dules will be ad
-0001b2b0: 6465 6420 746f 2069 7420 696e 2074 6865  ded to it in the
-0001b2c0: 206f 7264 6572 2074 6865 7920 6172 6520   order they are 
-0001b2d0: 7061 7373 6564 2069 6e20 7468 6520 636f  passed in the co
-0001b2e0: 6e73 7472 7563 746f 722e 0d0a 2020 2020  nstructor...    
-0001b2f0: 416c 7465 726e 6174 6976 656c 792c 2061  Alternatively, a
-0001b300: 6e20 6f72 6465 7265 6420 6469 6374 206f  n ordered dict o
-0001b310: 6620 6d6f 6475 6c65 7320 6361 6e20 616c  f modules can al
-0001b320: 736f 2062 6520 7061 7373 6564 2069 6e2e  so be passed in.
-0001b330: 0d0a 0d0a 2020 2020 546f 206d 616b 6520  ....    To make 
-0001b340: 6974 2065 6173 6965 7220 746f 2075 6e64  it easier to und
-0001b350: 6572 7374 616e 642c 2068 6572 6520 6973  erstand, here is
-0001b360: 2061 2073 6d61 6c6c 2065 7861 6d70 6c65   a small example
-0001b370: 3a3a 0d0a 0d0a 2020 2020 2020 2020 2320  ::....        # 
-0001b380: 4578 616d 706c 6520 6f66 2075 7369 6e67  Example of using
-0001b390: 2053 6571 7565 6e74 6961 6c0d 0a20 2020   Sequential..   
-0001b3a0: 2020 2020 206d 6f64 656c 203d 206e 6e2e       model = nn.
-0001b3b0: 5365 7175 656e 7469 616c 280d 0a20 2020  Sequential(..   
-0001b3c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001b3d0: 6e2e 436f 6e76 3264 2831 2c32 302c 3529  n.Conv2d(1,20,5)
-0001b3e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001b3f0: 2020 2020 206e 6e2e 5265 4c55 2829 2c0d       nn.ReLU(),.
-0001b400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b410: 2020 206e 6e2e 436f 6e76 3264 2832 302c     nn.Conv2d(20,
-0001b420: 3634 2c35 292c 0d0a 2020 2020 2020 2020  64,5),..        
-0001b430: 2020 2020 2020 2020 2020 6e6e 2e52 654c            nn.ReL
-0001b440: 5528 290d 0a20 2020 2020 2020 2020 2020  U()..           
-0001b450: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
-0001b460: 2020 2320 4578 616d 706c 6520 6f66 2075    # Example of u
-0001b470: 7369 6e67 2053 6571 7565 6e74 6961 6c20  sing Sequential 
-0001b480: 7769 7468 204f 7264 6572 6564 4469 6374  with OrderedDict
-0001b490: 0d0a 2020 2020 2020 2020 6d6f 6465 6c20  ..        model 
-0001b4a0: 3d20 6e6e 2e53 6571 7565 6e74 6961 6c28  = nn.Sequential(
-0001b4b0: 4f72 6465 7265 6444 6963 7428 5b0d 0a20  OrderedDict([.. 
-0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4d0: 2028 2763 6f6e 7631 272c 206e 6e2e 436f   ('conv1', nn.Co
-0001b4e0: 6e76 3264 2831 2c32 302c 3529 292c 0d0a  nv2d(1,20,5)),..
-0001b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b500: 2020 2827 7265 6c75 3127 2c20 6e6e 2e52    ('relu1', nn.R
-0001b510: 654c 5528 2929 2c0d 0a20 2020 2020 2020  eLU()),..       
-0001b520: 2020 2020 2020 2020 2020 2028 2763 6f6e             ('con
-0001b530: 7632 272c 206e 6e2e 436f 6e76 3264 2832  v2', nn.Conv2d(2
-0001b540: 302c 3634 2c35 2929 2c0d 0a20 2020 2020  0,64,5)),..     
-0001b550: 2020 2020 2020 2020 2020 2020 2028 2772               ('r
-0001b560: 656c 7532 272c 206e 6e2e 5265 4c55 2829  elu2', nn.ReLU()
-0001b570: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001b580: 2020 205d 2929 0d0a 2020 2020 2222 220d     ]))..    """.
-0001b590: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
-0001b5a0: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
-0001b5b0: 206e 616d 653d 4e6f 6e65 293a 0d0a 2020   name=None):..  
-0001b5c0: 2020 2020 2020 7375 7065 7228 436f 6d62        super(Comb
-0001b5d0: 696e 652c 2073 656c 6629 2e5f 5f69 6e69  ine, self).__ini
-0001b5e0: 745f 5f28 290d 0a20 2020 2020 2020 2073  t__()..        s
-0001b5f0: 656c 662e 7575 6964 203d 2075 7569 642e  elf.uuid = uuid.
-0001b600: 7575 6964 3428 292e 6e6f 6465 0d0a 2020  uuid4().node..  
-0001b610: 2020 2020 2020 7365 6c66 2e5f 6e61 6d65        self._name
-0001b620: 203d 206e 616d 650d 0a20 2020 2020 2020   = name..       
-0001b630: 2073 656c 662e 5f62 7569 6c74 203d 2046   self._built = F
-0001b640: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
-0001b650: 6966 206c 656e 2861 7267 7329 203d 3d20  if len(args) == 
-0001b660: 3120 616e 6420 6973 696e 7374 616e 6365  1 and isinstance
-0001b670: 2861 7267 735b 305d 2c20 4f72 6465 7265  (args[0], Ordere
-0001b680: 6444 6963 7429 3a0d 0a20 2020 2020 2020  dDict):..       
-0001b690: 2020 2020 2066 6f72 206b 6579 2c20 6d6f       for key, mo
-0001b6a0: 6475 6c65 2069 6e20 6172 6773 5b30 5d2e  dule in args[0].
-0001b6b0: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
-0001b6c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0001b6d0: 6464 5f6d 6f64 756c 6528 6b65 792c 206d  dd_module(key, m
-0001b6e0: 6f64 756c 6529 0d0a 2020 2020 2020 2020  odule)..        
-0001b6f0: 656c 6966 206c 656e 2861 7267 7329 203d  elif len(args) =
-0001b700: 3d20 3120 616e 6420 6973 696e 7374 616e  = 1 and isinstan
-0001b710: 6365 2861 7267 735b 305d 2c20 286c 6973  ce(args[0], (lis
-0001b720: 742c 206e 6e2e 4d6f 6475 6c65 4c69 7374  t, nn.ModuleList
-0001b730: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-0001b740: 2066 6f72 2069 6478 2c20 6d6f 6475 6c65   for idx, module
-0001b750: 2069 6e20 656e 756d 6572 6174 6528 6172   in enumerate(ar
-0001b760: 6773 5b30 5d29 3a0d 0a20 2020 2020 2020  gs[0]):..       
-0001b770: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
-0001b780: 645f 6d6f 6475 6c65 2873 7472 2869 6478  d_module(str(idx
-0001b790: 292c 206d 6f64 756c 6529 0d0a 2020 2020  ), module)..    
-0001b7a0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0001b7b0: 2020 2020 2020 2066 6f72 2069 6478 2c20         for idx, 
-0001b7c0: 6d6f 6475 6c65 2069 6e20 656e 756d 6572  module in enumer
-0001b7d0: 6174 6528 6172 6773 293a 0d0a 2020 2020  ate(args):..    
-0001b7e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001b7f0: 2e61 6464 5f6d 6f64 756c 6528 7374 7228  .add_module(str(
-0001b800: 6964 7829 2c20 6d6f 6475 6c65 290d 0a20  idx), module).. 
-0001b810: 2020 2020 2020 2073 656c 662e 746f 2873         self.to(s
-0001b820: 656c 662e 6465 7669 6365 290d 0a0d 0a20  elf.device).... 
-0001b830: 2020 2064 6566 205f 6765 745f 6974 656d     def _get_item
-0001b840: 5f62 795f 6964 7828 7365 6c66 2c20 6974  _by_idx(self, it
-0001b850: 6572 6174 6f72 2c20 6964 7829 3a0d 0a20  erator, idx):.. 
-0001b860: 2020 2020 2020 2022 2222 4765 7420 7468         """Get th
-0001b870: 6520 6964 782d 7468 2069 7465 6d20 6f66  e idx-th item of
-0001b880: 2074 6865 2069 7465 7261 746f 2222 220d   the iterato""".
-0001b890: 0a20 2020 2020 2020 2073 697a 6520 3d20  .        size = 
-0001b8a0: 6c65 6e28 7365 6c66 290d 0a20 2020 2020  len(self)..     
-0001b8b0: 2020 2069 6478 203d 2069 6478 2e5f 5f69     idx = idx.__i
-0001b8c0: 6e64 6578 5f5f 2829 0d0a 2020 2020 2020  ndex__()..      
-0001b8d0: 2020 6966 206e 6f74 202d 7369 7a65 203c    if not -size <
-0001b8e0: 3d20 6964 7820 3c20 7369 7a65 3a0d 0a20  = idx < size:.. 
-0001b8f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001b900: 2049 6e64 6578 4572 726f 7228 2769 6e64   IndexError('ind
-0001b910: 6578 207b 7d20 6973 206f 7574 206f 6620  ex {} is out of 
-0001b920: 7261 6e67 6527 2e66 6f72 6d61 7428 6964  range'.format(id
-0001b930: 7829 290d 0a20 2020 2020 2020 2069 6478  x))..        idx
-0001b940: 2025 3d20 7369 7a65 0d0a 2020 2020 2020   %= size..      
-0001b950: 2020 7265 7475 726e 206e 6578 7428 6973    return next(is
-0001b960: 6c69 6365 2869 7465 7261 746f 722c 2069  lice(iterator, i
-0001b970: 6478 2c20 4e6f 6e65 2929 0d0a 0d0a 2020  dx, None))....  
-0001b980: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
-0001b990: 5f28 7365 6c66 2c20 6964 7829 3a0d 0a20  _(self, idx):.. 
-0001b9a0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0001b9b0: 616e 6365 2869 6478 2c20 736c 6963 6529  ance(idx, slice)
-0001b9c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0001b9d0: 6574 7572 6e20 7365 6c66 2e5f 5f63 6c61  eturn self.__cla
-0001b9e0: 7373 5f5f 284f 7264 6572 6564 4469 6374  ss__(OrderedDict
-0001b9f0: 286c 6973 7428 7365 6c66 2e5f 6d6f 6475  (list(self._modu
-0001ba00: 6c65 732e 6974 656d 7328 2929 5b69 6478  les.items())[idx
-0001ba10: 5d29 290d 0a20 2020 2020 2020 2065 6c73  ]))..        els
-0001ba20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001ba30: 7265 7475 726e 2073 656c 662e 5f67 6574  return self._get
-0001ba40: 5f69 7465 6d5f 6279 5f69 6478 2873 656c  _item_by_idx(sel
-0001ba50: 662e 5f6d 6f64 756c 6573 2e76 616c 7565  f._modules.value
-0001ba60: 7328 292c 2069 6478 290d 0a0d 0a20 2020  s(), idx)....   
-0001ba70: 2064 6566 205f 5f73 6574 6974 656d 5f5f   def __setitem__
-0001ba80: 2873 656c 662c 2069 6478 2c20 6d6f 6475  (self, idx, modu
-0001ba90: 6c65 293a 0d0a 2020 2020 2020 2020 6b65  le):..        ke
-0001baa0: 7920 3d20 7365 6c66 2e5f 6765 745f 6974  y = self._get_it
-0001bab0: 656d 5f62 795f 6964 7828 7365 6c66 2e5f  em_by_idx(self._
-0001bac0: 6d6f 6475 6c65 732e 6b65 7973 2829 2c20  modules.keys(), 
-0001bad0: 6964 7829 0d0a 2020 2020 2020 2020 7265  idx)..        re
-0001bae0: 7475 726e 2073 6574 6174 7472 2873 656c  turn setattr(sel
-0001baf0: 662c 206b 6579 2c20 6d6f 6475 6c65 290d  f, key, module).
-0001bb00: 0a0d 0a20 2020 2064 6566 205f 5f64 656c  ...    def __del
-0001bb10: 6974 656d 5f5f 2873 656c 662c 2069 6478  item__(self, idx
-0001bb20: 293a 0d0a 2020 2020 2020 2020 6966 2069  ):..        if i
-0001bb30: 7369 6e73 7461 6e63 6528 6964 782c 2073  sinstance(idx, s
-0001bb40: 6c69 6365 293a 0d0a 2020 2020 2020 2020  lice):..        
-0001bb50: 2020 2020 666f 7220 6b65 7920 696e 206c      for key in l
-0001bb60: 6973 7428 7365 6c66 2e5f 6d6f 6475 6c65  ist(self._module
-0001bb70: 732e 6b65 7973 2829 295b 6964 785d 3a0d  s.keys())[idx]:.
-0001bb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bb90: 2064 656c 6174 7472 2873 656c 662c 206b   delattr(self, k
-0001bba0: 6579 290d 0a20 2020 2020 2020 2065 6c73  ey)..        els
-0001bbb0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001bbc0: 6b65 7920 3d20 7365 6c66 2e5f 6765 745f  key = self._get_
-0001bbd0: 6974 656d 5f62 795f 6964 7828 7365 6c66  item_by_idx(self
-0001bbe0: 2e5f 6d6f 6475 6c65 732e 6b65 7973 2829  ._modules.keys()
-0001bbf0: 2c20 6964 7829 0d0a 2020 2020 2020 2020  , idx)..        
-0001bc00: 2020 2020 6465 6c61 7474 7228 7365 6c66      delattr(self
-0001bc10: 2c20 6b65 7929 0d0a 0d0a 2020 2020 6465  , key)....    de
-0001bc20: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 293a  f __len__(self):
-0001bc30: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001bc40: 206c 656e 2873 656c 662e 5f6d 6f64 756c   len(self._modul
-0001bc50: 6573 290d 0a0d 0a20 2020 2064 6566 205f  es)....    def _
-0001bc60: 5f64 6972 5f5f 2873 656c 6629 3a0d 0a20  _dir__(self):.. 
-0001bc70: 2020 2020 2020 206b 6579 7320 3d20 7375         keys = su
-0001bc80: 7065 7228 436f 6d62 696e 652c 2073 656c  per(Combine, sel
-0001bc90: 6629 2e5f 5f64 6972 5f5f 2829 0d0a 2020  f).__dir__()..  
-0001bca0: 2020 2020 2020 6b65 7973 203d 205b 6b65        keys = [ke
-0001bcb0: 7920 666f 7220 6b65 7920 696e 206b 6579  y for key in key
-0001bcc0: 7320 6966 206e 6f74 206b 6579 2e69 7364  s if not key.isd
-0001bcd0: 6967 6974 2829 5d0d 0a20 2020 2020 2020  igit()]..       
-0001bce0: 2072 6574 7572 6e20 6b65 7973 0d0a 0d0a   return keys....
-0001bcf0: 2020 2020 6465 6620 6164 645f 6d6f 6475      def add_modu
-0001bd00: 6c65 2873 656c 662c 206e 616d 652c 206d  le(self, name, m
-0001bd10: 6f64 756c 6529 3a0d 0a20 2020 2020 2020  odule):..       
-0001bd20: 2022 2222 4164 6473 2061 2063 6869 6c64   """Adds a child
-0001bd30: 206d 6f64 756c 6520 746f 2074 6865 2063   module to the c
-0001bd40: 7572 7265 6e74 206d 6f64 756c 652e 0d0a  urrent module...
-0001bd50: 0d0a 2020 2020 2020 2020 5468 6520 6d6f  ..        The mo
-0001bd60: 6475 6c65 2063 616e 2062 6520 6163 6365  dule can be acce
-0001bd70: 7373 6564 2061 7320 616e 2061 7474 7269  ssed as an attri
-0001bd80: 6275 7465 2075 7369 6e67 2074 6865 2067  bute using the g
-0001bd90: 6976 656e 206e 616d 652e 0d0a 2020 2020  iven name...    
-0001bda0: 2020 2020 3129 2061 6464 206d 6f64 756c      1) add modul
-0001bdb0: 6520 6173 2063 6869 6c64 0d0a 0d0a 2020  e as child....  
-0001bdc0: 2020 2020 2020 3229 2067 656e 6572 6174        2) generat
-0001bdd0: 6520 6465 6661 756c 745f 6e61 6d65 2061  e default_name a
-0001bde0: 6e64 2072 656c 6174 6976 655f 6e61 6d65  nd relative_name
-0001bdf0: 0d0a 0d0a 2020 2020 2020 2020 3329 2075  ....        3) u
-0001be00: 7064 6174 6520 7468 6520 6e6f 6465 730d  pdate the nodes.
-0001be10: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-0001be20: 0d0a 2020 2020 2020 2020 2020 2020 6e61  ..            na
-0001be30: 6d65 2028 7374 7269 6e67 293a 206e 616d  me (string): nam
-0001be40: 6520 6f66 2074 6865 2063 6869 6c64 206d  e of the child m
-0001be50: 6f64 756c 652e 2054 6865 2063 6869 6c64  odule. The child
-0001be60: 206d 6f64 756c 6520 6361 6e20 6265 0d0a   module can be..
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 6163 6365 7373 6564 2066 726f 6d20 7468  accessed from th
-0001be90: 6973 206d 6f64 756c 6520 7573 696e 6720  is module using 
-0001bea0: 7468 6520 6769 7665 6e20 6e61 6d65 0d0a  the given name..
-0001beb0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-0001bec0: 6c65 2028 4d6f 6475 6c65 293a 2063 6869  le (Module): chi
-0001bed0: 6c64 206d 6f64 756c 6520 746f 2062 6520  ld module to be 
-0001bee0: 6164 6465 6420 746f 2074 6865 206d 6f64  added to the mod
-0001bef0: 756c 652e 0d0a 0d0a 2020 2020 2020 2020  ule.....        
-0001bf00: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-0001bf10: 6e6f 7420 6973 696e 7374 616e 6365 286d  not isinstance(m
-0001bf20: 6f64 756c 652c 2028 6e6e 2e4d 6f64 756c  odule, (nn.Modul
-0001bf30: 652c 204c 6179 6572 2929 2061 6e64 206d  e, Layer)) and m
-0001bf40: 6f64 756c 6520 6973 206e 6f74 204e 6f6e  odule is not Non
-0001bf50: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001bf60: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0001bf70: 227b 7d20 6973 206e 6f74 2061 204d 6f64  "{} is not a Mod
-0001bf80: 756c 6520 7375 6263 6c61 7373 222e 666f  ule subclass".fo
-0001bf90: 726d 6174 280d 0a20 2020 2020 2020 2020  rmat(..         
-0001bfa0: 2020 2020 2020 2074 6f72 6368 2e74 7970         torch.typ
-0001bfb0: 656e 616d 6528 6d6f 6475 6c65 2929 290d  ename(module))).
-0001bfc0: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
-0001bfd0: 7420 6973 696e 7374 616e 6365 286e 616d  t isinstance(nam
-0001bfe0: 652c 2074 6f72 6368 2e5f 7369 782e 7374  e, torch._six.st
-0001bff0: 7269 6e67 5f63 6c61 7373 6573 293a 0d0a  ring_classes):..
-0001c000: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001c010: 6520 5479 7065 4572 726f 7228 226d 6f64  e TypeError("mod
-0001c020: 756c 6520 6e61 6d65 2073 686f 756c 6420  ule name should 
-0001c030: 6265 2061 2073 7472 696e 672e 2047 6f74  be a string. Got
-0001c040: 207b 7d22 2e66 6f72 6d61 7428 746f 7263   {}".format(torc
-0001c050: 682e 7479 7065 6e61 6d65 286e 616d 6529  h.typename(name)
-0001c060: 2929 0d0a 2020 2020 2020 2020 656c 6966  ))..        elif
-0001c070: 2068 6173 6174 7472 2873 656c 662c 206e   hasattr(self, n
-0001c080: 616d 6529 2061 6e64 206e 616d 6520 6e6f  ame) and name no
-0001c090: 7420 696e 2073 656c 662e 5f6d 6f64 756c  t in self._modul
-0001c0a0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-0001c0b0: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
-0001c0c0: 2261 7474 7269 6275 7465 2027 7b7d 2720  "attribute '{}' 
-0001c0d0: 616c 7265 6164 7920 6578 6973 7473 222e  already exists".
-0001c0e0: 666f 726d 6174 286e 616d 6529 290d 0a20  format(name)).. 
-0001c0f0: 2020 2020 2020 2065 6c69 6620 272e 2720         elif '.' 
-0001c100: 696e 206e 616d 653a 0d0a 2020 2020 2020  in name:..      
-0001c110: 2020 2020 2020 2320 6e61 6d65 3d6e 616d        # name=nam
-0001c120: 652e 7265 706c 6163 6528 272e 272c 275f  e.replace('.','_
-0001c130: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0001c140: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
-0001c150: 6d6f 6475 6c65 206e 616d 6520 6361 6e27  module name can'
-0001c160: 7420 636f 6e74 6169 6e20 5c22 2e5c 2222  t contain \".\""
-0001c170: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0001c180: 6e61 6d65 203d 3d20 2727 3a0d 0a20 2020  name == '':..   
-0001c190: 2020 2020 2020 2020 2072 6169 7365 204b           raise K
-0001c1a0: 6579 4572 726f 7228 226d 6f64 756c 6520  eyError("module 
-0001c1b0: 6e61 6d65 2063 616e 2774 2062 6520 656d  name can't be em
-0001c1c0: 7074 7920 7374 7269 6e67 205c 225c 2222  pty string \"\""
-0001c1d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001c1e0: 5f6d 6f64 756c 6573 5b6e 616d 655d 203d  _modules[name] =
-0001c1f0: 206d 6f64 756c 650d 0a0d 0a20 2020 2064   module....    d
-0001c200: 6566 2062 7569 6c64 2873 656c 662c 202a  ef build(self, *
-0001c210: 696e 7075 745f 7368 6170 653a 2054 656e  input_shape: Ten
-0001c220: 736f 7253 6861 7065 293a 0d0a 2020 2020  sorShape):..    
-0001c230: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0001c240: 5f62 7569 6c74 3a0d 0a20 2020 2020 2020  _built:..       
-0001c250: 2020 2020 2023 2053 6967 6e61 7475 7265       # Signature
-0001c260: 286e 616d 653d 7365 6c66 2e6e 616d 6529  (name=self.name)
-0001c270: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0001c280: 7220 7368 702c 206d 6f64 756c 6520 696e  r shp, module in
-0001c290: 207a 6970 2869 6e70 7574 5f73 6861 7065   zip(input_shape
-0001c2a0: 2c20 7365 6c66 2e5f 6d6f 6475 6c65 732e  , self._modules.
-0001c2b0: 7661 6c75 6573 2829 293a 0d0a 2020 2020  values()):..    
-0001c2c0: 2020 2020 2020 2020 2020 2020 2320 7368              # sh
-0001c2d0: 7020 3d20 7465 6e73 6f72 5f74 6f5f 7368  p = tensor_to_sh
-0001c2e0: 6170 6528 696e 702c 206e 6565 645f 6578  ape(inp, need_ex
-0001c2f0: 636c 7564 655f 6261 7463 685f 6178 6973  clude_batch_axis
-0001c300: 3d54 7275 652c 2069 735f 7369 6e67 6c65  =True, is_single
-0001c310: 746f 6e3d 4661 6c73 6529 0d0a 2020 2020  ton=False)..    
-0001c320: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-0001c330: 6c65 2e62 7569 6c64 2873 6870 290d 0a20  le.build(shp).. 
-0001c340: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001c350: 5f62 7569 6c74 203d 2054 7275 650d 0a0d  _built = True...
-0001c360: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-0001c370: 2020 2020 6465 6620 7369 676e 6174 7572      def signatur
-0001c380: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-0001c390: 2020 2222 220d 0a0d 0a20 2020 2020 2020    """....       
-0001c3a0: 2052 6574 7572 6e73 3a0d 0a0d 0a20 2020   Returns:....   
-0001c3b0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0001c3c0: 2020 6966 2073 656c 662e 5f73 6967 6e61    if self._signa
-0001c3d0: 7475 7265 2069 7320 4e6f 6e65 3a0d 0a20  ture is None:.. 
-0001c3e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001c3f0: 5f73 6967 6e61 7475 7265 203d 2053 6967  _signature = Sig
-0001c400: 6e61 7475 7265 286e 616d 653d 7365 6c66  nature(name=self
-0001c410: 2e6e 616d 6529 0d0a 2020 2020 2020 2020  .name)..        
-0001c420: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-0001c430: 2e5f 6d6f 6475 6c65 732e 6974 656d 7328  ._modules.items(
-0001c440: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001c450: 666f 7220 696e 705f 6b2c 2069 6e70 5f76  for inp_k, inp_v
-0001c460: 2069 6e20 762e 7369 676e 6174 7572 652e   in v.signature.
-0001c470: 696e 7075 7473 2e69 7465 6d73 2829 3a0d  inputs.items():.
-0001c480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c490: 2069 6620 277b 307d 5f7b 317d 272e 666f   if '{0}_{1}'.fo
-0001c4a0: 726d 6174 2869 6e70 5f6b 2c20 6b29 206e  rmat(inp_k, k) n
-0001c4b0: 6f74 2069 6e20 7365 6c66 2e5f 7369 676e  ot in self._sign
-0001c4c0: 6174 7572 652e 696e 7075 7473 3a0d 0a20  ature.inputs:.. 
-0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4e0: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
-0001c4f0: 7265 2e69 6e70 7574 735b 277b 307d 5f7b  re.inputs['{0}_{
-0001c500: 317d 272e 666f 726d 6174 2869 6e70 5f6b  1}'.format(inp_k
-0001c510: 2c20 6b29 5d20 3d20 696e 705f 760d 0a20  , k)] = inp_v.. 
-0001c520: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
-0001c530: 7574 5f6b 2c20 6f75 745f 7620 696e 2076  ut_k, out_v in v
-0001c540: 2e73 6967 6e61 7475 7265 2e6f 7574 7075  .signature.outpu
-0001c550: 7473 2e69 7465 6d73 2829 3a0d 0a20 2020  ts.items():..   
-0001c560: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001c570: 277b 307d 5f7b 317d 272e 666f 726d 6174  '{0}_{1}'.format
-0001c580: 286f 7574 5f6b 2c20 6b29 206e 6f74 2069  (out_k, k) not i
-0001c590: 6e20 7365 6c66 2e5f 7369 676e 6174 7572  n self._signatur
-0001c5a0: 652e 6f75 7470 7574 733a 0d0a 2020 2020  e.outputs:..    
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5c0: 7365 6c66 2e5f 7369 676e 6174 7572 652e  self._signature.
-0001c5d0: 6f75 7470 7574 735b 277b 307d 5f7b 317d  outputs['{0}_{1}
-0001c5e0: 272e 666f 726d 6174 286f 7574 5f6b 2c20  '.format(out_k, 
-0001c5f0: 6b29 5d20 3d20 6f75 745f 760d 0a20 2020  k)] = out_v..   
-0001c600: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001c610: 2e5f 7369 676e 6174 7572 650d 0a0d 0a20  ._signature.... 
-0001c620: 2020 2040 7369 676e 6174 7572 652e 7365     @signature.se
-0001c630: 7474 6572 0d0a 2020 2020 6465 6620 7369  tter..    def si
-0001c640: 676e 6174 7572 6528 7365 6c66 2c20 7661  gnature(self, va
-0001c650: 6c75 6529 3a0d 0a20 2020 2020 2020 2073  lue):..        s
-0001c660: 656c 662e 5f73 6967 6e61 7475 7265 203d  elf._signature =
-0001c670: 2076 616c 7565 0d0a 0d0a 2020 2020 6465   value....    de
-0001c680: 6620 636f 6d62 696e 655f 666f 7277 6172  f combine_forwar
-0001c690: 6428 7365 6c66 2c20 7829 3a0d 0a20 2020  d(self, x):..   
-0001c6a0: 2020 2020 206f 7574 7075 7473 203d 205b       outputs = [
-0001c6b0: 5d0d 0a20 2020 2020 2020 2066 6f72 2069  ]..        for i
-0001c6c0: 6e70 2c20 6d6f 6475 6c65 2069 6e20 7a69  np, module in zi
-0001c6d0: 7028 782c 206c 6973 7428 7365 6c66 2e5f  p(x, list(self._
-0001c6e0: 6d6f 6475 6c65 732e 7661 6c75 6573 2829  modules.values()
-0001c6f0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-0001c700: 206f 7574 7075 7473 2e61 7070 656e 6428   outputs.append(
-0001c710: 6d6f 6475 6c65 2869 6e70 2929 0d0a 2020  module(inp))..  
-0001c720: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
-0001c730: 6c65 286f 7574 7075 7473 290d 0a0d 0a20  le(outputs).... 
-0001c740: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
-0001c750: 656c 662c 202a 7829 3a0d 0a20 2020 2020  elf, *x):..     
-0001c760: 2020 2069 6620 6c65 6e28 7829 203d 3d20     if len(x) == 
-0001c770: 6c65 6e28 7365 6c66 2e5f 6d6f 6475 6c65  len(self._module
-0001c780: 732e 7661 6c75 6573 2829 293a 0d0a 2020  s.values()):..  
-0001c790: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0001c7a0: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
-0001c7b0: 2020 2020 666f 7220 696e 702c 206d 6f64      for inp, mod
-0001c7c0: 756c 6520 696e 207a 6970 2878 2c20 6c69  ule in zip(x, li
-0001c7d0: 7374 2873 656c 662e 5f6d 6f64 756c 6573  st(self._modules
-0001c7e0: 2e76 616c 7565 7328 2929 293a 0d0a 2020  .values())):..  
-0001c7f0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-0001c800: 7470 7574 732e 6170 7065 6e64 286d 6f64  tputs.append(mod
-0001c810: 756c 6528 696e 7029 290d 0a20 2020 2020  ule(inp))..     
-0001c820: 2020 2020 2020 2072 6574 7572 6e20 7475         return tu
-0001c830: 706c 6528 6f75 7470 7574 7329 0d0a 2020  ple(outputs)..  
-0001c840: 2020 2020 2020 656c 6966 206c 656e 2878        elif len(x
-0001c850: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
-0001c860: 2020 2020 206f 7574 7075 7473 203d 205b       outputs = [
-0001c870: 5d0d 0a20 2020 2020 2020 2020 2020 2066  ]..            f
-0001c880: 6f72 206d 6f64 756c 6520 696e 2073 656c  or module in sel
-0001c890: 662e 5f6d 6f64 756c 6573 2e76 616c 7565  f._modules.value
-0001c8a0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-0001c8b0: 2020 2020 2020 6f75 7470 7574 732e 6170        outputs.ap
-0001c8c0: 7065 6e64 286d 6f64 756c 6528 7829 290d  pend(module(x)).
-0001c8d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001c8e0: 7572 6e20 7475 706c 6528 6f75 7470 7574  urn tuple(output
-0001c8f0: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
-0001c900: 726e 204e 6f6e 650d 0a0d 0a0d 0a0d 0a69  rn None........i
-0001c910: 6d70 6f72 7420 746f 7263 680d 0a0d 0a0d  mport torch.....
-0001c920: 0a64 6566 205f 6578 7472 6163 745f 696e  .def _extract_in
-0001c930: 7465 7276 616c 7328 6f66 6673 6574 732c  tervals(offsets,
-0001c940: 2073 697a 6573 2c20 6461 7461 293a 0d0a   sizes, data):..
-0001c950: 2020 2020 2222 2253 656c 6563 7420 636f      """Select co
-0001c960: 6e74 6967 756f 7573 2069 6e74 6572 7661  ntiguous interva
-0001c970: 6c73 206f 6620 726f 7773 2c20 6769 7665  ls of rows, give
-0001c980: 6e20 7468 6569 7220 6f66 6673 6574 7320  n their offsets 
-0001c990: 616e 6420 7369 7a65 732e 0d0a 2020 2020  and sizes...    
-0001c9a0: 452e 672e 2073 7570 706f 7365 206f 6666  E.g. suppose off
-0001c9b0: 7365 7473 203d 205b 3335 2c20 3730 2c20  sets = [35, 70, 
-0001c9c0: 3930 5d2c 2073 697a 6573 203d 205b 332c  90], sizes = [3,
-0001c9d0: 2032 2c20 345d 2c20 7468 656e 2074 6869   2, 4], then thi
-0001c9e0: 7320 7769 6c6c 0d0a 2020 2020 7265 7475  s will..    retu
-0001c9f0: 726e 0d0a 0d0a 2020 2020 2020 2020 2020  rn....          
-0001ca00: 2020 2874 6f72 6368 2e4c 6f6e 6754 656e    (torch.LongTen
-0001ca10: 736f 7228 302c 2033 2c20 3529 2c0d 0a20  sor(0, 3, 5),.. 
-0001ca20: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-0001ca30: 746f 7263 682e 4c6f 6e67 5465 6e73 6f72  torch.LongTensor
-0001ca40: 285b 3335 2c20 3336 2c20 3337 2c20 3730  ([35, 36, 37, 70
-0001ca50: 2c20 3731 2c20 3930 2c20 3931 2c20 3932  , 71, 90, 91, 92
-0001ca60: 2c20 3933 5d29 5d29 0d0a 0d0a 2020 2020  , 93])])....    
-0001ca70: 2222 220d 0a20 2020 206f 6666 7365 7473  """..    offsets
-0001ca80: 203d 206f 6666 7365 7473 2e6c 6f6e 6728   = offsets.long(
-0001ca90: 290d 0a20 2020 2073 697a 6573 203d 2073  )..    sizes = s
-0001caa0: 697a 6573 2e6c 6f6e 6728 290d 0a20 2020  izes.long()..   
-0001cab0: 2072 6573 5f72 6f77 7320 3d20 7369 7a65   res_rows = size
-0001cac0: 732e 7375 6d28 292e 6974 656d 2829 0d0a  s.sum().item()..
-0001cad0: 2020 2020 6173 7365 7274 206f 6666 7365      assert offse
-0001cae0: 7473 2e73 697a 6528 3029 203d 3d20 7369  ts.size(0) == si
-0001caf0: 7a65 732e 7369 7a65 2830 290d 0a0d 0a20  zes.size(0).... 
-0001cb00: 2020 206e 6f6e 5f7a 6572 6f5f 7369 7a65     non_zero_size
-0001cb10: 203d 2073 697a 6573 2021 3d20 300d 0a20   = sizes != 0.. 
-0001cb20: 2020 2069 6620 6e6f 6e5f 7a65 726f 5f73     if non_zero_s
-0001cb30: 697a 652e 6c6f 6e67 2829 2e73 756d 2829  ize.long().sum()
-0001cb40: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
-0001cb50: 7265 7475 726e 2074 6f72 6368 2e7a 6572  return torch.zer
-0001cb60: 6f73 286f 6666 7365 7473 2e73 697a 6528  os(offsets.size(
-0001cb70: 3029 202b 2031 292e 6c6f 6e67 2829 2c20  0) + 1).long(), 
-0001cb80: 6461 7461 2e6e 6577 2829 0d0a 0d0a 2020  data.new()....  
-0001cb90: 2020 6e65 775f 6f66 6673 6574 7320 3d20    new_offsets = 
-0001cba0: 746f 7263 682e 6361 7428 5b74 6f72 6368  torch.cat([torch
-0001cbb0: 2e4c 6f6e 6754 656e 736f 7228 5b30 5d29  .LongTensor([0])
-0001cbc0: 2c20 7369 7a65 732e 6375 6d73 756d 2830  , sizes.cumsum(0
-0001cbd0: 295d 290d 0a20 2020 2073 697a 6573 5f6e  )])..    sizes_n
-0001cbe0: 7a20 3d20 7369 7a65 735b 6e6f 6e5f 7a65  z = sizes[non_ze
-0001cbf0: 726f 5f73 697a 655d 0d0a 2020 2020 6f66  ro_size]..    of
-0001cc00: 6673 6574 735f 6e7a 203d 206f 6666 7365  fsets_nz = offse
-0001cc10: 7473 5b6e 6f6e 5f7a 6572 6f5f 7369 7a65  ts[non_zero_size
-0001cc20: 5d0d 0a0d 0a20 2020 2072 6573 5f64 656c  ]....    res_del
-0001cc30: 7461 203d 2074 6f72 6368 2e4c 6f6e 6754  ta = torch.LongT
-0001cc40: 656e 736f 7228 7265 735f 726f 7773 292e  ensor(res_rows).
-0001cc50: 6669 6c6c 5f28 3129 0d0a 2020 2020 7265  fill_(1)..    re
-0001cc60: 735f 6465 6c74 615b 305d 203d 206f 6666  s_delta[0] = off
-0001cc70: 7365 7473 5f6e 7a5b 305d 0d0a 0d0a 2020  sets_nz[0]....  
-0001cc80: 2020 6966 206f 6666 7365 7473 5f6e 7a2e    if offsets_nz.
-0001cc90: 7369 7a65 2830 2920 3e20 313a 0d0a 2020  size(0) > 1:..  
-0001cca0: 2020 2020 2020 696e 7075 745f 6465 6c74        input_delt
-0001ccb0: 6120 3d20 6f66 6673 6574 735f 6e7a 5b31  a = offsets_nz[1
-0001ccc0: 3a5d 202d 206f 6666 7365 7473 5f6e 7a5b  :] - offsets_nz[
-0001ccd0: 3a2d 315d 202d 2073 697a 6573 5f6e 7a5b  :-1] - sizes_nz[
-0001cce0: 3a2d 315d 2020 2320 5b33 322c 2031 385d  :-1]  # [32, 18]
-0001ccf0: 0d0a 2020 2020 2020 2020 7265 735f 726f  ..        res_ro
-0001cd00: 775f 6f66 6673 6574 7320 3d20 7369 7a65  w_offsets = size
-0001cd10: 735f 6e7a 2e63 756d 7375 6d28 3029 5b3a  s_nz.cumsum(0)[:
-0001cd20: 2d31 5d20 2023 205b 332c 2035 5d0d 0a20  -1]  # [3, 5].. 
-0001cd30: 2020 2020 2020 2072 6573 5f64 656c 7461         res_delta
-0001cd40: 5b72 6573 5f72 6f77 5f6f 6666 7365 7473  [res_row_offsets
-0001cd50: 5d20 2b3d 2069 6e70 7574 5f64 656c 7461  ] += input_delta
-0001cd60: 2020 2320 5b33 352c 2031 2c20 312c 2033    # [35, 1, 1, 3
-0001cd70: 332c 2031 2c20 3139 2c20 312c 2031 2c20  3, 1, 19, 1, 1, 
-0001cd80: 315d 0d0a 0d0a 2020 2020 7265 735f 6f66  1]....    res_of
-0001cd90: 6673 6574 7320 3d20 7265 735f 6465 6c74  fsets = res_delt
-0001cda0: 612e 6375 6d73 756d 2830 2920 2023 205b  a.cumsum(0)  # [
-0001cdb0: 3335 2c20 3336 2c20 3337 2c20 3730 2c20  35, 36, 37, 70, 
-0001cdc0: 3731 2c20 3930 2c20 3931 2c20 3932 2c20  71, 90, 91, 92, 
-0001cdd0: 3933 5d0d 0a20 2020 2072 6573 203d 2064  93]..    res = d
-0001cde0: 6174 615b 7265 735f 6f66 6673 6574 735d  ata[res_offsets]
-0001cdf0: 0d0a 0d0a 2020 2020 7265 7475 726e 206e  ....    return n
-0001ce00: 6577 5f6f 6666 7365 7473 2c20 7265 730d  ew_offsets, res.
-0001ce10: 0a0d 0a0d 0a63 6c61 7373 2054 656e 736f  .....class Tenso
-0001ce20: 724c 6973 7428 6f62 6a65 6374 293a 0d0a  rList(object):..
-0001ce30: 2020 2020 2222 2241 206c 6973 7420 6f66      """A list of
-0001ce40: 2074 656e 736f 7273 206f 6620 6469 6666   tensors of diff
-0001ce50: 6572 656e 7420 7369 7a65 732c 2062 6163  erent sizes, bac
-0001ce60: 6b65 6420 6279 2061 2028 6f66 6673 6574  ked by a (offset
-0001ce70: 2c20 7369 7a65 2c20 6461 7461 290d 0a20  , size, data).. 
-0001ce80: 2020 2074 7570 6c65 2e0d 0a0d 0a20 2020     tuple.....   
-0001ce90: 2049 6e64 6578 696e 6720 6279 204c 6f6e   Indexing by Lon
-0001cea0: 6754 656e 736f 7220 7265 7475 726e 7320  gTensor returns 
-0001ceb0: 6120 6e65 7720 5465 6e73 6f72 4c69 7374  a new TensorList
-0001cec0: 2077 6974 6820 7468 6520 7365 6c65 6374   with the select
-0001ced0: 6564 206c 6973 740d 0a20 2020 2065 6c65  ed list..    ele
-0001cee0: 6d65 6e74 7320 2873 696d 696c 6172 2074  ments (similar t
-0001cef0: 6f20 696e 6465 7869 6e67 2061 2074 6f72  o indexing a tor
-0001cf00: 6368 2069 6e64 6578 5f73 656c 6563 745f  ch index_select_
-0001cf10: 292e 0d0a 0d0a 2020 2020 496e 6465 7869  ).....    Indexi
-0001cf20: 6e67 2062 7920 616e 2069 6e74 2072 6574  ng by an int ret
-0001cf30: 7572 6e73 2061 2074 6f72 6368 2e54 656e  urns a torch.Ten
-0001cf40: 736f 7220 7769 7468 2074 6861 7420 6c69  sor with that li
-0001cf50: 7374 2065 6c65 6d65 6e74 2e0d 0a20 2020  st element...   
-0001cf60: 2022 2222 0d0a 0d0a 2020 2020 4063 6c61   """....    @cla
-0001cf70: 7373 6d65 7468 6f64 0d0a 2020 2020 6465  ssmethod..    de
-0001cf80: 6620 6361 7428 636c 732c 2065 6c65 6d65  f cat(cls, eleme
-0001cf90: 6e74 7329 3a0d 0a20 2020 2020 2020 206f  nts):..        o
-0001cfa0: 6666 7365 7473 2c20 6461 7461 203d 207a  ffsets, data = z
-0001cfb0: 6970 282a 5b5b 782e 6f66 6673 6574 732c  ip(*[[x.offsets,
-0001cfc0: 2078 2e64 6174 615d 2066 6f72 2078 2069   x.data] for x i
-0001cfd0: 6e20 656c 656d 656e 7473 5d29 0d0a 2020  n elements])..  
-0001cfe0: 2020 2020 2020 6f66 6673 6574 7320 3d20        offsets = 
-0001cff0: 6c69 7374 286f 6666 7365 7473 290d 0a20  list(offsets).. 
-0001d000: 2020 2020 2020 2062 6174 6368 5f6f 6666         batch_off
-0001d010: 7365 7420 3d20 746f 7263 682e 4c6f 6e67  set = torch.Long
-0001d020: 5465 6e73 6f72 285b 6f5b 2d31 5d20 666f  Tensor([o[-1] fo
-0001d030: 7220 6f20 696e 206f 6666 7365 7473 5d29  r o in offsets])
-0001d040: 2e63 756d 7375 6d28 3029 0d0a 2020 2020  .cumsum(0)..    
-0001d050: 2020 2020 666f 7220 6a20 696e 2072 616e      for j in ran
-0001d060: 6765 286c 656e 286f 6666 7365 7473 2920  ge(len(offsets) 
-0001d070: 2d20 3129 3a0d 0a20 2020 2020 2020 2020  - 1):..         
-0001d080: 2020 206f 6666 7365 7473 5b6a 202b 2031     offsets[j + 1
-0001d090: 5d20 3d20 6f66 6673 6574 735b 6a20 2b20  ] = offsets[j + 
-0001d0a0: 315d 5b31 3a5d 202b 2062 6174 6368 5f6f  1][1:] + batch_o
-0001d0b0: 6666 7365 745b 6a5d 0d0a 2020 2020 2020  ffset[j]..      
-0001d0c0: 2020 7265 7475 726e 2063 6c73 2874 6f72    return cls(tor
-0001d0d0: 6368 2e63 6174 286f 6666 7365 7473 292c  ch.cat(offsets),
-0001d0e0: 2074 6f72 6368 2e63 6174 2864 6174 6129   torch.cat(data)
-0001d0f0: 290d 0a0d 0a20 2020 2040 636c 6173 736d  )....    @classm
-0001d100: 6574 686f 640d 0a20 2020 2064 6566 2065  ethod..    def e
-0001d110: 6d70 7479 2863 6c73 2c20 6e75 6d5f 7465  mpty(cls, num_te
-0001d120: 6e73 6f72 733d 3029 3a0d 0a20 2020 2020  nsors=0):..     
-0001d130: 2020 2072 6574 7572 6e20 636c 7328 0d0a     return cls(..
-0001d140: 2020 2020 2020 2020 2020 2020 746f 7263              torc
-0001d150: 682e 7a65 726f 7328 2829 2c20 6474 7970  h.zeros((), dtyp
-0001d160: 653d 746f 7263 682e 6c6f 6e67 292e 6578  e=torch.long).ex
-0001d170: 7061 6e64 2828 6e75 6d5f 7465 6e73 6f72  pand((num_tensor
-0001d180: 7320 2b20 312c 2929 2c0d 0a20 2020 2020  s + 1,)),..     
-0001d190: 2020 2020 2020 2074 6f72 6368 2e65 6d70         torch.emp
-0001d1a0: 7479 2828 302c 292c 2064 7479 7065 3d74  ty((0,), dtype=t
-0001d1b0: 6f72 6368 2e6c 6f6e 6729 2c0d 0a20 2020  orch.long),..   
-0001d1c0: 2020 2020 2029 0d0a 0d0a 2020 2020 6465       )....    de
-0001d1d0: 6620 6e65 7728 7365 6c66 293a 0d0a 2020  f new(self):..  
-0001d1e0: 2020 2020 2020 7265 7475 726e 2074 7970        return typ
-0001d1f0: 6528 7365 6c66 2928 7365 6c66 2e6f 6666  e(self)(self.off
-0001d200: 7365 7473 2e6e 6577 5f7a 6572 6f73 2828  sets.new_zeros((
-0001d210: 312c 2929 2c20 7365 6c66 2e64 6174 612e  1,)), self.data.
-0001d220: 6e65 775f 656d 7074 7928 2830 2c29 2929  new_empty((0,)))
-0001d230: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
-0001d240: 6974 5f5f 2873 656c 662c 206f 6666 7365  it__(self, offse
-0001d250: 7473 2c20 6461 7461 293a 0d0a 2020 2020  ts, data):..    
-0001d260: 2020 2020 2320 736f 6d65 2073 616e 6974      # some sanit
-0001d270: 7920 6368 6563 6b73 0d0a 2020 2020 2020  y checks..      
-0001d280: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-0001d290: 6e63 6528 6f66 6673 6574 732c 2028 746f  nce(offsets, (to
-0001d2a0: 7263 682e 4c6f 6e67 5465 6e73 6f72 2c20  rch.LongTensor, 
-0001d2b0: 746f 7263 682e 6375 6461 2e4c 6f6e 6754  torch.cuda.LongT
-0001d2c0: 656e 736f 7229 290d 0a20 2020 2020 2020  ensor))..       
-0001d2d0: 2061 7373 6572 7420 6f66 6673 6574 732e   assert offsets.
-0001d2e0: 6e64 696d 656e 7369 6f6e 2829 203d 3d20  ndimension() == 
-0001d2f0: 310d 0a20 2020 2020 2020 2061 7373 6572  1..        asser
-0001d300: 7420 6f66 6673 6574 735b 305d 203d 3d20  t offsets[0] == 
-0001d310: 300d 0a20 2020 2020 2020 2061 7373 6572  0..        asser
-0001d320: 7420 6f66 6673 6574 735b 2d31 5d20 3d3d  t offsets[-1] ==
-0001d330: 2028 6461 7461 2e73 697a 6528 3029 2069   (data.size(0) i
-0001d340: 6620 6461 7461 2e6e 6469 6d65 6e73 696f  f data.ndimensio
-0001d350: 6e28 2920 3e20 3020 656c 7365 2030 290d  n() > 0 else 0).
-0001d360: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0001d370: 6f66 6673 6574 7320 3d20 6f66 6673 6574  offsets = offset
-0001d380: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-0001d390: 6461 7461 203d 2064 6174 610d 0a0d 0a20  data = data.... 
-0001d3a0: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
-0001d3b0: 5f5f 2873 656c 662c 2069 6e64 6578 293a  __(self, index):
-0001d3c0: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0001d3d0: 6e73 7461 6e63 6528 696e 6465 782c 2028  nstance(index, (
-0001d3e0: 746f 7263 682e 4c6f 6e67 5465 6e73 6f72  torch.LongTensor
-0001d3f0: 2c20 746f 7263 682e 6375 6461 2e4c 6f6e  , torch.cuda.Lon
-0001d400: 6754 656e 736f 7229 293a 0d0a 2020 2020  gTensor)):..    
-0001d410: 2020 2020 2020 2020 6f66 6673 6574 735f          offsets_
-0001d420: 7375 6220 3d20 7365 6c66 2e6f 6666 7365  sub = self.offse
-0001d430: 7473 5b69 6e64 6578 5d0d 0a20 2020 2020  ts[index]..     
-0001d440: 2020 2020 2020 2073 697a 6573 5f73 7562         sizes_sub
-0001d450: 203d 2073 656c 662e 6f66 6673 6574 735b   = self.offsets[
-0001d460: 696e 6465 7820 2b20 315d 202d 206f 6666  index + 1] - off
-0001d470: 7365 7473 5f73 7562 0d0a 2020 2020 2020  sets_sub..      
-0001d480: 2020 2020 2020 6e65 775f 6f66 6673 6574        new_offset
-0001d490: 732c 206e 6577 5f64 6174 6120 3d20 5f65  s, new_data = _e
-0001d4a0: 7874 7261 6374 5f69 6e74 6572 7661 6c73  xtract_intervals
-0001d4b0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0001d4c0: 2020 206f 6666 7365 7473 5f73 7562 2c20     offsets_sub, 
-0001d4d0: 7369 7a65 735f 7375 622c 2073 656c 662e  sizes_sub, self.
-0001d4e0: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
-0001d4f0: 2020 290d 0a0d 0a20 2020 2020 2020 2020    )....         
-0001d500: 2020 2072 6574 7572 6e20 5465 6e73 6f72     return Tensor
-0001d510: 4c69 7374 286e 6577 5f6f 6666 7365 7473  List(new_offsets
-0001d520: 2c20 6e65 775f 6461 7461 290d 0a20 2020  , new_data)..   
-0001d530: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0001d540: 616e 6365 2869 6e64 6578 2c20 696e 7429  ance(index, int)
-0001d550: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0001d560: 6620 7365 6c66 2e6f 6666 7365 7473 5b69  f self.offsets[i
-0001d570: 6e64 6578 5d20 213d 2073 656c 662e 6f66  ndex] != self.of
-0001d580: 6673 6574 735b 696e 6465 7820 2b20 315d  fsets[index + 1]
-0001d590: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001d5a0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-0001d5b0: 6174 615b 7365 6c66 2e6f 6666 7365 7473  ata[self.offsets
-0001d5c0: 5b69 6e64 6578 5d20 3a20 7365 6c66 2e6f  [index] : self.o
-0001d5d0: 6666 7365 7473 5b69 6e64 6578 202b 2031  ffsets[index + 1
-0001d5e0: 5d5d 0d0a 2020 2020 2020 2020 2020 2020  ]]..            
-0001d5f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0001d600: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001d610: 6c66 2e64 6174 612e 6e65 7728 290d 0a20  lf.data.new().. 
-0001d620: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-0001d630: 7374 616e 6365 2869 6e64 6578 2c20 736c  stance(index, sl
-0001d640: 6963 6529 3a0d 0a20 2020 2020 2020 2020  ice):..         
-0001d650: 2020 2073 7461 7274 2c20 7374 6f70 2c20     start, stop, 
-0001d660: 7374 6570 203d 2069 6e64 6578 2e69 6e64  step = index.ind
-0001d670: 6963 6573 286c 656e 2873 656c 6629 290d  ices(len(self)).
-0001d680: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001d690: 7374 6570 2021 3d20 313a 0d0a 2020 2020  step != 1:..    
-0001d6a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001d6b0: 6520 5661 6c75 6545 7272 6f72 2822 4578  e ValueError("Ex
-0001d6c0: 7065 6374 6564 2073 6c69 6365 2077 6974  pected slice wit
-0001d6d0: 6820 7374 6570 2031 2c20 676f 7420 2564  h step 1, got %d
-0001d6e0: 2220 2520 7374 6570 290d 0a20 2020 2020  " % step)..     
-0001d6f0: 2020 2020 2020 206e 6577 5f6f 6666 7365         new_offse
-0001d700: 7473 203d 2073 656c 662e 6f66 6673 6574  ts = self.offset
-0001d710: 735b 7374 6172 7420 3a20 7374 6f70 202b  s[start : stop +
-0001d720: 2031 5d0d 0a20 2020 2020 2020 2020 2020   1]..           
-0001d730: 206e 6577 5f64 6174 6120 3d20 7365 6c66   new_data = self
-0001d740: 2e64 6174 615b 6e65 775f 6f66 6673 6574  .data[new_offset
-0001d750: 735b 305d 203a 206e 6577 5f6f 6666 7365  s[0] : new_offse
-0001d760: 7473 5b2d 315d 5d0d 0a20 2020 2020 2020  ts[-1]]..       
-0001d770: 2020 2020 206e 6577 5f6f 6666 7365 7473       new_offsets
-0001d780: 203d 206e 6577 5f6f 6666 7365 7473 202d   = new_offsets -
-0001d790: 206e 6577 5f6f 6666 7365 7473 5b30 5d0d   new_offsets[0].
-0001d7a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001d7b0: 7572 6e20 5465 6e73 6f72 4c69 7374 286e  urn TensorList(n
-0001d7c0: 6577 5f6f 6666 7365 7473 2c20 6e65 775f  ew_offsets, new_
-0001d7d0: 6461 7461 290d 0a20 2020 2020 2020 2065  data)..        e
-0001d7e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0001d7f0: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-0001d800: 2822 556e 6b6e 6f77 6e20 696e 6465 7820  ("Unknown index 
-0001d810: 7479 7065 3a20 2573 2220 2520 7479 7065  type: %s" % type
-0001d820: 2869 6e64 6578 2929 0d0a 0d0a 2020 2020  (index))....    
-0001d830: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
-0001d840: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
-0001d850: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001d860: 6e63 6528 6f74 6865 722c 2054 656e 736f  nce(other, Tenso
-0001d870: 724c 6973 7429 3a0d 0a20 2020 2020 2020  rList):..       
-0001d880: 2020 2020 2072 6574 7572 6e20 4e6f 7449       return NotI
-0001d890: 6d70 6c65 6d65 6e74 6564 0d0a 2020 2020  mplemented..    
-0001d8a0: 2020 2020 7265 7475 726e 2074 6f72 6368      return torch
-0001d8b0: 2e65 7175 616c 2873 656c 662e 6f66 6673  .equal(self.offs
-0001d8c0: 6574 732c 206f 7468 6572 2e6f 6666 7365  ets, other.offse
-0001d8d0: 7473 2920 616e 6420 746f 7263 682e 6571  ts) and torch.eq
-0001d8e0: 7561 6c28 0d0a 2020 2020 2020 2020 2020  ual(..          
-0001d8f0: 2020 7365 6c66 2e64 6174 612c 206f 7468    self.data, oth
-0001d900: 6572 2e64 6174 610d 0a20 2020 2020 2020  er.data..       
-0001d910: 2029 0d0a 0d0a 2020 2020 6465 6620 5f5f   )....    def __
-0001d920: 6c65 6e5f 5f28 7365 6c66 293a 0d0a 2020  len__(self):..  
-0001d930: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001d940: 662e 6f66 6673 6574 732e 7369 7a65 2830  f.offsets.size(0
-0001d950: 2920 2d20 310d 0a0d 0a20 2020 2064 6566  ) - 1....    def
-0001d960: 205f 5f69 6164 645f 5f28 7365 6c66 2c20   __iadd__(self, 
-0001d970: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
-0001d980: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-0001d990: 7468 6572 2c20 696e 7429 3a0d 0a20 2020  ther, int):..   
-0001d9a0: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-0001d9b0: 7461 202b 3d20 6f74 6865 720d 0a20 2020  ta += other..   
-0001d9c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001d9d0: 7365 6c66 0d0a 2020 2020 2020 2020 656c  self..        el
-0001d9e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0001d9f0: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-0001da00: 656e 7465 6445 7272 6f72 2829 0d0a 0d0a  entedError()....
-0001da10: 2020 2020 6465 6620 5f5f 6973 7562 5f5f      def __isub__
-0001da20: 2873 656c 662c 206f 7468 6572 293a 0d0a  (self, other):..
-0001da30: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0001da40: 7461 6e63 6528 6f74 6865 722c 2069 6e74  tance(other, int
-0001da50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001da60: 7365 6c66 2e64 6174 6120 2d3d 206f 7468  self.data -= oth
-0001da70: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-0001da80: 7265 7475 726e 2073 656c 660d 0a20 2020  return self..   
-0001da90: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0001daa0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-0001dab0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-0001dac0: 7228 290d 0a0d 0a20 2020 2064 6566 2073  r()....    def s
-0001dad0: 697a 6528 7365 6c66 2c20 6469 6d3d 4e6f  ize(self, dim=No
-0001dae0: 6e65 293a 0d0a 2020 2020 2020 2020 2320  ne):..        # 
-0001daf0: 4649 584d 453a 2074 6869 7320 6973 2061  FIXME: this is a
-0001db00: 2074 6572 7269 626c 6520 4150 490d 0a0d   terrible API...
-0001db10: 0a20 2020 2020 2020 2023 2074 6f20 6861  .        # to ha
-0001db20: 7665 2073 696d 696c 6172 2061 7070 6561  ve similar appea
-0001db30: 7261 6e63 6520 7769 7468 206f 7468 6572  rance with other
-0001db40: 2074 656e 736f 7220 7479 7065 730d 0a20   tensor types.. 
-0001db50: 2020 2020 2020 2061 7373 6572 7420 6469         assert di
-0001db60: 6d20 3d3d 2030 206f 7220 6469 6d20 6973  m == 0 or dim is
-0001db70: 204e 6f6e 652c 2022 5465 6e73 6f72 4c69   None, "TensorLi
-0001db80: 7374 2063 616e 206f 6e6c 7920 6861 7665  st can only have
-0001db90: 2031 2064 696d 656e 7369 6f6e 220d 0a20   1 dimension".. 
-0001dba0: 2020 2020 2020 2069 6620 6469 6d20 6973         if dim is
-0001dbb0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0001dbc0: 2020 2020 7265 7475 726e 2074 6f72 6368      return torch
-0001dbd0: 2e53 697a 6528 5b6c 656e 2873 656c 6629  .Size([len(self)
-0001dbe0: 5d29 0d0a 2020 2020 2020 2020 656c 7365  ])..        else
-0001dbf0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0001dc00: 6574 7572 6e20 6c65 6e28 7365 6c66 290d  eturn len(self).
-0001dc10: 0a0d 0a20 2020 2064 6566 206e 656c 656d  ...    def nelem
-0001dc20: 656e 7428 7365 6c66 293a 0d0a 2020 2020  ent(self):..    
-0001dc30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001dc40: 6461 7461 2e6e 656c 656d 656e 7428 290d  data.nelement().
-0001dc50: 0a0d 0a20 2020 2064 6566 2063 6c6f 6e65  ...    def clone
-0001dc60: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0001dc70: 2072 6574 7572 6e20 7365 6c66 2e5f 5f63   return self.__c
-0001dc80: 6c61 7373 5f5f 2873 656c 662e 6f66 6673  lass__(self.offs
-0001dc90: 6574 732c 2073 656c 662e 6461 7461 2e63  ets, self.data.c
-0001dca0: 6c6f 6e65 2829 290d 0a0d 0a20 2020 2064  lone())....    d
-0001dcb0: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
-0001dcc0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-0001dcd0: 656c 662e 6f66 6673 6574 732e 6e65 6c65  elf.offsets.nele
-0001dce0: 6d65 6e74 2829 203c 2031 3030 206f 7220  ment() < 100 or 
-0001dcf0: 7365 6c66 2e64 6174 612e 6e65 6c65 6d65  self.data.neleme
-0001dd00: 6e74 2829 203c 2031 3030 303a 0d0a 2020  nt() < 1000:..  
-0001dd10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001dd20: 2022 5465 6e73 6f72 4c69 7374 2820 5b25   "TensorList( [%
-0001dd30: 735d 2029 2220 2520 2220 2c20 222e 6a6f  s] )" % " , ".jo
-0001dd40: 696e 280d 0a20 2020 2020 2020 2020 2020  in(..           
-0001dd50: 2020 2020 2073 7472 2873 656c 665b 695d       str(self[i]
-0001dd60: 2e74 6f6c 6973 7428 2929 2066 6f72 2069  .tolist()) for i
-0001dd70: 2069 6e20 7261 6e67 6528 6c65 6e28 7365   in range(len(se
-0001dd80: 6c66 2929 0d0a 2020 2020 2020 2020 2020  lf))..          
-0001dd90: 2020 290d 0a20 2020 2020 2020 2072 6574    )..        ret
-0001dda0: 7572 6e20 2254 656e 736f 724c 6973 747b  urn "TensorList{
-0001ddb0: 6f66 6673 6574 733d 2573 2c20 6461 7461  offsets=%s, data
-0001ddc0: 3d25 737d 2220 2520 2873 656c 662e 6f66  =%s}" % (self.of
-0001ddd0: 6673 6574 732c 2073 656c 662e 6461 7461  fsets, self.data
-0001dde0: 290d 0a0d 0a20 2020 2064 6566 2061 7070  )....    def app
-0001ddf0: 6c79 2873 656c 662c 2046 293a 0d0a 2020  ly(self, F):..  
-0001de00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001de10: 662e 5f5f 636c 6173 735f 5f28 7365 6c66  f.__class__(self
-0001de20: 2e6f 6666 7365 7473 2c20 4628 7365 6c66  .offsets, F(self
-0001de30: 2e64 6174 6129 290d 0a0d 0a20 2020 2064  .data))....    d
-0001de40: 6566 2063 6f6d 6269 6e65 2873 656c 662c  ef combine(self,
-0001de50: 206f 7468 6572 2c20 4629 3a0d 0a20 2020   other, F):..   
-0001de60: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0001de70: 6365 286f 7468 6572 2c20 5465 6e73 6f72  ce(other, Tensor
-0001de80: 4c69 7374 293a 0d0a 2020 2020 2020 2020  List):..        
-0001de90: 2020 2020 6173 7365 7274 2074 6f72 6368      assert torch
-0001dea0: 2e65 7175 616c 2873 656c 662e 6f66 6673  .equal(self.offs
-0001deb0: 6574 732c 206f 7468 6572 2e6f 6666 7365  ets, other.offse
-0001dec0: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
-0001ded0: 2061 7373 6572 7420 7365 6c66 2e64 6174   assert self.dat
-0001dee0: 612e 7368 6170 655b 305d 203d 3d20 6f74  a.shape[0] == ot
-0001def0: 6865 722e 6461 7461 2e73 6861 7065 5b30  her.data.shape[0
-0001df00: 5d0d 0a20 2020 2020 2020 2020 2020 2072  ]..            r
-0001df10: 6573 203d 2073 656c 662e 5f5f 636c 6173  es = self.__clas
-0001df20: 735f 5f28 7365 6c66 2e6f 6666 7365 7473  s__(self.offsets
-0001df30: 2c20 4628 7365 6c66 2e64 6174 612c 206f  , F(self.data, o
-0001df40: 7468 6572 2e64 6174 6129 290d 0a20 2020  ther.data))..   
-0001df50: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0001df60: 2020 2020 2020 2020 7265 7320 3d20 7365          res = se
-0001df70: 6c66 2e5f 5f63 6c61 7373 5f5f 2873 656c  lf.__class__(sel
-0001df80: 662e 6f66 6673 6574 732c 2046 2873 656c  f.offsets, F(sel
-0001df90: 662e 6461 7461 2c20 6f74 6865 7229 290d  f.data, other)).
-0001dfa0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001dfb0: 7265 732e 6461 7461 2e73 6861 7065 5b30  res.data.shape[0
-0001dfc0: 5d20 3d3d 2073 656c 662e 6461 7461 2e73  ] == self.data.s
-0001dfd0: 6861 7065 5b30 5d0d 0a20 2020 2020 2020  hape[0]..       
-0001dfe0: 2072 6574 7572 6e20 7265 730d 0a0d 0a20   return res.... 
-0001dff0: 2020 2064 6566 206c 656e 6774 6873 2873     def lengths(s
-0001e000: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-0001e010: 6574 7572 6e20 7365 6c66 2e6f 6666 7365  eturn self.offse
-0001e020: 7473 5b31 3a5d 202d 2073 656c 662e 6f66  ts[1:] - self.of
-0001e030: 6673 6574 735b 3a2d 315d 0d0a 0d0a 2020  fsets[:-1]....  
-0001e040: 2020 6465 6620 756e 7371 7565 657a 6528    def unsqueeze(
-0001e050: 7365 6c66 2c20 6469 6d29 3a0d 0a20 2020  self, dim):..   
-0001e060: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001e070: 2e61 7070 6c79 286c 616d 6264 6120 783a  .apply(lambda x:
-0001e080: 2078 2e75 6e73 7175 6565 7a65 2864 696d   x.unsqueeze(dim
-0001e090: 2929 0d0a 0d0a 2020 2020 6465 6620 7669  ))....    def vi
-0001e0a0: 6577 2873 656c 662c 202a 6172 6773 293a  ew(self, *args):
-0001e0b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001e0c0: 2073 656c 662e 6170 706c 7928 6c61 6d62   self.apply(lamb
-0001e0d0: 6461 2078 3a20 782e 7669 6577 282a 6172  da x: x.view(*ar
-0001e0e0: 6773 2929 0d0a 0d0a 2020 2020 6465 6620  gs))....    def 
-0001e0f0: 5f5f 6164 645f 5f28 7365 6c66 2c20 6f74  __add__(self, ot
-0001e100: 6865 7229 3a0d 0a20 2020 2020 2020 2072  her):..        r
-0001e110: 6574 7572 6e20 7365 6c66 2e63 6f6d 6269  eturn self.combi
-0001e120: 6e65 286f 7468 6572 2c20 6c61 6d62 6461  ne(other, lambda
-0001e130: 2078 2c20 793a 2078 202b 2079 290d 0a0d   x, y: x + y)...
-0001e140: 0a20 2020 2064 6566 205f 5f73 7562 5f5f  .    def __sub__
-0001e150: 2873 656c 662c 206f 7468 6572 293a 0d0a  (self, other):..
-0001e160: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001e170: 656c 662e 636f 6d62 696e 6528 6f74 6865  elf.combine(othe
-0001e180: 722c 206c 616d 6264 6120 782c 2079 3a20  r, lambda x, y: 
-0001e190: 7820 2d20 7929 0d0a 0d0a 2020 2020 6465  x - y)....    de
-0001e1a0: 6620 5f5f 6d75 6c5f 5f28 7365 6c66 2c20  f __mul__(self, 
-0001e1b0: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
-0001e1c0: 2072 6574 7572 6e20 7365 6c66 2e63 6f6d   return self.com
-0001e1d0: 6269 6e65 286f 7468 6572 2c20 6c61 6d62  bine(other, lamb
-0001e1e0: 6461 2078 2c20 793a 2078 202a 2079 290d  da x, y: x * y).
-0001e1f0: 0a0d 0a20 2020 2064 6566 205f 5f74 7275  ...    def __tru
-0001e200: 6564 6976 5f5f 2873 656c 662c 206f 7468  ediv__(self, oth
-0001e210: 6572 293a 0d0a 2020 2020 2020 2020 7265  er):..        re
-0001e220: 7475 726e 2073 656c 662e 636f 6d62 696e  turn self.combin
-0001e230: 6528 6f74 6865 722c 206c 616d 6264 6120  e(other, lambda 
-0001e240: 782c 2079 3a20 7820 2f20 7929 0d0a 0d0a  x, y: x / y)....
-0001e250: 2020 2020 6465 6620 7375 6d28 7365 6c66      def sum(self
-0001e260: 2c20 6469 6d3d 4e6f 6e65 2c20 6b65 6570  , dim=None, keep
-0001e270: 6469 6d3d 4661 6c73 6529 3a0d 0a20 2020  dim=False):..   
-0001e280: 2020 2020 2069 6620 6469 6d20 6973 204e       if dim is N
-0001e290: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0001e2a0: 2020 7265 7475 726e 2073 656c 662e 6461    return self.da
-0001e2b0: 7461 2e73 756d 2829 0d0a 2020 2020 2020  ta.sum()..      
-0001e2c0: 2020 2320 5765 2772 6520 6f6e 6c79 2067    # We're only g
-0001e2d0: 6f69 6e67 2074 6f20 6167 7265 6520 746f  oing to agree to
-0001e2e0: 2073 756d 2061 6372 6f73 7320 2269 6e6e   sum across "inn
-0001e2f0: 6572 2064 696d 656e 7369 6f6e 7322 0d0a  er dimensions"..
-0001e300: 2020 2020 2020 2020 6966 2064 696d 203c          if dim <
-0001e310: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0001e320: 2064 696d 203d 2073 656c 662e 6461 7461   dim = self.data
-0001e330: 2e6e 6469 6d65 6e73 696f 6e28 2920 2b20  .ndimension() + 
-0001e340: 6469 6d0d 0a20 2020 2020 2020 2061 7373  dim..        ass
-0001e350: 6572 7420 6469 6d20 3e20 302c 2022 4361  ert dim > 0, "Ca
-0001e360: 6e27 7420 7375 6d20 616c 6f6e 6720 7468  n't sum along th
-0001e370: 6520 276c 6973 7427 2064 696d 656e 7369  e 'list' dimensi
-0001e380: 6f6e 220d 0a20 2020 2020 2020 2072 6574  on"..        ret
-0001e390: 7572 6e20 7365 6c66 2e5f 5f63 6c61 7373  urn self.__class
-0001e3a0: 5f5f 2873 656c 662e 6f66 6673 6574 732c  __(self.offsets,
-0001e3b0: 2073 656c 662e 6461 7461 2e73 756d 2864   self.data.sum(d
-0001e3c0: 696d 2c20 6b65 6570 6469 6d3d 6b65 6570  im, keepdim=keep
-0001e3d0: 6469 6d29 290d 0a0d 0a20 2020 2064 6566  dim))....    def
-0001e3e0: 2074 6f28 7365 6c66 2c20 2a61 7267 732c   to(self, *args,
-0001e3f0: 202a 2a6b 7761 7267 7329 202d 3e20 2254   **kwargs) -> "T
-0001e400: 656e 736f 724c 6973 7422 3a0d 0a20 2020  ensorList":..   
-0001e410: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
-0001e420: 2873 656c 6629 280d 0a20 2020 2020 2020  (self)(..       
-0001e430: 2020 2020 2073 656c 662e 6f66 6673 6574       self.offset
-0001e440: 732e 746f 282a 6172 6773 2c20 2a2a 6b77  s.to(*args, **kw
-0001e450: 6172 6773 292c 2073 656c 662e 6461 7461  args), self.data
-0001e460: 2e74 6f28 2a61 7267 732c 202a 2a6b 7761  .to(*args, **kwa
-0001e470: 7267 7329 0d0a 2020 2020 2020 2020 290d  rgs)..        ).
-0001e480: 0a0d 0a0d 0a64 6566 2070 7269 6e74 5f6e  .....def print_n
-0001e490: 6574 776f 726b 286e 6574 2c20 7665 7262  etwork(net, verb
-0001e4a0: 6f73 653d 4661 6c73 6529 3a0d 0a20 2020  ose=False):..   
-0001e4b0: 206e 756d 5f70 6172 616d 7320 3d20 300d   num_params = 0.
-0001e4c0: 0a20 2020 2066 6f72 2069 2c20 7061 7261  .    for i, para
-0001e4d0: 6d20 696e 2065 6e75 6d65 7261 7465 286e  m in enumerate(n
-0001e4e0: 6574 2e70 6172 616d 6574 6572 7328 2929  et.parameters())
-0001e4f0: 3a0d 0a20 2020 2020 2020 206e 756d 5f70  :..        num_p
-0001e500: 6172 616d 7320 2b3d 2070 6172 616d 2e6e  arams += param.n
-0001e510: 756d 656c 2829 0d0a 2020 2020 6966 2076  umel()..    if v
-0001e520: 6572 626f 7365 3a0d 0a20 2020 2020 2020  erbose:..       
-0001e530: 206c 6f67 6769 6e67 2e69 6e66 6f28 6e65   logging.info(ne
-0001e540: 7429 0d0a 2020 2020 6c6f 6767 696e 672e  t)..    logging.
-0001e550: 696e 666f 2827 546f 7461 6c20 6e75 6d62  info('Total numb
-0001e560: 6572 206f 6620 7061 7261 6d65 7465 7273  er of parameters
-0001e570: 3a20 2564 5c6e 2720 2520 6e75 6d5f 7061  : %d\n' % num_pa
-0001e580: 7261 6d73 290d 0a0d 0a0d 0a64 6566 2073  rams)......def s
-0001e590: 756d 6d61 7279 286d 6f64 656c 2c20 696e  ummary(model, in
-0001e5a0: 7075 745f 7370 6563 732c 2062 6174 6368  put_specs, batch
-0001e5b0: 5f73 697a 653d 312c 2069 6e70 7574 733d  _size=1, inputs=
-0001e5c0: 4e6f 6e65 2c20 6465 7669 6365 3d22 6375  None, device="cu
-0001e5d0: 6461 2229 3a0d 0a20 2020 2064 6566 2072  da"):..    def r
-0001e5e0: 6567 6973 7465 725f 686f 6f6b 286d 6f64  egister_hook(mod
-0001e5f0: 756c 6529 3a0d 0a20 2020 2020 2020 2064  ule):..        d
-0001e600: 6566 2068 6f6f 6b28 6d6f 6475 6c65 2c20  ef hook(module, 
-0001e610: 696e 7075 742c 206f 7574 7075 7429 3a0d  input, output):.
-0001e620: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0001e630: 6c61 7373 5f6e 616d 6520 3d6d 6f64 756c  lass_name =modul
-0001e640: 652e 7265 2020 2020 6d6f 6475 6c65 2e6e  e.re    module.n
-0001e650: 616d 6520 2020 2320 7374 7228 6d6f 6475  ame   # str(modu
-0001e660: 6c65 2e5f 5f63 6c61 7373 5f5f 292e 7370  le.__class__).sp
-0001e670: 6c69 7428 222e 2229 5b2d 315d 2e73 706c  lit(".")[-1].spl
-0001e680: 6974 2822 2722 295b 305d 0d0a 2020 2020  it("'")[0]..    
-0001e690: 2020 2020 2020 2020 6d6f 6475 6c65 5f69          module_i
-0001e6a0: 6478 203d 206c 656e 2873 756d 6d61 7279  dx = len(summary
-0001e6b0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0001e6c0: 206d 5f6b 6579 203d 206d 6f64 756c 652e   m_key = module.
-0001e6d0: 7265 6c61 7469 7665 5f6e 616d 6520 6966  relative_name if
-0001e6e0: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
-0001e6f0: 2027 7265 6c61 7469 7665 5f6e 616d 6527   'relative_name'
-0001e700: 2920 656c 7365 206d 6f64 756c 652e 6e61  ) else module.na
-0001e710: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-0001e720: 6966 206d 5f6b 6579 2069 6e20 7375 6d6d  if m_key in summ
-0001e730: 6172 793a 0d0a 2020 2020 2020 2020 2020  ary:..          
-0001e740: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001e750: 6b65 795d 5b22 7669 7369 7473 225d 202b  key]["visits"] +
-0001e760: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0001e770: 2020 2020 2076 6973 6974 203d 2073 756d       visit = sum
-0001e780: 6d61 7279 5b6d 5f6b 6579 5d5b 2276 6973  mary[m_key]["vis
-0001e790: 6974 7322 5d0d 0a20 2020 2020 2020 2020  its"]..         
-0001e7a0: 2020 2020 2020 206d 5f6b 6579 203d 206d         m_key = m
-0001e7b0: 5f6b 6579 202b 2027 5f7b 307d 272e 666f  _key + '_{0}'.fo
-0001e7c0: 726d 6174 2876 6973 6974 290d 0a0d 0a20  rmat(visit).... 
-0001e7d0: 2020 2020 2020 2020 2020 2073 756d 6d61             summa
-0001e7e0: 7279 5b6d 5f6b 6579 5d20 3d20 4f72 6465  ry[m_key] = Orde
-0001e7f0: 7265 6444 6963 7428 290d 0a20 2020 2020  redDict()..     
-0001e800: 2020 2020 2020 2073 756d 6d61 7279 5b6d         summary[m
-0001e810: 5f6b 6579 5d5b 2276 6973 6974 7322 5d20  _key]["visits"] 
-0001e820: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-0001e830: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
-0001e840: 2263 6c61 7373 5f6e 616d 6522 5d20 3d20  "class_name"] = 
-0001e850: 6d6f 6475 6c65 2e5f 5f63 6c61 7373 5f5f  module.__class__
-0001e860: 2e5f 5f6e 616d 655f 5f0d 0a20 2020 2020  .__name__..     
-0001e870: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0001e880: 7228 6d6f 6475 6c65 2c20 276b 6565 705f  r(module, 'keep_
-0001e890: 6f75 7470 7574 2729 3a0d 0a20 2020 2020  output'):..     
-0001e8a0: 2020 2020 2020 2020 2020 2073 756d 6d61             summa
-0001e8b0: 7279 5b6d 5f6b 6579 5d5b 226b 6565 705f  ry[m_key]["keep_
-0001e8c0: 6f75 7470 7574 225d 203d 206d 6f64 756c  output"] = modul
-0001e8d0: 652e 6b65 6570 5f6f 7574 7075 740d 0a20  e.keep_output.. 
-0001e8e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001e8f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e900: 2020 7375 6d6d 6172 795b 6d5f 6b65 795d    summary[m_key]
-0001e910: 5b22 6b65 6570 5f6f 7574 7075 7422 5d20  ["keep_output"] 
-0001e920: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0001e930: 2020 2020 2069 6e70 7574 203d 2069 7465       input = ite
-0001e940: 7261 7469 6f6e 5f74 6f6f 6c73 2e66 6c61  ration_tools.fla
-0001e950: 7474 656e 285b 696e 7075 745d 2c20 6974  tten([input], it
-0001e960: 6572 6162 6c65 5f74 7970 6573 3d28 6c69  erable_types=(li
-0001e970: 7374 2c20 7475 706c 6529 290d 0a20 2020  st, tuple))..   
-0001e980: 2020 2020 2020 2020 2069 6e70 7574 203d           input =
-0001e990: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
-0001e9a0: 6e28 5b69 7465 6d20 666f 7220 6974 656d  n([item for item
-0001e9b0: 2069 6e20 696e 7075 7420 6966 2069 7465   in input if ite
-0001e9c0: 6d20 6973 206e 6f74 204e 6f6e 655d 290d  m is not None]).
-0001e9d0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-0001e9e0: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
-0001e9f0: 7574 2c20 286c 6973 742c 2074 7570 6c65  ut, (list, tuple
-0001ea00: 2929 2061 6e64 206c 656e 2869 6e70 7574  )) and len(input
-0001ea10: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-0001ea20: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
-0001ea30: 6d5f 6b65 795d 5b22 696e 7075 745f 7368  m_key]["input_sh
-0001ea40: 6170 6522 5d20 3d20 6c69 7374 2869 6e74  ape"] = list(int
-0001ea50: 5f73 6861 7065 2869 6e70 7574 5b30 5d29  _shape(input[0])
-0001ea60: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0001ea70: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
-0001ea80: 6e70 7574 2c20 6469 6374 2920 616e 6420  nput, dict) and 
-0001ea90: 6c65 6e28 696e 7075 7429 203e 2030 3a0d  len(input) > 0:.
-0001eaa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eab0: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
-0001eac0: 2269 6e70 7574 5f73 6861 7065 225d 203d  "input_shape"] =
-0001ead0: 206c 6973 7428 696e 745f 7368 6170 6528   list(int_shape(
-0001eae0: 6c69 7374 2869 6e70 7574 2e76 616c 7565  list(input.value
-0001eaf0: 7328 2929 5b30 5d29 290d 0a20 2020 2020  s())[0]))..     
-0001eb00: 2020 2020 2020 2065 6c69 6620 6973 5f74         elif is_t
-0001eb10: 656e 736f 7228 696e 7075 7429 3a0d 0a20  ensor(input):.. 
-0001eb20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001eb30: 756d 6d61 7279 5b6d 5f6b 6579 5d5b 2269  ummary[m_key]["i
-0001eb40: 6e70 7574 5f73 6861 7065 225d 203d 206c  nput_shape"] = l
-0001eb50: 6973 7428 696e 745f 7368 6170 6528 696e  ist(int_shape(in
-0001eb60: 7075 7429 290d 0a20 2020 2020 2020 2020  put))..         
-0001eb70: 2020 2069 6620 2269 6e70 7574 5f73 6861     if "input_sha
-0001eb80: 7065 2220 696e 2073 756d 6d61 7279 5b6d  pe" in summary[m
-0001eb90: 5f6b 6579 5d20 616e 6420 6c65 6e28 7375  _key] and len(su
-0001eba0: 6d6d 6172 795b 6d5f 6b65 795d 5b22 696e  mmary[m_key]["in
-0001ebb0: 7075 745f 7368 6170 6522 5d29 203e 2030  put_shape"]) > 0
-0001ebc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001ebd0: 2020 2073 756d 6d61 7279 5b6d 5f6b 6579     summary[m_key
-0001ebe0: 5d5b 2269 6e70 7574 5f73 6861 7065 225d  ]["input_shape"]
-0001ebf0: 5b30 5d20 3d20 6261 7463 685f 7369 7a65  [0] = batch_size
-0001ec00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ec10: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0001ec20: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-0001ec30: 7574 203d 2069 7465 7261 7469 6f6e 5f74  ut = iteration_t
-0001ec40: 6f6f 6c73 2e66 6c61 7474 656e 285b 6f75  ools.flatten([ou
-0001ec50: 7470 7574 5d2c 2069 7465 7261 626c 655f  tput], iterable_
-0001ec60: 7479 7065 733d 286c 6973 742c 2074 7570  types=(list, tup
-0001ec70: 6c65 2929 0d0a 2020 2020 2020 2020 2020  le))..          
-0001ec80: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0001ec90: 203d 2075 6e70 6163 6b5f 7369 6e67 6c65   = unpack_single
-0001eca0: 746f 6e28 5b69 7465 6d20 666f 7220 6974  ton([item for it
-0001ecb0: 656d 2069 6e20 6f75 7470 7574 2069 6620  em in output if 
-0001ecc0: 6974 656d 2069 7320 6e6f 7420 4e6f 6e65  item is not None
-0001ecd0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0001ece0: 2020 2020 2020 2020 6966 2069 735f 7465          if is_te
-0001ecf0: 6e73 6f72 286f 7574 7075 7429 3a0d 0a20  nsor(output):.. 
-0001ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed10: 2020 2020 2020 2073 756d 6d61 7279 5b6d         summary[m
-0001ed20: 5f6b 6579 5d5b 226f 7574 7075 745f 7368  _key]["output_sh
-0001ed30: 6170 6522 5d20 3d20 5465 6e73 6f72 5368  ape"] = TensorSh
-0001ed40: 6170 6528 5b62 6174 6368 5f73 697a 655d  ape([batch_size]
-0001ed50: 202b 206c 6973 7428 696e 745f 7368 6170   + list(int_shap
-0001ed60: 6528 6f75 7470 7574 2929 5b31 3a5d 290d  e(output))[1:]).
-0001ed70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ed80: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0001ed90: 616e 6365 286f 7574 7075 742c 2028 6c69  ance(output, (li
-0001eda0: 7374 2c20 7475 706c 6529 293a 0d0a 2020  st, tuple)):..  
-0001edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001edc0: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001edd0: 6b65 795d 5b22 6f75 7470 7574 5f73 6861  key]["output_sha
-0001ede0: 7065 225d 203d 205b 5465 6e73 6f72 5368  pe"] = [TensorSh
-0001edf0: 6170 6528 5b62 6174 6368 5f73 697a 655d  ape([batch_size]
-0001ee00: 202b 206c 6973 7428 696e 745f 7368 6170   + list(int_shap
-0001ee10: 6528 7661 6c75 6529 295b 313a 5d29 2066  e(value))[1:]) f
-0001ee20: 6f72 0d0a 2020 2020 2020 2020 2020 2020  or..            
+0001ade0: 2020 2020 2020 2020 2020 2020 223b 2032              "; 2
+0001adf0: 2069 7320 7265 7175 6972 6564 2229 0d0a   is required")..
+0001ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae10: 7365 6c66 5b6d 5b30 5d5d 203d 206d 5b31  self[m[0]] = m[1
+0001ae20: 5d0d 0a0d 0a20 2020 2064 6566 2062 7569  ]....    def bui
+0001ae30: 6c64 2873 656c 662c 2069 6e70 7574 5f73  ld(self, input_s
+0001ae40: 6861 7065 3a20 5465 6e73 6f72 5368 6170  hape: TensorShap
+0001ae50: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+0001ae60: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
+0001ae70: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0001ae80: 6e70 7574 5f73 6861 7065 2028 746f 7263  nput_shape (torc
+0001ae90: 682e 5369 7a65 2c20 7465 6e73 6f72 2c20  h.Size, tensor, 
+0001aea0: 6c69 7374 2869 6e74 292c 2074 7570 6c65  list(int), tuple
+0001aeb0: 2869 6e74 2929 3a20 5468 6520 696e 7075  (int)): The inpu
+0001aec0: 745f 7368 6170 6520 696e 666f 726d 6174  t_shape informat
+0001aed0: 696f 6e2c 206e 6f74 2069 6e63 6c75 6469  ion, not includi
+0001aee0: 6e67 2062 6174 6368 2061 7869 732e 0d0a  ng batch axis...
+0001aef0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0001af00: 733a 0d0a 0d0a 2020 2020 2020 2020 2222  s:....        ""
+0001af10: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+0001af20: 6c66 2e5f 6275 696c 7420 3d3d 2046 616c  lf._built == Fal
+0001af30: 7365 2061 6e64 206c 656e 2873 656c 662e  se and len(self.
+0001af40: 5f6d 6f64 756c 6573 2920 3e20 303a 0d0a  _modules) > 0:..
+0001af50: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001af60: 656c 662e 6973 5f72 6f6f 743a 0d0a 2020  elf.is_root:..  
+0001af70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001af80: 6c66 2e5f 696e 7075 745f 7368 6170 6520  lf._input_shape 
+0001af90: 3d20 696e 7075 745f 7368 6170 650d 0a0d  = input_shape...
+0001afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001afb0: 2064 756d 6d61 795f 696e 7075 7420 3d20   dummay_input = 
+0001afc0: 746f 5f74 656e 736f 7228 7365 6c66 2e69  to_tensor(self.i
+0001afd0: 6e70 7574 5f73 6861 7065 2e67 6574 5f64  nput_shape.get_d
+0001afe0: 756d 6d79 5f74 656e 736f 7228 2929 2e74  ummy_tensor()).t
+0001aff0: 6f28 7365 6c66 2e64 6576 6963 6529 0d0a  o(self.device)..
+0001b000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b010: 2020 666f 7220 6e61 6d65 2c20 6d6f 6475    for name, modu
+0001b020: 6c65 2069 6e20 7365 6c66 2e69 7465 6d73  le in self.items
+0001b030: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0001b040: 2020 2020 2020 2020 206f 7574 203d 206d           out = m
+0001b050: 6f64 756c 6528 6475 6d6d 6179 5f69 6e70  odule(dummay_inp
+0001b060: 7574 290d 0a20 2020 2020 2020 2020 2020  ut)..           
+0001b070: 2020 2020 2020 2020 206d 6f64 756c 652e           module.
+0001b080: 696e 7075 745f 7368 6170 6520 3d20 696e  input_shape = in
+0001b090: 7075 745f 7368 6170 650d 0a20 2020 2020  put_shape..     
+0001b0a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001b0b0: 6f64 756c 652e 6f75 7470 7574 5f73 6861  odule.output_sha
+0001b0c0: 7065 203d 2074 656e 736f 725f 746f 5f73  pe = tensor_to_s
+0001b0d0: 6861 7065 286f 7574 290d 0a20 2020 2020  hape(out)..     
+0001b0e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001b0f0: 5f62 7569 6c74 203d 2054 7275 650d 0a0d  _built = True...
+0001b100: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
+0001b110: 2873 656c 662c 2078 2c20 2a2a 6b77 6172  (self, x, **kwar
+0001b120: 6773 293a 0d0a 2020 2020 2020 2020 6966  gs):..        if
+0001b130: 2073 656c 662e 6973 5f6d 756c 7469 6361   self.is_multica
+0001b140: 7374 696e 673a 0d0a 2020 2020 2020 2020  sting:..        
+0001b150: 2020 2020 2320 7820 3d20 656e 666f 7263      # x = enforc
+0001b160: 655f 7369 6e67 6c65 746f 6e28 7829 0d0a  e_singleton(x)..
+0001b170: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0001b180: 6c74 7320 3d20 4f72 6465 7265 6444 6963  lts = OrderedDic
+0001b190: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
+0001b1a0: 2066 6f72 206e 616d 652c 206d 6f64 756c   for name, modul
+0001b1b0: 6520 696e 2073 656c 662e 6974 656d 7328  e in self.items(
+0001b1c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001b1d0: 2020 2020 6f75 7420 3d20 6d6f 6475 6c65      out = module
+0001b1e0: 2878 2c20 2a2a 6b77 6172 6773 290d 0a20  (x, **kwargs).. 
+0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001b200: 6573 756c 7473 5b6e 616d 655d 203d 206f  esults[name] = o
+0001b210: 7574 0d0a 2020 2020 2020 2020 2020 2020  ut..            
+0001b220: 7265 7475 726e 2072 6573 756c 7473 0d0a  return results..
+0001b230: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001b240: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001b250: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+0001b260: 7272 6f72 2829 0d0a 0d0a 0d0a 636c 6173  rror()......clas
+0001b270: 7320 436f 6d62 696e 6528 4c61 7965 7229  s Combine(Layer)
+0001b280: 3a0d 0a20 2020 2022 2222 4120 7365 7175  :..    """A sequ
+0001b290: 656e 7469 616c 2063 6f6e 7461 696e 6572  ential container
+0001b2a0: 2e0d 0a20 2020 204d 6f64 756c 6573 2077  ...    Modules w
+0001b2b0: 696c 6c20 6265 2061 6464 6564 2074 6f20  ill be added to 
+0001b2c0: 6974 2069 6e20 7468 6520 6f72 6465 7220  it in the order 
+0001b2d0: 7468 6579 2061 7265 2070 6173 7365 6420  they are passed 
+0001b2e0: 696e 2074 6865 2063 6f6e 7374 7275 6374  in the construct
+0001b2f0: 6f72 2e0d 0a20 2020 2041 6c74 6572 6e61  or...    Alterna
+0001b300: 7469 7665 6c79 2c20 616e 206f 7264 6572  tively, an order
+0001b310: 6564 2064 6963 7420 6f66 206d 6f64 756c  ed dict of modul
+0001b320: 6573 2063 616e 2061 6c73 6f20 6265 2070  es can also be p
+0001b330: 6173 7365 6420 696e 2e0d 0a0d 0a20 2020  assed in.....   
+0001b340: 2054 6f20 6d61 6b65 2069 7420 6561 7369   To make it easi
+0001b350: 6572 2074 6f20 756e 6465 7273 7461 6e64  er to understand
+0001b360: 2c20 6865 7265 2069 7320 6120 736d 616c  , here is a smal
+0001b370: 6c20 6578 616d 706c 653a 3a0d 0a0d 0a20  l example::.... 
+0001b380: 2020 2020 2020 2023 2045 7861 6d70 6c65         # Example
+0001b390: 206f 6620 7573 696e 6720 5365 7175 656e   of using Sequen
+0001b3a0: 7469 616c 0d0a 2020 2020 2020 2020 6d6f  tial..        mo
+0001b3b0: 6465 6c20 3d20 6e6e 2e53 6571 7565 6e74  del = nn.Sequent
+0001b3c0: 6961 6c28 0d0a 2020 2020 2020 2020 2020  ial(..          
+0001b3d0: 2020 2020 2020 2020 6e6e 2e43 6f6e 7632          nn.Conv2
+0001b3e0: 6428 312c 3230 2c35 292c 0d0a 2020 2020  d(1,20,5),..    
+0001b3f0: 2020 2020 2020 2020 2020 2020 2020 6e6e                nn
+0001b400: 2e52 654c 5528 292c 0d0a 2020 2020 2020  .ReLU(),..      
+0001b410: 2020 2020 2020 2020 2020 2020 6e6e 2e43              nn.C
+0001b420: 6f6e 7632 6428 3230 2c36 342c 3529 2c0d  onv2d(20,64,5),.
+0001b430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b440: 2020 206e 6e2e 5265 4c55 2829 0d0a 2020     nn.ReLU()..  
+0001b450: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0001b460: 0a0d 0a20 2020 2020 2020 2023 2045 7861  ...        # Exa
+0001b470: 6d70 6c65 206f 6620 7573 696e 6720 5365  mple of using Se
+0001b480: 7175 656e 7469 616c 2077 6974 6820 4f72  quential with Or
+0001b490: 6465 7265 6444 6963 740d 0a20 2020 2020  deredDict..     
+0001b4a0: 2020 206d 6f64 656c 203d 206e 6e2e 5365     model = nn.Se
+0001b4b0: 7175 656e 7469 616c 284f 7264 6572 6564  quential(Ordered
+0001b4c0: 4469 6374 285b 0d0a 2020 2020 2020 2020  Dict([..        
+0001b4d0: 2020 2020 2020 2020 2020 2827 636f 6e76            ('conv
+0001b4e0: 3127 2c20 6e6e 2e43 6f6e 7632 6428 312c  1', nn.Conv2d(1,
+0001b4f0: 3230 2c35 2929 2c0d 0a20 2020 2020 2020  20,5)),..       
+0001b500: 2020 2020 2020 2020 2020 2028 2772 656c             ('rel
+0001b510: 7531 272c 206e 6e2e 5265 4c55 2829 292c  u1', nn.ReLU()),
+0001b520: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b530: 2020 2020 2827 636f 6e76 3227 2c20 6e6e      ('conv2', nn
+0001b540: 2e43 6f6e 7632 6428 3230 2c36 342c 3529  .Conv2d(20,64,5)
+0001b550: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0001b560: 2020 2020 2020 2827 7265 6c75 3227 2c20        ('relu2', 
+0001b570: 6e6e 2e52 654c 5528 2929 0d0a 2020 2020  nn.ReLU())..    
+0001b580: 2020 2020 2020 2020 2020 2020 5d29 290d              ])).
+0001b590: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+0001b5a0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001b5b0: 662c 202a 6172 6773 2c20 6e61 6d65 3d4e  f, *args, name=N
+0001b5c0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2073  one):..        s
+0001b5d0: 7570 6572 2843 6f6d 6269 6e65 2c20 7365  uper(Combine, se
+0001b5e0: 6c66 292e 5f5f 696e 6974 5f5f 2829 0d0a  lf).__init__()..
+0001b5f0: 2020 2020 2020 2020 7365 6c66 2e75 7569          self.uui
+0001b600: 6420 3d20 7575 6964 2e75 7569 6434 2829  d = uuid.uuid4()
+0001b610: 2e6e 6f64 650d 0a20 2020 2020 2020 2073  .node..        s
+0001b620: 656c 662e 5f6e 616d 6520 3d20 6e61 6d65  elf._name = name
+0001b630: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0001b640: 6275 696c 7420 3d20 4661 6c73 650d 0a0d  built = False...
+0001b650: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0001b660: 6172 6773 2920 3d3d 2031 2061 6e64 2069  args) == 1 and i
+0001b670: 7369 6e73 7461 6e63 6528 6172 6773 5b30  sinstance(args[0
+0001b680: 5d2c 204f 7264 6572 6564 4469 6374 293a  ], OrderedDict):
+0001b690: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0001b6a0: 7220 6b65 792c 206d 6f64 756c 6520 696e  r key, module in
+0001b6b0: 2061 7267 735b 305d 2e69 7465 6d73 2829   args[0].items()
+0001b6c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001b6d0: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
+0001b6e0: 6c65 286b 6579 2c20 6d6f 6475 6c65 290d  le(key, module).
+0001b6f0: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
+0001b700: 6e28 6172 6773 2920 3d3d 2031 2061 6e64  n(args) == 1 and
+0001b710: 2069 7369 6e73 7461 6e63 6528 6172 6773   isinstance(args
+0001b720: 5b30 5d2c 2028 6c69 7374 2c20 6e6e 2e4d  [0], (list, nn.M
+0001b730: 6f64 756c 654c 6973 7429 293a 0d0a 2020  oduleList)):..  
+0001b740: 2020 2020 2020 2020 2020 666f 7220 6964            for id
+0001b750: 782c 206d 6f64 756c 6520 696e 2065 6e75  x, module in enu
+0001b760: 6d65 7261 7465 2861 7267 735b 305d 293a  merate(args[0]):
+0001b770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b780: 2020 7365 6c66 2e61 6464 5f6d 6f64 756c    self.add_modul
+0001b790: 6528 7374 7228 6964 7829 2c20 6d6f 6475  e(str(idx), modu
+0001b7a0: 6c65 290d 0a20 2020 2020 2020 2065 6c73  le)..        els
+0001b7b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0001b7c0: 666f 7220 6964 782c 206d 6f64 756c 6520  for idx, module 
+0001b7d0: 696e 2065 6e75 6d65 7261 7465 2861 7267  in enumerate(arg
+0001b7e0: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+0001b7f0: 2020 2020 2073 656c 662e 6164 645f 6d6f       self.add_mo
+0001b800: 6475 6c65 2873 7472 2869 6478 292c 206d  dule(str(idx), m
+0001b810: 6f64 756c 6529 0d0a 2020 2020 2020 2020  odule)..        
+0001b820: 7365 6c66 2e74 6f28 7365 6c66 2e64 6576  self.to(self.dev
+0001b830: 6963 6529 0d0a 0d0a 2020 2020 6465 6620  ice)....    def 
+0001b840: 5f67 6574 5f69 7465 6d5f 6279 5f69 6478  _get_item_by_idx
+0001b850: 2873 656c 662c 2069 7465 7261 746f 722c  (self, iterator,
+0001b860: 2069 6478 293a 0d0a 2020 2020 2020 2020   idx):..        
+0001b870: 2222 2247 6574 2074 6865 2069 6478 2d74  """Get the idx-t
+0001b880: 6820 6974 656d 206f 6620 7468 6520 6974  h item of the it
+0001b890: 6572 6174 6f22 2222 0d0a 2020 2020 2020  erato"""..      
+0001b8a0: 2020 7369 7a65 203d 206c 656e 2873 656c    size = len(sel
+0001b8b0: 6629 0d0a 2020 2020 2020 2020 6964 7820  f)..        idx 
+0001b8c0: 3d20 6964 782e 5f5f 696e 6465 785f 5f28  = idx.__index__(
+0001b8d0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0001b8e0: 7420 2d73 697a 6520 3c3d 2069 6478 203c  t -size <= idx <
+0001b8f0: 2073 697a 653a 0d0a 2020 2020 2020 2020   size:..        
+0001b900: 2020 2020 7261 6973 6520 496e 6465 7845      raise IndexE
+0001b910: 7272 6f72 2827 696e 6465 7820 7b7d 2069  rror('index {} i
+0001b920: 7320 6f75 7420 6f66 2072 616e 6765 272e  s out of range'.
+0001b930: 666f 726d 6174 2869 6478 2929 0d0a 2020  format(idx))..  
+0001b940: 2020 2020 2020 6964 7820 253d 2073 697a        idx %= siz
+0001b950: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+0001b960: 6e20 6e65 7874 2869 736c 6963 6528 6974  n next(islice(it
+0001b970: 6572 6174 6f72 2c20 6964 782c 204e 6f6e  erator, idx, Non
+0001b980: 6529 290d 0a0d 0a20 2020 2064 6566 205f  e))....    def _
+0001b990: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
+0001b9a0: 2069 6478 293a 0d0a 2020 2020 2020 2020   idx):..        
+0001b9b0: 6966 2069 7369 6e73 7461 6e63 6528 6964  if isinstance(id
+0001b9c0: 782c 2073 6c69 6365 293a 0d0a 2020 2020  x, slice):..    
+0001b9d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001b9e0: 656c 662e 5f5f 636c 6173 735f 5f28 4f72  elf.__class__(Or
+0001b9f0: 6465 7265 6444 6963 7428 6c69 7374 2873  deredDict(list(s
+0001ba00: 656c 662e 5f6d 6f64 756c 6573 2e69 7465  elf._modules.ite
+0001ba10: 6d73 2829 295b 6964 785d 2929 0d0a 2020  ms())[idx]))..  
+0001ba20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0001ba30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ba40: 7365 6c66 2e5f 6765 745f 6974 656d 5f62  self._get_item_b
+0001ba50: 795f 6964 7828 7365 6c66 2e5f 6d6f 6475  y_idx(self._modu
+0001ba60: 6c65 732e 7661 6c75 6573 2829 2c20 6964  les.values(), id
+0001ba70: 7829 0d0a 0d0a 2020 2020 6465 6620 5f5f  x)....    def __
+0001ba80: 7365 7469 7465 6d5f 5f28 7365 6c66 2c20  setitem__(self, 
+0001ba90: 6964 782c 206d 6f64 756c 6529 3a0d 0a20  idx, module):.. 
+0001baa0: 2020 2020 2020 206b 6579 203d 2073 656c         key = sel
+0001bab0: 662e 5f67 6574 5f69 7465 6d5f 6279 5f69  f._get_item_by_i
+0001bac0: 6478 2873 656c 662e 5f6d 6f64 756c 6573  dx(self._modules
+0001bad0: 2e6b 6579 7328 292c 2069 6478 290d 0a20  .keys(), idx).. 
+0001bae0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001baf0: 7461 7474 7228 7365 6c66 2c20 6b65 792c  tattr(self, key,
+0001bb00: 206d 6f64 756c 6529 0d0a 0d0a 2020 2020   module)....    
+0001bb10: 6465 6620 5f5f 6465 6c69 7465 6d5f 5f28  def __delitem__(
+0001bb20: 7365 6c66 2c20 6964 7829 3a0d 0a20 2020  self, idx):..   
+0001bb30: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0001bb40: 6365 2869 6478 2c20 736c 6963 6529 3a0d  ce(idx, slice):.
+0001bb50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001bb60: 206b 6579 2069 6e20 6c69 7374 2873 656c   key in list(sel
+0001bb70: 662e 5f6d 6f64 756c 6573 2e6b 6579 7328  f._modules.keys(
+0001bb80: 2929 5b69 6478 5d3a 0d0a 2020 2020 2020  ))[idx]:..      
+0001bb90: 2020 2020 2020 2020 2020 6465 6c61 7474            delatt
+0001bba0: 7228 7365 6c66 2c20 6b65 7929 0d0a 2020  r(self, key)..  
+0001bbb0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0001bbc0: 2020 2020 2020 2020 206b 6579 203d 2073           key = s
+0001bbd0: 656c 662e 5f67 6574 5f69 7465 6d5f 6279  elf._get_item_by
+0001bbe0: 5f69 6478 2873 656c 662e 5f6d 6f64 756c  _idx(self._modul
+0001bbf0: 6573 2e6b 6579 7328 292c 2069 6478 290d  es.keys(), idx).
+0001bc00: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+0001bc10: 6174 7472 2873 656c 662c 206b 6579 290d  attr(self, key).
+0001bc20: 0a0d 0a20 2020 2064 6566 205f 5f6c 656e  ...    def __len
+0001bc30: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+0001bc40: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
+0001bc50: 6c66 2e5f 6d6f 6475 6c65 7329 0d0a 0d0a  lf._modules)....
+0001bc60: 2020 2020 6465 6620 5f5f 6469 725f 5f28      def __dir__(
+0001bc70: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0001bc80: 6b65 7973 203d 2073 7570 6572 2843 6f6d  keys = super(Com
+0001bc90: 6269 6e65 2c20 7365 6c66 292e 5f5f 6469  bine, self).__di
+0001bca0: 725f 5f28 290d 0a20 2020 2020 2020 206b  r__()..        k
+0001bcb0: 6579 7320 3d20 5b6b 6579 2066 6f72 206b  eys = [key for k
+0001bcc0: 6579 2069 6e20 6b65 7973 2069 6620 6e6f  ey in keys if no
+0001bcd0: 7420 6b65 792e 6973 6469 6769 7428 295d  t key.isdigit()]
+0001bce0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001bcf0: 206b 6579 730d 0a0d 0a20 2020 2064 6566   keys....    def
+0001bd00: 2061 6464 5f6d 6f64 756c 6528 7365 6c66   add_module(self
+0001bd10: 2c20 6e61 6d65 2c20 6d6f 6475 6c65 293a  , name, module):
+0001bd20: 0d0a 2020 2020 2020 2020 2222 2241 6464  ..        """Add
+0001bd30: 7320 6120 6368 696c 6420 6d6f 6475 6c65  s a child module
+0001bd40: 2074 6f20 7468 6520 6375 7272 656e 7420   to the current 
+0001bd50: 6d6f 6475 6c65 2e0d 0a0d 0a20 2020 2020  module.....     
+0001bd60: 2020 2054 6865 206d 6f64 756c 6520 6361     The module ca
+0001bd70: 6e20 6265 2061 6363 6573 7365 6420 6173  n be accessed as
+0001bd80: 2061 6e20 6174 7472 6962 7574 6520 7573   an attribute us
+0001bd90: 696e 6720 7468 6520 6769 7665 6e20 6e61  ing the given na
+0001bda0: 6d65 2e0d 0a20 2020 2020 2020 2031 2920  me...        1) 
+0001bdb0: 6164 6420 6d6f 6475 6c65 2061 7320 6368  add module as ch
+0001bdc0: 696c 640d 0a0d 0a20 2020 2020 2020 2032  ild....        2
+0001bdd0: 2920 6765 6e65 7261 7465 2064 6566 6175  ) generate defau
+0001bde0: 6c74 5f6e 616d 6520 616e 6420 7265 6c61  lt_name and rela
+0001bdf0: 7469 7665 5f6e 616d 650d 0a0d 0a20 2020  tive_name....   
+0001be00: 2020 2020 2033 2920 7570 6461 7465 2074       3) update t
+0001be10: 6865 206e 6f64 6573 0d0a 0d0a 2020 2020  he nodes....    
+0001be20: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+0001be30: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
+0001be40: 696e 6729 3a20 6e61 6d65 206f 6620 7468  ing): name of th
+0001be50: 6520 6368 696c 6420 6d6f 6475 6c65 2e20  e child module. 
+0001be60: 5468 6520 6368 696c 6420 6d6f 6475 6c65  The child module
+0001be70: 2063 616e 2062 650d 0a20 2020 2020 2020   can be..       
+0001be80: 2020 2020 2020 2020 2061 6363 6573 7365           accesse
+0001be90: 6420 6672 6f6d 2074 6869 7320 6d6f 6475  d from this modu
+0001bea0: 6c65 2075 7369 6e67 2074 6865 2067 6976  le using the giv
+0001beb0: 656e 206e 616d 650d 0a20 2020 2020 2020  en name..       
+0001bec0: 2020 2020 206d 6f64 756c 6520 284d 6f64       module (Mod
+0001bed0: 756c 6529 3a20 6368 696c 6420 6d6f 6475  ule): child modu
+0001bee0: 6c65 2074 6f20 6265 2061 6464 6564 2074  le to be added t
+0001bef0: 6f20 7468 6520 6d6f 6475 6c65 2e0d 0a0d  o the module....
+0001bf00: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0001bf10: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001bf20: 6e73 7461 6e63 6528 6d6f 6475 6c65 2c20  nstance(module, 
+0001bf30: 286e 6e2e 4d6f 6475 6c65 2c20 4c61 7965  (nn.Module, Laye
+0001bf40: 7229 2920 616e 6420 6d6f 6475 6c65 2069  r)) and module i
+0001bf50: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0001bf60: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0001bf70: 7970 6545 7272 6f72 2822 7b7d 2069 7320  ypeError("{} is 
+0001bf80: 6e6f 7420 6120 4d6f 6475 6c65 2073 7562  not a Module sub
+0001bf90: 636c 6173 7322 2e66 6f72 6d61 7428 0d0a  class".format(..
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfb0: 746f 7263 682e 7479 7065 6e61 6d65 286d  torch.typename(m
+0001bfc0: 6f64 756c 6529 2929 0d0a 2020 2020 2020  odule)))..      
+0001bfd0: 2020 656c 6966 206e 6f74 2069 7369 6e73    elif not isins
+0001bfe0: 7461 6e63 6528 6e61 6d65 2c20 7374 7229  tance(name, str)
+0001bff0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0001c000: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+0001c010: 6d6f 6475 6c65 206e 616d 6520 7368 6f75  module name shou
+0001c020: 6c64 2062 6520 6120 7374 7269 6e67 2e20  ld be a string. 
+0001c030: 476f 7420 7b7d 222e 666f 726d 6174 2874  Got {}".format(t
+0001c040: 6f72 6368 2e74 7970 656e 616d 6528 6e61  orch.typename(na
+0001c050: 6d65 2929 290d 0a20 2020 2020 2020 2065  me)))..        e
+0001c060: 6c69 6620 6861 7361 7474 7228 7365 6c66  lif hasattr(self
+0001c070: 2c20 6e61 6d65 2920 616e 6420 6e61 6d65  , name) and name
+0001c080: 206e 6f74 2069 6e20 7365 6c66 2e5f 6d6f   not in self._mo
+0001c090: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+0001c0a0: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
+0001c0b0: 6f72 2822 6174 7472 6962 7574 6520 277b  or("attribute '{
+0001c0c0: 7d27 2061 6c72 6561 6479 2065 7869 7374  }' already exist
+0001c0d0: 7322 2e66 6f72 6d61 7428 6e61 6d65 2929  s".format(name))
+0001c0e0: 0d0a 2020 2020 2020 2020 656c 6966 2027  ..        elif '
+0001c0f0: 2e27 2069 6e20 6e61 6d65 3a0d 0a20 2020  .' in name:..   
+0001c100: 2020 2020 2020 2020 2023 206e 616d 653d           # name=
+0001c110: 6e61 6d65 2e72 6570 6c61 6365 2827 2e27  name.replace('.'
+0001c120: 2c27 5f27 290d 0a20 2020 2020 2020 2020  ,'_')..         
+0001c130: 2020 2072 6169 7365 204b 6579 4572 726f     raise KeyErro
+0001c140: 7228 226d 6f64 756c 6520 6e61 6d65 2063  r("module name c
+0001c150: 616e 2774 2063 6f6e 7461 696e 205c 222e  an't contain \".
+0001c160: 5c22 2229 0d0a 2020 2020 2020 2020 656c  \"")..        el
+0001c170: 6966 206e 616d 6520 3d3d 2027 273a 0d0a  if name == '':..
+0001c180: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001c190: 6520 4b65 7945 7272 6f72 2822 6d6f 6475  e KeyError("modu
+0001c1a0: 6c65 206e 616d 6520 6361 6e27 7420 6265  le name can't be
+0001c1b0: 2065 6d70 7479 2073 7472 696e 6720 5c22   empty string \"
+0001c1c0: 5c22 2229 0d0a 2020 2020 2020 2020 7365  \"")..        se
+0001c1d0: 6c66 2e5f 6d6f 6475 6c65 735b 6e61 6d65  lf._modules[name
+0001c1e0: 5d20 3d20 6d6f 6475 6c65 0d0a 0d0a 2020  ] = module....  
+0001c1f0: 2020 6465 6620 6275 696c 6428 7365 6c66    def build(self
+0001c200: 2c20 2a69 6e70 7574 5f73 6861 7065 3a20  , *input_shape: 
+0001c210: 5465 6e73 6f72 5368 6170 6529 3a0d 0a20  TensorShape):.. 
+0001c220: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0001c230: 6c66 2e5f 6275 696c 743a 0d0a 2020 2020  lf._built:..    
+0001c240: 2020 2020 2020 2020 2320 5369 676e 6174          # Signat
+0001c250: 7572 6528 6e61 6d65 3d73 656c 662e 6e61  ure(name=self.na
+0001c260: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
+0001c270: 2066 6f72 2073 6870 2c20 6d6f 6475 6c65   for shp, module
+0001c280: 2069 6e20 7a69 7028 696e 7075 745f 7368   in zip(input_sh
+0001c290: 6170 652c 2073 656c 662e 5f6d 6f64 756c  ape, self._modul
+0001c2a0: 6573 2e76 616c 7565 7328 2929 3a0d 0a20  es.values()):.. 
+0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001c2c0: 2073 6870 203d 2074 656e 736f 725f 746f   shp = tensor_to
+0001c2d0: 5f73 6861 7065 2869 6e70 2c20 6e65 6564  _shape(inp, need
+0001c2e0: 5f65 7863 6c75 6465 5f62 6174 6368 5f61  _exclude_batch_a
+0001c2f0: 7869 733d 5472 7565 2c20 6973 5f73 696e  xis=True, is_sin
+0001c300: 676c 6574 6f6e 3d46 616c 7365 290d 0a20  gleton=False).. 
+0001c310: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001c320: 6f64 756c 652e 6275 696c 6428 7368 7029  odule.build(shp)
+0001c330: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0001c340: 6c66 2e5f 6275 696c 7420 3d20 5472 7565  lf._built = True
+0001c350: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+0001c360: 790d 0a20 2020 2064 6566 2073 6967 6e61  y..    def signa
+0001c370: 7475 7265 2873 656c 6629 3a0d 0a20 2020  ture(self):..   
+0001c380: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
+0001c390: 2020 2020 5265 7475 726e 733a 0d0a 0d0a      Returns:....
+0001c3a0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0001c3b0: 2020 2020 2069 6620 7365 6c66 2e5f 7369       if self._si
+0001c3c0: 676e 6174 7572 6520 6973 204e 6f6e 653a  gnature is None:
+0001c3d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0001c3e0: 6c66 2e5f 7369 676e 6174 7572 6520 3d20  lf._signature = 
+0001c3f0: 5369 676e 6174 7572 6528 6e61 6d65 3d73  Signature(name=s
+0001c400: 656c 662e 6e61 6d65 290d 0a20 2020 2020  elf.name)..     
+0001c410: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
+0001c420: 656c 662e 5f6d 6f64 756c 6573 2e69 7465  elf._modules.ite
+0001c430: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
+0001c440: 2020 2066 6f72 2069 6e70 5f6b 2c20 696e     for inp_k, in
+0001c450: 705f 7620 696e 2076 2e73 6967 6e61 7475  p_v in v.signatu
+0001c460: 7265 2e69 6e70 7574 732e 6974 656d 7328  re.inputs.items(
+0001c470: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001c480: 2020 2020 6966 2027 7b30 7d5f 7b31 7d27      if '{0}_{1}'
+0001c490: 2e66 6f72 6d61 7428 696e 705f 6b2c 206b  .format(inp_k, k
+0001c4a0: 2920 6e6f 7420 696e 2073 656c 662e 5f73  ) not in self._s
+0001c4b0: 6967 6e61 7475 7265 2e69 6e70 7574 733a  ignature.inputs:
+0001c4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c4d0: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
+0001c4e0: 6174 7572 652e 696e 7075 7473 5b27 7b30  ature.inputs['{0
+0001c4f0: 7d5f 7b31 7d27 2e66 6f72 6d61 7428 696e  }_{1}'.format(in
+0001c500: 705f 6b2c 206b 295d 203d 2069 6e70 5f76  p_k, k)] = inp_v
+0001c510: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0001c520: 7220 6f75 745f 6b2c 206f 7574 5f76 2069  r out_k, out_v i
+0001c530: 6e20 762e 7369 676e 6174 7572 652e 6f75  n v.signature.ou
+0001c540: 7470 7574 732e 6974 656d 7328 293a 0d0a  tputs.items():..
+0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c560: 6966 2027 7b30 7d5f 7b31 7d27 2e66 6f72  if '{0}_{1}'.for
+0001c570: 6d61 7428 6f75 745f 6b2c 206b 2920 6e6f  mat(out_k, k) no
+0001c580: 7420 696e 2073 656c 662e 5f73 6967 6e61  t in self._signa
+0001c590: 7475 7265 2e6f 7574 7075 7473 3a0d 0a20  ture.outputs:.. 
+0001c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5b0: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
+0001c5c0: 7265 2e6f 7574 7075 7473 5b27 7b30 7d5f  re.outputs['{0}_
+0001c5d0: 7b31 7d27 2e66 6f72 6d61 7428 6f75 745f  {1}'.format(out_
+0001c5e0: 6b2c 206b 295d 203d 206f 7574 5f76 0d0a  k, k)] = out_v..
+0001c5f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001c600: 656c 662e 5f73 6967 6e61 7475 7265 0d0a  elf._signature..
+0001c610: 0d0a 2020 2020 4073 6967 6e61 7475 7265  ..    @signature
+0001c620: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
+0001c630: 2073 6967 6e61 7475 7265 2873 656c 662c   signature(self,
+0001c640: 2076 616c 7565 293a 0d0a 2020 2020 2020   value):..      
+0001c650: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
+0001c660: 6520 3d20 7661 6c75 650d 0a0d 0a20 2020  e = value....   
+0001c670: 2064 6566 2063 6f6d 6269 6e65 5f66 6f72   def combine_for
+0001c680: 7761 7264 2873 656c 662c 2078 293a 0d0a  ward(self, x):..
+0001c690: 2020 2020 2020 2020 6f75 7470 7574 7320          outputs 
+0001c6a0: 3d20 5b5d 0d0a 2020 2020 2020 2020 666f  = []..        fo
+0001c6b0: 7220 696e 702c 206d 6f64 756c 6520 696e  r inp, module in
+0001c6c0: 207a 6970 2878 2c20 6c69 7374 2873 656c   zip(x, list(sel
+0001c6d0: 662e 5f6d 6f64 756c 6573 2e76 616c 7565  f._modules.value
+0001c6e0: 7328 2929 293a 0d0a 2020 2020 2020 2020  s())):..        
+0001c6f0: 2020 2020 6f75 7470 7574 732e 6170 7065      outputs.appe
+0001c700: 6e64 286d 6f64 756c 6528 696e 7029 290d  nd(module(inp)).
+0001c710: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001c720: 7475 706c 6528 6f75 7470 7574 7329 0d0a  tuple(outputs)..
+0001c730: 0d0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+0001c740: 6428 7365 6c66 2c20 2a78 293a 0d0a 2020  d(self, *x):..  
+0001c750: 2020 2020 2020 6966 206c 656e 2878 2920        if len(x) 
+0001c760: 3d3d 206c 656e 2873 656c 662e 5f6d 6f64  == len(self._mod
+0001c770: 756c 6573 2e76 616c 7565 7328 2929 3a0d  ules.values()):.
+0001c780: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0001c790: 7075 7473 203d 205b 5d0d 0a20 2020 2020  puts = []..     
+0001c7a0: 2020 2020 2020 2066 6f72 2069 6e70 2c20         for inp, 
+0001c7b0: 6d6f 6475 6c65 2069 6e20 7a69 7028 782c  module in zip(x,
+0001c7c0: 206c 6973 7428 7365 6c66 2e5f 6d6f 6475   list(self._modu
+0001c7d0: 6c65 732e 7661 6c75 6573 2829 2929 3a0d  les.values())):.
+0001c7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c7f0: 206f 7574 7075 7473 2e61 7070 656e 6428   outputs.append(
+0001c800: 6d6f 6475 6c65 2869 6e70 2929 0d0a 2020  module(inp))..  
+0001c810: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001c820: 2074 7570 6c65 286f 7574 7075 7473 290d   tuple(outputs).
+0001c830: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
+0001c840: 6e28 7829 203d 3d20 313a 0d0a 2020 2020  n(x) == 1:..    
+0001c850: 2020 2020 2020 2020 6f75 7470 7574 7320          outputs 
+0001c860: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
+0001c870: 2020 666f 7220 6d6f 6475 6c65 2069 6e20    for module in 
+0001c880: 7365 6c66 2e5f 6d6f 6475 6c65 732e 7661  self._modules.va
+0001c890: 6c75 6573 2829 3a0d 0a20 2020 2020 2020  lues():..       
+0001c8a0: 2020 2020 2020 2020 206f 7574 7075 7473           outputs
+0001c8b0: 2e61 7070 656e 6428 6d6f 6475 6c65 2878  .append(module(x
+0001c8c0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0001c8d0: 7265 7475 726e 2074 7570 6c65 286f 7574  return tuple(out
+0001c8e0: 7075 7473 290d 0a20 2020 2020 2020 2072  puts)..        r
+0001c8f0: 6574 7572 6e20 4e6f 6e65 0d0a 0d0a 0d0a  eturn None......
+0001c900: 0d0a 696d 706f 7274 2074 6f72 6368 0d0a  ..import torch..
+0001c910: 0d0a 0d0a 6465 6620 5f65 7874 7261 6374  ....def _extract
+0001c920: 5f69 6e74 6572 7661 6c73 286f 6666 7365  _intervals(offse
+0001c930: 7473 2c20 7369 7a65 732c 2064 6174 6129  ts, sizes, data)
+0001c940: 3a0d 0a20 2020 2022 2222 5365 6c65 6374  :..    """Select
+0001c950: 2063 6f6e 7469 6775 6f75 7320 696e 7465   contiguous inte
+0001c960: 7276 616c 7320 6f66 2072 6f77 732c 2067  rvals of rows, g
+0001c970: 6976 656e 2074 6865 6972 206f 6666 7365  iven their offse
+0001c980: 7473 2061 6e64 2073 697a 6573 2e0d 0a20  ts and sizes... 
+0001c990: 2020 2045 2e67 2e20 7375 7070 6f73 6520     E.g. suppose 
+0001c9a0: 6f66 6673 6574 7320 3d20 5b33 352c 2037  offsets = [35, 7
+0001c9b0: 302c 2039 305d 2c20 7369 7a65 7320 3d20  0, 90], sizes = 
+0001c9c0: 5b33 2c20 322c 2034 5d2c 2074 6865 6e20  [3, 2, 4], then 
+0001c9d0: 7468 6973 2077 696c 6c0d 0a20 2020 2072  this will..    r
+0001c9e0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+0001c9f0: 2020 2020 2028 746f 7263 682e 4c6f 6e67       (torch.Long
+0001ca00: 5465 6e73 6f72 2830 2c20 332c 2035 292c  Tensor(0, 3, 5),
+0001ca10: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+0001ca20: 7461 5b74 6f72 6368 2e4c 6f6e 6754 656e  ta[torch.LongTen
+0001ca30: 736f 7228 5b33 352c 2033 362c 2033 372c  sor([35, 36, 37,
+0001ca40: 2037 302c 2037 312c 2039 302c 2039 312c   70, 71, 90, 91,
+0001ca50: 2039 322c 2039 335d 295d 290d 0a0d 0a20   92, 93])]).... 
+0001ca60: 2020 2022 2222 0d0a 2020 2020 6f66 6673     """..    offs
+0001ca70: 6574 7320 3d20 6f66 6673 6574 732e 6c6f  ets = offsets.lo
+0001ca80: 6e67 2829 0d0a 2020 2020 7369 7a65 7320  ng()..    sizes 
+0001ca90: 3d20 7369 7a65 732e 6c6f 6e67 2829 0d0a  = sizes.long()..
+0001caa0: 2020 2020 7265 735f 726f 7773 203d 2073      res_rows = s
+0001cab0: 697a 6573 2e73 756d 2829 2e69 7465 6d28  izes.sum().item(
+0001cac0: 290d 0a20 2020 2061 7373 6572 7420 6f66  )..    assert of
+0001cad0: 6673 6574 732e 7369 7a65 2830 2920 3d3d  fsets.size(0) ==
+0001cae0: 2073 697a 6573 2e73 697a 6528 3029 0d0a   sizes.size(0)..
+0001caf0: 0d0a 2020 2020 6e6f 6e5f 7a65 726f 5f73  ..    non_zero_s
+0001cb00: 697a 6520 3d20 7369 7a65 7320 213d 2030  ize = sizes != 0
+0001cb10: 0d0a 2020 2020 6966 206e 6f6e 5f7a 6572  ..    if non_zer
+0001cb20: 6f5f 7369 7a65 2e6c 6f6e 6728 292e 7375  o_size.long().su
+0001cb30: 6d28 2920 3d3d 2030 3a0d 0a20 2020 2020  m() == 0:..     
+0001cb40: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
+0001cb50: 7a65 726f 7328 6f66 6673 6574 732e 7369  zeros(offsets.si
+0001cb60: 7a65 2830 2920 2b20 3129 2e6c 6f6e 6728  ze(0) + 1).long(
+0001cb70: 292c 2064 6174 612e 6e65 7728 290d 0a0d  ), data.new()...
+0001cb80: 0a20 2020 206e 6577 5f6f 6666 7365 7473  .    new_offsets
+0001cb90: 203d 2074 6f72 6368 2e63 6174 285b 746f   = torch.cat([to
+0001cba0: 7263 682e 4c6f 6e67 5465 6e73 6f72 285b  rch.LongTensor([
+0001cbb0: 305d 292c 2073 697a 6573 2e63 756d 7375  0]), sizes.cumsu
+0001cbc0: 6d28 3029 5d29 0d0a 2020 2020 7369 7a65  m(0)])..    size
+0001cbd0: 735f 6e7a 203d 2073 697a 6573 5b6e 6f6e  s_nz = sizes[non
+0001cbe0: 5f7a 6572 6f5f 7369 7a65 5d0d 0a20 2020  _zero_size]..   
+0001cbf0: 206f 6666 7365 7473 5f6e 7a20 3d20 6f66   offsets_nz = of
+0001cc00: 6673 6574 735b 6e6f 6e5f 7a65 726f 5f73  fsets[non_zero_s
+0001cc10: 697a 655d 0d0a 0d0a 2020 2020 7265 735f  ize]....    res_
+0001cc20: 6465 6c74 6120 3d20 746f 7263 682e 4c6f  delta = torch.Lo
+0001cc30: 6e67 5465 6e73 6f72 2872 6573 5f72 6f77  ngTensor(res_row
+0001cc40: 7329 2e66 696c 6c5f 2831 290d 0a20 2020  s).fill_(1)..   
+0001cc50: 2072 6573 5f64 656c 7461 5b30 5d20 3d20   res_delta[0] = 
+0001cc60: 6f66 6673 6574 735f 6e7a 5b30 5d0d 0a0d  offsets_nz[0]...
+0001cc70: 0a20 2020 2069 6620 6f66 6673 6574 735f  .    if offsets_
+0001cc80: 6e7a 2e73 697a 6528 3029 203e 2031 3a0d  nz.size(0) > 1:.
+0001cc90: 0a20 2020 2020 2020 2069 6e70 7574 5f64  .        input_d
+0001cca0: 656c 7461 203d 206f 6666 7365 7473 5f6e  elta = offsets_n
+0001ccb0: 7a5b 313a 5d20 2d20 6f66 6673 6574 735f  z[1:] - offsets_
+0001ccc0: 6e7a 5b3a 2d31 5d20 2d20 7369 7a65 735f  nz[:-1] - sizes_
+0001ccd0: 6e7a 5b3a 2d31 5d20 2023 205b 3332 2c20  nz[:-1]  # [32, 
+0001cce0: 3138 5d0d 0a20 2020 2020 2020 2072 6573  18]..        res
+0001ccf0: 5f72 6f77 5f6f 6666 7365 7473 203d 2073  _row_offsets = s
+0001cd00: 697a 6573 5f6e 7a2e 6375 6d73 756d 2830  izes_nz.cumsum(0
+0001cd10: 295b 3a2d 315d 2020 2320 5b33 2c20 355d  )[:-1]  # [3, 5]
+0001cd20: 0d0a 2020 2020 2020 2020 7265 735f 6465  ..        res_de
+0001cd30: 6c74 615b 7265 735f 726f 775f 6f66 6673  lta[res_row_offs
+0001cd40: 6574 735d 202b 3d20 696e 7075 745f 6465  ets] += input_de
+0001cd50: 6c74 6120 2023 205b 3335 2c20 312c 2031  lta  # [35, 1, 1
+0001cd60: 2c20 3333 2c20 312c 2031 392c 2031 2c20  , 33, 1, 19, 1, 
+0001cd70: 312c 2031 5d0d 0a0d 0a20 2020 2072 6573  1, 1]....    res
+0001cd80: 5f6f 6666 7365 7473 203d 2072 6573 5f64  _offsets = res_d
+0001cd90: 656c 7461 2e63 756d 7375 6d28 3029 2020  elta.cumsum(0)  
+0001cda0: 2320 5b33 352c 2033 362c 2033 372c 2037  # [35, 36, 37, 7
+0001cdb0: 302c 2037 312c 2039 302c 2039 312c 2039  0, 71, 90, 91, 9
+0001cdc0: 322c 2039 335d 0d0a 2020 2020 7265 7320  2, 93]..    res 
+0001cdd0: 3d20 6461 7461 5b72 6573 5f6f 6666 7365  = data[res_offse
+0001cde0: 7473 5d0d 0a0d 0a20 2020 2072 6574 7572  ts]....    retur
+0001cdf0: 6e20 6e65 775f 6f66 6673 6574 732c 2072  n new_offsets, r
+0001ce00: 6573 0d0a 0d0a 0d0a 636c 6173 7320 5465  es......class Te
+0001ce10: 6e73 6f72 4c69 7374 286f 626a 6563 7429  nsorList(object)
+0001ce20: 3a0d 0a20 2020 2022 2222 4120 6c69 7374  :..    """A list
+0001ce30: 206f 6620 7465 6e73 6f72 7320 6f66 2064   of tensors of d
+0001ce40: 6966 6665 7265 6e74 2073 697a 6573 2c20  ifferent sizes, 
+0001ce50: 6261 636b 6564 2062 7920 6120 286f 6666  backed by a (off
+0001ce60: 7365 742c 2073 697a 652c 2064 6174 6129  set, size, data)
+0001ce70: 0d0a 2020 2020 7475 706c 652e 0d0a 0d0a  ..    tuple.....
+0001ce80: 2020 2020 496e 6465 7869 6e67 2062 7920      Indexing by 
+0001ce90: 4c6f 6e67 5465 6e73 6f72 2072 6574 7572  LongTensor retur
+0001cea0: 6e73 2061 206e 6577 2054 656e 736f 724c  ns a new TensorL
+0001ceb0: 6973 7420 7769 7468 2074 6865 2073 656c  ist with the sel
+0001cec0: 6563 7465 6420 6c69 7374 0d0a 2020 2020  ected list..    
+0001ced0: 656c 656d 656e 7473 2028 7369 6d69 6c61  elements (simila
+0001cee0: 7220 746f 2069 6e64 6578 696e 6720 6120  r to indexing a 
+0001cef0: 746f 7263 6820 696e 6465 785f 7365 6c65  torch index_sele
+0001cf00: 6374 5f29 2e0d 0a0d 0a20 2020 2049 6e64  ct_).....    Ind
+0001cf10: 6578 696e 6720 6279 2061 6e20 696e 7420  exing by an int 
+0001cf20: 7265 7475 726e 7320 6120 746f 7263 682e  returns a torch.
+0001cf30: 5465 6e73 6f72 2077 6974 6820 7468 6174  Tensor with that
+0001cf40: 206c 6973 7420 656c 656d 656e 742e 0d0a   list element...
+0001cf50: 2020 2020 2222 220d 0a0d 0a20 2020 2040      """....    @
+0001cf60: 636c 6173 736d 6574 686f 640d 0a20 2020  classmethod..   
+0001cf70: 2064 6566 2063 6174 2863 6c73 2c20 656c   def cat(cls, el
+0001cf80: 656d 656e 7473 293a 0d0a 2020 2020 2020  ements):..      
+0001cf90: 2020 6f66 6673 6574 732c 2064 6174 6120    offsets, data 
+0001cfa0: 3d20 7a69 7028 2a5b 5b78 2e6f 6666 7365  = zip(*[[x.offse
+0001cfb0: 7473 2c20 782e 6461 7461 5d20 666f 7220  ts, x.data] for 
+0001cfc0: 7820 696e 2065 6c65 6d65 6e74 735d 290d  x in elements]).
+0001cfd0: 0a20 2020 2020 2020 206f 6666 7365 7473  .        offsets
+0001cfe0: 203d 206c 6973 7428 6f66 6673 6574 7329   = list(offsets)
+0001cff0: 0d0a 2020 2020 2020 2020 6261 7463 685f  ..        batch_
+0001d000: 6f66 6673 6574 203d 2074 6f72 6368 2e4c  offset = torch.L
+0001d010: 6f6e 6754 656e 736f 7228 5b6f 5b2d 315d  ongTensor([o[-1]
+0001d020: 2066 6f72 206f 2069 6e20 6f66 6673 6574   for o in offset
+0001d030: 735d 292e 6375 6d73 756d 2830 290d 0a20  s]).cumsum(0).. 
+0001d040: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
+0001d050: 7261 6e67 6528 6c65 6e28 6f66 6673 6574  range(len(offset
+0001d060: 7329 202d 2031 293a 0d0a 2020 2020 2020  s) - 1):..      
+0001d070: 2020 2020 2020 6f66 6673 6574 735b 6a20        offsets[j 
+0001d080: 2b20 315d 203d 206f 6666 7365 7473 5b6a  + 1] = offsets[j
+0001d090: 202b 2031 5d5b 313a 5d20 2b20 6261 7463   + 1][1:] + batc
+0001d0a0: 685f 6f66 6673 6574 5b6a 5d0d 0a20 2020  h_offset[j]..   
+0001d0b0: 2020 2020 2072 6574 7572 6e20 636c 7328       return cls(
+0001d0c0: 746f 7263 682e 6361 7428 6f66 6673 6574  torch.cat(offset
+0001d0d0: 7329 2c20 746f 7263 682e 6361 7428 6461  s), torch.cat(da
+0001d0e0: 7461 2929 0d0a 0d0a 2020 2020 4063 6c61  ta))....    @cla
+0001d0f0: 7373 6d65 7468 6f64 0d0a 2020 2020 6465  ssmethod..    de
+0001d100: 6620 656d 7074 7928 636c 732c 206e 756d  f empty(cls, num
+0001d110: 5f74 656e 736f 7273 3d30 293a 0d0a 2020  _tensors=0):..  
+0001d120: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+0001d130: 280d 0a20 2020 2020 2020 2020 2020 2074  (..            t
+0001d140: 6f72 6368 2e7a 6572 6f73 2828 292c 2064  orch.zeros((), d
+0001d150: 7479 7065 3d74 6f72 6368 2e6c 6f6e 6729  type=torch.long)
+0001d160: 2e65 7870 616e 6428 286e 756d 5f74 656e  .expand((num_ten
+0001d170: 736f 7273 202b 2031 2c29 292c 0d0a 2020  sors + 1,)),..  
+0001d180: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+0001d190: 656d 7074 7928 2830 2c29 2c20 6474 7970  empty((0,), dtyp
+0001d1a0: 653d 746f 7263 682e 6c6f 6e67 292c 0d0a  e=torch.long),..
+0001d1b0: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+0001d1c0: 2064 6566 206e 6577 2873 656c 6629 3a0d   def new(self):.
+0001d1d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001d1e0: 7479 7065 2873 656c 6629 2873 656c 662e  type(self)(self.
+0001d1f0: 6f66 6673 6574 732e 6e65 775f 7a65 726f  offsets.new_zero
+0001d200: 7328 2831 2c29 292c 2073 656c 662e 6461  s((1,)), self.da
+0001d210: 7461 2e6e 6577 5f65 6d70 7479 2828 302c  ta.new_empty((0,
+0001d220: 2929 290d 0a0d 0a20 2020 2064 6566 205f  )))....    def _
+0001d230: 5f69 6e69 745f 5f28 7365 6c66 2c20 6f66  _init__(self, of
+0001d240: 6673 6574 732c 2064 6174 6129 3a0d 0a20  fsets, data):.. 
+0001d250: 2020 2020 2020 2023 2073 6f6d 6520 7361         # some sa
+0001d260: 6e69 7479 2063 6865 636b 730d 0a20 2020  nity checks..   
+0001d270: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
+0001d280: 7374 616e 6365 286f 6666 7365 7473 2c20  stance(offsets, 
+0001d290: 2874 6f72 6368 2e4c 6f6e 6754 656e 736f  (torch.LongTenso
+0001d2a0: 722c 2074 6f72 6368 2e63 7564 612e 4c6f  r, torch.cuda.Lo
+0001d2b0: 6e67 5465 6e73 6f72 2929 0d0a 2020 2020  ngTensor))..    
+0001d2c0: 2020 2020 6173 7365 7274 206f 6666 7365      assert offse
+0001d2d0: 7473 2e6e 6469 6d65 6e73 696f 6e28 2920  ts.ndimension() 
+0001d2e0: 3d3d 2031 0d0a 2020 2020 2020 2020 6173  == 1..        as
+0001d2f0: 7365 7274 206f 6666 7365 7473 5b30 5d20  sert offsets[0] 
+0001d300: 3d3d 2030 0d0a 2020 2020 2020 2020 6173  == 0..        as
+0001d310: 7365 7274 206f 6666 7365 7473 5b2d 315d  sert offsets[-1]
+0001d320: 203d 3d20 2864 6174 612e 7369 7a65 2830   == (data.size(0
+0001d330: 2920 6966 2064 6174 612e 6e64 696d 656e  ) if data.ndimen
+0001d340: 7369 6f6e 2829 203e 2030 2065 6c73 6520  sion() > 0 else 
+0001d350: 3029 0d0a 0d0a 2020 2020 2020 2020 7365  0)....        se
+0001d360: 6c66 2e6f 6666 7365 7473 203d 206f 6666  lf.offsets = off
+0001d370: 7365 7473 0d0a 2020 2020 2020 2020 7365  sets..        se
+0001d380: 6c66 2e64 6174 6120 3d20 6461 7461 0d0a  lf.data = data..
+0001d390: 0d0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+0001d3a0: 7465 6d5f 5f28 7365 6c66 2c20 696e 6465  tem__(self, inde
+0001d3b0: 7829 3a0d 0a20 2020 2020 2020 2069 6620  x):..        if 
+0001d3c0: 6973 696e 7374 616e 6365 2869 6e64 6578  isinstance(index
+0001d3d0: 2c20 2874 6f72 6368 2e4c 6f6e 6754 656e  , (torch.LongTen
+0001d3e0: 736f 722c 2074 6f72 6368 2e63 7564 612e  sor, torch.cuda.
+0001d3f0: 4c6f 6e67 5465 6e73 6f72 2929 3a0d 0a20  LongTensor)):.. 
+0001d400: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+0001d410: 7473 5f73 7562 203d 2073 656c 662e 6f66  ts_sub = self.of
+0001d420: 6673 6574 735b 696e 6465 785d 0d0a 2020  fsets[index]..  
+0001d430: 2020 2020 2020 2020 2020 7369 7a65 735f            sizes_
+0001d440: 7375 6220 3d20 7365 6c66 2e6f 6666 7365  sub = self.offse
+0001d450: 7473 5b69 6e64 6578 202b 2031 5d20 2d20  ts[index + 1] - 
+0001d460: 6f66 6673 6574 735f 7375 620d 0a20 2020  offsets_sub..   
+0001d470: 2020 2020 2020 2020 206e 6577 5f6f 6666           new_off
+0001d480: 7365 7473 2c20 6e65 775f 6461 7461 203d  sets, new_data =
+0001d490: 205f 6578 7472 6163 745f 696e 7465 7276   _extract_interv
+0001d4a0: 616c 7328 0d0a 2020 2020 2020 2020 2020  als(..          
+0001d4b0: 2020 2020 2020 6f66 6673 6574 735f 7375        offsets_su
+0001d4c0: 622c 2073 697a 6573 5f73 7562 2c20 7365  b, sizes_sub, se
+0001d4d0: 6c66 2e64 6174 610d 0a20 2020 2020 2020  lf.data..       
+0001d4e0: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
+0001d4f0: 2020 2020 2020 7265 7475 726e 2054 656e        return Ten
+0001d500: 736f 724c 6973 7428 6e65 775f 6f66 6673  sorList(new_offs
+0001d510: 6574 732c 206e 6577 5f64 6174 6129 0d0a  ets, new_data)..
+0001d520: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+0001d530: 6e73 7461 6e63 6528 696e 6465 782c 2069  nstance(index, i
+0001d540: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
+0001d550: 2020 6966 2073 656c 662e 6f66 6673 6574    if self.offset
+0001d560: 735b 696e 6465 785d 2021 3d20 7365 6c66  s[index] != self
+0001d570: 2e6f 6666 7365 7473 5b69 6e64 6578 202b  .offsets[index +
+0001d580: 2031 5d3a 0d0a 2020 2020 2020 2020 2020   1]:..          
+0001d590: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001d5a0: 662e 6461 7461 5b73 656c 662e 6f66 6673  f.data[self.offs
+0001d5b0: 6574 735b 696e 6465 785d 203a 2073 656c  ets[index] : sel
+0001d5c0: 662e 6f66 6673 6574 735b 696e 6465 7820  f.offsets[index 
+0001d5d0: 2b20 315d 5d0d 0a20 2020 2020 2020 2020  + 1]]..         
+0001d5e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001d5f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001d600: 2073 656c 662e 6461 7461 2e6e 6577 2829   self.data.new()
+0001d610: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+0001d620: 7369 6e73 7461 6e63 6528 696e 6465 782c  sinstance(index,
+0001d630: 2073 6c69 6365 293a 0d0a 2020 2020 2020   slice):..      
+0001d640: 2020 2020 2020 7374 6172 742c 2073 746f        start, sto
+0001d650: 702c 2073 7465 7020 3d20 696e 6465 782e  p, step = index.
+0001d660: 696e 6469 6365 7328 6c65 6e28 7365 6c66  indices(len(self
+0001d670: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0001d680: 6966 2073 7465 7020 213d 2031 3a0d 0a20  if step != 1:.. 
+0001d690: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001d6a0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0001d6b0: 2245 7870 6563 7465 6420 736c 6963 6520  "Expected slice 
+0001d6c0: 7769 7468 2073 7465 7020 312c 2067 6f74  with step 1, got
+0001d6d0: 2025 6422 2025 2073 7465 7029 0d0a 2020   %d" % step)..  
+0001d6e0: 2020 2020 2020 2020 2020 6e65 775f 6f66            new_of
+0001d6f0: 6673 6574 7320 3d20 7365 6c66 2e6f 6666  fsets = self.off
+0001d700: 7365 7473 5b73 7461 7274 203a 2073 746f  sets[start : sto
+0001d710: 7020 2b20 315d 0d0a 2020 2020 2020 2020  p + 1]..        
+0001d720: 2020 2020 6e65 775f 6461 7461 203d 2073      new_data = s
+0001d730: 656c 662e 6461 7461 5b6e 6577 5f6f 6666  elf.data[new_off
+0001d740: 7365 7473 5b30 5d20 3a20 6e65 775f 6f66  sets[0] : new_of
+0001d750: 6673 6574 735b 2d31 5d5d 0d0a 2020 2020  fsets[-1]]..    
+0001d760: 2020 2020 2020 2020 6e65 775f 6f66 6673          new_offs
+0001d770: 6574 7320 3d20 6e65 775f 6f66 6673 6574  ets = new_offset
+0001d780: 7320 2d20 6e65 775f 6f66 6673 6574 735b  s - new_offsets[
+0001d790: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
+0001d7a0: 7265 7475 726e 2054 656e 736f 724c 6973  return TensorLis
+0001d7b0: 7428 6e65 775f 6f66 6673 6574 732c 206e  t(new_offsets, n
+0001d7c0: 6577 5f64 6174 6129 0d0a 2020 2020 2020  ew_data)..      
+0001d7d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0001d7e0: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
+0001d7f0: 726f 7228 2255 6e6b 6e6f 776e 2069 6e64  ror("Unknown ind
+0001d800: 6578 2074 7970 653a 2025 7322 2025 2074  ex type: %s" % t
+0001d810: 7970 6528 696e 6465 7829 290d 0a0d 0a20  ype(index)).... 
+0001d820: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
+0001d830: 6c66 2c20 6f74 6865 7229 3a0d 0a20 2020  lf, other):..   
+0001d840: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0001d850: 7374 616e 6365 286f 7468 6572 2c20 5465  stance(other, Te
+0001d860: 6e73 6f72 4c69 7374 293a 0d0a 2020 2020  nsorList):..    
+0001d870: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001d880: 6f74 496d 706c 656d 656e 7465 640d 0a20  otImplemented.. 
+0001d890: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
+0001d8a0: 7263 682e 6571 7561 6c28 7365 6c66 2e6f  rch.equal(self.o
+0001d8b0: 6666 7365 7473 2c20 6f74 6865 722e 6f66  ffsets, other.of
+0001d8c0: 6673 6574 7329 2061 6e64 2074 6f72 6368  fsets) and torch
+0001d8d0: 2e65 7175 616c 280d 0a20 2020 2020 2020  .equal(..       
+0001d8e0: 2020 2020 2073 656c 662e 6461 7461 2c20       self.data, 
+0001d8f0: 6f74 6865 722e 6461 7461 0d0a 2020 2020  other.data..    
+0001d900: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
+0001d910: 205f 5f6c 656e 5f5f 2873 656c 6629 3a0d   __len__(self):.
+0001d920: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001d930: 7365 6c66 2e6f 6666 7365 7473 2e73 697a  self.offsets.siz
+0001d940: 6528 3029 202d 2031 0d0a 0d0a 2020 2020  e(0) - 1....    
+0001d950: 6465 6620 5f5f 6961 6464 5f5f 2873 656c  def __iadd__(sel
+0001d960: 662c 206f 7468 6572 293a 0d0a 2020 2020  f, other):..    
+0001d970: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001d980: 6528 6f74 6865 722c 2069 6e74 293a 0d0a  e(other, int):..
+0001d990: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d9a0: 2e64 6174 6120 2b3d 206f 7468 6572 0d0a  .data += other..
+0001d9b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001d9c0: 726e 2073 656c 660d 0a20 2020 2020 2020  rn self..       
+0001d9d0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0001d9e0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+0001d9f0: 6c65 6d65 6e74 6564 4572 726f 7228 290d  lementedError().
+0001da00: 0a0d 0a20 2020 2064 6566 205f 5f69 7375  ...    def __isu
+0001da10: 625f 5f28 7365 6c66 2c20 6f74 6865 7229  b__(self, other)
+0001da20: 3a0d 0a20 2020 2020 2020 2069 6620 6973  :..        if is
+0001da30: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
+0001da40: 696e 7429 3a0d 0a20 2020 2020 2020 2020  int):..         
+0001da50: 2020 2073 656c 662e 6461 7461 202d 3d20     self.data -= 
+0001da60: 6f74 6865 720d 0a20 2020 2020 2020 2020  other..         
+0001da70: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+0001da80: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001da90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001daa0: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+0001dab0: 7272 6f72 2829 0d0a 0d0a 2020 2020 6465  rror()....    de
+0001dac0: 6620 7369 7a65 2873 656c 662c 2064 696d  f size(self, dim
+0001dad0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
+0001dae0: 2023 2046 4958 4d45 3a20 7468 6973 2069   # FIXME: this i
+0001daf0: 7320 6120 7465 7272 6962 6c65 2041 5049  s a terrible API
+0001db00: 0d0a 0d0a 2020 2020 2020 2020 2320 746f  ....        # to
+0001db10: 2068 6176 6520 7369 6d69 6c61 7220 6170   have similar ap
+0001db20: 7065 6172 616e 6365 2077 6974 6820 6f74  pearance with ot
+0001db30: 6865 7220 7465 6e73 6f72 2074 7970 6573  her tensor types
+0001db40: 0d0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
+0001db50: 2064 696d 203d 3d20 3020 6f72 2064 696d   dim == 0 or dim
+0001db60: 2069 7320 4e6f 6e65 2c20 2254 656e 736f   is None, "Tenso
+0001db70: 724c 6973 7420 6361 6e20 6f6e 6c79 2068  rList can only h
+0001db80: 6176 6520 3120 6469 6d65 6e73 696f 6e22  ave 1 dimension"
+0001db90: 0d0a 2020 2020 2020 2020 6966 2064 696d  ..        if dim
+0001dba0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+0001dbb0: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
+0001dbc0: 7263 682e 5369 7a65 285b 6c65 6e28 7365  rch.Size([len(se
+0001dbd0: 6c66 295d 290d 0a20 2020 2020 2020 2065  lf)])..        e
+0001dbe0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0001dbf0: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
+0001dc00: 6629 0d0a 0d0a 2020 2020 6465 6620 6e65  f)....    def ne
+0001dc10: 6c65 6d65 6e74 2873 656c 6629 3a0d 0a20  lement(self):.. 
+0001dc20: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001dc30: 6c66 2e64 6174 612e 6e65 6c65 6d65 6e74  lf.data.nelement
+0001dc40: 2829 0d0a 0d0a 2020 2020 6465 6620 636c  ()....    def cl
+0001dc50: 6f6e 6528 7365 6c66 293a 0d0a 2020 2020  one(self):..    
+0001dc60: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001dc70: 5f5f 636c 6173 735f 5f28 7365 6c66 2e6f  __class__(self.o
+0001dc80: 6666 7365 7473 2c20 7365 6c66 2e64 6174  ffsets, self.dat
+0001dc90: 612e 636c 6f6e 6528 2929 0d0a 0d0a 2020  a.clone())....  
+0001dca0: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+0001dcb0: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
+0001dcc0: 6620 7365 6c66 2e6f 6666 7365 7473 2e6e  f self.offsets.n
+0001dcd0: 656c 656d 656e 7428 2920 3c20 3130 3020  element() < 100 
+0001dce0: 6f72 2073 656c 662e 6461 7461 2e6e 656c  or self.data.nel
+0001dcf0: 656d 656e 7428 2920 3c20 3130 3030 3a0d  ement() < 1000:.
+0001dd00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001dd10: 7572 6e20 2254 656e 736f 724c 6973 7428  urn "TensorList(
+0001dd20: 205b 2573 5d20 2922 2025 2022 202c 2022   [%s] )" % " , "
+0001dd30: 2e6a 6f69 6e28 0d0a 2020 2020 2020 2020  .join(..        
+0001dd40: 2020 2020 2020 2020 7374 7228 7365 6c66          str(self
+0001dd50: 5b69 5d2e 746f 6c69 7374 2829 2920 666f  [i].tolist()) fo
+0001dd60: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0001dd70: 2873 656c 6629 290d 0a20 2020 2020 2020  (self))..       
+0001dd80: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0001dd90: 7265 7475 726e 2022 5465 6e73 6f72 4c69  return "TensorLi
+0001dda0: 7374 7b6f 6666 7365 7473 3d25 732c 2064  st{offsets=%s, d
+0001ddb0: 6174 613d 2573 7d22 2025 2028 7365 6c66  ata=%s}" % (self
+0001ddc0: 2e6f 6666 7365 7473 2c20 7365 6c66 2e64  .offsets, self.d
+0001ddd0: 6174 6129 0d0a 0d0a 2020 2020 6465 6620  ata)....    def 
+0001dde0: 6170 706c 7928 7365 6c66 2c20 4629 3a0d  apply(self, F):.
+0001ddf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001de00: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2873  self.__class__(s
+0001de10: 656c 662e 6f66 6673 6574 732c 2046 2873  elf.offsets, F(s
+0001de20: 656c 662e 6461 7461 2929 0d0a 0d0a 2020  elf.data))....  
+0001de30: 2020 6465 6620 636f 6d62 696e 6528 7365    def combine(se
+0001de40: 6c66 2c20 6f74 6865 722c 2046 293a 0d0a  lf, other, F):..
+0001de50: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0001de60: 7461 6e63 6528 6f74 6865 722c 2054 656e  tance(other, Ten
+0001de70: 736f 724c 6973 7429 3a0d 0a20 2020 2020  sorList):..     
+0001de80: 2020 2020 2020 2061 7373 6572 7420 746f         assert to
+0001de90: 7263 682e 6571 7561 6c28 7365 6c66 2e6f  rch.equal(self.o
+0001dea0: 6666 7365 7473 2c20 6f74 6865 722e 6f66  ffsets, other.of
+0001deb0: 6673 6574 7329 0d0a 2020 2020 2020 2020  fsets)..        
+0001dec0: 2020 2020 6173 7365 7274 2073 656c 662e      assert self.
+0001ded0: 6461 7461 2e73 6861 7065 5b30 5d20 3d3d  data.shape[0] ==
+0001dee0: 206f 7468 6572 2e64 6174 612e 7368 6170   other.data.shap
+0001def0: 655b 305d 0d0a 2020 2020 2020 2020 2020  e[0]..          
+0001df00: 2020 7265 7320 3d20 7365 6c66 2e5f 5f63    res = self.__c
+0001df10: 6c61 7373 5f5f 2873 656c 662e 6f66 6673  lass__(self.offs
+0001df20: 6574 732c 2046 2873 656c 662e 6461 7461  ets, F(self.data
+0001df30: 2c20 6f74 6865 722e 6461 7461 2929 0d0a  , other.data))..
+0001df40: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001df50: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+0001df60: 2073 656c 662e 5f5f 636c 6173 735f 5f28   self.__class__(
+0001df70: 7365 6c66 2e6f 6666 7365 7473 2c20 4628  self.offsets, F(
+0001df80: 7365 6c66 2e64 6174 612c 206f 7468 6572  self.data, other
+0001df90: 2929 0d0a 2020 2020 2020 2020 6173 7365  ))..        asse
+0001dfa0: 7274 2072 6573 2e64 6174 612e 7368 6170  rt res.data.shap
+0001dfb0: 655b 305d 203d 3d20 7365 6c66 2e64 6174  e[0] == self.dat
+0001dfc0: 612e 7368 6170 655b 305d 0d0a 2020 2020  a.shape[0]..    
+0001dfd0: 2020 2020 7265 7475 726e 2072 6573 0d0a      return res..
+0001dfe0: 0d0a 2020 2020 6465 6620 6c65 6e67 7468  ..    def length
+0001dff0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+0001e000: 2020 7265 7475 726e 2073 656c 662e 6f66    return self.of
+0001e010: 6673 6574 735b 313a 5d20 2d20 7365 6c66  fsets[1:] - self
+0001e020: 2e6f 6666 7365 7473 5b3a 2d31 5d0d 0a0d  .offsets[:-1]...
+0001e030: 0a20 2020 2064 6566 2075 6e73 7175 6565  .    def unsquee
+0001e040: 7a65 2873 656c 662c 2064 696d 293a 0d0a  ze(self, dim):..
+0001e050: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001e060: 656c 662e 6170 706c 7928 6c61 6d62 6461  elf.apply(lambda
+0001e070: 2078 3a20 782e 756e 7371 7565 657a 6528   x: x.unsqueeze(
+0001e080: 6469 6d29 290d 0a0d 0a20 2020 2064 6566  dim))....    def
+0001e090: 2076 6965 7728 7365 6c66 2c20 2a61 7267   view(self, *arg
+0001e0a0: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
+0001e0b0: 7572 6e20 7365 6c66 2e61 7070 6c79 286c  urn self.apply(l
+0001e0c0: 616d 6264 6120 783a 2078 2e76 6965 7728  ambda x: x.view(
+0001e0d0: 2a61 7267 7329 290d 0a0d 0a20 2020 2064  *args))....    d
+0001e0e0: 6566 205f 5f61 6464 5f5f 2873 656c 662c  ef __add__(self,
+0001e0f0: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
+0001e100: 2020 7265 7475 726e 2073 656c 662e 636f    return self.co
+0001e110: 6d62 696e 6528 6f74 6865 722c 206c 616d  mbine(other, lam
+0001e120: 6264 6120 782c 2079 3a20 7820 2b20 7929  bda x, y: x + y)
+0001e130: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7375  ....    def __su
+0001e140: 625f 5f28 7365 6c66 2c20 6f74 6865 7229  b__(self, other)
+0001e150: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0001e160: 6e20 7365 6c66 2e63 6f6d 6269 6e65 286f  n self.combine(o
+0001e170: 7468 6572 2c20 6c61 6d62 6461 2078 2c20  ther, lambda x, 
+0001e180: 793a 2078 202d 2079 290d 0a0d 0a20 2020  y: x - y)....   
+0001e190: 2064 6566 205f 5f6d 756c 5f5f 2873 656c   def __mul__(sel
+0001e1a0: 662c 206f 7468 6572 293a 0d0a 2020 2020  f, other):..    
+0001e1b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001e1c0: 636f 6d62 696e 6528 6f74 6865 722c 206c  combine(other, l
+0001e1d0: 616d 6264 6120 782c 2079 3a20 7820 2a20  ambda x, y: x * 
+0001e1e0: 7929 0d0a 0d0a 2020 2020 6465 6620 5f5f  y)....    def __
+0001e1f0: 7472 7565 6469 765f 5f28 7365 6c66 2c20  truediv__(self, 
+0001e200: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
+0001e210: 2072 6574 7572 6e20 7365 6c66 2e63 6f6d   return self.com
+0001e220: 6269 6e65 286f 7468 6572 2c20 6c61 6d62  bine(other, lamb
+0001e230: 6461 2078 2c20 793a 2078 202f 2079 290d  da x, y: x / y).
+0001e240: 0a0d 0a20 2020 2064 6566 2073 756d 2873  ...    def sum(s
+0001e250: 656c 662c 2064 696d 3d4e 6f6e 652c 206b  elf, dim=None, k
+0001e260: 6565 7064 696d 3d46 616c 7365 293a 0d0a  eepdim=False):..
+0001e270: 2020 2020 2020 2020 6966 2064 696d 2069          if dim i
+0001e280: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0001e290: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001e2a0: 2e64 6174 612e 7375 6d28 290d 0a20 2020  .data.sum()..   
+0001e2b0: 2020 2020 2023 2057 6527 7265 206f 6e6c       # We're onl
+0001e2c0: 7920 676f 696e 6720 746f 2061 6772 6565  y going to agree
+0001e2d0: 2074 6f20 7375 6d20 6163 726f 7373 2022   to sum across "
+0001e2e0: 696e 6e65 7220 6469 6d65 6e73 696f 6e73  inner dimensions
+0001e2f0: 220d 0a20 2020 2020 2020 2069 6620 6469  "..        if di
+0001e300: 6d20 3c20 303a 0d0a 2020 2020 2020 2020  m < 0:..        
+0001e310: 2020 2020 6469 6d20 3d20 7365 6c66 2e64      dim = self.d
+0001e320: 6174 612e 6e64 696d 656e 7369 6f6e 2829  ata.ndimension()
+0001e330: 202b 2064 696d 0d0a 2020 2020 2020 2020   + dim..        
+0001e340: 6173 7365 7274 2064 696d 203e 2030 2c20  assert dim > 0, 
+0001e350: 2243 616e 2774 2073 756d 2061 6c6f 6e67  "Can't sum along
+0001e360: 2074 6865 2027 6c69 7374 2720 6469 6d65   the 'list' dime
+0001e370: 6e73 696f 6e22 0d0a 2020 2020 2020 2020  nsion"..        
+0001e380: 7265 7475 726e 2073 656c 662e 5f5f 636c  return self.__cl
+0001e390: 6173 735f 5f28 7365 6c66 2e6f 6666 7365  ass__(self.offse
+0001e3a0: 7473 2c20 7365 6c66 2e64 6174 612e 7375  ts, self.data.su
+0001e3b0: 6d28 6469 6d2c 206b 6565 7064 696d 3d6b  m(dim, keepdim=k
+0001e3c0: 6565 7064 696d 2929 0d0a 0d0a 2020 2020  eepdim))....    
+0001e3d0: 6465 6620 746f 2873 656c 662c 202a 6172  def to(self, *ar
+0001e3e0: 6773 2c20 2a2a 6b77 6172 6773 2920 2d3e  gs, **kwargs) ->
+0001e3f0: 2022 5465 6e73 6f72 4c69 7374 223a 0d0a   "TensorList":..
+0001e400: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0001e410: 7970 6528 7365 6c66 2928 0d0a 2020 2020  ype(self)(..    
+0001e420: 2020 2020 2020 2020 7365 6c66 2e6f 6666          self.off
+0001e430: 7365 7473 2e74 6f28 2a61 7267 732c 202a  sets.to(*args, *
+0001e440: 2a6b 7761 7267 7329 2c20 7365 6c66 2e64  *kwargs), self.d
+0001e450: 6174 612e 746f 282a 6172 6773 2c20 2a2a  ata.to(*args, **
+0001e460: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+0001e470: 2029 0d0a 0d0a 0d0a 6465 6620 7072 696e   )......def prin
+0001e480: 745f 6e65 7477 6f72 6b28 6e65 742c 2076  t_network(net, v
+0001e490: 6572 626f 7365 3d46 616c 7365 293a 0d0a  erbose=False):..
+0001e4a0: 2020 2020 6e75 6d5f 7061 7261 6d73 203d      num_params =
+0001e4b0: 2030 0d0a 2020 2020 666f 7220 692c 2070   0..    for i, p
+0001e4c0: 6172 616d 2069 6e20 656e 756d 6572 6174  aram in enumerat
+0001e4d0: 6528 6e65 742e 7061 7261 6d65 7465 7273  e(net.parameters
+0001e4e0: 2829 293a 0d0a 2020 2020 2020 2020 6e75  ()):..        nu
+0001e4f0: 6d5f 7061 7261 6d73 202b 3d20 7061 7261  m_params += para
+0001e500: 6d2e 6e75 6d65 6c28 290d 0a20 2020 2069  m.numel()..    i
+0001e510: 6620 7665 7262 6f73 653a 0d0a 2020 2020  f verbose:..    
+0001e520: 2020 2020 6c6f 6767 696e 672e 696e 666f      logging.info
+0001e530: 286e 6574 290d 0a20 2020 206c 6f67 6769  (net)..    loggi
+0001e540: 6e67 2e69 6e66 6f28 2754 6f74 616c 206e  ng.info('Total n
+0001e550: 756d 6265 7220 6f66 2070 6172 616d 6574  umber of paramet
+0001e560: 6572 733a 2025 645c 6e27 2025 206e 756d  ers: %d\n' % num
+0001e570: 5f70 6172 616d 7329 0d0a 0d0a 0d0a 6465  _params)......de
+0001e580: 6620 7375 6d6d 6172 7928 6d6f 6465 6c2c  f summary(model,
+0001e590: 2069 6e70 7574 5f73 7065 6373 2c20 6261   input_specs, ba
+0001e5a0: 7463 685f 7369 7a65 3d31 2c20 696e 7075  tch_size=1, inpu
+0001e5b0: 7473 3d4e 6f6e 652c 2064 6576 6963 653d  ts=None, device=
+0001e5c0: 2263 7564 6122 293a 0d0a 2020 2020 6465  "cuda"):..    de
+0001e5d0: 6620 7265 6769 7374 6572 5f68 6f6f 6b28  f register_hook(
+0001e5e0: 6d6f 6475 6c65 293a 0d0a 2020 2020 2020  module):..      
+0001e5f0: 2020 6465 6620 686f 6f6b 286d 6f64 756c    def hook(modul
+0001e600: 652c 2069 6e70 7574 2c20 6f75 7470 7574  e, input, output
+0001e610: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001e620: 2320 636c 6173 735f 6e61 6d65 203d 6d6f  # class_name =mo
+0001e630: 6475 6c65 2e72 6520 2020 206d 6f64 756c  dule.re    modul
+0001e640: 652e 6e61 6d65 2020 2023 2073 7472 286d  e.name   # str(m
+0001e650: 6f64 756c 652e 5f5f 636c 6173 735f 5f29  odule.__class__)
+0001e660: 2e73 706c 6974 2822 2e22 295b 2d31 5d2e  .split(".")[-1].
+0001e670: 7370 6c69 7428 2227 2229 5b30 5d0d 0a20  split("'")[0].. 
+0001e680: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+0001e690: 655f 6964 7820 3d20 6c65 6e28 7375 6d6d  e_idx = len(summ
+0001e6a0: 6172 7929 0d0a 0d0a 2020 2020 2020 2020  ary)....        
+0001e6b0: 2020 2020 6d5f 6b65 7920 3d20 6d6f 6475      m_key = modu
+0001e6c0: 6c65 2e72 656c 6174 6976 655f 6e61 6d65  le.relative_name
+0001e6d0: 2069 6620 6861 7361 7474 7228 6d6f 6475   if hasattr(modu
+0001e6e0: 6c65 2c20 2772 656c 6174 6976 655f 6e61  le, 'relative_na
+0001e6f0: 6d65 2729 2065 6c73 6520 6d6f 6475 6c65  me') else module
+0001e700: 2e6e 616d 650d 0a20 2020 2020 2020 2020  .name..         
+0001e710: 2020 2069 6620 6d5f 6b65 7920 696e 2073     if m_key in s
+0001e720: 756d 6d61 7279 3a0d 0a20 2020 2020 2020  ummary:..       
+0001e730: 2020 2020 2020 2020 2073 756d 6d61 7279           summary
+0001e740: 5b6d 5f6b 6579 5d5b 2276 6973 6974 7322  [m_key]["visits"
+0001e750: 5d20 2b3d 2031 0d0a 2020 2020 2020 2020  ] += 1..        
+0001e760: 2020 2020 2020 2020 7669 7369 7420 3d20          visit = 
+0001e770: 7375 6d6d 6172 795b 6d5f 6b65 795d 5b22  summary[m_key]["
+0001e780: 7669 7369 7473 225d 0d0a 2020 2020 2020  visits"]..      
+0001e790: 2020 2020 2020 2020 2020 6d5f 6b65 7920            m_key 
+0001e7a0: 3d20 6d5f 6b65 7920 2b20 275f 7b30 7d27  = m_key + '_{0}'
+0001e7b0: 2e66 6f72 6d61 7428 7669 7369 7429 0d0a  .format(visit)..
+0001e7c0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+0001e7d0: 6d6d 6172 795b 6d5f 6b65 795d 203d 204f  mmary[m_key] = O
+0001e7e0: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
+0001e7f0: 2020 2020 2020 2020 2020 7375 6d6d 6172            summar
+0001e800: 795b 6d5f 6b65 795d 5b22 7669 7369 7473  y[m_key]["visits
+0001e810: 225d 203d 2030 0d0a 2020 2020 2020 2020  "] = 0..        
+0001e820: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
+0001e830: 795d 5b22 636c 6173 735f 6e61 6d65 225d  y]["class_name"]
+0001e840: 203d 206d 6f64 756c 652e 5f5f 636c 6173   = module.__clas
+0001e850: 735f 5f2e 5f5f 6e61 6d65 5f5f 0d0a 2020  s__.__name__..  
+0001e860: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0001e870: 6174 7472 286d 6f64 756c 652c 2027 6b65  attr(module, 'ke
+0001e880: 6570 5f6f 7574 7075 7427 293a 0d0a 2020  ep_output'):..  
+0001e890: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0001e8a0: 6d6d 6172 795b 6d5f 6b65 795d 5b22 6b65  mmary[m_key]["ke
+0001e8b0: 6570 5f6f 7574 7075 7422 5d20 3d20 6d6f  ep_output"] = mo
+0001e8c0: 6475 6c65 2e6b 6565 705f 6f75 7470 7574  dule.keep_output
+0001e8d0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0001e8e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0001e8f0: 2020 2020 2073 756d 6d61 7279 5b6d 5f6b       summary[m_k
+0001e900: 6579 5d5b 226b 6565 705f 6f75 7470 7574  ey]["keep_output
+0001e910: 225d 203d 2046 616c 7365 0d0a 2020 2020  "] = False..    
+0001e920: 2020 2020 2020 2020 696e 7075 7420 3d20          input = 
+0001e930: 6974 6572 6174 696f 6e5f 746f 6f6c 732e  iteration_tools.
+0001e940: 666c 6174 7465 6e28 5b69 6e70 7574 5d2c  flatten([input],
+0001e950: 2069 7465 7261 626c 655f 7479 7065 733d   iterable_types=
+0001e960: 286c 6973 742c 2074 7570 6c65 2929 0d0a  (list, tuple))..
+0001e970: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+0001e980: 7420 3d20 756e 7061 636b 5f73 696e 676c  t = unpack_singl
+0001e990: 6574 6f6e 285b 6974 656d 2066 6f72 2069  eton([item for i
+0001e9a0: 7465 6d20 696e 2069 6e70 7574 2069 6620  tem in input if 
+0001e9b0: 6974 656d 2069 7320 6e6f 7420 4e6f 6e65  item is not None
+0001e9c0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+0001e9d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001e9e0: 696e 7075 742c 2028 6c69 7374 2c20 7475  input, (list, tu
+0001e9f0: 706c 6529 2920 616e 6420 6c65 6e28 696e  ple)) and len(in
+0001ea00: 7075 7429 203e 2030 3a0d 0a20 2020 2020  put) > 0:..     
+0001ea10: 2020 2020 2020 2020 2020 2073 756d 6d61             summa
+0001ea20: 7279 5b6d 5f6b 6579 5d5b 2269 6e70 7574  ry[m_key]["input
+0001ea30: 5f73 6861 7065 225d 203d 206c 6973 7428  _shape"] = list(
+0001ea40: 696e 745f 7368 6170 6528 696e 7075 745b  int_shape(input[
+0001ea50: 305d 2929 0d0a 2020 2020 2020 2020 2020  0]))..          
+0001ea60: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0001ea70: 6528 696e 7075 742c 2064 6963 7429 2061  e(input, dict) a
+0001ea80: 6e64 206c 656e 2869 6e70 7574 2920 3e20  nd len(input) > 
+0001ea90: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0001eaa0: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
+0001eab0: 795d 5b22 696e 7075 745f 7368 6170 6522  y]["input_shape"
+0001eac0: 5d20 3d20 6c69 7374 2869 6e74 5f73 6861  ] = list(int_sha
+0001ead0: 7065 286c 6973 7428 696e 7075 742e 7661  pe(list(input.va
+0001eae0: 6c75 6573 2829 295b 305d 2929 0d0a 2020  lues())[0]))..  
+0001eaf0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+0001eb00: 735f 7465 6e73 6f72 2869 6e70 7574 293a  s_tensor(input):
+0001eb10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001eb20: 2020 7375 6d6d 6172 795b 6d5f 6b65 795d    summary[m_key]
+0001eb30: 5b22 696e 7075 745f 7368 6170 6522 5d20  ["input_shape"] 
+0001eb40: 3d20 6c69 7374 2869 6e74 5f73 6861 7065  = list(int_shape
+0001eb50: 2869 6e70 7574 2929 0d0a 2020 2020 2020  (input))..      
+0001eb60: 2020 2020 2020 6966 2022 696e 7075 745f        if "input_
+0001eb70: 7368 6170 6522 2069 6e20 7375 6d6d 6172  shape" in summar
+0001eb80: 795b 6d5f 6b65 795d 2061 6e64 206c 656e  y[m_key] and len
+0001eb90: 2873 756d 6d61 7279 5b6d 5f6b 6579 5d5b  (summary[m_key][
+0001eba0: 2269 6e70 7574 5f73 6861 7065 225d 2920  "input_shape"]) 
+0001ebb0: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+0001ebc0: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
+0001ebd0: 6b65 795d 5b22 696e 7075 745f 7368 6170  key]["input_shap
+0001ebe0: 6522 5d5b 305d 203d 2062 6174 6368 5f73  e"][0] = batch_s
+0001ebf0: 697a 650d 0a20 2020 2020 2020 2020 2020  ize..           
+0001ec00: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0001ec10: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0001ec20: 7574 7075 7420 3d20 6974 6572 6174 696f  utput = iteratio
+0001ec30: 6e5f 746f 6f6c 732e 666c 6174 7465 6e28  n_tools.flatten(
+0001ec40: 5b6f 7574 7075 745d 2c20 6974 6572 6162  [output], iterab
+0001ec50: 6c65 5f74 7970 6573 3d28 6c69 7374 2c20  le_types=(list, 
+0001ec60: 7475 706c 6529 290d 0a20 2020 2020 2020  tuple))..       
+0001ec70: 2020 2020 2020 2020 2020 2020 206f 7574               out
+0001ec80: 7075 7420 3d20 756e 7061 636b 5f73 696e  put = unpack_sin
+0001ec90: 676c 6574 6f6e 285b 6974 656d 2066 6f72  gleton([item for
+0001eca0: 2069 7465 6d20 696e 206f 7574 7075 7420   item in output 
+0001ecb0: 6966 2069 7465 6d20 6973 206e 6f74 204e  if item is not N
+0001ecc0: 6f6e 655d 290d 0a20 2020 2020 2020 2020  one])..         
+0001ecd0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0001ece0: 5f74 656e 736f 7228 6f75 7470 7574 293a  _tensor(output):
+0001ecf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ed00: 2020 2020 2020 2020 2020 7375 6d6d 6172            summar
+0001ed10: 795b 6d5f 6b65 795d 5b22 6f75 7470 7574  y[m_key]["output
+0001ed20: 5f73 6861 7065 225d 203d 2054 656e 736f  _shape"] = Tenso
+0001ed30: 7253 6861 7065 285b 6261 7463 685f 7369  rShape([batch_si
+0001ed40: 7a65 5d20 2b20 6c69 7374 2869 6e74 5f73  ze] + list(int_s
+0001ed50: 6861 7065 286f 7574 7075 7429 295b 313a  hape(output))[1:
+0001ed60: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0001ed70: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+0001ed80: 6e73 7461 6e63 6528 6f75 7470 7574 2c20  nstance(output, 
+0001ed90: 286c 6973 742c 2074 7570 6c65 2929 3a0d  (list, tuple)):.
+0001eda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001edb0: 2020 2020 2020 2020 2073 756d 6d61 7279           summary
+0001edc0: 5b6d 5f6b 6579 5d5b 226f 7574 7075 745f  [m_key]["output_
+0001edd0: 7368 6170 6522 5d20 3d20 5b54 656e 736f  shape"] = [Tenso
+0001ede0: 7253 6861 7065 285b 6261 7463 685f 7369  rShape([batch_si
+0001edf0: 7a65 5d20 2b20 6c69 7374 2869 6e74 5f73  ze] + list(int_s
+0001ee00: 6861 7065 2876 616c 7565 2929 5b31 3a5d  hape(value))[1:]
+0001ee10: 2920 666f 720d 0a20 2020 2020 2020 2020  ) for..         
+0001ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee50: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0001ee60: 6c75 6520 696e 206f 7574 7075 745d 0d0a  lue in output]..
-0001ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee80: 2020 2020 656c 6966 2069 735f 696e 7374      elif is_inst
-0001ee90: 616e 6365 286f 7574 7075 742c 2027 4f72  ance(output, 'Or
-0001eea0: 6465 7265 6444 6963 7427 293a 0d0a 2020  deredDict'):..  
-0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eec0: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001eed0: 6b65 795d 5b22 6f75 7470 7574 5f73 6861  key]["output_sha
-0001eee0: 7065 225d 203d 205b 5465 6e73 6f72 5368  pe"] = [TensorSh
-0001eef0: 6170 6528 5b62 6174 6368 5f73 697a 655d  ape([batch_size]
-0001ef00: 202b 206c 6973 7428 696e 745f 7368 6170   + list(int_shap
-0001ef10: 6528 7661 6c75 6529 295b 313a 5d29 2066  e(value))[1:]) f
-0001ef20: 6f72 0d0a 2020 2020 2020 2020 2020 2020  or..            
+0001ee50: 2076 616c 7565 2069 6e20 6f75 7470 7574   value in output
+0001ee60: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0001ee70: 2020 2020 2020 2065 6c69 6620 6973 5f69         elif is_i
+0001ee80: 6e73 7461 6e63 6528 6f75 7470 7574 2c20  nstance(output, 
+0001ee90: 274f 7264 6572 6564 4469 6374 2729 3a0d  'OrderedDict'):.
+0001eea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eeb0: 2020 2020 2020 2020 2073 756d 6d61 7279           summary
+0001eec0: 5b6d 5f6b 6579 5d5b 226f 7574 7075 745f  [m_key]["output_
+0001eed0: 7368 6170 6522 5d20 3d20 5b54 656e 736f  shape"] = [Tenso
+0001eee0: 7253 6861 7065 285b 6261 7463 685f 7369  rShape([batch_si
+0001eef0: 7a65 5d20 2b20 6c69 7374 2869 6e74 5f73  ze] + list(int_s
+0001ef00: 6861 7065 2876 616c 7565 2929 5b31 3a5d  hape(value))[1:]
+0001ef10: 2920 666f 720d 0a20 2020 2020 2020 2020  ) for..         
+0001ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef50: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0001ef60: 6c75 6520 696e 206c 6973 7428 6f75 7470  lue in list(outp
-0001ef70: 7574 2e76 616c 7565 7328 2929 5d0d 0a0d  ut.values())]...
-0001ef80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef90: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0001efa0: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
-0001efb0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001efc0: 6e74 2865 290d 0a0d 0a20 2020 2020 2020  nt(e)....       
-0001efd0: 2020 2020 2070 6172 616d 7320 3d20 300d       params = 0.
-0001efe0: 0a20 2020 2020 2020 2020 2020 2073 756d  .            sum
-0001eff0: 6d61 7279 5b6d 5f6b 6579 5d5b 2266 6c6f  mary[m_key]["flo
-0001f000: 7073 225d 203d 206e 702e 6172 7261 7928  ps"] = np.array(
-0001f010: 5b30 5d2c 2064 7479 7065 3d6e 702e 666c  [0], dtype=np.fl
-0001f020: 6f61 7436 3429 0d0a 2020 2020 2020 2020  oat64)..        
-0001f030: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
-0001f040: 795d 5b22 6d61 6363 225d 203d 206e 702e  y]["macc"] = np.
-0001f050: 6172 7261 7928 5b30 5d2c 2064 7479 7065  array([0], dtype
-0001f060: 3d6e 702e 666c 6f61 7436 3429 0d0a 2020  =np.float64)..  
-0001f070: 2020 2020 2020 2020 2020 7375 6d6d 6172            summar
-0001f080: 795b 6d5f 6b65 795d 5b22 7472 6169 6e61  y[m_key]["traina
-0001f090: 626c 6522 5d20 3d20 6e70 2e61 7272 6179  ble"] = np.array
-0001f0a0: 285b 305d 2c20 6474 7970 653d 6e70 2e66  ([0], dtype=np.f
-0001f0b0: 6c6f 6174 3634 290d 0a20 2020 2020 2020  loat64)..       
-0001f0c0: 2020 2020 2073 756d 6d61 7279 5b6d 5f6b       summary[m_k
-0001f0d0: 6579 5d5b 2277 6569 6768 7422 5d20 3d20  ey]["weight"] = 
-0001f0e0: 4f72 6465 7265 6444 6963 7428 290d 0a20  OrderedDict().. 
-0001f0f0: 2020 2020 2020 2020 2020 2073 756d 6d61             summa
-0001f100: 7279 5b6d 5f6b 6579 5d5b 2262 6961 7322  ry[m_key]["bias"
-0001f110: 5d20 3d20 4f72 6465 7265 6444 6963 7428  ] = OrderedDict(
-0001f120: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-0001f130: 6f72 206e 616d 652c 2070 6172 6120 696e  or name, para in
-0001f140: 206d 6f64 756c 652e 5f70 6172 616d 6574   module._paramet
-0001f150: 6572 732e 6974 656d 7328 293a 0d0a 2020  ers.items():..  
-0001f160: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001f170: 2070 6172 6120 6973 206e 6f74 204e 6f6e   para is not Non
-0001f180: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001f190: 2020 2020 2020 2020 7061 7261 5f74 7970          para_typ
-0001f1a0: 6520 3d20 2277 6569 6768 7422 0d0a 2020  e = "weight"..  
-0001f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1c0: 2020 6966 2027 6269 6173 2720 696e 206e    if 'bias' in n
-0001f1d0: 616d 6520 6f72 2027 6265 7461 2720 696e  ame or 'beta' in
-0001f1e0: 206e 616d 653a 0d0a 2020 2020 2020 2020   name:..        
-0001f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f200: 7061 7261 5f74 7970 6520 3d20 2262 6961  para_type = "bia
-0001f210: 7322 0d0a 0d0a 2020 2020 2020 2020 2020  s"....          
-0001f220: 2020 2020 2020 2020 2020 7375 6d6d 6172            summar
-0001f230: 795b 6d5f 6b65 795d 5b70 6172 615f 7479  y[m_key][para_ty
-0001f240: 7065 5d5b 6e61 6d65 5d20 3d20 6c69 7374  pe][name] = list
-0001f250: 2869 6e74 5f73 6861 7065 2870 6172 6129  (int_shape(para)
-0001f260: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001f270: 2020 2020 2020 206e 756d 5f70 6172 616d         num_param
-0001f280: 7320 3d20 6e70 2e70 726f 6428 6e70 2e61  s = np.prod(np.a
-0001f290: 7272 6179 286c 6973 7428 696e 745f 7368  rray(list(int_sh
-0001f2a0: 6170 6528 7061 7261 2929 2c20 6474 7970  ape(para)), dtyp
-0001f2b0: 653d 6e70 2e66 6c6f 6174 3634 2929 0d0a  e=np.float64))..
-0001f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2d0: 2020 2020 7370 6174 6961 6c5f 6469 6d73      spatial_dims
-0001f2e0: 203d 206e 702e 7072 6f64 286e 702e 6172   = np.prod(np.ar
-0001f2f0: 7261 7928 7375 6d6d 6172 795b 6d5f 6b65  ray(summary[m_ke
-0001f300: 795d 5b22 6f75 7470 7574 5f73 6861 7065  y]["output_shape
-0001f310: 225d 5b32 3a5d 292e 6173 7479 7065 286e  "][2:]).astype(n
-0001f320: 702e 666c 6f61 7436 3429 290d 0a20 2020  p.float64))..   
-0001f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f340: 2069 6620 6d6f 6475 6c65 2e72 656c 6174   if module.relat
-0001f350: 6976 655f 6e61 6d65 2069 6620 6861 7361  ive_name if hasa
-0001f360: 7474 7228 6d6f 6475 6c65 2c20 2772 656c  ttr(module, 'rel
-0001f370: 6174 6976 655f 6e61 6d65 2729 2065 6c73  ative_name') els
-0001f380: 6520 6d6f 6475 6c65 2e6e 616d 6520 3d3d  e module.name ==
-0001f390: 206d 5f6b 6579 2061 6e64 2073 756d 6d61   m_key and summa
-0001f3a0: 7279 5b6d 5f6b 6579 5d5b 2276 6973 6974  ry[m_key]["visit
-0001f3b0: 7322 5d20 3d3d 2030 3a0d 0a20 2020 2020  s"] == 0:..     
-0001f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3d0: 2020 2070 6172 616d 7320 2b3d 206e 756d     params += num
-0001f3e0: 5f70 6172 616d 730d 0a20 2020 2020 2020  _params..       
-0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f400: 2069 6620 7061 7261 2e72 6571 7569 7265   if para.require
-0001f410: 735f 6772 6164 3a0d 0a20 2020 2020 2020  s_grad:..       
-0001f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f430: 2020 2020 2073 756d 6d61 7279 5b6d 5f6b       summary[m_k
-0001f440: 6579 5d5b 2274 7261 696e 6162 6c65 225d  ey]["trainable"]
-0001f450: 202b 3d20 6e75 6d5f 7061 7261 6d73 0d0a   += num_params..
-0001f460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001f470: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001f480: 6b65 795d 5b22 666c 6f70 7322 5d20 2b3d  key]["flops"] +=
-0001f490: 2028 3220 2a20 6e75 6d5f 7061 7261 6d73   (2 * num_params
-0001f4a0: 202d 2031 2920 2a20 7370 6174 6961 6c5f   - 1) * spatial_
-0001f4b0: 6469 6d73 0d0a 2020 2020 2020 2020 2020  dims..          
-0001f4c0: 2020 2020 2020 2020 2020 7375 6d6d 6172            summar
-0001f4d0: 795b 6d5f 6b65 795d 5b22 6d61 6363 225d  y[m_key]["macc"]
-0001f4e0: 202b 3d20 6e75 6d5f 7061 7261 6d73 202a   += num_params *
-0001f4f0: 2073 7061 7469 616c 5f64 696d 730d 0a0d   spatial_dims...
-0001f500: 0a20 2020 2020 2020 2020 2020 2073 756d  .            sum
-0001f510: 6d61 7279 5b6d 5f6b 6579 5d5b 226e 625f  mary[m_key]["nb_
-0001f520: 7061 7261 6d73 225d 203d 2070 6172 616d  params"] = param
-0001f530: 730d 0a0d 0a20 2020 2020 2020 2069 6620  s....        if 
-0001f540: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0001f550: 2020 206e 6f74 2069 7369 6e73 7461 6e63     not isinstanc
-0001f560: 6528 6d6f 6475 6c65 2c20 286e 6e2e 5365  e(module, (nn.Se
-0001f570: 7175 656e 7469 616c 2c20 5365 7175 656e  quential, Sequen
-0001f580: 7469 616c 2c20 6e6e 2e4d 6f64 756c 654c  tial, nn.ModuleL
-0001f590: 6973 742c 204d 6f64 756c 654c 6973 7429  ist, ModuleList)
-0001f5a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001f5b0: 2020 2061 6e64 206e 6f74 2028 6d6f 6475     and not (modu
-0001f5c0: 6c65 203d 3d20 6d6f 6465 6c20 616e 6420  le == model and 
-0001f5d0: 6c65 6e28 6d6f 6475 6c65 2e5f 7061 7261  len(module._para
-0001f5e0: 6d65 7465 7273 2920 3d3d 2030 290d 0a20  meters) == 0).. 
-0001f5f0: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-0001f600: 2020 2020 2020 2068 6f6f 6b73 2e61 7070         hooks.app
-0001f610: 656e 6428 6d6f 6475 6c65 2e72 6567 6973  end(module.regis
-0001f620: 7465 725f 666f 7277 6172 645f 686f 6f6b  ter_forward_hook
-0001f630: 2868 6f6f 6b29 290d 0a0d 0a20 2020 2064  (hook))....    d
-0001f640: 6576 6963 6520 3d20 6465 7669 6365 2e6c  evice = device.l
-0001f650: 6f77 6572 2829 2069 6620 6973 696e 7374  ower() if isinst
-0001f660: 616e 6365 2864 6576 6963 652c 2073 7472  ance(device, str
-0001f670: 2920 656c 7365 2064 6576 6963 652e 5f5f  ) else device.__
-0001f680: 6e61 6d65 5f5f 0d0a 2020 2020 6173 7365  name__..    asse
-0001f690: 7274 2064 6576 6963 6520 696e 205b 0d0a  rt device in [..
-0001f6a0: 2020 2020 2020 2020 2263 7564 6122 2c0d          "cuda",.
-0001f6b0: 0a20 2020 2020 2020 2022 6370 7522 2c0d  .        "cpu",.
-0001f6c0: 0a20 2020 2020 2020 2022 7470 7522 2c0d  .        "tpu",.
-0001f6d0: 0a20 2020 2020 2020 2022 786c 6122 2c0d  .        "xla",.
-0001f6e0: 0a20 2020 205d 2c20 2249 6e70 7574 2064  .    ], "Input d
-0001f6f0: 6576 6963 6520 6973 206e 6f74 2076 616c  evice is not val
-0001f700: 6964 2c20 706c 6561 7365 2073 7065 6369  id, please speci
-0001f710: 6679 2027 6375 6461 2720 6f72 2027 6370  fy 'cuda' or 'cp
-0001f720: 7527 220d 0a0d 0a20 2020 2023 2069 6620  u'"....    # if 
-0001f730: 6465 7669 6365 203d 3d20 2263 7564 6122  device == "cuda"
-0001f740: 2061 6e64 2074 6f72 6368 2e63 7564 612e   and torch.cuda.
-0001f750: 6973 5f61 7661 696c 6162 6c65 2829 3a0d  is_available():.
-0001f760: 0a20 2020 2023 2020 2020 2064 7479 7065  .    #     dtype
-0001f770: 203d 2074 6f72 6368 2e63 7564 612e 466c   = torch.cuda.Fl
-0001f780: 6f61 7454 656e 736f 720d 0a20 2020 2023  oatTensor..    #
-0001f790: 2065 6c73 653a 0d0a 2020 2020 2320 2020   else:..    #   
-0001f7a0: 2020 6474 7970 6520 3d20 746f 7263 682e    dtype = torch.
-0001f7b0: 466c 6f61 7454 656e 736f 720d 0a0d 0a20  FloatTensor.... 
-0001f7c0: 2020 2066 6f72 206e 616d 652c 206d 6f64     for name, mod
-0001f7d0: 756c 6520 696e 206d 6f64 656c 2e6e 616d  ule in model.nam
-0001f7e0: 6564 5f6d 6f64 756c 6573 2829 3a0d 0a20  ed_modules():.. 
-0001f7f0: 2020 2020 2020 206d 6f64 756c 652e 7265         module.re
-0001f800: 6c61 7469 7665 5f6e 616d 6520 3d20 6e61  lative_name = na
-0001f810: 6d65 0d0a 2020 2020 2320 6d75 6c74 6970  me..    # multip
-0001f820: 6c65 2069 6e70 7574 7320 746f 2074 6865  le inputs to the
-0001f830: 206e 6574 776f 726b 0d0a 0d0a 2020 2020   network....    
-0001f840: 2320 7072 6576 656e 7420 7079 746f 7263  # prevent pytorc
-0001f850: 6820 2756 616c 7565 4572 726f 723a 2045  h 'ValueError: E
-0001f860: 7870 6563 7465 6420 6d6f 7265 2074 6861  xpected more tha
-0001f870: 6e20 3120 7661 6c75 6520 7065 7220 6368  n 1 value per ch
-0001f880: 616e 6e65 6c20 7768 656e 2074 7261 696e  annel when train
-0001f890: 696e 672c 2067 6f74 2069 6e70 7574 2073  ing, got input s
-0001f8a0: 697a 6520 2e2e 2e2e 0d0a 2020 2020 6d6f  ize ......    mo
-0001f8b0: 6465 6c2e 746f 2867 6574 5f64 6576 6963  del.to(get_devic
-0001f8c0: 6528 2929 0d0a 2020 2020 6d6f 6465 6c2e  e())..    model.
-0001f8d0: 6576 616c 2829 0d0a 0d0a 2020 2020 2320  eval()....    # 
-0001f8e0: 6261 7463 685f 7369 7a65 206f 6620 3220  batch_size of 2 
-0001f8f0: 666f 7220 6261 7463 686e 6f72 6d0d 0a20  for batchnorm.. 
-0001f900: 2020 2023 2069 6620 6d6f 6475 6c65 2e73     # if module.s
-0001f910: 6967 6e61 7475 7265 2069 7320 6e6f 7420  ignature is not 
-0001f920: 4e6f 6e65 3a0d 0a20 2020 2023 2020 2020  None:..    #    
-0001f930: 2069 6e70 7574 5f74 656e 736f 7220 3d20   input_tensor = 
-0001f940: 5b74 6f5f 7465 6e73 6f72 286d 6f64 756c  [to_tensor(modul
-0001f950: 652e 7369 676e 6174 7572 652e 696e 7075  e.signature.inpu
-0001f960: 7473 2e76 616c 7565 5f6c 6973 745b 6b5d  ts.value_list[k]
-0001f970: 2e67 6574 5f64 756d 6d79 5f74 656e 736f  .get_dummy_tenso
-0001f980: 7228 2929 2066 6f72 206b 2069 6e20 2072  r()) for k in  r
-0001f990: 616e 6765 286d 6f64 756c 652e 7369 676e  ange(module.sign
-0001f9a0: 6174 7572 652e 696e 7075 7473 2e76 616c  ature.inputs.val
-0001f9b0: 7565 5f6c 6973 7429 2069 6620 6e6f 7420  ue_list) if not 
-0001f9c0: 6d6f 6475 6c65 2e73 6967 6e61 7475 7265  module.signature
-0001f9d0: 2e69 6e70 7574 732e 7661 6c75 655f 6c69  .inputs.value_li
-0001f9e0: 7374 5b6b 5d2e 6f70 7469 6f6e 616c 206f  st[k].optional o
-0001f9f0: 7220 6b3d 3d30 5d0d 0a20 2020 2023 0d0a  r k==0]..    #..
-0001fa00: 2020 2020 696e 7073 203d 204f 7264 6572      inps = Order
-0001fa10: 6564 4469 6374 2829 0d0a 0d0a 2020 2020  edDict()....    
-0001fa20: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-0001fa30: 656e 2869 6e70 7574 5f73 7065 6373 2929  en(input_specs))
-0001fa40: 3a0d 0a20 2020 2020 2020 2076 203d 2069  :..        v = i
-0001fa50: 6e70 7574 5f73 7065 6373 5b69 5d0d 0a20  nput_specs[i].. 
-0001fa60: 2020 2020 2020 206b 203d 2076 2e6e 616d         k = v.nam
-0001fa70: 6520 6966 2076 2e6e 616d 6520 6973 206e  e if v.name is n
-0001fa80: 6f74 204e 6f6e 6520 656c 7365 2027 696e  ot None else 'in
-0001fa90: 7075 7427 2069 6620 6c65 6e28 696e 7075  put' if len(inpu
-0001faa0: 745f 7370 6563 7329 203d 3d20 3120 656c  t_specs) == 1 el
-0001fab0: 7365 2027 696e 7075 745f 7b30 7d27 2e66  se 'input_{0}'.f
-0001fac0: 6f72 6d61 7428 6929 0d0a 2020 2020 2020  ormat(i)..      
-0001fad0: 2020 6966 2076 2e73 6861 7065 2069 7320    if v.shape is 
-0001fae0: 6e6f 7420 4e6f 6e65 2061 6e64 2076 2e73  not None and v.s
-0001faf0: 6861 7065 2e5f 6469 6d73 2021 3d20 5b4e  hape._dims != [N
-0001fb00: 6f6e 655d 3a0d 0a20 2020 2020 2020 2020  one]:..         
-0001fb10: 2020 2069 6e70 735b 6b5d 203d 2074 6f5f     inps[k] = to_
-0001fb20: 7465 6e73 6f72 2876 2e67 6574 5f64 756d  tensor(v.get_dum
-0001fb30: 6d79 5f74 656e 736f 7228 292c 2064 6576  my_tensor(), dev
-0001fb40: 6963 653d 6765 745f 6465 7669 6365 2829  ice=get_device()
-0001fb50: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0001fb60: 762e 6f70 7469 6f6e 616c 3a0d 0a20 2020  v.optional:..   
-0001fb70: 2020 2020 2020 2020 2069 6e70 735b 6b5d           inps[k]
-0001fb80: 203d 2076 2e64 6566 6175 6c74 0d0a 2020   = v.default..  
-0001fb90: 2020 2020 2020 656c 6966 2076 2e73 6861        elif v.sha
-0001fba0: 7065 2069 7320 4e6f 6e65 3a0d 0a20 2020  pe is None:..   
-0001fbb0: 2020 2020 2020 2020 2069 6e70 735b 6b5d           inps[k]
-0001fbc0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0001fbd0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0001fbe0: 2020 2020 696e 7073 5b6b 5d20 3d20 4e6f      inps[k] = No
-0001fbf0: 6e65 0d0a 0d0a 2020 2020 2320 7820 3d20  ne....    # x = 
-0001fc00: 5b74 6f5f 7465 6e73 6f72 2869 6e70 735b  [to_tensor(inps[
-0001fc10: 6e5d 2e67 6574 5f64 756d 6d79 5f74 656e  n].get_dummy_ten
-0001fc20: 736f 7228 292c 6465 7669 6365 3d67 6574  sor(),device=get
-0001fc30: 5f64 6576 6963 6528 2929 2020 666f 7220  _device())  for 
-0001fc40: 6e20 696e 2072 616e 6765 286c 656e 2869  n in range(len(i
-0001fc50: 6e70 7329 2920 6966 2069 6e70 735b 6e5d  nps)) if inps[n]
-0001fc60: 2e6f 7074 696f 6e61 6c20 3d3d 2046 616c  .optional == Fal
-0001fc70: 7365 206f 7220 2069 6e70 735b 6e5d 2e73  se or  inps[n].s
-0001fc80: 6861 7065 2e5f 6469 6d73 213d 5b4e 6f6e  hape._dims!=[Non
-0001fc90: 655d 5d0d 0a20 2020 2023 2070 2020 2020  e]]..    # p    
-0001fca0: 7269 6e74 2874 7970 6528 785b 305d 2929  rint(type(x[0]))
-0001fcb0: 0d0a 0d0a 2020 2020 2320 6372 6561 7465  ....    # create
-0001fcc0: 2070 726f 7065 7274 6965 730d 0a20 2020   properties..   
-0001fcd0: 2073 756d 6d61 7279 203d 204f 7264 6572   summary = Order
-0001fce0: 6564 4469 6374 2829 0d0a 2020 2020 686f  edDict()..    ho
-0001fcf0: 6f6b 7320 3d20 5b5d 0d0a 2020 2020 7472  oks = []..    tr
-0001fd00: 793a 0d0a 2020 2020 2020 2020 2320 7265  y:..        # re
-0001fd10: 6769 7374 6572 2068 6f6f 6b0d 0a20 2020  gister hook..   
-0001fd20: 2020 2020 206d 6f64 656c 2e61 7070 6c79       model.apply
-0001fd30: 2872 6567 6973 7465 725f 686f 6f6b 290d  (register_hook).
-0001fd40: 0a0d 0a20 2020 2020 2020 2023 206d 616b  ...        # mak
-0001fd50: 6520 6120 666f 7277 6172 6420 7061 7373  e a forward pass
-0001fd60: 0d0a 2020 2020 2020 2020 2320 7072 696e  ..        # prin
-0001fd70: 7428 782e 7368 6170 6529 0d0a 2020 2020  t(x.shape)..    
-0001fd80: 2020 2020 6966 2069 6e70 7574 7320 6973      if inputs is
-0001fd90: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0001fda0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0001fdb0: 7461 6e63 6528 696e 7075 7473 2c20 4f72  tance(inputs, Or
-0001fdc0: 6465 7265 6444 6963 7429 3a0d 0a20 2020  deredDict):..   
-0001fdd0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0001fde0: 656c 282a 6c69 7374 2869 6e70 732e 7661  el(*list(inps.va
-0001fdf0: 6c75 6573 2829 2929 0d0a 2020 2020 2020  lues()))..      
-0001fe00: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0001fe10: 7461 6e63 6528 696e 7075 7473 2c20 2854  tance(inputs, (T
-0001fe20: 656e 736f 722c 206e 702e 6e64 6172 7261  ensor, np.ndarra
-0001fe30: 7929 293a 0d0a 2020 2020 2020 2020 2020  y)):..          
-0001fe40: 2020 2020 2020 6d6f 6465 6c28 696e 7075        model(inpu
-0001fe50: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
-0001fe60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0001fe70: 2020 2020 2020 2020 6d6f 6465 6c28 2a69          model(*i
-0001fe80: 6e70 7574 7329 0d0a 2020 2020 2020 2020  nputs)..        
-0001fe90: 656c 7365 3a0d 0a0d 0a20 2020 2020 2020  else:....       
-0001fea0: 2020 2020 206d 6f64 656c 282a 696e 7073       model(*inps
-0001feb0: 2e76 616c 7565 5f6c 6973 7429 0d0a 0d0a  .value_list)....
-0001fec0: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
-0001fed0: 2074 6865 7365 2068 6f6f 6b73 0d0a 2020   these hooks..  
-0001fee0: 2020 2020 2020 666f 7220 6820 696e 2068        for h in h
-0001fef0: 6f6f 6b73 3a0d 0a20 2020 2020 2020 2020  ooks:..         
-0001ff00: 2020 2068 2e72 656d 6f76 6528 290d 0a20     h.remove().. 
-0001ff10: 2020 2020 2020 206d 6178 5f6e 616d 655f         max_name_
-0001ff20: 6c65 6e20 3d20 300d 0a20 2020 2020 2020  len = 0..       
-0001ff30: 206d 6178 5f77 6569 6768 745f 6c65 6e20   max_weight_len 
-0001ff40: 3d20 300d 0a20 2020 2020 2020 2066 6f72  = 0..        for
-0001ff50: 206c 6179 6572 2069 6e20 7375 6d6d 6172   layer in summar
-0001ff60: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0001ff70: 6d61 785f 6e61 6d65 5f6c 656e 203d 2062  max_name_len = b
-0001ff80: 7569 6c74 696e 732e 6d61 7828 6d61 785f  uiltins.max(max_
-0001ff90: 6e61 6d65 5f6c 656e 2c20 6c65 6e28 6c61  name_len, len(la
-0001ffa0: 7965 7220 2b20 2220 205b 2220 2b20 7375  yer + "  [" + su
-0001ffb0: 6d6d 6172 795b 6c61 7965 725d 5b22 636c  mmary[layer]["cl
-0001ffc0: 6173 735f 6e61 6d65 225d 202b 2022 5d22  ass_name"] + "]"
-0001ffd0: 2920 2b20 3529 0d0a 2020 2020 2020 2020  ) + 5)..        
-0001ffe0: 2020 2020 6d61 785f 7765 6967 6874 5f6c      max_weight_l
-0001fff0: 656e 203d 2062 7569 6c74 696e 732e 6d61  en = builtins.ma
-00020000: 7828 6d61 785f 7765 6967 6874 5f6c 656e  x(max_weight_len
-00020010: 2c20 6275 696c 7469 6e73 2e6d 6178 280d  , builtins.max(.
-00020020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020030: 205b 6c65 6e28 7374 7228 6974 656d 292e   [len(str(item).
-00020040: 7265 706c 6163 6528 2728 272c 2027 2729  replace('(', '')
-00020050: 2e72 6570 6c61 6365 2827 2927 2c20 2727  .replace(')', ''
-00020060: 2929 2066 6f72 2069 7465 6d20 696e 0d0a  )) for item in..
-00020070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020080: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
-00020090: 2277 6569 6768 7422 5d2e 6974 656d 7328  "weight"].items(
-000200a0: 295d 2920 2b20 3520 6966 206c 656e 280d  )]) + 5 if len(.
-000200b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000200c0: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
-000200d0: 2277 6569 6768 7422 5d29 203e 2030 2065  "weight"]) > 0 e
-000200e0: 6c73 6520 3529 0d0a 0d0a 2020 2020 2020  lse 5)....      
-000200f0: 2020 7072 696e 7428 0d0a 2020 2020 2020    print(..      
-00020100: 2020 2020 2020 222d 2d2d 2d2d 2d2d 2d2d        "---------
+0001ef50: 2076 616c 7565 2069 6e20 6c69 7374 286f   value in list(o
+0001ef60: 7574 7075 742e 7661 6c75 6573 2829 295d  utput.values())]
+0001ef70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0001ef80: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0001ef90: 7469 6f6e 2061 7320 653a 0d0a 2020 2020  tion as e:..    
+0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efb0: 7072 696e 7428 6529 0d0a 0d0a 2020 2020  print(e)....    
+0001efc0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0001efd0: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
+0001efe0: 7375 6d6d 6172 795b 6d5f 6b65 795d 5b22  summary[m_key]["
+0001eff0: 666c 6f70 7322 5d20 3d20 6e70 2e61 7272  flops"] = np.arr
+0001f000: 6179 285b 305d 2c20 6474 7970 653d 6e70  ay([0], dtype=np
+0001f010: 2e66 6c6f 6174 3634 290d 0a20 2020 2020  .float64)..     
+0001f020: 2020 2020 2020 2073 756d 6d61 7279 5b6d         summary[m
+0001f030: 5f6b 6579 5d5b 226d 6163 6322 5d20 3d20  _key]["macc"] = 
+0001f040: 6e70 2e61 7272 6179 285b 305d 2c20 6474  np.array([0], dt
+0001f050: 7970 653d 6e70 2e66 6c6f 6174 3634 290d  ype=np.float64).
+0001f060: 0a20 2020 2020 2020 2020 2020 2073 756d  .            sum
+0001f070: 6d61 7279 5b6d 5f6b 6579 5d5b 2274 7261  mary[m_key]["tra
+0001f080: 696e 6162 6c65 225d 203d 206e 702e 6172  inable"] = np.ar
+0001f090: 7261 7928 5b30 5d2c 2064 7479 7065 3d6e  ray([0], dtype=n
+0001f0a0: 702e 666c 6f61 7436 3429 0d0a 2020 2020  p.float64)..    
+0001f0b0: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
+0001f0c0: 6d5f 6b65 795d 5b22 7765 6967 6874 225d  m_key]["weight"]
+0001f0d0: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
+0001f0e0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+0001f0f0: 6d6d 6172 795b 6d5f 6b65 795d 5b22 6269  mmary[m_key]["bi
+0001f100: 6173 225d 203d 204f 7264 6572 6564 4469  as"] = OrderedDi
+0001f110: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
+0001f120: 2020 666f 7220 6e61 6d65 2c20 7061 7261    for name, para
+0001f130: 2069 6e20 6d6f 6475 6c65 2e5f 7061 7261   in module._para
+0001f140: 6d65 7465 7273 2e69 7465 6d73 2829 3a0d  meters.items():.
+0001f150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f160: 2069 6620 7061 7261 2069 7320 6e6f 7420   if para is not 
+0001f170: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0001f180: 2020 2020 2020 2020 2020 2070 6172 615f             para_
+0001f190: 7479 7065 203d 2022 7765 6967 6874 220d  type = "weight".
+0001f1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f1b0: 2020 2020 2069 6620 2762 6961 7327 2069       if 'bias' i
+0001f1c0: 6e20 6e61 6d65 206f 7220 2762 6574 6127  n name or 'beta'
+0001f1d0: 2069 6e20 6e61 6d65 3a0d 0a20 2020 2020   in name:..     
+0001f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1f0: 2020 2070 6172 615f 7479 7065 203d 2022     para_type = "
+0001f200: 6269 6173 220d 0a0d 0a20 2020 2020 2020  bias"....       
+0001f210: 2020 2020 2020 2020 2020 2020 2073 756d               sum
+0001f220: 6d61 7279 5b6d 5f6b 6579 5d5b 7061 7261  mary[m_key][para
+0001f230: 5f74 7970 655d 5b6e 616d 655d 203d 206c  _type][name] = l
+0001f240: 6973 7428 696e 745f 7368 6170 6528 7061  ist(int_shape(pa
+0001f250: 7261 2929 0d0a 2020 2020 2020 2020 2020  ra))..          
+0001f260: 2020 2020 2020 2020 2020 6e75 6d5f 7061            num_pa
+0001f270: 7261 6d73 203d 206e 702e 7072 6f64 286e  rams = np.prod(n
+0001f280: 702e 6172 7261 7928 6c69 7374 2869 6e74  p.array(list(int
+0001f290: 5f73 6861 7065 2870 6172 6129 292c 2064  _shape(para)), d
+0001f2a0: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
+0001f2b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001f2c0: 2020 2020 2020 2073 7061 7469 616c 5f64         spatial_d
+0001f2d0: 696d 7320 3d20 6e70 2e70 726f 6428 6e70  ims = np.prod(np
+0001f2e0: 2e61 7272 6179 2873 756d 6d61 7279 5b6d  .array(summary[m
+0001f2f0: 5f6b 6579 5d5b 226f 7574 7075 745f 7368  _key]["output_sh
+0001f300: 6170 6522 5d5b 323a 5d29 2e61 7374 7970  ape"][2:]).astyp
+0001f310: 6528 6e70 2e66 6c6f 6174 3634 2929 0d0a  e(np.float64))..
+0001f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f330: 2020 2020 6966 206d 6f64 756c 652e 7265      if module.re
+0001f340: 6c61 7469 7665 5f6e 616d 6520 6966 2068  lative_name if h
+0001f350: 6173 6174 7472 286d 6f64 756c 652c 2027  asattr(module, '
+0001f360: 7265 6c61 7469 7665 5f6e 616d 6527 2920  relative_name') 
+0001f370: 656c 7365 206d 6f64 756c 652e 6e61 6d65  else module.name
+0001f380: 203d 3d20 6d5f 6b65 7920 616e 6420 7375   == m_key and su
+0001f390: 6d6d 6172 795b 6d5f 6b65 795d 5b22 7669  mmary[m_key]["vi
+0001f3a0: 7369 7473 225d 203d 3d20 303a 0d0a 2020  sits"] == 0:..  
+0001f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3c0: 2020 2020 2020 7061 7261 6d73 202b 3d20        params += 
+0001f3d0: 6e75 6d5f 7061 7261 6d73 0d0a 2020 2020  num_params..    
+0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3f0: 2020 2020 6966 2070 6172 612e 7265 7175      if para.requ
+0001f400: 6972 6573 5f67 7261 643a 0d0a 2020 2020  ires_grad:..    
+0001f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f420: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
+0001f430: 6d5f 6b65 795d 5b22 7472 6169 6e61 626c  m_key]["trainabl
+0001f440: 6522 5d20 2b3d 206e 756d 5f70 6172 616d  e"] += num_param
+0001f450: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
+0001f460: 2020 2020 2020 2020 2073 756d 6d61 7279           summary
+0001f470: 5b6d 5f6b 6579 5d5b 2266 6c6f 7073 225d  [m_key]["flops"]
+0001f480: 202b 3d20 2832 202a 206e 756d 5f70 6172   += (2 * num_par
+0001f490: 616d 7320 2d20 3129 202a 2073 7061 7469  ams - 1) * spati
+0001f4a0: 616c 5f64 696d 730d 0a20 2020 2020 2020  al_dims..       
+0001f4b0: 2020 2020 2020 2020 2020 2020 2073 756d               sum
+0001f4c0: 6d61 7279 5b6d 5f6b 6579 5d5b 226d 6163  mary[m_key]["mac
+0001f4d0: 6322 5d20 2b3d 206e 756d 5f70 6172 616d  c"] += num_param
+0001f4e0: 7320 2a20 7370 6174 6961 6c5f 6469 6d73  s * spatial_dims
+0001f4f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0001f500: 7375 6d6d 6172 795b 6d5f 6b65 795d 5b22  summary[m_key]["
+0001f510: 6e62 5f70 6172 616d 7322 5d20 3d20 7061  nb_params"] = pa
+0001f520: 7261 6d73 0d0a 0d0a 2020 2020 2020 2020  rams....        
+0001f530: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
+0001f540: 2020 2020 2020 6e6f 7420 6973 696e 7374        not isinst
+0001f550: 616e 6365 286d 6f64 756c 652c 2028 6e6e  ance(module, (nn
+0001f560: 2e53 6571 7565 6e74 6961 6c2c 2053 6571  .Sequential, Seq
+0001f570: 7565 6e74 6961 6c2c 206e 6e2e 4d6f 6475  uential, nn.Modu
+0001f580: 6c65 4c69 7374 2c20 4d6f 6475 6c65 4c69  leList, ModuleLi
+0001f590: 7374 2929 0d0a 2020 2020 2020 2020 2020  st))..          
+0001f5a0: 2020 2020 2020 616e 6420 6e6f 7420 286d        and not (m
+0001f5b0: 6f64 756c 6520 3d3d 206d 6f64 656c 2061  odule == model a
+0001f5c0: 6e64 206c 656e 286d 6f64 756c 652e 5f70  nd len(module._p
+0001f5d0: 6172 616d 6574 6572 7329 203d 3d20 3029  arameters) == 0)
+0001f5e0: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
+0001f5f0: 2020 2020 2020 2020 2020 686f 6f6b 732e            hooks.
+0001f600: 6170 7065 6e64 286d 6f64 756c 652e 7265  append(module.re
+0001f610: 6769 7374 6572 5f66 6f72 7761 7264 5f68  gister_forward_h
+0001f620: 6f6f 6b28 686f 6f6b 2929 0d0a 0d0a 2020  ook(hook))....  
+0001f630: 2020 6465 7669 6365 203d 2064 6576 6963    device = devic
+0001f640: 652e 6c6f 7765 7228 2920 6966 2069 7369  e.lower() if isi
+0001f650: 6e73 7461 6e63 6528 6465 7669 6365 2c20  nstance(device, 
+0001f660: 7374 7229 2065 6c73 6520 6465 7669 6365  str) else device
+0001f670: 2e5f 5f6e 616d 655f 5f0d 0a20 2020 2061  .__name__..    a
+0001f680: 7373 6572 7420 6465 7669 6365 2069 6e20  ssert device in 
+0001f690: 5b0d 0a20 2020 2020 2020 2022 6375 6461  [..        "cuda
+0001f6a0: 222c 0d0a 2020 2020 2020 2020 2263 7075  ",..        "cpu
+0001f6b0: 222c 0d0a 2020 2020 2020 2020 2274 7075  ",..        "tpu
+0001f6c0: 222c 0d0a 2020 2020 2020 2020 2278 6c61  ",..        "xla
+0001f6d0: 222c 0d0a 2020 2020 5d2c 2022 496e 7075  ",..    ], "Inpu
+0001f6e0: 7420 6465 7669 6365 2069 7320 6e6f 7420  t device is not 
+0001f6f0: 7661 6c69 642c 2070 6c65 6173 6520 7370  valid, please sp
+0001f700: 6563 6966 7920 2763 7564 6127 206f 7220  ecify 'cuda' or 
+0001f710: 2763 7075 2722 0d0a 0d0a 2020 2020 2320  'cpu'"....    # 
+0001f720: 6966 2064 6576 6963 6520 3d3d 2022 6375  if device == "cu
+0001f730: 6461 2220 616e 6420 746f 7263 682e 6375  da" and torch.cu
+0001f740: 6461 2e69 735f 6176 6169 6c61 626c 6528  da.is_available(
+0001f750: 293a 0d0a 2020 2020 2320 2020 2020 6474  ):..    #     dt
+0001f760: 7970 6520 3d20 746f 7263 682e 6375 6461  ype = torch.cuda
+0001f770: 2e46 6c6f 6174 5465 6e73 6f72 0d0a 2020  .FloatTensor..  
+0001f780: 2020 2320 656c 7365 3a0d 0a20 2020 2023    # else:..    #
+0001f790: 2020 2020 2064 7479 7065 203d 2074 6f72       dtype = tor
+0001f7a0: 6368 2e46 6c6f 6174 5465 6e73 6f72 0d0a  ch.FloatTensor..
+0001f7b0: 0d0a 2020 2020 666f 7220 6e61 6d65 2c20  ..    for name, 
+0001f7c0: 6d6f 6475 6c65 2069 6e20 6d6f 6465 6c2e  module in model.
+0001f7d0: 6e61 6d65 645f 6d6f 6475 6c65 7328 293a  named_modules():
+0001f7e0: 0d0a 2020 2020 2020 2020 6d6f 6475 6c65  ..        module
+0001f7f0: 2e72 656c 6174 6976 655f 6e61 6d65 203d  .relative_name =
+0001f800: 206e 616d 650d 0a20 2020 2023 206d 756c   name..    # mul
+0001f810: 7469 706c 6520 696e 7075 7473 2074 6f20  tiple inputs to 
+0001f820: 7468 6520 6e65 7477 6f72 6b0d 0a0d 0a20  the network.... 
+0001f830: 2020 2023 2070 7265 7665 6e74 2070 7974     # prevent pyt
+0001f840: 6f72 6368 2027 5661 6c75 6545 7272 6f72  orch 'ValueError
+0001f850: 3a20 4578 7065 6374 6564 206d 6f72 6520  : Expected more 
+0001f860: 7468 616e 2031 2076 616c 7565 2070 6572  than 1 value per
+0001f870: 2063 6861 6e6e 656c 2077 6865 6e20 7472   channel when tr
+0001f880: 6169 6e69 6e67 2c20 676f 7420 696e 7075  aining, got inpu
+0001f890: 7420 7369 7a65 202e 2e2e 2e0d 0a20 2020  t size ......   
+0001f8a0: 206d 6f64 656c 2e74 6f28 6765 745f 6465   model.to(get_de
+0001f8b0: 7669 6365 2829 290d 0a20 2020 206d 6f64  vice())..    mod
+0001f8c0: 656c 2e65 7661 6c28 290d 0a0d 0a20 2020  el.eval()....   
+0001f8d0: 2023 2062 6174 6368 5f73 697a 6520 6f66   # batch_size of
+0001f8e0: 2032 2066 6f72 2062 6174 6368 6e6f 726d   2 for batchnorm
+0001f8f0: 0d0a 2020 2020 2320 6966 206d 6f64 756c  ..    # if modul
+0001f900: 652e 7369 676e 6174 7572 6520 6973 206e  e.signature is n
+0001f910: 6f74 204e 6f6e 653a 0d0a 2020 2020 2320  ot None:..    # 
+0001f920: 2020 2020 696e 7075 745f 7465 6e73 6f72      input_tensor
+0001f930: 203d 205b 746f 5f74 656e 736f 7228 6d6f   = [to_tensor(mo
+0001f940: 6475 6c65 2e73 6967 6e61 7475 7265 2e69  dule.signature.i
+0001f950: 6e70 7574 732e 7661 6c75 655f 6c69 7374  nputs.value_list
+0001f960: 5b6b 5d2e 6765 745f 6475 6d6d 795f 7465  [k].get_dummy_te
+0001f970: 6e73 6f72 2829 2920 666f 7220 6b20 696e  nsor()) for k in
+0001f980: 2020 7261 6e67 6528 6d6f 6475 6c65 2e73    range(module.s
+0001f990: 6967 6e61 7475 7265 2e69 6e70 7574 732e  ignature.inputs.
+0001f9a0: 7661 6c75 655f 6c69 7374 2920 6966 206e  value_list) if n
+0001f9b0: 6f74 206d 6f64 756c 652e 7369 676e 6174  ot module.signat
+0001f9c0: 7572 652e 696e 7075 7473 2e76 616c 7565  ure.inputs.value
+0001f9d0: 5f6c 6973 745b 6b5d 2e6f 7074 696f 6e61  _list[k].optiona
+0001f9e0: 6c20 6f72 206b 3d3d 305d 0d0a 2020 2020  l or k==0]..    
+0001f9f0: 230d 0a20 2020 2069 6e70 7320 3d20 4f72  #..    inps = Or
+0001fa00: 6465 7265 6444 6963 7428 290d 0a0d 0a20  deredDict().... 
+0001fa10: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+0001fa20: 6528 6c65 6e28 696e 7075 745f 7370 6563  e(len(input_spec
+0001fa30: 7329 293a 0d0a 2020 2020 2020 2020 7620  s)):..        v 
+0001fa40: 3d20 696e 7075 745f 7370 6563 735b 695d  = input_specs[i]
+0001fa50: 0d0a 2020 2020 2020 2020 6b20 3d20 762e  ..        k = v.
+0001fa60: 6e61 6d65 2069 6620 762e 6e61 6d65 2069  name if v.name i
+0001fa70: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+0001fa80: 2769 6e70 7574 2720 6966 206c 656e 2869  'input' if len(i
+0001fa90: 6e70 7574 5f73 7065 6373 2920 3d3d 2031  nput_specs) == 1
+0001faa0: 2065 6c73 6520 2769 6e70 7574 5f7b 307d   else 'input_{0}
+0001fab0: 272e 666f 726d 6174 2869 290d 0a20 2020  '.format(i)..   
+0001fac0: 2020 2020 2069 6620 762e 7368 6170 6520       if v.shape 
+0001fad0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0001fae0: 762e 7368 6170 652e 5f64 696d 7320 213d  v.shape._dims !=
+0001faf0: 205b 4e6f 6e65 5d3a 0d0a 2020 2020 2020   [None]:..      
+0001fb00: 2020 2020 2020 696e 7073 5b6b 5d20 3d20        inps[k] = 
+0001fb10: 746f 5f74 656e 736f 7228 762e 6765 745f  to_tensor(v.get_
+0001fb20: 6475 6d6d 795f 7465 6e73 6f72 2829 2c20  dummy_tensor(), 
+0001fb30: 6465 7669 6365 3d67 6574 5f64 6576 6963  device=get_devic
+0001fb40: 6528 2929 0d0a 2020 2020 2020 2020 656c  e())..        el
+0001fb50: 6966 2076 2e6f 7074 696f 6e61 6c3a 0d0a  if v.optional:..
+0001fb60: 2020 2020 2020 2020 2020 2020 696e 7073              inps
+0001fb70: 5b6b 5d20 3d20 762e 6465 6661 756c 740d  [k] = v.default.
+0001fb80: 0a20 2020 2020 2020 2065 6c69 6620 762e  .        elif v.
+0001fb90: 7368 6170 6520 6973 204e 6f6e 653a 0d0a  shape is None:..
+0001fba0: 2020 2020 2020 2020 2020 2020 696e 7073              inps
+0001fbb0: 5b6b 5d20 3d20 4e6f 6e65 0d0a 2020 2020  [k] = None..    
+0001fbc0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001fbd0: 2020 2020 2020 2069 6e70 735b 6b5d 203d         inps[k] =
+0001fbe0: 204e 6f6e 650d 0a0d 0a20 2020 2023 2078   None....    # x
+0001fbf0: 203d 205b 746f 5f74 656e 736f 7228 696e   = [to_tensor(in
+0001fc00: 7073 5b6e 5d2e 6765 745f 6475 6d6d 795f  ps[n].get_dummy_
+0001fc10: 7465 6e73 6f72 2829 2c64 6576 6963 653d  tensor(),device=
+0001fc20: 6765 745f 6465 7669 6365 2829 2920 2066  get_device())  f
+0001fc30: 6f72 206e 2069 6e20 7261 6e67 6528 6c65  or n in range(le
+0001fc40: 6e28 696e 7073 2929 2069 6620 696e 7073  n(inps)) if inps
+0001fc50: 5b6e 5d2e 6f70 7469 6f6e 616c 203d 3d20  [n].optional == 
+0001fc60: 4661 6c73 6520 6f72 2020 696e 7073 5b6e  False or  inps[n
+0001fc70: 5d2e 7368 6170 652e 5f64 696d 7321 3d5b  ].shape._dims!=[
+0001fc80: 4e6f 6e65 5d5d 0d0a 2020 2020 2320 7020  None]]..    # p 
+0001fc90: 2020 2072 696e 7428 7479 7065 2878 5b30     rint(type(x[0
+0001fca0: 5d29 290d 0a0d 0a20 2020 2023 2063 7265  ]))....    # cre
+0001fcb0: 6174 6520 7072 6f70 6572 7469 6573 0d0a  ate properties..
+0001fcc0: 2020 2020 7375 6d6d 6172 7920 3d20 4f72      summary = Or
+0001fcd0: 6465 7265 6444 6963 7428 290d 0a20 2020  deredDict()..   
+0001fce0: 2068 6f6f 6b73 203d 205b 5d0d 0a20 2020   hooks = []..   
+0001fcf0: 2074 7279 3a0d 0a20 2020 2020 2020 2023   try:..        #
+0001fd00: 2072 6567 6973 7465 7220 686f 6f6b 0d0a   register hook..
+0001fd10: 2020 2020 2020 2020 6d6f 6465 6c2e 6170          model.ap
+0001fd20: 706c 7928 7265 6769 7374 6572 5f68 6f6f  ply(register_hoo
+0001fd30: 6b29 0d0a 0d0a 2020 2020 2020 2020 2320  k)....        # 
+0001fd40: 6d61 6b65 2061 2066 6f72 7761 7264 2070  make a forward p
+0001fd50: 6173 730d 0a20 2020 2020 2020 2023 2070  ass..        # p
+0001fd60: 7269 6e74 2878 2e73 6861 7065 290d 0a20  rint(x.shape).. 
+0001fd70: 2020 2020 2020 2069 6620 696e 7075 7473         if inputs
+0001fd80: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+0001fd90: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0001fda0: 696e 7374 616e 6365 2869 6e70 7574 732c  instance(inputs,
+0001fdb0: 204f 7264 6572 6564 4469 6374 293a 0d0a   OrderedDict):..
+0001fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdd0: 6d6f 6465 6c28 2a6c 6973 7428 696e 7073  model(*list(inps
+0001fde0: 2e76 616c 7565 7328 2929 290d 0a20 2020  .values()))..   
+0001fdf0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+0001fe00: 696e 7374 616e 6365 2869 6e70 7574 732c  instance(inputs,
+0001fe10: 2028 5465 6e73 6f72 2c20 6e70 2e6e 6461   (Tensor, np.nda
+0001fe20: 7272 6179 2929 3a0d 0a20 2020 2020 2020  rray)):..       
+0001fe30: 2020 2020 2020 2020 206d 6f64 656c 2869           model(i
+0001fe40: 6e70 7574 7329 0d0a 2020 2020 2020 2020  nputs)..        
+0001fe50: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001fe60: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001fe70: 282a 696e 7075 7473 290d 0a20 2020 2020  (*inputs)..     
+0001fe80: 2020 2065 6c73 653a 0d0a 0d0a 2020 2020     else:....    
+0001fe90: 2020 2020 2020 2020 6d6f 6465 6c28 2a69          model(*i
+0001fea0: 6e70 732e 7661 6c75 655f 6c69 7374 290d  nps.value_list).
+0001feb0: 0a0d 0a20 2020 2020 2020 2023 2072 656d  ...        # rem
+0001fec0: 6f76 6520 7468 6573 6520 686f 6f6b 730d  ove these hooks.
+0001fed0: 0a20 2020 2020 2020 2066 6f72 2068 2069  .        for h i
+0001fee0: 6e20 686f 6f6b 733a 0d0a 2020 2020 2020  n hooks:..      
+0001fef0: 2020 2020 2020 682e 7265 6d6f 7665 2829        h.remove()
+0001ff00: 0d0a 2020 2020 2020 2020 6d61 785f 6e61  ..        max_na
+0001ff10: 6d65 5f6c 656e 203d 2030 0d0a 2020 2020  me_len = 0..    
+0001ff20: 2020 2020 6d61 785f 7765 6967 6874 5f6c      max_weight_l
+0001ff30: 656e 203d 2030 0d0a 2020 2020 2020 2020  en = 0..        
+0001ff40: 666f 7220 6c61 7965 7220 696e 2073 756d  for layer in sum
+0001ff50: 6d61 7279 3a0d 0a20 2020 2020 2020 2020  mary:..         
+0001ff60: 2020 206d 6178 5f6e 616d 655f 6c65 6e20     max_name_len 
+0001ff70: 3d20 6275 696c 7469 6e73 2e6d 6178 286d  = builtins.max(m
+0001ff80: 6178 5f6e 616d 655f 6c65 6e2c 206c 656e  ax_name_len, len
+0001ff90: 286c 6179 6572 202b 2022 2020 5b22 202b  (layer + "  [" +
+0001ffa0: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+0001ffb0: 2263 6c61 7373 5f6e 616d 6522 5d20 2b20  "class_name"] + 
+0001ffc0: 225d 2229 202b 2035 290d 0a20 2020 2020  "]") + 5)..     
+0001ffd0: 2020 2020 2020 206d 6178 5f77 6569 6768         max_weigh
+0001ffe0: 745f 6c65 6e20 3d20 6275 696c 7469 6e73  t_len = builtins
+0001fff0: 2e6d 6178 286d 6178 5f77 6569 6768 745f  .max(max_weight_
+00020000: 6c65 6e2c 2062 7569 6c74 696e 732e 6d61  len, builtins.ma
+00020010: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+00020020: 2020 2020 5b6c 656e 2873 7472 2869 7465      [len(str(ite
+00020030: 6d29 2e72 6570 6c61 6365 2827 2827 2c20  m).replace('(', 
+00020040: 2727 292e 7265 706c 6163 6528 2729 272c  '').replace(')',
+00020050: 2027 2729 2920 666f 7220 6974 656d 2069   '')) for item i
+00020060: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+00020070: 2020 2020 7375 6d6d 6172 795b 6c61 7965      summary[laye
+00020080: 725d 5b22 7765 6967 6874 225d 2e69 7465  r]["weight"].ite
+00020090: 6d73 2829 5d29 202b 2035 2069 6620 6c65  ms()]) + 5 if le
+000200a0: 6e28 0d0a 2020 2020 2020 2020 2020 2020  n(..            
+000200b0: 2020 2020 7375 6d6d 6172 795b 6c61 7965      summary[laye
+000200c0: 725d 5b22 7765 6967 6874 225d 2920 3e20  r]["weight"]) > 
+000200d0: 3020 656c 7365 2035 290d 0a0d 0a20 2020  0 else 5)....   
+000200e0: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
+000200f0: 2020 2020 2020 2020 2022 2d2d 2d2d 2d2d           "------
+00020100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020140: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020180: 2d2d 2d2d 2d2d 2d22 290d 0a20 2020 2020  -------")..     
-00020190: 2020 206c 696e 655f 6e65 7720 3d20 227b     line_new = "{
-000201a0: 303a 5e35 3073 7d20 7b31 3a3c 3235 737d  0:^50s} {1:<25s}
-000201b0: 2020 7b32 3a3c 3335 737d 207b 333a 3c38    {2:<35s} {3:<8
-000201c0: 737d 2020 7b34 3a3c 3873 7d20 207b 353a  s}  {4:<8s}  {5:
-000201d0: 3c32 3573 7d22 2e72 6570 6c61 6365 2827  <25s}".replace('
-000201e0: 3530 7327 2c0d 0a20 2020 2020 2020 2020  50s',..         
+00020170: 2d2d 2d2d 2d2d 2d2d 2d2d 2229 0d0a 2020  ----------")..  
+00020180: 2020 2020 2020 6c69 6e65 5f6e 6577 203d        line_new =
+00020190: 2022 7b30 3a5e 3530 737d 207b 313a 3c32   "{0:^50s} {1:<2
+000201a0: 3573 7d20 207b 323a 3c33 3573 7d20 7b33  5s}  {2:<35s} {3
+000201b0: 3a3c 3873 7d20 207b 343a 3c38 737d 2020  :<8s}  {4:<8s}  
+000201c0: 7b35 3a3c 3235 737d 222e 7265 706c 6163  {5:<25s}".replac
+000201d0: 6528 2735 3073 272c 0d0a 2020 2020 2020  e('50s',..      
+000201e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000201f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020230: 2020 2020 2020 2020 2020 2073 7472 286d             str(m
-00020240: 6178 5f6e 616d 655f 6c65 6e29 202b 2027  ax_name_len) + '
-00020250: 7327 292e 7265 706c 6163 6528 0d0a 2020  s').replace(..  
-00020260: 2020 2020 2020 2020 2020 2733 3573 272c            '35s',
-00020270: 2073 7472 286d 6178 5f77 6569 6768 745f   str(max_weight_
-00020280: 6c65 6e29 202b 2027 7327 292e 666f 726d  len) + 's').form
-00020290: 6174 2822 4c61 7965 7220 2874 7970 6529  at("Layer (type)
-000202a0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00020220: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00020230: 7228 6d61 785f 6e61 6d65 5f6c 656e 2920  r(max_name_len) 
+00020240: 2b20 2773 2729 2e72 6570 6c61 6365 280d  + 's').replace(.
+00020250: 0a20 2020 2020 2020 2020 2020 2027 3335  .            '35
+00020260: 7327 2c20 7374 7228 6d61 785f 7765 6967  s', str(max_weig
+00020270: 6874 5f6c 656e 2920 2b20 2773 2729 2e66  ht_len) + 's').f
+00020280: 6f72 6d61 7428 224c 6179 6572 2028 7479  ormat("Layer (ty
+00020290: 7065 2922 2c0d 0a20 2020 2020 2020 2020  pe)",..         
+000202a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000202b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202d0: 2020 2020 2020 2020 2022 4f75 7470 7574           "Output
-000202e0: 2053 6861 7065 222c 0d0a 2020 2020 2020   Shape",..      
+000202c0: 2020 2020 2020 2020 2020 2020 224f 7574              "Out
+000202d0: 7075 7420 5368 6170 6522 2c0d 0a20 2020  put Shape",..   
+000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000202f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020310: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00020320: 5765 6967 6874 2022 2c20 2242 6961 7322  Weight ", "Bias"
-00020330: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00020310: 2020 2257 6569 6768 7420 222c 2022 4269    "Weight ", "Bi
+00020320: 6173 222c 0d0a 2020 2020 2020 2020 2020  as",..          
+00020330: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020360: 2020 2020 2020 2020 2250 6172 616d 2023          "Param #
-00020370: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00020350: 2020 2020 2020 2020 2020 2022 5061 7261             "Para
+00020360: 6d20 2322 2c0d 0a20 2020 2020 2020 2020  m #",..         
+00020370: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203a0: 2020 2020 2020 2020 2022 464c 4f50 5320           "FLOPS 
-000203b0: 2322 290d 0a0d 0a20 2020 2020 2020 2070  #")....        p
-000203c0: 7269 6e74 286c 696e 655f 6e65 7729 0d0a  rint(line_new)..
-000203d0: 2020 2020 2020 2020 7072 696e 7428 223d          print("=
+00020390: 2020 2020 2020 2020 2020 2020 2246 4c4f              "FLO
+000203a0: 5053 2023 2229 0d0a 0d0a 2020 2020 2020  PS #")....      
+000203b0: 2020 7072 696e 7428 6c69 6e65 5f6e 6577    print(line_new
+000203c0: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+000203d0: 2822 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ("==============
 000203e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 000203f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00020400: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00020410: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020420: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d22 290d  =============").
-00020430: 0a20 2020 2020 2020 2074 6f74 616c 5f70  .        total_p
-00020440: 6172 616d 7320 3d20 6e70 2e61 7272 6179  arams = np.array
-00020450: 285b 305d 2c20 6474 7970 653d 6e70 2e66  ([0], dtype=np.f
-00020460: 6c6f 6174 3634 290d 0a20 2020 2020 2020  loat64)..       
-00020470: 2074 6f74 616c 5f6f 7574 7075 7420 3d20   total_output = 
-00020480: 300d 0a20 2020 2020 2020 2074 7261 696e  0..        train
-00020490: 6162 6c65 5f70 6172 616d 7320 3d20 6e70  able_params = np
-000204a0: 2e61 7272 6179 285b 305d 2c20 6474 7970  .array([0], dtyp
-000204b0: 653d 6e70 2e66 6c6f 6174 3634 290d 0a20  e=np.float64).. 
-000204c0: 2020 2020 2020 2066 6c6f 7073 203d 206e         flops = n
-000204d0: 702e 6172 7261 7928 5b30 5d2c 2064 7479  p.array([0], dty
-000204e0: 7065 3d6e 702e 666c 6f61 7436 3429 0d0a  pe=np.float64)..
-000204f0: 2020 2020 2020 2020 6d61 6363 203d 206e          macc = n
-00020500: 702e 6172 7261 7928 5b30 5d2c 2064 7479  p.array([0], dty
-00020510: 7065 3d6e 702e 666c 6f61 7436 3429 0d0a  pe=np.float64)..
-00020520: 2020 2020 2020 2020 666f 7220 6c61 7965          for laye
-00020530: 7220 696e 2073 756d 6d61 7279 3a0d 0a20  r in summary:.. 
-00020540: 2020 2020 2020 2020 2020 2023 2069 6e70             # inp
-00020550: 7574 5f73 6861 7065 2c20 6f75 7470 7574  ut_shape, output
-00020560: 5f73 6861 7065 2c20 7472 6169 6e61 626c  _shape, trainabl
-00020570: 652c 206e 625f 7061 7261 6d73 0d0a 2020  e, nb_params..  
-00020580: 2020 2020 2020 2020 2020 6973 5f6b 6565            is_kee
-00020590: 7020 3d20 27e2 9885 2720 6966 2073 756d  p = '...' if sum
-000205a0: 6d61 7279 5b6c 6179 6572 5d5b 226b 6565  mary[layer]["kee
-000205b0: 705f 6f75 7470 7574 225d 2065 6c73 6520  p_output"] else 
-000205c0: 2727 0d0a 2020 2020 2020 2020 2020 2020  ''..            
-000205d0: 636c 6173 735f 6e61 6d65 203d 2073 756d  class_name = sum
-000205e0: 6d61 7279 5b6c 6179 6572 5d5b 2263 6c61  mary[layer]["cla
-000205f0: 7373 5f6e 616d 6522 5d0d 0a20 2020 2020  ss_name"]..     
-00020600: 2020 2020 2020 2023 206c 696e 655f 6e65         # line_ne
-00020610: 7720 3d20 227b 303a 3c35 3073 7d20 7b31  w = "{0:<50s} {1
-00020620: 3a3c 3230 737d 2020 7b32 3a3c 3230 737d  :<20s}  {2:<20s}
-00020630: 207b 333a 3c38 737d 2020 7b34 3a3c 387d   {3:<8s}  {4:<8}
-00020640: 2020 7b35 3a3c 3132 7d22 2e66 6f72 6d61    {5:<12}".forma
-00020650: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-00020660: 2320 2020 2020 6c61 7965 722b 2220 2022  #     layer+"  "
-00020670: 2b63 6c61 7373 5f6e 616d 652c 0d0a 2020  +class_name,..  
-00020680: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00020690: 6973 5f6b 6565 7020 2b20 7374 7228 7375  is_keep + str(su
-000206a0: 6d6d 6172 795b 6c61 7965 725d 5b22 6f75  mmary[layer]["ou
-000206b0: 7470 7574 5f73 6861 7065 225d 292c 0d0a  tput_shape"]),..
-000206c0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-000206d0: 2020 7374 7228 7375 6d6d 6172 795b 6c61    str(summary[la
-000206e0: 7965 725d 5b22 7765 6967 6874 225d 2069  yer]["weight"] i
-000206f0: 6620 2777 6569 6768 7427 2069 6e20 7375  f 'weight' in su
-00020700: 6d6d 6172 795b 6c61 7965 725d 2065 6c73  mmary[layer] els
-00020710: 6520 2727 292c 0d0a 2020 2020 2020 2020  e ''),..        
-00020720: 2020 2020 2320 2020 2020 7374 7228 7375      #     str(su
-00020730: 6d6d 6172 795b 6c61 7965 725d 5b22 6269  mmary[layer]["bi
-00020740: 6173 225d 2069 6620 2762 6961 7327 2069  as"] if 'bias' i
-00020750: 6e20 7375 6d6d 6172 795b 6c61 7965 725d  n summary[layer]
-00020760: 2065 6c73 6520 2727 292c 0d0a 2020 2020   else ''),..    
-00020770: 2020 2020 2020 2020 2320 2020 2020 7375          #     su
-00020780: 6d6d 6172 795b 6c61 7965 725d 5b22 6e62  mmary[layer]["nb
-00020790: 5f70 6172 616d 7322 5d2c 0d0a 2020 2020  _params"],..    
-000207a0: 2020 2020 2020 2020 2320 2020 2020 7375          #     su
-000207b0: 6d6d 6172 795b 6c61 7965 725d 5b22 666c  mmary[layer]["fl
-000207c0: 6f70 7322 5d5b 305d 0d0a 2020 2020 2020  ops"][0]..      
-000207d0: 2020 2020 2020 2320 290d 0a0d 0a20 2020        # )....   
-000207e0: 2020 2020 2020 2020 206c 696e 655f 6e65           line_ne
-000207f0: 7720 3d20 227b 303a 3c35 3073 7d20 7b31  w = "{0:<50s} {1
-00020800: 3a3c 3235 737d 2020 7b32 3a3c 3335 737d  :<25s}  {2:<35s}
-00020810: 207b 333a 3c38 737d 2020 7b34 3a2c 2e30   {3:<8s}  {4:,.0
-00020820: 667d 2020 7b35 3a2c 2e30 667d 2020 222e  f}  {5:,.0f}  ".
-00020830: 7265 706c 6163 6528 2735 3073 272c 0d0a  replace('50s',..
+00020420: 2229 0d0a 2020 2020 2020 2020 746f 7461  ")..        tota
+00020430: 6c5f 7061 7261 6d73 203d 206e 702e 6172  l_params = np.ar
+00020440: 7261 7928 5b30 5d2c 2064 7479 7065 3d6e  ray([0], dtype=n
+00020450: 702e 666c 6f61 7436 3429 0d0a 2020 2020  p.float64)..    
+00020460: 2020 2020 746f 7461 6c5f 6f75 7470 7574      total_output
+00020470: 203d 2030 0d0a 2020 2020 2020 2020 7472   = 0..        tr
+00020480: 6169 6e61 626c 655f 7061 7261 6d73 203d  ainable_params =
+00020490: 206e 702e 6172 7261 7928 5b30 5d2c 2064   np.array([0], d
+000204a0: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
+000204b0: 0d0a 2020 2020 2020 2020 666c 6f70 7320  ..        flops 
+000204c0: 3d20 6e70 2e61 7272 6179 285b 305d 2c20  = np.array([0], 
+000204d0: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+000204e0: 290d 0a20 2020 2020 2020 206d 6163 6320  )..        macc 
+000204f0: 3d20 6e70 2e61 7272 6179 285b 305d 2c20  = np.array([0], 
+00020500: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+00020510: 290d 0a20 2020 2020 2020 2066 6f72 206c  )..        for l
+00020520: 6179 6572 2069 6e20 7375 6d6d 6172 793a  ayer in summary:
+00020530: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00020540: 696e 7075 745f 7368 6170 652c 206f 7574  input_shape, out
+00020550: 7075 745f 7368 6170 652c 2074 7261 696e  put_shape, train
+00020560: 6162 6c65 2c20 6e62 5f70 6172 616d 730d  able, nb_params.
+00020570: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+00020580: 6b65 6570 203d 2027 e298 8527 2069 6620  keep = '...' if 
+00020590: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+000205a0: 6b65 6570 5f6f 7574 7075 7422 5d20 656c  keep_output"] el
+000205b0: 7365 2027 270d 0a20 2020 2020 2020 2020  se ''..         
+000205c0: 2020 2063 6c61 7373 5f6e 616d 6520 3d20     class_name = 
+000205d0: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+000205e0: 636c 6173 735f 6e61 6d65 225d 0d0a 2020  class_name"]..  
+000205f0: 2020 2020 2020 2020 2020 2320 6c69 6e65            # line
+00020600: 5f6e 6577 203d 2022 7b30 3a3c 3530 737d  _new = "{0:<50s}
+00020610: 207b 313a 3c32 3073 7d20 207b 323a 3c32   {1:<20s}  {2:<2
+00020620: 3073 7d20 7b33 3a3c 3873 7d20 207b 343a  0s} {3:<8s}  {4:
+00020630: 3c38 7d20 207b 353a 3c31 327d 222e 666f  <8}  {5:<12}".fo
+00020640: 726d 6174 280d 0a20 2020 2020 2020 2020  rmat(..         
+00020650: 2020 2023 2020 2020 206c 6179 6572 2b22     #     layer+"
+00020660: 2020 222b 636c 6173 735f 6e61 6d65 2c0d    "+class_name,.
+00020670: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00020680: 2020 2069 735f 6b65 6570 202b 2073 7472     is_keep + str
+00020690: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
+000206a0: 226f 7574 7075 745f 7368 6170 6522 5d29  "output_shape"])
+000206b0: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
+000206c0: 2020 2020 2073 7472 2873 756d 6d61 7279       str(summary
+000206d0: 5b6c 6179 6572 5d5b 2277 6569 6768 7422  [layer]["weight"
+000206e0: 5d20 6966 2027 7765 6967 6874 2720 696e  ] if 'weight' in
+000206f0: 2073 756d 6d61 7279 5b6c 6179 6572 5d20   summary[layer] 
+00020700: 656c 7365 2027 2729 2c0d 0a20 2020 2020  else ''),..     
+00020710: 2020 2020 2020 2023 2020 2020 2073 7472         #     str
+00020720: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
+00020730: 2262 6961 7322 5d20 6966 2027 6269 6173  "bias"] if 'bias
+00020740: 2720 696e 2073 756d 6d61 7279 5b6c 6179  ' in summary[lay
+00020750: 6572 5d20 656c 7365 2027 2729 2c0d 0a20  er] else ''),.. 
+00020760: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00020770: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+00020780: 226e 625f 7061 7261 6d73 225d 2c0d 0a20  "nb_params"],.. 
+00020790: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+000207a0: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+000207b0: 2266 6c6f 7073 225d 5b30 5d0d 0a20 2020  "flops"][0]..   
+000207c0: 2020 2020 2020 2020 2023 2029 0d0a 0d0a           # )....
+000207d0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+000207e0: 5f6e 6577 203d 2022 7b30 3a3c 3530 737d  _new = "{0:<50s}
+000207f0: 207b 313a 3c32 3573 7d20 207b 323a 3c33   {1:<25s}  {2:<3
+00020800: 3573 7d20 7b33 3a3c 3873 7d20 207b 343a  5s} {3:<8s}  {4:
+00020810: 2c2e 3066 7d20 207b 353a 2c2e 3066 7d20  ,.0f}  {5:,.0f} 
+00020820: 2022 2e72 6570 6c61 6365 2827 3530 7327   ".replace('50s'
+00020830: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00020840: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020850: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020860: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020890: 2020 2020 2020 2020 2020 2073 7472 286d             str(m
-000208a0: 6178 5f6e 616d 655f 6c65 6e29 202b 2027  ax_name_len) + '
-000208b0: 7327 292e 7265 706c 6163 6528 0d0a 2020  s').replace(..  
-000208c0: 2020 2020 2020 2020 2020 2020 2020 2733                '3
-000208d0: 3573 272c 2073 7472 286d 6178 5f77 6569  5s', str(max_wei
-000208e0: 6768 745f 6c65 6e29 202b 2027 7327 292e  ght_len) + 's').
-000208f0: 666f 726d 6174 280d 0a20 2020 2020 2020  format(..       
-00020900: 2020 2020 2020 2020 2028 6c61 7965 7220           (layer 
-00020910: 2b20 2220 205b 2220 2b20 636c 6173 735f  + "  [" + class_
-00020920: 6e61 6d65 202b 2022 5d22 292e 6c6a 7573  name + "]").ljus
-00020930: 7428 6d61 785f 6e61 6d65 5f6c 656e 2c20  t(max_name_len, 
-00020940: 2720 2729 2c0d 0a20 2020 2020 2020 2020  ' '),..         
-00020950: 2020 2020 2020 2028 6973 5f6b 6565 7020         (is_keep 
-00020960: 2b20 7374 7228 7375 6d6d 6172 795b 6c61  + str(summary[la
-00020970: 7965 725d 5b22 6f75 7470 7574 5f73 6861  yer]["output_sha
-00020980: 7065 225d 2929 2e6c 6a75 7374 2832 352c  pe"])).ljust(25,
-00020990: 2027 2027 292c 0d0a 2020 2020 2020 2020   ' '),..        
-000209a0: 2020 2020 2020 2020 7374 7228 7375 6d6d          str(summ
-000209b0: 6172 795b 6c61 7965 725d 5b22 7765 6967  ary[layer]["weig
-000209c0: 6874 225d 2e69 7465 6d5f 6c69 7374 5b30  ht"].item_list[0
-000209d0: 5d20 6966 2027 7765 6967 6874 2720 696e  ] if 'weight' in
-000209e0: 2073 756d 6d61 7279 5b6c 6179 6572 5d20   summary[layer] 
-000209f0: 616e 6420 6c65 6e28 0d0a 2020 2020 2020  and len(..      
-00020a00: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00020a10: 6d6d 6172 795b 6c61 7965 725d 5b22 7765  mmary[layer]["we
-00020a20: 6967 6874 225d 2920 3e20 3020 656c 7365  ight"]) > 0 else
-00020a30: 2027 2027 292e 7265 706c 6163 6528 2728   ' ').replace('(
-00020a40: 272c 2027 2729 2e72 6570 6c61 6365 2827  ', '').replace('
-00020a50: 2927 2c20 2727 292e 6c6a 7573 7428 0d0a  )', '').ljust(..
-00020a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a70: 2020 2020 6d61 785f 7765 6967 6874 5f6c      max_weight_l
-00020a80: 656e 2c20 2720 2729 2c0d 0a20 2020 2020  en, ' '),..     
-00020a90: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
-00020aa0: 756d 6d61 7279 5b6c 6179 6572 5d5b 2262  ummary[layer]["b
-00020ab0: 6961 7322 5d2e 6974 656d 5f6c 6973 745b  ias"].item_list[
-00020ac0: 305d 2069 6620 2762 6961 7327 2069 6e20  0] if 'bias' in 
-00020ad0: 7375 6d6d 6172 795b 6c61 7965 725d 2061  summary[layer] a
-00020ae0: 6e64 206c 656e 280d 0a20 2020 2020 2020  nd len(..       
-00020af0: 2020 2020 2020 2020 2020 2020 2073 756d               sum
-00020b00: 6d61 7279 5b6c 6179 6572 5d5b 2262 6961  mary[layer]["bia
-00020b10: 7322 5d29 203e 2030 2065 6c73 6520 2720  s"]) > 0 else ' 
-00020b20: 2729 2e72 6570 6c61 6365 2827 2827 2c20  ').replace('(', 
-00020b30: 2727 292e 7265 706c 6163 6528 2729 272c  '').replace(')',
-00020b40: 2027 2729 2e6c 6a75 7374 2838 2c20 2720   '').ljust(8, ' 
-00020b50: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-00020b60: 2020 2020 2073 756d 6d61 7279 5b6c 6179       summary[lay
-00020b70: 6572 5d5b 226e 625f 7061 7261 6d73 225d  er]["nb_params"]
-00020b80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00020b90: 2020 2073 756d 6d61 7279 5b6c 6179 6572     summary[layer
-00020ba0: 5d5b 2266 6c6f 7073 225d 2e73 756d 2829  ]["flops"].sum()
-00020bb0: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00020bc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00020bd0: 6c65 6e28 7375 6d6d 6172 795b 6c61 7965  len(summary[laye
-00020be0: 725d 5b22 7765 6967 6874 225d 2920 3e20  r]["weight"]) > 
-00020bf0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-00020c00: 2020 2020 666f 7220 6e20 696e 2072 616e      for n in ran
-00020c10: 6765 2831 2c20 6c65 6e28 7375 6d6d 6172  ge(1, len(summar
-00020c20: 795b 6c61 7965 725d 5b22 7765 6967 6874  y[layer]["weight
-00020c30: 225d 2929 3a0d 0a20 2020 2020 2020 2020  "])):..         
-00020c40: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-00020c50: 6e65 775f 6164 6420 3d20 227b 303a 3c35  new_add = "{0:<5
-00020c60: 3073 7d20 7b31 3a3c 3235 737d 2020 7b32  0s} {1:<25s}  {2
-00020c70: 3a3c 3335 737d 207b 333a 3c38 737d 2020  :<35s} {3:<8s}  
-00020c80: 7b34 7d20 207b 357d 2020 222e 7265 706c  {4}  {5}  ".repl
-00020c90: 6163 6528 2735 3073 272c 0d0a 2020 2020  ace('50s',..    
+00020880: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00020890: 7228 6d61 785f 6e61 6d65 5f6c 656e 2920  r(max_name_len) 
+000208a0: 2b20 2773 2729 2e72 6570 6c61 6365 280d  + 's').replace(.
+000208b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000208c0: 2027 3335 7327 2c20 7374 7228 6d61 785f   '35s', str(max_
+000208d0: 7765 6967 6874 5f6c 656e 2920 2b20 2773  weight_len) + 's
+000208e0: 2729 2e66 6f72 6d61 7428 0d0a 2020 2020  ').format(..    
+000208f0: 2020 2020 2020 2020 2020 2020 286c 6179              (lay
+00020900: 6572 202b 2022 2020 5b22 202b 2063 6c61  er + "  [" + cla
+00020910: 7373 5f6e 616d 6520 2b20 225d 2229 2e6c  ss_name + "]").l
+00020920: 6a75 7374 286d 6178 5f6e 616d 655f 6c65  just(max_name_le
+00020930: 6e2c 2027 2027 292c 0d0a 2020 2020 2020  n, ' '),..      
+00020940: 2020 2020 2020 2020 2020 2869 735f 6b65            (is_ke
+00020950: 6570 202b 2073 7472 2873 756d 6d61 7279  ep + str(summary
+00020960: 5b6c 6179 6572 5d5b 226f 7574 7075 745f  [layer]["output_
+00020970: 7368 6170 6522 5d29 292e 6c6a 7573 7428  shape"])).ljust(
+00020980: 3235 2c20 2720 2729 2c0d 0a20 2020 2020  25, ' '),..     
+00020990: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
+000209a0: 756d 6d61 7279 5b6c 6179 6572 5d5b 2277  ummary[layer]["w
+000209b0: 6569 6768 7422 5d2e 6974 656d 5f6c 6973  eight"].item_lis
+000209c0: 745b 305d 2069 6620 2777 6569 6768 7427  t[0] if 'weight'
+000209d0: 2069 6e20 7375 6d6d 6172 795b 6c61 7965   in summary[laye
+000209e0: 725d 2061 6e64 206c 656e 280d 0a20 2020  r] and len(..   
+000209f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a00: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+00020a10: 2277 6569 6768 7422 5d29 203e 2030 2065  "weight"]) > 0 e
+00020a20: 6c73 6520 2720 2729 2e72 6570 6c61 6365  lse ' ').replace
+00020a30: 2827 2827 2c20 2727 292e 7265 706c 6163  ('(', '').replac
+00020a40: 6528 2729 272c 2027 2729 2e6c 6a75 7374  e(')', '').ljust
+00020a50: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00020a60: 2020 2020 2020 206d 6178 5f77 6569 6768         max_weigh
+00020a70: 745f 6c65 6e2c 2027 2027 292c 0d0a 2020  t_len, ' '),..  
+00020a80: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00020a90: 7228 7375 6d6d 6172 795b 6c61 7965 725d  r(summary[layer]
+00020aa0: 5b22 6269 6173 225d 2e69 7465 6d5f 6c69  ["bias"].item_li
+00020ab0: 7374 5b30 5d20 6966 2027 6269 6173 2720  st[0] if 'bias' 
+00020ac0: 696e 2073 756d 6d61 7279 5b6c 6179 6572  in summary[layer
+00020ad0: 5d20 616e 6420 6c65 6e28 0d0a 2020 2020  ] and len(..    
+00020ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020af0: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+00020b00: 6269 6173 225d 2920 3e20 3020 656c 7365  bias"]) > 0 else
+00020b10: 2027 2027 292e 7265 706c 6163 6528 2728   ' ').replace('(
+00020b20: 272c 2027 2729 2e72 6570 6c61 6365 2827  ', '').replace('
+00020b30: 2927 2c20 2727 292e 6c6a 7573 7428 382c  )', '').ljust(8,
+00020b40: 2027 2027 292c 0d0a 2020 2020 2020 2020   ' '),..        
+00020b50: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
+00020b60: 6c61 7965 725d 5b22 6e62 5f70 6172 616d  layer]["nb_param
+00020b70: 7322 5d2c 0d0a 2020 2020 2020 2020 2020  s"],..          
+00020b80: 2020 2020 2020 7375 6d6d 6172 795b 6c61        summary[la
+00020b90: 7965 725d 5b22 666c 6f70 7322 5d2e 7375  yer]["flops"].su
+00020ba0: 6d28 290d 0a20 2020 2020 2020 2020 2020  m()..           
+00020bb0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00020bc0: 6966 206c 656e 2873 756d 6d61 7279 5b6c  if len(summary[l
+00020bd0: 6179 6572 5d5b 2277 6569 6768 7422 5d29  ayer]["weight"])
+00020be0: 203e 2031 3a0d 0a20 2020 2020 2020 2020   > 1:..         
+00020bf0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+00020c00: 7261 6e67 6528 312c 206c 656e 2873 756d  range(1, len(sum
+00020c10: 6d61 7279 5b6c 6179 6572 5d5b 2277 6569  mary[layer]["wei
+00020c20: 6768 7422 5d29 293a 0d0a 2020 2020 2020  ght"])):..      
+00020c30: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00020c40: 6e65 5f6e 6577 5f61 6464 203d 2022 7b30  ne_new_add = "{0
+00020c50: 3a3c 3530 737d 207b 313a 3c32 3573 7d20  :<50s} {1:<25s} 
+00020c60: 207b 323a 3c33 3573 7d20 7b33 3a3c 3873   {2:<35s} {3:<8s
+00020c70: 7d20 207b 347d 2020 7b35 7d20 2022 2e72  }  {4}  {5}  ".r
+00020c80: 6570 6c61 6365 2827 3530 7327 2c0d 0a20  eplace('50s',.. 
+00020c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cf0: 2020 2020 2020 2020 2073 7472 286d 6178           str(max
-00020d00: 5f6e 616d 655f 6c65 6e29 202b 2027 7327  _name_len) + 's'
-00020d10: 292e 7265 706c 6163 6528 0d0a 2020 2020  ).replace(..    
-00020d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d30: 2020 2020 2733 3573 272c 2073 7472 286d      '35s', str(m
-00020d40: 6178 5f77 6569 6768 745f 6c65 6e29 202b  ax_weight_len) +
-00020d50: 2027 7327 292e 666f 726d 6174 280d 0a20   's').format(.. 
-00020d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d70: 2020 2020 2020 2022 2022 2e6c 6a75 7374         " ".ljust
-00020d80: 286d 6178 5f6e 616d 655f 6c65 6e20 2b20  (max_name_len + 
-00020d90: 6c65 6e28 6c61 7965 7220 2b20 2220 205b  len(layer + "  [
-00020da0: 2220 2b20 636c 6173 735f 6e61 6d65 202b  " + class_name +
-00020db0: 2022 5d22 2920 2f2f 2032 2c20 2220 2229   "]") // 2, " ")
-00020dc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00020dd0: 2020 2020 2020 2020 2020 2022 2022 2e6c             " ".l
-00020de0: 6a75 7374 2832 3520 2b20 6c65 6e28 6973  just(25 + len(is
-00020df0: 5f6b 6565 7020 2b20 7374 7228 7375 6d6d  _keep + str(summ
-00020e00: 6172 795b 6c61 7965 725d 5b22 6f75 7470  ary[layer]["outp
-00020e10: 7574 5f73 6861 7065 225d 2929 202f 2f20  ut_shape"])) // 
-00020e20: 322c 2022 2022 292c 0d0a 2020 2020 2020  2, " "),..      
-00020e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e40: 2020 7374 7228 7375 6d6d 6172 795b 6c61    str(summary[la
-00020e50: 7965 725d 5b22 7765 6967 6874 225d 2e69  yer]["weight"].i
-00020e60: 7465 6d5f 6c69 7374 5b6e 5d20 6966 206e  tem_list[n] if n
-00020e70: 203c 206c 656e 280d 0a20 2020 2020 2020   < len(..       
-00020e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e90: 2020 2020 2073 756d 6d61 7279 5b6c 6179       summary[lay
-00020ea0: 6572 5d5b 2277 6569 6768 7422 5d29 2065  er]["weight"]) e
-00020eb0: 6c73 6520 2720 2729 2e72 6570 6c61 6365  lse ' ').replace
-00020ec0: 2827 2827 2c20 2727 292e 7265 706c 6163  ('(', '').replac
-00020ed0: 6528 2729 272c 2027 2729 2e6c 6a75 7374  e(')', '').ljust
-00020ee0: 286d 6178 5f77 6569 6768 745f 6c65 6e2c  (max_weight_len,
-00020ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00020ce0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+00020cf0: 6d61 785f 6e61 6d65 5f6c 656e 2920 2b20  max_name_len) + 
+00020d00: 2773 2729 2e72 6570 6c61 6365 280d 0a20  's').replace(.. 
+00020d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d20: 2020 2020 2020 2027 3335 7327 2c20 7374         '35s', st
+00020d30: 7228 6d61 785f 7765 6967 6874 5f6c 656e  r(max_weight_len
+00020d40: 2920 2b20 2773 2729 2e66 6f72 6d61 7428  ) + 's').format(
+00020d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00020d60: 2020 2020 2020 2020 2020 2220 222e 6c6a            " ".lj
+00020d70: 7573 7428 6d61 785f 6e61 6d65 5f6c 656e  ust(max_name_len
+00020d80: 202b 206c 656e 286c 6179 6572 202b 2022   + len(layer + "
+00020d90: 2020 5b22 202b 2063 6c61 7373 5f6e 616d    [" + class_nam
+00020da0: 6520 2b20 225d 2229 202f 2f20 322c 2022  e + "]") // 2, "
+00020db0: 2022 292c 0d0a 2020 2020 2020 2020 2020   "),..          
+00020dc0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00020dd0: 222e 6c6a 7573 7428 3235 202b 206c 656e  ".ljust(25 + len
+00020de0: 2869 735f 6b65 6570 202b 2073 7472 2873  (is_keep + str(s
+00020df0: 756d 6d61 7279 5b6c 6179 6572 5d5b 226f  ummary[layer]["o
+00020e00: 7574 7075 745f 7368 6170 6522 5d29 2920  utput_shape"])) 
+00020e10: 2f2f 2032 2c20 2220 2229 2c0d 0a20 2020  // 2, " "),..   
+00020e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e30: 2020 2020 2073 7472 2873 756d 6d61 7279       str(summary
+00020e40: 5b6c 6179 6572 5d5b 2277 6569 6768 7422  [layer]["weight"
+00020e50: 5d2e 6974 656d 5f6c 6973 745b 6e5d 2069  ].item_list[n] i
+00020e60: 6620 6e20 3c20 6c65 6e28 0d0a 2020 2020  f n < len(..    
+00020e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e80: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
+00020e90: 6c61 7965 725d 5b22 7765 6967 6874 225d  layer]["weight"]
+00020ea0: 2920 656c 7365 2027 2027 292e 7265 706c  ) else ' ').repl
+00020eb0: 6163 6528 2728 272c 2027 2729 2e72 6570  ace('(', '').rep
+00020ec0: 6c61 6365 2827 2927 2c20 2727 292e 6c6a  lace(')', '').lj
+00020ed0: 7573 7428 6d61 785f 7765 6967 6874 5f6c  ust(max_weight_l
+00020ee0: 656e 2c0d 0a20 2020 2020 2020 2020 2020  en,..           
+00020ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f50: 2020 2020 2020 2020 2020 2220 2229 2c0d            " "),.
-00020f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020f70: 2020 2020 2020 2020 2073 7472 2873 756d           str(sum
-00020f80: 6d61 7279 5b6c 6179 6572 5d5b 2262 6961  mary[layer]["bia
-00020f90: 7322 5d2e 6974 656d 5f6c 6973 745b 6e5d  s"].item_list[n]
-00020fa0: 2069 6620 6e20 3c20 6c65 6e28 7375 6d6d   if n < len(summ
-00020fb0: 6172 795b 6c61 7965 725d 5b22 6269 6173  ary[layer]["bias
-00020fc0: 225d 2920 656c 7365 2027 2027 292e 7265  "]) else ' ').re
-00020fd0: 706c 6163 6528 0d0a 2020 2020 2020 2020  place(..        
-00020fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ff0: 2020 2020 2728 272c 2027 2729 2e72 6570      '(', '').rep
-00021000: 6c61 6365 2827 2927 2c20 2727 292e 6c6a  lace(')', '').lj
-00021010: 7573 7428 382c 2022 2022 292c 2022 2022  ust(8, " "), " "
-00021020: 2c20 2220 2229 0d0a 2020 2020 2020 2020  , " ")..        
-00021030: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-00021040: 5f6e 6577 203d 206c 696e 655f 6e65 7720  _new = line_new 
-00021050: 2b20 275c 6e27 202b 206c 696e 655f 6e65  + '\n' + line_ne
-00021060: 775f 6164 640d 0a0d 0a20 2020 2020 2020  w_add....       
-00021070: 2020 2020 2074 6f74 616c 5f70 6172 616d       total_param
-00021080: 7320 2b3d 2073 756d 6d61 7279 5b6c 6179  s += summary[lay
-00021090: 6572 5d5b 226e 625f 7061 7261 6d73 225d  er]["nb_params"]
-000210a0: 0d0a 2020 2020 2020 2020 2020 2020 666c  ..            fl
-000210b0: 6f70 7320 2b3d 2066 6c6f 6174 2873 756d  ops += float(sum
-000210c0: 6d61 7279 5b6c 6179 6572 5d5b 2266 6c6f  mary[layer]["flo
-000210d0: 7073 225d 290d 0a20 2020 2020 2020 2020  ps"])..         
-000210e0: 2020 206d 6163 6320 2b3d 2066 6c6f 6174     macc += float
-000210f0: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
-00021100: 226d 6163 6322 5d2e 7375 6d28 2929 0d0a  "macc"].sum())..
-00021110: 2020 2020 2020 2020 2020 2020 746f 7461              tota
-00021120: 6c5f 6f75 7470 7574 202b 3d20 7375 6d6d  l_output += summ
-00021130: 6172 795b 6c61 7965 725d 5b22 6f75 7470  ary[layer]["outp
-00021140: 7574 5f73 6861 7065 225d 2e6e 756d 656c  ut_shape"].numel
-00021150: 2862 6174 6368 5f73 697a 653d 6261 7463  (batch_size=batc
-00021160: 685f 7369 7a65 2920 6966 2069 7369 6e73  h_size) if isins
-00021170: 7461 6e63 6528 0d0a 2020 2020 2020 2020  tance(..        
-00021180: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
-00021190: 6c61 7965 725d 5b22 6f75 7470 7574 5f73  layer]["output_s
-000211a0: 6861 7065 225d 2c20 5465 6e73 6f72 5368  hape"], TensorSh
-000211b0: 6170 6529 2065 6c73 6520 6e70 2e6e 6461  ape) else np.nda
-000211c0: 7272 6179 280d 0a20 2020 2020 2020 2020  rray(..         
-000211d0: 2020 2020 2020 205b 7368 702e 6e75 6d65         [shp.nume
-000211e0: 6c28 6261 7463 685f 7369 7a65 3d62 6174  l(batch_size=bat
-000211f0: 6368 5f73 697a 6529 2066 6f72 2073 6870  ch_size) for shp
-00021200: 2069 6e20 7375 6d6d 6172 795b 6c61 7965   in summary[laye
-00021210: 725d 5b22 6f75 7470 7574 5f73 6861 7065  r]["output_shape
-00021220: 225d 5d29 2e73 756d 2829 0d0a 2020 2020  "]]).sum()..    
-00021230: 2020 2020 2020 2020 6966 2022 7472 6169          if "trai
-00021240: 6e61 626c 6522 2069 6e20 7375 6d6d 6172  nable" in summar
-00021250: 795b 6c61 7965 725d 3a0d 0a20 2020 2020  y[layer]:..     
-00021260: 2020 2020 2020 2020 2020 2074 7261 696e             train
-00021270: 6162 6c65 5f70 6172 616d 7320 2b3d 2073  able_params += s
-00021280: 756d 6d61 7279 5b6c 6179 6572 5d5b 2274  ummary[layer]["t
-00021290: 7261 696e 6162 6c65 225d 0d0a 2020 2020  rainable"]..    
-000212a0: 2020 2020 2020 2020 7072 696e 7428 6c69          print(li
-000212b0: 6e65 5f6e 6577 290d 0a0d 0a20 2020 2020  ne_new)....     
-000212c0: 2020 2023 2061 7373 756d 6520 3420 6279     # assume 4 by
-000212d0: 7465 732f 6e75 6d62 6572 2028 666c 6f61  tes/number (floa
-000212e0: 7420 6f6e 2063 7564 6129 2e0d 0a20 2020  t on cuda)...   
-000212f0: 2020 2020 2074 6f74 616c 5f69 6e70 7574       total_input
-00021300: 5f73 697a 6520 3d20 6e70 2e61 7361 7272  _size = np.asarr
-00021310: 6179 280d 0a20 2020 2020 2020 2020 2020  ay(..           
-00021320: 205b 7370 6563 2e73 6861 7065 2e6e 756d   [spec.shape.num
-00021330: 656c 2862 6174 6368 5f73 697a 653d 6261  el(batch_size=ba
-00021340: 7463 685f 7369 7a65 2920 2a20 342e 202f  tch_size) * 4. /
-00021350: 2028 3130 3234 202a 2a20 322e 2920 666f   (1024 ** 2.) fo
-00021360: 7220 7370 6563 2069 6e20 696e 7075 745f  r spec in input_
-00021370: 7370 6563 7320 6966 0d0a 2020 2020 2020  specs if..      
-00021380: 2020 2020 2020 2073 7065 632e 6f70 7469         spec.opti
-00021390: 6f6e 616c 203d 3d20 4661 6c73 6520 616e  onal == False an
-000213a0: 6420 7370 6563 2e73 6861 7065 2069 7320  d spec.shape is 
-000213b0: 6e6f 7420 4e6f 6e65 5d29 2e73 756d 2829  not None]).sum()
-000213c0: 0d0a 2020 2020 2020 2020 746f 7461 6c5f  ..        total_
-000213d0: 6f75 7470 7574 5f73 697a 6520 3d20 6e70  output_size = np
-000213e0: 2e61 6273 2832 2e20 2a20 746f 7461 6c5f  .abs(2. * total_
-000213f0: 6f75 7470 7574 202a 2034 2e20 2f20 2831  output * 4. / (1
-00021400: 3032 3420 2a2a 2032 2e29 2920 2023 2078  024 ** 2.))  # x
-00021410: 3220 666f 7220 6772 6164 6965 6e74 730d  2 for gradients.
-00021420: 0a20 2020 2020 2020 2074 6f74 616c 5f70  .        total_p
-00021430: 6172 616d 735f 7369 7a65 203d 206e 702e  arams_size = np.
-00021440: 6162 7328 746f 7461 6c5f 7061 7261 6d73  abs(total_params
-00021450: 202a 2034 2e20 2f20 2831 3032 3420 2a2a   * 4. / (1024 **
-00021460: 2032 2e29 290d 0a20 2020 2020 2020 2074   2.))..        t
-00021470: 6f74 616c 5f73 697a 6520 3d20 746f 7461  otal_size = tota
-00021480: 6c5f 7061 7261 6d73 5f73 697a 6520 2b20  l_params_size + 
-00021490: 746f 7461 6c5f 6f75 7470 7574 5f73 697a  total_output_siz
-000214a0: 6520 2b20 746f 7461 6c5f 696e 7075 745f  e + total_input_
-000214b0: 7369 7a65 0d0a 0d0a 2020 2020 2020 2020  size....        
-000214c0: 7072 696e 7428 223d 3d3d 3d3d 3d3d 3d3d  print("=========
-000214d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000214e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000214f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00021500: 3d3d 3d3d 3d3d 3d22 290d 0a20 2020 2020  =======")..     
-00021510: 2020 2070 7269 6e74 2822 546f 7461 6c20     print("Total 
-00021520: 7061 7261 6d73 3a20 7b30 3a2c 2e30 667d  params: {0:,.0f}
-00021530: 222e 666f 726d 6174 2874 6f74 616c 5f70  ".format(total_p
-00021540: 6172 616d 735b 305d 292c 666c 7573 683d  arams[0]),flush=
-00021550: 5472 7565 290d 0a20 2020 2020 2020 2070  True)..        p
-00021560: 7269 6e74 2822 5472 6169 6e61 626c 6520  rint("Trainable 
-00021570: 7061 7261 6d73 3a20 7b30 3a2c 2e30 667d  params: {0:,.0f}
-00021580: 222e 666f 726d 6174 2874 7261 696e 6162  ".format(trainab
-00021590: 6c65 5f70 6172 616d 735b 305d 292c 666c  le_params[0]),fl
-000215a0: 7573 683d 5472 7565 290d 0a20 2020 2020  ush=True)..     
-000215b0: 2020 2070 7269 6e74 2822 4e6f 6e2d 7472     print("Non-tr
-000215c0: 6169 6e61 626c 6520 7061 7261 6d73 3a20  ainable params: 
-000215d0: 7b30 3a2c 2e30 667d 222e 666f 726d 6174  {0:,.0f}".format
-000215e0: 2874 6f74 616c 5f70 6172 616d 735b 305d  (total_params[0]
-000215f0: 202d 2074 7261 696e 6162 6c65 5f70 6172   - trainable_par
-00021600: 616d 735b 305d 292c 666c 7573 683d 5472  ams[0]),flush=Tr
-00021610: 7565 290d 0a20 2020 2020 2020 2070 7269  ue)..        pri
-00021620: 6e74 2822 546f 7461 6c20 4d41 4343 3a20  nt("Total MACC: 
-00021630: 7b30 3a2c 2e30 667d 222e 666f 726d 6174  {0:,.0f}".format
-00021640: 286d 6163 635b 305d 292c 666c 7573 683d  (macc[0]),flush=
-00021650: 5472 7565 290d 0a20 2020 2020 2020 2070  True)..        p
-00021660: 7269 6e74 2822 546f 7461 6c20 464c 4f50  rint("Total FLOP
-00021670: 733a 207b 303a 2e35 667d 2047 464c 4f50  s: {0:.5f} GFLOP
-00021680: 7322 2e66 6f72 6d61 7428 6e70 2e72 6f75  s".format(np.rou
-00021690: 6e64 2866 6c6f 7073 202f 2031 302e 202a  nd(flops / 10. *
-000216a0: 2a20 392c 2035 295b 305d 292c 666c 7573  * 9, 5)[0]),flus
-000216b0: 683d 5472 7565 290d 0a20 2020 2020 2020  h=True)..       
-000216c0: 2070 7269 6e74 2822 2d2d 2d2d 2d2d 2d2d   print("--------
-000216d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000216e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000216f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021700: 2d2d 2d2d 2d2d 2d2d 222c 666c 7573 683d  --------",flush=
-00021710: 5472 7565 290d 0a20 2020 2020 2020 2070  True)..        p
-00021720: 7269 6e74 2822 496e 7075 7420 7369 7a65  rint("Input size
-00021730: 2028 4d42 293a 2025 302e 3266 2220 2520   (MB): %0.2f" % 
-00021740: 746f 7461 6c5f 696e 7075 745f 7369 7a65  total_input_size
-00021750: 2c66 6c75 7368 3d54 7275 6529 0d0a 2020  ,flush=True)..  
-00021760: 2020 2020 2020 7072 696e 7428 2246 6f72        print("For
-00021770: 7761 7264 2f62 6163 6b77 6172 6420 7061  ward/backward pa
-00021780: 7373 2073 697a 6520 284d 4229 3a20 2530  ss size (MB): %0
-00021790: 2e32 6622 2025 2074 6f74 616c 5f6f 7574  .2f" % total_out
-000217a0: 7075 745f 7369 7a65 2c66 6c75 7368 3d54  put_size,flush=T
-000217b0: 7275 6529 0d0a 2020 2020 2020 2020 7072  rue)..        pr
-000217c0: 696e 7428 2250 6172 616d 7320 7369 7a65  int("Params size
-000217d0: 2028 4d42 293a 2025 302e 3266 2220 2520   (MB): %0.2f" % 
-000217e0: 746f 7461 6c5f 7061 7261 6d73 5f73 697a  total_params_siz
-000217f0: 652c 666c 7573 683d 5472 7565 290d 0a20  e,flush=True).. 
-00021800: 2020 2020 2020 2070 7269 6e74 2822 4573         print("Es
-00021810: 7469 6d61 7465 6420 546f 7461 6c20 5369  timated Total Si
-00021820: 7a65 2028 4d42 293a 2025 302e 3266 2220  ze (MB): %0.2f" 
-00021830: 2520 746f 7461 6c5f 7369 7a65 2c66 6c75  % total_size,flu
-00021840: 7368 3d54 7275 6529 0d0a 2020 2020 2020  sh=True)..      
-00021850: 2020 7072 696e 7428 222d 2d2d 2d2d 2d2d    print("-------
-00021860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021890: 2d2d 2d2d 2d2d 2d2d 2d22 2c66 6c75 7368  ---------",flush
-000218a0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-000218b0: 2320 7265 7475 726e 2073 756d 6d61 7279  # return summary
-000218c0: 0d0a 2020 2020 2020 2020 6465 6c20 686f  ..        del ho
-000218d0: 6f6b 730d 0a20 2020 2065 7863 6570 7420  oks..    except 
-000218e0: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
-000218f0: 0a20 2020 2020 2020 2064 656c 2068 6f6f  .        del hoo
-00021900: 6b73 0d0a 2020 2020 2020 2020 7072 696e  ks..        prin
-00021910: 7428 6529 0d0a 2020 2020 2020 2020 5072  t(e)..        Pr
-00021920: 696e 7445 7863 6570 7469 6f6e 2829 0d0a  intException()..
-00021930: 0d0a 0d0a 6465 6620 6e6f 726d 616c 697a  ....def normaliz
-00021940: 655f 7061 6464 696e 6728 7061 6464 696e  e_padding(paddin
-00021950: 672c 2072 616e 6b29 3a0d 0a20 2020 2022  g, rank):..    "
-00021960: 2222 0d0a 2020 2020 6e6f 726d 616c 697a  ""..    normaliz
-00021970: 6564 2066 6f72 6d61 7420 6f66 2070 6164  ed format of pad
-00021980: 6469 6e67 2073 686f 756c 6420 6861 7665  ding should have
-00021990: 206c 656e 6774 6820 6571 7561 6c20 746f   length equal to
-000219a0: 2072 616e 6b2b 320d 0a20 2020 2041 6e64   rank+2..    And
-000219b0: 2074 6865 206f 7264 6572 2073 686f 756c   the order shoul
-000219c0: 6420 666f 6c6c 6f77 2074 6865 206f 7264  d follow the ord
-000219d0: 6572 206f 6620 6469 6d65 6e73 696f 6e0d  er of dimension.
-000219e0: 0a20 2020 2065 782e 2043 6f6e 7632 6420  .    ex. Conv2d 
-000219f0: 2872 616e 6b3d 3229 2069 7427 7320 6e6f  (rank=2) it's no
-00021a00: 726d 616c 697a 6564 2066 6f72 6d61 7420  rmalized format 
-00021a10: 6c65 6e67 7468 3a32 2b32 2020 3d3d 3e28  length:2+2  ==>(
-00021a20: 6c65 6674 2c20 7269 6768 742c 746f 7020  left, right,top 
-00021a30: 626f 7474 6f6d 290d 0a0d 0a20 2020 2041  bottom)....    A
-00021a40: 7267 733a 0d0a 2020 2020 2020 2020 7061  rgs:..        pa
-00021a50: 6464 696e 6720 284e 6f6e 652c 2069 6e74  dding (None, int
-00021a60: 2c20 7475 706c 6529 3a0d 0a20 2020 2020  , tuple):..     
-00021a70: 2020 2072 616e 6b20 2869 6e74 293a 0d0a     rank (int):..
-00021a80: 0d0a 2020 2020 5265 7475 726e 733a 0d0a  ..    Returns:..
-00021a90: 2020 2020 2020 2020 7468 6520 6e6f 726d          the norm
-00021aa0: 616c 697a 6564 2066 6f72 6d61 7420 6f66  alized format of
-00021ab0: 2070 6164 6469 6e67 0d0a 0d0a 2020 2020   padding....    
-00021ac0: 4578 616d 706c 6573 3a0d 0a20 2020 2020  Examples:..     
-00021ad0: 2020 203e 3e3e 206e 6f72 6d61 6c69 7a65     >>> normalize
-00021ae0: 5f70 6164 6469 6e67 2828 2831 2c30 292c  _padding(((1,0),
-00021af0: 2831 2c30 2929 2c32 290d 0a20 2020 2020  (1,0)),2)..     
-00021b00: 2020 2028 312c 2030 2c20 312c 2030 290d     (1, 0, 1, 0).
-00021b10: 0a20 2020 2020 2020 203e 3e3e 206e 6f72  .        >>> nor
-00021b20: 6d61 6c69 7a65 5f70 6164 6469 6e67 2828  malize_padding((
-00021b30: 312c 3029 2c32 290d 0a20 2020 2020 2020  1,0),2)..       
-00021b40: 2028 302c 2030 2c20 312c 2031 290d 0a20   (0, 0, 1, 1).. 
-00021b50: 2020 2022 2222 0d0a 2020 2020 6966 2070     """..    if p
-00021b60: 6164 6469 6e67 2069 7320 4e6f 6e65 3a0d  adding is None:.
-00021b70: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
-00021b80: 203d 2028 302c 2920 2a20 2832 202a 2072   = (0,) * (2 * r
-00021b90: 616e 6b29 0d0a 2020 2020 656c 6966 2069  ank)..    elif i
-00021ba0: 7369 6e73 7461 6e63 6528 7061 6464 696e  sinstance(paddin
-00021bb0: 672c 2069 6e74 293a 0d0a 2020 2020 2020  g, int):..      
-00021bc0: 2020 7061 6464 696e 6720 3d20 2870 6164    padding = (pad
-00021bd0: 6469 6e67 2c29 202a 2028 3220 2a20 7261  ding,) * (2 * ra
-00021be0: 6e6b 290d 0a20 2020 2065 6c69 6620 6973  nk)..    elif is
-00021bf0: 696e 7374 616e 6365 2870 6164 6469 6e67  instance(padding
-00021c00: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00021c10: 2061 6e64 206c 656e 2870 6164 6469 6e67   and len(padding
-00021c20: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
-00021c30: 2070 6164 6469 6e67 203d 2070 6164 6469   padding = paddi
-00021c40: 6e67 202a 2028 3220 2a20 7261 6e6b 290d  ng * (2 * rank).
-00021c50: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-00021c60: 616e 6365 2870 6164 6469 6e67 2c20 286c  ance(padding, (l
-00021c70: 6973 742c 2074 7570 6c65 2929 2061 6e64  ist, tuple)) and
-00021c80: 206c 656e 2870 6164 6469 6e67 2920 3d3d   len(padding) ==
-00021c90: 2072 616e 6b20 616e 6420 6973 696e 7374   rank and isinst
-00021ca0: 616e 6365 2870 6164 6469 6e67 5b30 5d2c  ance(padding[0],
-00021cb0: 2069 6e74 293a 0d0a 2020 2020 2020 2020   int):..        
-00021cc0: 2320 7261 6e6b 3d32 2028 312c 3129 3d3e  # rank=2 (1,1)=>
-00021cd0: 2831 2c31 2c31 2c31 2920 2020 2831 2c30  (1,1,1,1)   (1,0
-00021ce0: 293d 3e28 302c 302c 312c 3129 0d0a 2020  )=>(0,0,1,1)..  
-00021cf0: 2020 2020 2020 7265 7665 7273 6564 5f70        reversed_p
-00021d00: 6164 6469 6e67 203d 206c 6973 7428 7061  adding = list(pa
-00021d10: 6464 696e 6729 0d0a 2020 2020 2020 2020  dding)..        
-00021d20: 7265 7665 7273 6564 5f70 6164 6469 6e67  reversed_padding
-00021d30: 2e72 6576 6572 7365 2829 0d0a 2020 2020  .reverse()..    
-00021d40: 2020 2020 7265 7475 726e 5f70 6164 6469      return_paddi
-00021d50: 6e67 203d 205b 5d0d 0a20 2020 2020 2020  ng = []..       
-00021d60: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00021d70: 7261 6e6b 293a 0d0a 2020 2020 2020 2020  rank):..        
-00021d80: 2020 2020 7265 7475 726e 5f70 6164 6469      return_paddi
-00021d90: 6e67 2e61 7070 656e 6428 7265 7665 7273  ng.append(revers
-00021da0: 6564 5f70 6164 6469 6e67 5b69 5d29 0d0a  ed_padding[i])..
-00021db0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00021dc0: 726e 5f70 6164 6469 6e67 2e61 7070 656e  rn_padding.appen
-00021dd0: 6428 7265 7665 7273 6564 5f70 6164 6469  d(reversed_paddi
-00021de0: 6e67 5b69 5d29 0d0a 0d0a 2020 2020 2020  ng[i])....      
-00021df0: 2020 7061 6464 696e 6720 3d20 7475 706c    padding = tupl
-00021e00: 6528 7265 7475 726e 5f70 6164 6469 6e67  e(return_padding
-00021e10: 290d 0a20 2020 2065 6c69 6620 6973 696e  )..    elif isin
-00021e20: 7374 616e 6365 2870 6164 6469 6e67 2c20  stance(padding, 
-00021e30: 286c 6973 742c 2074 7570 6c65 2929 2061  (list, tuple)) a
-00021e40: 6e64 206c 656e 2870 6164 6469 6e67 2920  nd len(padding) 
-00021e50: 3d3d 2072 616e 6b20 616e 6420 6973 696e  == rank and isin
-00021e60: 7374 616e 6365 2870 6164 6469 6e67 5b30  stance(padding[0
-00021e70: 5d2c 2028 6c69 7374 2c20 7475 706c 6529  ], (list, tuple)
-00021e80: 293a 0d0a 2020 2020 2020 2020 2320 7261  ):..        # ra
-00021e90: 6e6b 3d32 2020 2828 312c 3029 2c28 312c  nk=2  ((1,0),(1,
-00021ea0: 3029 3d3e 2831 2c30 2c31 2c30 290d 0a20  0)=>(1,0,1,0).. 
-00021eb0: 2020 2020 2020 2070 6164 6469 6e67 203d         padding =
-00021ec0: 2074 7570 6c65 286c 6973 7428 6974 6572   tuple(list(iter
-00021ed0: 746f 6f6c 732e 6368 6169 6e28 2a6c 6973  tools.chain(*lis
-00021ee0: 7428 7061 6464 696e 6729 2929 290d 0a20  t(padding)))).. 
-00021ef0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00021f00: 6365 2870 6164 6469 6e67 2c20 286c 6973  ce(padding, (lis
-00021f10: 742c 2074 7570 6c65 2929 2061 6e64 206c  t, tuple)) and l
-00021f20: 656e 2870 6164 6469 6e67 2920 3d3d 2032  en(padding) == 2
-00021f30: 202a 2072 616e 6b20 616e 6420 6973 696e   * rank and isin
-00021f40: 7374 616e 6365 2870 6164 6469 6e67 5b30  stance(padding[0
-00021f50: 5d2c 2069 6e74 293a 0d0a 2020 2020 2020  ], int):..      
-00021f60: 2020 7061 6464 696e 6720 3d20 7061 6464    padding = padd
-00021f70: 696e 670d 0a20 2020 2072 6574 7572 6e20  ing..    return 
-00021f80: 7061 6464 696e 670d 0a0d 0a0d 0a64 6566  padding......def
-00021f90: 2070 7269 6e74 5f6d 656d 5f73 7461 636b   print_mem_stack
-00021fa0: 2829 3a20 2023 2070 7261 676d 613a 206e  ():  # pragma: n
-00021fb0: 6f20 636f 7665 720d 0a20 2020 2022 2222  o cover..    """
-00021fc0: 0d0a 0d0a 2020 2020 2222 220d 0a20 2020  ....    """..   
-00021fd0: 2066 6f72 206f 626a 2069 6e20 6763 2e67   for obj in gc.g
-00021fe0: 6574 5f6f 626a 6563 7473 2829 3a0d 0a20  et_objects():.. 
-00021ff0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00022000: 2020 2020 2020 2020 2069 6620 746f 7263           if torc
-00022010: 682e 6973 5f74 656e 736f 7228 6f62 6a29  h.is_tensor(obj)
-00022020: 206f 7220 2868 6173 6174 7472 286f 626a   or (hasattr(obj
-00022030: 2c20 2764 6174 6127 2920 616e 6420 746f  , 'data') and to
-00022040: 7263 682e 6973 5f74 656e 736f 7228 6f62  rch.is_tensor(ob
-00022050: 6a2e 6461 7461 2929 3a0d 0a20 2020 2020  j.data)):..     
-00022060: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00022070: 2874 7970 6528 6f62 6a29 2c20 6f62 6a2e  (type(obj), obj.
-00022080: 7369 7a65 2829 290d 0a20 2020 2020 2020  size())..       
-00022090: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000220a0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-000220b0: 7061 7373 0d0a 0d0a 0d0a 6465 6620 636f  pass......def co
-000220c0: 756e 745f 6d65 6d5f 6974 656d 7328 293a  unt_mem_items():
-000220d0: 2020 2320 7072 6167 6d61 3a20 6e6f 2063    # pragma: no c
-000220e0: 6f76 6572 0d0a 2020 2020 6e62 5f70 6172  over..    nb_par
-000220f0: 616d 7320 3d20 300d 0a20 2020 206e 625f  ams = 0..    nb_
-00022100: 7465 6e73 6f72 7320 3d20 300d 0a20 2020  tensors = 0..   
-00022110: 2066 6f72 206f 626a 2069 6e20 6763 2e67   for obj in gc.g
-00022120: 6574 5f6f 626a 6563 7473 2829 3a0d 0a20  et_objects():.. 
-00022130: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00022140: 2020 2020 2020 2020 2069 6620 746f 7263           if torc
-00022150: 682e 6973 5f74 656e 736f 7228 6f62 6a29  h.is_tensor(obj)
-00022160: 206f 7220 2868 6173 6174 7472 286f 626a   or (hasattr(obj
-00022170: 2c20 2764 6174 6127 2920 616e 6420 746f  , 'data') and to
-00022180: 7263 682e 6973 5f74 656e 736f 7228 6f62  rch.is_tensor(ob
-00022190: 6a2e 6461 7461 2929 3a0d 0a20 2020 2020  j.data)):..     
-000221a0: 2020 2020 2020 2020 2020 206f 626a 5f74             obj_t
-000221b0: 7970 6520 3d20 7374 7228 7479 7065 286f  ype = str(type(o
-000221c0: 626a 2929 0d0a 2020 2020 2020 2020 2020  bj))..          
-000221d0: 2020 2020 2020 6966 2027 7061 7261 6d65        if 'parame
-000221e0: 7465 7227 2069 6e20 6f62 6a5f 7479 7065  ter' in obj_type
-000221f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00022200: 2020 2020 2020 206e 625f 7061 7261 6d73         nb_params
-00022210: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-00022220: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00022230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022240: 2020 6e62 5f74 656e 736f 7273 202b 3d20    nb_tensors += 
-00022250: 310d 0a20 2020 2020 2020 2065 7863 6570  1..        excep
-00022260: 7420 4578 6365 7074 696f 6e3a 0d0a 2020  t Exception:..  
-00022270: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-00022280: 0d0a 2020 2020 7265 7475 726e 206e 625f  ..    return nb_
-00022290: 7061 7261 6d73 2c20 6e62 5f74 656e 736f  params, nb_tenso
-000222a0: 7273 0d0a 0d0a 0d0a 6465 6620 6765 745f  rs......def get_
-000222b0: 6875 6d61 6e5f 7265 6164 6162 6c65 5f63  human_readable_c
-000222c0: 6f75 6e74 286e 756d 6265 7229 3a0d 0a20  ount(number):.. 
-000222d0: 2020 2022 2222 0d0a 2020 2020 4162 6272     """..    Abbr
-000222e0: 6576 6961 7465 7320 616e 2069 6e74 6567  eviates an integ
-000222f0: 6572 206e 756d 6265 7220 7769 7468 204b  er number with K
-00022300: 2c20 4d2c 2042 2c20 5420 666f 7220 7468  , M, B, T for th
-00022310: 6f75 7361 6e64 732c 206d 696c 6c69 6f6e  ousands, million
-00022320: 732c 0d0a 2020 2020 6269 6c6c 696f 6e73  s,..    billions
-00022330: 2061 6e64 2074 7269 6c6c 696f 6e73 2c20   and trillions, 
-00022340: 7265 7370 6563 7469 7665 6c79 2e0d 0a20  respectively... 
-00022350: 2020 2045 7861 6d70 6c65 733a 0d0a 2020     Examples:..  
-00022360: 2020 2020 2020 3132 3320 2020 2020 2d3e        123     ->
-00022370: 2031 3233 0d0a 2020 2020 2020 2020 3132   123..        12
-00022380: 3334 2020 2020 2d3e 2031 204b 2020 2020  34    -> 1 K    
-00022390: 2020 2028 6f6e 6520 7468 6f75 7361 6e64     (one thousand
-000223a0: 290d 0a20 2020 2020 2020 2032 6536 2020  )..        2e6  
-000223b0: 2020 202d 3e20 3220 4d20 2020 2020 2020     -> 2 M       
-000223c0: 2874 776f 206d 696c 6c69 6f6e 290d 0a20  (two million).. 
-000223d0: 2020 2020 2020 2033 6539 2020 2020 202d         3e9     -
-000223e0: 3e20 3320 4220 2020 2020 2020 2874 6872  > 3 B       (thr
-000223f0: 6565 2062 696c 6c69 6f6e 290d 0a20 2020  ee billion)..   
-00022400: 2020 2020 2034 6531 3220 2020 202d 3e20       4e12    -> 
-00022410: 3420 5420 2020 2020 2020 2866 6f75 7220  4 T       (four 
-00022420: 7472 696c 6c69 6f6e 290d 0a20 2020 2020  trillion)..     
-00022430: 2020 2035 6531 3520 2020 202d 3e20 352c     5e15    -> 5,
-00022440: 3030 3020 540d 0a20 2020 203a 7061 7261  000 T..    :para
-00022450: 6d20 6e75 6d62 6572 3a20 6120 706f 7369  m number: a posi
-00022460: 7469 7665 2069 6e74 6567 6572 206e 756d  tive integer num
-00022470: 6265 720d 0a20 2020 203a 7265 7475 726e  ber..    :return
-00022480: 7320 6120 7374 7269 6e67 2066 6f72 6d61  s a string forma
-00022490: 7474 6564 2061 6363 6f72 6469 6e67 2074  tted according t
-000224a0: 6f20 7468 6520 7061 7474 6572 6e20 6465  o the pattern de
-000224b0: 7363 7269 6265 6420 6162 6f76 652e 0d0a  scribed above...
-000224c0: 2020 2020 2222 220d 0a20 2020 2061 7373      """..    ass
-000224d0: 6572 7420 6e75 6d62 6572 203e 3d20 300d  ert number >= 0.
-000224e0: 0a20 2020 206c 6162 656c 7320 3d20 5b27  .    labels = ['
-000224f0: 2027 2c20 274b 272c 2027 4d27 2c20 2742   ', 'K', 'M', 'B
-00022500: 272c 2027 5427 5d0d 0a20 2020 206e 756d  ', 'T']..    num
-00022510: 5f64 6967 6974 7320 3d20 696e 7428 6e70  _digits = int(np
-00022520: 2e66 6c6f 6f72 286e 702e 6c6f 6731 3028  .floor(np.log10(
-00022530: 6e75 6d62 6572 2929 202b 2031 2069 6620  number)) + 1 if 
-00022540: 6e75 6d62 6572 203e 2030 2065 6c73 6520  number > 0 else 
-00022550: 3129 0d0a 2020 2020 6e75 6d5f 6772 6f75  1)..    num_grou
-00022560: 7073 203d 2069 6e74 286e 702e 6365 696c  ps = int(np.ceil
-00022570: 286e 756d 5f64 6967 6974 7320 2f20 3329  (num_digits / 3)
-00022580: 290d 0a20 2020 206e 756d 5f67 726f 7570  )..    num_group
-00022590: 7320 3d20 6d69 6e28 6e75 6d5f 6772 6f75  s = min(num_grou
-000225a0: 7073 2c20 6c65 6e28 6c61 6265 6c73 2929  ps, len(labels))
-000225b0: 2020 2320 646f 6e27 7420 6162 6272 6576    # don't abbrev
-000225c0: 6961 7465 2062 6579 6f6e 6420 7472 696c  iate beyond tril
-000225d0: 6c69 6f6e 730d 0a20 2020 2073 6869 6674  lions..    shift
-000225e0: 203d 202d 3320 2a20 286e 756d 5f67 726f   = -3 * (num_gro
-000225f0: 7570 7320 2d20 3129 0d0a 2020 2020 6e75  ups - 1)..    nu
-00022600: 6d62 6572 203d 206e 756d 6265 7220 2a20  mber = number * 
-00022610: 2831 3020 2a2a 2073 6869 6674 290d 0a20  (10 ** shift).. 
-00022620: 2020 2069 6e64 6578 203d 206e 756d 5f67     index = num_g
-00022630: 726f 7570 7320 2d20 310d 0a20 2020 2072  roups - 1..    r
-00022640: 6574 7572 6e20 277b 303a 2c64 7d20 7b31  eturn '{0:,d} {1
-00022650: 7d27 2e66 6f72 6d61 7428 696e 7428 6e75  }'.format(int(nu
-00022660: 6d62 6572 292c 206c 6162 656c 735b 696e  mber), labels[in
-00022670: 6465 785d 290d 0a0d 0a0d 0a64 6566 2074  dex])......def t
-00022680: 7279 5f6d 6170 5f61 7267 735f 616e 645f  ry_map_args_and_
-00022690: 6361 6c6c 2866 6e2c 2064 6174 613a 204f  call(fn, data: O
-000226a0: 7264 6572 6564 4469 6374 2c20 6461 7461  rderedDict, data
-000226b0: 5f66 6565 643d 4e6f 6e65 2c20 6973 5f61  _feed=None, is_a
-000226c0: 7574 6f63 6173 745f 656e 6162 6c65 643d  utocast_enabled=
-000226d0: 4661 6c73 6529 3a0d 0a20 2020 2022 2222  False):..    """
-000226e0: 5468 6973 2066 756e 6374 696f 6e20 6973  This function is
-000226f0: 2074 6865 2063 6f72 6520 6675 6e63 7469   the core functi
-00022700: 6f6e 2066 6f72 206d 6170 7069 6e67 2063  on for mapping c
-00022710: 616c 6c61 626c 6520 616e 6420 6172 676d  allable and argm
-00022720: 656e 7473 0d0a 0d0a 2020 2020 4172 6773  ents....    Args
-00022730: 3a0d 0a0d 0a20 2020 2020 2020 2066 6e20  :....        fn 
-00022740: 2863 616c 6c61 626c 6529 3a20 7468 6520  (callable): the 
-00022750: 6361 6c6c 6162 6c65 2c20 6d61 7962 6520  callable, maybe 
-00022760: 6675 6e63 7469 6f6e 7320 6f72 206c 6179  functions or lay
-00022770: 6572 730d 0a20 2020 2020 2020 2064 6174  ers..        dat
-00022780: 6120 284f 7264 6572 6564 4469 6374 293a  a (OrderedDict):
-00022790: 2054 6865 206b 6579 2d76 616c 7565 2070   The key-value p
-000227a0: 6169 7220 666f 7220 6176 6169 6c61 626c  air for availabl
-000227b0: 6520 6461 7461 2e0d 0a20 2020 2020 2020  e data...       
-000227c0: 2064 6174 615f 6665 6564 2028 4f72 6465   data_feed (Orde
-000227d0: 7265 6444 6963 7429 3a20 5468 6520 7265  redDict): The re
-000227e0: 6c61 7469 6f6e 2062 6574 7765 656e 2063  lation between c
-000227f0: 616c 6c61 626c 6520 6172 676d 656e 7473  allable argments
-00022800: 2028 6b65 7929 2061 6e64 2064 6174 6120   (key) and data 
-00022810: 2876 616c 7565 290d 0a20 2020 2020 2020  (value)..       
-00022820: 2069 735f 6175 746f 6361 7374 5f65 6e61   is_autocast_ena
-00022830: 626c 6564 2028 626f 6f6c 293a 0d0a 0d0a  bled (bool):....
-00022840: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-00022850: 2020 2020 2020 5468 6520 7265 7375 6c74        The result
-00022860: 206f 6620 7468 6520 6361 6c6c 6162 6c65   of the callable
-00022870: 2062 6173 6520 6f6e 2064 6174 615f 6665   base on data_fe
-00022880: 6564 0d0a 0d0a 2020 2020 2222 220d 0a20  ed....    """.. 
-00022890: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-000228a0: 2866 6e2c 2074 6f72 6368 2e54 656e 736f  (fn, torch.Tenso
-000228b0: 7229 3a0d 0a20 2020 2020 2020 2072 6574  r):..        ret
-000228c0: 7572 6e20 666e 0d0a 2020 2020 656c 7365  urn fn..    else
-000228d0: 3a0d 0a20 2020 2020 2020 2074 7279 3a0d  :..        try:.
-000228e0: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-000228f0: 5f6d 6170 203d 204f 7264 6572 6564 4469  _map = OrderedDi
-00022900: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
-00022910: 2020 6f75 7420 3d20 4e6f 6e65 0d0a 2020    out = None..  
-00022920: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00022930: 6e73 7461 6e63 6528 666e 2c20 4c61 7965  nstance(fn, Laye
-00022940: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-00022950: 2020 2020 205f 6465 7669 6365 203d 2066       _device = f
-00022960: 6e2e 6765 745f 726f 6f74 2829 2e64 6576  n.get_root().dev
-00022970: 6963 650d 0a20 2020 2020 2020 2020 2020  ice..           
-00022980: 2020 2020 205f 7369 676e 6174 7572 6520       _signature 
-00022990: 3d20 666e 2e5f 7369 676e 6174 7572 650d  = fn._signature.
-000229a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000229b0: 2069 6620 4e6f 6e65 2069 6e20 666e 2e5f   if None in fn._
-000229c0: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
-000229d0: 2e76 616c 7565 5f6c 6973 743a 0d0a 2020  .value_list:..  
-000229e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229f0: 2020 5f73 6967 6e61 7475 7265 203d 2067    _signature = g
-00022a00: 6574 5f73 6967 6e61 7475 7265 2866 6e29  et_signature(fn)
-00022a10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022a20: 2020 666f 7220 6172 6720 696e 205f 7369    for arg in _si
-00022a30: 676e 6174 7572 652e 696e 7075 7473 2e6b  gnature.inputs.k
-00022a40: 6579 5f6c 6973 743a 0d0a 2020 2020 2020  ey_list:..      
-00022a50: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00022a60: 5f6f 7074 696f 6e61 6c20 3d20 666e 2e73  _optional = fn.s
-00022a70: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
-00022a80: 6172 675d 2e6f 7074 696f 6e61 6c20 6966  arg].optional if
-00022a90: 2069 7369 6e73 7461 6e63 6528 666e 2e73   isinstance(fn.s
-00022aa0: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
-00022ab0: 6172 675d 2c0d 0a20 2020 2020 2020 2020  arg],..         
-00022ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b00: 2020 2020 2020 2020 2054 656e 736f 7253           TensorS
-00022b10: 7065 6329 2065 6c73 6520 4661 6c73 650d  pec) else False.
-00022b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b30: 2020 2020 2064 6566 6175 6c74 203d 2066       default = f
-00022b40: 6e2e 7369 676e 6174 7572 652e 696e 7075  n.signature.inpu
-00022b50: 7473 5b61 7267 5d2e 6465 6661 756c 7420  ts[arg].default 
-00022b60: 6966 2069 7369 6e73 7461 6e63 6528 666e  if isinstance(fn
-00022b70: 2e73 6967 6e61 7475 7265 2e69 6e70 7574  .signature.input
-00022b80: 735b 6172 675d 2c0d 0a20 2020 2020 2020  s[arg],..       
-00022b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bd0: 2020 2020 2020 5465 6e73 6f72 5370 6563        TensorSpec
-00022be0: 2920 656c 7365 204e 6f6e 650d 0a20 2020  ) else None..   
+00020f40: 2020 2020 2020 2020 2020 2020 2022 2022               " "
+00020f50: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00020f60: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+00020f70: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+00020f80: 6269 6173 225d 2e69 7465 6d5f 6c69 7374  bias"].item_list
+00020f90: 5b6e 5d20 6966 206e 203c 206c 656e 2873  [n] if n < len(s
+00020fa0: 756d 6d61 7279 5b6c 6179 6572 5d5b 2262  ummary[layer]["b
+00020fb0: 6961 7322 5d29 2065 6c73 6520 2720 2729  ias"]) else ' ')
+00020fc0: 2e72 6570 6c61 6365 280d 0a20 2020 2020  .replace(..     
+00020fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fe0: 2020 2020 2020 2027 2827 2c20 2727 292e         '(', '').
+00020ff0: 7265 706c 6163 6528 2729 272c 2027 2729  replace(')', '')
+00021000: 2e6c 6a75 7374 2838 2c20 2220 2229 2c20  .ljust(8, " "), 
+00021010: 2220 222c 2022 2022 290d 0a20 2020 2020  " ", " ")..     
+00021020: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00021030: 696e 655f 6e65 7720 3d20 6c69 6e65 5f6e  ine_new = line_n
+00021040: 6577 202b 2027 5c6e 2720 2b20 6c69 6e65  ew + '\n' + line
+00021050: 5f6e 6577 5f61 6464 0d0a 0d0a 2020 2020  _new_add....    
+00021060: 2020 2020 2020 2020 746f 7461 6c5f 7061          total_pa
+00021070: 7261 6d73 202b 3d20 7375 6d6d 6172 795b  rams += summary[
+00021080: 6c61 7965 725d 5b22 6e62 5f70 6172 616d  layer]["nb_param
+00021090: 7322 5d0d 0a20 2020 2020 2020 2020 2020  s"]..           
+000210a0: 2066 6c6f 7073 202b 3d20 666c 6f61 7428   flops += float(
+000210b0: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+000210c0: 666c 6f70 7322 5d29 0d0a 2020 2020 2020  flops"])..      
+000210d0: 2020 2020 2020 6d61 6363 202b 3d20 666c        macc += fl
+000210e0: 6f61 7428 7375 6d6d 6172 795b 6c61 7965  oat(summary[laye
+000210f0: 725d 5b22 6d61 6363 225d 2e73 756d 2829  r]["macc"].sum()
+00021100: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00021110: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00021120: 2020 2020 2074 6f74 616c 5f6f 7574 7075       total_outpu
+00021130: 7420 2b3d 2073 756d 6d61 7279 5b6c 6179  t += summary[lay
+00021140: 6572 5d5b 226f 7574 7075 745f 7368 6170  er]["output_shap
+00021150: 6522 5d2e 6e75 6d65 6c28 6261 7463 685f  e"].numel(batch_
+00021160: 7369 7a65 3d62 6174 6368 5f73 697a 6529  size=batch_size)
+00021170: 2069 6620 6973 696e 7374 616e 6365 280d   if isinstance(.
+00021180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021190: 2020 2020 2073 756d 6d61 7279 5b6c 6179       summary[lay
+000211a0: 6572 5d5b 226f 7574 7075 745f 7368 6170  er]["output_shap
+000211b0: 6522 5d2c 2054 656e 736f 7253 6861 7065  e"], TensorShape
+000211c0: 2920 656c 7365 206e 702e 6e64 6172 7261  ) else np.ndarra
+000211d0: 7928 0d0a 2020 2020 2020 2020 2020 2020  y(..            
+000211e0: 2020 2020 2020 2020 5b73 6870 2e6e 756d          [shp.num
+000211f0: 656c 2862 6174 6368 5f73 697a 653d 6261  el(batch_size=ba
+00021200: 7463 685f 7369 7a65 2920 666f 7220 7368  tch_size) for sh
+00021210: 7020 696e 2073 756d 6d61 7279 5b6c 6179  p in summary[lay
+00021220: 6572 5d5b 226f 7574 7075 745f 7368 6170  er]["output_shap
+00021230: 6522 5d5d 292e 7375 6d28 290d 0a20 2020  e"]]).sum()..   
+00021240: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00021250: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
+00021260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021270: 2070 7269 6e74 286c 6179 6572 290d 0a0d   print(layer)...
+00021280: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00021290: 6620 2274 7261 696e 6162 6c65 2220 696e  f "trainable" in
+000212a0: 2073 756d 6d61 7279 5b6c 6179 6572 5d3a   summary[layer]:
+000212b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000212c0: 2020 7472 6169 6e61 626c 655f 7061 7261    trainable_para
+000212d0: 6d73 202b 3d20 7375 6d6d 6172 795b 6c61  ms += summary[la
+000212e0: 7965 725d 5b22 7472 6169 6e61 626c 6522  yer]["trainable"
+000212f0: 5d0d 0a20 2020 2020 2020 2020 2020 2070  ]..            p
+00021300: 7269 6e74 286c 696e 655f 6e65 7729 0d0a  rint(line_new)..
+00021310: 0d0a 2020 2020 2020 2020 2320 6173 7375  ..        # assu
+00021320: 6d65 2034 2062 7974 6573 2f6e 756d 6265  me 4 bytes/numbe
+00021330: 7220 2866 6c6f 6174 206f 6e20 6375 6461  r (float on cuda
+00021340: 292e 0d0a 2020 2020 2020 2020 746f 7461  )...        tota
+00021350: 6c5f 696e 7075 745f 7369 7a65 203d 206e  l_input_size = n
+00021360: 702e 6173 6172 7261 7928 0d0a 2020 2020  p.asarray(..    
+00021370: 2020 2020 2020 2020 5b73 7065 632e 7368          [spec.sh
+00021380: 6170 652e 6e75 6d65 6c28 6261 7463 685f  ape.numel(batch_
+00021390: 7369 7a65 3d62 6174 6368 5f73 697a 6529  size=batch_size)
+000213a0: 202a 2034 2e20 2f20 2831 3032 3420 2a2a   * 4. / (1024 **
+000213b0: 2032 2e29 2066 6f72 2073 7065 6320 696e   2.) for spec in
+000213c0: 2069 6e70 7574 5f73 7065 6373 2069 660d   input_specs if.
+000213d0: 0a20 2020 2020 2020 2020 2020 2020 7370  .             sp
+000213e0: 6563 2e6f 7074 696f 6e61 6c20 3d3d 2046  ec.optional == F
+000213f0: 616c 7365 2061 6e64 2073 7065 632e 7368  alse and spec.sh
+00021400: 6170 6520 6973 206e 6f74 204e 6f6e 655d  ape is not None]
+00021410: 292e 7375 6d28 290d 0a20 2020 2020 2020  ).sum()..       
+00021420: 2074 6f74 616c 5f6f 7574 7075 745f 7369   total_output_si
+00021430: 7a65 203d 206e 702e 6162 7328 322e 202a  ze = np.abs(2. *
+00021440: 2074 6f74 616c 5f6f 7574 7075 7420 2a20   total_output * 
+00021450: 342e 202f 2028 3130 3234 202a 2a20 322e  4. / (1024 ** 2.
+00021460: 2929 2020 2320 7832 2066 6f72 2067 7261  ))  # x2 for gra
+00021470: 6469 656e 7473 0d0a 2020 2020 2020 2020  dients..        
+00021480: 746f 7461 6c5f 7061 7261 6d73 5f73 697a  total_params_siz
+00021490: 6520 3d20 6e70 2e61 6273 2874 6f74 616c  e = np.abs(total
+000214a0: 5f70 6172 616d 7320 2a20 342e 202f 2028  _params * 4. / (
+000214b0: 3130 3234 202a 2a20 322e 2929 0d0a 2020  1024 ** 2.))..  
+000214c0: 2020 2020 2020 746f 7461 6c5f 7369 7a65        total_size
+000214d0: 203d 2074 6f74 616c 5f70 6172 616d 735f   = total_params_
+000214e0: 7369 7a65 202b 2074 6f74 616c 5f6f 7574  size + total_out
+000214f0: 7075 745f 7369 7a65 202b 2074 6f74 616c  put_size + total
+00021500: 5f69 6e70 7574 5f73 697a 650d 0a0d 0a20  _input_size.... 
+00021510: 2020 2020 2020 2070 7269 6e74 2822 3d3d         print("==
+00021520: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021530: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021540: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021550: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 2229  ==============")
+00021560: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00021570: 2254 6f74 616c 2070 6172 616d 733a 207b  "Total params: {
+00021580: 303a 2c2e 3066 7d22 2e66 6f72 6d61 7428  0:,.0f}".format(
+00021590: 746f 7461 6c5f 7061 7261 6d73 5b30 5d29  total_params[0])
+000215a0: 2c66 6c75 7368 3d54 7275 6529 0d0a 2020  ,flush=True)..  
+000215b0: 2020 2020 2020 7072 696e 7428 2254 7261        print("Tra
+000215c0: 696e 6162 6c65 2070 6172 616d 733a 207b  inable params: {
+000215d0: 303a 2c2e 3066 7d22 2e66 6f72 6d61 7428  0:,.0f}".format(
+000215e0: 7472 6169 6e61 626c 655f 7061 7261 6d73  trainable_params
+000215f0: 5b30 5d29 2c66 6c75 7368 3d54 7275 6529  [0]),flush=True)
+00021600: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00021610: 224e 6f6e 2d74 7261 696e 6162 6c65 2070  "Non-trainable p
+00021620: 6172 616d 733a 207b 303a 2c2e 3066 7d22  arams: {0:,.0f}"
+00021630: 2e66 6f72 6d61 7428 746f 7461 6c5f 7061  .format(total_pa
+00021640: 7261 6d73 5b30 5d20 2d20 7472 6169 6e61  rams[0] - traina
+00021650: 626c 655f 7061 7261 6d73 5b30 5d29 2c66  ble_params[0]),f
+00021660: 6c75 7368 3d54 7275 6529 0d0a 2020 2020  lush=True)..    
+00021670: 2020 2020 7072 696e 7428 2254 6f74 616c      print("Total
+00021680: 204d 4143 433a 207b 303a 2c2e 3066 7d22   MACC: {0:,.0f}"
+00021690: 2e66 6f72 6d61 7428 6d61 6363 5b30 5d29  .format(macc[0])
+000216a0: 2c66 6c75 7368 3d54 7275 6529 0d0a 2020  ,flush=True)..  
+000216b0: 2020 2020 2020 7072 696e 7428 2254 6f74        print("Tot
+000216c0: 616c 2046 4c4f 5073 3a20 7b30 3a2e 3566  al FLOPs: {0:.5f
+000216d0: 7d20 4746 4c4f 5073 222e 666f 726d 6174  } GFLOPs".format
+000216e0: 286e 702e 726f 756e 6428 666c 6f70 7320  (np.round(flops 
+000216f0: 2f20 3130 2e20 2a2a 2039 2c20 3529 5b30  / 10. ** 9, 5)[0
+00021700: 5d29 2c66 6c75 7368 3d54 7275 6529 0d0a  ]),flush=True)..
+00021710: 2020 2020 2020 2020 7072 696e 7428 222d          print("-
+00021720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00021730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00021740: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00021750: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d22  ---------------"
+00021760: 2c66 6c75 7368 3d54 7275 6529 0d0a 2020  ,flush=True)..  
+00021770: 2020 2020 2020 7072 696e 7428 2249 6e70        print("Inp
+00021780: 7574 2073 697a 6520 284d 4229 3a20 2530  ut size (MB): %0
+00021790: 2e32 6622 2025 2074 6f74 616c 5f69 6e70  .2f" % total_inp
+000217a0: 7574 5f73 697a 652c 666c 7573 683d 5472  ut_size,flush=Tr
+000217b0: 7565 290d 0a20 2020 2020 2020 2070 7269  ue)..        pri
+000217c0: 6e74 2822 466f 7277 6172 642f 6261 636b  nt("Forward/back
+000217d0: 7761 7264 2070 6173 7320 7369 7a65 2028  ward pass size (
+000217e0: 4d42 293a 2025 302e 3266 2220 2520 746f  MB): %0.2f" % to
+000217f0: 7461 6c5f 6f75 7470 7574 5f73 697a 652c  tal_output_size,
+00021800: 666c 7573 683d 5472 7565 290d 0a20 2020  flush=True)..   
+00021810: 2020 2020 2070 7269 6e74 2822 5061 7261       print("Para
+00021820: 6d73 2073 697a 6520 284d 4229 3a20 2530  ms size (MB): %0
+00021830: 2e32 6622 2025 2074 6f74 616c 5f70 6172  .2f" % total_par
+00021840: 616d 735f 7369 7a65 2c66 6c75 7368 3d54  ams_size,flush=T
+00021850: 7275 6529 0d0a 2020 2020 2020 2020 7072  rue)..        pr
+00021860: 696e 7428 2245 7374 696d 6174 6564 2054  int("Estimated T
+00021870: 6f74 616c 2053 697a 6520 284d 4229 3a20  otal Size (MB): 
+00021880: 2530 2e32 6622 2025 2074 6f74 616c 5f73  %0.2f" % total_s
+00021890: 697a 652c 666c 7573 683d 5472 7565 290d  ize,flush=True).
+000218a0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+000218b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000218c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000218d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000218e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000218f0: 222c 666c 7573 683d 5472 7565 290d 0a20  ",flush=True).. 
+00021900: 2020 2020 2020 2023 2072 6574 7572 6e20         # return 
+00021910: 7375 6d6d 6172 790d 0a20 2020 2020 2020  summary..       
+00021920: 2064 656c 2068 6f6f 6b73 0d0a 2020 2020   del hooks..    
+00021930: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00021940: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
+00021950: 6465 6c20 686f 6f6b 730d 0a20 2020 2020  del hooks..     
+00021960: 2020 2070 7269 6e74 2865 290d 0a20 2020     print(e)..   
+00021970: 2020 2020 2050 7269 6e74 4578 6365 7074       PrintExcept
+00021980: 696f 6e28 290d 0a0d 0a0d 0a64 6566 206e  ion()......def n
+00021990: 6f72 6d61 6c69 7a65 5f70 6164 6469 6e67  ormalize_padding
+000219a0: 2870 6164 6469 6e67 2c20 7261 6e6b 293a  (padding, rank):
+000219b0: 0d0a 2020 2020 2222 220d 0a20 2020 206e  ..    """..    n
+000219c0: 6f72 6d61 6c69 7a65 6420 666f 726d 6174  ormalized format
+000219d0: 206f 6620 7061 6464 696e 6720 7368 6f75   of padding shou
+000219e0: 6c64 2068 6176 6520 6c65 6e67 7468 2065  ld have length e
+000219f0: 7175 616c 2074 6f20 7261 6e6b 2b32 0d0a  qual to rank+2..
+00021a00: 2020 2020 416e 6420 7468 6520 6f72 6465      And the orde
+00021a10: 7220 7368 6f75 6c64 2066 6f6c 6c6f 7720  r should follow 
+00021a20: 7468 6520 6f72 6465 7220 6f66 2064 696d  the order of dim
+00021a30: 656e 7369 6f6e 0d0a 2020 2020 6578 2e20  ension..    ex. 
+00021a40: 436f 6e76 3264 2028 7261 6e6b 3d32 2920  Conv2d (rank=2) 
+00021a50: 6974 2773 206e 6f72 6d61 6c69 7a65 6420  it's normalized 
+00021a60: 666f 726d 6174 206c 656e 6774 683a 322b  format length:2+
+00021a70: 3220 203d 3d3e 286c 6566 742c 2072 6967  2  ==>(left, rig
+00021a80: 6874 2c74 6f70 2062 6f74 746f 6d29 0d0a  ht,top bottom)..
+00021a90: 0d0a 2020 2020 4172 6773 3a0d 0a20 2020  ..    Args:..   
+00021aa0: 2020 2020 2070 6164 6469 6e67 2028 4e6f       padding (No
+00021ab0: 6e65 2c20 696e 742c 2074 7570 6c65 293a  ne, int, tuple):
+00021ac0: 0d0a 2020 2020 2020 2020 7261 6e6b 2028  ..        rank (
+00021ad0: 696e 7429 3a0d 0a0d 0a20 2020 2052 6574  int):....    Ret
+00021ae0: 7572 6e73 3a0d 0a20 2020 2020 2020 2074  urns:..        t
+00021af0: 6865 206e 6f72 6d61 6c69 7a65 6420 666f  he normalized fo
+00021b00: 726d 6174 206f 6620 7061 6464 696e 670d  rmat of padding.
+00021b10: 0a0d 0a20 2020 2045 7861 6d70 6c65 733a  ...    Examples:
+00021b20: 0d0a 2020 2020 2020 2020 3e3e 3e20 6e6f  ..        >>> no
+00021b30: 726d 616c 697a 655f 7061 6464 696e 6728  rmalize_padding(
+00021b40: 2828 312c 3029 2c28 312c 3029 292c 3229  ((1,0),(1,0)),2)
+00021b50: 0d0a 2020 2020 2020 2020 2831 2c20 302c  ..        (1, 0,
+00021b60: 2031 2c20 3029 0d0a 2020 2020 2020 2020   1, 0)..        
+00021b70: 3e3e 3e20 6e6f 726d 616c 697a 655f 7061  >>> normalize_pa
+00021b80: 6464 696e 6728 2831 2c30 292c 3229 0d0a  dding((1,0),2)..
+00021b90: 2020 2020 2020 2020 2830 2c20 302c 2031          (0, 0, 1
+00021ba0: 2c20 3129 0d0a 2020 2020 2222 220d 0a20  , 1)..    """.. 
+00021bb0: 2020 2069 6620 7061 6464 696e 6720 6973     if padding is
+00021bc0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00021bd0: 7061 6464 696e 6720 3d20 2830 2c29 202a  padding = (0,) *
+00021be0: 2028 3220 2a20 7261 6e6b 290d 0a20 2020   (2 * rank)..   
+00021bf0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00021c00: 2870 6164 6469 6e67 2c20 696e 7429 3a0d  (padding, int):.
+00021c10: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
+00021c20: 203d 2028 7061 6464 696e 672c 2920 2a20   = (padding,) * 
+00021c30: 2832 202a 2072 616e 6b29 0d0a 2020 2020  (2 * rank)..    
+00021c40: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00021c50: 7061 6464 696e 672c 2028 6c69 7374 2c20  padding, (list, 
+00021c60: 7475 706c 6529 2920 616e 6420 6c65 6e28  tuple)) and len(
+00021c70: 7061 6464 696e 6729 203d 3d20 313a 0d0a  padding) == 1:..
+00021c80: 2020 2020 2020 2020 7061 6464 696e 6720          padding 
+00021c90: 3d20 7061 6464 696e 6720 2a20 2832 202a  = padding * (2 *
+00021ca0: 2072 616e 6b29 0d0a 2020 2020 656c 6966   rank)..    elif
+00021cb0: 2069 7369 6e73 7461 6e63 6528 7061 6464   isinstance(padd
+00021cc0: 696e 672c 2028 6c69 7374 2c20 7475 706c  ing, (list, tupl
+00021cd0: 6529 2920 616e 6420 6c65 6e28 7061 6464  e)) and len(padd
+00021ce0: 696e 6729 203d 3d20 7261 6e6b 2061 6e64  ing) == rank and
+00021cf0: 2069 7369 6e73 7461 6e63 6528 7061 6464   isinstance(padd
+00021d00: 696e 675b 305d 2c20 696e 7429 3a0d 0a20  ing[0], int):.. 
+00021d10: 2020 2020 2020 2023 2072 616e 6b3d 3220         # rank=2 
+00021d20: 2831 2c31 293d 3e28 312c 312c 312c 3129  (1,1)=>(1,1,1,1)
+00021d30: 2020 2028 312c 3029 3d3e 2830 2c30 2c31     (1,0)=>(0,0,1
+00021d40: 2c31 290d 0a20 2020 2020 2020 2072 6576  ,1)..        rev
+00021d50: 6572 7365 645f 7061 6464 696e 6720 3d20  ersed_padding = 
+00021d60: 6c69 7374 2870 6164 6469 6e67 290d 0a20  list(padding).. 
+00021d70: 2020 2020 2020 2072 6576 6572 7365 645f         reversed_
+00021d80: 7061 6464 696e 672e 7265 7665 7273 6528  padding.reverse(
+00021d90: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00021da0: 6e5f 7061 6464 696e 6720 3d20 5b5d 0d0a  n_padding = []..
+00021db0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00021dc0: 2072 616e 6765 2872 616e 6b29 3a0d 0a20   range(rank):.. 
+00021dd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00021de0: 6e5f 7061 6464 696e 672e 6170 7065 6e64  n_padding.append
+00021df0: 2872 6576 6572 7365 645f 7061 6464 696e  (reversed_paddin
+00021e00: 675b 695d 290d 0a20 2020 2020 2020 2020  g[i])..         
+00021e10: 2020 2072 6574 7572 6e5f 7061 6464 696e     return_paddin
+00021e20: 672e 6170 7065 6e64 2872 6576 6572 7365  g.append(reverse
+00021e30: 645f 7061 6464 696e 675b 695d 290d 0a0d  d_padding[i])...
+00021e40: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
+00021e50: 203d 2074 7570 6c65 2872 6574 7572 6e5f   = tuple(return_
+00021e60: 7061 6464 696e 6729 0d0a 2020 2020 656c  padding)..    el
+00021e70: 6966 2069 7369 6e73 7461 6e63 6528 7061  if isinstance(pa
+00021e80: 6464 696e 672c 2028 6c69 7374 2c20 7475  dding, (list, tu
+00021e90: 706c 6529 2920 616e 6420 6c65 6e28 7061  ple)) and len(pa
+00021ea0: 6464 696e 6729 203d 3d20 7261 6e6b 2061  dding) == rank a
+00021eb0: 6e64 2069 7369 6e73 7461 6e63 6528 7061  nd isinstance(pa
+00021ec0: 6464 696e 675b 305d 2c20 286c 6973 742c  dding[0], (list,
+00021ed0: 2074 7570 6c65 2929 3a0d 0a20 2020 2020   tuple)):..     
+00021ee0: 2020 2023 2072 616e 6b3d 3220 2028 2831     # rank=2  ((1
+00021ef0: 2c30 292c 2831 2c30 293d 3e28 312c 302c  ,0),(1,0)=>(1,0,
+00021f00: 312c 3029 0d0a 2020 2020 2020 2020 7061  1,0)..        pa
+00021f10: 6464 696e 6720 3d20 7475 706c 6528 6c69  dding = tuple(li
+00021f20: 7374 2869 7465 7274 6f6f 6c73 2e63 6861  st(itertools.cha
+00021f30: 696e 282a 6c69 7374 2870 6164 6469 6e67  in(*list(padding
+00021f40: 2929 2929 0d0a 2020 2020 656c 6966 2069  ))))..    elif i
+00021f50: 7369 6e73 7461 6e63 6528 7061 6464 696e  sinstance(paddin
+00021f60: 672c 2028 6c69 7374 2c20 7475 706c 6529  g, (list, tuple)
+00021f70: 2920 616e 6420 6c65 6e28 7061 6464 696e  ) and len(paddin
+00021f80: 6729 203d 3d20 3220 2a20 7261 6e6b 2061  g) == 2 * rank a
+00021f90: 6e64 2069 7369 6e73 7461 6e63 6528 7061  nd isinstance(pa
+00021fa0: 6464 696e 675b 305d 2c20 696e 7429 3a0d  dding[0], int):.
+00021fb0: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
+00021fc0: 203d 2070 6164 6469 6e67 0d0a 2020 2020   = padding..    
+00021fd0: 7265 7475 726e 2070 6164 6469 6e67 0d0a  return padding..
+00021fe0: 0d0a 0d0a 6465 6620 7072 696e 745f 6d65  ....def print_me
+00021ff0: 6d5f 7374 6163 6b28 293a 2020 2320 7072  m_stack():  # pr
+00022000: 6167 6d61 3a20 6e6f 2063 6f76 6572 0d0a  agma: no cover..
+00022010: 2020 2020 2222 220d 0a0d 0a20 2020 2022      """....    "
+00022020: 2222 0d0a 2020 2020 666f 7220 6f62 6a20  ""..    for obj 
+00022030: 696e 2067 632e 6765 745f 6f62 6a65 6374  in gc.get_object
+00022040: 7328 293a 0d0a 2020 2020 2020 2020 7472  s():..        tr
+00022050: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00022060: 6966 2074 6f72 6368 2e69 735f 7465 6e73  if torch.is_tens
+00022070: 6f72 286f 626a 2920 6f72 2028 6861 7361  or(obj) or (hasa
+00022080: 7474 7228 6f62 6a2c 2027 6461 7461 2729  ttr(obj, 'data')
+00022090: 2061 6e64 2074 6f72 6368 2e69 735f 7465   and torch.is_te
+000220a0: 6e73 6f72 286f 626a 2e64 6174 6129 293a  nsor(obj.data)):
+000220b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000220c0: 2020 7072 696e 7428 7479 7065 286f 626a    print(type(obj
+000220d0: 292c 206f 626a 2e73 697a 6528 2929 0d0a  ), obj.size())..
+000220e0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000220f0: 7863 6570 7469 6f6e 3a0d 0a20 2020 2020  xception:..     
+00022100: 2020 2020 2020 2070 6173 730d 0a0d 0a0d         pass.....
+00022110: 0a64 6566 2063 6f75 6e74 5f6d 656d 5f69  .def count_mem_i
+00022120: 7465 6d73 2829 3a20 2023 2070 7261 676d  tems():  # pragm
+00022130: 613a 206e 6f20 636f 7665 720d 0a20 2020  a: no cover..   
+00022140: 206e 625f 7061 7261 6d73 203d 2030 0d0a   nb_params = 0..
+00022150: 2020 2020 6e62 5f74 656e 736f 7273 203d      nb_tensors =
+00022160: 2030 0d0a 2020 2020 666f 7220 6f62 6a20   0..    for obj 
+00022170: 696e 2067 632e 6765 745f 6f62 6a65 6374  in gc.get_object
+00022180: 7328 293a 0d0a 2020 2020 2020 2020 7472  s():..        tr
+00022190: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000221a0: 6966 2074 6f72 6368 2e69 735f 7465 6e73  if torch.is_tens
+000221b0: 6f72 286f 626a 2920 6f72 2028 6861 7361  or(obj) or (hasa
+000221c0: 7474 7228 6f62 6a2c 2027 6461 7461 2729  ttr(obj, 'data')
+000221d0: 2061 6e64 2074 6f72 6368 2e69 735f 7465   and torch.is_te
+000221e0: 6e73 6f72 286f 626a 2e64 6174 6129 293a  nsor(obj.data)):
+000221f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022200: 2020 6f62 6a5f 7479 7065 203d 2073 7472    obj_type = str
+00022210: 2874 7970 6528 6f62 6a29 290d 0a20 2020  (type(obj))..   
+00022220: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00022230: 2770 6172 616d 6574 6572 2720 696e 206f  'parameter' in o
+00022240: 626a 5f74 7970 653a 0d0a 2020 2020 2020  bj_type:..      
+00022250: 2020 2020 2020 2020 2020 2020 2020 6e62                nb
+00022260: 5f70 6172 616d 7320 2b3d 2031 0d0a 2020  _params += 1..  
+00022270: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00022280: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00022290: 2020 2020 2020 2020 206e 625f 7465 6e73           nb_tens
+000222a0: 6f72 7320 2b3d 2031 0d0a 2020 2020 2020  ors += 1..      
+000222b0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+000222c0: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+000222d0: 2070 6173 730d 0a0d 0a20 2020 2072 6574   pass....    ret
+000222e0: 7572 6e20 6e62 5f70 6172 616d 732c 206e  urn nb_params, n
+000222f0: 625f 7465 6e73 6f72 730d 0a0d 0a0d 0a64  b_tensors......d
+00022300: 6566 2067 6574 5f68 756d 616e 5f72 6561  ef get_human_rea
+00022310: 6461 626c 655f 636f 756e 7428 6e75 6d62  dable_count(numb
+00022320: 6572 293a 0d0a 2020 2020 2222 220d 0a20  er):..    """.. 
+00022330: 2020 2041 6262 7265 7669 6174 6573 2061     Abbreviates a
+00022340: 6e20 696e 7465 6765 7220 6e75 6d62 6572  n integer number
+00022350: 2077 6974 6820 4b2c 204d 2c20 422c 2054   with K, M, B, T
+00022360: 2066 6f72 2074 686f 7573 616e 6473 2c20   for thousands, 
+00022370: 6d69 6c6c 696f 6e73 2c0d 0a20 2020 2062  millions,..    b
+00022380: 696c 6c69 6f6e 7320 616e 6420 7472 696c  illions and tril
+00022390: 6c69 6f6e 732c 2072 6573 7065 6374 6976  lions, respectiv
+000223a0: 656c 792e 0d0a 2020 2020 4578 616d 706c  ely...    Exampl
+000223b0: 6573 3a0d 0a20 2020 2020 2020 2031 3233  es:..        123
+000223c0: 2020 2020 202d 3e20 3132 330d 0a20 2020       -> 123..   
+000223d0: 2020 2020 2031 3233 3420 2020 202d 3e20       1234    -> 
+000223e0: 3120 4b20 2020 2020 2020 286f 6e65 2074  1 K       (one t
+000223f0: 686f 7573 616e 6429 0d0a 2020 2020 2020  housand)..      
+00022400: 2020 3265 3620 2020 2020 2d3e 2032 204d    2e6     -> 2 M
+00022410: 2020 2020 2020 2028 7477 6f20 6d69 6c6c         (two mill
+00022420: 696f 6e29 0d0a 2020 2020 2020 2020 3365  ion)..        3e
+00022430: 3920 2020 2020 2d3e 2033 2042 2020 2020  9     -> 3 B    
+00022440: 2020 2028 7468 7265 6520 6269 6c6c 696f     (three billio
+00022450: 6e29 0d0a 2020 2020 2020 2020 3465 3132  n)..        4e12
+00022460: 2020 2020 2d3e 2034 2054 2020 2020 2020      -> 4 T      
+00022470: 2028 666f 7572 2074 7269 6c6c 696f 6e29   (four trillion)
+00022480: 0d0a 2020 2020 2020 2020 3565 3135 2020  ..        5e15  
+00022490: 2020 2d3e 2035 2c30 3030 2054 0d0a 2020    -> 5,000 T..  
+000224a0: 2020 3a70 6172 616d 206e 756d 6265 723a    :param number:
+000224b0: 2061 2070 6f73 6974 6976 6520 696e 7465   a positive inte
+000224c0: 6765 7220 6e75 6d62 6572 0d0a 2020 2020  ger number..    
+000224d0: 3a72 6574 7572 6e73 2061 2073 7472 696e  :returns a strin
+000224e0: 6720 666f 726d 6174 7465 6420 6163 636f  g formatted acco
+000224f0: 7264 696e 6720 746f 2074 6865 2070 6174  rding to the pat
+00022500: 7465 726e 2064 6573 6372 6962 6564 2061  tern described a
+00022510: 626f 7665 2e0d 0a20 2020 2022 2222 0d0a  bove...    """..
+00022520: 2020 2020 6173 7365 7274 206e 756d 6265      assert numbe
+00022530: 7220 3e3d 2030 0d0a 2020 2020 6c61 6265  r >= 0..    labe
+00022540: 6c73 203d 205b 2720 272c 2027 4b27 2c20  ls = [' ', 'K', 
+00022550: 274d 272c 2027 4227 2c20 2754 275d 0d0a  'M', 'B', 'T']..
+00022560: 2020 2020 6e75 6d5f 6469 6769 7473 203d      num_digits =
+00022570: 2069 6e74 286e 702e 666c 6f6f 7228 6e70   int(np.floor(np
+00022580: 2e6c 6f67 3130 286e 756d 6265 7229 2920  .log10(number)) 
+00022590: 2b20 3120 6966 206e 756d 6265 7220 3e20  + 1 if number > 
+000225a0: 3020 656c 7365 2031 290d 0a20 2020 206e  0 else 1)..    n
+000225b0: 756d 5f67 726f 7570 7320 3d20 696e 7428  um_groups = int(
+000225c0: 6e70 2e63 6569 6c28 6e75 6d5f 6469 6769  np.ceil(num_digi
+000225d0: 7473 202f 2033 2929 0d0a 2020 2020 6e75  ts / 3))..    nu
+000225e0: 6d5f 6772 6f75 7073 203d 206d 696e 286e  m_groups = min(n
+000225f0: 756d 5f67 726f 7570 732c 206c 656e 286c  um_groups, len(l
+00022600: 6162 656c 7329 2920 2023 2064 6f6e 2774  abels))  # don't
+00022610: 2061 6262 7265 7669 6174 6520 6265 796f   abbreviate beyo
+00022620: 6e64 2074 7269 6c6c 696f 6e73 0d0a 2020  nd trillions..  
+00022630: 2020 7368 6966 7420 3d20 2d33 202a 2028    shift = -3 * (
+00022640: 6e75 6d5f 6772 6f75 7073 202d 2031 290d  num_groups - 1).
+00022650: 0a20 2020 206e 756d 6265 7220 3d20 6e75  .    number = nu
+00022660: 6d62 6572 202a 2028 3130 202a 2a20 7368  mber * (10 ** sh
+00022670: 6966 7429 0d0a 2020 2020 696e 6465 7820  ift)..    index 
+00022680: 3d20 6e75 6d5f 6772 6f75 7073 202d 2031  = num_groups - 1
+00022690: 0d0a 2020 2020 7265 7475 726e 2027 7b30  ..    return '{0
+000226a0: 3a2c 647d 207b 317d 272e 666f 726d 6174  :,d} {1}'.format
+000226b0: 2869 6e74 286e 756d 6265 7229 2c20 6c61  (int(number), la
+000226c0: 6265 6c73 5b69 6e64 6578 5d29 0d0a 0d0a  bels[index])....
+000226d0: 0d0a 6465 6620 7472 795f 6d61 705f 6172  ..def try_map_ar
+000226e0: 6773 5f61 6e64 5f63 616c 6c28 666e 2c20  gs_and_call(fn, 
+000226f0: 6461 7461 3a20 4f72 6465 7265 6444 6963  data: OrderedDic
+00022700: 742c 2064 6174 615f 6665 6564 3d4e 6f6e  t, data_feed=Non
+00022710: 652c 2069 735f 6175 746f 6361 7374 5f65  e, is_autocast_e
+00022720: 6e61 626c 6564 3d46 616c 7365 293a 0d0a  nabled=False):..
+00022730: 2020 2020 2222 2254 6869 7320 6675 6e63      """This func
+00022740: 7469 6f6e 2069 7320 7468 6520 636f 7265  tion is the core
+00022750: 2066 756e 6374 696f 6e20 666f 7220 6d61   function for ma
+00022760: 7070 696e 6720 6361 6c6c 6162 6c65 2061  pping callable a
+00022770: 6e64 2061 7267 6d65 6e74 730d 0a0d 0a20  nd argments.... 
+00022780: 2020 2041 7267 733a 0d0a 0d0a 2020 2020     Args:....    
+00022790: 2020 2020 666e 2028 6361 6c6c 6162 6c65      fn (callable
+000227a0: 293a 2074 6865 2063 616c 6c61 626c 652c  ): the callable,
+000227b0: 206d 6179 6265 2066 756e 6374 696f 6e73   maybe functions
+000227c0: 206f 7220 6c61 7965 7273 0d0a 2020 2020   or layers..    
+000227d0: 2020 2020 6461 7461 2028 4f72 6465 7265      data (Ordere
+000227e0: 6444 6963 7429 3a20 5468 6520 6b65 792d  dDict): The key-
+000227f0: 7661 6c75 6520 7061 6972 2066 6f72 2061  value pair for a
+00022800: 7661 696c 6162 6c65 2064 6174 612e 0d0a  vailable data...
+00022810: 2020 2020 2020 2020 6461 7461 5f66 6565          data_fee
+00022820: 6420 284f 7264 6572 6564 4469 6374 293a  d (OrderedDict):
+00022830: 2054 6865 2072 656c 6174 696f 6e20 6265   The relation be
+00022840: 7477 6565 6e20 6361 6c6c 6162 6c65 2061  tween callable a
+00022850: 7267 6d65 6e74 7320 286b 6579 2920 616e  rgments (key) an
+00022860: 6420 6461 7461 2028 7661 6c75 6529 0d0a  d data (value)..
+00022870: 2020 2020 2020 2020 6973 5f61 7574 6f63          is_autoc
+00022880: 6173 745f 656e 6162 6c65 6420 2862 6f6f  ast_enabled (boo
+00022890: 6c29 3a0d 0a0d 0a20 2020 2052 6574 7572  l):....    Retur
+000228a0: 6e73 3a0d 0a20 2020 2020 2020 2054 6865  ns:..        The
+000228b0: 2072 6573 756c 7420 6f66 2074 6865 2063   result of the c
+000228c0: 616c 6c61 626c 6520 6261 7365 206f 6e20  allable base on 
+000228d0: 6461 7461 5f66 6565 640d 0a0d 0a20 2020  data_feed....   
+000228e0: 2022 2222 0d0a 2020 2020 6966 2069 7369   """..    if isi
+000228f0: 6e73 7461 6e63 6528 666e 2c20 746f 7263  nstance(fn, torc
+00022900: 682e 5465 6e73 6f72 293a 0d0a 2020 2020  h.Tensor):..    
+00022910: 2020 2020 7265 7475 726e 2066 6e0d 0a20      return fn.. 
+00022920: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00022930: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00022940: 2020 2020 6172 675f 6d61 7020 3d20 4f72      arg_map = Or
+00022950: 6465 7265 6444 6963 7428 290d 0a20 2020  deredDict()..   
+00022960: 2020 2020 2020 2020 206f 7574 203d 204e           out = N
+00022970: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00022980: 2069 6620 6973 696e 7374 616e 6365 2866   if isinstance(f
+00022990: 6e2c 204c 6179 6572 293a 0d0a 2020 2020  n, Layer):..    
+000229a0: 2020 2020 2020 2020 2020 2020 5f64 6576              _dev
+000229b0: 6963 6520 3d20 666e 2e67 6574 5f72 6f6f  ice = fn.get_roo
+000229c0: 7428 292e 6465 7669 6365 0d0a 2020 2020  t().device..    
+000229d0: 2020 2020 2020 2020 2020 2020 5f73 6967              _sig
+000229e0: 6e61 7475 7265 203d 2066 6e2e 5f73 6967  nature = fn._sig
+000229f0: 6e61 7475 7265 0d0a 2020 2020 2020 2020  nature..        
+00022a00: 2020 2020 2020 2020 6966 204e 6f6e 6520          if None 
+00022a10: 696e 2066 6e2e 5f73 6967 6e61 7475 7265  in fn._signature
+00022a20: 2e69 6e70 7574 732e 7661 6c75 655f 6c69  .inputs.value_li
+00022a30: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
+00022a40: 2020 2020 2020 2020 205f 7369 676e 6174           _signat
+00022a50: 7572 6520 3d20 6765 745f 7369 676e 6174  ure = get_signat
+00022a60: 7572 6528 666e 290d 0a20 2020 2020 2020  ure(fn)..       
+00022a70: 2020 2020 2020 2020 2066 6f72 2061 7267           for arg
+00022a80: 2069 6e20 5f73 6967 6e61 7475 7265 2e69   in _signature.i
+00022a90: 6e70 7574 732e 6b65 795f 6c69 7374 3a0d  nputs.key_list:.
+00022aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ab0: 2020 2020 2069 735f 6f70 7469 6f6e 616c       is_optional
+00022ac0: 203d 2066 6e2e 7369 676e 6174 7572 652e   = fn.signature.
+00022ad0: 696e 7075 7473 5b61 7267 5d2e 6f70 7469  inputs[arg].opti
+00022ae0: 6f6e 616c 2069 6620 6973 696e 7374 616e  onal if isinstan
+00022af0: 6365 2866 6e2e 7369 676e 6174 7572 652e  ce(fn.signature.
+00022b00: 696e 7075 7473 5b61 7267 5d2c 0d0a 2020  inputs[arg],..  
+00022b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b60: 5465 6e73 6f72 5370 6563 2920 656c 7365  TensorSpec) else
+00022b70: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00022b80: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00022b90: 756c 7420 3d20 666e 2e73 6967 6e61 7475  ult = fn.signatu
+00022ba0: 7265 2e69 6e70 7574 735b 6172 675d 2e64  re.inputs[arg].d
+00022bb0: 6566 6175 6c74 2069 6620 6973 696e 7374  efault if isinst
+00022bc0: 616e 6365 2866 6e2e 7369 676e 6174 7572  ance(fn.signatur
+00022bd0: 652e 696e 7075 7473 5b61 7267 5d2c 0d0a  e.inputs[arg],..
+00022be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00022bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c00: 2069 735f 696e 7075 7420 3d20 6172 672e   is_input = arg.
-00022c10: 6c6f 7765 7228 2920 696e 205b 2778 272c  lower() in ['x',
-00022c20: 2027 696e 7075 7427 5d0d 0a20 2020 2020   'input']..     
-00022c30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022c40: 735f 6f75 7470 7574 203d 2061 7267 2e6c  s_output = arg.l
-00022c50: 6f77 6572 2829 2069 6e20 5b27 7927 2c20  ower() in ['y', 
-00022c60: 276f 7574 7075 7427 2c20 2779 5f70 7265  'output', 'y_pre
-00022c70: 6427 5d0d 0a20 2020 2020 2020 2020 2020  d']..           
-00022c80: 2020 2020 2020 2020 2069 6620 6172 6720           if arg 
-00022c90: 696e 2064 6174 615f 6665 6564 2061 6e64  in data_feed and
-00022ca0: 2064 6174 615f 6665 6564 5b61 7267 5d20   data_feed[arg] 
-00022cb0: 696e 2064 6174 613a 0d0a 2020 2020 2020  in data:..      
-00022cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022cd0: 2020 6172 675f 6d61 705b 6172 675d 203d    arg_map[arg] =
-00022ce0: 2074 6f5f 7465 6e73 6f72 2864 6174 615b   to_tensor(data[
-00022cf0: 6461 7461 5f66 6565 645b 6172 675d 5d2c  data_feed[arg]],
-00022d00: 2064 6576 6963 653d 5f64 6576 6963 6529   device=_device)
-00022d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022d20: 2020 2020 2020 656c 6966 2061 7267 2069        elif arg i
-00022d30: 6e20 6461 7461 3a0d 0a20 2020 2020 2020  n data:..       
-00022d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d50: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
-00022d60: 746f 5f74 656e 736f 7228 6461 7461 5b61  to_tensor(data[a
-00022d70: 7267 5d2c 2064 6576 6963 653d 5f64 6576  rg], device=_dev
-00022d80: 6963 6529 0d0a 2020 2020 2020 2020 2020  ice)..          
-00022d90: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00022da0: 735f 696e 7075 7420 616e 6420 2769 6e70  s_input and 'inp
-00022db0: 7574 2720 696e 2064 6174 615f 6665 6564  ut' in data_feed
-00022dc0: 2061 6e64 2064 6174 615f 6665 6564 5b27   and data_feed['
-00022dd0: 696e 7075 7427 5d20 696e 2064 6174 613a  input'] in data:
-00022de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022df0: 2020 2020 2020 2020 2020 6172 675f 6d61            arg_ma
-00022e00: 705b 6172 675d 203d 2074 6f5f 7465 6e73  p[arg] = to_tens
-00022e10: 6f72 2864 6174 615b 6461 7461 5f66 6565  or(data[data_fee
-00022e20: 645b 2769 6e70 7574 275d 5d2c 2064 6576  d['input']], dev
-00022e30: 6963 653d 5f64 6576 6963 6529 0d0a 2020  ice=_device)..  
+00022c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c20: 2020 2020 2020 2020 2020 2020 2054 656e               Ten
+00022c30: 736f 7253 7065 6329 2065 6c73 6520 4e6f  sorSpec) else No
+00022c40: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00022c50: 2020 2020 2020 2020 6973 5f69 6e70 7574          is_input
+00022c60: 203d 2061 7267 2e6c 6f77 6572 2829 2069   = arg.lower() i
+00022c70: 6e20 5b27 7827 2c20 2769 6e70 7574 275d  n ['x', 'input']
+00022c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022c90: 2020 2020 2020 6973 5f6f 7574 7075 7420        is_output 
+00022ca0: 3d20 6172 672e 6c6f 7765 7228 2920 696e  = arg.lower() in
+00022cb0: 205b 2779 272c 2027 6f75 7470 7574 272c   ['y', 'output',
+00022cc0: 2027 795f 7072 6564 275d 0d0a 2020 2020   'y_pred']..    
+00022cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ce0: 6966 2061 7267 2069 6e20 6461 7461 5f66  if arg in data_f
+00022cf0: 6565 6420 616e 6420 6461 7461 5f66 6565  eed and data_fee
+00022d00: 645b 6172 675d 2069 6e20 6461 7461 3a0d  d[arg] in data:.
+00022d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d20: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
+00022d30: 5b61 7267 5d20 3d20 746f 5f74 656e 736f  [arg] = to_tenso
+00022d40: 7228 6461 7461 5b64 6174 615f 6665 6564  r(data[data_feed
+00022d50: 5b61 7267 5d5d 2c20 6465 7669 6365 3d5f  [arg]], device=_
+00022d60: 6465 7669 6365 290d 0a20 2020 2020 2020  device)..       
+00022d70: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00022d80: 6620 6172 6720 696e 2064 6174 613a 0d0a  f arg in data:..
+00022d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022da0: 2020 2020 2020 2020 6172 675f 6d61 705b          arg_map[
+00022db0: 6172 675d 203d 2074 6f5f 7465 6e73 6f72  arg] = to_tensor
+00022dc0: 2864 6174 615b 6172 675d 2c20 6465 7669  (data[arg], devi
+00022dd0: 6365 3d5f 6465 7669 6365 290d 0a20 2020  ce=_device)..   
+00022de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022df0: 2065 6c69 6620 6973 5f69 6e70 7574 2061   elif is_input a
+00022e00: 6e64 2027 696e 7075 7427 2069 6e20 6461  nd 'input' in da
+00022e10: 7461 5f66 6565 6420 616e 6420 6461 7461  ta_feed and data
+00022e20: 5f66 6565 645b 2769 6e70 7574 275d 2069  _feed['input'] i
+00022e30: 6e20 6461 7461 3a0d 0a20 2020 2020 2020  n data:..       
 00022e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e50: 2020 656c 6966 2069 735f 6f75 7470 7574    elif is_output
-00022e60: 2061 6e64 2027 6f75 7470 7574 2720 696e   and 'output' in
-00022e70: 2064 6174 615f 6665 6564 2061 6e64 2064   data_feed and d
-00022e80: 6174 615f 6665 6564 5b27 6f75 7470 7574  ata_feed['output
-00022e90: 275d 2069 6e20 6461 7461 3a0d 0a20 2020  '] in data:..   
-00022ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022eb0: 2020 2020 2061 7267 5f6d 6170 5b61 7267       arg_map[arg
-00022ec0: 5d20 3d20 746f 5f74 656e 736f 7228 6461  ] = to_tensor(da
-00022ed0: 7461 5b64 6174 615f 6665 6564 5b27 6f75  ta[data_feed['ou
-00022ee0: 7470 7574 275d 5d2c 2064 6576 6963 653d  tput']], device=
-00022ef0: 5f64 6576 6963 6529 0d0a 2020 2020 2020  _device)..      
-00022f00: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00022f10: 6966 2069 735f 6f70 7469 6f6e 616c 3a0d  if is_optional:.
-00022f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022f30: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
-00022f40: 5b61 7267 5d20 3d20 6465 6661 756c 740d  [arg] = default.
+00022e50: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
+00022e60: 746f 5f74 656e 736f 7228 6461 7461 5b64  to_tensor(data[d
+00022e70: 6174 615f 6665 6564 5b27 696e 7075 7427  ata_feed['input'
+00022e80: 5d5d 2c20 6465 7669 6365 3d5f 6465 7669  ]], device=_devi
+00022e90: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
+00022ea0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00022eb0: 5f6f 7574 7075 7420 616e 6420 276f 7574  _output and 'out
+00022ec0: 7075 7427 2069 6e20 6461 7461 5f66 6565  put' in data_fee
+00022ed0: 6420 616e 6420 6461 7461 5f66 6565 645b  d and data_feed[
+00022ee0: 276f 7574 7075 7427 5d20 696e 2064 6174  'output'] in dat
+00022ef0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
+00022f00: 2020 2020 2020 2020 2020 2020 6172 675f              arg_
+00022f10: 6d61 705b 6172 675d 203d 2074 6f5f 7465  map[arg] = to_te
+00022f20: 6e73 6f72 2864 6174 615b 6461 7461 5f66  nsor(data[data_f
+00022f30: 6565 645b 276f 7574 7075 7427 5d5d 2c20  eed['output']], 
+00022f40: 6465 7669 6365 3d5f 6465 7669 6365 290d  device=_device).
 00022f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022f60: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00022f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00022f90: 7272 6f72 2827 6172 6720 3a7b 307d 2063  rror('arg :{0} c
-00022fa0: 616e 6e6f 7420 6d61 7070 696e 6720 636f  annot mapping co
-00022fb0: 7272 6563 746c 7921 272e 666f 726d 6174  rrectly!'.format
-00022fc0: 2861 7267 2929 0d0a 2020 2020 2020 2020  (arg))..        
-00022fd0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00022fe0: 2761 7267 5f6d 6170 272c 6172 675f 6d61  'arg_map',arg_ma
-00022ff0: 702e 6b65 795f 6c69 7374 290d 0a20 2020  p.key_list)..   
-00023000: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00023010: 6374 782e 616d 705f 6176 6169 6c61 626c  ctx.amp_availabl
-00023020: 6520 3d3d 2054 7275 6520 616e 6420 6973  e == True and is
-00023030: 5f61 7574 6f63 6173 745f 656e 6162 6c65  _autocast_enable
-00023040: 6420 3d3d 2054 7275 6520 616e 6420 6765  d == True and ge
-00023050: 745f 6465 7669 6365 2829 203d 3d20 2763  t_device() == 'c
-00023060: 7564 6127 3a0d 0a20 2020 2020 2020 2020  uda':..         
-00023070: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00023080: 746f 7263 682e 6375 6461 2e61 6d70 2e61  torch.cuda.amp.a
-00023090: 7574 6f63 6173 7428 293a 0d0a 2020 2020  utocast():..    
-000230a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000230b0: 2020 2020 6f75 7420 3d20 666e 282a 6172      out = fn(*ar
-000230c0: 675f 6d61 702e 7661 6c75 655f 6c69 7374  g_map.value_list
-000230d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000230e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000230f0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00023100: 7420 3d20 666e 282a 6172 675f 6d61 702e  t = fn(*arg_map.
-00023110: 7661 6c75 655f 6c69 7374 290d 0a20 2020  value_list)..   
-00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023130: 2023 2066 6f72 2069 7465 6d20 696e 2064   # for item in d
-00023140: 6174 612e 7661 6c75 655f 6c69 7374 3a0d  ata.value_list:.
-00023150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023160: 2020 2020 2023 2020 2020 2069 6620 6861       #     if ha
-00023170: 7361 7474 7228 6974 656d 2c20 2763 7075  sattr(item, 'cpu
-00023180: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00023190: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-000231a0: 2020 2069 7465 6d2e 6370 7528 290d 0a20     item.cpu().. 
-000231b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000231c0: 6574 7572 6e20 6f75 740d 0a20 2020 2020  eturn out..     
-000231d0: 2020 2020 2020 2065 6c69 6620 2868 6173         elif (has
-000231e0: 6174 7472 2866 6e2c 2027 7369 676e 6174  attr(fn, 'signat
-000231f0: 7572 6527 2920 6f72 2068 6173 6174 7472  ure') or hasattr
-00023200: 2866 6e2c 2027 5f73 6967 6e61 7475 7265  (fn, '_signature
-00023210: 2729 2920 616e 6420 6361 6c6c 6162 6c65  ')) and callable
-00023220: 2866 6e29 3a0d 0a20 2020 2020 2020 2020  (fn):..         
-00023230: 2020 2020 2020 2073 6967 203d 2066 6e2e         sig = fn.
-00023240: 5f73 6967 6e61 7475 7265 2069 6620 6861  _signature if ha
-00023250: 7361 7474 7228 666e 2c20 275f 7369 676e  sattr(fn, '_sign
-00023260: 6174 7572 6527 2920 656c 7365 2066 6e2e  ature') else fn.
-00023270: 7369 676e 6174 7572 650d 0a20 2020 2020  signature..     
-00023280: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
-00023290: 7267 2069 6e20 666e 2e73 6967 6e61 7475  rg in fn.signatu
-000232a0: 7265 2e69 6e70 7574 732e 6b65 795f 6c69  re.inputs.key_li
-000232b0: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
-000232c0: 2020 2020 2020 2020 2069 735f 6f70 7469           is_opti
-000232d0: 6f6e 616c 203d 2073 6967 2e69 6e70 7574  onal = sig.input
-000232e0: 735b 6172 675d 2e6f 7074 696f 6e61 6c20  s[arg].optional 
-000232f0: 6966 2069 7369 6e73 7461 6e63 6528 7369  if isinstance(si
-00023300: 672e 696e 7075 7473 5b61 7267 5d2c 2054  g.inputs[arg], T
-00023310: 656e 736f 7253 7065 6329 2065 6c73 6520  ensorSpec) else 
-00023320: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-00023330: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00023340: 6c74 203d 2073 6967 2e69 6e70 7574 735b  lt = sig.inputs[
-00023350: 6172 675d 2e64 6566 6175 6c74 2069 6620  arg].default if 
-00023360: 6973 696e 7374 616e 6365 2873 6967 2e69  isinstance(sig.i
-00023370: 6e70 7574 735b 6172 675d 2c20 5465 6e73  nputs[arg], Tens
-00023380: 6f72 5370 6563 2920 656c 7365 204e 6f6e  orSpec) else Non
-00023390: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-000233a0: 2020 2020 2020 2069 735f 696e 7075 7420         is_input 
-000233b0: 3d20 6172 672e 6c6f 7765 7228 2920 696e  = arg.lower() in
-000233c0: 205b 2778 272c 2027 696e 7075 7427 5d0d   ['x', 'input'].
-000233d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000233e0: 2020 2020 2069 735f 6f75 7470 7574 203d       is_output =
-000233f0: 2061 7267 2e6c 6f77 6572 2829 2069 6e20   arg.lower() in 
-00023400: 5b27 7927 2c20 276f 7574 7075 7427 2c20  ['y', 'output', 
-00023410: 2779 5f70 7265 6427 5d0d 0a20 2020 2020  'y_pred']..     
-00023420: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023430: 6620 6172 6720 696e 2064 6174 615f 6665  f arg in data_fe
-00023440: 6564 2061 6e64 2064 6174 615f 6665 6564  ed and data_feed
-00023450: 5b61 7267 5d20 696e 2064 6174 613a 0d0a  [arg] in data:..
-00023460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023470: 2020 2020 2020 2020 6172 675f 6d61 705b          arg_map[
-00023480: 6172 675d 203d 2074 6f5f 7465 6e73 6f72  arg] = to_tensor
-00023490: 2864 6174 615b 6461 7461 5f66 6565 645b  (data[data_feed[
-000234a0: 6172 675d 5d2c 2064 6576 6963 653d 6765  arg]], device=ge
-000234b0: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
-000234c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234d0: 2065 6c69 6620 6172 6720 696e 2064 6174   elif arg in dat
-000234e0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
-000234f0: 2020 2020 2020 2020 2020 2020 6172 675f              arg_
-00023500: 6d61 705b 6172 675d 203d 2074 6f5f 7465  map[arg] = to_te
-00023510: 6e73 6f72 2864 6174 615b 6172 675d 2c20  nsor(data[arg], 
-00023520: 6465 7669 6365 3d67 6574 5f64 6576 6963  device=get_devic
-00023530: 6528 2929 0d0a 2020 2020 2020 2020 2020  e())..          
-00023540: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00023550: 735f 696e 7075 7420 616e 6420 2769 6e70  s_input and 'inp
-00023560: 7574 2720 696e 2064 6174 615f 6665 6564  ut' in data_feed
-00023570: 2061 6e64 2064 6174 615f 6665 6564 5b27   and data_feed['
-00023580: 696e 7075 7427 5d20 696e 2064 6174 613a  input'] in data:
-00023590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000235a0: 2020 2020 2020 2020 2020 6172 675f 6d61            arg_ma
-000235b0: 705b 6172 675d 203d 2074 6f5f 7465 6e73  p[arg] = to_tens
-000235c0: 6f72 2864 6174 615b 6461 7461 5f66 6565  or(data[data_fee
-000235d0: 645b 2769 6e70 7574 275d 5d2c 2064 6576  d['input']], dev
-000235e0: 6963 653d 6765 745f 6465 7669 6365 2829  ice=get_device()
-000235f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00023600: 2020 2020 2020 2065 6c69 6620 6973 5f6f         elif is_o
-00023610: 7574 7075 7420 616e 6420 276f 7574 7075  utput and 'outpu
-00023620: 7427 2069 6e20 6461 7461 5f66 6565 6420  t' in data_feed 
-00023630: 616e 6420 6461 7461 5f66 6565 645b 276f  and data_feed['o
-00023640: 7574 7075 7427 5d20 696e 2064 6174 613a  utput'] in data:
-00023650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00023660: 2020 2020 2020 2020 2020 6172 675f 6d61            arg_ma
-00023670: 705b 6172 675d 203d 2074 6f5f 7465 6e73  p[arg] = to_tens
-00023680: 6f72 2864 6174 615b 6461 7461 5f66 6565  or(data[data_fee
-00023690: 645b 276f 7574 7075 7427 5d5d 2c20 6465  d['output']], de
-000236a0: 7669 6365 3d67 6574 5f64 6576 6963 6528  vice=get_device(
-000236b0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-000236c0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-000236d0: 6e73 7461 6e63 6528 666e 2c20 7061 7274  nstance(fn, part
-000236e0: 6961 6c29 2061 6e64 2061 7267 2069 6e20  ial) and arg in 
-000236f0: 666e 2e6b 6579 776f 7264 733a 0d0a 2020  fn.keywords:..  
-00023700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023710: 2020 2020 2020 6172 675f 6d61 705b 6172        arg_map[ar
-00023720: 675d 203d 2066 6e2e 6b65 7977 6f72 6473  g] = fn.keywords
-00023730: 5b61 7267 5d0d 0a20 2020 2020 2020 2020  [arg]..         
-00023740: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00023750: 6973 5f6f 7074 696f 6e61 6c3a 0d0a 2020  is_optional:..  
-00023760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023770: 2020 2020 2020 6172 675f 6d61 705b 6172        arg_map[ar
-00023780: 675d 203d 2064 6566 6175 6c74 0d0a 2020  g] = default..  
+00022f60: 2020 2020 2065 6c69 6620 6973 5f6f 7074       elif is_opt
+00022f70: 696f 6e61 6c3a 0d0a 2020 2020 2020 2020  ional:..        
+00022f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f90: 6172 675f 6d61 705b 6172 675d 203d 2064  arg_map[arg] = d
+00022fa0: 6566 6175 6c74 0d0a 2020 2020 2020 2020  efault..        
+00022fb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00022fc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00022fd0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00022fe0: 2056 616c 7565 4572 726f 7228 2761 7267   ValueError('arg
+00022ff0: 203a 7b30 7d20 6361 6e6e 6f74 206d 6170   :{0} cannot map
+00023000: 7069 6e67 2063 6f72 7265 6374 6c79 2127  ping correctly!'
+00023010: 2e66 6f72 6d61 7428 6172 6729 290d 0a20  .format(arg)).. 
+00023020: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00023030: 2070 7269 6e74 2827 6172 675f 6d61 7027   print('arg_map'
+00023040: 2c61 7267 5f6d 6170 2e6b 6579 5f6c 6973  ,arg_map.key_lis
+00023050: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00023060: 2020 2020 6966 2063 7478 2e61 6d70 5f61      if ctx.amp_a
+00023070: 7661 696c 6162 6c65 203d 3d20 5472 7565  vailable == True
+00023080: 2061 6e64 2069 735f 6175 746f 6361 7374   and is_autocast
+00023090: 5f65 6e61 626c 6564 203d 3d20 5472 7565  _enabled == True
+000230a0: 2061 6e64 2067 6574 5f64 6576 6963 6528   and get_device(
+000230b0: 2920 3d3d 2027 6375 6461 273a 0d0a 2020  ) == 'cuda':..  
+000230c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230d0: 2020 7769 7468 2074 6f72 6368 2e63 7564    with torch.cud
+000230e0: 612e 616d 702e 6175 746f 6361 7374 2829  a.amp.autocast()
+000230f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00023100: 2020 2020 2020 2020 2020 206f 7574 203d             out =
+00023110: 2066 6e28 2a61 7267 5f6d 6170 2e76 616c   fn(*arg_map.val
+00023120: 7565 5f6c 6973 7429 0d0a 2020 2020 2020  ue_list)..      
+00023130: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00023140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023150: 2020 2020 206f 7574 203d 2066 6e28 2a61       out = fn(*a
+00023160: 7267 5f6d 6170 2e76 616c 7565 5f6c 6973  rg_map.value_lis
+00023170: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00023180: 2020 2020 2020 2020 2320 666f 7220 6974          # for it
+00023190: 656d 2069 6e20 6461 7461 2e76 616c 7565  em in data.value
+000231a0: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
+000231b0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+000231c0: 2020 6966 2068 6173 6174 7472 2869 7465    if hasattr(ite
+000231d0: 6d2c 2027 6370 7527 293a 0d0a 2020 2020  m, 'cpu'):..    
+000231e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231f0: 2320 2020 2020 2020 2020 6974 656d 2e63  #         item.c
+00023200: 7075 2829 0d0a 2020 2020 2020 2020 2020  pu()..          
+00023210: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+00023220: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00023230: 6966 2028 6861 7361 7474 7228 666e 2c20  if (hasattr(fn, 
+00023240: 2773 6967 6e61 7475 7265 2729 206f 7220  'signature') or 
+00023250: 6861 7361 7474 7228 666e 2c20 275f 7369  hasattr(fn, '_si
+00023260: 676e 6174 7572 6527 2929 2061 6e64 2063  gnature')) and c
+00023270: 616c 6c61 626c 6528 666e 293a 0d0a 2020  allable(fn):..  
+00023280: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00023290: 6720 3d20 666e 2e5f 7369 676e 6174 7572  g = fn._signatur
+000232a0: 6520 6966 2068 6173 6174 7472 2866 6e2c  e if hasattr(fn,
+000232b0: 2027 5f73 6967 6e61 7475 7265 2729 2065   '_signature') e
+000232c0: 6c73 6520 666e 2e73 6967 6e61 7475 7265  lse fn.signature
+000232d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000232e0: 2020 666f 7220 6172 6720 696e 2066 6e2e    for arg in fn.
+000232f0: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
+00023300: 2e6b 6579 5f6c 6973 743a 0d0a 2020 2020  .key_list:..    
+00023310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023320: 6973 5f6f 7074 696f 6e61 6c20 3d20 7369  is_optional = si
+00023330: 672e 696e 7075 7473 5b61 7267 5d2e 6f70  g.inputs[arg].op
+00023340: 7469 6f6e 616c 2069 6620 6973 696e 7374  tional if isinst
+00023350: 616e 6365 2873 6967 2e69 6e70 7574 735b  ance(sig.inputs[
+00023360: 6172 675d 2c20 5465 6e73 6f72 5370 6563  arg], TensorSpec
+00023370: 2920 656c 7365 2046 616c 7365 0d0a 2020  ) else False..  
+00023380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023390: 2020 6465 6661 756c 7420 3d20 7369 672e    default = sig.
+000233a0: 696e 7075 7473 5b61 7267 5d2e 6465 6661  inputs[arg].defa
+000233b0: 756c 7420 6966 2069 7369 6e73 7461 6e63  ult if isinstanc
+000233c0: 6528 7369 672e 696e 7075 7473 5b61 7267  e(sig.inputs[arg
+000233d0: 5d2c 2054 656e 736f 7253 7065 6329 2065  ], TensorSpec) e
+000233e0: 6c73 6520 4e6f 6e65 0d0a 2020 2020 2020  lse None..      
+000233f0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00023400: 5f69 6e70 7574 203d 2061 7267 2e6c 6f77  _input = arg.low
+00023410: 6572 2829 2069 6e20 5b27 7827 2c20 2769  er() in ['x', 'i
+00023420: 6e70 7574 275d 0d0a 2020 2020 2020 2020  nput']..        
+00023430: 2020 2020 2020 2020 2020 2020 6973 5f6f              is_o
+00023440: 7574 7075 7420 3d20 6172 672e 6c6f 7765  utput = arg.lowe
+00023450: 7228 2920 696e 205b 2779 272c 2027 6f75  r() in ['y', 'ou
+00023460: 7470 7574 272c 2027 795f 7072 6564 275d  tput', 'y_pred']
+00023470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023480: 2020 2020 2020 6966 2061 7267 2069 6e20        if arg in 
+00023490: 6461 7461 5f66 6565 6420 616e 6420 6461  data_feed and da
+000234a0: 7461 5f66 6565 645b 6172 675d 2069 6e20  ta_feed[arg] in 
+000234b0: 6461 7461 3a0d 0a20 2020 2020 2020 2020  data:..         
+000234c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000234d0: 7267 5f6d 6170 5b61 7267 5d20 3d20 746f  rg_map[arg] = to
+000234e0: 5f74 656e 736f 7228 6461 7461 5b64 6174  _tensor(data[dat
+000234f0: 615f 6665 6564 5b61 7267 5d5d 2c20 6465  a_feed[arg]], de
+00023500: 7669 6365 3d67 6574 5f64 6576 6963 6528  vice=get_device(
+00023510: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00023520: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
+00023530: 2069 6e20 6461 7461 3a0d 0a20 2020 2020   in data:..     
+00023540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023550: 2020 2061 7267 5f6d 6170 5b61 7267 5d20     arg_map[arg] 
+00023560: 3d20 746f 5f74 656e 736f 7228 6461 7461  = to_tensor(data
+00023570: 5b61 7267 5d2c 2064 6576 6963 653d 6765  [arg], device=ge
+00023580: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
+00023590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235a0: 2065 6c69 6620 6973 5f69 6e70 7574 2061   elif is_input a
+000235b0: 6e64 2027 696e 7075 7427 2069 6e20 6461  nd 'input' in da
+000235c0: 7461 5f66 6565 6420 616e 6420 6461 7461  ta_feed and data
+000235d0: 5f66 6565 645b 2769 6e70 7574 275d 2069  _feed['input'] i
+000235e0: 6e20 6461 7461 3a0d 0a20 2020 2020 2020  n data:..       
+000235f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023600: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
+00023610: 746f 5f74 656e 736f 7228 6461 7461 5b64  to_tensor(data[d
+00023620: 6174 615f 6665 6564 5b27 696e 7075 7427  ata_feed['input'
+00023630: 5d5d 2c20 6465 7669 6365 3d67 6574 5f64  ]], device=get_d
+00023640: 6576 6963 6528 2929 0d0a 2020 2020 2020  evice())..      
+00023650: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00023660: 6966 2069 735f 6f75 7470 7574 2061 6e64  if is_output and
+00023670: 2027 6f75 7470 7574 2720 696e 2064 6174   'output' in dat
+00023680: 615f 6665 6564 2061 6e64 2064 6174 615f  a_feed and data_
+00023690: 6665 6564 5b27 6f75 7470 7574 275d 2069  feed['output'] i
+000236a0: 6e20 6461 7461 3a0d 0a20 2020 2020 2020  n data:..       
+000236b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236c0: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
+000236d0: 746f 5f74 656e 736f 7228 6461 7461 5b64  to_tensor(data[d
+000236e0: 6174 615f 6665 6564 5b27 6f75 7470 7574  ata_feed['output
+000236f0: 275d 5d2c 2064 6576 6963 653d 6765 745f  ']], device=get_
+00023700: 6465 7669 6365 2829 290d 0a20 2020 2020  device())..     
+00023710: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00023720: 6c69 6620 6973 696e 7374 616e 6365 2866  lif isinstance(f
+00023730: 6e2c 2070 6172 7469 616c 2920 616e 6420  n, partial) and 
+00023740: 6172 6720 696e 2066 6e2e 6b65 7977 6f72  arg in fn.keywor
+00023750: 6473 3a0d 0a20 2020 2020 2020 2020 2020  ds:..           
+00023760: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+00023770: 5f6d 6170 5b61 7267 5d20 3d20 666e 2e6b  _map[arg] = fn.k
+00023780: 6579 776f 7264 735b 6172 675d 0d0a 2020  eywords[arg]..  
 00023790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000237a0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000237b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000237c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000237d0: 7228 2761 7267 203a 7b30 7d20 6361 6e6e  r('arg :{0} cann
-000237e0: 6f74 206d 6170 7069 6e67 2063 6f72 7265  ot mapping corre
-000237f0: 6374 6c79 2127 2e66 6f72 6d61 7428 6172  ctly!'.format(ar
-00023800: 6729 290d 0a0d 0a20 2020 2020 2020 2020  g))....         
-00023810: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
-00023820: 6172 675f 6d61 7027 2c20 6172 675f 6d61  arg_map', arg_ma
-00023830: 702e 6b65 795f 6c69 7374 290d 0a20 2020  p.key_list)..   
-00023840: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00023850: 6374 782e 616d 705f 6176 6169 6c61 626c  ctx.amp_availabl
-00023860: 6520 3d3d 2054 7275 6520 616e 6420 6973  e == True and is
-00023870: 5f61 7574 6f63 6173 745f 656e 6162 6c65  _autocast_enable
-00023880: 6420 3d3d 2054 7275 6520 616e 6420 6765  d == True and ge
-00023890: 745f 6465 7669 6365 2829 203d 3d20 2763  t_device() == 'c
-000238a0: 7564 6127 3a0d 0a20 2020 2020 2020 2020  uda':..         
-000238b0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000238c0: 746f 7263 682e 6375 6461 2e61 6d70 2e61  torch.cuda.amp.a
-000238d0: 7574 6f63 6173 7428 293a 0d0a 2020 2020  utocast():..    
-000238e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00023900: 6528 666e 2c20 7061 7274 6961 6c29 3a0d  e(fn, partial):.
-00023910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023920: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00023930: 203d 2066 6e2e 6675 6e63 282a 6172 675f   = fn.func(*arg_
-00023940: 6d61 702e 7661 6c75 655f 6c69 7374 290d  map.value_list).
-00023950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023960: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000237a0: 2020 656c 6966 2069 735f 6f70 7469 6f6e    elif is_option
+000237b0: 616c 3a0d 0a20 2020 2020 2020 2020 2020  al:..           
+000237c0: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+000237d0: 5f6d 6170 5b61 7267 5d20 3d20 6465 6661  _map[arg] = defa
+000237e0: 756c 740d 0a20 2020 2020 2020 2020 2020  ult..           
+000237f0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00023800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023810: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00023820: 6c75 6545 7272 6f72 2827 6172 6720 3a7b  lueError('arg :{
+00023830: 307d 2063 616e 6e6f 7420 6d61 7070 696e  0} cannot mappin
+00023840: 6720 636f 7272 6563 746c 7921 272e 666f  g correctly!'.fo
+00023850: 726d 6174 2861 7267 2929 0d0a 0d0a 2020  rmat(arg))....  
+00023860: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00023870: 7072 696e 7428 2761 7267 5f6d 6170 272c  print('arg_map',
+00023880: 2061 7267 5f6d 6170 2e6b 6579 5f6c 6973   arg_map.key_lis
+00023890: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+000238a0: 2020 2020 6966 2063 7478 2e61 6d70 5f61      if ctx.amp_a
+000238b0: 7661 696c 6162 6c65 203d 3d20 5472 7565  vailable == True
+000238c0: 2061 6e64 2069 735f 6175 746f 6361 7374   and is_autocast
+000238d0: 5f65 6e61 626c 6564 203d 3d20 5472 7565  _enabled == True
+000238e0: 2061 6e64 2067 6574 5f64 6576 6963 6528   and get_device(
+000238f0: 2920 3d3d 2027 6375 6461 273a 0d0a 2020  ) == 'cuda':..  
+00023900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023910: 2020 7769 7468 2074 6f72 6368 2e63 7564    with torch.cud
+00023920: 612e 616d 702e 6175 746f 6361 7374 2829  a.amp.autocast()
+00023930: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00023940: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00023950: 696e 7374 616e 6365 2866 6e2c 2070 6172  instance(fn, par
+00023960: 7469 616c 293a 0d0a 2020 2020 2020 2020  tial):..        
 00023970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023980: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-00023990: 3d20 666e 282a 6172 675f 6d61 702e 7661  = fn(*arg_map.va
-000239a0: 6c75 655f 6c69 7374 290d 0a20 2020 2020  lue_list)..     
-000239b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000239c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000239d0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000239e0: 6e63 6528 666e 2c20 7061 7274 6961 6c29  nce(fn, partial)
-000239f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00023a00: 2020 2020 2020 2020 2020 206f 7574 203d             out =
-00023a10: 2066 6e2e 6675 6e63 282a 6172 675f 6d61   fn.func(*arg_ma
-00023a20: 702e 7661 6c75 655f 6c69 7374 290d 0a20  p.value_list).. 
-00023a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00023980: 2020 2020 6f75 7420 3d20 666e 2e66 756e      out = fn.fun
+00023990: 6328 2a61 7267 5f6d 6170 2e76 616c 7565  c(*arg_map.value
+000239a0: 5f6c 6973 7429 0d0a 2020 2020 2020 2020  _list)..        
+000239b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239c0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000239d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239e0: 2020 206f 7574 203d 2066 6e28 2a61 7267     out = fn(*arg
+000239f0: 5f6d 6170 2e76 616c 7565 5f6c 6973 7429  _map.value_list)
+00023a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023a10: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00023a20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00023a30: 6973 696e 7374 616e 6365 2866 6e2c 2070  isinstance(fn, p
+00023a40: 6172 7469 616c 293a 0d0a 2020 2020 2020  artial):..      
 00023a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a60: 2020 6f75 7420 3d20 666e 282a 6172 675f    out = fn(*arg_
-00023a70: 6d61 702e 7661 6c75 655f 6c69 7374 290d  map.value_list).
-00023a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023a90: 2020 2020 2023 2066 6f72 2069 7465 6d20       # for item 
-00023aa0: 696e 2064 6174 612e 7661 6c75 655f 6c69  in data.value_li
-00023ab0: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
-00023ac0: 2020 2020 2020 2020 2023 2020 2020 2069           #     i
-00023ad0: 6620 6861 7361 7474 7228 6974 656d 2c20  f hasattr(item, 
-00023ae0: 2763 7075 2729 3a0d 0a20 2020 2020 2020  'cpu'):..       
-00023af0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00023b00: 2020 2020 2020 2069 7465 6d2e 6370 7528         item.cpu(
-00023b10: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00023b20: 2020 2020 2072 6574 7572 6e20 6f75 740d       return out.
-00023b30: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00023b40: 6620 6361 6c6c 6162 6c65 2866 6e29 3a0d  f callable(fn):.
-00023b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023b60: 2066 6e2e 7369 676e 6174 7572 6520 3d20   fn.signature = 
-00023b70: 6765 745f 7369 676e 6174 7572 6528 666e  get_signature(fn
-00023b80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00023b90: 2020 2061 7267 7320 3d20 666e 2e73 6967     args = fn.sig
-00023ba0: 6e61 7475 7265 2e69 6e70 7574 732e 6b65  nature.inputs.ke
-00023bb0: 795f 6c69 7374 0d0a 2020 2020 2020 2020  y_list..        
-00023bc0: 2020 2020 2020 2020 666f 7220 6172 6720          for arg 
-00023bd0: 696e 2061 7267 733a 0d0a 2020 2020 2020  in args:..      
-00023be0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00023bf0: 5f6f 7074 696f 6e61 6c20 3d20 666e 2e73  _optional = fn.s
-00023c00: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
-00023c10: 6172 675d 2e6f 7074 696f 6e61 6c20 6966  arg].optional if
-00023c20: 2069 7369 6e73 7461 6e63 6528 666e 2e73   isinstance(fn.s
-00023c30: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
-00023c40: 6172 675d 2c0d 0a20 2020 2020 2020 2020  arg],..         
-00023c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c90: 2020 2020 2020 2020 2054 656e 736f 7253           TensorS
-00023ca0: 7065 6329 2065 6c73 6520 4661 6c73 650d  pec) else False.
-00023cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023cc0: 2020 2020 2064 6566 6175 6c74 203d 2066       default = f
-00023cd0: 6e2e 7369 676e 6174 7572 652e 696e 7075  n.signature.inpu
-00023ce0: 7473 5b61 7267 5d2e 6465 6661 756c 7420  ts[arg].default 
-00023cf0: 6966 2069 7369 6e73 7461 6e63 6528 666e  if isinstance(fn
-00023d00: 2e73 6967 6e61 7475 7265 2e69 6e70 7574  .signature.input
-00023d10: 735b 6172 675d 2c0d 0a20 2020 2020 2020  s[arg],..       
-00023d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d60: 2020 2020 2020 5465 6e73 6f72 5370 6563        TensorSpec
-00023d70: 2920 656c 7365 204e 6f6e 650d 0a20 2020  ) else None..   
+00023a60: 2020 6f75 7420 3d20 666e 2e66 756e 6328    out = fn.func(
+00023a70: 2a61 7267 5f6d 6170 2e76 616c 7565 5f6c  *arg_map.value_l
+00023a80: 6973 7429 0d0a 2020 2020 2020 2020 2020  ist)..          
+00023a90: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00023aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023ab0: 2020 2020 2020 2020 206f 7574 203d 2066           out = f
+00023ac0: 6e28 2a61 7267 5f6d 6170 2e76 616c 7565  n(*arg_map.value
+00023ad0: 5f6c 6973 7429 0d0a 2020 2020 2020 2020  _list)..        
+00023ae0: 2020 2020 2020 2020 2020 2020 2320 666f              # fo
+00023af0: 7220 6974 656d 2069 6e20 6461 7461 2e76  r item in data.v
+00023b00: 616c 7565 5f6c 6973 743a 0d0a 2020 2020  alue_list:..    
+00023b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b20: 2320 2020 2020 6966 2068 6173 6174 7472  #     if hasattr
+00023b30: 2869 7465 6d2c 2027 6370 7527 293a 0d0a  (item, 'cpu'):..
+00023b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b50: 2020 2020 2320 2020 2020 2020 2020 6974      #         it
+00023b60: 656d 2e63 7075 2829 0d0a 0d0a 2020 2020  em.cpu()....    
+00023b70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023b80: 726e 206f 7574 0d0a 2020 2020 2020 2020  rn out..        
+00023b90: 2020 2020 656c 6966 2063 616c 6c61 626c      elif callabl
+00023ba0: 6528 666e 293a 0d0a 2020 2020 2020 2020  e(fn):..        
+00023bb0: 2020 2020 2020 2020 666e 2e73 6967 6e61          fn.signa
+00023bc0: 7475 7265 203d 2067 6574 5f73 6967 6e61  ture = get_signa
+00023bd0: 7475 7265 2866 6e29 0d0a 2020 2020 2020  ture(fn)..      
+00023be0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
+00023bf0: 2066 6e2e 7369 676e 6174 7572 652e 696e   fn.signature.in
+00023c00: 7075 7473 2e6b 6579 5f6c 6973 740d 0a20  puts.key_list.. 
+00023c10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00023c20: 6f72 2061 7267 2069 6e20 6172 6773 3a0d  or arg in args:.
+00023c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023c40: 2020 2020 2069 735f 6f70 7469 6f6e 616c       is_optional
+00023c50: 203d 2066 6e2e 7369 676e 6174 7572 652e   = fn.signature.
+00023c60: 696e 7075 7473 5b61 7267 5d2e 6f70 7469  inputs[arg].opti
+00023c70: 6f6e 616c 2069 6620 6973 696e 7374 616e  onal if isinstan
+00023c80: 6365 2866 6e2e 7369 676e 6174 7572 652e  ce(fn.signature.
+00023c90: 696e 7075 7473 5b61 7267 5d2c 0d0a 2020  inputs[arg],..  
+00023ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cf0: 5465 6e73 6f72 5370 6563 2920 656c 7365  TensorSpec) else
+00023d00: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00023d10: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00023d20: 756c 7420 3d20 666e 2e73 6967 6e61 7475  ult = fn.signatu
+00023d30: 7265 2e69 6e70 7574 735b 6172 675d 2e64  re.inputs[arg].d
+00023d40: 6566 6175 6c74 2069 6620 6973 696e 7374  efault if isinst
+00023d50: 616e 6365 2866 6e2e 7369 676e 6174 7572  ance(fn.signatur
+00023d60: 652e 696e 7075 7473 5b61 7267 5d2c 0d0a  e.inputs[arg],..
+00023d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00023d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d90: 2069 735f 696e 7075 7420 3d20 6172 672e   is_input = arg.
-00023da0: 6c6f 7765 7228 2920 696e 205b 2778 272c  lower() in ['x',
-00023db0: 2027 696e 7075 7427 5d0d 0a20 2020 2020   'input']..     
-00023dc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023dd0: 735f 6f75 7470 7574 203d 2061 7267 2e6c  s_output = arg.l
-00023de0: 6f77 6572 2829 2069 6e20 5b27 7927 2c20  ower() in ['y', 
-00023df0: 276f 7574 7075 7427 2c20 2779 5f70 7265  'output', 'y_pre
-00023e00: 6427 5d0d 0a20 2020 2020 2020 2020 2020  d']..           
-00023e10: 2020 2020 2020 2020 2069 6620 6172 6720           if arg 
-00023e20: 696e 2064 6174 615f 6665 6564 2061 6e64  in data_feed and
-00023e30: 2064 6174 615f 6665 6564 5b61 7267 5d20   data_feed[arg] 
-00023e40: 696e 2064 6174 613a 0d0a 2020 2020 2020  in data:..      
-00023e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e60: 2020 6172 675f 6d61 705b 6172 675d 203d    arg_map[arg] =
-00023e70: 2074 6f5f 7465 6e73 6f72 2864 6174 615b   to_tensor(data[
-00023e80: 6461 7461 5f66 6565 645b 6172 675d 5d2c  data_feed[arg]],
-00023e90: 2064 6576 6963 653d 6765 745f 6465 7669   device=get_devi
-00023ea0: 6365 2829 290d 0a20 2020 2020 2020 2020  ce())..         
-00023eb0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00023ec0: 6172 6720 696e 2064 6174 613a 0d0a 2020  arg in data:..  
-00023ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ee0: 2020 2020 2020 6172 675f 6d61 705b 6172        arg_map[ar
-00023ef0: 675d 203d 2074 6f5f 7465 6e73 6f72 2864  g] = to_tensor(d
-00023f00: 6174 615b 6172 675d 2c20 6465 7669 6365  ata[arg], device
-00023f10: 3d67 6574 5f64 6576 6963 6528 2929 0d0a  =get_device())..
-00023f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f30: 2020 2020 656c 6966 2069 735f 696e 7075      elif is_inpu
-00023f40: 7420 616e 6420 2769 6e70 7574 2720 696e  t and 'input' in
-00023f50: 2064 6174 615f 6665 6564 2061 6e64 2064   data_feed and d
-00023f60: 6174 615f 6665 6564 5b27 696e 7075 7427  ata_feed['input'
-00023f70: 5d20 696e 2064 6174 613a 0d0a 2020 2020  ] in data:..    
-00023f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f90: 2020 2020 6172 675f 6d61 705b 6172 675d      arg_map[arg]
-00023fa0: 203d 2074 6f5f 7465 6e73 6f72 2864 6174   = to_tensor(dat
-00023fb0: 615b 6461 7461 5f66 6565 645b 2769 6e70  a[data_feed['inp
-00023fc0: 7574 275d 5d2c 2064 6576 6963 653d 6765  ut']], device=ge
-00023fd0: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
-00023fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ff0: 2065 6c69 6620 6973 5f6f 7574 7075 7420   elif is_output 
-00024000: 616e 6420 276f 7574 7075 7427 2069 6e20  and 'output' in 
-00024010: 6461 7461 5f66 6565 6420 616e 6420 6461  data_feed and da
-00024020: 7461 5f66 6565 645b 276f 7574 7075 7427  ta_feed['output'
-00024030: 5d20 696e 2064 6174 613a 0d0a 2020 2020  ] in data:..    
-00024040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024050: 2020 2020 6172 675f 6d61 705b 6172 675d      arg_map[arg]
-00024060: 203d 2074 6f5f 7465 6e73 6f72 2864 6174   = to_tensor(dat
-00024070: 615b 6461 7461 5f66 6565 645b 276f 7574  a[data_feed['out
-00024080: 7075 7427 5d5d 2c20 6465 7669 6365 3d67  put']], device=g
-00024090: 6574 5f64 6576 6963 6528 2929 0d0a 2020  et_device())..  
-000240a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240b0: 2020 656c 6966 2069 735f 6f70 7469 6f6e    elif is_option
-000240c0: 616c 3a0d 0a20 2020 2020 2020 2020 2020  al:..           
-000240d0: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-000240e0: 5f6d 6170 5b61 7267 5d20 3d20 6465 6661  _map[arg] = defa
-000240f0: 756c 740d 0a20 2020 2020 2020 2020 2020  ult..           
-00024100: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00024110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024120: 2020 2020 2020 2020 6172 675f 6d61 702e          arg_map.
-00024130: 706f 7028 6172 6729 0d0a 2020 2020 2020  pop(arg)..      
-00024140: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-00024150: 7428 2761 7267 5f6d 6170 272c 2061 7267  t('arg_map', arg
-00024160: 5f6d 6170 2e6b 6579 5f6c 6973 7429 0d0a  _map.key_list)..
-00024170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024180: 6966 2063 7478 2e61 6d70 5f61 7661 696c  if ctx.amp_avail
-00024190: 6162 6c65 203d 3d20 5472 7565 2061 6e64  able == True and
-000241a0: 2069 735f 6175 746f 6361 7374 5f65 6e61   is_autocast_ena
-000241b0: 626c 6564 203d 3d20 5472 7565 2061 6e64  bled == True and
-000241c0: 2067 6574 5f64 6576 6963 6528 2920 3d3d   get_device() ==
-000241d0: 2027 6375 6461 273a 0d0a 2020 2020 2020   'cuda':..      
-000241e0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-000241f0: 7468 2074 6f72 6368 2e63 7564 612e 616d  th torch.cuda.am
-00024200: 702e 6175 746f 6361 7374 2829 3a0d 0a20  p.autocast():.. 
-00024210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024220: 2020 2020 2020 206f 7574 203d 2066 6e28         out = fn(
-00024230: 2a61 7267 5f6d 6170 2e76 616c 7565 5f6c  *arg_map.value_l
-00024240: 6973 7429 0d0a 2020 2020 2020 2020 2020  ist)..          
-00024250: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00024260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024270: 206f 7574 203d 2066 6e28 2a61 7267 5f6d   out = fn(*arg_m
-00024280: 6170 2e76 616c 7565 5f6c 6973 7429 0d0a  ap.value_list)..
-00024290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242a0: 2020 2020 2320 666f 7220 6974 656d 2069      # for item i
-000242b0: 6e20 6461 7461 2e76 616c 7565 5f6c 6973  n data.value_lis
-000242c0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-000242d0: 2020 2020 2020 2020 2320 2020 2020 6966          #     if
-000242e0: 2069 735f 7465 6e73 6f72 2869 7465 6d29   is_tensor(item)
-000242f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00024300: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00024310: 2069 7465 6d2e 6370 7528 290d 0a20 2020   item.cpu()..   
-00024320: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00024330: 7572 6e20 6f75 740d 0a20 2020 2020 2020  urn out..       
-00024340: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00024350: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00024360: 7428 2775 6e63 6f6d 706c 6574 6520 6172  t('uncomplete ar
-00024370: 675f 6d61 7027 2c20 6172 675f 6d61 702e  g_map', arg_map.
-00024380: 6b65 795f 6c69 7374 290d 0a20 2020 2020  key_list)..     
-00024390: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-000243a0: 696f 6e20 6173 2065 3a0d 0a20 2020 2020  ion as e:..     
-000243b0: 2020 2020 2020 2070 7269 6e74 2865 290d         print(e).
-000243c0: 0a20 2020 2020 2020 2020 2020 2050 7269  .            Pri
-000243d0: 6e74 4578 6365 7074 696f 6e28 290d 0a0d  ntException()...
-000243e0: 0a0d 0a64 6566 2066 6f72 6365 5f64 6574  ...def force_det
-000243f0: 6572 6d69 6e69 7374 6963 2873 6565 6429  erministic(seed)
-00024400: 3a0d 0a20 2020 2022 2222 2046 6f72 6365  :..    """ Force
-00024410: 206d 6f73 7420 6f66 2074 6865 2063 6f6d   most of the com
-00024420: 7075 7461 7469 6f6e 206e 6f64 6573 2074  putation nodes t
-00024430: 6f20 7275 6e20 6465 7465 726d 696e 6973  o run determinis
-00024440: 7469 6361 6c6c 792e 0d0a 0d0a 2020 2020  tically.....    
-00024450: 4172 6773 3a0d 0a20 2020 2020 2020 2073  Args:..        s
-00024460: 6565 6420 2869 6e74 293a 2073 6574 2074  eed (int): set t
-00024470: 6865 2072 616e 646f 6d20 7365 6564 2066  he random seed f
-00024480: 6f72 2061 6c6c 2072 616e 646f 6d20 6f70  or all random op
-00024490: 7320 696e 2074 6865 2067 7261 7068 2061  s in the graph a
-000244a0: 6e64 2072 6561 6465 7273 2e0d 0a0d 0a20  nd readers..... 
-000244b0: 2020 2022 2222 0d0a 0d0a 2020 2020 7365     """....    se
-000244c0: 745f 7365 6564 2873 6565 6429 0d0a 2020  t_seed(seed)..  
-000244d0: 2020 746f 7263 682e 6261 636b 656e 6473    torch.backends
-000244e0: 2e63 7564 6e6e 2e64 6574 6572 6d69 6e69  .cudnn.determini
-000244f0: 7374 6963 203d 2054 7275 650d 0a20 2020  stic = True..   
-00024500: 2074 6f72 6368 2e62 6163 6b65 6e64 732e   torch.backends.
-00024510: 6375 646e 6e2e 6265 6e63 686d 6172 6b20  cudnn.benchmark 
-00024520: 3d20 4661 6c73 650d 0a20 2020 206f 732e  = False..    os.
-00024530: 656e 7669 726f 6e5b 2750 5954 484f 4e48  environ['PYTHONH
-00024540: 4153 4853 4545 4427 5d20 3d20 7374 7228  ASHSEED'] = str(
-00024550: 7365 6564 290d 0a0d 0a0d 0a64 6566 2066  seed)......def f
-00024560: 6978 5f6c 6179 6572 286c 6179 6572 3a20  ix_layer(layer: 
-00024570: 4c61 7965 7229 3a0d 0a20 2020 2022 2222  Layer):..    """
-00024580: 6669 7820 6578 6973 7469 6e67 206f 7574  fix existing out
-00024590: 2d6f 662d 6461 7465 206d 6f64 656c 2063  -of-date model c
-000245a0: 6f6d 7061 7469 6269 6c69 7479 0d0a 0d0a  ompatibility....
-000245b0: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-000245c0: 2020 206c 6179 6572 2028 7472 6964 656e     layer (triden
-000245d0: 7420 4c61 7965 7229 3a0d 0a0d 0a20 2020  t Layer):....   
-000245e0: 2052 6574 7572 6e73 3a20 6669 7865 6420   Returns: fixed 
-000245f0: 6c61 7965 720d 0a0d 0a20 2020 2022 2222  layer....    """
-00024600: 0d0a 2020 2020 6966 206e 6f74 2068 6173  ..    if not has
-00024610: 6174 7472 286c 6179 6572 2c20 2769 735f  attr(layer, 'is_
-00024620: 726f 6f74 2729 3a0d 0a20 2020 2020 2020  root'):..       
-00024630: 206c 6179 6572 2e69 735f 726f 6f74 203d   layer.is_root =
-00024640: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
-00024650: 2067 6574 5f72 6f6f 7428 7365 6c66 293a   get_root(self):
-00024660: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00024670: 2068 6173 6174 7472 2873 656c 662c 2027   hasattr(self, '
-00024680: 5f6e 6f64 6573 2729 206f 7220 7365 6c66  _nodes') or self
-00024690: 2e5f 6e6f 6465 7320 6973 204e 6f6e 6520  ._nodes is None 
-000246a0: 6f72 206c 656e 2873 656c 662e 5f6e 6f64  or len(self._nod
-000246b0: 6573 2920 3c20 323a 0d0a 2020 2020 2020  es) < 2:..      
-000246c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000246d0: 660d 0a20 2020 2020 2020 2069 6620 6861  f..        if ha
-000246e0: 7361 7474 7228 6c69 7374 2873 656c 662e  sattr(list(self.
-000246f0: 5f6e 6f64 6573 2e76 616c 7565 7328 2929  _nodes.values())
-00024700: 5b30 5d2c 2027 6973 5f72 6f6f 7427 2920  [0], 'is_root') 
-00024710: 616e 6420 6c69 7374 2873 656c 662e 5f6e  and list(self._n
-00024720: 6f64 6573 2e76 616c 7565 7328 2929 5b30  odes.values())[0
-00024730: 5d2e 6973 5f72 6f6f 7420 3d3d 2054 7275  ].is_root == Tru
-00024740: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00024750: 7265 7475 726e 206c 6973 7428 7365 6c66  return list(self
-00024760: 2e5f 6e6f 6465 732e 7661 6c75 6573 2829  ._nodes.values()
-00024770: 295b 305d 0d0a 2020 2020 2020 2020 656c  )[0]..        el
-00024780: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00024790: 2066 6f72 206e 616d 652c 206e 6f64 6520   for name, node 
-000247a0: 696e 2073 656c 662e 5f6e 6f64 6573 2e69  in self._nodes.i
-000247b0: 7465 6d73 2829 3a0d 0a20 2020 2020 2020  tems():..       
-000247c0: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-000247d0: 7474 7228 6e6f 6465 2c20 2764 6566 6175  ttr(node, 'defau
-000247e0: 6c74 5f6e 616d 6527 2920 616e 6420 6e6f  lt_name') and no
-000247f0: 6465 2e64 6566 6175 6c74 5f6e 616d 6520  de.default_name 
-00024800: 3d3d 2022 7365 7175 656e 7469 616c 5f31  == "sequential_1
-00024810: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00024820: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00024830: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
-00024840: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
-00024850: 2020 2020 2320 6966 206e 6f74 2068 6173      # if not has
-00024860: 6174 7472 286c 6179 6572 2c20 2764 6576  attr(layer, 'dev
-00024870: 6963 6527 293a 0d0a 2020 2020 2320 2020  ice'):..    #   
-00024880: 2020 6c61 7965 722e 6465 7669 6365 203d    layer.device =
-00024890: 206c 6179 6572 2e77 6569 6768 7473 5b30   layer.weights[0
-000248a0: 5d2e 6465 7669 6365 2e74 7970 650d 0a0d  ].device.type...
-000248b0: 0a20 2020 206c 6179 6572 2e74 6f28 6765  .    layer.to(ge
-000248c0: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
-000248d0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-000248e0: 6c61 7965 722c 2027 5f6e 6f64 6573 2729  layer, '_nodes')
-000248f0: 3a0d 0a20 2020 2020 2020 206c 6179 6572  :..        layer
-00024900: 2e5f 6e6f 6465 7320 3d20 4f72 6465 7265  ._nodes = Ordere
-00024910: 6444 6963 7428 290d 0a0d 0a20 2020 2069  dDict()....    i
-00024920: 6620 6e6f 7420 6861 7361 7474 7228 6c61  f not hasattr(la
-00024930: 7965 722c 2027 5f75 6964 5f70 7265 6669  yer, '_uid_prefi
-00024940: 7873 2729 3a0d 0a20 2020 2020 2020 206c  xs'):..        l
-00024950: 6179 6572 2e5f 7569 645f 7072 6566 6978  ayer._uid_prefix
-00024960: 7320 3d20 7b7d 0d0a 2020 2020 7265 7365  s = {}..    rese
-00024970: 745f 6e61 6d65 286c 6179 6572 2c20 6c61  t_name(layer, la
-00024980: 7965 722e 5f75 6964 5f70 7265 6669 7873  yer._uid_prefixs
-00024990: 290d 0a0d 0a20 2020 2069 6620 2773 7364  )....    if 'ssd
-000249a0: 2720 696e 206c 6179 6572 2e5f 5f63 6c61  ' in layer.__cla
-000249b0: 7373 5f5f 2e5f 5f62 6173 655f 5f2e 5f5f  ss__.__base__.__
-000249c0: 6e61 6d65 5f5f 2e6c 6f77 6572 2829 206f  name__.lower() o
-000249d0: 7220 2779 6f6c 6f27 2069 6e20 6c61 7965  r 'yolo' in laye
-000249e0: 722e 5f5f 636c 6173 735f 5f2e 5f5f 6261  r.__class__.__ba
-000249f0: 7365 5f5f 2e5f 5f6e 616d 655f 5f2e 6c6f  se__.__name__.lo
-00024a00: 7765 7228 293a 0d0a 2020 2020 2020 2020  wer():..        
-00024a10: 6966 2068 6173 6174 7472 286c 6179 6572  if hasattr(layer
-00024a20: 2c20 276e 6d73 5f74 6872 6573 686f 6c64  , 'nms_threshold
-00024a30: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00024a40: 2064 656c 6174 7472 286c 6179 6572 2c20   delattr(layer, 
-00024a50: 276e 6d73 5f74 6872 6573 686f 6c64 2729  'nms_threshold')
-00024a60: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
-00024a70: 6174 7472 286c 6179 6572 2c20 2764 6574  attr(layer, 'det
-00024a80: 6563 7469 6f6e 5f74 6872 6573 686f 6c64  ection_threshold
-00024a90: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00024aa0: 2064 656c 6174 7472 286c 6179 6572 2c20   delattr(layer, 
-00024ab0: 2764 6574 6563 7469 6f6e 5f74 6872 6573  'detection_thres
-00024ac0: 686f 6c64 2729 0d0a 0d0a 2020 2020 6966  hold')....    if
-00024ad0: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
-00024ae0: 6170 6520 6973 206e 6f74 204e 6f6e 6520  ape is not None 
-00024af0: 616e 6420 6973 696e 7374 616e 6365 286c  and isinstance(l
-00024b00: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
-00024b10: 652c 2074 7570 6c65 2920 616e 6420 616c  e, tuple) and al
-00024b20: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
-00024b30: 5b69 7369 6e73 7461 6e63 6528 642c 206e  [isinstance(d, n
-00024b40: 756d 6265 7273 2e49 6e74 6567 7261 6c29  umbers.Integral)
-00024b50: 2066 6f72 2064 2069 6e20 6c61 7965 722e   for d in layer.
-00024b60: 5f69 6e70 7574 5f73 6861 7065 5d29 3a0d  _input_shape]):.
-00024b70: 0a20 2020 2020 2020 2064 696d 7320 3d20  .        dims = 
-00024b80: 5b64 2066 6f72 2064 2069 6e20 6c61 7965  [d for d in laye
-00024b90: 722e 5f69 6e70 7574 5f73 6861 7065 5d0d  r._input_shape].
-00024ba0: 0a20 2020 2020 2020 2064 696d 732e 696e  .        dims.in
-00024bb0: 7365 7274 2830 2c20 4e6f 6e65 290d 0a20  sert(0, None).. 
-00024bc0: 2020 2020 2020 206c 6179 6572 2e5f 696e         layer._in
-00024bd0: 7075 745f 7368 6170 6520 3d20 5465 6e73  put_shape = Tens
-00024be0: 6f72 5368 6170 6528 6469 6d73 290d 0a20  orShape(dims).. 
-00024bf0: 2020 2065 6c69 6620 6c61 7965 722e 5f69     elif layer._i
-00024c00: 6e70 7574 5f73 6861 7065 2069 7320 6e6f  nput_shape is no
-00024c10: 7420 4e6f 6e65 2061 6e64 2069 7369 6e73  t None and isins
-00024c20: 7461 6e63 6528 6c61 7965 722e 5f69 6e70  tance(layer._inp
-00024c30: 7574 5f73 6861 7065 2c20 7475 706c 6529  ut_shape, tuple)
-00024c40: 3a0d 0a20 2020 2020 2020 206c 6179 6572  :..        layer
-00024c50: 2e5f 696e 7075 745f 7368 6170 6520 3d20  ._input_shape = 
-00024c60: 7475 706c 6528 5b54 656e 736f 7253 6861  tuple([TensorSha
-00024c70: 7065 2874 6f5f 6e75 6d70 7928 6974 656d  pe(to_numpy(item
-00024c80: 2929 2066 6f72 2069 7465 6d20 696e 2054  )) for item in T
-00024c90: 656e 736f 7253 6861 7065 286c 6179 6572  ensorShape(layer
-00024ca0: 2e5f 696e 7075 745f 7368 6170 6529 5d29  ._input_shape)])
-00024cb0: 0d0a 2020 2020 656c 6966 206c 6179 6572  ..    elif layer
-00024cc0: 2e5f 696e 7075 745f 7368 6170 6520 6973  ._input_shape is
-00024cd0: 206e 6f74 204e 6f6e 6520 616e 6420 6973   not None and is
-00024ce0: 5f74 656e 736f 7228 6c61 7965 722e 5f69  _tensor(layer._i
-00024cf0: 6e70 7574 5f73 6861 7065 293a 0d0a 2020  nput_shape):..  
-00024d00: 2020 2020 2020 6469 6d73 203d 205b 642e        dims = [d.
-00024d10: 6974 656d 2829 2066 6f72 2064 2069 6e20  item() for d in 
-00024d20: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
-00024d30: 7065 5d0d 0a20 2020 2020 2020 2064 696d  pe]..        dim
-00024d40: 732e 696e 7365 7274 2830 2c20 4e6f 6e65  s.insert(0, None
-00024d50: 290d 0a20 2020 2020 2020 2062 7566 6665  )..        buffe
-00024d60: 7273 203d 206c 6179 6572 2e5f 5f64 6963  rs = layer.__dic
-00024d70: 745f 5f2e 6765 7428 275f 6275 6666 6572  t__.get('_buffer
-00024d80: 7327 290d 0a20 2020 2020 2020 2069 6620  s')..        if 
-00024d90: 275f 696e 7075 745f 7368 6170 6527 2069  '_input_shape' i
-00024da0: 6e20 6275 6666 6572 733a 0d0a 2020 2020  n buffers:..    
-00024db0: 2020 2020 2020 2020 6465 6c20 6275 6666          del buff
-00024dc0: 6572 735b 275f 696e 7075 745f 7368 6170  ers['_input_shap
-00024dd0: 6527 5d0d 0a20 2020 2020 2020 206f 626a  e']..        obj
-00024de0: 6563 742e 5f5f 7365 7461 7474 725f 5f28  ect.__setattr__(
-00024df0: 6c61 7965 722c 2027 5f69 6e70 7574 5f73  layer, '_input_s
-00024e00: 6861 7065 272c 2054 656e 736f 7253 6861  hape', TensorSha
-00024e10: 7065 2864 696d 7329 290d 0a20 2020 2065  pe(dims))..    e
-00024e20: 6c69 6620 6c61 7965 722e 5f69 6e70 7574  lif layer._input
-00024e30: 5f73 6861 7065 2069 7320 6e6f 7420 4e6f  _shape is not No
-00024e40: 6e65 2061 6e64 206e 6f74 2069 7369 6e73  ne and not isins
-00024e50: 7461 6e63 6528 6c61 7965 722e 5f69 6e70  tance(layer._inp
-00024e60: 7574 5f73 6861 7065 2c20 5465 6e73 6f72  ut_shape, Tensor
-00024e70: 5368 6170 6529 3a0d 0a20 2020 2020 2020  Shape):..       
-00024e80: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
-00024e90: 6170 6520 3d20 5465 6e73 6f72 5368 6170  ape = TensorShap
-00024ea0: 6528 746f 5f6e 756d 7079 286c 6179 6572  e(to_numpy(layer
-00024eb0: 2e5f 696e 7075 745f 7368 6170 6529 290d  ._input_shape)).
-00024ec0: 0a20 2020 2065 6c69 6620 6c61 7965 722e  .    elif layer.
-00024ed0: 5f69 6e70 7574 5f73 6861 7065 2069 7320  _input_shape is 
-00024ee0: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7369  not None and isi
-00024ef0: 6e73 7461 6e63 6528 6c61 7965 722e 5f69  nstance(layer._i
-00024f00: 6e70 7574 5f73 6861 7065 2c20 5465 6e73  nput_shape, Tens
-00024f10: 6f72 5368 6170 6529 2061 6e64 2069 735f  orShape) and is_
-00024f20: 7465 6e73 6f72 280d 0a20 2020 2020 2020  tensor(..       
-00024f30: 2020 2020 206c 6179 6572 2e5f 696e 7075       layer._inpu
-00024f40: 745f 7368 6170 652e 6469 6d73 5b30 5d29  t_shape.dims[0])
-00024f50: 3a0d 0a20 2020 2020 2020 206c 6179 6572  :..        layer
-00024f60: 2e5f 696e 7075 745f 7368 6170 6520 3d20  ._input_shape = 
-00024f70: 5465 6e73 6f72 5368 6170 6528 5b64 2e69  TensorShape([d.i
-00024f80: 7465 6d28 2920 666f 7220 6420 696e 206c  tem() for d in l
-00024f90: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
-00024fa0: 652e 6469 6d73 5d29 0d0a 0d0a 2020 2020  e.dims])....    
-00024fb0: 6966 206c 6179 6572 2e5f 6f75 7470 7574  if layer._output
-00024fc0: 5f73 6861 7065 2069 7320 6e6f 7420 4e6f  _shape is not No
-00024fd0: 6e65 2061 6e64 2069 7369 6e73 7461 6e63  ne and isinstanc
-00024fe0: 6528 6c61 7965 722e 5f6f 7574 7075 745f  e(layer._output_
-00024ff0: 7368 6170 652c 2074 7570 6c65 2920 616e  shape, tuple) an
-00025000: 6420 616c 6c28 0d0a 2020 2020 2020 2020  d all(..        
-00025010: 2020 2020 5b69 7369 6e73 7461 6e63 6528      [isinstance(
-00025020: 642c 206e 756d 6265 7273 2e49 6e74 6567  d, numbers.Integ
-00025030: 7261 6c29 2066 6f72 2064 2069 6e20 6c61  ral) for d in la
-00025040: 7965 722e 5f6f 7574 7075 745f 7368 6170  yer._output_shap
-00025050: 655d 293a 0d0a 2020 2020 2020 2020 6469  e]):..        di
-00025060: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
-00025070: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
-00025080: 6170 655d 0d0a 2020 2020 2020 2020 6469  ape]..        di
-00025090: 6d73 2e69 6e73 6572 7428 302c 204e 6f6e  ms.insert(0, Non
-000250a0: 6529 0d0a 2020 2020 2020 2020 6c61 7965  e)..        laye
-000250b0: 722e 5f69 6e70 7574 5f73 6861 7065 203d  r._input_shape =
-000250c0: 2054 656e 736f 7253 6861 7065 2864 696d   TensorShape(dim
-000250d0: 7329 0d0a 2020 2020 656c 6966 206c 6179  s)..    elif lay
-000250e0: 6572 2e5f 6f75 7470 7574 5f73 6861 7065  er._output_shape
-000250f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00025100: 2069 7369 6e73 7461 6e63 6528 6c61 7965   isinstance(laye
-00025110: 722e 5f6f 7574 7075 745f 7368 6170 652c  r._output_shape,
-00025120: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
-00025130: 2020 6c61 7965 722e 5f6f 7574 7075 745f    layer._output_
-00025140: 7368 6170 6520 3d20 7475 706c 6528 5b54  shape = tuple([T
-00025150: 656e 736f 7253 6861 7065 2874 6f5f 6e75  ensorShape(to_nu
-00025160: 6d70 7928 6974 656d 2929 2066 6f72 2069  mpy(item)) for i
-00025170: 7465 6d20 696e 2054 656e 736f 7253 6861  tem in TensorSha
-00025180: 7065 286c 6179 6572 2e5f 6f75 7470 7574  pe(layer._output
-00025190: 5f73 6861 7065 295d 290d 0a20 2020 2065  _shape)])..    e
-000251a0: 6c69 6620 6c61 7965 722e 5f6f 7574 7075  lif layer._outpu
-000251b0: 745f 7368 6170 6520 6973 206e 6f74 204e  t_shape is not N
-000251c0: 6f6e 6520 616e 6420 6973 5f74 656e 736f  one and is_tenso
-000251d0: 7228 6c61 7965 722e 5f6f 7574 7075 745f  r(layer._output_
-000251e0: 7368 6170 6529 3a0d 0a20 2020 2020 2020  shape):..       
-000251f0: 2064 696d 7320 3d20 5b64 2e69 7465 6d28   dims = [d.item(
-00025200: 2920 666f 7220 6420 696e 206c 6179 6572  ) for d in layer
-00025210: 2e5f 6f75 7470 7574 5f73 6861 7065 5d0d  ._output_shape].
-00025220: 0a20 2020 2020 2020 2064 696d 732e 696e  .        dims.in
-00025230: 7365 7274 2830 2c20 4e6f 6e65 290d 0a20  sert(0, None).. 
-00025240: 2020 2020 2020 2062 7566 6665 7273 203d         buffers =
-00025250: 206c 6179 6572 2e5f 5f64 6963 745f 5f2e   layer.__dict__.
-00025260: 6765 7428 275f 6275 6666 6572 7327 290d  get('_buffers').
-00025270: 0a20 2020 2020 2020 2069 6620 275f 696e  .        if '_in
-00025280: 7075 745f 7368 6170 6527 2069 6e20 6275  put_shape' in bu
-00025290: 6666 6572 733a 0d0a 2020 2020 2020 2020  ffers:..        
-000252a0: 2020 2020 6465 6c20 6275 6666 6572 735b      del buffers[
-000252b0: 275f 6f75 7470 7574 5f73 6861 7065 275d  '_output_shape']
-000252c0: 0d0a 2020 2020 2020 2020 6f62 6a65 6374  ..        object
-000252d0: 2e5f 5f73 6574 6174 7472 5f5f 286c 6179  .__setattr__(lay
-000252e0: 6572 2c20 275f 6f75 7470 7574 5f73 6861  er, '_output_sha
-000252f0: 7065 272c 2054 656e 736f 7253 6861 7065  pe', TensorShape
-00025300: 2864 696d 7329 290d 0a20 2020 2065 6c69  (dims))..    eli
-00025310: 6620 6c61 7965 722e 5f6f 7574 7075 745f  f layer._output_
-00025320: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
-00025330: 6520 616e 6420 6e6f 7420 6973 696e 7374  e and not isinst
-00025340: 616e 6365 286c 6179 6572 2e5f 6f75 7470  ance(layer._outp
-00025350: 7574 5f73 6861 7065 2c20 5465 6e73 6f72  ut_shape, Tensor
-00025360: 5368 6170 6529 3a0d 0a20 2020 2020 2020  Shape):..       
-00025370: 206c 6179 6572 2e5f 6f75 7470 7574 5f73   layer._output_s
-00025380: 6861 7065 203d 2054 656e 736f 7253 6861  hape = TensorSha
-00025390: 7065 286c 6179 6572 2e5f 6f75 7470 7574  pe(layer._output
-000253a0: 5f73 6861 7065 290d 0a20 2020 2065 6c69  _shape)..    eli
-000253b0: 6620 6c61 7965 722e 5f6f 7574 7075 745f  f layer._output_
-000253c0: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
-000253d0: 6520 616e 6420 6973 696e 7374 616e 6365  e and isinstance
-000253e0: 286c 6179 6572 2e5f 6f75 7470 7574 5f73  (layer._output_s
-000253f0: 6861 7065 2c20 5465 6e73 6f72 5368 6170  hape, TensorShap
-00025400: 6529 2061 6e64 2069 7369 6e73 7461 6e63  e) and isinstanc
-00025410: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00025420: 6c61 7965 722e 5f6f 7574 7075 745f 7368  layer._output_sh
-00025430: 6170 652e 6469 6d73 5b30 5d2c 2074 6f72  ape.dims[0], tor
-00025440: 6368 2e53 697a 6529 2061 6e64 206c 656e  ch.Size) and len
-00025450: 286c 6179 6572 2e5f 6f75 7470 7574 5f73  (layer._output_s
-00025460: 6861 7065 2e64 696d 735b 305d 2920 3d3d  hape.dims[0]) ==
-00025470: 2031 3a0d 0a20 2020 2020 2020 206c 6179   1:..        lay
-00025480: 6572 2e5f 6f75 7470 7574 5f73 6861 7065  er._output_shape
-00025490: 203d 2054 656e 736f 7253 6861 7065 285b   = TensorShape([
-000254a0: 4e6f 6e65 2069 6620 6420 6973 204e 6f6e  None if d is Non
-000254b0: 6520 656c 7365 2064 5b30 5d20 666f 7220  e else d[0] for 
-000254c0: 6420 696e 206c 6179 6572 2e5f 6f75 7470  d in layer._outp
-000254d0: 7574 5f73 6861 7065 2e64 696d 735d 290d  ut_shape.dims]).
-000254e0: 0a20 2020 2065 6c69 6620 6c61 7965 722e  .    elif layer.
-000254f0: 5f6f 7574 7075 745f 7368 6170 6520 6973  _output_shape is
-00025500: 206e 6f74 204e 6f6e 6520 616e 6420 6973   not None and is
-00025510: 696e 7374 616e 6365 286c 6179 6572 2e5f  instance(layer._
-00025520: 6f75 7470 7574 5f73 6861 7065 2c20 5465  output_shape, Te
-00025530: 6e73 6f72 5368 6170 6529 2061 6e64 2069  nsorShape) and i
-00025540: 7369 6e73 7461 6e63 6528 0d0a 2020 2020  sinstance(..    
-00025550: 2020 2020 2020 2020 6c61 7965 722e 5f6f          layer._o
-00025560: 7574 7075 745f 7368 6170 652e 6469 6d73  utput_shape.dims
-00025570: 5b30 5d2c 2074 6f72 6368 2e53 697a 6529  [0], torch.Size)
-00025580: 3a0d 0a20 2020 2020 2020 206c 6179 6572  :..        layer
-00025590: 2e5f 6f75 7470 7574 5f73 6861 7065 203d  ._output_shape =
-000255a0: 2074 7570 6c65 285b 5465 6e73 6f72 5368   tuple([TensorSh
-000255b0: 6170 6528 746f 5f6e 756d 7079 2864 2929  ape(to_numpy(d))
-000255c0: 2066 6f72 2064 2069 6e20 6c61 7965 722e   for d in layer.
-000255d0: 5f6f 7574 7075 745f 7368 6170 652e 6469  _output_shape.di
-000255e0: 6d73 5d29 0d0a 0d0a 2020 2020 6966 206e  ms])....    if n
-000255f0: 6f74 2068 6173 6174 7472 286c 6179 6572  ot hasattr(layer
-00025600: 2c20 2767 6574 5f72 6f6f 7427 293a 0d0a  , 'get_root'):..
-00025610: 2020 2020 2020 2020 7365 7461 7474 7228          setattr(
-00025620: 6c61 7965 722c 2027 6765 745f 726f 6f74  layer, 'get_root
-00025630: 272c 204d 6574 686f 6454 7970 6528 6765  ', MethodType(ge
-00025640: 745f 726f 6f74 2c20 6c61 7965 7229 290d  t_root, layer)).
-00025650: 0a0d 0a20 2020 2066 6f72 206d 6f64 756c  ...    for modul
-00025660: 6520 696e 206c 6179 6572 2e6d 6f64 756c  e in layer.modul
-00025670: 6573 2829 3a0d 0a20 2020 2020 2020 206d  es():..        m
-00025680: 6f64 756c 652e 6475 6d70 5f70 6174 6368  odule.dump_patch
-00025690: 6573 203d 2054 7275 650d 0a20 2020 2020  es = True..     
-000256a0: 2020 2023 2069 6620 6e6f 7420 6861 7361     # if not hasa
-000256b0: 7474 7228 6d6f 6475 6c65 2c20 275f 7369  ttr(module, '_si
-000256c0: 676e 6174 7572 6527 293a 0d0a 2020 2020  gnature'):..    
-000256d0: 2020 2020 2320 2020 2020 6d6f 6475 6c65      #     module
-000256e0: 2e5f 7369 676e 6174 7572 6520 3d20 696e  ._signature = in
-000256f0: 7370 6563 742e 7369 676e 6174 7572 6528  spect.signature(
-00025700: 6d6f 6475 6c65 2e66 6f72 7761 7264 290d  module.forward).
-00025710: 0a20 2020 2020 2020 2063 6c61 7373 5f6e  .        class_n
-00025720: 616d 6520 3d20 6d6f 6475 6c65 2e5f 5f63  ame = module.__c
-00025730: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f0d  lass__.__name__.
-00025740: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00025750: 6861 7361 7474 7228 6d6f 6475 6c65 2c20  hasattr(module, 
-00025760: 2767 6574 5f72 6f6f 7427 293a 0d0a 2020  'get_root'):..  
-00025770: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-00025780: 7228 6d6f 6475 6c65 2c20 2767 6574 5f72  r(module, 'get_r
-00025790: 6f6f 7427 2c20 4d65 7468 6f64 5479 7065  oot', MethodType
-000257a0: 2867 6574 5f72 6f6f 742c 206c 6179 6572  (get_root, layer
-000257b0: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
-000257c0: 206e 6f74 2068 6173 6174 7472 286d 6f64   not hasattr(mod
-000257d0: 756c 652c 2027 5f73 7461 7465 5f64 6963  ule, '_state_dic
-000257e0: 745f 7072 655f 686f 6f6b 7327 293a 0d0a  t_pre_hooks'):..
-000257f0: 2020 2020 2020 2020 2020 2020 6f62 6a65              obje
-00025800: 6374 2e5f 5f73 6574 6174 7472 5f5f 286d  ct.__setattr__(m
-00025810: 6f64 756c 652c 2027 5f66 6f72 7761 7264  odule, '_forward
-00025820: 5f68 6f6f 6b73 5f77 6974 685f 6b77 6172  _hooks_with_kwar
-00025830: 6773 272c 204f 7264 6572 6564 4469 6374  gs', OrderedDict
-00025840: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-00025850: 206f 626a 6563 742e 5f5f 7365 7461 7474   object.__setatt
-00025860: 725f 5f28 6d6f 6475 6c65 2c20 275f 666f  r__(module, '_fo
-00025870: 7277 6172 645f 7072 655f 686f 6f6b 735f  rward_pre_hooks_
-00025880: 7769 7468 5f6b 7761 7267 7327 2c20 4f72  with_kwargs', Or
-00025890: 6465 7265 6444 6963 7428 2929 0d0a 2020  deredDict())..  
-000258a0: 2020 2020 2020 2020 2020 6f62 6a65 6374            object
-000258b0: 2e5f 5f73 6574 6174 7472 5f5f 286d 6f64  .__setattr__(mod
-000258c0: 756c 652c 2027 5f62 6163 6b77 6172 645f  ule, '_backward_
-000258d0: 7072 655f 686f 6f6b 7327 2c20 4f72 6465  pre_hooks', Orde
-000258e0: 7265 6444 6963 7428 2929 0d0a 2020 2020  redDict())..    
-000258f0: 2020 2020 2020 2020 6f62 6a65 6374 2e5f          object._
-00025900: 5f73 6574 6174 7472 5f5f 286d 6f64 756c  _setattr__(modul
-00025910: 652c 2027 5f73 7461 7465 5f64 6963 745f  e, '_state_dict_
-00025920: 7072 655f 686f 6f6b 7327 2c20 4f72 6465  pre_hooks', Orde
-00025930: 7265 6444 6963 7428 2929 0d0a 0d0a 2020  redDict())....  
-00025940: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-00025950: 6174 7472 286d 6f64 756c 652c 2027 7575  attr(module, 'uu
-00025960: 6964 2729 3a0d 0a20 2020 2020 2020 2020  id'):..         
-00025970: 2020 206d 6f64 756c 652e 7575 6964 203d     module.uuid =
-00025980: 2075 7569 642e 7575 6964 3428 292e 6e6f   uuid.uuid4().no
-00025990: 6465 0d0a 2020 2020 2020 2020 2320 6368  de..        # ch
-000259a0: 6563 6b20 666f 7220 726f 6f74 0d0a 2020  eck for root..  
-000259b0: 2020 2020 2020 6966 206d 6f64 756c 652e        if module.
-000259c0: 7575 6964 203d 3d20 6c61 7965 722e 7575  uuid == layer.uu
-000259d0: 6964 3a0d 0a20 2020 2020 2020 2020 2020  id:..           
-000259e0: 206d 6f64 756c 652e 6973 5f72 6f6f 7420   module.is_root 
-000259f0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00025a00: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00025a10: 2020 206d 6f64 756c 652e 6973 5f72 6f6f     module.is_roo
-00025a20: 7420 3d20 4661 6c73 650d 0a20 2020 2020  t = False..     
-00025a30: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-00025a40: 7228 6d6f 6475 6c65 2c20 2772 656c 6174  r(module, 'relat
-00025a50: 6976 655f 6e61 6d65 2729 3a0d 0a20 2020  ive_name'):..   
-00025a60: 2020 2020 2020 2020 206d 6f64 756c 652e           module.
-00025a70: 7265 6c61 7469 7665 5f6e 616d 6520 3d20  relative_name = 
-00025a80: 2727 0d0a 2020 2020 2020 2020 6966 206e  ''..        if n
-00025a90: 6f74 2068 6173 6174 7472 286d 6f64 756c  ot hasattr(modul
-00025aa0: 652c 2027 5f75 6964 5f70 7265 6669 7873  e, '_uid_prefixs
-00025ab0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00025ac0: 206d 6f64 756c 652e 5f75 6964 5f70 7265   module._uid_pre
-00025ad0: 6669 7873 203d 206c 6179 6572 2e67 6574  fixs = layer.get
-00025ae0: 5f72 6f6f 7428 292e 5f75 6964 5f70 7265  _root()._uid_pre
-00025af0: 6669 7873 0d0a 0d0a 2020 2020 2020 2020  fixs....        
-00025b00: 6966 206e 6f74 2068 6173 6174 7472 286d  if not hasattr(m
-00025b10: 6f64 756c 652c 2027 6465 6661 756c 745f  odule, 'default_
-00025b20: 6e61 6d65 2729 206f 7220 286d 6f64 756c  name') or (modul
-00025b30: 652e 6465 6661 756c 745f 6e61 6d65 2069  e.default_name i
-00025b40: 7320 4e6f 6e65 206f 7220 6c65 6e28 6d6f  s None or len(mo
-00025b50: 6475 6c65 2e64 6566 6175 6c74 5f6e 616d  dule.default_nam
-00025b60: 6529 203d 3d20 3029 3a0d 0a20 2020 2020  e) == 0):..     
-00025b70: 2020 2020 2020 206d 6f64 756c 655f 7072         module_pr
-00025b80: 6566 6978 203d 206d 6f64 756c 652e 5f5f  efix = module.__
-00025b90: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00025ba0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-00025bb0: 6475 6c65 2e64 6566 6175 6c74 5f6e 616d  dule.default_nam
-00025bc0: 6520 3d20 6361 6d65 6c32 736e 616b 6528  e = camel2snake(
-00025bd0: 6d6f 6475 6c65 5f70 7265 6669 7829 202b  module_prefix) +
-00025be0: 2027 5f27 202b 2073 7472 2867 6574 5f67   '_' + str(get_g
-00025bf0: 6c6f 6261 6c5f 7569 6428 6361 6d65 6c32  lobal_uid(camel2
-00025c00: 736e 616b 6528 6d6f 6475 6c65 5f70 7265  snake(module_pre
-00025c10: 6669 7829 2929 0d0a 0d0a 2020 2020 2020  fix)))....      
-00025c20: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
-00025c30: 286d 6f64 756c 652c 2027 5f6e 616d 6527  (module, '_name'
-00025c40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00025c50: 6d6f 6475 6c65 2e5f 6e61 6d65 203d 204e  module._name = N
-00025c60: 6f6e 650d 0a20 2020 2020 2020 2072 6573  one..        res
-00025c70: 6574 5f6e 616d 6528 6d6f 6475 6c65 2c20  et_name(module, 
-00025c80: 6c61 7965 722e 6765 745f 726f 6f74 2829  layer.get_root()
-00025c90: 2e5f 7569 645f 7072 6566 6978 7329 0d0a  ._uid_prefixs)..
-00025ca0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00025cb0: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
-00025cc0: 2027 6e61 6d65 2729 3a0d 0a20 2020 2020   'name'):..     
-00025cd0: 2020 2020 2020 206d 6f64 756c 652e 6e61         module.na
-00025ce0: 6d65 203d 206d 6f64 756c 652e 5f6e 616d  me = module._nam
-00025cf0: 6520 6966 206d 6f64 756c 652e 5f6e 616d  e if module._nam
-00025d00: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
-00025d10: 6420 6c65 6e28 6d6f 6475 6c65 2e5f 6e61  d len(module._na
-00025d20: 6d65 2920 3e20 3020 656c 7365 206d 6f64  me) > 0 else mod
-00025d30: 756c 652e 7265 6c61 7469 7665 5f6e 616d  ule.relative_nam
-00025d40: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
-00025d50: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
-00025d60: 6c65 2c20 275f 6275 696c 7427 293a 0d0a  le, '_built'):..
-00025d70: 2020 2020 2020 2020 2020 2020 7365 7461              seta
-00025d80: 7474 7228 6d6f 6475 6c65 2c20 2762 7569  ttr(module, 'bui
-00025d90: 6c74 272c 2054 7275 6529 0d0a 0d0a 2020  lt', True)....  
-00025da0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-00025db0: 286d 6f64 756c 652c 2027 6b65 6570 6469  (module, 'keepdi
-00025dc0: 6d27 293a 0d0a 2020 2020 2020 2020 2020  m'):..          
-00025dd0: 2020 7661 6c75 6520 3d20 6765 7461 7474    value = getatt
-00025de0: 7228 6d6f 6475 6c65 2c20 276b 6565 7064  r(module, 'keepd
-00025df0: 696d 2729 0d0a 2020 2020 2020 2020 2020  im')..          
-00025e00: 2020 6465 6c61 7474 7228 6d6f 6475 6c65    delattr(module
-00025e10: 2c20 276b 6565 7064 696d 2729 0d0a 2020  , 'keepdim')..  
-00025e20: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-00025e30: 7228 6d6f 6475 6c65 2c20 276b 6565 7064  r(module, 'keepd
-00025e40: 696d 7327 2c20 7661 6c75 6529 0d0a 0d0a  ims', value)....
-00025e50: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
-00025e60: 6173 6174 7472 286d 6f64 756c 652c 2027  asattr(module, '
-00025e70: 5f6e 6f6e 5f70 6572 7369 7374 656e 745f  _non_persistent_
-00025e80: 6275 6666 6572 735f 7365 7427 293a 0d0a  buffers_set'):..
-00025e90: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-00025ea0: 6c65 2e5f 6e6f 6e5f 7065 7273 6973 7465  le._non_persiste
-00025eb0: 6e74 5f62 7566 6665 7273 5f73 6574 203d  nt_buffers_set =
-00025ec0: 2073 6574 2829 0d0a 0d0a 2020 2020 2020   set()....      
-00025ed0: 2020 2320 6669 7820 666f 7220 7368 6170    # fix for shap
-00025ee0: 6520 6465 6669 6e69 7469 6f6e 0d0a 2020  e definition..  
-00025ef0: 2020 2020 2020 2320 6966 206e 6f74 2069        # if not i
-00025f00: 7369 6e73 7461 6e63 6528 6d6f 6475 6c65  sinstance(module
-00025f10: 2e5f 696e 7075 745f 7368 6170 652c 2054  ._input_shape, T
-00025f20: 656e 736f 7253 6861 7065 293a 0d0a 2020  ensorShape):..  
-00025f30: 2020 2020 2020 2320 2020 2020 6d6f 6475        #     modu
-00025f40: 6c65 2e5f 696e 7075 745f 7368 6170 6520  le._input_shape 
-00025f50: 3d20 5465 6e73 6f72 5368 6170 6528 746f  = TensorShape(to
-00025f60: 5f6e 756d 7079 286d 6f64 756c 652e 5f69  _numpy(module._i
-00025f70: 6e70 7574 5f73 6861 7065 2929 0d0a 2020  nput_shape))..  
-00025f80: 2020 2020 2020 230d 0a20 2020 2020 2020        #..       
-00025f90: 2023 2069 6620 6e6f 7420 6973 696e 7374   # if not isinst
-00025fa0: 616e 6365 286d 6f64 756c 652e 5f6f 7574  ance(module._out
-00025fb0: 7075 745f 7368 6170 652c 2054 656e 736f  put_shape, Tenso
-00025fc0: 7253 6861 7065 293a 0d0a 2020 2020 2020  rShape):..      
-00025fd0: 2020 2320 2020 2020 6d6f 6475 6c65 2e5f    #     module._
-00025fe0: 6f75 7470 7574 5f73 6861 7065 203d 2054  output_shape = T
-00025ff0: 656e 736f 7253 6861 7065 2874 6f5f 6e75  ensorShape(to_nu
-00026000: 6d70 7928 6d6f 6475 6c65 2e5f 6f75 7470  mpy(module._outp
-00026010: 7574 5f73 6861 7065 2929 0d0a 0d0a 2020  ut_shape))....  
-00026020: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-00026030: 6174 7472 286d 6f64 756c 652c 2027 6261  attr(module, 'ba
-00026040: 7463 685f 696e 6465 7827 293a 0d0a 2020  tch_index'):..  
-00026050: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-00026060: 7228 6d6f 6475 6c65 2c20 2762 6174 6368  r(module, 'batch
-00026070: 5f69 6e64 6578 272c 2030 290d 0a20 2020  _index', 0)..   
-00026080: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
-00026090: 7474 7228 6d6f 6475 6c65 2c20 2766 696c  ttr(module, 'fil
-000260a0: 7465 725f 696e 6465 7827 293a 0d0a 2020  ter_index'):..  
-000260b0: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-000260c0: 7228 6d6f 6475 6c65 2c20 2766 696c 7465  r(module, 'filte
-000260d0: 725f 696e 6465 7827 2c20 3129 0d0a 2020  r_index', 1)..  
-000260e0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-000260f0: 6174 7472 286d 6f64 756c 652c 2027 696e  attr(module, 'in
-00026100: 5f73 6571 7565 6e63 6527 293a 0d0a 2020  _sequence'):..  
-00026110: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-00026120: 7228 6d6f 6475 6c65 2c20 2769 6e5f 7365  r(module, 'in_se
-00026130: 7175 656e 6365 272c 2046 616c 7365 290d  quence', False).
-00026140: 0a0d 0a20 2020 2020 2020 2069 6620 6e6f  ...        if no
-00026150: 7420 6861 7361 7474 7228 6d6f 6475 6c65  t hasattr(module
-00026160: 2c20 2769 6e5f 7365 7175 656e 6365 2729  , 'in_sequence')
-00026170: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00026180: 6620 276c 7374 6d27 2069 6e20 636c 6173  f 'lstm' in clas
-00026190: 735f 6e61 6d65 2e6c 6f77 6572 2829 206f  s_name.lower() o
-000261a0: 7220 2767 7275 2720 696e 2063 6c61 7373  r 'gru' in class
-000261b0: 5f6e 616d 652e 6c6f 7765 7228 2920 6f72  _name.lower() or
-000261c0: 2027 726e 6e27 2069 6e20 636c 6173 735f   'rnn' in class_
-000261d0: 6e61 6d65 2e6c 6f77 6572 2829 3a0d 0a20  name.lower():.. 
-000261e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000261f0: 6f64 756c 652e 696e 5f73 6571 7565 6e63  odule.in_sequenc
-00026200: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
-00026210: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00026220: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00026230: 756c 652e 696e 5f73 6571 7565 6e63 6520  ule.in_sequence 
-00026240: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
-00026250: 2020 2069 6620 2743 6f6e 7627 2069 6e20     if 'Conv' in 
-00026260: 636c 6173 735f 6e61 6d65 2061 6e64 2027  class_name and '
-00026270: 426c 6f63 6b27 2069 6e20 636c 6173 735f  Block' in class_
-00026280: 6e61 6d65 3a0d 0a20 2020 2020 2020 2020  name:..         
-00026290: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-000262a0: 7228 6d6f 6475 6c65 2c20 2773 6571 7565  r(module, 'seque
-000262b0: 6e63 655f 7261 6e6b 2729 3a0d 0a20 2020  nce_rank'):..   
-000262c0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-000262d0: 756c 652e 7365 7175 656e 6365 5f72 616e  ule.sequence_ran
-000262e0: 6b20 3d20 2763 6e61 270d 0a0d 0a20 2020  k = 'cna'....   
-000262f0: 2020 2020 2069 6620 2743 6f6e 7627 2069       if 'Conv' i
-00026300: 6e20 636c 6173 735f 6e61 6d65 3a0d 0a20  n class_name:.. 
-00026310: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00026320: 7420 6861 7361 7474 7228 6d6f 6475 6c65  t hasattr(module
-00026330: 2c20 2764 6570 7468 5f6d 756c 7469 706c  , 'depth_multipl
-00026340: 6965 7227 293a 0d0a 2020 2020 2020 2020  ier'):..        
-00026350: 2020 2020 2020 2020 6966 2027 4465 7074          if 'Dept
-00026360: 6877 6973 6527 2069 6e20 636c 6173 735f  hwise' in class_
-00026370: 6e61 6d65 206f 7220 2753 6570 6172 6162  name or 'Separab
-00026380: 6c65 2720 696e 2063 6c61 7373 5f6e 616d  le' in class_nam
-00026390: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000263a0: 2020 2020 2020 2020 6d6f 6475 6c65 2e64          module.d
-000263b0: 6570 7468 5f6d 756c 7469 706c 6965 7220  epth_multiplier 
-000263c0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-000263d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000263e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263f0: 6d6f 6475 6c65 2e64 6570 7468 5f6d 756c  module.depth_mul
-00026400: 7469 706c 6965 7220 3d20 4e6f 6e65 0d0a  tiplier = None..
-00026410: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00026420: 6f74 2068 6173 6174 7472 286d 6f64 756c  ot hasattr(modul
-00026430: 652c 2027 7573 655f 7370 6563 7472 616c  e, 'use_spectral
-00026440: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00026450: 2020 2020 206d 6f64 756c 652e 7573 655f       module.use_
-00026460: 7370 6563 7472 616c 203d 2046 616c 7365  spectral = False
-00026470: 0d0a 0d0a 2020 2020 6966 206c 6179 6572  ....    if layer
-00026480: 2e69 735f 726f 6f74 203d 3d20 5472 7565  .is_root == True
-00026490: 2061 6e64 2028 0d0a 2020 2020 2020 2020   and (..        
-000264a0: 2020 2020 6e6f 7420 6861 7361 7474 7228      not hasattr(
-000264b0: 6c61 7965 722c 2027 5f73 6967 6e61 7475  layer, '_signatu
-000264c0: 7265 2729 206f 7220 6c61 7965 722e 5f73  re') or layer._s
-000264d0: 6967 6e61 7475 7265 2069 7320 4e6f 6e65  ignature is None
-000264e0: 206f 7220 6c65 6e28 6c61 7965 722e 5f73   or len(layer._s
-000264f0: 6967 6e61 7475 7265 2e69 6e70 7574 7329  ignature.inputs)
-00026500: 203d 3d20 3029 3a0d 0a20 2020 2020 2020   == 0):..       
-00026510: 206c 6179 6572 2e5f 7369 676e 6174 7572   layer._signatur
-00026520: 6520 3d20 6765 745f 7369 676e 6174 7572  e = get_signatur
-00026530: 6528 6c61 7965 7229 0d0a 2020 2020 7265  e(layer)..    re
-00026540: 7475 726e 206c 6179 6572 0d0a 0d0a 0d0a  turn layer......
-00026550: 6465 6620 6669 785f 7079 746f 7263 685f  def fix_pytorch_
-00026560: 6d6f 6475 6c65 286d 6f64 756c 653a 206e  module(module: n
-00026570: 6e2e 4d6f 6475 6c65 2c20 696e 7075 745f  n.Module, input_
-00026580: 7465 6e73 6f72 3a20 5465 6e73 6f72 203d  tensor: Tensor =
-00026590: 204e 6f6e 652c 2069 6e70 7574 5f73 6861   None, input_sha
-000265a0: 7065 3a20 2874 7570 6c65 2c20 5465 6e73  pe: (tuple, Tens
-000265b0: 6f72 5368 6170 6529 203d 204e 6f6e 6529  orShape) = None)
-000265c0: 3a0d 0a20 2020 206d 6f64 756c 652e 6973  :..    module.is
-000265d0: 5f72 6f6f 7420 3d20 5472 7565 0d0a 2020  _root = True..  
-000265e0: 2020 6d6f 6475 6c65 2e6e 616d 6520 3d20    module.name = 
-000265f0: 6d6f 6475 6c65 2e5f 5f63 6c61 7373 5f5f  module.__class__
-00026600: 2e5f 5f6e 616d 655f 5f0d 0a20 2020 206d  .__name__..    m
-00026610: 6f64 756c 652e 5f6e 6f64 6573 203d 204f  odule._nodes = O
-00026620: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
-00026630: 2020 6d6f 6475 6c65 2e5f 7569 645f 7072    module._uid_pr
-00026640: 6566 6978 7320 3d20 6465 6661 756c 7464  efixs = defaultd
-00026650: 6963 7428 696e 7429 0d0a 2020 2020 6d6f  ict(int)..    mo
-00026660: 6475 6c65 2e5f 7369 676e 6174 7572 6520  dule._signature 
-00026670: 3d20 6765 745f 7369 676e 6174 7572 6528  = get_signature(
-00026680: 6d6f 6475 6c65 290d 0a20 2020 206d 6f64  module)..    mod
-00026690: 756c 652e 7369 676e 6174 7572 6520 3d20  ule.signature = 
-000266a0: 6765 745f 7369 676e 6174 7572 6528 6d6f  get_signature(mo
-000266b0: 6475 6c65 290d 0a0d 0a20 2020 2064 6566  dule)....    def
-000266c0: 2067 6574 7765 6967 6874 7328 6d6f 6475   getweights(modu
-000266d0: 6c65 293a 0d0a 2020 2020 2020 2020 7265  le):..        re
-000266e0: 7475 726e 206c 6973 7428 6d6f 6475 6c65  turn list(module
-000266f0: 2e70 6172 616d 6574 6572 7328 2929 0d0a  .parameters())..
-00026700: 0d0a 2020 2020 6465 6620 6765 745f 7569  ..    def get_ui
-00026710: 6428 7072 6566 6978 3d27 2729 3a0d 0a20  d(prefix=''):.. 
-00026720: 2020 2020 2020 206d 6f64 756c 652e 5f75         module._u
-00026730: 6964 5f70 7265 6669 7873 5b70 7265 6669  id_prefixs[prefi
-00026740: 785d 202b 3d20 310d 0a20 2020 2020 2020  x] += 1..       
-00026750: 2072 6574 7572 6e20 6d6f 6475 6c65 2e5f   return module._
-00026760: 7569 645f 7072 6566 6978 735b 7072 6566  uid_prefixs[pref
-00026770: 6978 5d0d 0a0d 0a20 2020 2064 6566 2067  ix]....    def g
-00026780: 6574 5f72 6f6f 7428 6d6f 6475 6c65 293a  et_root(module):
-00026790: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-000267a0: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
-000267b0: 2027 5f6e 6f64 6573 2729 206f 7220 6d6f   '_nodes') or mo
-000267c0: 6475 6c65 2e5f 6e6f 6465 7320 6973 204e  dule._nodes is N
-000267d0: 6f6e 6520 6f72 206c 656e 286d 6f64 756c  one or len(modul
-000267e0: 652e 5f6e 6f64 6573 2920 3c20 323a 0d0a  e._nodes) < 2:..
-000267f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00026800: 726e 206d 6f64 756c 650d 0a20 2020 2020  rn module..     
-00026810: 2020 2069 6620 6861 7361 7474 7228 6c69     if hasattr(li
-00026820: 7374 286d 6f64 756c 652e 5f6e 6f64 6573  st(module._nodes
-00026830: 2e76 616c 7565 7328 2929 5b30 5d2c 2027  .values())[0], '
-00026840: 6973 5f72 6f6f 7427 2920 616e 6420 6c69  is_root') and li
-00026850: 7374 286d 6f64 756c 652e 5f6e 6f64 6573  st(module._nodes
-00026860: 2e76 616c 7565 7328 2929 5b30 5d2e 6973  .values())[0].is
-00026870: 5f72 6f6f 7420 3d3d 2054 7275 653a 0d0a  _root == True:..
-00026880: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00026890: 726e 206c 6973 7428 6d6f 6475 6c65 2e5f  rn list(module._
-000268a0: 6e6f 6465 732e 7661 6c75 6573 2829 295b  nodes.values())[
-000268b0: 305d 0d0a 2020 2020 2020 2020 656c 7365  0]..        else
-000268c0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-000268d0: 6f72 206e 616d 652c 206e 6f64 6520 696e  or name, node in
-000268e0: 206d 6f64 756c 652e 5f6e 6f64 6573 2e69   module._nodes.i
-000268f0: 7465 6d73 2829 3a0d 0a20 2020 2020 2020  tems():..       
-00026900: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-00026910: 7474 7228 6e6f 6465 2c20 2764 6566 6175  ttr(node, 'defau
-00026920: 6c74 5f6e 616d 6527 2920 616e 6420 6e6f  lt_name') and no
-00026930: 6465 2e64 6566 6175 6c74 5f6e 616d 6520  de.default_name 
-00026940: 3d3d 2022 7365 7175 656e 7469 616c 5f31  == "sequential_1
-00026950: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00026960: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00026970: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
-00026980: 2072 6574 7572 6e20 6d6f 6475 6c65 0d0a   return module..
-00026990: 0d0a 2020 2020 666f 7220 6e61 6d65 2c20  ..    for name, 
-000269a0: 6d6f 6420 696e 206d 6f64 756c 652e 6e61  mod in module.na
-000269b0: 6d65 645f 6d6f 6475 6c65 7328 293a 0d0a  med_modules():..
-000269c0: 2020 2020 2020 2020 6966 206d 6f64 2021          if mod !
-000269d0: 3d20 6d6f 6475 6c65 3a0d 0a20 2020 2020  = module:..     
-000269e0: 2020 2020 2020 206d 6f64 756c 652e 6973         module.is
-000269f0: 5f72 6f6f 7420 3d20 4661 6c73 650d 0a20  _root = False.. 
-00026a00: 2020 2020 2020 206d 6f64 2e5f 6275 696c         mod._buil
-00026a10: 7420 3d20 5472 7565 0d0a 2020 2020 2020  t = True..      
-00026a20: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
-00026a30: 286d 6f64 2c20 2762 7569 6c74 2729 3a0d  (mod, 'built'):.
-00026a40: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00026a50: 2e62 7569 6c74 203d 2054 7275 650d 0a20  .built = True.. 
-00026a60: 2020 2020 2020 206d 6f64 2e72 656c 6174         mod.relat
-00026a70: 6976 655f 6e61 6d65 203d 206e 616d 650d  ive_name = name.
-00026a80: 0a20 2020 2020 2020 206d 6f64 2e62 6174  .        mod.bat
-00026a90: 6368 5f69 6e64 6578 203d 2030 0d0a 2020  ch_index = 0..  
-00026aa0: 2020 2020 2020 6d6f 642e 6669 6c74 6572        mod.filter
-00026ab0: 5f69 6e64 6578 203d 2031 0d0a 0d0a 2020  _index = 1....  
-00026ac0: 2020 2020 2020 6d6f 642e 696e 5f73 6571        mod.in_seq
-00026ad0: 7565 6e63 6520 3d20 4661 6c73 650d 0a20  uence = False.. 
-00026ae0: 2020 2020 2020 206d 6f64 2e75 7569 6420         mod.uuid 
-00026af0: 3d20 7575 6964 2e75 7569 6434 2829 2e6e  = uuid.uuid4().n
-00026b00: 6f64 650d 0a20 2020 2020 2020 2070 7265  ode..        pre
-00026b10: 6669 7820 3d20 6d6f 642e 5f5f 636c 6173  fix = mod.__clas
-00026b20: 735f 5f2e 5f5f 6e61 6d65 5f5f 0d0a 2020  s__.__name__..  
-00026b30: 2020 2020 2020 6d6f 642e 6465 6661 756c        mod.defaul
-00026b40: 745f 6e61 6d65 203d 2063 616d 656c 3273  t_name = camel2s
-00026b50: 6e61 6b65 2870 7265 6669 7829 202b 2027  nake(prefix) + '
-00026b60: 5f27 202b 2073 7472 2867 6574 5f75 6964  _' + str(get_uid
-00026b70: 2863 616d 656c 3273 6e61 6b65 2870 7265  (camel2snake(pre
-00026b80: 6669 7829 2929 0d0a 0d0a 2020 2020 2020  fix)))....      
-00026b90: 2020 6d6f 642e 5f69 6e70 7574 5f73 6861    mod._input_sha
-00026ba0: 7065 203d 204e 6f6e 650d 0a20 2020 2020  pe = None..     
-00026bb0: 2020 206d 6f64 2e5f 6f75 7470 7574 5f73     mod._output_s
-00026bc0: 6861 7065 203d 204e 6f6e 650d 0a20 2020  hape = None..   
-00026bd0: 2020 2020 206d 6f64 2e6b 6565 705f 6f75       mod.keep_ou
-00026be0: 7470 7574 203d 2046 616c 7365 0d0a 2020  tput = False..  
-00026bf0: 2020 2020 2020 6d6f 642e 7265 6769 7374        mod.regist
-00026c00: 6572 5f62 7566 6665 7228 275f 6f75 7470  er_buffer('_outp
-00026c10: 7574 5f74 656e 736f 7227 2c20 4e6f 6e65  ut_tensor', None
-00026c20: 2c20 7065 7273 6973 7465 6e74 3d46 616c  , persistent=Fal
-00026c30: 7365 290d 0a0d 0a20 2020 2020 2020 206d  se)....        m
-00026c40: 6f64 2e5f 6465 7669 6365 203d 2067 6574  od._device = get
-00026c50: 5f64 6576 6963 6528 290d 0a20 2020 2020  _device()..     
-00026c60: 2020 2023 206d 6f64 2e5f 7369 676e 6174     # mod._signat
-00026c70: 7572 6520 3d20 696e 7370 6563 742e 7369  ure = inspect.si
-00026c80: 676e 6174 7572 6528 6d6f 642e 666f 7277  gnature(mod.forw
-00026c90: 6172 6429 0d0a 2020 2020 2020 2020 6d6f  ard)..        mo
-00026ca0: 642e 6475 6d70 5f70 6174 6368 6573 203d  d.dump_patches =
-00026cb0: 2054 7275 650d 0a20 2020 2020 2020 2023   True..        #
-00026cc0: 0d0a 2020 2020 2020 2020 2320 6465 6620  ..        # def 
-00026cd0: 6765 7473 6967 6e61 7475 7265 286d 6f64  getsignature(mod
-00026ce0: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
-00026cf0: 2020 7265 7475 726e 206d 6f64 2e5f 7369    return mod._si
-00026d00: 676e 6174 7572 650d 0a20 2020 2020 2020  gnature..       
-00026d10: 2023 0d0a 2020 2020 2020 2020 2320 6465   #..        # de
-00026d20: 6620 7365 7473 6967 6e61 7475 7265 286d  f setsignature(m
-00026d30: 6f64 2c20 7661 6c75 6529 3a0d 0a20 2020  od, value):..   
-00026d40: 2020 2020 2023 2020 2020 206d 6f64 2e5f       #     mod._
-00026d50: 7369 676e 6174 7572 6520 3d20 7661 6c75  signature = valu
-00026d60: 650d 0a20 2020 2020 2020 2023 0d0a 2020  e..        #..  
-00026d70: 2020 2020 2020 2320 6465 6620 6465 6c73        # def dels
-00026d80: 6967 6e61 7475 7265 286d 6f64 293a 0d0a  ignature(mod):..
-00026d90: 2020 2020 2020 2020 2320 2020 2020 6465          #     de
-00026da0: 6c20 6d6f 642e 5f73 6967 6e61 7475 7265  l mod._signature
-00026db0: 0d0a 2020 2020 2020 2020 230d 0a20 2020  ..        #..   
-00026dc0: 2020 2020 2023 206d 6f64 2e73 6967 6e61       # mod.signa
-00026dd0: 7475 7265 3d20 7072 6f70 6572 7479 2867  ture= property(g
-00026de0: 6574 7369 676e 6174 7572 652c 2073 6574  etsignature, set
-00026df0: 7369 676e 6174 7572 652c 2064 656c 7369  signature, delsi
-00026e00: 676e 6174 7572 652c 2022 7369 676e 6174  gnature, "signat
-00026e10: 7572 6522 290d 0a0d 0a20 2020 2020 2020  ure")....       
-00026e20: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00026e30: 6d6f 642c 2027 6765 745f 726f 6f74 2729  mod, 'get_root')
-00026e40: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00026e50: 6574 6174 7472 286d 6f64 2c20 2767 6574  etattr(mod, 'get
-00026e60: 5f72 6f6f 7427 2c20 4d65 7468 6f64 5479  _root', MethodTy
-00026e70: 7065 2867 6574 5f72 6f6f 742c 206d 6f64  pe(get_root, mod
-00026e80: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
-00026e90: 206e 6f74 2068 6173 6174 7472 286d 6f64   not hasattr(mod
-00026ea0: 2c20 2777 6569 6768 7473 2729 3a0d 0a20  , 'weights'):.. 
-00026eb0: 2020 2020 2020 2020 2020 2063 6c73 203d             cls =
-00026ec0: 2074 7970 6528 6d6f 6429 0d0a 2020 2020   type(mod)..    
-00026ed0: 2020 2020 2020 2020 636c 732e 7765 6967          cls.weig
-00026ee0: 6874 7320 3d20 7072 6f70 6572 7479 286c  hts = property(l
-00026ef0: 616d 6264 6120 7365 6c66 3a20 6c69 7374  ambda self: list
-00026f00: 2873 656c 662e 7061 7261 6d65 7465 7273  (self.parameters
-00026f10: 2829 2929 0d0a 2020 2020 2020 2020 6966  ()))..        if
-00026f20: 2068 6173 6174 7472 286d 6f64 2c20 2764   hasattr(mod, 'd
-00026f30: 696d 7327 293a 0d0a 2020 2020 2020 2020  ims'):..        
-00026f40: 2020 2020 6d6f 642e 6178 6973 203d 206d      mod.axis = m
-00026f50: 6f64 2e64 696d 730d 0a20 2020 2020 2020  od.dims..       
-00026f60: 2069 6620 6861 7361 7474 7228 6d6f 6475   if hasattr(modu
-00026f70: 6c65 2c20 276b 6565 7064 696d 2729 3a0d  le, 'keepdim'):.
-00026f80: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00026f90: 7565 203d 2067 6574 6174 7472 286d 6f64  ue = getattr(mod
-00026fa0: 756c 652c 2027 6b65 6570 6469 6d27 290d  ule, 'keepdim').
-00026fb0: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
-00026fc0: 6174 7472 286d 6f64 756c 652c 2027 6b65  attr(module, 'ke
-00026fd0: 6570 6469 6d73 272c 2076 616c 7565 290d  epdims', value).
-00026fe0: 0a0d 0a20 2020 2023 2064 6566 2072 6567  ...    # def reg
-00026ff0: 6973 7465 725f 686f 6f6b 286d 6f64 756c  ister_hook(modul
-00027000: 6529 3a0d 0a20 2020 2023 2020 2020 2064  e):..    #     d
-00027010: 6566 2068 6f6f 6b28 6d6f 6475 6c65 2c20  ef hook(module, 
-00027020: 696e 7075 742c 206f 7574 7075 7429 3a0d  input, output):.
-00027030: 0a20 2020 2023 2020 2020 2020 2020 2023  .    #         #
-00027040: 2063 6c61 7373 5f6e 616d 6520 3d6d 6f64   class_name =mod
-00027050: 756c 652e 7265 2020 2020 6d6f 6475 6c65  ule.re    module
-00027060: 2e6e 616d 6520 2020 2320 7374 7228 6d6f  .name   # str(mo
-00027070: 6475 6c65 2e5f 5f63 6c61 7373 5f5f 292e  dule.__class__).
-00027080: 7370 6c69 7428 222e 2229 5b2d 315d 2e73  split(".")[-1].s
-00027090: 706c 6974 2822 2722 295b 305d 0d0a 2020  plit("'")[0]..  
-000270a0: 2020 2320 2020 2020 2020 2020 696e 7075    #         inpu
-000270b0: 7420 3d20 6974 6572 6174 696f 6e5f 746f  t = iteration_to
-000270c0: 6f6c 732e 666c 6174 7465 6e28 5b69 6e70  ols.flatten([inp
-000270d0: 7574 5d2c 2069 7465 7261 626c 655f 7479  ut], iterable_ty
-000270e0: 7065 733d 286c 6973 742c 2074 7570 6c65  pes=(list, tuple
-000270f0: 2929 0d0a 2020 2020 2320 2020 2020 2020  ))..    #       
-00027100: 2020 696e 7075 7420 3d20 756e 7061 636b    input = unpack
-00027110: 5f73 696e 676c 6574 6f6e 285b 6974 656d  _singleton([item
-00027120: 2066 6f72 2069 7465 6d20 696e 2069 6e70   for item in inp
-00027130: 7574 2069 6620 6974 656d 2069 7320 6e6f  ut if item is no
-00027140: 7420 4e6f 6e65 5d29 0d0a 2020 2020 230d  t None])..    #.
-00027150: 0a20 2020 2023 2020 2020 2020 2020 2069  .    #         i
-00027160: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
-00027170: 7574 2c20 286c 6973 742c 2074 7570 6c65  ut, (list, tuple
-00027180: 2929 3a0d 0a20 2020 2023 2020 2020 2020  )):..    #      
-00027190: 2020 2020 2020 206d 6f64 756c 652e 5f69         module._i
-000271a0: 6e70 7574 5f73 6861 7065 203d 2074 7570  nput_shape = tup
-000271b0: 6c65 285b 7465 6e73 6f72 5f74 6f5f 7368  le([tensor_to_sh
-000271c0: 6170 6528 742c 206e 6565 645f 6578 636c  ape(t, need_excl
-000271d0: 7564 655f 6261 7463 685f 6178 6973 3d54  ude_batch_axis=T
-000271e0: 7275 652c 2069 735f 7369 6e67 6c65 746f  rue, is_singleto
-000271f0: 6e3d 4661 6c73 6529 2066 6f72 2074 2069  n=False) for t i
-00027200: 6e20 696e 7075 745d 290d 0a20 2020 2023  n input])..    #
-00027210: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00027220: 756c 652e 696e 7075 745f 7368 6170 6520  ule.input_shape 
-00027230: 3d20 6d6f 6475 6c65 2e5f 696e 7075 745f  = module._input_
-00027240: 7368 6170 650d 0a20 2020 2023 2020 2020  shape..    #    
-00027250: 2020 2020 2065 6c69 6620 6973 5f74 656e       elif is_ten
-00027260: 736f 7228 696e 7075 7429 3a0d 0a20 2020  sor(input):..   
-00027270: 2023 2020 2020 2020 2020 2020 2020 206d   #             m
-00027280: 6f64 756c 652e 5f69 6e70 7574 5f73 6861  odule._input_sha
-00027290: 7065 203d 2074 656e 736f 725f 746f 5f73  pe = tensor_to_s
-000272a0: 6861 7065 2869 6e70 7574 2c20 6e65 6564  hape(input, need
-000272b0: 5f65 7863 6c75 6465 5f62 6174 6368 5f61  _exclude_batch_a
-000272c0: 7869 733d 5472 7565 2c20 6973 5f73 696e  xis=True, is_sin
-000272d0: 676c 6574 6f6e 3d46 616c 7365 290d 0a20  gleton=False).. 
-000272e0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000272f0: 206d 6f64 756c 652e 696e 7075 745f 7368   module.input_sh
-00027300: 6170 6520 3d20 6d6f 6475 6c65 2e5f 696e  ape = module._in
-00027310: 7075 745f 7368 6170 650d 0a20 2020 2023  put_shape..    #
-00027320: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-00027330: 6f75 7470 7574 203d 2069 7465 7261 7469  output = iterati
-00027340: 6f6e 5f74 6f6f 6c73 2e66 6c61 7474 656e  on_tools.flatten
-00027350: 285b 6f75 7470 7574 5d2c 2069 7465 7261  ([output], itera
-00027360: 626c 655f 7479 7065 733d 286c 6973 742c  ble_types=(list,
-00027370: 2074 7570 6c65 2929 0d0a 2020 2020 2320   tuple))..    # 
-00027380: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-00027390: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
-000273a0: 6e28 5b69 7465 6d20 666f 7220 6974 656d  n([item for item
-000273b0: 2069 6e20 6f75 7470 7574 2069 6620 6974   in output if it
-000273c0: 656d 2069 7320 6e6f 7420 4e6f 6e65 5d29  em is not None])
-000273d0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-000273e0: 6966 2069 7369 6e73 7461 6e63 6528 6f75  if isinstance(ou
-000273f0: 7470 7574 2c20 286c 6973 742c 2074 7570  tput, (list, tup
-00027400: 6c65 2929 3a0d 0a20 2020 2023 2020 2020  le)):..    #    
-00027410: 2020 2020 2020 2020 206d 6f64 756c 652e           module.
-00027420: 5f6f 7574 7075 745f 7368 6170 6520 3d20  _output_shape = 
-00027430: 7475 706c 6528 5b74 656e 736f 725f 746f  tuple([tensor_to
-00027440: 5f73 6861 7065 2874 2c20 6e65 6564 5f65  _shape(t, need_e
-00027450: 7863 6c75 6465 5f62 6174 6368 5f61 7869  xclude_batch_axi
-00027460: 733d 5472 7565 2c20 6973 5f73 696e 676c  s=True, is_singl
-00027470: 6574 6f6e 3d46 616c 7365 2920 666f 7220  eton=False) for 
-00027480: 7420 696e 206f 7574 7075 745d 290d 0a20  t in output]).. 
-00027490: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000274a0: 206d 6f64 756c 652e 6f75 7470 7574 5f73   module.output_s
-000274b0: 6861 7065 203d 206d 6f64 756c 652e 5f6f  hape = module._o
-000274c0: 7574 7075 745f 7368 6170 650d 0a20 2020  utput_shape..   
-000274d0: 2023 2020 2020 2020 2020 2065 6c69 6620   #         elif 
-000274e0: 6973 5f74 656e 736f 7228 6f75 7470 7574  is_tensor(output
-000274f0: 293a 0d0a 2020 2020 2320 2020 2020 2020  ):..    #       
-00027500: 2020 2020 2020 6d6f 6475 6c65 2e5f 6f75        module._ou
-00027510: 7470 7574 5f73 6861 7065 203d 2074 656e  tput_shape = ten
-00027520: 736f 725f 746f 5f73 6861 7065 286f 7574  sor_to_shape(out
-00027530: 7075 742c 206e 6565 645f 6578 636c 7564  put, need_exclud
-00027540: 655f 6261 7463 685f 6178 6973 3d54 7275  e_batch_axis=Tru
-00027550: 652c 2069 735f 7369 6e67 6c65 746f 6e3d  e, is_singleton=
-00027560: 4661 6c73 6529 0d0a 2020 2020 2320 2020  False)..    #   
-00027570: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-00027580: 2e6f 7574 7075 745f 7368 6170 6520 3d20  .output_shape = 
-00027590: 6d6f 6475 6c65 2e5f 6f75 7470 7574 5f73  module._output_s
-000275a0: 6861 7065 0d0a 2020 2020 230d 0a20 2020  hape..    #..   
-000275b0: 2023 2020 2020 2020 2020 2068 6f6f 6b73   #         hooks
-000275c0: 2e61 7070 656e 6428 6d6f 6475 6c65 2e72  .append(module.r
-000275d0: 6567 6973 7465 725f 666f 7277 6172 645f  egister_forward_
-000275e0: 686f 6f6b 2868 6f6f 6b29 290d 0a20 2020  hook(hook))..   
-000275f0: 2023 0d0a 2020 2020 2320 686f 6f6b 7320   #..    # hooks 
-00027600: 3d20 5b5d 0d0a 2020 2020 230d 0a20 2020  = []..    #..   
-00027610: 2023 2023 2072 6567 6973 7465 7220 686f   # # register ho
-00027620: 6f6b 0d0a 2020 2020 2320 6d6f 6475 6c65  ok..    # module
-00027630: 2e61 7070 6c79 2872 6567 6973 7465 725f  .apply(register_
-00027640: 686f 6f6b 290d 0a20 2020 2023 0d0a 2020  hook)..    #..  
-00027650: 2020 2320 6966 206d 6f64 756c 652e 7369    # if module.si
-00027660: 676e 6174 7572 6520 6973 206e 6f74 204e  gnature is not N
-00027670: 6f6e 653a 0d0a 2020 2020 2320 2020 2020  one:..    #     
-00027680: 696e 7075 745f 7465 6e73 6f72 203d 205b  input_tensor = [
-00027690: 746f 5f74 656e 736f 7228 6d6f 6475 6c65  to_tensor(module
-000276a0: 2e73 6967 6e61 7475 7265 2e69 6e70 7574  .signature.input
-000276b0: 732e 7661 6c75 655f 6c69 7374 5b6b 5d2e  s.value_list[k].
-000276c0: 6765 745f 6475 6d6d 795f 7465 6e73 6f72  get_dummy_tensor
-000276d0: 2829 2920 666f 7220 6b20 696e 2020 7261  ()) for k in  ra
-000276e0: 6e67 6528 6d6f 6475 6c65 2e73 6967 6e61  nge(module.signa
-000276f0: 7475 7265 2e69 6e70 7574 732e 7661 6c75  ture.inputs.valu
-00027700: 655f 6c69 7374 2920 6966 206e 6f74 206d  e_list) if not m
-00027710: 6f64 756c 652e 7369 676e 6174 7572 652e  odule.signature.
-00027720: 696e 7075 7473 2e76 616c 7565 5f6c 6973  inputs.value_lis
-00027730: 745b 6b5d 2e6f 7074 696f 6e61 6c20 6f72  t[k].optional or
-00027740: 206b 3d3d 305d 0d0a 2020 2020 2320 2020   k==0]..    #   
-00027750: 2020 2320 6d61 6b65 2061 2066 6f72 7761    # make a forwa
-00027760: 7264 2070 6173 730d 0a20 2020 2023 2020  rd pass..    #  
-00027770: 2020 2023 2070 7269 6e74 2878 2e73 6861     # print(x.sha
-00027780: 7065 290d 0a20 2020 2023 2020 2020 206d  pe)..    #     m
-00027790: 6f64 756c 6528 2a69 6e70 7574 5f74 656e  odule(*input_ten
-000277a0: 736f 7229 0d0a 2020 2020 230d 0a20 2020  sor)..    #..   
-000277b0: 2023 2023 2072 656d 6f76 6520 7468 6573   # # remove thes
-000277c0: 6520 686f 6f6b 730d 0a20 2020 2023 2066  e hooks..    # f
-000277d0: 6f72 2068 2069 6e20 686f 6f6b 733a 0d0a  or h in hooks:..
-000277e0: 2020 2020 2320 2020 2020 682e 7265 6d6f      #     h.remo
-000277f0: 7665 2829 0d0a 2020 2020 7265 7475 726e  ve()..    return
-00027800: 206d 6f64 756c 650d 0a                    module..
+00023d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023db0: 2020 2020 2020 2020 2020 2020 2054 656e               Ten
+00023dc0: 736f 7253 7065 6329 2065 6c73 6520 4e6f  sorSpec) else No
+00023dd0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00023de0: 2020 2020 2020 2020 6973 5f69 6e70 7574          is_input
+00023df0: 203d 2061 7267 2e6c 6f77 6572 2829 2069   = arg.lower() i
+00023e00: 6e20 5b27 7827 2c20 2769 6e70 7574 275d  n ['x', 'input']
+00023e10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023e20: 2020 2020 2020 6973 5f6f 7574 7075 7420        is_output 
+00023e30: 3d20 6172 672e 6c6f 7765 7228 2920 696e  = arg.lower() in
+00023e40: 205b 2779 272c 2027 6f75 7470 7574 272c   ['y', 'output',
+00023e50: 2027 795f 7072 6564 275d 0d0a 2020 2020   'y_pred']..    
+00023e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e70: 6966 2061 7267 2069 6e20 6461 7461 5f66  if arg in data_f
+00023e80: 6565 6420 616e 6420 6461 7461 5f66 6565  eed and data_fee
+00023e90: 645b 6172 675d 2069 6e20 6461 7461 3a0d  d[arg] in data:.
+00023ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023eb0: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
+00023ec0: 5b61 7267 5d20 3d20 746f 5f74 656e 736f  [arg] = to_tenso
+00023ed0: 7228 6461 7461 5b64 6174 615f 6665 6564  r(data[data_feed
+00023ee0: 5b61 7267 5d5d 2c20 6465 7669 6365 3d67  [arg]], device=g
+00023ef0: 6574 5f64 6576 6963 6528 2929 0d0a 2020  et_device())..  
+00023f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f10: 2020 656c 6966 2061 7267 2069 6e20 6461    elif arg in da
+00023f20: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
+00023f30: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+00023f40: 5f6d 6170 5b61 7267 5d20 3d20 746f 5f74  _map[arg] = to_t
+00023f50: 656e 736f 7228 6461 7461 5b61 7267 5d2c  ensor(data[arg],
+00023f60: 2064 6576 6963 653d 6765 745f 6465 7669   device=get_devi
+00023f70: 6365 2829 290d 0a20 2020 2020 2020 2020  ce())..         
+00023f80: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00023f90: 6973 5f69 6e70 7574 2061 6e64 2027 696e  is_input and 'in
+00023fa0: 7075 7427 2069 6e20 6461 7461 5f66 6565  put' in data_fee
+00023fb0: 6420 616e 6420 6461 7461 5f66 6565 645b  d and data_feed[
+00023fc0: 2769 6e70 7574 275d 2069 6e20 6461 7461  'input'] in data
+00023fd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00023fe0: 2020 2020 2020 2020 2020 2061 7267 5f6d             arg_m
+00023ff0: 6170 5b61 7267 5d20 3d20 746f 5f74 656e  ap[arg] = to_ten
+00024000: 736f 7228 6461 7461 5b64 6174 615f 6665  sor(data[data_fe
+00024010: 6564 5b27 696e 7075 7427 5d5d 2c20 6465  ed['input']], de
+00024020: 7669 6365 3d67 6574 5f64 6576 6963 6528  vice=get_device(
+00024030: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00024040: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+00024050: 6f75 7470 7574 2061 6e64 2027 6f75 7470  output and 'outp
+00024060: 7574 2720 696e 2064 6174 615f 6665 6564  ut' in data_feed
+00024070: 2061 6e64 2064 6174 615f 6665 6564 5b27   and data_feed['
+00024080: 6f75 7470 7574 275d 2069 6e20 6461 7461  output'] in data
+00024090: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000240a0: 2020 2020 2020 2020 2020 2061 7267 5f6d             arg_m
+000240b0: 6170 5b61 7267 5d20 3d20 746f 5f74 656e  ap[arg] = to_ten
+000240c0: 736f 7228 6461 7461 5b64 6174 615f 6665  sor(data[data_fe
+000240d0: 6564 5b27 6f75 7470 7574 275d 5d2c 2064  ed['output']], d
+000240e0: 6576 6963 653d 6765 745f 6465 7669 6365  evice=get_device
+000240f0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+00024100: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00024110: 5f6f 7074 696f 6e61 6c3a 0d0a 2020 2020  _optional:..    
+00024120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024130: 2020 2020 6172 675f 6d61 705b 6172 675d      arg_map[arg]
+00024140: 203d 2064 6566 6175 6c74 0d0a 2020 2020   = default..    
+00024150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024160: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00024170: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00024180: 7267 5f6d 6170 2e70 6f70 2861 7267 290d  rg_map.pop(arg).
+00024190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000241a0: 2023 2070 7269 6e74 2827 6172 675f 6d61   # print('arg_ma
+000241b0: 7027 2c20 6172 675f 6d61 702e 6b65 795f  p', arg_map.key_
+000241c0: 6c69 7374 290d 0a20 2020 2020 2020 2020  list)..         
+000241d0: 2020 2020 2020 2069 6620 6374 782e 616d         if ctx.am
+000241e0: 705f 6176 6169 6c61 626c 6520 3d3d 2054  p_available == T
+000241f0: 7275 6520 616e 6420 6973 5f61 7574 6f63  rue and is_autoc
+00024200: 6173 745f 656e 6162 6c65 6420 3d3d 2054  ast_enabled == T
+00024210: 7275 6520 616e 6420 6765 745f 6465 7669  rue and get_devi
+00024220: 6365 2829 203d 3d20 2763 7564 6127 3a0d  ce() == 'cuda':.
+00024230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024240: 2020 2020 2077 6974 6820 746f 7263 682e       with torch.
+00024250: 6375 6461 2e61 6d70 2e61 7574 6f63 6173  cuda.amp.autocas
+00024260: 7428 293a 0d0a 2020 2020 2020 2020 2020  t():..          
+00024270: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+00024280: 7420 3d20 666e 282a 6172 675f 6d61 702e  t = fn(*arg_map.
+00024290: 7661 6c75 655f 6c69 7374 290d 0a20 2020  value_list)..   
+000242a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000242b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000242c0: 2020 2020 2020 2020 6f75 7420 3d20 666e          out = fn
+000242d0: 282a 6172 675f 6d61 702e 7661 6c75 655f  (*arg_map.value_
+000242e0: 6c69 7374 290d 0a20 2020 2020 2020 2020  list)..         
+000242f0: 2020 2020 2020 2020 2020 2023 2066 6f72             # for
+00024300: 2069 7465 6d20 696e 2064 6174 612e 7661   item in data.va
+00024310: 6c75 655f 6c69 7374 3a0d 0a20 2020 2020  lue_list:..     
+00024320: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00024330: 2020 2020 2069 6620 6973 5f74 656e 736f       if is_tenso
+00024340: 7228 6974 656d 293a 0d0a 2020 2020 2020  r(item):..      
+00024350: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00024360: 2020 2020 2020 2020 6974 656d 2e63 7075          item.cpu
+00024370: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00024380: 2020 2020 7265 7475 726e 206f 7574 0d0a      return out..
+00024390: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000243a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000243b0: 2020 2070 7269 6e74 2827 756e 636f 6d70     print('uncomp
+000243c0: 6c65 7465 2061 7267 5f6d 6170 272c 2061  lete arg_map', a
+000243d0: 7267 5f6d 6170 2e6b 6579 5f6c 6973 7429  rg_map.key_list)
+000243e0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+000243f0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00024400: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00024410: 696e 7428 6529 0d0a 2020 2020 2020 2020  int(e)..        
+00024420: 2020 2020 5072 696e 7445 7863 6570 7469      PrintExcepti
+00024430: 6f6e 2829 0d0a 0d0a 0d0a 6465 6620 666f  on()......def fo
+00024440: 7263 655f 6465 7465 726d 696e 6973 7469  rce_deterministi
+00024450: 6328 7365 6564 293a 0d0a 2020 2020 2222  c(seed):..    ""
+00024460: 2220 466f 7263 6520 6d6f 7374 206f 6620  " Force most of 
+00024470: 7468 6520 636f 6d70 7574 6174 696f 6e20  the computation 
+00024480: 6e6f 6465 7320 746f 2072 756e 2064 6574  nodes to run det
+00024490: 6572 6d69 6e69 7374 6963 616c 6c79 2e0d  erministically..
+000244a0: 0a0d 0a20 2020 2041 7267 733a 0d0a 2020  ...    Args:..  
+000244b0: 2020 2020 2020 7365 6564 2028 696e 7429        seed (int)
+000244c0: 3a20 7365 7420 7468 6520 7261 6e64 6f6d  : set the random
+000244d0: 2073 6565 6420 666f 7220 616c 6c20 7261   seed for all ra
+000244e0: 6e64 6f6d 206f 7073 2069 6e20 7468 6520  ndom ops in the 
+000244f0: 6772 6170 6820 616e 6420 7265 6164 6572  graph and reader
+00024500: 732e 0d0a 0d0a 2020 2020 2222 220d 0a0d  s.....    """...
+00024510: 0a20 2020 2073 6574 5f73 6565 6428 7365  .    set_seed(se
+00024520: 6564 290d 0a20 2020 2074 6f72 6368 2e62  ed)..    torch.b
+00024530: 6163 6b65 6e64 732e 6375 646e 6e2e 6465  ackends.cudnn.de
+00024540: 7465 726d 696e 6973 7469 6320 3d20 5472  terministic = Tr
+00024550: 7565 0d0a 2020 2020 746f 7263 682e 6261  ue..    torch.ba
+00024560: 636b 656e 6473 2e63 7564 6e6e 2e62 656e  ckends.cudnn.ben
+00024570: 6368 6d61 726b 203d 2046 616c 7365 0d0a  chmark = False..
+00024580: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+00024590: 5059 5448 4f4e 4841 5348 5345 4544 275d  PYTHONHASHSEED']
+000245a0: 203d 2073 7472 2873 6565 6429 0d0a 0d0a   = str(seed)....
+000245b0: 0d0a 6465 6620 6669 785f 6c61 7965 7228  ..def fix_layer(
+000245c0: 6c61 7965 723a 204c 6179 6572 293a 0d0a  layer: Layer):..
+000245d0: 2020 2020 2222 2266 6978 2065 7869 7374      """fix exist
+000245e0: 696e 6720 6f75 742d 6f66 2d64 6174 6520  ing out-of-date 
+000245f0: 6d6f 6465 6c20 636f 6d70 6174 6962 696c  model compatibil
+00024600: 6974 790d 0a0d 0a20 2020 2041 7267 733a  ity....    Args:
+00024610: 0d0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
+00024620: 2874 7269 6465 6e74 204c 6179 6572 293a  (trident Layer):
+00024630: 0d0a 0d0a 2020 2020 5265 7475 726e 733a  ....    Returns:
+00024640: 2066 6978 6564 206c 6179 6572 0d0a 0d0a   fixed layer....
+00024650: 2020 2020 2222 220d 0a20 2020 2069 6620      """..    if 
+00024660: 6e6f 7420 6861 7361 7474 7228 6c61 7965  not hasattr(laye
+00024670: 722c 2027 6973 5f72 6f6f 7427 293a 0d0a  r, 'is_root'):..
+00024680: 2020 2020 2020 2020 6c61 7965 722e 6973          layer.is
+00024690: 5f72 6f6f 7420 3d20 5472 7565 0d0a 0d0a  _root = True....
+000246a0: 2020 2020 6465 6620 6765 745f 726f 6f74      def get_root
+000246b0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+000246c0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+000246d0: 7365 6c66 2c20 275f 6e6f 6465 7327 2920  self, '_nodes') 
+000246e0: 6f72 2073 656c 662e 5f6e 6f64 6573 2069  or self._nodes i
+000246f0: 7320 4e6f 6e65 206f 7220 6c65 6e28 7365  s None or len(se
+00024700: 6c66 2e5f 6e6f 6465 7329 203c 2032 3a0d  lf._nodes) < 2:.
+00024710: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00024720: 7572 6e20 7365 6c66 0d0a 2020 2020 2020  urn self..      
+00024730: 2020 6966 2068 6173 6174 7472 286c 6973    if hasattr(lis
+00024740: 7428 7365 6c66 2e5f 6e6f 6465 732e 7661  t(self._nodes.va
+00024750: 6c75 6573 2829 295b 305d 2c20 2769 735f  lues())[0], 'is_
+00024760: 726f 6f74 2729 2061 6e64 206c 6973 7428  root') and list(
+00024770: 7365 6c66 2e5f 6e6f 6465 732e 7661 6c75  self._nodes.valu
+00024780: 6573 2829 295b 305d 2e69 735f 726f 6f74  es())[0].is_root
+00024790: 203d 3d20 5472 7565 3a0d 0a20 2020 2020   == True:..     
+000247a0: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
+000247b0: 7374 2873 656c 662e 5f6e 6f64 6573 2e76  st(self._nodes.v
+000247c0: 616c 7565 7328 2929 5b30 5d0d 0a20 2020  alues())[0]..   
+000247d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000247e0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+000247f0: 2c20 6e6f 6465 2069 6e20 7365 6c66 2e5f  , node in self._
+00024800: 6e6f 6465 732e 6974 656d 7328 293a 0d0a  nodes.items():..
+00024810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024820: 6966 2068 6173 6174 7472 286e 6f64 652c  if hasattr(node,
+00024830: 2027 6465 6661 756c 745f 6e61 6d65 2729   'default_name')
+00024840: 2061 6e64 206e 6f64 652e 6465 6661 756c   and node.defaul
+00024850: 745f 6e61 6d65 203d 3d20 2273 6571 7565  t_name == "seque
+00024860: 6e74 6961 6c5f 3122 3a0d 0a20 2020 2020  ntial_1":..     
+00024870: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00024880: 6574 7572 6e20 6e6f 6465 0d0a 2020 2020  eturn node..    
+00024890: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000248a0: 656c 660d 0a0d 0a20 2020 2023 2069 6620  elf....    # if 
+000248b0: 6e6f 7420 6861 7361 7474 7228 6c61 7965  not hasattr(laye
+000248c0: 722c 2027 6465 7669 6365 2729 3a0d 0a20  r, 'device'):.. 
+000248d0: 2020 2023 2020 2020 206c 6179 6572 2e64     #     layer.d
+000248e0: 6576 6963 6520 3d20 6c61 7965 722e 7765  evice = layer.we
+000248f0: 6967 6874 735b 305d 2e64 6576 6963 652e  ights[0].device.
+00024900: 7479 7065 0d0a 0d0a 2020 2020 6c61 7965  type....    laye
+00024910: 722e 746f 2867 6574 5f64 6576 6963 6528  r.to(get_device(
+00024920: 2929 0d0a 2020 2020 6966 206e 6f74 2068  ))..    if not h
+00024930: 6173 6174 7472 286c 6179 6572 2c20 275f  asattr(layer, '_
+00024940: 6e6f 6465 7327 293a 0d0a 2020 2020 2020  nodes'):..      
+00024950: 2020 6c61 7965 722e 5f6e 6f64 6573 203d    layer._nodes =
+00024960: 204f 7264 6572 6564 4469 6374 2829 0d0a   OrderedDict()..
+00024970: 0d0a 2020 2020 6966 206e 6f74 2068 6173  ..    if not has
+00024980: 6174 7472 286c 6179 6572 2c20 275f 7569  attr(layer, '_ui
+00024990: 645f 7072 6566 6978 7327 293a 0d0a 2020  d_prefixs'):..  
+000249a0: 2020 2020 2020 6c61 7965 722e 5f75 6964        layer._uid
+000249b0: 5f70 7265 6669 7873 203d 207b 7d0d 0a20  _prefixs = {}.. 
+000249c0: 2020 2072 6573 6574 5f6e 616d 6528 6c61     reset_name(la
+000249d0: 7965 722c 206c 6179 6572 2e5f 7569 645f  yer, layer._uid_
+000249e0: 7072 6566 6978 7329 0d0a 0d0a 2020 2020  prefixs)....    
+000249f0: 6966 2027 7373 6427 2069 6e20 6c61 7965  if 'ssd' in laye
+00024a00: 722e 5f5f 636c 6173 735f 5f2e 5f5f 6261  r.__class__.__ba
+00024a10: 7365 5f5f 2e5f 5f6e 616d 655f 5f2e 6c6f  se__.__name__.lo
+00024a20: 7765 7228 2920 6f72 2027 796f 6c6f 2720  wer() or 'yolo' 
+00024a30: 696e 206c 6179 6572 2e5f 5f63 6c61 7373  in layer.__class
+00024a40: 5f5f 2e5f 5f62 6173 655f 5f2e 5f5f 6e61  __.__base__.__na
+00024a50: 6d65 5f5f 2e6c 6f77 6572 2829 3a0d 0a20  me__.lower():.. 
+00024a60: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
+00024a70: 7228 6c61 7965 722c 2027 6e6d 735f 7468  r(layer, 'nms_th
+00024a80: 7265 7368 6f6c 6427 293a 0d0a 2020 2020  reshold'):..    
+00024a90: 2020 2020 2020 2020 6465 6c61 7474 7228          delattr(
+00024aa0: 6c61 7965 722c 2027 6e6d 735f 7468 7265  layer, 'nms_thre
+00024ab0: 7368 6f6c 6427 290d 0a20 2020 2020 2020  shold')..       
+00024ac0: 2069 6620 6861 7361 7474 7228 6c61 7965   if hasattr(laye
+00024ad0: 722c 2027 6465 7465 6374 696f 6e5f 7468  r, 'detection_th
+00024ae0: 7265 7368 6f6c 6427 293a 0d0a 2020 2020  reshold'):..    
+00024af0: 2020 2020 2020 2020 6465 6c61 7474 7228          delattr(
+00024b00: 6c61 7965 722c 2027 6465 7465 6374 696f  layer, 'detectio
+00024b10: 6e5f 7468 7265 7368 6f6c 6427 290d 0a0d  n_threshold')...
+00024b20: 0a20 2020 2069 6620 6c61 7965 722e 5f69  .    if layer._i
+00024b30: 6e70 7574 5f73 6861 7065 2069 7320 6e6f  nput_shape is no
+00024b40: 7420 4e6f 6e65 2061 6e64 2069 7369 6e73  t None and isins
+00024b50: 7461 6e63 6528 6c61 7965 722e 5f69 6e70  tance(layer._inp
+00024b60: 7574 5f73 6861 7065 2c20 7475 706c 6529  ut_shape, tuple)
+00024b70: 2061 6e64 2061 6c6c 280d 0a20 2020 2020   and all(..     
+00024b80: 2020 2020 2020 205b 6973 696e 7374 616e         [isinstan
+00024b90: 6365 2864 2c20 6e75 6d62 6572 732e 496e  ce(d, numbers.In
+00024ba0: 7465 6772 616c 2920 666f 7220 6420 696e  tegral) for d in
+00024bb0: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
+00024bc0: 6170 655d 293a 0d0a 2020 2020 2020 2020  ape]):..        
+00024bd0: 6469 6d73 203d 205b 6420 666f 7220 6420  dims = [d for d 
+00024be0: 696e 206c 6179 6572 2e5f 696e 7075 745f  in layer._input_
+00024bf0: 7368 6170 655d 0d0a 2020 2020 2020 2020  shape]..        
+00024c00: 6469 6d73 2e69 6e73 6572 7428 302c 204e  dims.insert(0, N
+00024c10: 6f6e 6529 0d0a 2020 2020 2020 2020 6c61  one)..        la
+00024c20: 7965 722e 5f69 6e70 7574 5f73 6861 7065  yer._input_shape
+00024c30: 203d 2054 656e 736f 7253 6861 7065 2864   = TensorShape(d
+00024c40: 696d 7329 0d0a 2020 2020 656c 6966 206c  ims)..    elif l
+00024c50: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
+00024c60: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+00024c70: 6420 6973 696e 7374 616e 6365 286c 6179  d isinstance(lay
+00024c80: 6572 2e5f 696e 7075 745f 7368 6170 652c  er._input_shape,
+00024c90: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
+00024ca0: 2020 6c61 7965 722e 5f69 6e70 7574 5f73    layer._input_s
+00024cb0: 6861 7065 203d 2074 7570 6c65 285b 5465  hape = tuple([Te
+00024cc0: 6e73 6f72 5368 6170 6528 746f 5f6e 756d  nsorShape(to_num
+00024cd0: 7079 2869 7465 6d29 2920 666f 7220 6974  py(item)) for it
+00024ce0: 656d 2069 6e20 5465 6e73 6f72 5368 6170  em in TensorShap
+00024cf0: 6528 6c61 7965 722e 5f69 6e70 7574 5f73  e(layer._input_s
+00024d00: 6861 7065 295d 290d 0a20 2020 2065 6c69  hape)])..    eli
+00024d10: 6620 6c61 7965 722e 5f69 6e70 7574 5f73  f layer._input_s
+00024d20: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
+00024d30: 2061 6e64 2069 735f 7465 6e73 6f72 286c   and is_tensor(l
+00024d40: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
+00024d50: 6529 3a0d 0a20 2020 2020 2020 2064 696d  e):..        dim
+00024d60: 7320 3d20 5b64 2e69 7465 6d28 2920 666f  s = [d.item() fo
+00024d70: 7220 6420 696e 206c 6179 6572 2e5f 696e  r d in layer._in
+00024d80: 7075 745f 7368 6170 655d 0d0a 2020 2020  put_shape]..    
+00024d90: 2020 2020 6469 6d73 2e69 6e73 6572 7428      dims.insert(
+00024da0: 302c 204e 6f6e 6529 0d0a 2020 2020 2020  0, None)..      
+00024db0: 2020 6275 6666 6572 7320 3d20 6c61 7965    buffers = laye
+00024dc0: 722e 5f5f 6469 6374 5f5f 2e67 6574 2827  r.__dict__.get('
+00024dd0: 5f62 7566 6665 7273 2729 0d0a 2020 2020  _buffers')..    
+00024de0: 2020 2020 6966 2027 5f69 6e70 7574 5f73      if '_input_s
+00024df0: 6861 7065 2720 696e 2062 7566 6665 7273  hape' in buffers
+00024e00: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00024e10: 656c 2062 7566 6665 7273 5b27 5f69 6e70  el buffers['_inp
+00024e20: 7574 5f73 6861 7065 275d 0d0a 2020 2020  ut_shape']..    
+00024e30: 2020 2020 6f62 6a65 6374 2e5f 5f73 6574      object.__set
+00024e40: 6174 7472 5f5f 286c 6179 6572 2c20 275f  attr__(layer, '_
+00024e50: 696e 7075 745f 7368 6170 6527 2c20 5465  input_shape', Te
+00024e60: 6e73 6f72 5368 6170 6528 6469 6d73 2929  nsorShape(dims))
+00024e70: 0d0a 2020 2020 656c 6966 206c 6179 6572  ..    elif layer
+00024e80: 2e5f 696e 7075 745f 7368 6170 6520 6973  ._input_shape is
+00024e90: 206e 6f74 204e 6f6e 6520 616e 6420 6e6f   not None and no
+00024ea0: 7420 6973 696e 7374 616e 6365 286c 6179  t isinstance(lay
+00024eb0: 6572 2e5f 696e 7075 745f 7368 6170 652c  er._input_shape,
+00024ec0: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
+00024ed0: 2020 2020 2020 2020 6c61 7965 722e 5f69          layer._i
+00024ee0: 6e70 7574 5f73 6861 7065 203d 2054 656e  nput_shape = Ten
+00024ef0: 736f 7253 6861 7065 2874 6f5f 6e75 6d70  sorShape(to_nump
+00024f00: 7928 6c61 7965 722e 5f69 6e70 7574 5f73  y(layer._input_s
+00024f10: 6861 7065 2929 0d0a 2020 2020 656c 6966  hape))..    elif
+00024f20: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
+00024f30: 6170 6520 6973 206e 6f74 204e 6f6e 6520  ape is not None 
+00024f40: 616e 6420 6973 696e 7374 616e 6365 286c  and isinstance(l
+00024f50: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
+00024f60: 652c 2054 656e 736f 7253 6861 7065 2920  e, TensorShape) 
+00024f70: 616e 6420 6973 5f74 656e 736f 7228 0d0a  and is_tensor(..
+00024f80: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00024f90: 722e 5f69 6e70 7574 5f73 6861 7065 2e64  r._input_shape.d
+00024fa0: 696d 735b 305d 293a 0d0a 2020 2020 2020  ims[0]):..      
+00024fb0: 2020 6c61 7965 722e 5f69 6e70 7574 5f73    layer._input_s
+00024fc0: 6861 7065 203d 2054 656e 736f 7253 6861  hape = TensorSha
+00024fd0: 7065 285b 642e 6974 656d 2829 2066 6f72  pe([d.item() for
+00024fe0: 2064 2069 6e20 6c61 7965 722e 5f69 6e70   d in layer._inp
+00024ff0: 7574 5f73 6861 7065 2e64 696d 735d 290d  ut_shape.dims]).
+00025000: 0a0d 0a20 2020 2069 6620 6c61 7965 722e  ...    if layer.
+00025010: 5f6f 7574 7075 745f 7368 6170 6520 6973  _output_shape is
+00025020: 206e 6f74 204e 6f6e 6520 616e 6420 6973   not None and is
+00025030: 696e 7374 616e 6365 286c 6179 6572 2e5f  instance(layer._
+00025040: 6f75 7470 7574 5f73 6861 7065 2c20 7475  output_shape, tu
+00025050: 706c 6529 2061 6e64 2061 6c6c 280d 0a20  ple) and all(.. 
+00025060: 2020 2020 2020 2020 2020 205b 6973 696e             [isin
+00025070: 7374 616e 6365 2864 2c20 6e75 6d62 6572  stance(d, number
+00025080: 732e 496e 7465 6772 616c 2920 666f 7220  s.Integral) for 
+00025090: 6420 696e 206c 6179 6572 2e5f 6f75 7470  d in layer._outp
+000250a0: 7574 5f73 6861 7065 5d29 3a0d 0a20 2020  ut_shape]):..   
+000250b0: 2020 2020 2064 696d 7320 3d20 5b64 2066       dims = [d f
+000250c0: 6f72 2064 2069 6e20 6c61 7965 722e 5f69  or d in layer._i
+000250d0: 6e70 7574 5f73 6861 7065 5d0d 0a20 2020  nput_shape]..   
+000250e0: 2020 2020 2064 696d 732e 696e 7365 7274       dims.insert
+000250f0: 2830 2c20 4e6f 6e65 290d 0a20 2020 2020  (0, None)..     
+00025100: 2020 206c 6179 6572 2e5f 696e 7075 745f     layer._input_
+00025110: 7368 6170 6520 3d20 5465 6e73 6f72 5368  shape = TensorSh
+00025120: 6170 6528 6469 6d73 290d 0a20 2020 2065  ape(dims)..    e
+00025130: 6c69 6620 6c61 7965 722e 5f6f 7574 7075  lif layer._outpu
+00025140: 745f 7368 6170 6520 6973 206e 6f74 204e  t_shape is not N
+00025150: 6f6e 6520 616e 6420 6973 696e 7374 616e  one and isinstan
+00025160: 6365 286c 6179 6572 2e5f 6f75 7470 7574  ce(layer._output
+00025170: 5f73 6861 7065 2c20 7475 706c 6529 3a0d  _shape, tuple):.
+00025180: 0a20 2020 2020 2020 206c 6179 6572 2e5f  .        layer._
+00025190: 6f75 7470 7574 5f73 6861 7065 203d 2074  output_shape = t
+000251a0: 7570 6c65 285b 5465 6e73 6f72 5368 6170  uple([TensorShap
+000251b0: 6528 746f 5f6e 756d 7079 2869 7465 6d29  e(to_numpy(item)
+000251c0: 2920 666f 7220 6974 656d 2069 6e20 5465  ) for item in Te
+000251d0: 6e73 6f72 5368 6170 6528 6c61 7965 722e  nsorShape(layer.
+000251e0: 5f6f 7574 7075 745f 7368 6170 6529 5d29  _output_shape)])
+000251f0: 0d0a 2020 2020 656c 6966 206c 6179 6572  ..    elif layer
+00025200: 2e5f 6f75 7470 7574 5f73 6861 7065 2069  ._output_shape i
+00025210: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
+00025220: 735f 7465 6e73 6f72 286c 6179 6572 2e5f  s_tensor(layer._
+00025230: 6f75 7470 7574 5f73 6861 7065 293a 0d0a  output_shape):..
+00025240: 2020 2020 2020 2020 6469 6d73 203d 205b          dims = [
+00025250: 642e 6974 656d 2829 2066 6f72 2064 2069  d.item() for d i
+00025260: 6e20 6c61 7965 722e 5f6f 7574 7075 745f  n layer._output_
+00025270: 7368 6170 655d 0d0a 2020 2020 2020 2020  shape]..        
+00025280: 6469 6d73 2e69 6e73 6572 7428 302c 204e  dims.insert(0, N
+00025290: 6f6e 6529 0d0a 2020 2020 2020 2020 6275  one)..        bu
+000252a0: 6666 6572 7320 3d20 6c61 7965 722e 5f5f  ffers = layer.__
+000252b0: 6469 6374 5f5f 2e67 6574 2827 5f62 7566  dict__.get('_buf
+000252c0: 6665 7273 2729 0d0a 2020 2020 2020 2020  fers')..        
+000252d0: 6966 2027 5f69 6e70 7574 5f73 6861 7065  if '_input_shape
+000252e0: 2720 696e 2062 7566 6665 7273 3a0d 0a20  ' in buffers:.. 
+000252f0: 2020 2020 2020 2020 2020 2064 656c 2062             del b
+00025300: 7566 6665 7273 5b27 5f6f 7574 7075 745f  uffers['_output_
+00025310: 7368 6170 6527 5d0d 0a20 2020 2020 2020  shape']..       
+00025320: 206f 626a 6563 742e 5f5f 7365 7461 7474   object.__setatt
+00025330: 725f 5f28 6c61 7965 722c 2027 5f6f 7574  r__(layer, '_out
+00025340: 7075 745f 7368 6170 6527 2c20 5465 6e73  put_shape', Tens
+00025350: 6f72 5368 6170 6528 6469 6d73 2929 0d0a  orShape(dims))..
+00025360: 2020 2020 656c 6966 206c 6179 6572 2e5f      elif layer._
+00025370: 6f75 7470 7574 5f73 6861 7065 2069 7320  output_shape is 
+00025380: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
+00025390: 2069 7369 6e73 7461 6e63 6528 6c61 7965   isinstance(laye
+000253a0: 722e 5f6f 7574 7075 745f 7368 6170 652c  r._output_shape,
+000253b0: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
+000253c0: 2020 2020 2020 2020 6c61 7965 722e 5f6f          layer._o
+000253d0: 7574 7075 745f 7368 6170 6520 3d20 5465  utput_shape = Te
+000253e0: 6e73 6f72 5368 6170 6528 6c61 7965 722e  nsorShape(layer.
+000253f0: 5f6f 7574 7075 745f 7368 6170 6529 0d0a  _output_shape)..
+00025400: 2020 2020 656c 6966 206c 6179 6572 2e5f      elif layer._
+00025410: 6f75 7470 7574 5f73 6861 7065 2069 7320  output_shape is 
+00025420: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7369  not None and isi
+00025430: 6e73 7461 6e63 6528 6c61 7965 722e 5f6f  nstance(layer._o
+00025440: 7574 7075 745f 7368 6170 652c 2054 656e  utput_shape, Ten
+00025450: 736f 7253 6861 7065 2920 616e 6420 6973  sorShape) and is
+00025460: 696e 7374 616e 6365 280d 0a20 2020 2020  instance(..     
+00025470: 2020 2020 2020 206c 6179 6572 2e5f 6f75         layer._ou
+00025480: 7470 7574 5f73 6861 7065 2e64 696d 735b  tput_shape.dims[
+00025490: 305d 2c20 746f 7263 682e 5369 7a65 2920  0], torch.Size) 
+000254a0: 616e 6420 6c65 6e28 6c61 7965 722e 5f6f  and len(layer._o
+000254b0: 7574 7075 745f 7368 6170 652e 6469 6d73  utput_shape.dims
+000254c0: 5b30 5d29 203d 3d20 313a 0d0a 2020 2020  [0]) == 1:..    
+000254d0: 2020 2020 6c61 7965 722e 5f6f 7574 7075      layer._outpu
+000254e0: 745f 7368 6170 6520 3d20 5465 6e73 6f72  t_shape = Tensor
+000254f0: 5368 6170 6528 5b4e 6f6e 6520 6966 2064  Shape([None if d
+00025500: 2069 7320 4e6f 6e65 2065 6c73 6520 645b   is None else d[
+00025510: 305d 2066 6f72 2064 2069 6e20 6c61 7965  0] for d in laye
+00025520: 722e 5f6f 7574 7075 745f 7368 6170 652e  r._output_shape.
+00025530: 6469 6d73 5d29 0d0a 2020 2020 656c 6966  dims])..    elif
+00025540: 206c 6179 6572 2e5f 6f75 7470 7574 5f73   layer._output_s
+00025550: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
+00025560: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00025570: 6c61 7965 722e 5f6f 7574 7075 745f 7368  layer._output_sh
+00025580: 6170 652c 2054 656e 736f 7253 6861 7065  ape, TensorShape
+00025590: 2920 616e 6420 6973 696e 7374 616e 6365  ) and isinstance
+000255a0: 280d 0a20 2020 2020 2020 2020 2020 206c  (..            l
+000255b0: 6179 6572 2e5f 6f75 7470 7574 5f73 6861  ayer._output_sha
+000255c0: 7065 2e64 696d 735b 305d 2c20 746f 7263  pe.dims[0], torc
+000255d0: 682e 5369 7a65 293a 0d0a 2020 2020 2020  h.Size):..      
+000255e0: 2020 6c61 7965 722e 5f6f 7574 7075 745f    layer._output_
+000255f0: 7368 6170 6520 3d20 7475 706c 6528 5b54  shape = tuple([T
+00025600: 656e 736f 7253 6861 7065 2874 6f5f 6e75  ensorShape(to_nu
+00025610: 6d70 7928 6429 2920 666f 7220 6420 696e  mpy(d)) for d in
+00025620: 206c 6179 6572 2e5f 6f75 7470 7574 5f73   layer._output_s
+00025630: 6861 7065 2e64 696d 735d 290d 0a0d 0a20  hape.dims]).... 
+00025640: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00025650: 7228 6c61 7965 722c 2027 6765 745f 726f  r(layer, 'get_ro
+00025660: 6f74 2729 3a0d 0a20 2020 2020 2020 2073  ot'):..        s
+00025670: 6574 6174 7472 286c 6179 6572 2c20 2767  etattr(layer, 'g
+00025680: 6574 5f72 6f6f 7427 2c20 4d65 7468 6f64  et_root', Method
+00025690: 5479 7065 2867 6574 5f72 6f6f 742c 206c  Type(get_root, l
+000256a0: 6179 6572 2929 0d0a 0d0a 2020 2020 666f  ayer))....    fo
+000256b0: 7220 6d6f 6475 6c65 2069 6e20 6c61 7965  r module in laye
+000256c0: 722e 6d6f 6475 6c65 7328 293a 0d0a 2020  r.modules():..  
+000256d0: 2020 2020 2020 6d6f 6475 6c65 2e64 756d        module.dum
+000256e0: 705f 7061 7463 6865 7320 3d20 5472 7565  p_patches = True
+000256f0: 0d0a 2020 2020 2020 2020 2320 6966 206e  ..        # if n
+00025700: 6f74 2068 6173 6174 7472 286d 6f64 756c  ot hasattr(modul
+00025710: 652c 2027 5f73 6967 6e61 7475 7265 2729  e, '_signature')
+00025720: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+00025730: 206d 6f64 756c 652e 5f73 6967 6e61 7475   module._signatu
+00025740: 7265 203d 2069 6e73 7065 6374 2e73 6967  re = inspect.sig
+00025750: 6e61 7475 7265 286d 6f64 756c 652e 666f  nature(module.fo
+00025760: 7277 6172 6429 0d0a 2020 2020 2020 2020  rward)..        
+00025770: 636c 6173 735f 6e61 6d65 203d 206d 6f64  class_name = mod
+00025780: 756c 652e 5f5f 636c 6173 735f 5f2e 5f5f  ule.__class__.__
+00025790: 6e61 6d65 5f5f 0d0a 2020 2020 2020 2020  name__..        
+000257a0: 6966 206e 6f74 2068 6173 6174 7472 286d  if not hasattr(m
+000257b0: 6f64 756c 652c 2027 6765 745f 726f 6f74  odule, 'get_root
+000257c0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+000257d0: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+000257e0: 2027 6765 745f 726f 6f74 272c 204d 6574   'get_root', Met
+000257f0: 686f 6454 7970 6528 6765 745f 726f 6f74  hodType(get_root
+00025800: 2c20 6c61 7965 7229 290d 0a0d 0a20 2020  , layer))....   
+00025810: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+00025820: 7474 7228 6d6f 6475 6c65 2c20 275f 7374  ttr(module, '_st
+00025830: 6174 655f 6469 6374 5f70 7265 5f68 6f6f  ate_dict_pre_hoo
+00025840: 6b73 2729 3a0d 0a20 2020 2020 2020 2020  ks'):..         
+00025850: 2020 206f 626a 6563 742e 5f5f 7365 7461     object.__seta
+00025860: 7474 725f 5f28 6d6f 6475 6c65 2c20 275f  ttr__(module, '_
+00025870: 666f 7277 6172 645f 686f 6f6b 735f 7769  forward_hooks_wi
+00025880: 7468 5f6b 7761 7267 7327 2c20 4f72 6465  th_kwargs', Orde
+00025890: 7265 6444 6963 7428 2929 0d0a 2020 2020  redDict())..    
+000258a0: 2020 2020 2020 2020 6f62 6a65 6374 2e5f          object._
+000258b0: 5f73 6574 6174 7472 5f5f 286d 6f64 756c  _setattr__(modul
+000258c0: 652c 2027 5f66 6f72 7761 7264 5f70 7265  e, '_forward_pre
+000258d0: 5f68 6f6f 6b73 5f77 6974 685f 6b77 6172  _hooks_with_kwar
+000258e0: 6773 272c 204f 7264 6572 6564 4469 6374  gs', OrderedDict
+000258f0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+00025900: 206f 626a 6563 742e 5f5f 7365 7461 7474   object.__setatt
+00025910: 725f 5f28 6d6f 6475 6c65 2c20 275f 6261  r__(module, '_ba
+00025920: 636b 7761 7264 5f70 7265 5f68 6f6f 6b73  ckward_pre_hooks
+00025930: 272c 204f 7264 6572 6564 4469 6374 2829  ', OrderedDict()
+00025940: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+00025950: 626a 6563 742e 5f5f 7365 7461 7474 725f  bject.__setattr_
+00025960: 5f28 6d6f 6475 6c65 2c20 275f 7374 6174  _(module, '_stat
+00025970: 655f 6469 6374 5f70 7265 5f68 6f6f 6b73  e_dict_pre_hooks
+00025980: 272c 204f 7264 6572 6564 4469 6374 2829  ', OrderedDict()
+00025990: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+000259a0: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
+000259b0: 6c65 2c20 2775 7569 6427 293a 0d0a 2020  le, 'uuid'):..  
+000259c0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+000259d0: 2e75 7569 6420 3d20 7575 6964 2e75 7569  .uuid = uuid.uui
+000259e0: 6434 2829 2e6e 6f64 650d 0a20 2020 2020  d4().node..     
+000259f0: 2020 2023 2063 6865 636b 2066 6f72 2072     # check for r
+00025a00: 6f6f 740d 0a20 2020 2020 2020 2069 6620  oot..        if 
+00025a10: 6d6f 6475 6c65 2e75 7569 6420 3d3d 206c  module.uuid == l
+00025a20: 6179 6572 2e75 7569 643a 0d0a 2020 2020  ayer.uuid:..    
+00025a30: 2020 2020 2020 2020 6d6f 6475 6c65 2e69          module.i
+00025a40: 735f 726f 6f74 203d 2054 7275 650d 0a20  s_root = True.. 
+00025a50: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00025a60: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+00025a70: 2e69 735f 726f 6f74 203d 2046 616c 7365  .is_root = False
+00025a80: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00025a90: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
+00025aa0: 2027 7265 6c61 7469 7665 5f6e 616d 6527   'relative_name'
+00025ab0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00025ac0: 6d6f 6475 6c65 2e72 656c 6174 6976 655f  module.relative_
+00025ad0: 6e61 6d65 203d 2027 270d 0a20 2020 2020  name = ''..     
+00025ae0: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00025af0: 7228 6d6f 6475 6c65 2c20 275f 7569 645f  r(module, '_uid_
+00025b00: 7072 6566 6978 7327 293a 0d0a 2020 2020  prefixs'):..    
+00025b10: 2020 2020 2020 2020 6d6f 6475 6c65 2e5f          module._
+00025b20: 7569 645f 7072 6566 6978 7320 3d20 6c61  uid_prefixs = la
+00025b30: 7965 722e 6765 745f 726f 6f74 2829 2e5f  yer.get_root()._
+00025b40: 7569 645f 7072 6566 6978 730d 0a0d 0a20  uid_prefixs.... 
+00025b50: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+00025b60: 7361 7474 7228 6d6f 6475 6c65 2c20 2764  sattr(module, 'd
+00025b70: 6566 6175 6c74 5f6e 616d 6527 2920 6f72  efault_name') or
+00025b80: 2028 6d6f 6475 6c65 2e64 6566 6175 6c74   (module.default
+00025b90: 5f6e 616d 6520 6973 204e 6f6e 6520 6f72  _name is None or
+00025ba0: 206c 656e 286d 6f64 756c 652e 6465 6661   len(module.defa
+00025bb0: 756c 745f 6e61 6d65 2920 3d3d 2030 293a  ult_name) == 0):
+00025bc0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00025bd0: 6475 6c65 5f70 7265 6669 7820 3d20 6d6f  dule_prefix = mo
+00025be0: 6475 6c65 2e5f 5f63 6c61 7373 5f5f 2e5f  dule.__class__._
+00025bf0: 5f6e 616d 655f 5f0d 0a20 2020 2020 2020  _name__..       
+00025c00: 2020 2020 206d 6f64 756c 652e 6465 6661       module.defa
+00025c10: 756c 745f 6e61 6d65 203d 2063 616d 656c  ult_name = camel
+00025c20: 3273 6e61 6b65 286d 6f64 756c 655f 7072  2snake(module_pr
+00025c30: 6566 6978 2920 2b20 275f 2720 2b20 7374  efix) + '_' + st
+00025c40: 7228 6765 745f 676c 6f62 616c 5f75 6964  r(get_global_uid
+00025c50: 2863 616d 656c 3273 6e61 6b65 286d 6f64  (camel2snake(mod
+00025c60: 756c 655f 7072 6566 6978 2929 290d 0a0d  ule_prefix)))...
+00025c70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00025c80: 6861 7361 7474 7228 6d6f 6475 6c65 2c20  hasattr(module, 
+00025c90: 275f 6e61 6d65 2729 3a0d 0a20 2020 2020  '_name'):..     
+00025ca0: 2020 2020 2020 206d 6f64 756c 652e 5f6e         module._n
+00025cb0: 616d 6520 3d20 4e6f 6e65 0d0a 2020 2020  ame = None..    
+00025cc0: 2020 2020 7265 7365 745f 6e61 6d65 286d      reset_name(m
+00025cd0: 6f64 756c 652c 206c 6179 6572 2e67 6574  odule, layer.get
+00025ce0: 5f72 6f6f 7428 292e 5f75 6964 5f70 7265  _root()._uid_pre
+00025cf0: 6669 7873 290d 0a0d 0a20 2020 2020 2020  fixs)....       
+00025d00: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00025d10: 6d6f 6475 6c65 2c20 276e 616d 6527 293a  module, 'name'):
+00025d20: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00025d30: 6475 6c65 2e6e 616d 6520 3d20 6d6f 6475  dule.name = modu
+00025d40: 6c65 2e5f 6e61 6d65 2069 6620 6d6f 6475  le._name if modu
+00025d50: 6c65 2e5f 6e61 6d65 2069 7320 6e6f 7420  le._name is not 
+00025d60: 4e6f 6e65 2061 6e64 206c 656e 286d 6f64  None and len(mod
+00025d70: 756c 652e 5f6e 616d 6529 203e 2030 2065  ule._name) > 0 e
+00025d80: 6c73 6520 6d6f 6475 6c65 2e72 656c 6174  lse module.relat
+00025d90: 6976 655f 6e61 6d65 0d0a 0d0a 2020 2020  ive_name....    
+00025da0: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
+00025db0: 7472 286d 6f64 756c 652c 2027 5f62 7569  tr(module, '_bui
+00025dc0: 6c74 2729 3a0d 0a20 2020 2020 2020 2020  lt'):..         
+00025dd0: 2020 2073 6574 6174 7472 286d 6f64 756c     setattr(modul
+00025de0: 652c 2027 6275 696c 7427 2c20 5472 7565  e, 'built', True
+00025df0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00025e00: 6861 7361 7474 7228 6d6f 6475 6c65 2c20  hasattr(module, 
+00025e10: 276b 6565 7064 696d 2729 3a0d 0a20 2020  'keepdim'):..   
+00025e20: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+00025e30: 2067 6574 6174 7472 286d 6f64 756c 652c   getattr(module,
+00025e40: 2027 6b65 6570 6469 6d27 290d 0a20 2020   'keepdim')..   
+00025e50: 2020 2020 2020 2020 2064 656c 6174 7472           delattr
+00025e60: 286d 6f64 756c 652c 2027 6b65 6570 6469  (module, 'keepdi
+00025e70: 6d27 290d 0a20 2020 2020 2020 2020 2020  m')..           
+00025e80: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+00025e90: 2027 6b65 6570 6469 6d73 272c 2076 616c   'keepdims', val
+00025ea0: 7565 290d 0a0d 0a20 2020 2020 2020 2069  ue)....        i
+00025eb0: 6620 6e6f 7420 6861 7361 7474 7228 6d6f  f not hasattr(mo
+00025ec0: 6475 6c65 2c20 275f 6e6f 6e5f 7065 7273  dule, '_non_pers
+00025ed0: 6973 7465 6e74 5f62 7566 6665 7273 5f73  istent_buffers_s
+00025ee0: 6574 2729 3a0d 0a20 2020 2020 2020 2020  et'):..         
+00025ef0: 2020 206d 6f64 756c 652e 5f6e 6f6e 5f70     module._non_p
+00025f00: 6572 7369 7374 656e 745f 6275 6666 6572  ersistent_buffer
+00025f10: 735f 7365 7420 3d20 7365 7428 290d 0a0d  s_set = set()...
+00025f20: 0a20 2020 2020 2020 2023 2066 6978 2066  .        # fix f
+00025f30: 6f72 2073 6861 7065 2064 6566 696e 6974  or shape definit
+00025f40: 696f 6e0d 0a20 2020 2020 2020 2023 2069  ion..        # i
+00025f50: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00025f60: 286d 6f64 756c 652e 5f69 6e70 7574 5f73  (module._input_s
+00025f70: 6861 7065 2c20 5465 6e73 6f72 5368 6170  hape, TensorShap
+00025f80: 6529 3a0d 0a20 2020 2020 2020 2023 2020  e):..        #  
+00025f90: 2020 206d 6f64 756c 652e 5f69 6e70 7574     module._input
+00025fa0: 5f73 6861 7065 203d 2054 656e 736f 7253  _shape = TensorS
+00025fb0: 6861 7065 2874 6f5f 6e75 6d70 7928 6d6f  hape(to_numpy(mo
+00025fc0: 6475 6c65 2e5f 696e 7075 745f 7368 6170  dule._input_shap
+00025fd0: 6529 290d 0a20 2020 2020 2020 2023 0d0a  e))..        #..
+00025fe0: 2020 2020 2020 2020 2320 6966 206e 6f74          # if not
+00025ff0: 2069 7369 6e73 7461 6e63 6528 6d6f 6475   isinstance(modu
+00026000: 6c65 2e5f 6f75 7470 7574 5f73 6861 7065  le._output_shape
+00026010: 2c20 5465 6e73 6f72 5368 6170 6529 3a0d  , TensorShape):.
+00026020: 0a20 2020 2020 2020 2023 2020 2020 206d  .        #     m
+00026030: 6f64 756c 652e 5f6f 7574 7075 745f 7368  odule._output_sh
+00026040: 6170 6520 3d20 5465 6e73 6f72 5368 6170  ape = TensorShap
+00026050: 6528 746f 5f6e 756d 7079 286d 6f64 756c  e(to_numpy(modul
+00026060: 652e 5f6f 7574 7075 745f 7368 6170 6529  e._output_shape)
+00026070: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00026080: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
+00026090: 6c65 2c20 2762 6174 6368 5f69 6e64 6578  le, 'batch_index
+000260a0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+000260b0: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+000260c0: 2027 6261 7463 685f 696e 6465 7827 2c20   'batch_index', 
+000260d0: 3029 0d0a 2020 2020 2020 2020 6966 206e  0)..        if n
+000260e0: 6f74 2068 6173 6174 7472 286d 6f64 756c  ot hasattr(modul
+000260f0: 652c 2027 6669 6c74 6572 5f69 6e64 6578  e, 'filter_index
+00026100: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00026110: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+00026120: 2027 6669 6c74 6572 5f69 6e64 6578 272c   'filter_index',
+00026130: 2031 290d 0a20 2020 2020 2020 2069 6620   1)..        if 
+00026140: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
+00026150: 6c65 2c20 2769 6e5f 7365 7175 656e 6365  le, 'in_sequence
+00026160: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00026170: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+00026180: 2027 696e 5f73 6571 7565 6e63 6527 2c20   'in_sequence', 
+00026190: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+000261a0: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+000261b0: 286d 6f64 756c 652c 2027 696e 5f73 6571  (module, 'in_seq
+000261c0: 7565 6e63 6527 293a 0d0a 2020 2020 2020  uence'):..      
+000261d0: 2020 2020 2020 6966 2027 6c73 746d 2720        if 'lstm' 
+000261e0: 696e 2063 6c61 7373 5f6e 616d 652e 6c6f  in class_name.lo
+000261f0: 7765 7228 2920 6f72 2027 6772 7527 2069  wer() or 'gru' i
+00026200: 6e20 636c 6173 735f 6e61 6d65 2e6c 6f77  n class_name.low
+00026210: 6572 2829 206f 7220 2772 6e6e 2720 696e  er() or 'rnn' in
+00026220: 2063 6c61 7373 5f6e 616d 652e 6c6f 7765   class_name.lowe
+00026230: 7228 293a 0d0a 2020 2020 2020 2020 2020  r():..          
+00026240: 2020 2020 2020 6d6f 6475 6c65 2e69 6e5f        module.in_
+00026250: 7365 7175 656e 6365 203d 2054 7275 650d  sequence = True.
+00026260: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00026270: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00026280: 2020 2020 6d6f 6475 6c65 2e69 6e5f 7365      module.in_se
+00026290: 7175 656e 6365 203d 2046 616c 7365 0d0a  quence = False..
+000262a0: 0d0a 2020 2020 2020 2020 6966 2027 436f  ..        if 'Co
+000262b0: 6e76 2720 696e 2063 6c61 7373 5f6e 616d  nv' in class_nam
+000262c0: 6520 616e 6420 2742 6c6f 636b 2720 696e  e and 'Block' in
+000262d0: 2063 6c61 7373 5f6e 616d 653a 0d0a 2020   class_name:..  
+000262e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000262f0: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
+00026300: 2027 7365 7175 656e 6365 5f72 616e 6b27   'sequence_rank'
+00026310: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00026320: 2020 2020 6d6f 6475 6c65 2e73 6571 7565      module.seque
+00026330: 6e63 655f 7261 6e6b 203d 2027 636e 6127  nce_rank = 'cna'
+00026340: 0d0a 0d0a 2020 2020 2020 2020 6966 2027  ....        if '
+00026350: 436f 6e76 2720 696e 2063 6c61 7373 5f6e  Conv' in class_n
+00026360: 616d 653a 0d0a 2020 2020 2020 2020 2020  ame:..          
+00026370: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00026380: 286d 6f64 756c 652c 2027 6465 7074 685f  (module, 'depth_
+00026390: 6d75 6c74 6970 6c69 6572 2729 3a0d 0a20  multiplier'):.. 
+000263a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000263b0: 6620 2744 6570 7468 7769 7365 2720 696e  f 'Depthwise' in
+000263c0: 2063 6c61 7373 5f6e 616d 6520 6f72 2027   class_name or '
+000263d0: 5365 7061 7261 626c 6527 2069 6e20 636c  Separable' in cl
+000263e0: 6173 735f 6e61 6d65 3a0d 0a20 2020 2020  ass_name:..     
+000263f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00026400: 6f64 756c 652e 6465 7074 685f 6d75 6c74  odule.depth_mult
+00026410: 6970 6c69 6572 203d 2031 0d0a 2020 2020  iplier = 1..    
+00026420: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00026430: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00026440: 2020 2020 2020 206d 6f64 756c 652e 6465         module.de
+00026450: 7074 685f 6d75 6c74 6970 6c69 6572 203d  pth_multiplier =
+00026460: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+00026470: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00026480: 7228 6d6f 6475 6c65 2c20 2775 7365 5f73  r(module, 'use_s
+00026490: 7065 6374 7261 6c27 293a 0d0a 2020 2020  pectral'):..    
+000264a0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+000264b0: 6c65 2e75 7365 5f73 7065 6374 7261 6c20  le.use_spectral 
+000264c0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2069  = False....    i
+000264d0: 6620 6c61 7965 722e 6973 5f72 6f6f 7420  f layer.is_root 
+000264e0: 3d3d 2054 7275 6520 616e 6420 280d 0a20  == True and (.. 
+000264f0: 2020 2020 2020 2020 2020 206e 6f74 2068             not h
+00026500: 6173 6174 7472 286c 6179 6572 2c20 275f  asattr(layer, '_
+00026510: 7369 676e 6174 7572 6527 2920 6f72 206c  signature') or l
+00026520: 6179 6572 2e5f 7369 676e 6174 7572 6520  ayer._signature 
+00026530: 6973 204e 6f6e 6520 6f72 206c 656e 286c  is None or len(l
+00026540: 6179 6572 2e5f 7369 676e 6174 7572 652e  ayer._signature.
+00026550: 696e 7075 7473 2920 3d3d 2030 293a 0d0a  inputs) == 0):..
+00026560: 2020 2020 2020 2020 6c61 7965 722e 5f73          layer._s
+00026570: 6967 6e61 7475 7265 203d 2067 6574 5f73  ignature = get_s
+00026580: 6967 6e61 7475 7265 286c 6179 6572 290d  ignature(layer).
+00026590: 0a20 2020 2072 6574 7572 6e20 6c61 7965  .    return laye
+000265a0: 720d 0a0d 0a0d 0a64 6566 2066 6978 5f70  r......def fix_p
+000265b0: 7974 6f72 6368 5f6d 6f64 756c 6528 6d6f  ytorch_module(mo
+000265c0: 6475 6c65 3a20 6e6e 2e4d 6f64 756c 652c  dule: nn.Module,
+000265d0: 2069 6e70 7574 5f74 656e 736f 723a 2054   input_tensor: T
+000265e0: 656e 736f 7220 3d20 4e6f 6e65 2c20 696e  ensor = None, in
+000265f0: 7075 745f 7368 6170 653a 2028 7475 706c  put_shape: (tupl
+00026600: 652c 2054 656e 736f 7253 6861 7065 2920  e, TensorShape) 
+00026610: 3d20 4e6f 6e65 293a 0d0a 2020 2020 6d6f  = None):..    mo
+00026620: 6475 6c65 2e69 735f 726f 6f74 203d 2054  dule.is_root = T
+00026630: 7275 650d 0a20 2020 206d 6f64 756c 652e  rue..    module.
+00026640: 6e61 6d65 203d 206d 6f64 756c 652e 5f5f  name = module.__
+00026650: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00026660: 0d0a 2020 2020 6d6f 6475 6c65 2e5f 6e6f  ..    module._no
+00026670: 6465 7320 3d20 4f72 6465 7265 6444 6963  des = OrderedDic
+00026680: 7428 290d 0a20 2020 206d 6f64 756c 652e  t()..    module.
+00026690: 5f75 6964 5f70 7265 6669 7873 203d 2064  _uid_prefixs = d
+000266a0: 6566 6175 6c74 6469 6374 2869 6e74 290d  efaultdict(int).
+000266b0: 0a20 2020 206d 6f64 756c 652e 5f73 6967  .    module._sig
+000266c0: 6e61 7475 7265 203d 2067 6574 5f73 6967  nature = get_sig
+000266d0: 6e61 7475 7265 286d 6f64 756c 6529 0d0a  nature(module)..
+000266e0: 2020 2020 6d6f 6475 6c65 2e73 6967 6e61      module.signa
+000266f0: 7475 7265 203d 2067 6574 5f73 6967 6e61  ture = get_signa
+00026700: 7475 7265 286d 6f64 756c 6529 0d0a 0d0a  ture(module)....
+00026710: 2020 2020 6465 6620 6765 7477 6569 6768      def getweigh
+00026720: 7473 286d 6f64 756c 6529 3a0d 0a20 2020  ts(module):..   
+00026730: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
+00026740: 286d 6f64 756c 652e 7061 7261 6d65 7465  (module.paramete
+00026750: 7273 2829 290d 0a0d 0a20 2020 2064 6566  rs())....    def
+00026760: 2067 6574 5f75 6964 2870 7265 6669 783d   get_uid(prefix=
+00026770: 2727 293a 0d0a 2020 2020 2020 2020 6d6f  ''):..        mo
+00026780: 6475 6c65 2e5f 7569 645f 7072 6566 6978  dule._uid_prefix
+00026790: 735b 7072 6566 6978 5d20 2b3d 2031 0d0a  s[prefix] += 1..
+000267a0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+000267b0: 6f64 756c 652e 5f75 6964 5f70 7265 6669  odule._uid_prefi
+000267c0: 7873 5b70 7265 6669 785d 0d0a 0d0a 2020  xs[prefix]....  
+000267d0: 2020 6465 6620 6765 745f 726f 6f74 286d    def get_root(m
+000267e0: 6f64 756c 6529 3a0d 0a20 2020 2020 2020  odule):..       
+000267f0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00026800: 6d6f 6475 6c65 2c20 275f 6e6f 6465 7327  module, '_nodes'
+00026810: 2920 6f72 206d 6f64 756c 652e 5f6e 6f64  ) or module._nod
+00026820: 6573 2069 7320 4e6f 6e65 206f 7220 6c65  es is None or le
+00026830: 6e28 6d6f 6475 6c65 2e5f 6e6f 6465 7329  n(module._nodes)
+00026840: 203c 2032 3a0d 0a20 2020 2020 2020 2020   < 2:..         
+00026850: 2020 2072 6574 7572 6e20 6d6f 6475 6c65     return module
+00026860: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00026870: 6174 7472 286c 6973 7428 6d6f 6475 6c65  attr(list(module
+00026880: 2e5f 6e6f 6465 732e 7661 6c75 6573 2829  ._nodes.values()
+00026890: 295b 305d 2c20 2769 735f 726f 6f74 2729  )[0], 'is_root')
+000268a0: 2061 6e64 206c 6973 7428 6d6f 6475 6c65   and list(module
+000268b0: 2e5f 6e6f 6465 732e 7661 6c75 6573 2829  ._nodes.values()
+000268c0: 295b 305d 2e69 735f 726f 6f74 203d 3d20  )[0].is_root == 
+000268d0: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
+000268e0: 2020 2072 6574 7572 6e20 6c69 7374 286d     return list(m
+000268f0: 6f64 756c 652e 5f6e 6f64 6573 2e76 616c  odule._nodes.val
+00026900: 7565 7328 2929 5b30 5d0d 0a20 2020 2020  ues())[0]..     
+00026910: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00026920: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+00026930: 6e6f 6465 2069 6e20 6d6f 6475 6c65 2e5f  node in module._
+00026940: 6e6f 6465 732e 6974 656d 7328 293a 0d0a  nodes.items():..
+00026950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026960: 6966 2068 6173 6174 7472 286e 6f64 652c  if hasattr(node,
+00026970: 2027 6465 6661 756c 745f 6e61 6d65 2729   'default_name')
+00026980: 2061 6e64 206e 6f64 652e 6465 6661 756c   and node.defaul
+00026990: 745f 6e61 6d65 203d 3d20 2273 6571 7565  t_name == "seque
+000269a0: 6e74 6961 6c5f 3122 3a0d 0a20 2020 2020  ntial_1":..     
+000269b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000269c0: 6574 7572 6e20 6e6f 6465 0d0a 2020 2020  eturn node..    
+000269d0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+000269e0: 6f64 756c 650d 0a0d 0a20 2020 2066 6f72  odule....    for
+000269f0: 206e 616d 652c 206d 6f64 2069 6e20 6d6f   name, mod in mo
+00026a00: 6475 6c65 2e6e 616d 6564 5f6d 6f64 756c  dule.named_modul
+00026a10: 6573 2829 3a0d 0a20 2020 2020 2020 2069  es():..        i
+00026a20: 6620 6d6f 6420 213d 206d 6f64 756c 653a  f mod != module:
+00026a30: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00026a40: 6475 6c65 2e69 735f 726f 6f74 203d 2046  dule.is_root = F
+00026a50: 616c 7365 0d0a 2020 2020 2020 2020 6d6f  alse..        mo
+00026a60: 642e 5f62 7569 6c74 203d 2054 7275 650d  d._built = True.
+00026a70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00026a80: 6861 7361 7474 7228 6d6f 642c 2027 6275  hasattr(mod, 'bu
+00026a90: 696c 7427 293a 0d0a 2020 2020 2020 2020  ilt'):..        
+00026aa0: 2020 2020 6d6f 642e 6275 696c 7420 3d20      mod.built = 
+00026ab0: 5472 7565 0d0a 2020 2020 2020 2020 6d6f  True..        mo
+00026ac0: 642e 7265 6c61 7469 7665 5f6e 616d 6520  d.relative_name 
+00026ad0: 3d20 6e61 6d65 0d0a 2020 2020 2020 2020  = name..        
+00026ae0: 6d6f 642e 6261 7463 685f 696e 6465 7820  mod.batch_index 
+00026af0: 3d20 300d 0a20 2020 2020 2020 206d 6f64  = 0..        mod
+00026b00: 2e66 696c 7465 725f 696e 6465 7820 3d20  .filter_index = 
+00026b10: 310d 0a0d 0a20 2020 2020 2020 206d 6f64  1....        mod
+00026b20: 2e69 6e5f 7365 7175 656e 6365 203d 2046  .in_sequence = F
+00026b30: 616c 7365 0d0a 2020 2020 2020 2020 6d6f  alse..        mo
+00026b40: 642e 7575 6964 203d 2075 7569 642e 7575  d.uuid = uuid.uu
+00026b50: 6964 3428 292e 6e6f 6465 0d0a 2020 2020  id4().node..    
+00026b60: 2020 2020 7072 6566 6978 203d 206d 6f64      prefix = mod
+00026b70: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+00026b80: 655f 5f0d 0a20 2020 2020 2020 206d 6f64  e__..        mod
+00026b90: 2e64 6566 6175 6c74 5f6e 616d 6520 3d20  .default_name = 
+00026ba0: 6361 6d65 6c32 736e 616b 6528 7072 6566  camel2snake(pref
+00026bb0: 6978 2920 2b20 275f 2720 2b20 7374 7228  ix) + '_' + str(
+00026bc0: 6765 745f 7569 6428 6361 6d65 6c32 736e  get_uid(camel2sn
+00026bd0: 616b 6528 7072 6566 6978 2929 290d 0a0d  ake(prefix)))...
+00026be0: 0a20 2020 2020 2020 206d 6f64 2e5f 696e  .        mod._in
+00026bf0: 7075 745f 7368 6170 6520 3d20 4e6f 6e65  put_shape = None
+00026c00: 0d0a 2020 2020 2020 2020 6d6f 642e 5f6f  ..        mod._o
+00026c10: 7574 7075 745f 7368 6170 6520 3d20 4e6f  utput_shape = No
+00026c20: 6e65 0d0a 2020 2020 2020 2020 6d6f 642e  ne..        mod.
+00026c30: 6b65 6570 5f6f 7574 7075 7420 3d20 4661  keep_output = Fa
+00026c40: 6c73 650d 0a20 2020 2020 2020 206d 6f64  lse..        mod
+00026c50: 2e72 6567 6973 7465 725f 6275 6666 6572  .register_buffer
+00026c60: 2827 5f6f 7574 7075 745f 7465 6e73 6f72  ('_output_tensor
+00026c70: 272c 204e 6f6e 652c 2070 6572 7369 7374  ', None, persist
+00026c80: 656e 743d 4661 6c73 6529 0d0a 0d0a 2020  ent=False)....  
+00026c90: 2020 2020 2020 6d6f 642e 5f64 6576 6963        mod._devic
+00026ca0: 6520 3d20 6765 745f 6465 7669 6365 2829  e = get_device()
+00026cb0: 0d0a 2020 2020 2020 2020 2320 6d6f 642e  ..        # mod.
+00026cc0: 5f73 6967 6e61 7475 7265 203d 2069 6e73  _signature = ins
+00026cd0: 7065 6374 2e73 6967 6e61 7475 7265 286d  pect.signature(m
+00026ce0: 6f64 2e66 6f72 7761 7264 290d 0a20 2020  od.forward)..   
+00026cf0: 2020 2020 206d 6f64 2e64 756d 705f 7061       mod.dump_pa
+00026d00: 7463 6865 7320 3d20 5472 7565 0d0a 2020  tches = True..  
+00026d10: 2020 2020 2020 230d 0a20 2020 2020 2020        #..       
+00026d20: 2023 2064 6566 2067 6574 7369 676e 6174   # def getsignat
+00026d30: 7572 6528 6d6f 6429 3a0d 0a20 2020 2020  ure(mod):..     
+00026d40: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+00026d50: 6d6f 642e 5f73 6967 6e61 7475 7265 0d0a  mod._signature..
+00026d60: 2020 2020 2020 2020 230d 0a20 2020 2020          #..     
+00026d70: 2020 2023 2064 6566 2073 6574 7369 676e     # def setsign
+00026d80: 6174 7572 6528 6d6f 642c 2076 616c 7565  ature(mod, value
+00026d90: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
+00026da0: 2020 6d6f 642e 5f73 6967 6e61 7475 7265    mod._signature
+00026db0: 203d 2076 616c 7565 0d0a 2020 2020 2020   = value..      
+00026dc0: 2020 230d 0a20 2020 2020 2020 2023 2064    #..        # d
+00026dd0: 6566 2064 656c 7369 676e 6174 7572 6528  ef delsignature(
+00026de0: 6d6f 6429 3a0d 0a20 2020 2020 2020 2023  mod):..        #
+00026df0: 2020 2020 2064 656c 206d 6f64 2e5f 7369       del mod._si
+00026e00: 676e 6174 7572 650d 0a20 2020 2020 2020  gnature..       
+00026e10: 2023 0d0a 2020 2020 2020 2020 2320 6d6f   #..        # mo
+00026e20: 642e 7369 676e 6174 7572 653d 2070 726f  d.signature= pro
+00026e30: 7065 7274 7928 6765 7473 6967 6e61 7475  perty(getsignatu
+00026e40: 7265 2c20 7365 7473 6967 6e61 7475 7265  re, setsignature
+00026e50: 2c20 6465 6c73 6967 6e61 7475 7265 2c20  , delsignature, 
+00026e60: 2273 6967 6e61 7475 7265 2229 0d0a 0d0a  "signature")....
+00026e70: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
+00026e80: 6173 6174 7472 286d 6f64 2c20 2767 6574  asattr(mod, 'get
+00026e90: 5f72 6f6f 7427 293a 0d0a 2020 2020 2020  _root'):..      
+00026ea0: 2020 2020 2020 7365 7461 7474 7228 6d6f        setattr(mo
+00026eb0: 642c 2027 6765 745f 726f 6f74 272c 204d  d, 'get_root', M
+00026ec0: 6574 686f 6454 7970 6528 6765 745f 726f  ethodType(get_ro
+00026ed0: 6f74 2c20 6d6f 6429 290d 0a0d 0a20 2020  ot, mod))....   
+00026ee0: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+00026ef0: 7474 7228 6d6f 642c 2027 7765 6967 6874  ttr(mod, 'weight
+00026f00: 7327 293a 0d0a 2020 2020 2020 2020 2020  s'):..          
+00026f10: 2020 636c 7320 3d20 7479 7065 286d 6f64    cls = type(mod
+00026f20: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+00026f30: 6c73 2e77 6569 6768 7473 203d 2070 726f  ls.weights = pro
+00026f40: 7065 7274 7928 6c61 6d62 6461 2073 656c  perty(lambda sel
+00026f50: 663a 206c 6973 7428 7365 6c66 2e70 6172  f: list(self.par
+00026f60: 616d 6574 6572 7328 2929 290d 0a20 2020  ameters()))..   
+00026f70: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00026f80: 6d6f 642c 2027 6469 6d73 2729 3a0d 0a20  mod, 'dims'):.. 
+00026f90: 2020 2020 2020 2020 2020 206d 6f64 2e61             mod.a
+00026fa0: 7869 7320 3d20 6d6f 642e 6469 6d73 0d0a  xis = mod.dims..
+00026fb0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00026fc0: 7472 286d 6f64 756c 652c 2027 6b65 6570  tr(module, 'keep
+00026fd0: 6469 6d27 293a 0d0a 2020 2020 2020 2020  dim'):..        
+00026fe0: 2020 2020 7661 6c75 6520 3d20 6765 7461      value = geta
+00026ff0: 7474 7228 6d6f 6475 6c65 2c20 276b 6565  ttr(module, 'kee
+00027000: 7064 696d 2729 0d0a 2020 2020 2020 2020  pdim')..        
+00027010: 2020 2020 7365 7461 7474 7228 6d6f 6475      setattr(modu
+00027020: 6c65 2c20 276b 6565 7064 696d 7327 2c20  le, 'keepdims', 
+00027030: 7661 6c75 6529 0d0a 0d0a 2020 2020 2320  value)....    # 
+00027040: 6465 6620 7265 6769 7374 6572 5f68 6f6f  def register_hoo
+00027050: 6b28 6d6f 6475 6c65 293a 0d0a 2020 2020  k(module):..    
+00027060: 2320 2020 2020 6465 6620 686f 6f6b 286d  #     def hook(m
+00027070: 6f64 756c 652c 2069 6e70 7574 2c20 6f75  odule, input, ou
+00027080: 7470 7574 293a 0d0a 2020 2020 2320 2020  tput):..    #   
+00027090: 2020 2020 2020 2320 636c 6173 735f 6e61        # class_na
+000270a0: 6d65 203d 6d6f 6475 6c65 2e72 6520 2020  me =module.re   
+000270b0: 206d 6f64 756c 652e 6e61 6d65 2020 2023   module.name   #
+000270c0: 2073 7472 286d 6f64 756c 652e 5f5f 636c   str(module.__cl
+000270d0: 6173 735f 5f29 2e73 706c 6974 2822 2e22  ass__).split("."
+000270e0: 295b 2d31 5d2e 7370 6c69 7428 2227 2229  )[-1].split("'")
+000270f0: 5b30 5d0d 0a20 2020 2023 2020 2020 2020  [0]..    #      
+00027100: 2020 2069 6e70 7574 203d 2069 7465 7261     input = itera
+00027110: 7469 6f6e 5f74 6f6f 6c73 2e66 6c61 7474  tion_tools.flatt
+00027120: 656e 285b 696e 7075 745d 2c20 6974 6572  en([input], iter
+00027130: 6162 6c65 5f74 7970 6573 3d28 6c69 7374  able_types=(list
+00027140: 2c20 7475 706c 6529 290d 0a20 2020 2023  , tuple))..    #
+00027150: 2020 2020 2020 2020 2069 6e70 7574 203d           input =
+00027160: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+00027170: 6e28 5b69 7465 6d20 666f 7220 6974 656d  n([item for item
+00027180: 2069 6e20 696e 7075 7420 6966 2069 7465   in input if ite
+00027190: 6d20 6973 206e 6f74 204e 6f6e 655d 290d  m is not None]).
+000271a0: 0a20 2020 2023 0d0a 2020 2020 2320 2020  .    #..    #   
+000271b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000271c0: 6e63 6528 696e 7075 742c 2028 6c69 7374  nce(input, (list
+000271d0: 2c20 7475 706c 6529 293a 0d0a 2020 2020  , tuple)):..    
+000271e0: 2320 2020 2020 2020 2020 2020 2020 6d6f  #             mo
+000271f0: 6475 6c65 2e5f 696e 7075 745f 7368 6170  dule._input_shap
+00027200: 6520 3d20 7475 706c 6528 5b74 656e 736f  e = tuple([tenso
+00027210: 725f 746f 5f73 6861 7065 2874 2c20 6e65  r_to_shape(t, ne
+00027220: 6564 5f65 7863 6c75 6465 5f62 6174 6368  ed_exclude_batch
+00027230: 5f61 7869 733d 5472 7565 2c20 6973 5f73  _axis=True, is_s
+00027240: 696e 676c 6574 6f6e 3d46 616c 7365 2920  ingleton=False) 
+00027250: 666f 7220 7420 696e 2069 6e70 7574 5d29  for t in input])
+00027260: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00027270: 2020 2020 6d6f 6475 6c65 2e69 6e70 7574      module.input
+00027280: 5f73 6861 7065 203d 206d 6f64 756c 652e  _shape = module.
+00027290: 5f69 6e70 7574 5f73 6861 7065 0d0a 2020  _input_shape..  
+000272a0: 2020 2320 2020 2020 2020 2020 656c 6966    #         elif
+000272b0: 2069 735f 7465 6e73 6f72 2869 6e70 7574   is_tensor(input
+000272c0: 293a 0d0a 2020 2020 2320 2020 2020 2020  ):..    #       
+000272d0: 2020 2020 2020 6d6f 6475 6c65 2e5f 696e        module._in
+000272e0: 7075 745f 7368 6170 6520 3d20 7465 6e73  put_shape = tens
+000272f0: 6f72 5f74 6f5f 7368 6170 6528 696e 7075  or_to_shape(inpu
+00027300: 742c 206e 6565 645f 6578 636c 7564 655f  t, need_exclude_
+00027310: 6261 7463 685f 6178 6973 3d54 7275 652c  batch_axis=True,
+00027320: 2069 735f 7369 6e67 6c65 746f 6e3d 4661   is_singleton=Fa
+00027330: 6c73 6529 0d0a 2020 2020 2320 2020 2020  lse)..    #     
+00027340: 2020 2020 2020 2020 6d6f 6475 6c65 2e69          module.i
+00027350: 6e70 7574 5f73 6861 7065 203d 206d 6f64  nput_shape = mod
+00027360: 756c 652e 5f69 6e70 7574 5f73 6861 7065  ule._input_shape
+00027370: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+00027380: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+00027390: 6974 6572 6174 696f 6e5f 746f 6f6c 732e  iteration_tools.
+000273a0: 666c 6174 7465 6e28 5b6f 7574 7075 745d  flatten([output]
+000273b0: 2c20 6974 6572 6162 6c65 5f74 7970 6573  , iterable_types
+000273c0: 3d28 6c69 7374 2c20 7475 706c 6529 290d  =(list, tuple)).
+000273d0: 0a20 2020 2023 2020 2020 2020 2020 206f  .    #         o
+000273e0: 7574 7075 7420 3d20 756e 7061 636b 5f73  utput = unpack_s
+000273f0: 696e 676c 6574 6f6e 285b 6974 656d 2066  ingleton([item f
+00027400: 6f72 2069 7465 6d20 696e 206f 7574 7075  or item in outpu
+00027410: 7420 6966 2069 7465 6d20 6973 206e 6f74  t if item is not
+00027420: 204e 6f6e 655d 290d 0a20 2020 2023 2020   None])..    #  
+00027430: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00027440: 616e 6365 286f 7574 7075 742c 2028 6c69  ance(output, (li
+00027450: 7374 2c20 7475 706c 6529 293a 0d0a 2020  st, tuple)):..  
+00027460: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00027470: 6d6f 6475 6c65 2e5f 6f75 7470 7574 5f73  module._output_s
+00027480: 6861 7065 203d 2074 7570 6c65 285b 7465  hape = tuple([te
+00027490: 6e73 6f72 5f74 6f5f 7368 6170 6528 742c  nsor_to_shape(t,
+000274a0: 206e 6565 645f 6578 636c 7564 655f 6261   need_exclude_ba
+000274b0: 7463 685f 6178 6973 3d54 7275 652c 2069  tch_axis=True, i
+000274c0: 735f 7369 6e67 6c65 746f 6e3d 4661 6c73  s_singleton=Fals
+000274d0: 6529 2066 6f72 2074 2069 6e20 6f75 7470  e) for t in outp
+000274e0: 7574 5d29 0d0a 2020 2020 2320 2020 2020  ut])..    #     
+000274f0: 2020 2020 2020 2020 6d6f 6475 6c65 2e6f          module.o
+00027500: 7574 7075 745f 7368 6170 6520 3d20 6d6f  utput_shape = mo
+00027510: 6475 6c65 2e5f 6f75 7470 7574 5f73 6861  dule._output_sha
+00027520: 7065 0d0a 2020 2020 2320 2020 2020 2020  pe..    #       
+00027530: 2020 656c 6966 2069 735f 7465 6e73 6f72    elif is_tensor
+00027540: 286f 7574 7075 7429 3a0d 0a20 2020 2023  (output):..    #
+00027550: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+00027560: 756c 652e 5f6f 7574 7075 745f 7368 6170  ule._output_shap
+00027570: 6520 3d20 7465 6e73 6f72 5f74 6f5f 7368  e = tensor_to_sh
+00027580: 6170 6528 6f75 7470 7574 2c20 6e65 6564  ape(output, need
+00027590: 5f65 7863 6c75 6465 5f62 6174 6368 5f61  _exclude_batch_a
+000275a0: 7869 733d 5472 7565 2c20 6973 5f73 696e  xis=True, is_sin
+000275b0: 676c 6574 6f6e 3d46 616c 7365 290d 0a20  gleton=False).. 
+000275c0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+000275d0: 206d 6f64 756c 652e 6f75 7470 7574 5f73   module.output_s
+000275e0: 6861 7065 203d 206d 6f64 756c 652e 5f6f  hape = module._o
+000275f0: 7574 7075 745f 7368 6170 650d 0a20 2020  utput_shape..   
+00027600: 2023 0d0a 2020 2020 2320 2020 2020 2020   #..    #       
+00027610: 2020 686f 6f6b 732e 6170 7065 6e64 286d    hooks.append(m
+00027620: 6f64 756c 652e 7265 6769 7374 6572 5f66  odule.register_f
+00027630: 6f72 7761 7264 5f68 6f6f 6b28 686f 6f6b  orward_hook(hook
+00027640: 2929 0d0a 2020 2020 230d 0a20 2020 2023  ))..    #..    #
+00027650: 2068 6f6f 6b73 203d 205b 5d0d 0a20 2020   hooks = []..   
+00027660: 2023 0d0a 2020 2020 2320 2320 7265 6769   #..    # # regi
+00027670: 7374 6572 2068 6f6f 6b0d 0a20 2020 2023  ster hook..    #
+00027680: 206d 6f64 756c 652e 6170 706c 7928 7265   module.apply(re
+00027690: 6769 7374 6572 5f68 6f6f 6b29 0d0a 2020  gister_hook)..  
+000276a0: 2020 230d 0a20 2020 2023 2069 6620 6d6f    #..    # if mo
+000276b0: 6475 6c65 2e73 6967 6e61 7475 7265 2069  dule.signature i
+000276c0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000276d0: 2023 2020 2020 2069 6e70 7574 5f74 656e   #     input_ten
+000276e0: 736f 7220 3d20 5b74 6f5f 7465 6e73 6f72  sor = [to_tensor
+000276f0: 286d 6f64 756c 652e 7369 676e 6174 7572  (module.signatur
+00027700: 652e 696e 7075 7473 2e76 616c 7565 5f6c  e.inputs.value_l
+00027710: 6973 745b 6b5d 2e67 6574 5f64 756d 6d79  ist[k].get_dummy
+00027720: 5f74 656e 736f 7228 2929 2066 6f72 206b  _tensor()) for k
+00027730: 2069 6e20 2072 616e 6765 286d 6f64 756c   in  range(modul
+00027740: 652e 7369 676e 6174 7572 652e 696e 7075  e.signature.inpu
+00027750: 7473 2e76 616c 7565 5f6c 6973 7429 2069  ts.value_list) i
+00027760: 6620 6e6f 7420 6d6f 6475 6c65 2e73 6967  f not module.sig
+00027770: 6e61 7475 7265 2e69 6e70 7574 732e 7661  nature.inputs.va
+00027780: 6c75 655f 6c69 7374 5b6b 5d2e 6f70 7469  lue_list[k].opti
+00027790: 6f6e 616c 206f 7220 6b3d 3d30 5d0d 0a20  onal or k==0].. 
+000277a0: 2020 2023 2020 2020 2023 206d 616b 6520     #     # make 
+000277b0: 6120 666f 7277 6172 6420 7061 7373 0d0a  a forward pass..
+000277c0: 2020 2020 2320 2020 2020 2320 7072 696e      #     # prin
+000277d0: 7428 782e 7368 6170 6529 0d0a 2020 2020  t(x.shape)..    
+000277e0: 2320 2020 2020 6d6f 6475 6c65 282a 696e  #     module(*in
+000277f0: 7075 745f 7465 6e73 6f72 290d 0a20 2020  put_tensor)..   
+00027800: 2023 0d0a 2020 2020 2320 2320 7265 6d6f   #..    # # remo
+00027810: 7665 2074 6865 7365 2068 6f6f 6b73 0d0a  ve these hooks..
+00027820: 2020 2020 2320 666f 7220 6820 696e 2068      # for h in h
+00027830: 6f6f 6b73 3a0d 0a20 2020 2023 2020 2020  ooks:..    #    
+00027840: 2068 2e72 656d 6f76 6528 290d 0a20 2020   h.remove()..   
+00027850: 2072 6574 7572 6e20 6d6f 6475 6c65 0d0a   return module..
```

## trident/backend/pytorch_ops.py

```diff
@@ -8,15 +8,15 @@
 
 import builtins
 import collections
 import gc
 import math
 import numbers
 import random
-from collections import Sized, Iterable
+from collections.abc import Sized,Iterable
 from distutils.version import LooseVersion
 from functools import wraps
 from typing import Tuple, List, Optional, Union, Sequence, Any
 from torch.types import _int, _float, _bool, Number, _dtype, Device
 import numpy as np
 import torch
 import torch.nn as nn
@@ -121,15 +121,15 @@
            'gpt_gelu', 'moments', 'norm', 'l2_normalize', 'spectral_norm', 'broadcast_to', 'expand_as', 'ones',
            'ones_like', 'zeros', 'zeros_like', 'eye', 'eye_like', 'make_onehot', 'arange', 'meshgrid', 'reshape',
            'permute', 'transpose', 'squeeze', 'expand_dims', 'concate', 'stack', 'split', 'repeat_elements', 'gather',
            'index_select', 'scatter_add', 'scatter_sub', 'scatter_max', 'scatter_min', 'gram_matrix', 'set_seed',
            'shuffle',
            'random_choice', 'random_normal', 'random_normal_like', 'random_uniform', 'random_uniform_like',
            'multinomial', 'random_bernoulli', 'binary_cross_entropy',
-           'rgb2xyz', 'rgb2hsv', 'rgb2lab', 'rgb2gray', 'xyz2lab', 'xyz2rgb', 'lab2xyz', 'lab2rgb', 'xywh2xyxy',
+           'rgb2xyz', 'rgb2hsv','hsv2rgb', 'rgb2lab', 'rgb2gray', 'xyz2lab', 'xyz2rgb', 'lab2xyz', 'lab2rgb', 'xywh2xyxy',
            'xyxy2xywh', 'bbox_iou',
            'bbox_giou', 'bbox_ciou', 'bbox_diou', 'nms']
 
 from math import e, nan, inf, pi
 
 __all__.extend(['e', 'pi', 'nan', 'inf'])
 
@@ -352,15 +352,15 @@
     elif isinstance(x, np.ndarray):
         dtype = str2dtype(str(x.dtype).replace('numpy', 'Dtype'))
 
     elif isinstance(x, Tensor) and 'float' not in str(x.dtype):
         dtype = x.dtype
     elif isinstance(x, Tensor) and 'float' in str(x.dtype):
         dtype = _float_dtype
-    elif dtype is None and not is_tensor(x) and isinstance(x, collections.Iterable) and all(
+    elif dtype is None and not is_tensor(x) and isinstance(x, Iterable) and all(
             [isinstance(item, numbers.Integral) for item in x]):
         dtype = Dtype.int64
     elif dtype is None:
         dtype = _float_dtype
     elif isinstance(dtype, str):
         dtype = str2dtype(dtype)
     if device is None:
@@ -3182,15 +3182,15 @@
         axis (int,list):  axis along which the reduction will be performed
         temperature(float): Temperature
 
     Returns:
         (Tensor): output tensor and get same shape with x.
 
     """
-    return F.log_softmax(x/temperature, axis=axis)
+    return F.log_softmax(x/temperature, dim=axis)
 
 
 def gelu(x):
     """
     Gaussian Error Linear Unit.
     it follows:
         ```
@@ -4487,16 +4487,18 @@
       Returns:
           A tensor.
       """
     if from_logits:
         output = output
     else:
         output = sigmoid(output)
-    bce = target * torch.log(output)
-    bce += (1 - target) * torch.log(1 - output)
+    if isinstance(target,(_float,_int )):
+        target=(ones_like(output)*float(target)).to(output.dtype).to(output.device)
+    bce = target * torch.log(clip(output,min=1e-7))
+    bce =bce+ (1 - target) * torch.log(clip(1 - output,min=1e-7))
     return -bce
 
 
 def cross_entropy(output, target, from_logits=False):
     if not from_logits:
         output = output.sigmoid()
     output = output.clamp(epsilon(), 1.0 - epsilon())
@@ -4572,69 +4574,88 @@
         rgb (tensor):  rgb image  =>shape: (H,W,C)
     Returns:
         gray(tensor):  gray-scale image => shape: (H,W)
 
     Examples:
          >>> import cv2
         >>> img=cv2.cvtColor(cv2.imread('../../images/cat.jpg'),cv2.COLOR_BGR2RGB)
-        >>> hsv_tensor=to_numpy(rgb2hsv(to_tensor(img.copy()).float()))
+        >>> hsv_tensor=to_numpy(rgb2hsv(to_tensor(img.copy()).float())).astype(np.int32)
         >>> groundtruth_hsv=cv2.cvtColor(img,cv2.COLOR_RGB2HSV)
-        >>> abs(np.round(hsv_tensor.astype(np.float32))-groundtruth_hsv.astype(np.float32)).mean()<2
+        >>> print(hsv_tensor,groundtruth_hsv)
+        >>> abs(hsv_tensor-groundtruth_hsv).mean()<2
         True
         >>> print( groundtruth_hsv.shape,groundtruth_hsv)
-        >>> print( hsv_tensor.shape,hsv_tensor.astype(np.uint8))
-        >>> print(abs(np.round(hsv_tensor.astype(np.float32))-groundtruth_hsv.astype(np.float32)).mean())
+        >>> print( hsv_tensor.shape,hsv_tensor.astype(np.int32))
+        >>> print(hsv_tensor-groundtruth_hsv)
 
     """
     rgb = rgb.to(_float_dtype) / 255.0
     if ndim(rgb) not in [3, 4]:
         raise ValueError('input rgb image ndim should equal 3 but get {0}'.format(ndim(rgb)))
-    # rgb=rgb[np.newaxis, ...]
-    rgb = zeros_like(rgb.copy())
-    axis = -1
-    if ndim(rgb) == 4:
-        axis = 1
-
-    # -- V channel
-    out_v = reduce_max(rgb.copy(), axis=axis, keepdims=True)
-
-    # -- S channel
-    delta = reduce_max(rgb.copy(), axis=axis, keepdims=True) - reduce_min(rgb.copy(), axis=axis, keepdims=True)
-    delta_zeros = zeros_like(delta, dtype=delta.dtype)
-    out_s = where(delta == 0, delta_zeros, delta / out_v)
-
-    # -- H channel
-    # red is max
-    maxc_tmp = equal(out_v, rgb, dtype=_float_dtype)
-    _, max_indices = rgb.copy().max(dim=axis)
-    out_h = None
-    if ndim(rgb) == 3:
-        rc, gc, bc = split(maxc_tmp.copy(), 3, axis=axis)
-
-        out_h = torch.cat([
-            bc - gc,
-            2.0 * delta + rc - bc,
-            4.0 * delta + gc - rc, ], dim=axis)
-        out_h = torch.gather(out_h, dim=axis, index=max_indices[:, :, None])
+    is_3d_tensor=False
+    if ndim(rgb)==3:
+        is_3d_tensor=True
+        rgb=rgb.permute(2,0,1).unsqueeze(0)
+    hue = torch.Tensor(rgb.shape[0], rgb.shape[2], rgb.shape[3]).to(rgb.device)
+    eps=1e-7
+    hue[rgb[:, 2] == rgb.max(1)[0]] = 4.0 + ((rgb[:, 0] - rgb[:, 1]) / (rgb.max(1)[0] - rgb.min(1)[0] + eps))[rgb[:, 2] == rgb.max(1)[0]]
+    hue[rgb[:, 1] == rgb.max(1)[0]] = 2.0 + ((rgb[:, 2] - rgb[:, 0]) / (rgb.max(1)[0] - rgb.min(1)[0] + eps))[rgb[:, 1] == rgb.max(1)[0]]
+    hue[rgb[:, 0] == rgb.max(1)[0]] = (0.0 + ((rgb[:, 1] - rgb[:, 2]) / (rgb.max(1)[0] - rgb.min(1)[0] + eps))[rgb[:, 0] == rgb.max(1)[0]]) % 6
+
+    hue[rgb.min(1)[0] == rgb.max(1)[0]] = 0.0
+    hue = hue / 6
+
+    saturation = (rgb.max(1)[0] - rgb.min(1)[0]) / (rgb.max(1)[0] + eps)
+    saturation[rgb.max(1)[0] == 0] = 0
+
+    value = rgb.max(1)[0]
+    hsv=stack([hue, saturation, value],axis=1)
+    if is_3d_tensor:
+        hsv=hsv[0].permute(1,2,0)
+    return round(hsv*255,0).to(rgb.dtype)
 
+def hsv2rgb(hsv: Tensor):
+    """Compute luminance of an RGB image.
 
-    elif ndim(rgb) == 4:
-        rc, gc, bc = split(maxc_tmp.copy(), 3, axis=-3)
-        out_h = torch.cat([
-            bc - gc,
-            2.0 * delta + rc - bc,
-            4.0 * delta + gc - rc,
-        ], dim=-3)
-        out_h = torch.gather(out_h, dim=-3, index=max_indices[..., None, :, :])
-
-    # out_h = out_h / delta
-    out_h = (out_h / 6.0) % 1.0
+    Args:
+        hsv (tensor):  hsv image  =>shape: (H,W,C)
+    Returns:
+        rgb(tensor):rgb image => shape: (H,W,C)
 
-    # -- output
-    return torch.cat([out_h * 255.0, out_s * 255.0, out_v * 255.0], dim=axis)
+    Examples:
+         >>> import cv2
+        >>> img=cv2.cvtColor(cv2.imread('../../images/cat.jpg'),cv2.COLOR_BGR2RGB)
+        >>> np.abs(to_numpy(hsv2rgb(rgb2hsv(to_tensor(img))))-img).mean()<0.01
+        True
+    """
+    hsv = hsv.to(_float_dtype) / 255.0
+    if ndim(hsv) not in [3, 4]:
+        raise ValueError('input rgb image ndim should equal 3 but get {0}'.format(ndim(rgb)))
+    is_3d_tensor=False
+    if ndim(hsv)==3:
+        is_3d_tensor=True
+        hsv=hsv.permute(2,0,1).unsqueeze(0)
+    hsv_h, hsv_s, hsv_l = hsv[:, 0:1], hsv[:, 1:2], hsv[:, 2:3]
+    _c = hsv_l * hsv_s
+    _x = _c * (- torch.abs(hsv_h * 6. % 2. - 1) + 1.)
+    _m = hsv_l - _c
+    _o = torch.zeros_like(_c)
+    idx = (hsv_h * 6.).type(torch.uint8)
+    idx = (idx % 6).expand(-1, 3, -1, -1)
+    rgb = torch.empty_like(hsv)
+    rgb[idx == 0] = torch.cat([_c, _x, _o], dim=1)[idx == 0]
+    rgb[idx == 1] = torch.cat([_x, _c, _o], dim=1)[idx == 1]
+    rgb[idx == 2] = torch.cat([_o, _c, _x], dim=1)[idx == 2]
+    rgb[idx == 3] = torch.cat([_o, _x, _c], dim=1)[idx == 3]
+    rgb[idx == 4] = torch.cat([_x, _o, _c], dim=1)[idx == 4]
+    rgb[idx == 5] = torch.cat([_c, _o, _x], dim=1)[idx == 5]
+    rgb += _m
+    if is_3d_tensor:
+        rgb=rgb[0].permute(1,2,0)
+    return round(rgb*255,0).to(hsv.dtype)
 
 
 def xyz2rgb(xyz: Tensor):
     """
     input xyz as pytorch tensor of size (batch_size,  h, w, 3) or (h, w,3)
     """
     if len(xyz.shape) == 4:
```

## trident/backend/tensorflow_backend.py

```diff
@@ -3,10062 +3,10027 @@
 00000020: 696d 706f 7274 0d0a 6672 6f6d 205f 5f66  import..from __f
 00000030: 7574 7572 655f 5f20 696d 706f 7274 2064  uture__ import d
 00000040: 6976 6973 696f 6e0d 0a66 726f 6d20 5f5f  ivision..from __
 00000050: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
 00000060: 7072 696e 745f 6675 6e63 7469 6f6e 0d0a  print_function..
 00000070: 0d0a 696d 706f 7274 2062 7569 6c74 696e  ..import builtin
 00000080: 730d 0a69 6d70 6f72 7420 636f 7079 0d0a  s..import copy..
-00000090: 696d 706f 7274 2066 756e 6374 6f6f 6c73  import functools
-000000a0: 0d0a 696d 706f 7274 2067 630d 0a69 6d70  ..import gc..imp
-000000b0: 6f72 7420 696e 7370 6563 740d 0a69 6d70  ort inspect..imp
-000000c0: 6f72 7420 6974 6572 746f 6f6c 730d 0a69  ort itertools..i
-000000d0: 6d70 6f72 7420 6e75 6d62 6572 730d 0a69  mport numbers..i
-000000e0: 6d70 6f72 7420 6f70 6572 6174 6f72 0d0a  mport operator..
-000000f0: 696d 706f 7274 206f 730d 0a69 6d70 6f72  import os..impor
-00000100: 7420 7379 730d 0a69 6d70 6f72 7420 7479  t sys..import ty
-00000110: 7069 6e67 0d0a 696d 706f 7274 2075 7569  ping..import uui
-00000120: 640d 0a69 6d70 6f72 7420 7765 616b 7265  d..import weakre
-00000130: 660d 0a66 726f 6d20 636f 6c6c 6563 7469  f..from collecti
-00000140: 6f6e 7320 696d 706f 7274 2061 6263 0d0a  ons import abc..
-00000150: 6672 6f6d 2063 6f6c 6c65 6374 696f 6e73  from collections
-00000160: 2069 6d70 6f72 7420 6465 6661 756c 7464   import defaultd
-00000170: 6963 742c 206e 616d 6564 7475 706c 650d  ict, namedtuple.
-00000180: 0a66 726f 6d20 6469 7374 7574 696c 732e  .from distutils.
-00000190: 7665 7273 696f 6e20 696d 706f 7274 204c  version import L
-000001a0: 6f6f 7365 5665 7273 696f 6e0d 0a66 726f  ooseVersion..fro
-000001b0: 6d20 6675 6e63 746f 6f6c 7320 696d 706f  m functools impo
-000001c0: 7274 2070 6172 7469 616c 0d0a 6672 6f6d  rt partial..from
-000001d0: 2069 7465 7274 6f6f 6c73 2069 6d70 6f72   itertools impor
-000001e0: 7420 6973 6c69 6365 0d0a 6672 6f6d 2074  t islice..from t
-000001f0: 7970 6573 2069 6d70 6f72 7420 4d65 7468  ypes import Meth
-00000200: 6f64 5479 7065 0d0a 6672 6f6d 2074 7970  odType..from typ
-00000210: 696e 6720 696d 706f 7274 2055 6e69 6f6e  ing import Union
-00000220: 2c20 5475 706c 652c 2041 6e79 2c20 4361  , Tuple, Any, Ca
-00000230: 6c6c 6162 6c65 2c20 4974 6572 6174 6f72  llable, Iterator
-00000240: 2c20 5365 742c 204f 7074 696f 6e61 6c2c  , Set, Optional,
-00000250: 206f 7665 726c 6f61 642c 2054 7970 6556   overload, TypeV
-00000260: 6172 2c20 4d61 7070 696e 672c 2044 6963  ar, Mapping, Dic
-00000270: 742c 204c 6973 742c 205c 0d0a 2020 2020  t, List, \..    
-00000280: 4974 6572 6162 6c65 0d0a 0d0a 696d 706f  Iterable....impo
-00000290: 7274 206e 756d 7079 2061 7320 6e70 0d0a  rt numpy as np..
-000002a0: 696d 706f 7274 2074 656e 736f 7266 6c6f  import tensorflo
-000002b0: 7720 6173 2074 660d 0a0d 0a23 2066 726f  w as tf....# fro
-000002c0: 6d20 7465 6e73 6f72 666c 6f77 2e70 7974  m tensorflow.pyt
-000002d0: 686f 6e20 696d 706f 7274 2065 6e61 626c  hon import enabl
-000002e0: 655f 6561 6765 725f 6578 6563 7574 696f  e_eager_executio
-000002f0: 6e0d 0a0d 0a74 662e 6578 6563 7574 696e  n....tf.executin
-00000300: 675f 6561 6765 726c 7928 290d 0a0d 0a66  g_eagerly()....f
-00000310: 726f 6d20 7465 6e73 6f72 666c 6f77 2e70  rom tensorflow.p
-00000320: 7974 686f 6e2e 6672 616d 6577 6f72 6b20  ython.framework 
-00000330: 696d 706f 7274 206f 7073 0d0a 0d0a 6672  import ops....fr
-00000340: 6f6d 2074 656e 736f 7266 6c6f 772e 7079  om tensorflow.py
-00000350: 7468 6f6e 2e6d 6f64 756c 6520 696d 706f  thon.module impo
-00000360: 7274 206d 6f64 756c 650d 0a66 726f 6d20  rt module..from 
-00000370: 7465 6e73 6f72 666c 6f77 2e70 7974 686f  tensorflow.pytho
-00000380: 6e2e 7574 696c 2069 6d70 6f72 7420 6f62  n.util import ob
-00000390: 6a65 6374 5f69 6465 6e74 6974 790d 0a66  ject_identity..f
-000003a0: 726f 6d20 7472 6964 656e 742e 6261 636b  rom trident.back
-000003b0: 656e 6420 696d 706f 7274 2069 7465 7261  end import itera
-000003c0: 7469 6f6e 5f74 6f6f 6c73 0d0a 6672 6f6d  tion_tools..from
-000003d0: 2074 7269 6465 6e74 2e62 6163 6b65 6e64   trident.backend
-000003e0: 2e63 6f6d 6d6f 6e20 696d 706f 7274 2063  .common import c
-000003f0: 616d 656c 3273 6e61 6b65 2c20 746f 5f6c  amel2snake, to_l
-00000400: 6973 742c 2075 6e70 6163 6b5f 7369 6e67  ist, unpack_sing
-00000410: 6c65 746f 6e2c 2065 6e66 6f72 6365 5f73  leton, enforce_s
-00000420: 696e 676c 6574 6f6e 2c20 4f72 6465 7265  ingleton, Ordere
-00000430: 6444 6963 742c 2053 6967 6e61 7475 7265  dDict, Signature
-00000440: 2c20 5c0d 0a20 2020 2050 7269 6e74 4578  , \..    PrintEx
-00000450: 6365 7074 696f 6e2c 2054 656e 736f 7253  ception, TensorS
-00000460: 6861 7065 2c20 5c0d 0a20 2020 2067 6574  hape, \..    get
-00000470: 5f61 7267 735f 7370 6563 2c20 6973 5f69  _args_spec, is_i
-00000480: 6e73 7461 6e63 650d 0a66 726f 6d20 7472  nstance..from tr
-00000490: 6964 656e 742e 6261 636b 656e 642e 7465  ident.backend.te
-000004a0: 6e73 6f72 666c 6f77 5f6f 7073 2069 6d70  nsorflow_ops imp
-000004b0: 6f72 7420 2a0d 0a66 726f 6d20 7472 6964  ort *..from trid
-000004c0: 656e 742e 6261 636b 656e 6420 696d 706f  ent.backend impo
-000004d0: 7274 2074 656e 736f 7266 6c6f 775f 6f70  rt tensorflow_op
-000004e0: 7320 6173 2074 6f70 730d 0a66 726f 6d20  s as tops..from 
-000004f0: 7472 6964 656e 742e 6261 636b 656e 6420  trident.backend 
-00000500: 696d 706f 7274 2064 7479 7065 2061 7320  import dtype as 
-00000510: 4474 7970 650d 0a0d 0a5f 4655 4e5f 4e41  Dtype...._FUN_NA
-00000520: 4d45 5320 3d20 5b0d 0a20 2020 2028 2766  MES = [..    ('f
-00000530: 6c6f 6174 272c 2074 6f70 732e 666c 6f61  loat', tops.floa
-00000540: 7429 2c0d 0a20 2020 2028 276c 6f6e 6727  t),..    ('long'
-00000550: 2c20 746f 7073 2e6c 6f6e 6729 2c0d 0a20  , tops.long),.. 
-00000560: 2020 2028 2765 7175 616c 272c 2074 6f70     ('equal', top
-00000570: 732e 6571 7561 6c29 2c0d 0a20 2020 2028  s.equal),..    (
-00000580: 2769 6e74 272c 2074 6f70 732e 696e 7429  'int', tops.int)
-00000590: 2c0d 0a20 2020 2028 2774 6f27 2c20 746f  ,..    ('to', to
-000005a0: 7073 2e74 6f29 5d0d 0a66 6f72 2074 6172  ps.to)]..for tar
-000005b0: 6765 745f 6675 6e5f 6e61 6d65 2c20 736f  get_fun_name, so
-000005c0: 7572 6365 5f66 756e 2069 6e20 5f46 554e  urce_fun in _FUN
-000005d0: 5f4e 414d 4553 3a0d 0a20 2020 2073 6574  _NAMES:..    set
-000005e0: 6174 7472 2854 656e 736f 722c 2074 6172  attr(Tensor, tar
-000005f0: 6765 745f 6675 6e5f 6e61 6d65 2c20 736f  get_fun_name, so
-00000600: 7572 6365 5f66 756e 290d 0a0d 0a66 726f  urce_fun)....fro
-00000610: 6d20 7472 6964 656e 742e 6261 636b 656e  m trident.backen
-00000620: 642e 7465 6e73 6f72 7370 6563 2069 6d70  d.tensorspec imp
-00000630: 6f72 7420 2a0d 0a66 726f 6d20 7472 6964  ort *..from trid
-00000640: 656e 742e 6461 7461 2e75 7469 6c73 2069  ent.data.utils i
-00000650: 6d70 6f72 7420 7069 636b 6c65 5f69 740d  mport pickle_it.
-00000660: 0a66 726f 6d20 7472 6964 656e 742e 6261  .from trident.ba
-00000670: 636b 656e 6420 696d 706f 7274 2074 656e  ckend import ten
-00000680: 736f 7266 6c6f 775f 7365 7269 616c 697a  sorflow_serializ
-00000690: 6174 696f 6e20 6173 2073 6572 6961 6c69  ation as seriali
-000006a0: 7a61 7469 6f6e 0d0a 6672 6f6d 2074 7269  zation..from tri
-000006b0: 6465 6e74 2069 6d70 6f72 7420 636f 6e74  dent import cont
-000006c0: 6578 740d 0a0d 0a5f 5f61 6c6c 5f5f 203d  ext....__all__ =
-000006d0: 205b 2773 6574 5f64 6576 6963 6527 2c20   ['set_device', 
-000006e0: 2744 5459 5045 5f4d 4150 5049 4e47 272c  'DTYPE_MAPPING',
-000006f0: 2027 4c61 7965 7227 2c20 2767 6574 5f64   'Layer', 'get_d
-00000700: 6576 6963 6527 2c20 2750 6172 616d 6574  evice', 'Paramet
-00000710: 6572 272c 2027 5365 7175 656e 7469 616c  er', 'Sequential
-00000720: 272c 2027 4d6f 6475 6c65 4c69 7374 272c  ', 'ModuleList',
-00000730: 2027 4d6f 6475 6c65 4469 6374 272c 0d0a   'ModuleDict',..
-00000740: 2020 2020 2020 2020 2020 2027 7375 6d6d             'summ
-00000750: 6172 7927 2c20 276e 6f72 6d61 6c69 7a65  ary', 'normalize
-00000760: 5f70 6164 6469 6e67 272c 2027 6c6f 6164  _padding', 'load
-00000770: 272c 2027 7361 7665 272c 2027 7472 795f  ', 'save', 'try_
-00000780: 6d61 705f 6172 6773 5f61 6e64 5f63 616c  map_args_and_cal
-00000790: 6c27 2c0d 0a20 2020 2020 2020 2020 2020  l',..           
-000007a0: 2766 6978 5f6c 6179 6572 272c 2027 6669  'fix_layer', 'fi
-000007b0: 785f 6b65 7261 735f 6d6f 6475 6c65 275d  x_keras_module']
-000007c0: 0d0a 0d0a 6374 7820 3d20 636f 6e74 6578  ....ctx = contex
-000007d0: 742e 5f63 6f6e 7465 7874 2829 0d0a 0d0a  t._context()....
-000007e0: 4454 5950 455f 4d41 5050 494e 4720 3d20  DTYPE_MAPPING = 
-000007f0: 7b0d 0a20 2020 2074 662e 626f 6f6c 3a20  {..    tf.bool: 
-00000800: 4474 7970 652e 626f 6f6c 2c0d 0a20 2020  Dtype.bool,..   
-00000810: 2074 662e 696e 7438 3a20 4474 7970 652e   tf.int8: Dtype.
-00000820: 696e 7438 2c0d 0a20 2020 2074 662e 696e  int8,..    tf.in
-00000830: 7431 363a 2044 7479 7065 2e69 6e74 3136  t16: Dtype.int16
-00000840: 2c0d 0a20 2020 2074 662e 696e 7433 323a  ,..    tf.int32:
-00000850: 2044 7479 7065 2e69 6e74 3332 2c0d 0a20   Dtype.int32,.. 
-00000860: 2020 2074 662e 696e 7436 343a 2044 7479     tf.int64: Dty
-00000870: 7065 2e69 6e74 3634 2c0d 0a20 2020 2074  pe.int64,..    t
-00000880: 662e 7569 6e74 383a 2044 7479 7065 2e75  f.uint8: Dtype.u
-00000890: 696e 7438 2c0d 0a20 2020 2074 662e 666c  int8,..    tf.fl
-000008a0: 6f61 7431 363a 2044 7479 7065 2e66 6c6f  oat16: Dtype.flo
-000008b0: 6174 3136 2c0d 0a20 2020 2074 662e 666c  at16,..    tf.fl
-000008c0: 6f61 7433 323a 2044 7479 7065 2e66 6c6f  oat32: Dtype.flo
-000008d0: 6174 3332 2c0d 0a20 2020 2074 662e 666c  at32,..    tf.fl
-000008e0: 6f61 7436 343a 2044 7479 7065 2e66 6c6f  oat64: Dtype.flo
-000008f0: 6174 3634 2c0d 0a20 2020 2074 662e 636f  at64,..    tf.co
-00000900: 6d70 6c65 7836 343a 2044 7479 7065 2e63  mplex64: Dtype.c
-00000910: 6f6d 706c 6578 3634 2c0d 0a20 2020 2074  omplex64,..    t
-00000920: 662e 636f 6d70 6c65 7831 3238 3a20 4474  f.complex128: Dt
-00000930: 7970 652e 636f 6d70 6c65 7831 3238 2c0d  ype.complex128,.
-00000940: 0a0d 0a7d 0d0a 0d0a 0d0a 6465 6620 6765  ...}......def ge
-00000950: 745f 6465 7669 6365 2829 3a0d 0a20 2020  t_device():..   
-00000960: 2022 2222 6765 7420 6375 7272 656e 7420   """get current 
-00000970: 6465 7669 6365 0d0a 0d0a 2020 2020 5265  device....    Re
-00000980: 7475 726e 733a 2064 6576 6963 6520 7374  turns: device st
-00000990: 7269 6e67 2028 2763 7075 272c 2027 6375  ring ('cpu', 'cu
-000009a0: 6461 290d 0a0d 0a20 2020 2022 2222 0d0a  da)....    """..
-000009b0: 2020 2020 6966 2063 7478 2e64 6576 6963      if ctx.devic
-000009c0: 6520 6973 204e 6f6e 6520 6f72 2063 7478  e is None or ctx
-000009d0: 2e64 6576 6963 6520 3d3d 2027 6375 6461  .device == 'cuda
-000009e0: 273a 0d0a 2020 2020 2020 2020 7365 745f  ':..        set_
-000009f0: 6465 7669 6365 2827 2f67 7075 3a30 2720  device('/gpu:0' 
-00000a00: 6966 206c 656e 2874 662e 636f 6e66 6967  if len(tf.config
-00000a10: 2e6c 6973 745f 7068 7973 6963 616c 5f64  .list_physical_d
-00000a20: 6576 6963 6573 2827 4750 5527 2929 203e  evices('GPU')) >
-00000a30: 2030 2065 6c73 6520 222f 6370 753a 3022   0 else "/cpu:0"
-00000a40: 290d 0a20 2020 2072 6574 7572 6e20 6374  )..    return ct
-00000a50: 782e 6465 7669 6365 0d0a 0d0a 0d0a 6465  x.device......de
-00000a60: 6620 7365 745f 6465 7669 6365 2864 6576  f set_device(dev
-00000a70: 6963 653d 272f 6370 753a 3027 293a 0d0a  ice='/cpu:0'):..
-00000a80: 2020 2020 6966 2064 6576 6963 652e 6c6f      if device.lo
-00000a90: 7765 7228 2920 3d3d 2027 6375 6461 2720  wer() == 'cuda' 
-00000aa0: 6f72 2064 6576 6963 652e 6c6f 7765 7228  or device.lower(
-00000ab0: 2920 3d3d 2027 6770 7527 3a0d 0a20 2020  ) == 'gpu':..   
-00000ac0: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-00000ad0: 2243 5544 415f 4445 5649 4345 5f4f 5244  "CUDA_DEVICE_ORD
-00000ae0: 4552 225d 203d 2022 5043 495f 4255 535f  ER"] = "PCI_BUS_
-00000af0: 4944 2220 2023 2073 6565 2069 7373 7565  ID"  # see issue
-00000b00: 2023 3135 320d 0a20 2020 2020 2020 206f   #152..        o
-00000b10: 732e 656e 7669 726f 6e5b 2243 5544 415f  s.environ["CUDA_
-00000b20: 5649 5349 424c 455f 4445 5649 4345 5322  VISIBLE_DEVICES"
-00000b30: 5d20 3d20 2730 270d 0a20 2020 2020 2020  ] = '0'..       
-00000b40: 2063 7478 2e64 6576 6963 6520 3d20 272f   ctx.device = '/
-00000b50: 6770 753a 3027 0d0a 2020 2020 6966 2064  gpu:0'..    if d
-00000b60: 6576 6963 652e 6c6f 7765 7228 2920 3d3d  evice.lower() ==
-00000b70: 2027 6370 7527 3a0d 0a20 2020 2020 2020   'cpu':..       
-00000b80: 206f 732e 656e 7669 726f 6e2e 706f 7028   os.environ.pop(
-00000b90: 2243 5544 415f 5649 5349 424c 455f 4445  "CUDA_VISIBLE_DE
-00000ba0: 5649 4345 5322 290d 0a20 2020 2020 2020  VICES")..       
-00000bb0: 2063 7478 2e64 6576 6963 6520 3d20 272f   ctx.device = '/
-00000bc0: 6370 753a 3027 0d0a 2020 2020 6966 2027  cpu:0'..    if '
-00000bd0: 6770 7527 2069 6e20 6465 7669 6365 2061  gpu' in device a
-00000be0: 6e64 206c 656e 2874 662e 636f 6e66 6967  nd len(tf.config
-00000bf0: 2e6c 6973 745f 7068 7973 6963 616c 5f64  .list_physical_d
-00000c00: 6576 6963 6573 2827 4750 5527 2929 203d  evices('GPU')) =
-00000c10: 3d20 303a 0d0a 2020 2020 2020 2020 7261  = 0:..        ra
-00000c20: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-00000c30: 4770 7520 6973 206e 6f74 2061 7661 696c  Gpu is not avail
-00000c40: 6162 6c65 2e2e 2e27 290d 0a20 2020 2074  able...')..    t
-00000c50: 7279 3a0d 0a0d 0a20 2020 2020 2020 2067  ry:....        g
-00000c60: 6369 7465 6d73 203d 2067 632e 6765 745f  citems = gc.get_
-00000c70: 6f62 6a65 6374 7328 290d 0a20 2020 2020  objects()..     
-00000c80: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00000c90: 6528 6c65 6e28 6763 6974 656d 7329 293a  e(len(gcitems)):
-00000ca0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-00000cb0: 656d 203d 2067 6369 7465 6d73 5b69 5d0d  em = gcitems[i].
-00000cc0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00000cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00000ce0: 2020 2069 6620 6e6f 7420 696e 7370 6563     if not inspec
-00000cf0: 742e 6973 636c 6173 7328 6974 656d 2920  t.isclass(item) 
-00000d00: 616e 6420 6973 5f74 656e 736f 7228 6974  and is_tensor(it
-00000d10: 656d 293a 0d0a 2020 2020 2020 2020 2020  em):..          
-00000d20: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-00000d30: 662e 6465 7669 6365 2863 7478 2e64 6576  f.device(ctx.dev
-00000d40: 6963 6529 3a0d 0a20 2020 2020 2020 2020  ice):..         
-00000d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00000d60: 7465 6d20 3d20 7466 2e69 6465 6e74 6974  tem = tf.identit
-00000d70: 7928 6974 656d 290d 0a20 2020 2020 2020  y(item)..       
-00000d80: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
-00000d90: 7420 696e 7370 6563 742e 6973 636c 6173  t inspect.isclas
-00000da0: 7328 6974 656d 2920 616e 6420 6973 5f69  s(item) and is_i
-00000db0: 6e73 7461 6e63 6528 6974 656d 2c20 2774  nstance(item, 't
-00000dc0: 7269 6465 6e74 2e62 6163 6b65 6e64 2e74  rident.backend.t
-00000dd0: 656e 736f 7266 6c6f 775f 6261 636b 656e  ensorflow_backen
-00000de0: 642e 4c61 7965 7227 293a 0d0a 2020 2020  d.Layer'):..    
-00000df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e00: 6974 656d 2e74 6f28 6465 7669 6365 290d  item.to(device).
-00000e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000e20: 2065 6c69 6620 6e6f 7420 696e 7370 6563   elif not inspec
-00000e30: 742e 6973 636c 6173 7328 6974 656d 2920  t.isclass(item) 
-00000e40: 616e 6420 6973 5f69 6e73 7461 6e63 6528  and is_instance(
-00000e50: 6974 656d 2c20 274c 6179 6572 2729 3a0d  item, 'Layer'):.
-00000e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000e70: 2020 2020 2077 6974 6820 7466 2e64 6576       with tf.dev
-00000e80: 6963 6528 6374 782e 6465 7669 6365 293a  ice(ctx.device):
-00000e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00000ea0: 2020 2020 2020 2020 2020 6974 656d 203d            item =
-00000eb0: 2074 662e 6964 656e 7469 7479 2869 7465   tf.identity(ite
-00000ec0: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
-00000ed0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00000ee0: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-00000ef0: 2020 2020 2020 2020 7072 696e 7428 6529          print(e)
-00000f00: 0d0a 0d0a 2020 2020 6578 6365 7074 2045  ....    except E
-00000f10: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
-00000f20: 2020 2020 2020 2020 7072 696e 7428 6529          print(e)
-00000f30: 0d0a 0d0a 0d0a 7665 7273 696f 6e20 3d20  ......version = 
-00000f40: 7466 2e76 6572 7369 6f6e 0d0a 7379 732e  tf.version..sys.
-00000f50: 7374 646f 7574 2e77 7269 7465 2827 5465  stdout.write('Te
-00000f60: 6e73 6f72 666c 6f77 2076 6572 7369 6f6e  nsorflow version
-00000f70: 3a7b 307d 2e5c 6e27 2e66 6f72 6d61 7428  :{0}.\n'.format(
-00000f80: 7665 7273 696f 6e2e 5645 5253 494f 4e29  version.VERSION)
-00000f90: 290d 0a0d 0a74 665f 7665 7273 696f 6e20  )....tf_version 
-00000fa0: 3d20 4c6f 6f73 6556 6572 7369 6f6e 2876  = LooseVersion(v
-00000fb0: 7374 7269 6e67 3d76 6572 7369 6f6e 2e56  string=version.V
-00000fc0: 4552 5349 4f4e 290d 0a62 6173 655f 7665  ERSION)..base_ve
-00000fd0: 7273 696f 6e20 3d20 4c6f 6f73 6556 6572  rsion = LooseVer
-00000fe0: 7369 6f6e 2876 7374 7269 6e67 3d27 322e  sion(vstring='2.
-00000ff0: 322e 302d 7263 3027 290d 0a0d 0a69 6620  2.0-rc0')....if 
-00001000: 7466 5f76 6572 7369 6f6e 2e76 6572 7369  tf_version.versi
-00001010: 6f6e 203c 2062 6173 655f 7665 7273 696f  on < base_versio
-00001020: 6e2e 7665 7273 696f 6e3a 0d0a 2020 2020  n.version:..    
-00001030: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00001040: 2827 7472 6964 656e 7420 6f6e 6c79 2073  ('trident only s
-00001050: 7570 706f 7274 2054 656e 736f 7266 6c6f  upport Tensorflo
-00001060: 7720 322e 322e 302d 7263 3020 6f72 206e  w 2.2.0-rc0 or n
-00001070: 6577 6572 2e5c 6e27 290d 0a0d 0a74 7279  ewer.\n')....try
-00001080: 3a0d 0a0d 0a20 2020 2074 662e 6578 6563  :....    tf.exec
-00001090: 7574 696e 675f 6561 6765 726c 7928 290d  uting_eagerly().
-000010a0: 0a20 2020 2073 7973 2e73 7464 6f75 742e  .    sys.stdout.
-000010b0: 7772 6974 6528 2765 7865 6375 7469 6e67  write('executing
-000010c0: 5f65 6167 6572 6c79 5c6e 2729 0d0a 6578  _eagerly\n')..ex
-000010d0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-000010e0: 7320 653a 0d0a 2020 2020 7379 732e 7374  s e:..    sys.st
-000010f0: 646f 7574 2e77 7269 7465 2827 6578 6563  dout.write('exec
-00001100: 7574 696e 675f 6561 6765 726c 7920 6661  uting_eagerly fa
-00001110: 696c 2e20 7b30 7d5c 6e27 2e66 6f72 6d61  il. {0}\n'.forma
-00001120: 7428 6529 290d 0a0d 0a73 7973 2e73 7464  t(e))....sys.std
-00001130: 6f75 742e 7772 6974 6528 2775 7365 2064  out.write('use d
-00001140: 6576 6963 653a 7b30 7d2e 5c6e 272e 666f  evice:{0}.\n'.fo
-00001150: 726d 6174 2867 6574 5f64 6576 6963 6528  rmat(get_device(
-00001160: 2929 290d 0a0d 0a0d 0a64 6566 206c 6f61  )))......def loa
-00001170: 6428 7061 7468 293a 0d0a 2020 2020 2222  d(path):..    ""
-00001180: 226c 6f61 6420 6d6f 6465 6c20 6672 6f6d  "load model from
-00001190: 202a 2e70 7468 206f 7220 2a2e 7074 682e   *.pth or *.pth.
-000011a0: 7461 720d 0a0d 0a20 2020 2041 7267 733a  tar....    Args:
-000011b0: 0d0a 2020 2020 2020 2020 7061 7468 2028  ..        path (
-000011c0: 7374 7229 3a0d 0a0d 0a20 2020 2052 6574  str):....    Ret
-000011d0: 7572 6e73 3a0d 0a0d 0a20 2020 2022 2222  urns:....    """
-000011e0: 0d0a 2020 2020 7769 7468 2074 662e 6465  ..    with tf.de
-000011f0: 7669 6365 2867 6574 5f64 6576 6963 6528  vice(get_device(
-00001200: 2929 3a0d 0a20 2020 2020 2020 2069 6620  )):..        if 
-00001210: 272e 7461 7227 2069 6e20 7061 7468 3a0d  '.tar' in path:.
-00001220: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00001230: 7572 6e20 7365 7269 616c 697a 6174 696f  urn serializatio
-00001240: 6e2e 6c6f 6164 5f70 7468 7461 7228 7061  n.load_pthtar(pa
-00001250: 7468 290d 0a20 2020 2020 2020 2065 6c73  th)..        els
-00001260: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00001270: 7265 7475 726e 2073 6572 6961 6c69 7a61  return serializa
-00001280: 7469 6f6e 2e6c 6f61 6428 7061 7468 290d  tion.load(path).
-00001290: 0a0d 0a0d 0a64 6566 2073 6176 6528 6f62  .....def save(ob
-000012a0: 6a2c 2070 6174 682c 2069 735f 636f 6d70  j, path, is_comp
-000012b0: 7265 7373 6564 3d46 616c 7365 293a 0d0a  ressed=False):..
-000012c0: 2020 2020 7365 7269 616c 697a 6174 696f      serializatio
-000012d0: 6e2e 7361 7665 286f 626a 2c20 7061 7468  n.save(obj, path
-000012e0: 2c20 6973 5f63 6f6d 7072 6573 7365 643d  , is_compressed=
-000012f0: 6973 5f63 6f6d 7072 6573 7365 6429 0d0a  is_compressed)..
-00001300: 2020 2020 7265 7475 726e 2054 7275 650d      return True.
-00001310: 0a0d 0a0d 0a63 6c61 7373 2052 656d 6f76  .....class Remov
-00001320: 6162 6c65 4861 6e64 6c65 286f 626a 6563  ableHandle(objec
-00001330: 7429 3a0d 0a20 2020 2072 2222 220d 0a20  t):..    r""".. 
-00001340: 2020 2041 2068 616e 646c 6520 7768 6963     A handle whic
-00001350: 6820 7072 6f76 6964 6573 2074 6865 2063  h provides the c
-00001360: 6170 6162 696c 6974 7920 746f 2072 656d  apability to rem
-00001370: 6f76 6520 6120 686f 6f6b 2e0d 0a0d 0a20  ove a hook..... 
-00001380: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-00001390: 2020 686f 6f6b 735f 6469 6374 2028 6469    hooks_dict (di
-000013a0: 6374 293a 2041 2064 6963 7469 6f6e 6172  ct): A dictionar
-000013b0: 7920 6f66 2068 6f6f 6b73 2c20 696e 6465  y of hooks, inde
-000013c0: 7865 6420 6279 2068 6f6f 6b20 6060 6964  xed by hook ``id
-000013d0: 6060 2e0d 0a20 2020 2020 2020 2065 7874  ``...        ext
-000013e0: 7261 5f64 6963 7420 2864 6963 7429 3a20  ra_dict (dict): 
-000013f0: 416e 2061 6464 6974 696f 6e61 6c20 6469  An additional di
-00001400: 6374 696f 6e61 7279 2077 686f 7365 206b  ctionary whose k
-00001410: 6579 7320 7769 6c6c 2062 6520 6465 6c65  eys will be dele
-00001420: 7465 640d 0a20 2020 2020 2020 2020 2020  ted..           
-00001430: 2077 6865 6e20 7468 6520 7361 6d65 206b   when the same k
-00001440: 6579 7320 6172 6520 7265 6d6f 7665 6420  eys are removed 
-00001450: 6672 6f6d 2060 6068 6f6f 6b73 5f64 6963  from ``hooks_dic
-00001460: 7460 602e 0d0a 2020 2020 2222 220d 0a0d  t``...    """...
-00001470: 0a20 2020 2069 643a 2069 6e74 0d0a 2020  .    id: int..  
-00001480: 2020 6e65 7874 5f69 643a 2069 6e74 203d    next_id: int =
-00001490: 2030 0d0a 0d0a 2020 2020 6465 6620 5f5f   0....    def __
-000014a0: 696e 6974 5f5f 2873 656c 662c 2068 6f6f  init__(self, hoo
-000014b0: 6b73 5f64 6963 743a 2041 6e79 2c20 2a2c  ks_dict: Any, *,
-000014c0: 2065 7874 7261 5f64 6963 743a 2041 6e79   extra_dict: Any
-000014d0: 203d 204e 6f6e 6529 202d 3e20 4e6f 6e65   = None) -> None
-000014e0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-000014f0: 686f 6f6b 735f 6469 6374 5f72 6566 203d  hooks_dict_ref =
-00001500: 2077 6561 6b72 6566 2e72 6566 2868 6f6f   weakref.ref(hoo
-00001510: 6b73 5f64 6963 7429 0d0a 2020 2020 2020  ks_dict)..      
-00001520: 2020 7365 6c66 2e69 6420 3d20 5265 6d6f    self.id = Remo
-00001530: 7661 626c 6548 616e 646c 652e 6e65 7874  vableHandle.next
-00001540: 5f69 640d 0a20 2020 2020 2020 2052 656d  _id..        Rem
-00001550: 6f76 6162 6c65 4861 6e64 6c65 2e6e 6578  ovableHandle.nex
-00001560: 745f 6964 202b 3d20 310d 0a0d 0a20 2020  t_id += 1....   
-00001570: 2020 2020 2073 656c 662e 6578 7472 615f       self.extra_
-00001580: 6469 6374 5f72 6566 203d 2028 0d0a 2020  dict_ref = (..  
-00001590: 2020 2020 2020 2020 2020 7765 616b 7265            weakre
-000015a0: 662e 7265 6628 6578 7472 615f 6469 6374  f.ref(extra_dict
-000015b0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000015c0: 6620 6578 7472 615f 6469 6374 2069 7320  f extra_dict is 
-000015d0: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
-000015e0: 2020 2020 2020 656c 7365 204e 6f6e 650d        else None.
-000015f0: 0a20 2020 2020 2020 2029 0d0a 0d0a 2020  .        )....  
-00001600: 2020 6465 6620 7265 6d6f 7665 2873 656c    def remove(sel
-00001610: 6629 202d 3e20 4e6f 6e65 3a0d 0a20 2020  f) -> None:..   
-00001620: 2020 2020 2068 6f6f 6b73 5f64 6963 7420       hooks_dict 
-00001630: 3d20 7365 6c66 2e68 6f6f 6b73 5f64 6963  = self.hooks_dic
-00001640: 745f 7265 6628 290d 0a20 2020 2020 2020  t_ref()..       
-00001650: 2069 6620 686f 6f6b 735f 6469 6374 2069   if hooks_dict i
-00001660: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
-00001670: 656c 662e 6964 2069 6e20 686f 6f6b 735f  elf.id in hooks_
-00001680: 6469 6374 3a0d 0a20 2020 2020 2020 2020  dict:..         
-00001690: 2020 2064 656c 2068 6f6f 6b73 5f64 6963     del hooks_dic
-000016a0: 745b 7365 6c66 2e69 645d 0d0a 0d0a 2020  t[self.id]....  
-000016b0: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-000016c0: 7472 615f 6469 6374 5f72 6566 2069 7320  tra_dict_ref is 
-000016d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000016e0: 2020 2020 2020 2065 7874 7261 5f64 6963         extra_dic
-000016f0: 7420 3d20 7365 6c66 2e65 7874 7261 5f64  t = self.extra_d
-00001700: 6963 745f 7265 6628 290d 0a20 2020 2020  ict_ref()..     
-00001710: 2020 2020 2020 2069 6620 6578 7472 615f         if extra_
-00001720: 6469 6374 2069 7320 6e6f 7420 4e6f 6e65  dict is not None
-00001730: 2061 6e64 2073 656c 662e 6964 2069 6e20   and self.id in 
-00001740: 6578 7472 615f 6469 6374 3a0d 0a20 2020  extra_dict:..   
-00001750: 2020 2020 2020 2020 2020 2020 2064 656c               del
-00001760: 2065 7874 7261 5f64 6963 745b 7365 6c66   extra_dict[self
-00001770: 2e69 645d 0d0a 0d0a 2020 2020 6465 6620  .id]....    def 
-00001780: 5f5f 6765 7473 7461 7465 5f5f 2873 656c  __getstate__(sel
-00001790: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-000017a0: 7572 6e20 280d 0a20 2020 2020 2020 2020  urn (..         
-000017b0: 2020 2028 7365 6c66 2e68 6f6f 6b73 5f64     (self.hooks_d
-000017c0: 6963 745f 7265 6628 292c 2073 656c 662e  ict_ref(), self.
-000017d0: 6964 290d 0a20 2020 2020 2020 2020 2020  id)..           
-000017e0: 2069 6620 7365 6c66 2e65 7874 7261 5f64   if self.extra_d
-000017f0: 6963 745f 7265 6620 6973 204e 6f6e 650d  ict_ref is None.
-00001800: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00001810: 6520 2873 656c 662e 686f 6f6b 735f 6469  e (self.hooks_di
-00001820: 6374 5f72 6566 2829 2c20 7365 6c66 2e69  ct_ref(), self.i
-00001830: 642c 2073 656c 662e 6578 7472 615f 6469  d, self.extra_di
-00001840: 6374 5f72 6566 2829 290d 0a20 2020 2020  ct_ref())..     
-00001850: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
-00001860: 5f5f 7365 7473 7461 7465 5f5f 2873 656c  __setstate__(sel
-00001870: 662c 2073 7461 7465 2920 2d3e 204e 6f6e  f, state) -> Non
-00001880: 653a 0d0a 2020 2020 2020 2020 6966 2073  e:..        if s
-00001890: 7461 7465 5b30 5d20 6973 204e 6f6e 653a  tate[0] is None:
-000018a0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000018b0: 6372 6561 7465 2061 2064 6561 6420 7265  create a dead re
-000018c0: 6665 7265 6e63 650d 0a20 2020 2020 2020  ference..       
-000018d0: 2020 2020 2073 656c 662e 686f 6f6b 735f       self.hooks_
-000018e0: 6469 6374 5f72 6566 203d 2077 6561 6b72  dict_ref = weakr
-000018f0: 6566 2e72 6566 284f 7264 6572 6564 4469  ef.ref(OrderedDi
-00001900: 6374 2829 290d 0a20 2020 2020 2020 2065  ct())..        e
-00001910: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00001920: 2020 7365 6c66 2e68 6f6f 6b73 5f64 6963    self.hooks_dic
-00001930: 745f 7265 6620 3d20 7765 616b 7265 662e  t_ref = weakref.
-00001940: 7265 6628 7374 6174 655b 305d 290d 0a20  ref(state[0]).. 
-00001950: 2020 2020 2020 2073 656c 662e 6964 203d         self.id =
-00001960: 2073 7461 7465 5b31 5d0d 0a20 2020 2020   state[1]..     
-00001970: 2020 2052 656d 6f76 6162 6c65 4861 6e64     RemovableHand
-00001980: 6c65 2e6e 6578 745f 6964 203d 206d 6178  le.next_id = max
-00001990: 2852 656d 6f76 6162 6c65 4861 6e64 6c65  (RemovableHandle
-000019a0: 2e6e 6578 745f 6964 2c20 7365 6c66 2e69  .next_id, self.i
-000019b0: 6420 2b20 3129 0d0a 0d0a 2020 2020 2020  d + 1)....      
-000019c0: 2020 7365 6c66 2e65 7874 7261 5f64 6963    self.extra_dic
-000019d0: 745f 7265 6620 3d20 280d 0a20 2020 2020  t_ref = (..     
-000019e0: 2020 2020 2020 204e 6f6e 650d 0a20 2020         None..   
-000019f0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00001a00: 7374 6174 6529 203c 2033 0d0a 2020 2020  state) < 3..    
-00001a10: 2020 2020 2020 2020 656c 7365 2077 6561          else wea
-00001a20: 6b72 6566 2e72 6566 284f 7264 6572 6564  kref.ref(Ordered
-00001a30: 4469 6374 2829 2069 6620 7374 6174 655b  Dict() if state[
-00001a40: 325d 2069 7320 4e6f 6e65 2065 6c73 6520  2] is None else 
-00001a50: 7374 6174 655b 325d 290d 0a20 2020 2020  state[2])..     
-00001a60: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
-00001a70: 5f5f 656e 7465 725f 5f28 7365 6c66 2920  __enter__(self) 
-00001a80: 2d3e 2022 5265 6d6f 7661 626c 6548 616e  -> "RemovableHan
-00001a90: 646c 6522 3a0d 0a20 2020 2020 2020 2072  dle":..        r
-00001aa0: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
-00001ab0: 2020 6465 6620 5f5f 6578 6974 5f5f 2873    def __exit__(s
-00001ac0: 656c 662c 2074 7970 653a 2041 6e79 2c20  elf, type: Any, 
-00001ad0: 7661 6c75 653a 2041 6e79 2c20 7462 3a20  value: Any, tb: 
-00001ae0: 416e 7929 202d 3e20 4e6f 6e65 3a0d 0a20  Any) -> None:.. 
-00001af0: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00001b00: 7665 2829 0d0a 0d0a 0d0a 6465 6620 5f69  ve()......def _i
-00001b10: 735f 6e6f 745f 7472 6169 6e61 626c 655f  s_not_trainable_
-00001b20: 7661 7269 6162 6c65 286f 626a 293a 0d0a  variable(obj):..
-00001b30: 2020 2020 7265 7475 726e 206d 6f64 756c      return modul
-00001b40: 652e 5f69 735f 7661 7269 6162 6c65 286f  e._is_variable(o
-00001b50: 626a 2920 616e 6420 6e6f 7420 6765 7461  bj) and not geta
-00001b60: 7474 7228 6f62 6a2c 2022 7472 6169 6e61  ttr(obj, "traina
-00001b70: 626c 6522 2c20 4661 6c73 6529 0d0a 0d0a  ble", False)....
-00001b80: 0d0a 2320 5468 6520 696e 7465 726e 616c  ..# The internal
-00001b90: 2067 7261 7068 206d 6169 6e74 6169 6e65   graph maintaine
-00001ba0: 6420 6279 204b 6572 6173 2061 6e64 2075  d by Keras and u
-00001bb0: 7365 6420 6279 2074 6865 2073 796d 626f  sed by the symbo
-00001bc0: 6c69 6320 4b65 7261 7320 4150 4973 0d0a  lic Keras APIs..
-00001bd0: 2320 7768 696c 6520 6578 6563 7574 696e  # while executin
-00001be0: 6720 6561 6765 726c 7920 2873 7563 6820  g eagerly (such 
-00001bf0: 6173 2074 6865 2066 756e 6374 696f 6e61  as the functiona
-00001c00: 6c20 4150 4920 666f 7220 6d6f 6465 6c2d  l API for model-
-00001c10: 6275 696c 6469 6e67 292e 0d0a 2320 5468  building)...# Th
-00001c20: 6973 2069 7320 7468 7265 6164 2d6c 6f63  is is thread-loc
-00001c30: 616c 2074 6f20 616c 6c6f 7720 6275 696c  al to allow buil
-00001c40: 6469 6e67 2073 6570 6172 6174 6520 6d6f  ding separate mo
-00001c50: 6465 6c73 2069 6e20 6469 6666 6572 656e  dels in differen
-00001c60: 7420 7468 7265 6164 730d 0a23 2063 6f6e  t threads..# con
-00001c70: 6375 7272 656e 746c 792c 2062 7574 2063  currently, but c
-00001c80: 6f6d 6573 2061 7420 7468 6520 636f 7374  omes at the cost
-00001c90: 206f 6620 6e6f 7420 6265 696e 6720 6162   of not being ab
-00001ca0: 6c65 2074 6f20 6275 696c 6420 6f6e 6520  le to build one 
-00001cb0: 6d6f 6465 6c0d 0a23 2061 6372 6f73 7320  model..# across 
-00001cc0: 7468 7265 6164 732e 0d0a 0d0a 0d0a 2320  threads.......# 
-00001cd0: 4120 676c 6f62 616c 2064 6963 7469 6f6e  A global diction
-00001ce0: 6172 7920 6d61 7070 696e 6720 6772 6170  ary mapping grap
-00001cf0: 6820 6f62 6a65 6374 7320 746f 2061 6e20  h objects to an 
-00001d00: 696e 6465 7820 6f66 2063 6f75 6e74 6572  index of counter
-00001d10: 7320 7573 6564 0d0a 2320 666f 7220 7661  s used..# for va
-00001d20: 7269 6f75 7320 6c61 7965 722f 6f70 7469  rious layer/opti
-00001d30: 6d69 7a65 7220 6e61 6d65 7320 696e 2065  mizer names in e
-00001d40: 6163 6820 6772 6170 682e 0d0a 2320 416c  ach graph...# Al
-00001d50: 6c6f 7773 2074 6f20 6769 7665 2075 6e69  lows to give uni
-00001d60: 7175 6520 6175 746f 6765 6e65 7261 7465  que autogenerate
-00001d70: 6420 6e61 6d65 7320 746f 206c 6179 6572  d names to layer
-00001d80: 732c 2069 6e20 6120 6772 6170 682d 7370  s, in a graph-sp
-00001d90: 6563 6966 6963 2077 6179 2e0d 0a50 4552  ecific way...PER
-00001da0: 5f47 5241 5048 5f4f 424a 4543 545f 4e41  _GRAPH_OBJECT_NA
-00001db0: 4d45 5f55 4944 5320 3d20 7765 616b 7265  ME_UIDS = weakre
-00001dc0: 662e 5765 616b 4b65 7944 6963 7469 6f6e  f.WeakKeyDiction
-00001dd0: 6172 7928 290d 0a0d 0a0d 0a64 6566 2072  ary()......def r
-00001de0: 6573 6574 5f6e 616d 6528 6d6f 6475 6c65  eset_name(module
-00001df0: 3a20 7466 2e4d 6f64 756c 652c 2070 7265  : tf.Module, pre
-00001e00: 6669 785f 6469 6374 3d4e 6f6e 6529 3a0d  fix_dict=None):.
-00001e10: 0a20 2020 2064 6566 2067 6574 5f75 6964  .    def get_uid
-00001e20: 2870 7265 6669 782c 2073 6571 293a 0d0a  (prefix, seq):..
-00001e30: 2020 2020 2020 2020 6966 2070 7265 6669          if prefi
-00001e40: 7820 6e6f 7420 696e 206d 6f64 756c 652e  x not in module.
-00001e50: 5f75 6964 5f70 7265 6669 7873 206f 7220  _uid_prefixs or 
-00001e60: 7365 7120 3c20 6d6f 6475 6c65 2e5f 7569  seq < module._ui
-00001e70: 645f 7072 6566 6978 735b 7072 6566 6978  d_prefixs[prefix
-00001e80: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00001e90: 6d6f 6475 6c65 2e5f 7569 645f 7072 6566  module._uid_pref
-00001ea0: 6978 735b 7072 6566 6978 5d20 3d20 7365  ixs[prefix] = se
-00001eb0: 710d 0a20 2020 2020 2020 2072 6574 7572  q..        retur
-00001ec0: 6e20 6d6f 6475 6c65 2e5f 7569 645f 7072  n module._uid_pr
-00001ed0: 6566 6978 735b 7072 6566 6978 5d0d 0a0d  efixs[prefix]...
-00001ee0: 0a20 2020 2069 6620 6e6f 7420 6861 7361  .    if not hasa
-00001ef0: 7474 7228 6d6f 6475 6c65 2c20 275f 7569  ttr(module, '_ui
-00001f00: 645f 7072 6566 6978 7327 2920 6f72 2070  d_prefixs') or p
-00001f10: 7265 6669 785f 6469 6374 2069 7320 6e6f  refix_dict is no
-00001f20: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00001f30: 206d 6f64 756c 652e 5f75 6964 5f70 7265   module._uid_pre
-00001f40: 6669 7873 203d 2070 7265 6669 785f 6469  fixs = prefix_di
-00001f50: 6374 0d0a 2020 2020 6966 206e 6f74 2068  ct..    if not h
-00001f60: 6173 6174 7472 286d 6f64 756c 652c 2027  asattr(module, '
-00001f70: 6465 6661 756c 745f 6e61 6d65 2729 3a0d  default_name'):.
-00001f80: 0a20 2020 2020 2020 206d 6f64 756c 652e  .        module.
-00001f90: 6465 6661 756c 745f 6e61 6d65 203d 2063  default_name = c
-00001fa0: 616d 656c 3273 6e61 6b65 286d 6f64 756c  amel2snake(modul
-00001fb0: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00001fc0: 6d65 5f5f 2920 2b20 275f 2720 2b20 7374  me__) + '_' + st
-00001fd0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
-00001fe0: 6765 745f 676c 6f62 616c 5f75 6964 2863  get_global_uid(c
-00001ff0: 616d 656c 3273 6e61 6b65 286d 6f64 756c  amel2snake(modul
-00002000: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00002010: 6d65 5f5f 2929 290d 0a20 2020 2070 7265  me__)))..    pre
-00002020: 6669 782c 2073 6571 203d 206d 6f64 756c  fix, seq = modul
-00002030: 652e 6465 6661 756c 745f 6e61 6d65 2e72  e.default_name.r
-00002040: 7370 6c69 7428 275f 272c 2031 2920 2023  split('_', 1)  #
-00002050: 2069 6620 275f 2720 696e 206d 6f64 756c   if '_' in modul
-00002060: 652e 6465 6661 756c 745f 6e61 6d65 2065  e.default_name e
-00002070: 6c73 650d 0a20 2020 2073 6571 203d 2069  lse..    seq = i
-00002080: 6e74 2873 6571 290d 0a20 2020 206d 6f64  nt(seq)..    mod
-00002090: 756c 652e 6465 6661 756c 745f 6e61 6d65  ule.default_name
-000020a0: 203d 2070 7265 6669 7820 2b20 275f 2720   = prefix + '_' 
-000020b0: 2b20 7374 7228 7365 7120 2d20 6765 745f  + str(seq - get_
-000020c0: 7569 6428 7072 6566 6978 2c20 7365 7129  uid(prefix, seq)
-000020d0: 202b 2031 290d 0a20 2020 2069 6620 6d6f   + 1)..    if mo
-000020e0: 6475 6c65 2e5f 6e61 6d65 2069 7320 4e6f  dule._name is No
-000020f0: 6e65 3a0d 0a20 2020 2020 2020 206d 6f64  ne:..        mod
-00002100: 756c 652e 5f6e 616d 6520 3d20 6d6f 6475  ule._name = modu
-00002110: 6c65 2e64 6566 6175 6c74 5f6e 616d 650d  le.default_name.
-00002120: 0a20 2020 206d 6f64 756c 652e 5f5f 6e61  .    module.__na
-00002130: 6d65 5f5f 203d 206d 6f64 756c 652e 5f6e  me__ = module._n
-00002140: 616d 650d 0a20 2020 206d 6f64 756c 652e  ame..    module.
-00002150: 7570 6461 7465 5f6e 616d 655f 7363 6f70  update_name_scop
-00002160: 6528 6d6f 6475 6c65 2e5f 6e61 6d65 290d  e(module._name).
-00002170: 0a0d 0a0d 0a5f 5549 445f 5052 4546 4958  ....._UID_PREFIX
-00002180: 203d 2064 6566 6175 6c74 6469 6374 2869   = defaultdict(i
-00002190: 6e74 290d 0a0d 0a0d 0a64 6566 2067 6574  nt)......def get
-000021a0: 5f67 6c6f 6261 6c5f 7569 6428 7072 6566  _global_uid(pref
-000021b0: 6978 3d27 2729 3a0d 0a20 2020 205f 5549  ix=''):..    _UI
-000021c0: 445f 5052 4546 4958 5b70 7265 6669 785d  D_PREFIX[prefix]
-000021d0: 202b 3d20 310d 0a20 2020 2072 6574 7572   += 1..    retur
-000021e0: 6e20 5f55 4944 5f50 5245 4649 585b 7072  n _UID_PREFIX[pr
-000021f0: 6566 6978 5d0d 0a0d 0a0d 0a63 6c61 7373  efix]......class
-00002200: 205f 496e 636f 6d70 6174 6962 6c65 4b65   _IncompatibleKe
-00002210: 7973 286e 616d 6564 7475 706c 6528 2749  ys(namedtuple('I
-00002220: 6e63 6f6d 7061 7469 626c 654b 6579 7327  ncompatibleKeys'
-00002230: 2c20 5b27 6d69 7373 696e 675f 6b65 7973  , ['missing_keys
-00002240: 272c 2027 756e 6578 7065 6374 6564 5f6b  ', 'unexpected_k
-00002250: 6579 7327 5d29 293a 0d0a 2020 2020 6465  eys'])):..    de
-00002260: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-00002270: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
-00002280: 7420 7365 6c66 2e6d 6973 7369 6e67 5f6b  t self.missing_k
-00002290: 6579 7320 616e 6420 6e6f 7420 7365 6c66  eys and not self
-000022a0: 2e75 6e65 7870 6563 7465 645f 6b65 7973  .unexpected_keys
-000022b0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000022c0: 6574 7572 6e20 273c 416c 6c20 6b65 7973  eturn '<All keys
-000022d0: 206d 6174 6368 6564 2073 7563 6365 7373   matched success
-000022e0: 6675 6c6c 793e 270d 0a20 2020 2020 2020  fully>'..       
-000022f0: 2072 6574 7572 6e20 7375 7065 7228 5f49   return super(_I
-00002300: 6e63 6f6d 7061 7469 626c 654b 6579 732c  ncompatibleKeys,
-00002310: 2073 656c 6629 2e5f 5f72 6570 725f 5f28   self).__repr__(
-00002320: 290d 0a0d 0a20 2020 205f 5f73 7472 5f5f  )....    __str__
-00002330: 203d 205f 5f72 6570 725f 5f0d 0a0d 0a0d   = __repr__.....
-00002340: 0a64 6566 205f 6164 6469 6e64 656e 7428  .def _addindent(
-00002350: 735f 2c20 6e75 6d53 7061 6365 7329 3a0d  s_, numSpaces):.
-00002360: 0a20 2020 2073 203d 2073 5f2e 7370 6c69  .    s = s_.spli
-00002370: 7428 275c 6e27 290d 0a20 2020 2023 2064  t('\n')..    # d
-00002380: 6f6e 2774 2064 6f20 616e 7974 6869 6e67  on't do anything
-00002390: 2066 6f72 2073 696e 676c 652d 6c69 6e65   for single-line
-000023a0: 2073 7475 6666 0d0a 2020 2020 6966 206c   stuff..    if l
-000023b0: 656e 2873 2920 3d3d 2031 3a0d 0a20 2020  en(s) == 1:..   
-000023c0: 2020 2020 2072 6574 7572 6e20 735f 0d0a       return s_..
-000023d0: 2020 2020 6669 7273 7420 3d20 732e 706f      first = s.po
-000023e0: 7028 3029 0d0a 2020 2020 7320 3d20 5b28  p(0)..    s = [(
-000023f0: 6e75 6d53 7061 6365 7320 2a20 2720 2729  numSpaces * ' ')
-00002400: 202b 206c 696e 6520 666f 7220 6c69 6e65   + line for line
-00002410: 2069 6e20 735d 0d0a 2020 2020 7320 3d20   in s]..    s = 
-00002420: 275c 6e27 2e6a 6f69 6e28 7329 0d0a 2020  '\n'.join(s)..  
-00002430: 2020 7320 3d20 6669 7273 7420 2b20 275c    s = first + '\
-00002440: 6e27 202b 2073 0d0a 2020 2020 7265 7475  n' + s..    retu
-00002450: 726e 2073 0d0a 0d0a 0d0a 7222 2222 5468  rn s......r"""Th
-00002460: 6973 2074 7261 636b 7320 686f 6f6b 7320  is tracks hooks 
-00002470: 636f 6d6d 6f6e 2074 6f20 616c 6c20 6d6f  common to all mo
-00002480: 6475 6c65 7320 7468 6174 2061 7265 2065  dules that are e
-00002490: 7865 6375 7465 6420 6265 666f 7265 2f61  xecuted before/a
-000024a0: 6674 6572 0d0a 6361 6c6c 696e 6720 666f  fter..calling fo
-000024b0: 7277 6172 6420 616e 6420 6261 636b 7761  rward and backwa
-000024c0: 7264 2e20 5468 6973 2069 7320 676c 6f62  rd. This is glob
-000024d0: 616c 2073 7461 7465 2075 7365 6420 666f  al state used fo
-000024e0: 7220 6465 6275 6767 696e 672f 7072 6f66  r debugging/prof
-000024f0: 696c 696e 670d 0a70 7572 706f 7365 7322  iling..purposes"
-00002500: 2222 0d0a 5f67 6c6f 6261 6c5f 6261 636b  "".._global_back
-00002510: 7761 7264 5f68 6f6f 6b73 203d 204f 7264  ward_hooks = Ord
-00002520: 6572 6564 4469 6374 2829 0d0a 5f67 6c6f  eredDict().._glo
-00002530: 6261 6c5f 666f 7277 6172 645f 7072 655f  bal_forward_pre_
-00002540: 686f 6f6b 7320 3d20 4f72 6465 7265 6444  hooks = OrderedD
-00002550: 6963 7428 290d 0a5f 676c 6f62 616c 5f66  ict().._global_f
-00002560: 6f72 7761 7264 5f68 6f6f 6b73 203d 204f  orward_hooks = O
-00002570: 7264 6572 6564 4469 6374 2829 0d0a 0d0a  rderedDict()....
-00002580: 5f67 6c6f 6261 6c5f 6261 636b 7761 7264  _global_backward
-00002590: 5f70 7265 5f68 6f6f 6b73 3a20 4469 6374  _pre_hooks: Dict
-000025a0: 5b69 6e74 2c20 4361 6c6c 6162 6c65 5d20  [int, Callable] 
-000025b0: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
-000025c0: 0a5f 676c 6f62 616c 5f69 735f 6675 6c6c  ._global_is_full
-000025d0: 5f62 6163 6b77 6172 645f 686f 6f6b 3a20  _backward_hook: 
-000025e0: 4f70 7469 6f6e 616c 5b62 6f6f 6c5d 203d  Optional[bool] =
-000025f0: 204e 6f6e 650d 0a0d 0a5f 6772 6164 5f74   None...._grad_t
-00002600: 203d 2055 6e69 6f6e 5b54 7570 6c65 5b54   = Union[Tuple[T
-00002610: 656e 736f 722c 202e 2e2e 5d2c 2054 656e  ensor, ...], Ten
-00002620: 736f 725d 0d0a 2320 5365 6520 6874 7470  sor]..# See http
-00002630: 733a 2f2f 6d79 7079 2e72 6561 6474 6865  s://mypy.readthe
-00002640: 646f 6373 2e69 6f2f 656e 2f6c 6174 6573  docs.io/en/lates
-00002650: 742f 6765 6e65 7269 6373 2e68 746d 6c23  t/generics.html#
-00002660: 6765 6e65 7269 632d 6d65 7468 6f64 732d  generic-methods-
-00002670: 616e 642d 6765 6e65 7269 632d 7365 6c66  and-generic-self
-00002680: 2066 6f72 2074 6865 2075 7365 0d0a 2320   for the use..# 
-00002690: 6f66 2060 5460 2074 6f20 616e 6e6f 7461  of `T` to annota
-000026a0: 7465 2060 7365 6c66 602e 204d 616e 7920  te `self`. Many 
-000026b0: 6d65 7468 6f64 7320 6f66 2060 4d6f 6475  methods of `Modu
-000026c0: 6c65 6020 7265 7475 726e 2060 7365 6c66  le` return `self
-000026d0: 6020 616e 6420 7765 2077 616e 7420 7468  ` and we want th
-000026e0: 6f73 6520 7265 7475 726e 2076 616c 7565  ose return value
-000026f0: 7320 746f 2062 650d 0a23 2074 6865 2074  s to be..# the t
-00002700: 7970 6520 6f66 2074 6865 2073 7562 636c  ype of the subcl
-00002710: 6173 732c 206e 6f74 2074 6865 206c 6f6f  ass, not the loo
-00002720: 7365 7220 7479 7065 206f 6620 604d 6f64  ser type of `Mod
-00002730: 756c 6560 2e0d 0a54 203d 2054 7970 6556  ule`...T = TypeV
-00002740: 6172 2827 5427 2c20 626f 756e 643d 274c  ar('T', bound='L
-00002750: 6179 6572 2729 0d0a 0d0a 5f45 5854 5241  ayer')...._EXTRA
-00002760: 5f53 5441 5445 5f4b 4559 5f53 5546 4649  _STATE_KEY_SUFFI
-00002770: 5820 3d20 275f 6578 7472 615f 7374 6174  X = '_extra_stat
-00002780: 6527 0d0a 0d0a 0d0a 6465 6620 7265 6769  e'......def regi
-00002790: 7374 6572 5f6d 6f64 756c 655f 6275 6666  ster_module_buff
-000027a0: 6572 5f72 6567 6973 7472 6174 696f 6e5f  er_registration_
-000027b0: 686f 6f6b 2868 6f6f 6b3a 2043 616c 6c61  hook(hook: Calla
-000027c0: 626c 655b 2e2e 2e2c 204e 6f6e 655d 2920  ble[..., None]) 
-000027d0: 2d3e 2052 656d 6f76 6162 6c65 4861 6e64  -> RemovableHand
-000027e0: 6c65 3a0d 0a20 2020 2072 2222 2252 6567  le:..    r"""Reg
-000027f0: 6973 7465 7273 2061 2062 7566 6665 7220  isters a buffer 
-00002800: 7265 6769 7374 7261 7469 6f6e 2068 6f6f  registration hoo
-00002810: 6b20 636f 6d6d 6f6e 2074 6f20 616c 6c20  k common to all 
-00002820: 6d6f 6475 6c65 732e 0d0a 0d0a 2020 2020  modules.....    
-00002830: 2e2e 2077 6172 6e69 6e67 203a 3a0d 0a0d  .. warning ::...
-00002840: 0a20 2020 2020 2020 2054 6869 7320 6164  .        This ad
-00002850: 6473 2067 6c6f 6261 6c20 7374 6174 6520  ds global state 
-00002860: 746f 2074 6865 2060 6e6e 2e4d 6f64 756c  to the `nn.Modul
-00002870: 6560 206d 6f64 756c 650d 0a0d 0a20 2020  e` module....   
-00002880: 2054 6865 2068 6f6f 6b20 7769 6c6c 2062   The hook will b
-00002890: 6520 6361 6c6c 6564 2065 7665 7279 2074  e called every t
-000028a0: 696d 6520 3a66 756e 633a 6072 6567 6973  ime :func:`regis
-000028b0: 7465 725f 6275 6666 6572 6020 6973 2069  ter_buffer` is i
-000028c0: 6e76 6f6b 6564 2e0d 0a20 2020 2049 7420  nvoked...    It 
-000028d0: 7368 6f75 6c64 2068 6176 6520 7468 6520  should have the 
-000028e0: 666f 6c6c 6f77 696e 6720 7369 676e 6174  following signat
-000028f0: 7572 653a 3a0d 0a0d 0a20 2020 2020 2020  ure::....       
-00002900: 2068 6f6f 6b28 6d6f 6475 6c65 2c20 6e61   hook(module, na
-00002910: 6d65 2c20 6275 6666 6572 2920 2d3e 204e  me, buffer) -> N
-00002920: 6f6e 6520 6f72 206e 6577 2062 7566 6665  one or new buffe
-00002930: 720d 0a0d 0a20 2020 2054 6865 2068 6f6f  r....    The hoo
-00002940: 6b20 6361 6e20 6d6f 6469 6679 2074 6865  k can modify the
-00002950: 2069 6e70 7574 206f 7220 7265 7475 726e   input or return
-00002960: 2061 2073 696e 676c 6520 6d6f 6469 6669   a single modifi
-00002970: 6564 2076 616c 7565 2069 6e20 7468 6520  ed value in the 
-00002980: 686f 6f6b 2e0d 0a0d 0a20 2020 2052 6574  hook.....    Ret
-00002990: 7572 6e73 3a0d 0a20 2020 2020 2020 203a  urns:..        :
-000029a0: 636c 6173 733a 6074 6f72 6368 2e75 7469  class:`torch.uti
-000029b0: 6c73 2e68 6f6f 6b73 2e52 656d 6f76 6162  ls.hooks.Removab
-000029c0: 6c65 4861 6e64 6c65 603a 0d0a 2020 2020  leHandle`:..    
-000029d0: 2020 2020 2020 2020 6120 6861 6e64 6c65          a handle
-000029e0: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
-000029f0: 6420 746f 2072 656d 6f76 6520 7468 6520  d to remove the 
-00002a00: 6164 6465 6420 686f 6f6b 2062 7920 6361  added hook by ca
-00002a10: 6c6c 696e 670d 0a20 2020 2020 2020 2020  lling..         
-00002a20: 2020 2060 6068 616e 646c 652e 7265 6d6f     ``handle.remo
-00002a30: 7665 2829 6060 0d0a 2020 2020 2222 220d  ve()``..    """.
-00002a40: 0a20 2020 2068 616e 646c 6520 3d20 5265  .    handle = Re
-00002a50: 6d6f 7661 626c 6548 616e 646c 6528 5f67  movableHandle(_g
-00002a60: 6c6f 6261 6c5f 6275 6666 6572 5f72 6567  lobal_buffer_reg
-00002a70: 6973 7472 6174 696f 6e5f 686f 6f6b 7329  istration_hooks)
-00002a80: 0d0a 2020 2020 5f67 6c6f 6261 6c5f 6275  ..    _global_bu
-00002a90: 6666 6572 5f72 6567 6973 7472 6174 696f  ffer_registratio
-00002aa0: 6e5f 686f 6f6b 735b 6861 6e64 6c65 2e69  n_hooks[handle.i
-00002ab0: 645d 203d 2068 6f6f 6b0d 0a20 2020 2072  d] = hook..    r
-00002ac0: 6574 7572 6e20 6861 6e64 6c65 0d0a 0d0a  eturn handle....
-00002ad0: 0d0a 6465 6620 7265 6769 7374 6572 5f6d  ..def register_m
-00002ae0: 6f64 756c 655f 6d6f 6475 6c65 5f72 6567  odule_module_reg
-00002af0: 6973 7472 6174 696f 6e5f 686f 6f6b 2868  istration_hook(h
-00002b00: 6f6f 6b3a 2043 616c 6c61 626c 655b 2e2e  ook: Callable[..
-00002b10: 2e2c 204e 6f6e 655d 2920 2d3e 2052 656d  ., None]) -> Rem
-00002b20: 6f76 6162 6c65 4861 6e64 6c65 3a0d 0a20  ovableHandle:.. 
-00002b30: 2020 2072 2222 2252 6567 6973 7465 7273     r"""Registers
-00002b40: 2061 206d 6f64 756c 6520 7265 6769 7374   a module regist
-00002b50: 7261 7469 6f6e 2068 6f6f 6b20 636f 6d6d  ration hook comm
-00002b60: 6f6e 2074 6f20 616c 6c20 6d6f 6475 6c65  on to all module
-00002b70: 732e 0d0a 0d0a 2020 2020 2e2e 2077 6172  s.....    .. war
-00002b80: 6e69 6e67 203a 3a0d 0a0d 0a20 2020 2020  ning ::....     
-00002b90: 2020 2054 6869 7320 6164 6473 2067 6c6f     This adds glo
-00002ba0: 6261 6c20 7374 6174 6520 746f 2074 6865  bal state to the
-00002bb0: 2060 6e6e 2e4d 6f64 756c 6560 206d 6f64   `nn.Module` mod
-00002bc0: 756c 650d 0a0d 0a20 2020 2054 6865 2068  ule....    The h
-00002bd0: 6f6f 6b20 7769 6c6c 2062 6520 6361 6c6c  ook will be call
-00002be0: 6564 2065 7665 7279 2074 696d 6520 3a66  ed every time :f
-00002bf0: 756e 633a 6072 6567 6973 7465 725f 6d6f  unc:`register_mo
-00002c00: 6475 6c65 6020 6973 2069 6e76 6f6b 6564  dule` is invoked
-00002c10: 2e0d 0a20 2020 2049 7420 7368 6f75 6c64  ...    It should
-00002c20: 2068 6176 6520 7468 6520 666f 6c6c 6f77   have the follow
-00002c30: 696e 6720 7369 676e 6174 7572 653a 3a0d  ing signature::.
-00002c40: 0a0d 0a20 2020 2020 2020 2068 6f6f 6b28  ...        hook(
-00002c50: 6d6f 6475 6c65 2c20 6e61 6d65 2c20 7375  module, name, su
-00002c60: 626d 6f64 756c 6529 202d 3e20 4e6f 6e65  bmodule) -> None
-00002c70: 206f 7220 6e65 7720 7375 626d 6f64 756c   or new submodul
-00002c80: 650d 0a0d 0a20 2020 2054 6865 2068 6f6f  e....    The hoo
-00002c90: 6b20 6361 6e20 6d6f 6469 6679 2074 6865  k can modify the
-00002ca0: 2069 6e70 7574 206f 7220 7265 7475 726e   input or return
-00002cb0: 2061 2073 696e 676c 6520 6d6f 6469 6669   a single modifi
-00002cc0: 6564 2076 616c 7565 2069 6e20 7468 6520  ed value in the 
-00002cd0: 686f 6f6b 2e0d 0a0d 0a20 2020 2052 6574  hook.....    Ret
-00002ce0: 7572 6e73 3a0d 0a20 2020 2020 2020 203a  urns:..        :
-00002cf0: 636c 6173 733a 6074 6f72 6368 2e75 7469  class:`torch.uti
-00002d00: 6c73 2e68 6f6f 6b73 2e52 656d 6f76 6162  ls.hooks.Removab
-00002d10: 6c65 4861 6e64 6c65 603a 0d0a 2020 2020  leHandle`:..    
-00002d20: 2020 2020 2020 2020 6120 6861 6e64 6c65          a handle
-00002d30: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
-00002d40: 6420 746f 2072 656d 6f76 6520 7468 6520  d to remove the 
-00002d50: 6164 6465 6420 686f 6f6b 2062 7920 6361  added hook by ca
-00002d60: 6c6c 696e 670d 0a20 2020 2020 2020 2020  lling..         
-00002d70: 2020 2060 6068 616e 646c 652e 7265 6d6f     ``handle.remo
-00002d80: 7665 2829 6060 0d0a 2020 2020 2222 220d  ve()``..    """.
-00002d90: 0a20 2020 2068 616e 646c 6520 3d20 5265  .    handle = Re
-00002da0: 6d6f 7661 626c 6548 616e 646c 6528 5f67  movableHandle(_g
-00002db0: 6c6f 6261 6c5f 6d6f 6475 6c65 5f72 6567  lobal_module_reg
-00002dc0: 6973 7472 6174 696f 6e5f 686f 6f6b 7329  istration_hooks)
-00002dd0: 0d0a 2020 2020 5f67 6c6f 6261 6c5f 6d6f  ..    _global_mo
-00002de0: 6475 6c65 5f72 6567 6973 7472 6174 696f  dule_registratio
-00002df0: 6e5f 686f 6f6b 735b 6861 6e64 6c65 2e69  n_hooks[handle.i
-00002e00: 645d 203d 2068 6f6f 6b0d 0a20 2020 2072  d] = hook..    r
-00002e10: 6574 7572 6e20 6861 6e64 6c65 0d0a 0d0a  eturn handle....
-00002e20: 0d0a 6465 6620 7265 6769 7374 6572 5f6d  ..def register_m
-00002e30: 6f64 756c 655f 7061 7261 6d65 7465 725f  odule_parameter_
-00002e40: 7265 6769 7374 7261 7469 6f6e 5f68 6f6f  registration_hoo
-00002e50: 6b28 686f 6f6b 3a20 4361 6c6c 6162 6c65  k(hook: Callable
-00002e60: 5b2e 2e2e 2c20 4e6f 6e65 5d29 202d 3e20  [..., None]) -> 
-00002e70: 5265 6d6f 7661 626c 6548 616e 646c 653a  RemovableHandle:
-00002e80: 0d0a 2020 2020 7222 2222 5265 6769 7374  ..    r"""Regist
-00002e90: 6572 7320 6120 7061 7261 6d65 7465 7220  ers a parameter 
-00002ea0: 7265 6769 7374 7261 7469 6f6e 2068 6f6f  registration hoo
-00002eb0: 6b20 636f 6d6d 6f6e 2074 6f20 616c 6c20  k common to all 
-00002ec0: 6d6f 6475 6c65 732e 0d0a 0d0a 2020 2020  modules.....    
-00002ed0: 2e2e 2077 6172 6e69 6e67 203a 3a0d 0a0d  .. warning ::...
-00002ee0: 0a20 2020 2020 2020 2054 6869 7320 6164  .        This ad
-00002ef0: 6473 2067 6c6f 6261 6c20 7374 6174 6520  ds global state 
-00002f00: 746f 2074 6865 2060 6e6e 2e4d 6f64 756c  to the `nn.Modul
-00002f10: 6560 206d 6f64 756c 650d 0a0d 0a20 2020  e` module....   
-00002f20: 2054 6865 2068 6f6f 6b20 7769 6c6c 2062   The hook will b
-00002f30: 6520 6361 6c6c 6564 2065 7665 7279 2074  e called every t
-00002f40: 696d 6520 3a66 756e 633a 6072 6567 6973  ime :func:`regis
-00002f50: 7465 725f 7061 7261 6d65 7465 7260 2069  ter_parameter` i
-00002f60: 7320 696e 766f 6b65 642e 0d0a 2020 2020  s invoked...    
-00002f70: 4974 2073 686f 756c 6420 6861 7665 2074  It should have t
-00002f80: 6865 2066 6f6c 6c6f 7769 6e67 2073 6967  he following sig
-00002f90: 6e61 7475 7265 3a3a 0d0a 0d0a 2020 2020  nature::....    
-00002fa0: 2020 2020 686f 6f6b 286d 6f64 756c 652c      hook(module,
-00002fb0: 206e 616d 652c 2070 6172 616d 2920 2d3e   name, param) ->
-00002fc0: 204e 6f6e 6520 6f72 206e 6577 2070 6172   None or new par
-00002fd0: 616d 6574 6572 0d0a 0d0a 2020 2020 5468  ameter....    Th
-00002fe0: 6520 686f 6f6b 2063 616e 206d 6f64 6966  e hook can modif
-00002ff0: 7920 7468 6520 696e 7075 7420 6f72 2072  y the input or r
-00003000: 6574 7572 6e20 6120 7369 6e67 6c65 206d  eturn a single m
-00003010: 6f64 6966 6965 6420 7661 6c75 6520 696e  odified value in
-00003020: 2074 6865 2068 6f6f 6b2e 0d0a 0d0a 2020   the hook.....  
-00003030: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-00003040: 2020 2020 3a63 6c61 7373 3a60 746f 7263      :class:`torc
-00003050: 682e 7574 696c 732e 686f 6f6b 732e 5265  h.utils.hooks.Re
-00003060: 6d6f 7661 626c 6548 616e 646c 6560 3a0d  movableHandle`:.
-00003070: 0a20 2020 2020 2020 2020 2020 2061 2068  .            a h
-00003080: 616e 646c 6520 7468 6174 2063 616e 2062  andle that can b
-00003090: 6520 7573 6564 2074 6f20 7265 6d6f 7665  e used to remove
-000030a0: 2074 6865 2061 6464 6564 2068 6f6f 6b20   the added hook 
-000030b0: 6279 2063 616c 6c69 6e67 0d0a 2020 2020  by calling..    
-000030c0: 2020 2020 2020 2020 6060 6861 6e64 6c65          ``handle
-000030d0: 2e72 656d 6f76 6528 2960 600d 0a20 2020  .remove()``..   
-000030e0: 2022 2222 0d0a 2020 2020 6861 6e64 6c65   """..    handle
-000030f0: 203d 2052 656d 6f76 6162 6c65 4861 6e64   = RemovableHand
-00003100: 6c65 285f 676c 6f62 616c 5f70 6172 616d  le(_global_param
-00003110: 6574 6572 5f72 6567 6973 7472 6174 696f  eter_registratio
-00003120: 6e5f 686f 6f6b 7329 0d0a 2020 2020 5f67  n_hooks)..    _g
-00003130: 6c6f 6261 6c5f 7061 7261 6d65 7465 725f  lobal_parameter_
-00003140: 7265 6769 7374 7261 7469 6f6e 5f68 6f6f  registration_hoo
-00003150: 6b73 5b68 616e 646c 652e 6964 5d20 3d20  ks[handle.id] = 
-00003160: 686f 6f6b 0d0a 2020 2020 7265 7475 726e  hook..    return
-00003170: 2068 616e 646c 650d 0a0d 0a0d 0a64 6566   handle......def
-00003180: 2072 6567 6973 7465 725f 6d6f 6475 6c65   register_module
-00003190: 5f66 6f72 7761 7264 5f70 7265 5f68 6f6f  _forward_pre_hoo
-000031a0: 6b28 686f 6f6b 3a20 4361 6c6c 6162 6c65  k(hook: Callable
-000031b0: 5b2e 2e2e 2c20 4e6f 6e65 5d29 202d 3e20  [..., None]) -> 
-000031c0: 5265 6d6f 7661 626c 6548 616e 646c 653a  RemovableHandle:
-000031d0: 0d0a 2020 2020 7222 2222 5265 6769 7374  ..    r"""Regist
-000031e0: 6572 7320 6120 666f 7277 6172 6420 7072  ers a forward pr
-000031f0: 652d 686f 6f6b 2063 6f6d 6d6f 6e20 746f  e-hook common to
-00003200: 2061 6c6c 206d 6f64 756c 6573 2e0d 0a0d   all modules....
-00003210: 0a20 2020 202e 2e20 7761 726e 696e 6720  .    .. warning 
-00003220: 3a3a 0d0a 0d0a 2020 2020 2020 2020 5468  ::....        Th
-00003230: 6973 2061 6464 7320 676c 6f62 616c 2073  is adds global s
-00003240: 7461 7465 2074 6f20 7468 6520 606e 6e2e  tate to the `nn.
-00003250: 6d6f 6475 6c65 6020 6d6f 6475 6c65 0d0a  module` module..
-00003260: 2020 2020 2020 2020 616e 6420 6974 2069          and it i
-00003270: 7320 6f6e 6c79 2069 6e74 656e 6465 6420  s only intended 
-00003280: 666f 7220 6465 6275 6767 696e 672f 7072  for debugging/pr
-00003290: 6f66 696c 696e 6720 7075 7270 6f73 6573  ofiling purposes
-000032a0: 2e0d 0a0d 0a20 2020 2054 6865 2068 6f6f  .....    The hoo
-000032b0: 6b20 7769 6c6c 2062 6520 6361 6c6c 6564  k will be called
-000032c0: 2065 7665 7279 2074 696d 6520 6265 666f   every time befo
-000032d0: 7265 203a 6675 6e63 3a60 666f 7277 6172  re :func:`forwar
-000032e0: 6460 2069 7320 696e 766f 6b65 642e 0d0a  d` is invoked...
-000032f0: 2020 2020 4974 2073 686f 756c 6420 6861      It should ha
-00003300: 7665 2074 6865 2066 6f6c 6c6f 7769 6e67  ve the following
-00003310: 2073 6967 6e61 7475 7265 3a3a 0d0a 0d0a   signature::....
-00003320: 2020 2020 2020 2020 686f 6f6b 286d 6f64          hook(mod
-00003330: 756c 652c 2069 6e70 7574 2920 2d3e 204e  ule, input) -> N
-00003340: 6f6e 6520 6f72 206d 6f64 6966 6965 6420  one or modified 
-00003350: 696e 7075 740d 0a0d 0a20 2020 2054 6865  input....    The
-00003360: 2069 6e70 7574 2063 6f6e 7461 696e 7320   input contains 
-00003370: 6f6e 6c79 2074 6865 2070 6f73 6974 696f  only the positio
-00003380: 6e61 6c20 6172 6775 6d65 6e74 7320 6769  nal arguments gi
-00003390: 7665 6e20 746f 2074 6865 206d 6f64 756c  ven to the modul
-000033a0: 652e 0d0a 2020 2020 4b65 7977 6f72 6420  e...    Keyword 
-000033b0: 6172 6775 6d65 6e74 7320 776f 6e27 7420  arguments won't 
-000033c0: 6265 2070 6173 7365 6420 746f 2074 6865  be passed to the
-000033d0: 2068 6f6f 6b73 2061 6e64 206f 6e6c 7920   hooks and only 
-000033e0: 746f 2074 6865 2060 6066 6f72 7761 7264  to the ``forward
-000033f0: 6060 2e0d 0a20 2020 2054 6865 2068 6f6f  ``...    The hoo
-00003400: 6b20 6361 6e20 6d6f 6469 6679 2074 6865  k can modify the
-00003410: 2069 6e70 7574 2e20 5573 6572 2063 616e   input. User can
-00003420: 2065 6974 6865 7220 7265 7475 726e 2061   either return a
-00003430: 2074 7570 6c65 206f 7220 610d 0a20 2020   tuple or a..   
-00003440: 2073 696e 676c 6520 6d6f 6469 6669 6564   single modified
-00003450: 2076 616c 7565 2069 6e20 7468 6520 686f   value in the ho
-00003460: 6f6b 2e20 5765 2077 696c 6c20 7772 6170  ok. We will wrap
-00003470: 2074 6865 2076 616c 7565 2069 6e74 6f20   the value into 
-00003480: 6120 7475 706c 650d 0a20 2020 2069 6620  a tuple..    if 
-00003490: 6120 7369 6e67 6c65 2076 616c 7565 2069  a single value i
-000034a0: 7320 7265 7475 726e 6564 2875 6e6c 6573  s returned(unles
-000034b0: 7320 7468 6174 2076 616c 7565 2069 7320  s that value is 
-000034c0: 616c 7265 6164 7920 6120 7475 706c 6529  already a tuple)
-000034d0: 2e0d 0a0d 0a20 2020 2054 6869 7320 686f  .....    This ho
-000034e0: 6f6b 2068 6173 2070 7265 6365 6465 6e63  ok has precedenc
-000034f0: 6520 6f76 6572 2074 6865 2073 7065 6369  e over the speci
-00003500: 6669 6320 6d6f 6475 6c65 2068 6f6f 6b73  fic module hooks
-00003510: 2072 6567 6973 7465 7265 6420 7769 7468   registered with
-00003520: 0d0a 2020 2020 6060 7265 6769 7374 6572  ..    ``register
-00003530: 5f66 6f72 7761 7264 5f70 7265 5f68 6f6f  _forward_pre_hoo
-00003540: 6b60 602e 0d0a 0d0a 2020 2020 5265 7475  k``.....    Retu
-00003550: 726e 733a 0d0a 2020 2020 2020 2020 3a63  rns:..        :c
-00003560: 6c61 7373 3a60 746f 7263 682e 7574 696c  lass:`torch.util
-00003570: 732e 686f 6f6b 732e 5265 6d6f 7661 626c  s.hooks.Removabl
-00003580: 6548 616e 646c 6560 3a0d 0a20 2020 2020  eHandle`:..     
-00003590: 2020 2020 2020 2061 2068 616e 646c 6520         a handle 
-000035a0: 7468 6174 2063 616e 2062 6520 7573 6564  that can be used
-000035b0: 2074 6f20 7265 6d6f 7665 2074 6865 2061   to remove the a
-000035c0: 6464 6564 2068 6f6f 6b20 6279 2063 616c  dded hook by cal
-000035d0: 6c69 6e67 0d0a 2020 2020 2020 2020 2020  ling..          
-000035e0: 2020 6060 6861 6e64 6c65 2e72 656d 6f76    ``handle.remov
-000035f0: 6528 2960 600d 0a20 2020 2022 2222 0d0a  e()``..    """..
-00003600: 2020 2020 6861 6e64 6c65 203d 2052 656d      handle = Rem
-00003610: 6f76 6162 6c65 4861 6e64 6c65 285f 676c  ovableHandle(_gl
-00003620: 6f62 616c 5f66 6f72 7761 7264 5f70 7265  obal_forward_pre
-00003630: 5f68 6f6f 6b73 290d 0a20 2020 205f 676c  _hooks)..    _gl
-00003640: 6f62 616c 5f66 6f72 7761 7264 5f70 7265  obal_forward_pre
-00003650: 5f68 6f6f 6b73 5b68 616e 646c 652e 6964  _hooks[handle.id
-00003660: 5d20 3d20 686f 6f6b 0d0a 2020 2020 7265  ] = hook..    re
-00003670: 7475 726e 2068 616e 646c 650d 0a0d 0a0d  turn handle.....
-00003680: 0a64 6566 2072 6567 6973 7465 725f 6d6f  .def register_mo
-00003690: 6475 6c65 5f66 6f72 7761 7264 5f68 6f6f  dule_forward_hoo
-000036a0: 6b28 686f 6f6b 3a20 4361 6c6c 6162 6c65  k(hook: Callable
-000036b0: 5b2e 2e2e 2c20 4e6f 6e65 5d29 202d 3e20  [..., None]) -> 
-000036c0: 5265 6d6f 7661 626c 6548 616e 646c 653a  RemovableHandle:
-000036d0: 0d0a 2020 2020 7222 2222 5265 6769 7374  ..    r"""Regist
-000036e0: 6572 7320 6120 676c 6f62 616c 2066 6f72  ers a global for
-000036f0: 7761 7264 2068 6f6f 6b20 666f 7220 616c  ward hook for al
-00003700: 6c20 7468 6520 6d6f 6475 6c65 730d 0a0d  l the modules...
-00003710: 0a20 2020 202e 2e20 7761 726e 696e 6720  .    .. warning 
-00003720: 3a3a 0d0a 0d0a 2020 2020 2020 2020 5468  ::....        Th
-00003730: 6973 2061 6464 7320 676c 6f62 616c 2073  is adds global s
-00003740: 7461 7465 2074 6f20 7468 6520 606e 6e2e  tate to the `nn.
-00003750: 6d6f 6475 6c65 6020 6d6f 6475 6c65 0d0a  module` module..
-00003760: 2020 2020 2020 2020 616e 6420 6974 2069          and it i
-00003770: 7320 6f6e 6c79 2069 6e74 656e 6465 6420  s only intended 
-00003780: 666f 7220 6465 6275 6767 696e 672f 7072  for debugging/pr
-00003790: 6f66 696c 696e 6720 7075 7270 6f73 6573  ofiling purposes
-000037a0: 2e0d 0a0d 0a20 2020 2054 6865 2068 6f6f  .....    The hoo
-000037b0: 6b20 7769 6c6c 2062 6520 6361 6c6c 6564  k will be called
-000037c0: 2065 7665 7279 2074 696d 6520 6166 7465   every time afte
-000037d0: 7220 3a66 756e 633a 6066 6f72 7761 7264  r :func:`forward
-000037e0: 6020 6861 7320 636f 6d70 7574 6564 2061  ` has computed a
-000037f0: 6e20 6f75 7470 7574 2e0d 0a20 2020 2049  n output...    I
-00003800: 7420 7368 6f75 6c64 2068 6176 6520 7468  t should have th
-00003810: 6520 666f 6c6c 6f77 696e 6720 7369 676e  e following sign
-00003820: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
-00003830: 2020 2068 6f6f 6b28 6d6f 6475 6c65 2c20     hook(module, 
-00003840: 696e 7075 742c 206f 7574 7075 7429 202d  input, output) -
-00003850: 3e20 4e6f 6e65 206f 7220 6d6f 6469 6669  > None or modifi
-00003860: 6564 206f 7574 7075 740d 0a0d 0a20 2020  ed output....   
-00003870: 2054 6865 2069 6e70 7574 2063 6f6e 7461   The input conta
-00003880: 696e 7320 6f6e 6c79 2074 6865 2070 6f73  ins only the pos
-00003890: 6974 696f 6e61 6c20 6172 6775 6d65 6e74  itional argument
-000038a0: 7320 6769 7665 6e20 746f 2074 6865 206d  s given to the m
-000038b0: 6f64 756c 652e 0d0a 2020 2020 4b65 7977  odule...    Keyw
-000038c0: 6f72 6420 6172 6775 6d65 6e74 7320 776f  ord arguments wo
-000038d0: 6e27 7420 6265 2070 6173 7365 6420 746f  n't be passed to
-000038e0: 2074 6865 2068 6f6f 6b73 2061 6e64 206f   the hooks and o
-000038f0: 6e6c 7920 746f 2074 6865 2060 6066 6f72  nly to the ``for
-00003900: 7761 7264 6060 2e0d 0a20 2020 2054 6865  ward``...    The
-00003910: 2068 6f6f 6b20 6361 6e20 6d6f 6469 6679   hook can modify
-00003920: 2074 6865 206f 7574 7075 742e 2049 7420   the output. It 
-00003930: 6361 6e20 6d6f 6469 6679 2074 6865 2069  can modify the i
-00003940: 6e70 7574 2069 6e70 6c61 6365 2062 7574  nput inplace but
-00003950: 0d0a 2020 2020 6974 2077 696c 6c20 6e6f  ..    it will no
-00003960: 7420 6861 7665 2065 6666 6563 7420 6f6e  t have effect on
-00003970: 2066 6f72 7761 7264 2073 696e 6365 2074   forward since t
-00003980: 6869 7320 6973 2063 616c 6c65 6420 6166  his is called af
-00003990: 7465 720d 0a20 2020 203a 6675 6e63 3a60  ter..    :func:`
-000039a0: 666f 7277 6172 6460 2069 7320 6361 6c6c  forward` is call
-000039b0: 6564 2e0d 0a0d 0a20 2020 2052 6574 7572  ed.....    Retur
-000039c0: 6e73 3a0d 0a20 2020 2020 2020 203a 636c  ns:..        :cl
-000039d0: 6173 733a 6074 6f72 6368 2e75 7469 6c73  ass:`torch.utils
-000039e0: 2e68 6f6f 6b73 2e52 656d 6f76 6162 6c65  .hooks.Removable
-000039f0: 4861 6e64 6c65 603a 0d0a 2020 2020 2020  Handle`:..      
-00003a00: 2020 2020 2020 6120 6861 6e64 6c65 2074        a handle t
-00003a10: 6861 7420 6361 6e20 6265 2075 7365 6420  hat can be used 
-00003a20: 746f 2072 656d 6f76 6520 7468 6520 6164  to remove the ad
-00003a30: 6465 6420 686f 6f6b 2062 7920 6361 6c6c  ded hook by call
-00003a40: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
-00003a50: 2060 6068 616e 646c 652e 7265 6d6f 7665   ``handle.remove
-00003a60: 2829 6060 0d0a 0d0a 2020 2020 5468 6973  ()``....    This
-00003a70: 2068 6f6f 6b20 7769 6c6c 2062 6520 6578   hook will be ex
-00003a80: 6563 7574 6564 2062 6566 6f72 6520 7370  ecuted before sp
-00003a90: 6563 6966 6963 206d 6f64 756c 6520 686f  ecific module ho
-00003aa0: 6f6b 7320 7265 6769 7374 6572 6564 2077  oks registered w
-00003ab0: 6974 680d 0a20 2020 2060 6072 6567 6973  ith..    ``regis
-00003ac0: 7465 725f 666f 7277 6172 645f 686f 6f6b  ter_forward_hook
-00003ad0: 6060 2e0d 0a20 2020 2022 2222 0d0a 2020  ``...    """..  
-00003ae0: 2020 6861 6e64 6c65 203d 2052 656d 6f76    handle = Remov
-00003af0: 6162 6c65 4861 6e64 6c65 285f 676c 6f62  ableHandle(_glob
-00003b00: 616c 5f66 6f72 7761 7264 5f68 6f6f 6b73  al_forward_hooks
-00003b10: 290d 0a20 2020 205f 676c 6f62 616c 5f66  )..    _global_f
-00003b20: 6f72 7761 7264 5f68 6f6f 6b73 5b68 616e  orward_hooks[han
-00003b30: 646c 652e 6964 5d20 3d20 686f 6f6b 0d0a  dle.id] = hook..
-00003b40: 2020 2020 7265 7475 726e 2068 616e 646c      return handl
-00003b50: 650d 0a0d 0a0d 0a64 6566 2072 6567 6973  e......def regis
-00003b60: 7465 725f 6d6f 6475 6c65 5f62 6163 6b77  ter_module_backw
-00003b70: 6172 645f 686f 6f6b 280d 0a20 2020 2020  ard_hook(..     
-00003b80: 2020 2068 6f6f 6b3a 2043 616c 6c61 626c     hook: Callabl
-00003b90: 655b 5b27 4c61 7965 7227 2c20 5f67 7261  e[['Layer', _gra
-00003ba0: 645f 742c 205f 6772 6164 5f74 5d2c 2055  d_t, _grad_t], U
-00003bb0: 6e69 6f6e 5b4e 6f6e 652c 205f 6772 6164  nion[None, _grad
-00003bc0: 5f74 5d5d 0d0a 2920 2d3e 2052 656d 6f76  _t]]..) -> Remov
-00003bd0: 6162 6c65 4861 6e64 6c65 3a0d 0a20 2020  ableHandle:..   
-00003be0: 2072 2222 2252 6567 6973 7465 7273 2061   r"""Registers a
-00003bf0: 2062 6163 6b77 6172 6420 686f 6f6b 2063   backward hook c
-00003c00: 6f6d 6d6f 6e20 746f 2061 6c6c 2074 6865  ommon to all the
-00003c10: 206d 6f64 756c 6573 2e0d 0a0d 0a20 2020   modules.....   
-00003c20: 2054 6869 7320 6675 6e63 7469 6f6e 2069   This function i
-00003c30: 7320 6465 7072 6563 6174 6564 2069 6e20  s deprecated in 
-00003c40: 6661 766f 7220 6f66 0d0a 2020 2020 3a66  favor of..    :f
-00003c50: 756e 633a 6074 6f72 6368 2e6e 6e2e 6d6f  unc:`torch.nn.mo
-00003c60: 6475 6c65 732e 6d6f 6475 6c65 2e72 6567  dules.module.reg
-00003c70: 6973 7465 725f 6d6f 6475 6c65 5f66 756c  ister_module_ful
-00003c80: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b60  l_backward_hook`
-00003c90: 0d0a 2020 2020 616e 6420 7468 6520 6265  ..    and the be
-00003ca0: 6861 7669 6f72 206f 6620 7468 6973 2066  havior of this f
-00003cb0: 756e 6374 696f 6e20 7769 6c6c 2063 6861  unction will cha
-00003cc0: 6e67 6520 696e 2066 7574 7572 6520 7665  nge in future ve
-00003cd0: 7273 696f 6e73 2e0d 0a0d 0a20 2020 2052  rsions.....    R
-00003ce0: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-00003cf0: 203a 636c 6173 733a 6074 6f72 6368 2e75   :class:`torch.u
-00003d00: 7469 6c73 2e68 6f6f 6b73 2e52 656d 6f76  tils.hooks.Remov
-00003d10: 6162 6c65 4861 6e64 6c65 603a 0d0a 2020  ableHandle`:..  
-00003d20: 2020 2020 2020 2020 2020 6120 6861 6e64            a hand
-00003d30: 6c65 2074 6861 7420 6361 6e20 6265 2075  le that can be u
-00003d40: 7365 6420 746f 2072 656d 6f76 6520 7468  sed to remove th
-00003d50: 6520 6164 6465 6420 686f 6f6b 2062 7920  e added hook by 
-00003d60: 6361 6c6c 696e 670d 0a20 2020 2020 2020  calling..       
-00003d70: 2020 2020 2060 6068 616e 646c 652e 7265       ``handle.re
-00003d80: 6d6f 7665 2829 6060 0d0a 0d0a 2020 2020  move()``....    
-00003d90: 2222 220d 0a20 2020 2067 6c6f 6261 6c20  """..    global 
-00003da0: 5f67 6c6f 6261 6c5f 6973 5f66 756c 6c5f  _global_is_full_
-00003db0: 6261 636b 7761 7264 5f68 6f6f 6b0d 0a20  backward_hook.. 
-00003dc0: 2020 2069 6620 5f67 6c6f 6261 6c5f 6973     if _global_is
-00003dd0: 5f66 756c 6c5f 6261 636b 7761 7264 5f68  _full_backward_h
-00003de0: 6f6f 6b20 6973 2054 7275 653a 0d0a 2020  ook is True:..  
-00003df0: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-00003e00: 696d 6545 7272 6f72 2822 4361 6e6e 6f74  imeError("Cannot
-00003e10: 2075 7365 2062 6f74 6820 7265 6775 6c61   use both regula
-00003e20: 7220 6261 636b 7761 7264 2068 6f6f 6b73  r backward hooks
-00003e30: 2061 6e64 2066 756c 6c20 6261 636b 7761   and full backwa
-00003e40: 7264 2068 6f6f 6b73 2061 7320 6120 220d  rd hooks as a ".
-00003e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e60: 2020 2020 2020 2020 2020 2020 2267 6c6f              "glo
-00003e70: 6261 6c20 4d6f 6475 6c65 2068 6f6f 6b2e  bal Module hook.
-00003e80: 2050 6c65 6173 6520 7573 6520 6f6e 6c79   Please use only
-00003e90: 206f 6e65 206f 6620 7468 656d 2e22 290d   one of them.").
-00003ea0: 0a0d 0a20 2020 205f 676c 6f62 616c 5f69  ...    _global_i
-00003eb0: 735f 6675 6c6c 5f62 6163 6b77 6172 645f  s_full_backward_
-00003ec0: 686f 6f6b 203d 2046 616c 7365 0d0a 0d0a  hook = False....
-00003ed0: 2020 2020 6861 6e64 6c65 203d 2052 656d      handle = Rem
-00003ee0: 6f76 6162 6c65 4861 6e64 6c65 285f 676c  ovableHandle(_gl
-00003ef0: 6f62 616c 5f62 6163 6b77 6172 645f 686f  obal_backward_ho
-00003f00: 6f6b 7329 0d0a 2020 2020 5f67 6c6f 6261  oks)..    _globa
-00003f10: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b73  l_backward_hooks
-00003f20: 5b68 616e 646c 652e 6964 5d20 3d20 686f  [handle.id] = ho
-00003f30: 6f6b 0d0a 2020 2020 7265 7475 726e 2068  ok..    return h
-00003f40: 616e 646c 650d 0a0d 0a0d 0a64 6566 2072  andle......def r
-00003f50: 6567 6973 7465 725f 6d6f 6475 6c65 5f66  egister_module_f
-00003f60: 756c 6c5f 6261 636b 7761 7264 5f70 7265  ull_backward_pre
-00003f70: 5f68 6f6f 6b28 0d0a 2020 2020 2020 2020  _hook(..        
-00003f80: 686f 6f6b 3a20 4361 6c6c 6162 6c65 5b5b  hook: Callable[[
-00003f90: 274c 6179 6572 272c 205f 6772 6164 5f74  'Layer', _grad_t
-00003fa0: 5d2c 2055 6e69 6f6e 5b4e 6f6e 652c 205f  ], Union[None, _
-00003fb0: 6772 6164 5f74 5d5d 0d0a 2920 2d3e 2052  grad_t]]..) -> R
-00003fc0: 656d 6f76 6162 6c65 4861 6e64 6c65 3a0d  emovableHandle:.
-00003fd0: 0a20 2020 2072 2222 2252 6567 6973 7465  .    r"""Registe
-00003fe0: 7273 2061 2062 6163 6b77 6172 6420 7072  rs a backward pr
-00003ff0: 652d 686f 6f6b 2063 6f6d 6d6f 6e20 746f  e-hook common to
-00004000: 2061 6c6c 2074 6865 206d 6f64 756c 6573   all the modules
-00004010: 2e0d 0a0d 0a20 2020 202e 2e20 7761 726e  .....    .. warn
-00004020: 696e 6720 3a3a 0d0a 2020 2020 2020 2020  ing ::..        
-00004030: 5468 6973 2061 6464 7320 676c 6f62 616c  This adds global
-00004040: 2073 7461 7465 2074 6f20 7468 6520 606e   state to the `n
-00004050: 6e2e 6d6f 6475 6c65 6020 6d6f 6475 6c65  n.module` module
-00004060: 0d0a 2020 2020 2020 2020 616e 6420 6974  ..        and it
-00004070: 2069 7320 6f6e 6c79 2069 6e74 656e 6465   is only intende
-00004080: 6420 666f 7220 6465 6275 6767 696e 672f  d for debugging/
-00004090: 7072 6f66 696c 696e 6720 7075 7270 6f73  profiling purpos
-000040a0: 6573 2e0d 0a0d 0a20 2020 2054 6865 2068  es.....    The h
-000040b0: 6f6f 6b20 7769 6c6c 2062 6520 6361 6c6c  ook will be call
-000040c0: 6564 2065 7665 7279 2074 696d 6520 7468  ed every time th
-000040d0: 6520 6772 6164 6965 6e74 7320 666f 7220  e gradients for 
-000040e0: 7468 6520 6d6f 6475 6c65 2061 7265 2063  the module are c
-000040f0: 6f6d 7075 7465 642e 0d0a 2020 2020 5468  omputed...    Th
-00004100: 6520 686f 6f6b 2073 686f 756c 6420 6861  e hook should ha
-00004110: 7665 2074 6865 2066 6f6c 6c6f 7769 6e67  ve the following
-00004120: 2073 6967 6e61 7475 7265 3a3a 0d0a 0d0a   signature::....
-00004130: 2020 2020 2020 2020 686f 6f6b 286d 6f64          hook(mod
-00004140: 756c 652c 2067 7261 645f 6f75 7470 7574  ule, grad_output
-00004150: 2920 2d3e 2054 656e 736f 7220 6f72 204e  ) -> Tensor or N
-00004160: 6f6e 650d 0a0d 0a20 2020 2054 6865 203a  one....    The :
-00004170: 6174 7472 3a60 6772 6164 5f6f 7574 7075  attr:`grad_outpu
-00004180: 7460 2069 7320 6120 7475 706c 652e 2054  t` is a tuple. T
-00004190: 6865 2068 6f6f 6b20 7368 6f75 6c64 0d0a  he hook should..
-000041a0: 2020 2020 6e6f 7420 6d6f 6469 6679 2069      not modify i
-000041b0: 7473 2061 7267 756d 656e 7473 2c20 6275  ts arguments, bu
-000041c0: 7420 6974 2063 616e 206f 7074 696f 6e61  t it can optiona
-000041d0: 6c6c 7920 7265 7475 726e 2061 206e 6577  lly return a new
-000041e0: 2067 7261 6469 656e 7420 7769 7468 0d0a   gradient with..
-000041f0: 2020 2020 7265 7370 6563 7420 746f 2074      respect to t
-00004200: 6865 206f 7574 7075 7420 7468 6174 2077  he output that w
-00004210: 696c 6c20 6265 2075 7365 6420 696e 2070  ill be used in p
-00004220: 6c61 6365 206f 6620 3a61 7474 723a 6067  lace of :attr:`g
-00004230: 7261 645f 6f75 7470 7574 6020 696e 0d0a  rad_output` in..
-00004240: 2020 2020 7375 6273 6571 7565 6e74 2063      subsequent c
-00004250: 6f6d 7075 7461 7469 6f6e 732e 2045 6e74  omputations. Ent
-00004260: 7269 6573 2069 6e20 3a61 7474 723a 6067  ries in :attr:`g
-00004270: 7261 645f 6f75 7470 7574 6020 7769 6c6c  rad_output` will
-00004280: 2062 6520 6060 4e6f 6e65 6060 2066 6f72   be ``None`` for
-00004290: 0d0a 2020 2020 616c 6c20 6e6f 6e2d 5465  ..    all non-Te
-000042a0: 6e73 6f72 2061 7267 756d 656e 7473 2e0d  nsor arguments..
-000042b0: 0a0d 0a20 2020 2046 6f72 2074 6563 686e  ...    For techn
-000042c0: 6963 616c 2072 6561 736f 6e73 2c20 7768  ical reasons, wh
-000042d0: 656e 2074 6869 7320 686f 6f6b 2069 7320  en this hook is 
-000042e0: 6170 706c 6965 6420 746f 2061 204d 6f64  applied to a Mod
-000042f0: 756c 652c 2069 7473 2066 6f72 7761 7264  ule, its forward
-00004300: 2066 756e 6374 696f 6e20 7769 6c6c 0d0a   function will..
-00004310: 2020 2020 7265 6365 6976 6520 6120 7669      receive a vi
-00004320: 6577 206f 6620 6561 6368 2054 656e 736f  ew of each Tenso
-00004330: 7220 7061 7373 6564 2074 6f20 7468 6520  r passed to the 
-00004340: 4d6f 6475 6c65 2e20 5369 6d69 6c61 726c  Module. Similarl
-00004350: 7920 7468 6520 6361 6c6c 6572 2077 696c  y the caller wil
-00004360: 6c20 7265 6365 6976 6520 6120 7669 6577  l receive a view
-00004370: 0d0a 2020 2020 6f66 2065 6163 6820 5465  ..    of each Te
-00004380: 6e73 6f72 2072 6574 7572 6e65 6420 6279  nsor returned by
-00004390: 2074 6865 204d 6f64 756c 6527 7320 666f   the Module's fo
-000043a0: 7277 6172 6420 6675 6e63 7469 6f6e 2e0d  rward function..
-000043b0: 0a0d 0a20 2020 2047 6c6f 6261 6c20 686f  ...    Global ho
-000043c0: 6f6b 7320 6172 6520 6361 6c6c 6564 2062  oks are called b
-000043d0: 6566 6f72 6520 686f 6f6b 7320 7265 6769  efore hooks regi
-000043e0: 7374 6572 6564 2077 6974 6820 6072 6567  stered with `reg
-000043f0: 6973 7465 725f 6261 636b 7761 7264 5f70  ister_backward_p
-00004400: 7265 5f68 6f6f 6b60 0d0a 0d0a 2020 2020  re_hook`....    
-00004410: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-00004420: 2020 3a63 6c61 7373 3a60 746f 7263 682e    :class:`torch.
-00004430: 7574 696c 732e 686f 6f6b 732e 5265 6d6f  utils.hooks.Remo
-00004440: 7661 626c 6548 616e 646c 6560 3a0d 0a20  vableHandle`:.. 
-00004450: 2020 2020 2020 2020 2020 2061 2068 616e             a han
-00004460: 646c 6520 7468 6174 2063 616e 2062 6520  dle that can be 
-00004470: 7573 6564 2074 6f20 7265 6d6f 7665 2074  used to remove t
-00004480: 6865 2061 6464 6564 2068 6f6f 6b20 6279  he added hook by
-00004490: 2063 616c 6c69 6e67 0d0a 2020 2020 2020   calling..      
-000044a0: 2020 2020 2020 6060 6861 6e64 6c65 2e72        ``handle.r
-000044b0: 656d 6f76 6528 2960 600d 0a0d 0a20 2020  emove()``....   
-000044c0: 2022 2222 0d0a 2020 2020 6861 6e64 6c65   """..    handle
-000044d0: 203d 2052 656d 6f76 6162 6c65 4861 6e64   = RemovableHand
-000044e0: 6c65 285f 676c 6f62 616c 5f62 6163 6b77  le(_global_backw
-000044f0: 6172 645f 7072 655f 686f 6f6b 7329 0d0a  ard_pre_hooks)..
-00004500: 2020 2020 5f67 6c6f 6261 6c5f 6261 636b      _global_back
-00004510: 7761 7264 5f70 7265 5f68 6f6f 6b73 5b68  ward_pre_hooks[h
-00004520: 616e 646c 652e 6964 5d20 3d20 686f 6f6b  andle.id] = hook
-00004530: 0d0a 2020 2020 7265 7475 726e 2068 616e  ..    return han
-00004540: 646c 650d 0a0d 0a0d 0a64 6566 2072 6567  dle......def reg
-00004550: 6973 7465 725f 6d6f 6475 6c65 5f66 756c  ister_module_ful
-00004560: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b28  l_backward_hook(
-00004570: 0d0a 2020 2020 2020 2020 686f 6f6b 3a20  ..        hook: 
-00004580: 4361 6c6c 6162 6c65 5b5b 274c 6179 6572  Callable[['Layer
-00004590: 272c 205f 6772 6164 5f74 2c20 5f67 7261  ', _grad_t, _gra
-000045a0: 645f 745d 2c20 556e 696f 6e5b 4e6f 6e65  d_t], Union[None
-000045b0: 2c20 5f67 7261 645f 745d 5d0d 0a29 202d  , _grad_t]]..) -
-000045c0: 3e20 5265 6d6f 7661 626c 6548 616e 646c  > RemovableHandl
-000045d0: 653a 0d0a 2020 2020 7222 2222 5265 6769  e:..    r"""Regi
-000045e0: 7374 6572 7320 6120 6261 636b 7761 7264  sters a backward
-000045f0: 2068 6f6f 6b20 636f 6d6d 6f6e 2074 6f20   hook common to 
-00004600: 616c 6c20 7468 6520 6d6f 6475 6c65 732e  all the modules.
-00004610: 0d0a 0d0a 2020 2020 2e2e 2077 6172 6e69  ....    .. warni
-00004620: 6e67 203a 3a0d 0a20 2020 2020 2020 2054  ng ::..        T
-00004630: 6869 7320 6164 6473 2067 6c6f 6261 6c20  his adds global 
-00004640: 7374 6174 6520 746f 2074 6865 2060 6e6e  state to the `nn
-00004650: 2e6d 6f64 756c 6560 206d 6f64 756c 650d  .module` module.
-00004660: 0a20 2020 2020 2020 2061 6e64 2069 7420  .        and it 
-00004670: 6973 206f 6e6c 7920 696e 7465 6e64 6564  is only intended
-00004680: 2066 6f72 2064 6562 7567 6769 6e67 2f70   for debugging/p
-00004690: 726f 6669 6c69 6e67 2070 7572 706f 7365  rofiling purpose
-000046a0: 732e 0d0a 0d0a 2020 2020 5468 6520 686f  s.....    The ho
-000046b0: 6f6b 2077 696c 6c20 6265 2063 616c 6c65  ok will be calle
-000046c0: 6420 6576 6572 7920 7469 6d65 2074 6865  d every time the
-000046d0: 2067 7261 6469 656e 7473 2077 6974 6820   gradients with 
-000046e0: 7265 7370 6563 7420 746f 2061 206d 6f64  respect to a mod
-000046f0: 756c 650d 0a20 2020 2061 7265 2063 6f6d  ule..    are com
-00004700: 7075 7465 642c 2069 2e65 2e20 7468 6520  puted, i.e. the 
-00004710: 686f 6f6b 2077 696c 6c20 6578 6563 7574  hook will execut
-00004720: 6520 6966 2061 6e64 206f 6e6c 7920 6966  e if and only if
-00004730: 2074 6865 2067 7261 6469 656e 7473 2077   the gradients w
-00004740: 6974 680d 0a20 2020 2072 6573 7065 6374  ith..    respect
-00004750: 2074 6f20 6d6f 6475 6c65 206f 7574 7075   to module outpu
-00004760: 7473 2061 7265 2063 6f6d 7075 7465 642e  ts are computed.
-00004770: 2054 6865 2068 6f6f 6b20 7368 6f75 6c64   The hook should
-00004780: 2068 6176 6520 7468 6520 666f 6c6c 6f77   have the follow
-00004790: 696e 670d 0a20 2020 2073 6967 6e61 7475  ing..    signatu
-000047a0: 7265 3a3a 0d0a 0d0a 2020 2020 2020 2020  re::....        
-000047b0: 686f 6f6b 286d 6f64 756c 652c 2067 7261  hook(module, gra
-000047c0: 645f 696e 7075 742c 2067 7261 645f 6f75  d_input, grad_ou
-000047d0: 7470 7574 2920 2d3e 2054 656e 736f 7220  tput) -> Tensor 
-000047e0: 6f72 204e 6f6e 650d 0a0d 0a20 2020 2054  or None....    T
-000047f0: 6865 203a 6174 7472 3a60 6772 6164 5f69  he :attr:`grad_i
-00004800: 6e70 7574 6020 616e 6420 3a61 7474 723a  nput` and :attr:
-00004810: 6067 7261 645f 6f75 7470 7574 6020 6172  `grad_output` ar
-00004820: 6520 7475 706c 6573 2e20 5468 6520 686f  e tuples. The ho
-00004830: 6f6b 2073 686f 756c 640d 0a20 2020 206e  ok should..    n
-00004840: 6f74 206d 6f64 6966 7920 6974 7320 6172  ot modify its ar
-00004850: 6775 6d65 6e74 732c 2062 7574 2069 7420  guments, but it 
-00004860: 6361 6e20 6f70 7469 6f6e 616c 6c79 2072  can optionally r
-00004870: 6574 7572 6e20 6120 6e65 7720 6772 6164  eturn a new grad
-00004880: 6965 6e74 2077 6974 680d 0a20 2020 2072  ient with..    r
-00004890: 6573 7065 6374 2074 6f20 7468 6520 696e  espect to the in
-000048a0: 7075 7420 7468 6174 2077 696c 6c20 6265  put that will be
-000048b0: 2075 7365 6420 696e 2070 6c61 6365 206f   used in place o
-000048c0: 6620 3a61 7474 723a 6067 7261 645f 696e  f :attr:`grad_in
-000048d0: 7075 7460 2069 6e0d 0a20 2020 2073 7562  put` in..    sub
-000048e0: 7365 7175 656e 7420 636f 6d70 7574 6174  sequent computat
-000048f0: 696f 6e73 2e20 3a61 7474 723a 6067 7261  ions. :attr:`gra
-00004900: 645f 696e 7075 7460 2077 696c 6c20 6f6e  d_input` will on
-00004910: 6c79 2063 6f72 7265 7370 6f6e 6420 746f  ly correspond to
-00004920: 2074 6865 2069 6e70 7574 7320 6769 7665   the inputs give
-00004930: 6e0d 0a20 2020 2061 7320 706f 7369 7469  n..    as positi
-00004940: 6f6e 616c 2061 7267 756d 656e 7473 2061  onal arguments a
-00004950: 6e64 2061 6c6c 206b 7761 7267 2061 7267  nd all kwarg arg
-00004960: 756d 656e 7473 2077 696c 6c20 6e6f 7420  uments will not 
-00004970: 6170 7065 6172 2069 6e20 7468 6520 686f  appear in the ho
-00004980: 6f6b 2e20 456e 7472 6965 730d 0a20 2020  ok. Entries..   
-00004990: 2069 6e20 3a61 7474 723a 6067 7261 645f   in :attr:`grad_
-000049a0: 696e 7075 7460 2061 6e64 203a 6174 7472  input` and :attr
-000049b0: 3a60 6772 6164 5f6f 7574 7075 7460 2077  :`grad_output` w
-000049c0: 696c 6c20 6265 2060 604e 6f6e 6560 6020  ill be ``None`` 
-000049d0: 666f 7220 616c 6c20 6e6f 6e2d 5465 6e73  for all non-Tens
-000049e0: 6f72 0d0a 2020 2020 6172 6775 6d65 6e74  or..    argument
-000049f0: 732e 0d0a 0d0a 2020 2020 466f 7220 7465  s.....    For te
-00004a00: 6368 6e69 6361 6c20 7265 6173 6f6e 732c  chnical reasons,
-00004a10: 2077 6865 6e20 7468 6973 2068 6f6f 6b20   when this hook 
-00004a20: 6973 2061 7070 6c69 6564 2074 6f20 6120  is applied to a 
-00004a30: 4d6f 6475 6c65 2c20 6974 7320 666f 7277  Module, its forw
-00004a40: 6172 6420 6675 6e63 7469 6f6e 2077 696c  ard function wil
-00004a50: 6c0d 0a20 2020 2072 6563 6569 7665 2061  l..    receive a
-00004a60: 2076 6965 7720 6f66 2065 6163 6820 5465   view of each Te
-00004a70: 6e73 6f72 2070 6173 7365 6420 746f 2074  nsor passed to t
-00004a80: 6865 204d 6f64 756c 652e 2053 696d 696c  he Module. Simil
-00004a90: 6172 6c79 2074 6865 2063 616c 6c65 7220  arly the caller 
-00004aa0: 7769 6c6c 2072 6563 6569 7665 2061 2076  will receive a v
-00004ab0: 6965 770d 0a20 2020 206f 6620 6561 6368  iew..    of each
-00004ac0: 2054 656e 736f 7220 7265 7475 726e 6564   Tensor returned
-00004ad0: 2062 7920 7468 6520 4d6f 6475 6c65 2773   by the Module's
-00004ae0: 2066 6f72 7761 7264 2066 756e 6374 696f   forward functio
-00004af0: 6e2e 0d0a 0d0a 2020 2020 476c 6f62 616c  n.....    Global
-00004b00: 2068 6f6f 6b73 2061 7265 2063 616c 6c65   hooks are calle
-00004b10: 6420 6265 666f 7265 2068 6f6f 6b73 2072  d before hooks r
-00004b20: 6567 6973 7465 7265 6420 7769 7468 2060  egistered with `
-00004b30: 7265 6769 7374 6572 5f62 6163 6b77 6172  register_backwar
-00004b40: 645f 686f 6f6b 600d 0a0d 0a20 2020 2052  d_hook`....    R
-00004b50: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-00004b60: 203a 636c 6173 733a 6074 6f72 6368 2e75   :class:`torch.u
-00004b70: 7469 6c73 2e68 6f6f 6b73 2e52 656d 6f76  tils.hooks.Remov
-00004b80: 6162 6c65 4861 6e64 6c65 603a 0d0a 2020  ableHandle`:..  
-00004b90: 2020 2020 2020 2020 2020 6120 6861 6e64            a hand
-00004ba0: 6c65 2074 6861 7420 6361 6e20 6265 2075  le that can be u
-00004bb0: 7365 6420 746f 2072 656d 6f76 6520 7468  sed to remove th
-00004bc0: 6520 6164 6465 6420 686f 6f6b 2062 7920  e added hook by 
-00004bd0: 6361 6c6c 696e 670d 0a20 2020 2020 2020  calling..       
-00004be0: 2020 2020 2060 6068 616e 646c 652e 7265       ``handle.re
-00004bf0: 6d6f 7665 2829 6060 0d0a 0d0a 2020 2020  move()``....    
-00004c00: 2222 220d 0a20 2020 2067 6c6f 6261 6c20  """..    global 
-00004c10: 5f67 6c6f 6261 6c5f 6973 5f66 756c 6c5f  _global_is_full_
-00004c20: 6261 636b 7761 7264 5f68 6f6f 6b0d 0a20  backward_hook.. 
-00004c30: 2020 2069 6620 5f67 6c6f 6261 6c5f 6973     if _global_is
-00004c40: 5f66 756c 6c5f 6261 636b 7761 7264 5f68  _full_backward_h
-00004c50: 6f6f 6b20 6973 2046 616c 7365 3a0d 0a20  ook is False:.. 
-00004c60: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-00004c70: 7469 6d65 4572 726f 7228 2243 616e 6e6f  timeError("Canno
-00004c80: 7420 7573 6520 626f 7468 2072 6567 756c  t use both regul
-00004c90: 6172 2062 6163 6b77 6172 6420 686f 6f6b  ar backward hook
-00004ca0: 7320 616e 6420 6675 6c6c 2062 6163 6b77  s and full backw
-00004cb0: 6172 6420 686f 6f6b 7320 6173 2061 2022  ard hooks as a "
-00004cc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004cd0: 2020 2020 2020 2020 2020 2020 2022 676c               "gl
-00004ce0: 6f62 616c 204d 6f64 756c 6520 686f 6f6b  obal Module hook
-00004cf0: 2e20 506c 6561 7365 2075 7365 206f 6e6c  . Please use onl
-00004d00: 7920 6f6e 6520 6f66 2074 6865 6d2e 2229  y one of them.")
-00004d10: 0d0a 0d0a 2020 2020 5f67 6c6f 6261 6c5f  ....    _global_
-00004d20: 6973 5f66 756c 6c5f 6261 636b 7761 7264  is_full_backward
-00004d30: 5f68 6f6f 6b20 3d20 5472 7565 0d0a 0d0a  _hook = True....
-00004d40: 2020 2020 6861 6e64 6c65 203d 2052 656d      handle = Rem
-00004d50: 6f76 6162 6c65 4861 6e64 6c65 285f 676c  ovableHandle(_gl
-00004d60: 6f62 616c 5f62 6163 6b77 6172 645f 686f  obal_backward_ho
-00004d70: 6f6b 7329 0d0a 2020 2020 5f67 6c6f 6261  oks)..    _globa
-00004d80: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b73  l_backward_hooks
-00004d90: 5b68 616e 646c 652e 6964 5d20 3d20 686f  [handle.id] = ho
-00004da0: 6f6b 0d0a 2020 2020 7265 7475 726e 2068  ok..    return h
-00004db0: 616e 646c 650d 0a0d 0a0d 0a23 2054 7269  andle......# Tri
-00004dc0: 636b 206d 7970 7920 696e 746f 206e 6f74  ck mypy into not
-00004dd0: 2061 7070 6c79 696e 6720 636f 6e74 7261   applying contra
-00004de0: 7661 7269 616e 6365 2072 756c 6573 2074  variance rules t
-00004df0: 6f20 696e 7075 7473 2062 7920 6465 6669  o inputs by defi
-00004e00: 6e69 6e67 0d0a 2320 666f 7277 6172 6420  ning..# forward 
-00004e10: 6173 2061 2076 616c 7565 2c20 7261 7468  as a value, rath
-00004e20: 6572 2074 6861 6e20 6120 6675 6e63 7469  er than a functi
-00004e30: 6f6e 2e20 2053 6565 2061 6c73 6f0d 0a23  on.  See also..#
-00004e40: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-00004e50: 636f 6d2f 7079 7468 6f6e 2f6d 7970 792f  com/python/mypy/
-00004e60: 6973 7375 6573 2f38 3739 350d 0a64 6566  issues/8795..def
-00004e70: 205f 666f 7277 6172 645f 756e 696d 706c   _forward_unimpl
-00004e80: 656d 656e 7465 6428 7365 6c66 2c20 2a69  emented(self, *i
-00004e90: 6e70 7574 3a20 416e 7929 202d 3e20 4e6f  nput: Any) -> No
-00004ea0: 6e65 3a0d 0a20 2020 2072 2222 2244 6566  ne:..    r"""Def
-00004eb0: 696e 6573 2074 6865 2063 6f6d 7075 7461  ines the computa
-00004ec0: 7469 6f6e 2070 6572 666f 726d 6564 2061  tion performed a
-00004ed0: 7420 6576 6572 7920 6361 6c6c 2e0d 0a0d  t every call....
-00004ee0: 0a20 2020 2053 686f 756c 6420 6265 206f  .    Should be o
-00004ef0: 7665 7272 6964 6465 6e20 6279 2061 6c6c  verridden by all
-00004f00: 2073 7562 636c 6173 7365 732e 0d0a 0d0a   subclasses.....
-00004f10: 2020 2020 2e2e 206e 6f74 653a 3a0d 0a20      .. note::.. 
-00004f20: 2020 2020 2020 2041 6c74 686f 7567 6820         Although 
-00004f30: 7468 6520 7265 6369 7065 2066 6f72 2066  the recipe for f
-00004f40: 6f72 7761 7264 2070 6173 7320 6e65 6564  orward pass need
-00004f50: 7320 746f 2062 6520 6465 6669 6e65 6420  s to be defined 
-00004f60: 7769 7468 696e 0d0a 2020 2020 2020 2020  within..        
-00004f70: 7468 6973 2066 756e 6374 696f 6e2c 206f  this function, o
-00004f80: 6e65 2073 686f 756c 6420 6361 6c6c 2074  ne should call t
-00004f90: 6865 203a 636c 6173 733a 604d 6f64 756c  he :class:`Modul
-00004fa0: 6560 2069 6e73 7461 6e63 6520 6166 7465  e` instance afte
-00004fb0: 7277 6172 6473 0d0a 2020 2020 2020 2020  rwards..        
-00004fc0: 696e 7374 6561 6420 6f66 2074 6869 7320  instead of this 
-00004fd0: 7369 6e63 6520 7468 6520 666f 726d 6572  since the former
-00004fe0: 2074 616b 6573 2063 6172 6520 6f66 2072   takes care of r
-00004ff0: 756e 6e69 6e67 2074 6865 0d0a 2020 2020  unning the..    
-00005000: 2020 2020 7265 6769 7374 6572 6564 2068      registered h
-00005010: 6f6f 6b73 2077 6869 6c65 2074 6865 206c  ooks while the l
-00005020: 6174 7465 7220 7369 6c65 6e74 6c79 2069  atter silently i
-00005030: 676e 6f72 6573 2074 6865 6d2e 0d0a 2020  gnores them...  
-00005040: 2020 2222 220d 0a20 2020 2072 6169 7365    """..    raise
-00005050: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-00005060: 7272 6f72 2866 224d 6f64 756c 6520 5b7b  rror(f"Module [{
-00005070: 7479 7065 2873 656c 6629 2e5f 5f6e 616d  type(self).__nam
-00005080: 655f 5f7d 5d20 6973 206d 6973 7369 6e67  e__}] is missing
-00005090: 2074 6865 2072 6571 7569 7265 6420 5c22   the required \"
-000050a0: 666f 7277 6172 645c 2220 6675 6e63 7469  forward\" functi
-000050b0: 6f6e 2229 0d0a 0d0a 0d0a 2320 6465 6620  on")......# def 
-000050c0: 5061 7261 6d65 7465 7228 6461 7461 2c20  Parameter(data, 
-000050d0: 7472 6169 6e61 626c 653d 5472 7565 2c20  trainable=True, 
-000050e0: 6474 7970 653d 4e6f 6e65 2c20 6e61 6d65  dtype=None, name
-000050f0: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-00005100: 3a0d 0a23 2020 2020 2069 6620 6474 7970  :..#     if dtyp
-00005110: 6520 6973 204e 6f6e 653a 0d0a 2320 2020  e is None:..#   
-00005120: 2020 2020 2020 6474 7970 6520 3d20 7466        dtype = tf
-00005130: 2e66 6c6f 6174 3332 0d0a 2320 2020 2020  .float32..#     
-00005140: 7265 7475 726e 2074 662e 5661 7269 6162  return tf.Variab
-00005150: 6c65 2869 6e69 7469 616c 5f76 616c 7565  le(initial_value
-00005160: 3d63 6173 7428 6461 7461 2c20 6474 7970  =cast(data, dtyp
-00005170: 6529 2c20 7472 6169 6e61 626c 653d 7472  e), trainable=tr
-00005180: 6169 6e61 626c 652c 206e 616d 653d 6e61  ainable, name=na
-00005190: 6d65 290d 0a0d 0a0d 0a64 6566 2050 6172  me)......def Par
-000051a0: 616d 6574 6572 2864 6174 612c 2074 7261  ameter(data, tra
-000051b0: 696e 6162 6c65 3d54 7275 652c 206e 616d  inable=True, nam
-000051c0: 653d 4e6f 6e65 293a 0d0a 2020 2020 7265  e=None):..    re
-000051d0: 7475 726e 2074 662e 5661 7269 6162 6c65  turn tf.Variable
-000051e0: 2869 6e69 7469 616c 5f76 616c 7565 3d64  (initial_value=d
-000051f0: 6174 612c 2074 7261 696e 6162 6c65 3d74  ata, trainable=t
-00005200: 7261 696e 6162 6c65 2c20 6474 7970 653d  rainable, dtype=
-00005210: 6461 7461 2e64 7479 7065 2c20 6e61 6d65  data.dtype, name
-00005220: 3d6e 616d 6529 0d0a 0d0a 0d0a 636c 6173  =name)......clas
-00005230: 7320 4c61 7965 7228 7466 2e4d 6f64 756c  s Layer(tf.Modul
-00005240: 6529 3a0d 0a20 2020 2022 2222 5472 6964  e):..    """Trid
-00005250: 656e 7420 6578 7465 6e65 6420 7466 2e4d  ent extened tf.M
-00005260: 6f64 756c 6520 6173 2062 6173 6520 6c61  odule as base la
-00005270: 7965 7220 636c 6173 732e 0d0a 0d0a 2020  yer class.....  
-00005280: 2059 6f75 7220 6d6f 6465 6c73 2073 686f   Your models sho
-00005290: 756c 6420 616c 736f 2073 7562 636c 6173  uld also subclas
-000052a0: 7320 6f66 2074 6869 7320 636c 6173 732e  s of this class.
-000052b0: 0d0a 2020 2020 4c61 7965 7220 636f 6e74  ..    Layer cont
-000052c0: 6169 6e73 203a 0d0a 2020 2020 2020 2020  ains :..        
-000052d0: 6d6f 6475 6c65 733a 2061 6e6f 7468 6572  modules: another
-000052e0: 2063 6869 6c64 206c 6179 6572 286d 6f64   child layer(mod
-000052f0: 756c 6529 2069 6e20 6974 2e0d 0a20 2020  ule) in it...   
-00005300: 2020 2020 2070 6172 616d 6574 6572 733a       parameters:
-00005310: 2074 6865 2074 7261 696e 6162 6c65 2070   the trainable p
-00005320: 6172 616d 6574 6572 7320 696e 2074 6865  arameters in the
-00005330: 206c 6179 6572 2e0d 0a20 2020 2020 2020   layer...       
-00005340: 2062 7566 6665 7273 3a20 7468 6520 6f74   buffers: the ot
-00005350: 6865 7220 6e6f 6e5f 7472 6169 6e61 626c  her non_trainabl
-00005360: 6520 7465 6e73 6f72 2069 6e20 7468 6520  e tensor in the 
-00005370: 6c61 7965 722e 0d0a 0d0a 0d0a 2020 2020  layer.......    
-00005380: 4174 7472 6962 7574 6573 203a 0d0a 2020  Attributes :..  
-00005390: 2020 2020 2020 7472 6169 6e69 6e67 2028        training (
-000053a0: 626f 6f6c 293a 2049 6620 5472 7565 2c20  bool): If True, 
-000053b0: 6d65 616e 7320 696e 2074 6865 2074 7261  means in the tra
-000053c0: 696e 696e 6720 7068 6173 652c 2065 6c73  ining phase, els
-000053d0: 6520 696e 2074 6865 2069 6e66 6572 206f  e in the infer o
-000053e0: 7220 6576 616c 7561 7469 6f6e 2070 6861  r evaluation pha
-000053f0: 7365 2e0d 0a0d 0a20 2020 2020 2020 2072  se.....        r
-00005400: 616e 6b20 2869 6e74 293a 2054 6865 206e  ank (int): The n
-00005410: 756d 6265 7220 6f66 2074 6865 2073 7061  umber of the spa
-00005420: 7469 616c 2072 656c 6174 6564 2061 7865  tial related axe
-00005430: 732e 0d0a 0d0a 2020 2020 2020 2020 5f6d  s.....        _m
-00005440: 6f64 756c 6573 2028 4f72 6465 7265 6444  odules (OrderedD
-00005450: 6963 7429 203a 2073 746f 7261 6765 206f  ict) : storage o
-00005460: 6620 616c 6c20 7468 6520 7375 622d 6d6f  f all the sub-mo
-00005470: 6475 6c65 732e 0d0a 0d0a 2020 2020 2020  dules.....      
-00005480: 2020 5f70 6172 616d 6574 6572 7320 284f    _parameters (O
-00005490: 7264 6572 6564 4469 6374 2920 3a20 7374  rderedDict) : st
-000054a0: 6f72 6167 6520 6f66 2061 6c6c 2074 6865  orage of all the
-000054b0: 2074 7261 6e61 626c 6520 7765 6967 6874   tranable weight
-000054c0: 732e 0d0a 0d0a 2020 2020 2020 2020 5f62  s.....        _b
-000054d0: 7566 6665 7273 2028 4f72 6465 7265 6444  uffers (OrderedD
-000054e0: 6963 7429 203a 2073 746f 7261 6765 206f  ict) : storage o
-000054f0: 6620 616c 6c20 7468 6520 6e6f 6e2d 7472  f all the non-tr
-00005500: 6169 6e61 626c 6520 7465 6e73 6f72 2e0d  ainable tensor..
-00005510: 0a0d 0a20 2020 2020 2020 205f 666f 7277  ...        _forw
-00005520: 6172 645f 686f 6f6b 7320 284f 7264 6572  ard_hooks (Order
-00005530: 6564 4469 6374 2920 3a20 7374 6f72 6167  edDict) : storag
-00005540: 6520 6f66 2061 6c6c 2074 6865 2068 6f6f  e of all the hoo
-00005550: 6b73 2074 7269 6767 6572 6564 2062 6566  ks triggered bef
-00005560: 6f72 6520 7468 6520 666f 7277 6172 6420  ore the forward 
-00005570: 6578 6563 7574 696f 6e2e 0d0a 0d0a 2020  execution.....  
-00005580: 2020 2020 2020 5f66 6f72 7761 7264 5f70        _forward_p
-00005590: 7265 5f68 6f6f 6b73 2028 4f72 6465 7265  re_hooks (Ordere
-000055a0: 6444 6963 7429 203a 2073 746f 7261 6765  dDict) : storage
-000055b0: 206f 6620 616c 6c20 7468 6520 686f 6f6b   of all the hook
-000055c0: 7320 7472 6967 6765 7265 6420 2061 6674  s triggered  aft
-000055d0: 6572 2074 6865 2066 6f72 7761 7264 2065  er the forward e
-000055e0: 7865 6375 7469 6f6e 2e0d 0a0d 0a20 2020  xecution.....   
-000055f0: 2020 2020 205f 7374 6174 655f 6469 6374       _state_dict
-00005600: 5f68 6f6f 6b73 2028 4f72 6465 7265 6444  _hooks (OrderedD
-00005610: 6963 7429 203a 2073 746f 7261 6765 206f  ict) : storage o
-00005620: 6620 616c 6c20 7468 6520 686f 6f6b 7320  f all the hooks 
-00005630: 7472 6967 6765 7265 6420 2077 6865 6e20  triggered  when 
-00005640: 7374 6174 655f 6469 6374 2067 656e 6572  state_dict gener
-00005650: 6174 696e 6720 2065 7865 6375 7469 6f6e  ating  execution
-00005660: 2e0d 0a0d 0a20 2020 2020 2020 205f 6c6f  .....        _lo
-00005670: 6164 5f73 7461 7465 5f64 6963 745f 7072  ad_state_dict_pr
-00005680: 655f 686f 6f6b 7320 284f 7264 6572 6564  e_hooks (Ordered
-00005690: 4469 6374 2920 3a20 7374 6f72 6167 6520  Dict) : storage 
-000056a0: 6f66 2061 6c6c 2074 6865 2068 6f6f 6b73  of all the hooks
-000056b0: 2074 7269 6767 6572 6564 2020 7768 656e   triggered  when
-000056c0: 206c 6f61 6469 6e67 2073 7461 7465 5f64   loading state_d
-000056d0: 6963 7420 2020 6578 6563 7574 696f 6e2e  ict   execution.
-000056e0: 0d0a 0d0a 2020 2020 2020 2020 696e 7075  ....        inpu
-000056f0: 745f 6669 6c74 6572 7320 2869 6e74 293a  t_filters (int):
-00005700: 2069 6e70 7574 2063 6861 6e6e 656c 730d   input channels.
-00005710: 0a0d 0a20 2020 2020 2020 2073 6967 6e61  ...        signa
-00005720: 7475 7265 2028 696e 7429 3a20 7468 6520  ture (int): the 
-00005730: 6675 6e63 7469 6f6e 2073 6967 6e61 7475  function signatu
-00005740: 7265 206f 6620 7468 6973 206c 6179 6572  re of this layer
-00005750: 2e0d 0a0d 0a20 2020 2020 2020 2064 6566  .....        def
-00005760: 6175 6c74 5f6e 616d 653a 2064 6566 6175  ault_name: defau
-00005770: 6c74 5f6e 616d 6520 6973 2074 6865 2073  lt_name is the s
-00005780: 616d 6520 636f 6e63 6570 7420 6173 2069  ame concept as i
-00005790: 6e20 6b65 7261 732c 2069 7420 636f 6d65  n keras, it come
-000057a0: 7320 6672 6f6d 2063 6c61 7373 206e 616d  s from class nam
-000057b0: 6520 7769 7468 2073 6571 7565 6e63 6520  e with sequence 
-000057c0: 6e75 6d62 6572 2e0d 0a0d 0a20 2020 2020  number.....     
-000057d0: 2020 2072 656c 6174 6976 655f 6e61 6d65     relative_name
-000057e0: 3a72 656c 6174 6976 655f 6e61 6d65 2069  :relative_name i
-000057f0: 7320 7468 6520 7361 6d65 2063 6f6e 6365  s the same conce
-00005800: 7074 2061 7320 6e61 6d65 645f 6d6f 6475  pt as named_modu
-00005810: 6c65 7320 696e 2070 7974 6f72 6368 2e20  les in pytorch. 
-00005820: 4275 7420 696e 2070 7974 6f72 6368 2c20  But in pytorch, 
-00005830: 796f 7520 6e65 6564 2074 6f20 6765 7420  you need to get 
-00005840: 7468 6520 6e61 6d65 2066 726f 6d20 6765  the name from ge
-00005850: 6e65 7261 746f 7220 656e 756d 6572 6174  nerator enumerat
-00005860: 696f 6e2e 2049 6e20 7472 6964 656e 742c  ion. In trident,
-00005870: 2079 6f75 2063 616e 2061 6363 6573 7320   you can access 
-00005880: 7468 6520 7265 6c61 7469 7665 206e 616d  the relative nam
-00005890: 6520 2077 6974 6820 7468 6973 2061 7474  e  with this att
-000058a0: 7269 6275 7465 2e0d 0a0d 0a20 2020 2052  ribute.....    R
-000058b0: 6566 6572 656e 6365 733a 0d0a 2020 2020  eferences:..    
-000058c0: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
-000058d0: 7562 2e63 6f6d 2f74 656e 736f 7266 6c6f  ub.com/tensorflo
-000058e0: 772f 7465 6e73 6f72 666c 6f77 2f62 6c6f  w/tensorflow/blo
-000058f0: 622f 7632 2e32 2e30 2f74 656e 736f 7266  b/v2.2.0/tensorf
-00005900: 6c6f 772f 7079 7468 6f6e 2f6d 6f64 756c  low/python/modul
-00005910: 652f 6d6f 6475 6c65 2e70 7923 4c33 352d  e/module.py#L35-
-00005920: 4c32 3931 0d0a 0d0a 0d0a 2020 2020 2222  L291......    ""
-00005930: 220d 0a20 2020 205f 7665 7273 696f 6e20  "..    _version 
-00005940: 3d20 310d 0a20 2020 205f 6275 696c 743a  = 1..    _built:
-00005950: 2062 6f6f 6c0d 0a20 2020 2074 7261 696e   bool..    train
-00005960: 696e 673a 2062 6f6f 6c0d 0a20 2020 205f  ing: bool..    _
-00005970: 7061 7261 6d65 7465 7273 3a20 4469 6374  parameters: Dict
-00005980: 5b73 7472 2c20 4f70 7469 6f6e 616c 5b50  [str, Optional[P
-00005990: 6172 616d 6574 6572 5d5d 0d0a 2020 2020  arameter]]..    
-000059a0: 5f62 7566 6665 7273 3a20 4469 6374 5b73  _buffers: Dict[s
-000059b0: 7472 2c20 4f70 7469 6f6e 616c 5b54 656e  tr, Optional[Ten
-000059c0: 736f 725d 5d0d 0a20 2020 205f 6e6f 6e5f  sor]]..    _non_
-000059d0: 7065 7273 6973 7465 6e74 5f62 7566 6665  persistent_buffe
-000059e0: 7273 5f73 6574 3a20 5365 745b 7374 725d  rs_set: Set[str]
-000059f0: 0d0a 2020 2020 5f62 6163 6b77 6172 645f  ..    _backward_
-00005a00: 7072 655f 686f 6f6b 733a 2044 6963 745b  pre_hooks: Dict[
-00005a10: 696e 742c 2043 616c 6c61 626c 655d 0d0a  int, Callable]..
-00005a20: 2020 2020 5f62 6163 6b77 6172 645f 686f      _backward_ho
-00005a30: 6f6b 733a 2044 6963 745b 696e 742c 2043  oks: Dict[int, C
-00005a40: 616c 6c61 626c 655d 0d0a 2020 2020 5f69  allable]..    _i
-00005a50: 735f 6675 6c6c 5f62 6163 6b77 6172 645f  s_full_backward_
-00005a60: 686f 6f6b 3a20 4f70 7469 6f6e 616c 5b62  hook: Optional[b
-00005a70: 6f6f 6c5d 0d0a 2020 2020 5f66 6f72 7761  ool]..    _forwa
-00005a80: 7264 5f68 6f6f 6b73 3a20 4469 6374 5b69  rd_hooks: Dict[i
-00005a90: 6e74 2c20 4361 6c6c 6162 6c65 5d0d 0a20  nt, Callable].. 
-00005aa0: 2020 2023 204d 6172 6b73 2077 6865 7468     # Marks wheth
-00005ab0: 6572 2074 6865 2063 6f72 7265 7370 6f6e  er the correspon
-00005ac0: 6469 6e67 205f 666f 7277 6172 645f 686f  ding _forward_ho
-00005ad0: 6f6b 7320 6163 6365 7074 206b 7761 7267  oks accept kwarg
-00005ae0: 7320 6f72 206e 6f74 2e0d 0a20 2020 2023  s or not...    #
-00005af0: 2041 7320 4a49 5420 646f 6573 206e 6f74   As JIT does not
-00005b00: 2073 7570 706f 7274 2053 6574 5b69 6e74   support Set[int
-00005b10: 5d2c 2074 6869 7320 6469 6374 2069 7320  ], this dict is 
-00005b20: 7573 6564 2061 7320 6120 7365 742c 2077  used as a set, w
-00005b30: 6865 7265 2061 6c6c 0d0a 2020 2020 2320  here all..    # 
-00005b40: 686f 6f6b 7320 7265 7072 6573 656e 7465  hooks represente
-00005b50: 6420 696e 2074 6869 7320 6469 6374 2061  d in this dict a
-00005b60: 6363 6570 7420 6b77 6172 6773 2e0d 0a20  ccept kwargs... 
-00005b70: 2020 205f 666f 7277 6172 645f 686f 6f6b     _forward_hook
-00005b80: 735f 7769 7468 5f6b 7761 7267 733a 2044  s_with_kwargs: D
-00005b90: 6963 745b 696e 742c 2062 6f6f 6c5d 0d0a  ict[int, bool]..
-00005ba0: 2020 2020 5f66 6f72 7761 7264 5f70 7265      _forward_pre
-00005bb0: 5f68 6f6f 6b73 3a20 4469 6374 5b69 6e74  _hooks: Dict[int
-00005bc0: 2c20 4361 6c6c 6162 6c65 5d0d 0a20 2020  , Callable]..   
-00005bd0: 2023 204d 6172 6b73 2077 6865 7468 6572   # Marks whether
-00005be0: 2074 6865 2063 6f72 7265 7370 6f6e 6469   the correspondi
-00005bf0: 6e67 205f 666f 7277 6172 645f 686f 6f6b  ng _forward_hook
-00005c00: 7320 6163 6365 7074 206b 7761 7267 7320  s accept kwargs 
-00005c10: 6f72 206e 6f74 2e0d 0a20 2020 2023 2041  or not...    # A
-00005c20: 7320 4a49 5420 646f 6573 206e 6f74 2073  s JIT does not s
-00005c30: 7570 706f 7274 2053 6574 5b69 6e74 5d2c  upport Set[int],
-00005c40: 2074 6869 7320 6469 6374 2069 7320 7573   this dict is us
-00005c50: 6564 2061 7320 6120 7365 742c 2077 6865  ed as a set, whe
-00005c60: 7265 2061 6c6c 0d0a 2020 2020 2320 686f  re all..    # ho
-00005c70: 6f6b 7320 7265 7072 6573 656e 7465 6420  oks represented 
-00005c80: 696e 2074 6869 7320 6469 6374 2061 6363  in this dict acc
-00005c90: 6570 7420 6b77 6172 6773 2e0d 0a20 2020  ept kwargs...   
-00005ca0: 205f 666f 7277 6172 645f 7072 655f 686f   _forward_pre_ho
-00005cb0: 6f6b 735f 7769 7468 5f6b 7761 7267 733a  oks_with_kwargs:
-00005cc0: 2044 6963 745b 696e 742c 2062 6f6f 6c5d   Dict[int, bool]
-00005cd0: 0d0a 2020 2020 5f73 7461 7465 5f64 6963  ..    _state_dic
-00005ce0: 745f 686f 6f6b 733a 2044 6963 745b 696e  t_hooks: Dict[in
-00005cf0: 742c 2043 616c 6c61 626c 655d 0d0a 2020  t, Callable]..  
-00005d00: 2020 5f6c 6f61 645f 7374 6174 655f 6469    _load_state_di
-00005d10: 6374 5f70 7265 5f68 6f6f 6b73 3a20 4469  ct_pre_hooks: Di
-00005d20: 6374 5b69 6e74 2c20 4361 6c6c 6162 6c65  ct[int, Callable
-00005d30: 5d0d 0a20 2020 205f 7374 6174 655f 6469  ]..    _state_di
-00005d40: 6374 5f70 7265 5f68 6f6f 6b73 3a20 4469  ct_pre_hooks: Di
-00005d50: 6374 5b69 6e74 2c20 4361 6c6c 6162 6c65  ct[int, Callable
-00005d60: 5d0d 0a20 2020 205f 6c6f 6164 5f73 7461  ]..    _load_sta
-00005d70: 7465 5f64 6963 745f 706f 7374 5f68 6f6f  te_dict_post_hoo
-00005d80: 6b73 3a20 4469 6374 5b69 6e74 2c20 4361  ks: Dict[int, Ca
-00005d90: 6c6c 6162 6c65 5d0d 0a20 2020 205f 6d6f  llable]..    _mo
-00005da0: 6475 6c65 733a 2044 6963 745b 7374 722c  dules: Dict[str,
-00005db0: 204f 7074 696f 6e61 6c5b 274d 6f64 756c   Optional['Modul
-00005dc0: 6527 5d5d 0d0a 0d0a 2020 2020 6465 6620  e']]....    def 
-00005dd0: 5f5f 696e 6974 5f5f 2873 656c 662c 0d0a  __init__(self,..
-00005de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005df0: 206e 616d 653d 4e6f 6e65 2c0d 0a20 2020   name=None,..   
-00005e00: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00005e10: 6570 5f6f 7574 7075 743d 4661 6c73 652c  ep_output=False,
-00005e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005e30: 2020 2064 6576 6963 653d 4e6f 6e65 2c0d     device=None,.
-00005e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005e50: 2020 6474 7970 653d 4e6f 6e65 2c0d 0a20    dtype=None,.. 
-00005e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e70: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00005e80: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00005e90: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00005ea0: 2020 2020 6e61 6d65 2028 7374 7229 203a      name (str) :
-00005eb0: 6e61 6d65 206f 6620 7468 6520 6c61 7965  name of the laye
-00005ec0: 722e 0d0a 2020 2020 2020 2020 2020 2020  r...            
-00005ed0: 6b65 6570 5f6f 7574 7075 7420 2862 6f6f  keep_output (boo
-00005ee0: 6c29 203a 7768 6574 6865 7220 796f 7520  l) :whether you 
-00005ef0: 6e65 6564 2074 6f20 6b65 7074 206f 7574  need to kept out
-00005f00: 7075 7420 7465 6e73 6f72 2069 6e20 6578  put tensor in ex
-00005f10: 6563 7574 696f 6e20 7469 6d65 2e0d 0a0d  ecution time....
-00005f20: 0a0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00005f30: 2020 2020 2020 2020 6f62 6a65 6374 2e5f          object._
-00005f40: 5f73 6574 6174 7472 5f5f 2873 656c 662c  _setattr__(self,
-00005f50: 2027 7575 6964 272c 2075 7569 642e 7575   'uuid', uuid.uu
-00005f60: 6964 3428 292e 6e6f 6465 290d 0a20 2020  id4().node)..   
-00005f70: 2020 2020 2073 7570 6572 2829 2e5f 5f73       super().__s
-00005f80: 6574 6174 7472 5f5f 2827 7472 6169 6e69  etattr__('traini
-00005f90: 6e67 272c 2054 7275 6529 0d0a 2020 2020  ng', True)..    
-00005fa0: 2020 2020 7375 7065 7228 292e 5f5f 7365      super().__se
-00005fb0: 7461 7474 725f 5f28 275f 6275 696c 7427  tattr__('_built'
-00005fc0: 2c20 4661 6c73 6529 0d0a 0d0a 2020 2020  , False)....    
-00005fd0: 2020 2020 7375 7065 7228 292e 5f5f 7365      super().__se
-00005fe0: 7461 7474 725f 5f28 275f 7061 7261 6d65  tattr__('_parame
-00005ff0: 7465 7273 272c 204f 7264 6572 6564 4469  ters', OrderedDi
-00006000: 6374 2829 290d 0a20 2020 2020 2020 2073  ct())..        s
-00006010: 7570 6572 2829 2e5f 5f73 6574 6174 7472  uper().__setattr
-00006020: 5f5f 2827 5f62 7566 6665 7273 272c 204f  __('_buffers', O
-00006030: 7264 6572 6564 4469 6374 2829 290d 0a20  rderedDict()).. 
-00006040: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00006050: 5f73 6574 6174 7472 5f5f 2827 5f6e 6f6e  _setattr__('_non
-00006060: 5f70 6572 7369 7374 656e 745f 6275 6666  _persistent_buff
-00006070: 6572 735f 7365 7427 2c20 7365 7428 2929  ers_set', set())
-00006080: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-00006090: 292e 5f5f 7365 7461 7474 725f 5f28 275f  ).__setattr__('_
-000060a0: 6261 636b 7761 7264 5f70 7265 5f68 6f6f  backward_pre_hoo
-000060b0: 6b73 272c 204f 7264 6572 6564 4469 6374  ks', OrderedDict
-000060c0: 2829 290d 0a20 2020 2020 2020 2073 7570  ())..        sup
-000060d0: 6572 2829 2e5f 5f73 6574 6174 7472 5f5f  er().__setattr__
-000060e0: 2827 5f62 6163 6b77 6172 645f 686f 6f6b  ('_backward_hook
-000060f0: 7327 2c20 4f72 6465 7265 6444 6963 7428  s', OrderedDict(
-00006100: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
-00006110: 7228 292e 5f5f 7365 7461 7474 725f 5f28  r().__setattr__(
-00006120: 275f 6973 5f66 756c 6c5f 6261 636b 7761  '_is_full_backwa
-00006130: 7264 5f68 6f6f 6b27 2c20 4e6f 6e65 290d  rd_hook', None).
-00006140: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-00006150: 2e5f 5f73 6574 6174 7472 5f5f 2827 5f66  .__setattr__('_f
-00006160: 6f72 7761 7264 5f68 6f6f 6b73 272c 204f  orward_hooks', O
-00006170: 7264 6572 6564 4469 6374 2829 290d 0a20  rderedDict()).. 
-00006180: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00006190: 5f73 6574 6174 7472 5f5f 2827 5f66 6f72  _setattr__('_for
-000061a0: 7761 7264 5f68 6f6f 6b73 5f77 6974 685f  ward_hooks_with_
-000061b0: 6b77 6172 6773 272c 204f 7264 6572 6564  kwargs', Ordered
-000061c0: 4469 6374 2829 290d 0a20 2020 2020 2020  Dict())..       
-000061d0: 2073 7570 6572 2829 2e5f 5f73 6574 6174   super().__setat
-000061e0: 7472 5f5f 2827 5f66 6f72 7761 7264 5f70  tr__('_forward_p
-000061f0: 7265 5f68 6f6f 6b73 272c 204f 7264 6572  re_hooks', Order
-00006200: 6564 4469 6374 2829 290d 0a20 2020 2020  edDict())..     
-00006210: 2020 2073 7570 6572 2829 2e5f 5f73 6574     super().__set
-00006220: 6174 7472 5f5f 2827 5f66 6f72 7761 7264  attr__('_forward
-00006230: 5f70 7265 5f68 6f6f 6b73 5f77 6974 685f  _pre_hooks_with_
-00006240: 6b77 6172 6773 272c 204f 7264 6572 6564  kwargs', Ordered
-00006250: 4469 6374 2829 290d 0a20 2020 2020 2020  Dict())..       
-00006260: 2073 7570 6572 2829 2e5f 5f73 6574 6174   super().__setat
-00006270: 7472 5f5f 2827 5f73 7461 7465 5f64 6963  tr__('_state_dic
-00006280: 745f 686f 6f6b 7327 2c20 4f72 6465 7265  t_hooks', Ordere
-00006290: 6444 6963 7428 2929 0d0a 2020 2020 2020  dDict())..      
-000062a0: 2020 7375 7065 7228 292e 5f5f 7365 7461    super().__seta
-000062b0: 7474 725f 5f28 275f 7374 6174 655f 6469  ttr__('_state_di
-000062c0: 6374 5f70 7265 5f68 6f6f 6b73 272c 204f  ct_pre_hooks', O
-000062d0: 7264 6572 6564 4469 6374 2829 290d 0a20  rderedDict()).. 
-000062e0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-000062f0: 5f73 6574 6174 7472 5f5f 2827 5f6c 6f61  _setattr__('_loa
-00006300: 645f 7374 6174 655f 6469 6374 5f70 7265  d_state_dict_pre
-00006310: 5f68 6f6f 6b73 272c 204f 7264 6572 6564  _hooks', Ordered
-00006320: 4469 6374 2829 290d 0a20 2020 2020 2020  Dict())..       
-00006330: 2073 7570 6572 2829 2e5f 5f73 6574 6174   super().__setat
-00006340: 7472 5f5f 2827 5f6c 6f61 645f 7374 6174  tr__('_load_stat
-00006350: 655f 6469 6374 5f70 6f73 745f 686f 6f6b  e_dict_post_hook
-00006360: 7327 2c20 4f72 6465 7265 6444 6963 7428  s', OrderedDict(
-00006370: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
-00006380: 7228 292e 5f5f 7365 7461 7474 725f 5f28  r().__setattr__(
-00006390: 275f 6d6f 6475 6c65 7327 2c20 4f72 6465  '_modules', Orde
-000063a0: 7265 6444 6963 7428 2929 0d0a 2020 2020  redDict())..    
-000063b0: 2020 2020 7375 7065 7228 292e 5f5f 7365      super().__se
-000063c0: 7461 7474 725f 5f28 2766 6163 746f 7279  tattr__('factory
-000063d0: 5f6b 7761 7267 7327 2c20 7b27 6465 7669  _kwargs', {'devi
-000063e0: 6365 273a 2067 6574 5f64 6576 6963 6528  ce': get_device(
-000063f0: 292c 2027 6474 7970 6527 3a20 4474 7970  ), 'dtype': Dtyp
-00006400: 652e 666c 6f61 7433 327d 290d 0a0d 0a0d  e.float32}).....
-00006410: 0a20 2020 2020 2020 2070 7265 6669 7820  .        prefix 
-00006420: 3d20 7365 6c66 2e5f 5f63 6c61 7373 5f5f  = self.__class__
-00006430: 2e5f 5f6e 616d 655f 5f0d 0a20 2020 2020  .__name__..     
-00006440: 2020 2073 656c 662e 5f75 6964 5f70 7265     self._uid_pre
-00006450: 6669 7873 203d 207b 7d0d 0a20 2020 2020  fixs = {}..     
-00006460: 2020 2073 656c 662e 5f6e 616d 6520 3d20     self._name = 
-00006470: 6e61 6d65 0d0a 2020 2020 2020 2020 7365  name..        se
-00006480: 6c66 2e69 735f 726f 6f74 203d 2054 7275  lf.is_root = Tru
-00006490: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-000064a0: 6465 6661 756c 745f 6e61 6d65 203d 2063  default_name = c
-000064b0: 616d 656c 3273 6e61 6b65 2870 7265 6669  amel2snake(prefi
-000064c0: 7829 202b 2027 5f27 202b 2073 7472 2867  x) + '_' + str(g
-000064d0: 6574 5f67 6c6f 6261 6c5f 7569 6428 6361  et_global_uid(ca
-000064e0: 6d65 6c32 736e 616b 6528 7072 6566 6978  mel2snake(prefix
-000064f0: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
-00006500: 662e 7265 6c61 7469 7665 5f6e 616d 6520  f.relative_name 
-00006510: 3d20 2727 0d0a 2020 2020 2020 2020 7265  = ''..        re
-00006520: 7365 745f 6e61 6d65 2873 656c 662c 2073  set_name(self, s
-00006530: 656c 662e 5f75 6964 5f70 7265 6669 7873  elf._uid_prefixs
-00006540: 290d 0a0d 0a20 2020 2020 2020 2073 7570  )....        sup
-00006550: 6572 284c 6179 6572 2c20 7365 6c66 292e  er(Layer, self).
-00006560: 5f5f 696e 6974 5f5f 2829 0d0a 0d0a 2020  __init__()....  
-00006570: 2020 2020 2020 7365 6c66 2e62 6174 6368        self.batch
-00006580: 5f69 6e64 6578 203d 2030 0d0a 2020 2020  _index = 0..    
-00006590: 2020 2020 7365 6c66 2e66 696c 7465 725f      self.filter_
-000065a0: 696e 6465 7820 3d20 2d31 0d0a 0d0a 0d0a  index = -1......
-000065b0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
-000065c0: 6b20 3d20 6b77 6172 6773 2e67 6574 2827  k = kwargs.get('
-000065d0: 7261 6e6b 272c 204e 6f6e 6529 0d0a 0d0a  rank', None)....
-000065e0: 2020 2020 2020 2020 7365 6c66 2e5f 6e6f          self._no
-000065f0: 6465 7320 3d20 4f72 6465 7265 6444 6963  des = OrderedDic
-00006600: 7428 290d 0a20 2020 2020 2020 2073 656c  t()..        sel
-00006610: 662e 5f69 6e70 7574 5f73 6861 7065 3a20  f._input_shape: 
-00006620: 4f70 7469 6f6e 616c 5b4e 6f6e 652c 2054  Optional[None, T
-00006630: 656e 736f 7253 6861 7065 2c20 4c69 7374  ensorShape, List
-00006640: 5b54 656e 736f 7253 6861 7065 5d5d 203d  [TensorShape]] =
-00006650: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
-00006660: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
-00006670: 653a 204f 7074 696f 6e61 6c5b 4e6f 6e65  e: Optional[None
-00006680: 2c20 5465 6e73 6f72 5368 6170 652c 204c  , TensorShape, L
-00006690: 6973 745b 5465 6e73 6f72 5368 6170 655d  ist[TensorShape]
-000066a0: 5d20 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  ] = None....    
-000066b0: 2020 2020 7769 7468 2073 656c 662e 6e61      with self.na
-000066c0: 6d65 5f73 636f 7065 3a0d 0a0d 0a20 2020  me_scope:....   
-000066d0: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-000066e0: 6e70 7574 5f73 6861 7065 203d 204e 6f6e  nput_shape = Non
-000066f0: 650d 0a20 2020 2020 2020 2020 2020 2073  e..            s
-00006700: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
-00006710: 6520 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  e = None....    
-00006720: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
-00006730: 7574 5f66 696c 7465 7273 203d 204e 6f6e  ut_filters = Non
-00006740: 650d 0a20 2020 2020 2020 2020 2020 2073  e..            s
-00006750: 656c 662e 696e 7075 745f 7370 6563 203d  elf.input_spec =
-00006760: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-00006770: 2020 2020 2073 656c 662e 6b65 6570 5f6f       self.keep_o
-00006780: 7574 7075 7420 3d20 6b65 6570 5f6f 7574  utput = keep_out
-00006790: 7075 740d 0a20 2020 2020 2020 2020 2020  put..           
-000067a0: 2073 656c 662e 5f6f 7574 7075 745f 7465   self._output_te
-000067b0: 6e73 6f72 203d 204e 6f6e 650d 0a20 2020  nsor = None..   
-000067c0: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-000067d0: 6967 6e61 7475 7265 203d 204e 6f6e 650d  ignature = None.
-000067e0: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
-000067f0: 656c 662e 6475 6d70 5f70 6174 6368 6573  elf.dump_patches
-00006800: 203d 2054 7275 650d 0a0d 0a0d 0a0d 0a20   = True........ 
-00006810: 2020 2023 2054 7269 636b 206d 7970 7920     # Trick mypy 
-00006820: 696e 746f 206e 6f74 2061 7070 6c79 696e  into not applyin
-00006830: 6720 636f 6e74 7261 7661 7269 616e 6365  g contravariance
-00006840: 2072 756c 6573 2074 6f20 696e 7075 7473   rules to inputs
-00006850: 2062 7920 6465 6669 6e69 6e67 0d0a 2020   by defining..  
-00006860: 2020 2320 666f 7277 6172 6420 6173 2061    # forward as a
-00006870: 2076 616c 7565 2c20 7261 7468 6572 2074   value, rather t
-00006880: 6861 6e20 6120 6675 6e63 7469 6f6e 2e20  han a function. 
-00006890: 2053 6565 2061 6c73 6f0d 0a20 2020 2023   See also..    #
-000068a0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-000068b0: 636f 6d2f 7079 7468 6f6e 2f6d 7970 792f  com/python/mypy/
-000068c0: 6973 7375 6573 2f38 3739 350d 0a20 2020  issues/8795..   
-000068d0: 2066 6f72 7761 7264 3a20 4361 6c6c 6162   forward: Callab
-000068e0: 6c65 5b2e 2e2e 2c20 416e 795d 203d 205f  le[..., Any] = _
-000068f0: 666f 7277 6172 645f 756e 696d 706c 656d  forward_unimplem
-00006900: 656e 7465 640d 0a0d 0a20 2020 2023 2064  ented....    # d
-00006910: 6566 2066 6f72 7761 7264 2873 656c 662c  ef forward(self,
-00006920: 202a 696e 7075 742c 202a 2a6b 7761 7267   *input, **kwarg
-00006930: 7329 3a0d 0a20 2020 2023 2020 2020 2072  s):..    #     r
-00006940: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-00006950: 7465 6445 7272 6f72 0d0a 0d0a 2020 2020  tedError....    
-00006960: 6465 6620 6765 745f 726f 6f74 2873 656c  def get_root(sel
-00006970: 6629 3a0d 0a20 2020 2020 2020 2069 6620  f):..        if 
-00006980: 6e6f 7420 6861 7361 7474 7228 7365 6c66  not hasattr(self
-00006990: 2c20 275f 6e6f 6465 7327 2920 6f72 2073  , '_nodes') or s
-000069a0: 656c 662e 5f6e 6f64 6573 2069 7320 4e6f  elf._nodes is No
-000069b0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000069c0: 2073 656c 662e 6973 5f72 6f6f 7420 3d20   self.is_root = 
-000069d0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-000069e0: 2020 7265 7475 726e 2073 656c 660d 0a20    return self.. 
-000069f0: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-00006a00: 7365 6c66 2e5f 6e6f 6465 7329 203e 2030  self._nodes) > 0
-00006a10: 2061 6e64 2073 656c 662e 5f6e 6f64 6573   and self._nodes
-00006a20: 2e76 616c 7565 5f6c 6973 745b 305d 2e69  .value_list[0].i
-00006a30: 735f 726f 6f74 3a0d 0a20 2020 2020 2020  s_root:..       
-00006a40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00006a50: 2e5f 6e6f 6465 732e 7661 6c75 655f 6c69  ._nodes.value_li
-00006a60: 7374 5b30 5d0d 0a20 2020 2020 2020 2065  st[0]..        e
-00006a70: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00006a80: 2020 666f 7220 6e61 6d65 2c20 6e6f 6465    for name, node
-00006a90: 2069 6e20 7365 6c66 2e5f 6e6f 6465 732e   in self._nodes.
-00006aa0: 6974 656d 5f6c 6973 743a 0d0a 2020 2020  item_list:..    
-00006ab0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00006ac0: 6f64 652e 6973 5f72 6f6f 743a 0d0a 2020  ode.is_root:..  
-00006ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ae0: 2020 7265 7475 726e 206e 6f64 650d 0a20    return node.. 
-00006af0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00006b00: 6e20 7365 6c66 0d0a 0d0a 2020 2020 4070  n self....    @p
-00006b10: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-00006b20: 206e 616d 6528 7365 6c66 293a 0d0a 2020   name(self):..  
-00006b30: 2020 2020 2020 2222 224e 616d 6520 6f66        """Name of
-00006b40: 2074 6865 206c 6179 6572 2028 7374 7269   the layer (stri
-00006b50: 6e67 292c 2073 6574 2069 6e20 7468 6520  ng), set in the 
-00006b60: 636f 6e73 7472 7563 746f 722e 2222 220d  constructor.""".
-00006b70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006b80: 7365 6c66 2e5f 6e61 6d65 0d0a 0d0a 2020  self._name....  
-00006b90: 2020 406e 616d 652e 7365 7474 6572 0d0a    @name.setter..
-00006ba0: 2020 2020 6465 6620 6e61 6d65 2873 656c      def name(sel
-00006bb0: 662c 2076 616c 7565 293a 0d0a 2020 2020  f, value):..    
-00006bc0: 2020 2020 7365 6c66 2e5f 6e61 6d65 203d      self._name =
-00006bd0: 2076 616c 7565 0d0a 2020 2020 2020 2020   value..        
-00006be0: 7365 6c66 2e75 7064 6174 655f 6e61 6d65  self.update_name
-00006bf0: 5f73 636f 7065 2873 656c 662e 6e61 6d65  _scope(self.name
-00006c00: 290d 0a0d 0a20 2020 2023 2064 6566 205f  )....    # def _
-00006c10: 7365 745f 6e61 6d65 5f73 636f 7065 2873  set_name_scope(s
-00006c20: 656c 6629 3a0d 0a20 2020 2064 6566 2075  elf):..    def u
-00006c30: 7064 6174 655f 6e61 6d65 5f73 636f 7065  pdate_name_scope
-00006c40: 2873 656c 662c 206e 616d 6529 3a0d 0a20  (self, name):.. 
-00006c50: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
-00006c60: 6520 3d20 6e61 6d65 0d0a 2020 2020 2020  e = name..      
-00006c70: 2020 7769 7468 206f 7073 2e6e 616d 655f    with ops.name_
-00006c80: 7363 6f70 655f 7632 286e 616d 6529 2061  scope_v2(name) a
-00006c90: 7320 7363 6f70 655f 6e61 6d65 3a0d 0a20  s scope_name:.. 
-00006ca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006cb0: 5f6e 616d 655f 7363 6f70 6520 3d20 6f70  _name_scope = op
-00006cc0: 732e 6e61 6d65 5f73 636f 7065 5f76 3228  s.name_scope_v2(
-00006cd0: 7363 6f70 655f 6e61 6d65 290d 0a0d 0a20  scope_name).... 
-00006ce0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00006cf0: 2020 6465 6620 6e6f 6465 7328 7365 6c66    def nodes(self
-00006d00: 293a 0d0a 2020 2020 2020 2020 2222 2254  ):..        """T
-00006d10: 6865 2077 686f 6c65 2074 7265 6520 7374  he whole tree st
-00006d20: 7275 6374 7572 6564 204f 7264 6572 6564  ructured Ordered
-00006d30: 4469 6374 207b 2075 7569 6420 3a20 6d6f  Dict { uuid : mo
-00006d40: 6475 6c65 207d 202c 2066 6f72 206d 6f64  dule } , for mod
-00006d50: 756c 6520 746f 2061 6363 6573 7320 616e  ule to access an
-00006d60: 7920 6e6f 6465 2069 6e20 7468 6973 2073  y node in this s
-00006d70: 7472 7563 7475 7265 732c 2065 782e 2053  tructures, ex. S
-00006d80: 686f 7274 6375 7422 2222 0d0a 2020 2020  hortcut"""..    
-00006d90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00006da0: 5f6e 6f64 6573 0d0a 0d0a 2020 2020 406e  _nodes....    @n
-00006db0: 6f64 6573 2e73 6574 7465 720d 0a20 2020  odes.setter..   
-00006dc0: 2064 6566 206e 6f64 6573 2873 656c 662c   def nodes(self,
-00006dd0: 2076 616c 7565 293a 0d0a 2020 2020 2020   value):..      
-00006de0: 2020 6966 2073 656c 662e 5f6e 6f64 6573    if self._nodes
-00006df0: 2021 3d20 7661 6c75 653a 0d0a 2020 2020   != value:..    
-00006e00: 2020 2020 2020 2020 7365 6c66 2e5f 6e6f          self._no
-00006e10: 6465 7320 3d20 7661 6c75 650d 0a20 2020  des = value..   
-00006e20: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
-00006e30: 2069 6e20 7365 6c66 2e6d 6f64 756c 6573   in self.modules
-00006e40: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00006e50: 2020 2020 206d 6f64 2e5f 6e6f 6465 7320       mod._nodes 
-00006e60: 3d20 7661 6c75 650d 0a0d 0a20 2020 2064  = value....    d
-00006e70: 6566 2061 6464 5f6d 6f64 756c 6528 7365  ef add_module(se
-00006e80: 6c66 2c20 206e 616d 653a 2073 7472 2c20  lf,  name: str, 
-00006e90: 6d6f 6475 6c65 3a20 4f70 7469 6f6e 616c  module: Optional
-00006ea0: 5b27 4d6f 6475 6c65 275d 2920 2d3e 204e  ['Module']) -> N
-00006eb0: 6f6e 653a 0d0a 2020 2020 2020 2020 2222  one:..        ""
-00006ec0: 2241 6464 7320 6120 6368 696c 6420 6d6f  "Adds a child mo
-00006ed0: 6475 6c65 2074 6f20 7468 6520 6375 7272  dule to the curr
-00006ee0: 656e 7420 6d6f 6475 6c65 2e0d 0a0d 0a20  ent module..... 
-00006ef0: 2020 2020 2020 2054 6865 206d 6f64 756c         The modul
-00006f00: 6520 6361 6e20 6265 2061 6363 6573 7365  e can be accesse
-00006f10: 6420 6173 2061 6e20 6174 7472 6962 7574  d as an attribut
-00006f20: 6520 7573 696e 6720 7468 6520 6769 7665  e using the give
-00006f30: 6e20 6e61 6d65 2e0d 0a20 2020 2020 2020  n name...       
-00006f40: 2031 2920 6164 6420 6d6f 6475 6c65 2061   1) add module a
-00006f50: 7320 6368 696c 640d 0a20 2020 2020 2020  s child..       
-00006f60: 2032 2920 6765 6e65 7261 7465 2064 6566   2) generate def
-00006f70: 6175 6c74 5f6e 616d 6520 616e 6420 7265  ault_name and re
-00006f80: 6c61 7469 7665 5f6e 616d 650d 0a20 2020  lative_name..   
-00006f90: 2020 2020 2033 2920 7570 6461 7465 2074       3) update t
-00006fa0: 6865 206e 6f64 6573 0d0a 0d0a 2020 2020  he nodes....    
-00006fb0: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-00006fc0: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
-00006fd0: 696e 6729 3a20 6e61 6d65 206f 6620 7468  ing): name of th
-00006fe0: 6520 6368 696c 6420 6d6f 6475 6c65 2e20  e child module. 
-00006ff0: 5468 6520 6368 696c 6420 6d6f 6475 6c65  The child module
-00007000: 2063 616e 2062 650d 0a20 2020 2020 2020   can be..       
-00007010: 2020 2020 2020 2020 2061 6363 6573 7365           accesse
-00007020: 6420 6672 6f6d 2074 6869 7320 6d6f 6475  d from this modu
-00007030: 6c65 2075 7369 6e67 2074 6865 2067 6976  le using the giv
-00007040: 656e 206e 616d 650d 0a20 2020 2020 2020  en name..       
-00007050: 2020 2020 206d 6f64 756c 6520 284d 6f64       module (Mod
-00007060: 756c 6529 3a20 6368 696c 6420 6d6f 6475  ule): child modu
-00007070: 6c65 2074 6f20 6265 2061 6464 6564 2074  le to be added t
-00007080: 6f20 7468 6520 6d6f 6475 6c65 2e0d 0a0d  o the module....
-00007090: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000070a0: 2020 2020 2020 6966 206e 616d 6520 6973        if name is
-000070b0: 204e 6f6e 6520 6f72 206c 656e 286e 616d   None or len(nam
-000070c0: 6529 203d 3d20 303a 0d0a 2020 2020 2020  e) == 0:..      
-000070d0: 2020 2020 2020 6e61 6d65 203d 206d 6f64        name = mod
-000070e0: 756c 652e 5f6e 616d 650d 0a0d 0a20 2020  ule._name....   
-000070f0: 2020 2020 2069 6620 6d6f 6475 6c65 2069       if module i
-00007100: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00007110: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
-00007120: 726f 7228 226d 6f64 756c 6520 2063 616e  ror("module  can
-00007130: 2774 2062 6520 4e6f 6e65 2229 0d0a 2020  't be None")..  
-00007140: 2020 2020 2020 656c 6966 206e 6f74 2069        elif not i
-00007150: 7369 6e73 7461 6e63 6528 6e61 6d65 2c20  sinstance(name, 
-00007160: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
-00007170: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00007180: 6f72 2822 6d6f 6475 6c65 206e 616d 6520  or("module name 
-00007190: 7368 6f75 6c64 2062 6520 6120 7374 7269  should be a stri
-000071a0: 6e67 2e20 476f 7420 7b7d 222e 666f 726d  ng. Got {}".form
-000071b0: 6174 2874 7970 6528 6e61 6d65 292e 5f5f  at(type(name).__
-000071c0: 6e61 6d65 5f5f 2929 0d0a 2020 2020 2020  name__))..      
-000071d0: 2020 656c 6966 2068 6173 6174 7472 2873    elif hasattr(s
-000071e0: 656c 662c 206e 616d 6529 2061 6e64 206e  elf, name) and n
-000071f0: 616d 6520 6e6f 7420 696e 2073 656c 662e  ame not in self.
-00007200: 5f6d 6f64 756c 6573 3a0d 0a20 2020 2020  _modules:..     
-00007210: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
-00007220: 4572 726f 7228 2261 7474 7269 6275 7465  Error("attribute
-00007230: 2027 7b7d 2720 616c 7265 6164 7920 6578   '{}' already ex
-00007240: 6973 7473 222e 666f 726d 6174 286e 616d  ists".format(nam
-00007250: 6529 290d 0a20 2020 2020 2020 2065 6c69  e))..        eli
-00007260: 6620 272e 2720 696e 206e 616d 653a 0d0a  f '.' in name:..
-00007270: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007280: 6520 4b65 7945 7272 6f72 2822 6d6f 6475  e KeyError("modu
-00007290: 6c65 206e 616d 6520 6361 6e27 7420 636f  le name can't co
-000072a0: 6e74 6169 6e20 5c22 2e5c 2222 290d 0a20  ntain \".\"").. 
-000072b0: 2020 2020 2020 2065 6c69 6620 6e61 6d65         elif name
-000072c0: 203d 3d20 2727 3a0d 0a20 2020 2020 2020   == '':..       
-000072d0: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
-000072e0: 726f 7228 226d 6f64 756c 6520 6e61 6d65  ror("module name
-000072f0: 2063 616e 2774 2062 6520 656d 7074 7920   can't be empty 
-00007300: 7374 7269 6e67 205c 225c 2222 290d 0a0d  string \"\"")...
-00007310: 0a20 2020 2020 2020 2073 656c 662e 5f6d  .        self._m
-00007320: 6f64 756c 6573 5b6e 616d 655d 203d 206d  odules[name] = m
-00007330: 6f64 756c 650d 0a20 2020 2020 2020 2073  odule..        s
-00007340: 656c 662e 6e6f 6465 7320 3d20 4f72 6465  elf.nodes = Orde
-00007350: 7265 6444 6963 7428 5b28 6d6f 642e 7575  redDict([(mod.uu
-00007360: 6964 2c20 6d6f 6429 2066 6f72 206d 6f64  id, mod) for mod
-00007370: 2069 6e20 6c69 7374 2873 656c 662e 6d6f   in list(self.mo
-00007380: 6475 6c65 7328 2929 2069 6620 6973 696e  dules()) if isin
-00007390: 7374 616e 6365 286d 6f64 2c20 4c61 7965  stance(mod, Laye
-000073a0: 7229 5d29 0d0a 2020 2020 2020 2020 6966  r)])..        if
-000073b0: 2069 7369 6e73 7461 6e63 6528 6d6f 6475   isinstance(modu
-000073c0: 6c65 2c20 4c61 7965 7229 3a0d 0a20 2020  le, Layer):..   
-000073d0: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
-000073e0: 2069 6e20 6d6f 6475 6c65 2e6d 6f64 756c   in module.modul
-000073f0: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
-00007400: 2020 2020 2020 206d 6f64 2e6e 6f64 6573         mod.nodes
-00007410: 203d 2073 656c 662e 6e6f 6465 730d 0a20   = self.nodes.. 
-00007420: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00007430: 6f64 2e69 735f 726f 6f74 203d 2046 616c  od.is_root = Fal
-00007440: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00007450: 2020 2020 6d6f 642e 5f64 6576 6963 6520      mod._device 
-00007460: 3d20 7365 6c66 2e5f 6465 7669 6365 0d0a  = self._device..
-00007470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007480: 7265 7365 745f 6e61 6d65 286d 6f64 2c20  reset_name(mod, 
-00007490: 7365 6c66 2e5f 7569 645f 7072 6566 6978  self._uid_prefix
-000074a0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-000074b0: 2020 2020 6d6f 642e 7265 6c61 7469 7665      mod.relative
-000074c0: 5f6e 616d 6520 3d20 6e61 6d65 2069 6620  _name = name if 
-000074d0: 6d6f 642e 7265 6c61 7469 7665 5f6e 616d  mod.relative_nam
-000074e0: 6520 3d3d 2027 2720 656c 7365 206e 616d  e == '' else nam
-000074f0: 6520 2b20 272e 2720 2b20 6d6f 642e 7265  e + '.' + mod.re
-00007500: 6c61 7469 7665 5f6e 616d 650d 0a0d 0a20  lative_name.... 
-00007510: 2020 2020 2020 2023 2065 6c69 6620 696e         # elif in
-00007520: 7370 6563 742e 6973 6675 6e63 7469 6f6e  spect.isfunction
-00007530: 286d 6f64 756c 6529 206f 7220 6361 6c6c  (module) or call
-00007540: 6162 6c65 286d 6f64 756c 6529 3a0d 0a20  able(module):.. 
-00007550: 2020 2020 2020 2023 2020 2020 206d 6f64         #     mod
-00007560: 756c 652e 5f5f 6e61 6d65 5f5f 203d 206e  ule.__name__ = n
-00007570: 616d 650d 0a20 2020 2020 2020 2023 2020  ame..        #  
-00007580: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
-00007590: 5b6e 616d 655d 203d 206d 6f64 756c 650d  [name] = module.
-000075a0: 0a0d 0a20 2020 2064 6566 2061 6464 2873  ...    def add(s
-000075b0: 656c 662c 206d 6f64 756c 6529 3a0d 0a20  elf, module):.. 
-000075c0: 2020 2020 2020 2022 2222 5369 6d70 6c69         """Simpli
-000075d0: 6669 6564 2027 6164 645f 6d6f 6475 6c65  fied 'add_module
-000075e0: 270d 0a0d 0a20 2020 2020 2020 2055 7365  '....        Use
-000075f0: 2074 6865 2063 6f75 6e74 206f 6620 6368   the count of ch
-00007600: 696c 6420 6d6f 6475 6c65 7320 6173 2074  ild modules as t
-00007610: 6865 2064 6566 6175 6c74 206e 616d 652e  he default name.
-00007620: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
-00007630: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-00007640: 6f64 756c 6520 284d 6f64 756c 6529 3a20  odule (Module): 
-00007650: 6368 696c 6420 6d6f 6475 6c65 2074 6f20  child module to 
-00007660: 6265 2061 6464 6564 2074 6f20 7468 6520  be added to the 
-00007670: 6d6f 6475 6c65 2e0d 0a0d 0a20 2020 2020  module.....     
-00007680: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00007690: 6966 206d 6f64 756c 6520 6973 204e 6f6e  if module is Non
-000076a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000076b0: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
-000076c0: 6d6f 6475 6c65 2020 6361 6e27 7420 6265  module  can't be
-000076d0: 204e 6f6e 6522 290d 0a20 2020 2020 2020   None")..       
-000076e0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-000076f0: 286d 6f64 756c 652c 204c 6179 6572 293a  (module, Layer):
-00007700: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00007710: 6c66 2e61 6464 5f6d 6f64 756c 6528 7374  lf.add_module(st
-00007720: 7228 6c65 6e28 7365 6c66 2e5f 6d6f 6475  r(len(self._modu
-00007730: 6c65 7329 292c 0d0a 2020 2020 2020 2020  les)),..        
-00007740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007750: 2020 2020 6d6f 6475 6c65 2920 2023 2073      module)  # s
-00007760: 656c 662e 6e6f 6465 7320 3d20 6e6f 6465  elf.nodes = node
-00007770: 7320 2023 2066 6f72 206d 6f64 2069 6e20  s  # for mod in 
-00007780: 7365 6c66 2e6d 6f64 756c 6573 2829 3a20  self.modules(): 
-00007790: 2023 2020 2020 206d 6f64 2e6e 6f64 6573   #     mod.nodes
-000077a0: 203d 206e 6f64 6573 0d0a 0d0a 2020 2020   = nodes....    
-000077b0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000077c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000077d0: 7565 4572 726f 7228 274e 6f74 2076 616c  ueError('Not val
-000077e0: 6964 206d 6f64 756c 6527 290d 0a0d 0a20  id module').... 
-000077f0: 2020 2064 6566 2062 7569 6c64 2873 656c     def build(sel
-00007800: 662c 202a 696e 7075 745f 7368 6170 653a  f, *input_shape:
-00007810: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
-00007820: 2020 2020 2020 2020 2222 2220 446f 2074          """ Do t
-00007830: 6865 2073 6861 7065 2069 6e66 6572 656e  he shape inferen
-00007840: 6365 2061 6e64 2069 6e69 7469 616c 697a  ce and initializ
-00007850: 6520 7765 6967 6874 7320 616e 6420 6269  e weights and bi
-00007860: 6173 2e0d 0a0d 0a20 2020 2020 2020 2060  as.....        `
-00007870: 6275 696c 6427 2069 7320 6120 6b65 7920  build' is a key 
-00007880: 6d65 7468 6f64 2069 6e20 7472 6964 656e  method in triden
-00007890: 742c 2079 6f75 2063 616e 2075 7365 2020  t, you can use  
-000078a0: 7072 6f70 6572 7479 2060 6275 696c 7427  property `built'
-000078b0: 2074 6f20 6368 6563 6b20 7768 6574 6865   to check whethe
-000078c0: 7220 7468 6520 6c61 7965 7220 646f 2074  r the layer do t
-000078d0: 6865 2062 7569 6c64 2070 726f 6365 7373  he build process
-000078e0: 2e0d 0a20 2020 2020 2020 2049 6e20 6275  ...        In bu
-000078f0: 696c 6427 202c 2077 6520 6e65 6564 2074  ild' , we need t
-00007900: 6f20 7075 7420 616c 6c20 7468 6520 6c6f  o put all the lo
-00007910: 6769 6373 2061 626f 7574 2020 686f 7720  gics about  how 
-00007920: 746f 2063 6f6d 6669 726d 2074 6865 2073  to comfirm the s
-00007930: 6861 7065 206f 6620 6f75 7470 7574 732c  hape of outputs,
-00007940: 2077 6569 6768 7473 2061 6e64 2062 6961   weights and bia
-00007950: 7320 6163 636f 7264 696e 6720 746f 2074  s according to t
-00007960: 6865 2063 6f6d 696e 6720 696e 7075 7420  he coming input 
-00007970: 7465 6e73 6f72 2e0d 0a0d 0a20 2020 2020  tensor.....     
-00007980: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-00007990: 2020 2020 2020 696e 7075 745f 7368 6170        input_shap
-000079a0: 6520 2874 656e 736f 7229 3a20 2074 6865  e (tensor):  the
-000079b0: 2073 6861 7065 2072 6570 7265 7365 6e74   shape represent
-000079c0: 6174 696f 6e20 6578 636c 7564 6520 7468  ation exclude th
-000079d0: 6520 6261 7463 6820 6178 6973 2e0d 0a0d  e batch axis....
-000079e0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000079f0: 2020 2020 2020 7061 7373 0d0a 0d0a 2020        pass....  
-00007a00: 2020 6465 6620 7265 6275 696c 6428 7365    def rebuild(se
-00007a10: 6c66 2c20 2a69 6e70 7574 5f73 6861 7065  lf, *input_shape
-00007a20: 3a20 5465 6e73 6f72 5368 6170 6529 3a0d  : TensorShape):.
-00007a30: 0a20 2020 2020 2020 2022 2222 2044 6f20  .        """ Do 
-00007a40: 7468 6520 7368 6170 6520 696e 6665 7265  the shape infere
-00007a50: 6e63 6520 616e 6420 696e 6974 6961 6c69  nce and initiali
-00007a60: 7a65 2077 6569 6768 7473 2061 6e64 2062  ze weights and b
-00007a70: 6961 732e 0d0a 0d0a 2020 2020 2020 2020  ias.....        
-00007a80: 6062 7569 6c64 2720 6973 2061 206b 6579  `build' is a key
-00007a90: 206d 6574 686f 6420 696e 2074 7269 6465   method in tride
-00007aa0: 6e74 2c20 796f 7520 6361 6e20 7573 6520  nt, you can use 
-00007ab0: 2070 726f 7065 7274 7920 6062 7569 6c74   property `built
-00007ac0: 2720 746f 2063 6865 636b 2077 6865 7468  ' to check wheth
-00007ad0: 6572 2074 6865 206c 6179 6572 2064 6f20  er the layer do 
-00007ae0: 7468 6520 6275 696c 6420 7072 6f63 6573  the build proces
-00007af0: 732e 0d0a 2020 2020 2020 2020 496e 2062  s...        In b
-00007b00: 7569 6c64 2720 2c20 7765 206e 6565 6420  uild' , we need 
-00007b10: 746f 2070 7574 2061 6c6c 2074 6865 206c  to put all the l
-00007b20: 6f67 6963 7320 6162 6f75 7420 2068 6f77  ogics about  how
-00007b30: 2074 6f20 636f 6d66 6972 6d20 7468 6520   to comfirm the 
-00007b40: 7368 6170 6520 6f66 206f 7574 7075 7473  shape of outputs
-00007b50: 2c20 7765 6967 6874 7320 616e 6420 6269  , weights and bi
-00007b60: 6173 2061 6363 6f72 6469 6e67 2074 6f20  as according to 
-00007b70: 7468 6520 636f 6d69 6e67 2069 6e70 7574  the coming input
-00007b80: 2074 656e 736f 722e 0d0a 0d0a 2020 2020   tensor.....    
-00007b90: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-00007ba0: 2020 2020 2020 2069 6e70 7574 5f73 6861         input_sha
-00007bb0: 7065 2028 7465 6e73 6f72 293a 2020 7468  pe (tensor):  th
-00007bc0: 6520 7368 6170 6520 7265 7072 6573 656e  e shape represen
-00007bd0: 7461 7469 6f6e 2065 7863 6c75 6465 2074  tation exclude t
-00007be0: 6865 2062 6174 6368 2061 7869 732e 0d0a  he batch axis...
-00007bf0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00007c00: 2020 2020 2020 2070 7269 6e74 280d 0a20         print(.. 
-00007c10: 2020 2020 2020 2020 2020 2027 596f 7572             'Your
-00007c20: 206d 6f64 656c 2077 696c 6c20 7374 6172   model will star
-00007c30: 7420 746f 2072 6562 7569 6c64 2c20 6974  t to rebuild, it
-00007c40: 2077 696c 6c20 6361 7573 6520 6c6f 7374   will cause lost
-00007c50: 2061 6c6c 2065 7869 7374 696e 6720 7472   all existing tr
-00007c60: 6169 6e61 626c 6520 7061 7261 6d65 7465  ainable paramete
-00007c70: 7273 2c20 7769 6c6c 2079 6f75 2077 616e  rs, will you wan
-00007c80: 7420 746f 2072 6562 7569 6c64 2069 743f  t to rebuild it?
-00007c90: 2729 0d0a 2020 2020 2020 2020 616e 7320  ')..        ans 
-00007ca0: 3d20 696e 7075 7428 2728 592f 4e29 203c  = input('(Y/N) <
-00007cb0: 3c20 2729 2e6c 6f77 6572 2829 0d0a 2020  < ').lower()..  
-00007cc0: 2020 2020 2020 6966 2061 6e73 2069 6e20        if ans in 
-00007cd0: 5b27 7965 7327 2c20 2779 275d 3a0d 0a20  ['yes', 'y']:.. 
-00007ce0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-00007cf0: 616d 652c 206d 6f64 756c 6520 696e 2073  ame, module in s
-00007d00: 656c 662e 6e61 6d65 645f 6d6f 6475 6c65  elf.named_module
-00007d10: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-00007d20: 2020 2020 2020 6966 206d 6f64 756c 652e        if module.
-00007d30: 7472 6169 6e61 626c 653a 0d0a 2020 2020  trainable:..    
-00007d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d50: 6d6f 6475 6c65 2e5f 696e 7075 745f 7368  module._input_sh
-00007d60: 6170 6520 3d20 4e6f 6e65 0d0a 2020 2020  ape = None..    
-00007d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d80: 6d6f 6475 6c65 2e5f 6f75 7470 7574 5f73  module._output_s
-00007d90: 6861 7065 203d 204e 6f6e 650d 0a20 2020  hape = None..   
-00007da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007db0: 206d 6f64 756c 652e 5f62 7569 6c74 203d   module._built =
-00007dc0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00007dd0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-00007de0: 6c65 2e5f 7061 7261 6d65 7465 7273 203d  le._parameters =
-00007df0: 204f 7264 6572 6564 4469 6374 2829 0d0a   OrderedDict()..
-00007e00: 2020 2020 2020 2020 2020 2020 6475 6d6d              dumm
-00007e10: 6179 5f69 6e70 7574 203d 2074 6f5f 7465  ay_input = to_te
-00007e20: 6e73 6f72 2869 6e70 7574 5f73 6861 7065  nsor(input_shape
-00007e30: 2e67 6574 5f64 756d 6d79 5f74 656e 736f  .get_dummy_tenso
-00007e40: 7228 2929 2e74 6f28 6765 745f 6465 7669  r()).to(get_devi
-00007e50: 6365 2829 290d 0a20 2020 2020 2020 2020  ce())..         
-00007e60: 2020 206f 7574 203d 2073 656c 662e 666f     out = self.fo
-00007e70: 7277 6172 6428 6475 6d6d 6179 5f69 6e70  rward(dummay_inp
-00007e80: 7574 290d 0a0d 0a20 2020 2064 6566 2072  ut)....    def r
-00007e90: 6567 6973 7465 725f 6261 636b 7761 7264  egister_backward
-00007ea0: 5f68 6f6f 6b28 7365 6c66 2c20 686f 6f6b  _hook(self, hook
-00007eb0: 293a 0d0a 2020 2020 2020 2020 7222 2222  ):..        r"""
-00007ec0: 5265 6769 7374 6572 7320 6120 6261 636b  Registers a back
-00007ed0: 7761 7264 2068 6f6f 6b20 6f6e 2074 6865  ward hook on the
-00007ee0: 206d 6f64 756c 652e 0d0a 0d0a 2020 2020   module.....    
-00007ef0: 2020 2020 5468 6520 686f 6f6b 2077 696c      The hook wil
-00007f00: 6c20 6265 2063 616c 6c65 6420 6576 6572  l be called ever
-00007f10: 7920 7469 6d65 2074 6865 2067 7261 6469  y time the gradi
-00007f20: 656e 7473 2077 6974 6820 7265 7370 6563  ents with respec
-00007f30: 7420 746f 206d 6f64 756c 650d 0a20 2020  t to module..   
-00007f40: 2020 2020 2069 6e70 7574 7320 6172 6520       inputs are 
-00007f50: 636f 6d70 7574 6564 2e20 5468 6520 686f  computed. The ho
-00007f60: 6f6b 2073 686f 756c 6420 6861 7665 2074  ok should have t
-00007f70: 6865 2066 6f6c 6c6f 7769 6e67 2073 6967  he following sig
-00007f80: 6e61 7475 7265 3a3a 0d0a 0d0a 2020 2020  nature::....    
-00007f90: 2020 2020 2020 2020 686f 6f6b 286d 6f64          hook(mod
-00007fa0: 756c 652c 2067 7261 645f 696e 7075 742c  ule, grad_input,
-00007fb0: 2067 7261 645f 6f75 7470 7574 2920 2d3e   grad_output) ->
-00007fc0: 2054 656e 736f 7220 6f72 204e 6f6e 650d   Tensor or None.
-00007fd0: 0a0d 0a20 2020 2020 2020 2054 6865 203a  ...        The :
-00007fe0: 6174 7472 3a60 6772 6164 5f69 6e70 7574  attr:`grad_input
-00007ff0: 6020 616e 6420 3a61 7474 723a 6067 7261  ` and :attr:`gra
-00008000: 645f 6f75 7470 7574 6020 6d61 7920 6265  d_output` may be
-00008010: 2074 7570 6c65 7320 6966 2074 6865 0d0a   tuples if the..
-00008020: 2020 2020 2020 2020 6d6f 6475 6c65 2068          module h
-00008030: 6173 206d 756c 7469 706c 6520 696e 7075  as multiple inpu
-00008040: 7473 206f 7220 6f75 7470 7574 732e 2054  ts or outputs. T
-00008050: 6865 2068 6f6f 6b20 7368 6f75 6c64 206e  he hook should n
-00008060: 6f74 206d 6f64 6966 7920 6974 730d 0a20  ot modify its.. 
-00008070: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
-00008080: 2c20 6275 7420 6974 2063 616e 206f 7074  , but it can opt
-00008090: 696f 6e61 6c6c 7920 7265 7475 726e 2061  ionally return a
-000080a0: 206e 6577 2067 7261 6469 656e 7420 7769   new gradient wi
-000080b0: 7468 2072 6573 7065 6374 2074 6f0d 0a20  th respect to.. 
-000080c0: 2020 2020 2020 2069 6e70 7574 2074 6861         input tha
-000080d0: 7420 7769 6c6c 2062 6520 7573 6564 2069  t will be used i
-000080e0: 6e20 706c 6163 6520 6f66 203a 6174 7472  n place of :attr
-000080f0: 3a60 6772 6164 5f69 6e70 7574 6020 696e  :`grad_input` in
-00008100: 2073 7562 7365 7175 656e 740d 0a20 2020   subsequent..   
-00008110: 2020 2020 2063 6f6d 7075 7461 7469 6f6e       computation
-00008120: 732e 0d0a 0d0a 2020 2020 2020 2020 5265  s.....        Re
-00008130: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-00008140: 2020 2020 3a63 6c61 7373 3a60 746f 7263      :class:`torc
-00008150: 682e 7574 696c 732e 686f 6f6b 732e 5265  h.utils.hooks.Re
-00008160: 6d6f 7661 626c 6548 616e 646c 6560 3a0d  movableHandle`:.
-00008170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008180: 2061 2068 616e 646c 6520 7468 6174 2063   a handle that c
-00008190: 616e 2062 6520 7573 6564 2074 6f20 7265  an be used to re
-000081a0: 6d6f 7665 2074 6865 2061 6464 6564 2068  move the added h
-000081b0: 6f6f 6b20 6279 2063 616c 6c69 6e67 0d0a  ook by calling..
-000081c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081d0: 6060 6861 6e64 6c65 2e72 656d 6f76 6528  ``handle.remove(
-000081e0: 2960 600d 0a0d 0a20 2020 2020 2020 202e  )``....        .
-000081f0: 2e20 7761 726e 696e 6720 3a3a 0d0a 0d0a  . warning ::....
-00008200: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00008210: 6375 7272 656e 7420 696d 706c 656d 656e  current implemen
-00008220: 7461 7469 6f6e 2077 696c 6c20 6e6f 7420  tation will not 
-00008230: 6861 7665 2074 6865 2070 7265 7365 6e74  have the present
-00008240: 6564 2062 6568 6176 696f 720d 0a20 2020  ed behavior..   
-00008250: 2020 2020 2020 2020 2066 6f72 2063 6f6d           for com
-00008260: 706c 6578 203a 636c 6173 733a 604d 6f64  plex :class:`Mod
-00008270: 756c 6560 2074 6861 7420 7065 7266 6f72  ule` that perfor
-00008280: 6d20 6d61 6e79 206f 7065 7261 7469 6f6e  m many operation
-00008290: 732e 0d0a 2020 2020 2020 2020 2020 2020  s...            
-000082a0: 496e 2073 6f6d 6520 6661 696c 7572 6520  In some failure 
-000082b0: 6361 7365 732c 203a 6174 7472 3a60 6772  cases, :attr:`gr
-000082c0: 6164 5f69 6e70 7574 6020 616e 6420 3a61  ad_input` and :a
-000082d0: 7474 723a 6067 7261 645f 6f75 7470 7574  ttr:`grad_output
-000082e0: 6020 7769 6c6c 206f 6e6c 790d 0a20 2020  ` will only..   
-000082f0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
-00008300: 2074 6865 2067 7261 6469 656e 7473 2066   the gradients f
-00008310: 6f72 2061 2073 7562 7365 7420 6f66 2074  or a subset of t
-00008320: 6865 2069 6e70 7574 7320 616e 6420 6f75  he inputs and ou
-00008330: 7470 7574 732e 0d0a 2020 2020 2020 2020  tputs...        
-00008340: 2020 2020 466f 7220 7375 6368 203a 636c      For such :cl
-00008350: 6173 733a 604d 6f64 756c 6560 2c20 796f  ass:`Module`, yo
-00008360: 7520 7368 6f75 6c64 2075 7365 203a 6675  u should use :fu
-00008370: 6e63 3a60 746f 7263 682e 5465 6e73 6f72  nc:`torch.Tensor
-00008380: 2e72 6567 6973 7465 725f 686f 6f6b 600d  .register_hook`.
-00008390: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-000083a0: 6563 746c 7920 6f6e 2061 2073 7065 6369  ectly on a speci
-000083b0: 6669 6320 696e 7075 7420 6f72 206f 7574  fic input or out
-000083c0: 7075 7420 746f 2067 6574 2074 6865 2072  put to get the r
-000083d0: 6571 7569 7265 6420 6772 6164 6965 6e74  equired gradient
-000083e0: 732e 0d0a 0d0a 2020 2020 2020 2020 2222  s.....        ""
-000083f0: 220d 0a20 2020 2020 2020 2068 616e 646c  "..        handl
-00008400: 6520 3d20 5265 6d6f 7661 626c 6548 616e  e = RemovableHan
-00008410: 646c 6528 7365 6c66 2e5f 6261 636b 7761  dle(self._backwa
-00008420: 7264 5f68 6f6f 6b73 290d 0a20 2020 2020  rd_hooks)..     
-00008430: 2020 2073 656c 662e 5f62 6163 6b77 6172     self._backwar
-00008440: 645f 686f 6f6b 735b 6861 6e64 6c65 2e69  d_hooks[handle.i
-00008450: 645d 203d 2068 6f6f 6b0d 0a20 2020 2020  d] = hook..     
-00008460: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
-00008470: 0d0a 0d0a 0d0a 2020 2020 6465 6620 7265  ......    def re
-00008480: 6769 7374 6572 5f66 6f72 7761 7264 5f70  gister_forward_p
-00008490: 7265 5f68 6f6f 6b28 0d0a 2020 2020 2020  re_hook(..      
-000084a0: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-000084b0: 2068 6f6f 6b3a 2055 6e69 6f6e 5b0d 0a20   hook: Union[.. 
-000084c0: 2020 2020 2020 2020 2020 2043 616c 6c61             Calla
-000084d0: 626c 655b 5b54 2c20 5475 706c 655b 416e  ble[[T, Tuple[An
-000084e0: 792c 202e 2e2e 5d5d 2c20 4f70 7469 6f6e  y, ...]], Option
-000084f0: 616c 5b41 6e79 5d5d 2c0d 0a20 2020 2020  al[Any]],..     
-00008500: 2020 2020 2020 2043 616c 6c61 626c 655b         Callable[
-00008510: 5b54 2c20 5475 706c 655b 416e 792c 202e  [T, Tuple[Any, .
-00008520: 2e2e 5d2c 2044 6963 745b 7374 722c 2041  ..], Dict[str, A
-00008530: 6e79 5d5d 2c20 4f70 7469 6f6e 616c 5b54  ny]], Optional[T
-00008540: 7570 6c65 5b41 6e79 2c20 4469 6374 5b73  uple[Any, Dict[s
-00008550: 7472 2c20 416e 795d 5d5d 5d2c 0d0a 2020  tr, Any]]]],..  
-00008560: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
-00008570: 2020 2a2c 0d0a 2020 2020 2020 2020 7072    *,..        pr
-00008580: 6570 656e 643a 2062 6f6f 6c20 3d20 4661  epend: bool = Fa
-00008590: 6c73 652c 0d0a 2020 2020 2020 2020 7769  lse,..        wi
-000085a0: 7468 5f6b 7761 7267 733a 2062 6f6f 6c20  th_kwargs: bool 
-000085b0: 3d20 4661 6c73 652c 0d0a 2020 2020 2920  = False,..    ) 
-000085c0: 2d3e 2052 656d 6f76 6162 6c65 4861 6e64  -> RemovableHand
-000085d0: 6c65 3a0d 0a20 2020 2020 2020 2072 2222  le:..        r""
-000085e0: 2252 6567 6973 7465 7273 2061 2066 6f72  "Registers a for
-000085f0: 7761 7264 2070 7265 2d68 6f6f 6b20 6f6e  ward pre-hook on
-00008600: 2074 6865 206d 6f64 756c 652e 0d0a 0d0a   the module.....
-00008610: 2020 2020 2020 2020 5468 6520 686f 6f6b          The hook
-00008620: 2077 696c 6c20 6265 2063 616c 6c65 6420   will be called 
-00008630: 6576 6572 7920 7469 6d65 2062 6566 6f72  every time befor
-00008640: 6520 3a66 756e 633a 6066 6f72 7761 7264  e :func:`forward
-00008650: 6020 6973 2069 6e76 6f6b 6564 2e0d 0a0d  ` is invoked....
-00008660: 0a0d 0a20 2020 2020 2020 2049 6620 6060  ...        If ``
-00008670: 7769 7468 5f6b 7761 7267 7360 6020 6973  with_kwargs`` is
-00008680: 2066 616c 7365 206f 7220 6e6f 7420 7370   false or not sp
-00008690: 6563 6966 6965 642c 2074 6865 2069 6e70  ecified, the inp
-000086a0: 7574 2063 6f6e 7461 696e 7320 6f6e 6c79  ut contains only
-000086b0: 0d0a 2020 2020 2020 2020 7468 6520 706f  ..        the po
-000086c0: 7369 7469 6f6e 616c 2061 7267 756d 656e  sitional argumen
-000086d0: 7473 2067 6976 656e 2074 6f20 7468 6520  ts given to the 
-000086e0: 6d6f 6475 6c65 2e20 4b65 7977 6f72 6420  module. Keyword 
-000086f0: 6172 6775 6d65 6e74 7320 776f 6e27 7420  arguments won't 
-00008700: 6265 0d0a 2020 2020 2020 2020 7061 7373  be..        pass
-00008710: 6564 2074 6f20 7468 6520 686f 6f6b 7320  ed to the hooks 
-00008720: 616e 6420 6f6e 6c79 2074 6f20 7468 6520  and only to the 
-00008730: 6060 666f 7277 6172 6460 602e 2054 6865  ``forward``. The
-00008740: 2068 6f6f 6b20 6361 6e20 6d6f 6469 6679   hook can modify
-00008750: 2074 6865 0d0a 2020 2020 2020 2020 696e   the..        in
-00008760: 7075 742e 2055 7365 7220 6361 6e20 6569  put. User can ei
-00008770: 7468 6572 2072 6574 7572 6e20 6120 7475  ther return a tu
-00008780: 706c 6520 6f72 2061 2073 696e 676c 6520  ple or a single 
-00008790: 6d6f 6469 6669 6564 2076 616c 7565 2069  modified value i
-000087a0: 6e20 7468 650d 0a20 2020 2020 2020 2068  n the..        h
-000087b0: 6f6f 6b2e 2057 6520 7769 6c6c 2077 7261  ook. We will wra
-000087c0: 7020 7468 6520 7661 6c75 6520 696e 746f  p the value into
-000087d0: 2061 2074 7570 6c65 2069 6620 6120 7369   a tuple if a si
-000087e0: 6e67 6c65 2076 616c 7565 2069 7320 7265  ngle value is re
-000087f0: 7475 726e 6564 0d0a 2020 2020 2020 2020  turned..        
-00008800: 2875 6e6c 6573 7320 7468 6174 2076 616c  (unless that val
-00008810: 7565 2069 7320 616c 7265 6164 7920 6120  ue is already a 
-00008820: 7475 706c 6529 2e20 5468 6520 686f 6f6b  tuple). The hook
-00008830: 2073 686f 756c 6420 6861 7665 2074 6865   should have the
-00008840: 0d0a 2020 2020 2020 2020 666f 6c6c 6f77  ..        follow
-00008850: 696e 6720 7369 676e 6174 7572 653a 3a0d  ing signature::.
-00008860: 0a0d 0a20 2020 2020 2020 2020 2020 2068  ...            h
-00008870: 6f6f 6b28 6d6f 6475 6c65 2c20 6172 6773  ook(module, args
-00008880: 2920 2d3e 204e 6f6e 6520 6f72 206d 6f64  ) -> None or mod
-00008890: 6966 6965 6420 696e 7075 740d 0a0d 0a20  ified input.... 
-000088a0: 2020 2020 2020 2049 6620 6060 7769 7468         If ``with
-000088b0: 5f6b 7761 7267 7360 6020 6973 2074 7275  _kwargs`` is tru
-000088c0: 652c 2074 6865 2066 6f72 7761 7264 2070  e, the forward p
-000088d0: 7265 2d68 6f6f 6b20 7769 6c6c 2062 6520  re-hook will be 
-000088e0: 7061 7373 6564 2074 6865 0d0a 2020 2020  passed the..    
-000088f0: 2020 2020 6b77 6172 6773 2067 6976 656e      kwargs given
-00008900: 2074 6f20 7468 6520 666f 7277 6172 6420   to the forward 
-00008910: 6675 6e63 7469 6f6e 2e20 416e 6420 6966  function. And if
-00008920: 2074 6865 2068 6f6f 6b20 6d6f 6469 6669   the hook modifi
-00008930: 6573 2074 6865 0d0a 2020 2020 2020 2020  es the..        
-00008940: 696e 7075 742c 2062 6f74 6820 7468 6520  input, both the 
-00008950: 6172 6773 2061 6e64 206b 7761 7267 7320  args and kwargs 
-00008960: 7368 6f75 6c64 2062 6520 7265 7475 726e  should be return
-00008970: 6564 2e20 5468 6520 686f 6f6b 2073 686f  ed. The hook sho
-00008980: 756c 6420 6861 7665 0d0a 2020 2020 2020  uld have..      
-00008990: 2020 7468 6520 666f 6c6c 6f77 696e 6720    the following 
-000089a0: 7369 676e 6174 7572 653a 3a0d 0a0d 0a20  signature::.... 
-000089b0: 2020 2020 2020 2020 2020 2068 6f6f 6b28             hook(
-000089c0: 6d6f 6475 6c65 2c20 6172 6773 2c20 6b77  module, args, kw
-000089d0: 6172 6773 2920 2d3e 204e 6f6e 6520 6f72  args) -> None or
-000089e0: 2061 2074 7570 6c65 206f 6620 6d6f 6469   a tuple of modi
-000089f0: 6669 6564 2069 6e70 7574 2061 6e64 206b  fied input and k
-00008a00: 7761 7267 730d 0a0d 0a20 2020 2020 2020  wargs....       
-00008a10: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00008a20: 2020 2020 686f 6f6b 2028 4361 6c6c 6162      hook (Callab
-00008a30: 6c65 293a 2054 6865 2075 7365 7220 6465  le): The user de
-00008a40: 6669 6e65 6420 686f 6f6b 2074 6f20 6265  fined hook to be
-00008a50: 2072 6567 6973 7465 7265 642e 0d0a 2020   registered...  
-00008a60: 2020 2020 2020 2020 2020 7072 6570 656e            prepen
-00008a70: 6420 2862 6f6f 6c29 3a20 4966 2074 7275  d (bool): If tru
-00008a80: 652c 2074 6865 2070 726f 7669 6465 6420  e, the provided 
-00008a90: 6060 686f 6f6b 6060 2077 696c 6c20 6265  ``hook`` will be
-00008aa0: 2066 6972 6564 2062 6566 6f72 650d 0a20   fired before.. 
-00008ab0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00008ac0: 6c6c 2065 7869 7374 696e 6720 6060 666f  ll existing ``fo
-00008ad0: 7277 6172 645f 7072 6560 6020 686f 6f6b  rward_pre`` hook
-00008ae0: 7320 6f6e 2074 6869 730d 0a20 2020 2020  s on this..     
-00008af0: 2020 2020 2020 2020 2020 203a 636c 6173             :clas
-00008b00: 733a 6074 6f72 6368 2e6e 6e2e 6d6f 6475  s:`torch.nn.modu
-00008b10: 6c65 732e 4d6f 6475 6c65 602e 204f 7468  les.Module`. Oth
-00008b20: 6572 7769 7365 2c20 7468 6520 7072 6f76  erwise, the prov
-00008b30: 6964 6564 0d0a 2020 2020 2020 2020 2020  ided..          
-00008b40: 2020 2020 2020 6060 686f 6f6b 6060 2077        ``hook`` w
-00008b50: 696c 6c20 6265 2066 6972 6564 2061 6674  ill be fired aft
-00008b60: 6572 2061 6c6c 2065 7869 7374 696e 6720  er all existing 
-00008b70: 6060 666f 7277 6172 645f 7072 6560 6020  ``forward_pre`` 
-00008b80: 686f 6f6b 730d 0a20 2020 2020 2020 2020  hooks..         
-00008b90: 2020 2020 2020 206f 6e20 7468 6973 203a         on this :
-00008ba0: 636c 6173 733a 6074 6f72 6368 2e6e 6e2e  class:`torch.nn.
-00008bb0: 6d6f 6475 6c65 732e 4d6f 6475 6c65 602e  modules.Module`.
-00008bc0: 204e 6f74 6520 7468 6174 2067 6c6f 6261   Note that globa
-00008bd0: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
-00008be0: 2020 2060 6066 6f72 7761 7264 5f70 7265     ``forward_pre
-00008bf0: 6060 2068 6f6f 6b73 2072 6567 6973 7465  `` hooks registe
-00008c00: 7265 6420 7769 7468 0d0a 2020 2020 2020  red with..      
-00008c10: 2020 2020 2020 2020 2020 3a66 756e 633a            :func:
-00008c20: 6072 6567 6973 7465 725f 6d6f 6475 6c65  `register_module
-00008c30: 5f66 6f72 7761 7264 5f70 7265 5f68 6f6f  _forward_pre_hoo
-00008c40: 6b60 2077 696c 6c20 6669 7265 2062 6566  k` will fire bef
-00008c50: 6f72 6520 616c 6c0d 0a20 2020 2020 2020  ore all..       
-00008c60: 2020 2020 2020 2020 2068 6f6f 6b73 2072           hooks r
-00008c70: 6567 6973 7465 7265 6420 6279 2074 6869  egistered by thi
-00008c80: 7320 6d65 7468 6f64 2e0d 0a20 2020 2020  s method...     
-00008c90: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-00008ca0: 6c74 3a20 6060 4661 6c73 6560 600d 0a20  lt: ``False``.. 
-00008cb0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-00008cc0: 6b77 6172 6773 2028 626f 6f6c 293a 2049  kwargs (bool): I
-00008cd0: 6620 7472 7565 2c20 7468 6520 6060 686f  f true, the ``ho
-00008ce0: 6f6b 6060 2077 696c 6c20 6265 2070 6173  ok`` will be pas
-00008cf0: 7365 6420 7468 6520 6b77 6172 6773 0d0a  sed the kwargs..
-00008d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d10: 6769 7665 6e20 746f 2074 6865 2066 6f72  given to the for
-00008d20: 7761 7264 2066 756e 6374 696f 6e2e 0d0a  ward function...
-00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d40: 4465 6661 756c 743a 2060 6046 616c 7365  Default: ``False
-00008d50: 6060 0d0a 0d0a 2020 2020 2020 2020 5265  ``....        Re
-00008d60: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-00008d70: 2020 2020 3a63 6c61 7373 3a60 746f 7263      :class:`torc
-00008d80: 682e 7574 696c 732e 686f 6f6b 732e 5265  h.utils.hooks.Re
-00008d90: 6d6f 7661 626c 6548 616e 646c 6560 3a0d  movableHandle`:.
-00008da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008db0: 2061 2068 616e 646c 6520 7468 6174 2063   a handle that c
-00008dc0: 616e 2062 6520 7573 6564 2074 6f20 7265  an be used to re
-00008dd0: 6d6f 7665 2074 6865 2061 6464 6564 2068  move the added h
-00008de0: 6f6f 6b20 6279 2063 616c 6c69 6e67 0d0a  ook by calling..
-00008df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e00: 6060 6861 6e64 6c65 2e72 656d 6f76 6528  ``handle.remove(
-00008e10: 2960 600d 0a20 2020 2020 2020 2022 2222  )``..        """
-00008e20: 0d0a 2020 2020 2020 2020 6861 6e64 6c65  ..        handle
-00008e30: 203d 2068 6f6f 6b73 2e52 656d 6f76 6162   = hooks.Removab
-00008e40: 6c65 4861 6e64 6c65 280d 0a20 2020 2020  leHandle(..     
-00008e50: 2020 2020 2020 2073 656c 662e 5f66 6f72         self._for
-00008e60: 7761 7264 5f70 7265 5f68 6f6f 6b73 2c0d  ward_pre_hooks,.
-00008e70: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-00008e80: 7261 5f64 6963 743d 7365 6c66 2e5f 666f  ra_dict=self._fo
-00008e90: 7277 6172 645f 7072 655f 686f 6f6b 735f  rward_pre_hooks_
-00008ea0: 7769 7468 5f6b 7761 7267 730d 0a20 2020  with_kwargs..   
-00008eb0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00008ec0: 7365 6c66 2e5f 666f 7277 6172 645f 7072  self._forward_pr
-00008ed0: 655f 686f 6f6b 735b 6861 6e64 6c65 2e69  e_hooks[handle.i
-00008ee0: 645d 203d 2068 6f6f 6b0d 0a20 2020 2020  d] = hook..     
-00008ef0: 2020 2069 6620 7769 7468 5f6b 7761 7267     if with_kwarg
-00008f00: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00008f10: 7365 6c66 2e5f 666f 7277 6172 645f 7072  self._forward_pr
-00008f20: 655f 686f 6f6b 735f 7769 7468 5f6b 7761  e_hooks_with_kwa
-00008f30: 7267 735b 6861 6e64 6c65 2e69 645d 203d  rgs[handle.id] =
-00008f40: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
-00008f50: 2069 6620 7072 6570 656e 643a 0d0a 2020   if prepend:..  
-00008f60: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00008f70: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
-00008f80: 732e 6d6f 7665 5f74 6f5f 656e 6428 6861  s.move_to_end(ha
-00008f90: 6e64 6c65 2e69 642c 206c 6173 743d 4661  ndle.id, last=Fa
-00008fa0: 6c73 6529 2020 2320 7479 7065 3a20 6967  lse)  # type: ig
-00008fb0: 6e6f 7265 5b61 7474 722d 6465 6669 6e65  nore[attr-define
-00008fc0: 645d 0d0a 2020 2020 2020 2020 7265 7475  d]..        retu
-00008fd0: 726e 2068 616e 646c 650d 0a0d 0a20 2020  rn handle....   
-00008fe0: 2064 6566 2072 6567 6973 7465 725f 666f   def register_fo
-00008ff0: 7277 6172 645f 686f 6f6b 280d 0a20 2020  rward_hook(..   
-00009000: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
-00009010: 2020 2020 686f 6f6b 3a20 556e 696f 6e5b      hook: Union[
-00009020: 0d0a 2020 2020 2020 2020 2020 2020 4361  ..            Ca
-00009030: 6c6c 6162 6c65 5b5b 542c 2054 7570 6c65  llable[[T, Tuple
-00009040: 5b41 6e79 2c20 2e2e 2e5d 2c20 416e 795d  [Any, ...], Any]
-00009050: 2c20 4f70 7469 6f6e 616c 5b41 6e79 5d5d  , Optional[Any]]
-00009060: 2c0d 0a20 2020 2020 2020 2020 2020 2043  ,..            C
-00009070: 616c 6c61 626c 655b 5b54 2c20 5475 706c  allable[[T, Tupl
-00009080: 655b 416e 792c 202e 2e2e 5d2c 2044 6963  e[Any, ...], Dic
-00009090: 745b 7374 722c 2041 6e79 5d2c 2041 6e79  t[str, Any], Any
-000090a0: 5d2c 204f 7074 696f 6e61 6c5b 416e 795d  ], Optional[Any]
-000090b0: 5d2c 0d0a 2020 2020 2020 2020 5d2c 0d0a  ],..        ],..
-000090c0: 2020 2020 2020 2020 2a2c 0d0a 2020 2020          *,..    
-000090d0: 2020 2020 7072 6570 656e 643a 2062 6f6f      prepend: boo
-000090e0: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
-000090f0: 2020 2020 7769 7468 5f6b 7761 7267 733a      with_kwargs:
-00009100: 2062 6f6f 6c20 3d20 4661 6c73 652c 0d0a   bool = False,..
-00009110: 2020 2020 2920 2d3e 2052 656d 6f76 6162      ) -> Removab
-00009120: 6c65 4861 6e64 6c65 3a0d 0a20 2020 2020  leHandle:..     
-00009130: 2020 2072 2222 2252 6567 6973 7465 7273     r"""Registers
-00009140: 2061 2066 6f72 7761 7264 2068 6f6f 6b20   a forward hook 
-00009150: 6f6e 2074 6865 206d 6f64 756c 652e 0d0a  on the module...
-00009160: 0d0a 2020 2020 2020 2020 5468 6520 686f  ..        The ho
-00009170: 6f6b 2077 696c 6c20 6265 2063 616c 6c65  ok will be calle
-00009180: 6420 6576 6572 7920 7469 6d65 2061 6674  d every time aft
-00009190: 6572 203a 6675 6e63 3a60 666f 7277 6172  er :func:`forwar
-000091a0: 6460 2068 6173 2063 6f6d 7075 7465 6420  d` has computed 
-000091b0: 616e 206f 7574 7075 742e 0d0a 0d0a 2020  an output.....  
-000091c0: 2020 2020 2020 4966 2060 6077 6974 685f        If ``with_
-000091d0: 6b77 6172 6773 6060 2069 7320 6060 4661  kwargs`` is ``Fa
-000091e0: 6c73 6560 6020 6f72 206e 6f74 2073 7065  lse`` or not spe
-000091f0: 6369 6669 6564 2c20 7468 6520 696e 7075  cified, the inpu
-00009200: 7420 636f 6e74 6169 6e73 206f 6e6c 790d  t contains only.
-00009210: 0a20 2020 2020 2020 2074 6865 2070 6f73  .        the pos
-00009220: 6974 696f 6e61 6c20 6172 6775 6d65 6e74  itional argument
-00009230: 7320 6769 7665 6e20 746f 2074 6865 206d  s given to the m
-00009240: 6f64 756c 652e 204b 6579 776f 7264 2061  odule. Keyword a
-00009250: 7267 756d 656e 7473 2077 6f6e 2774 2062  rguments won't b
-00009260: 650d 0a20 2020 2020 2020 2070 6173 7365  e..        passe
-00009270: 6420 746f 2074 6865 2068 6f6f 6b73 2061  d to the hooks a
-00009280: 6e64 206f 6e6c 7920 746f 2074 6865 2060  nd only to the `
-00009290: 6066 6f72 7761 7264 6060 2e20 5468 6520  `forward``. The 
-000092a0: 686f 6f6b 2063 616e 206d 6f64 6966 7920  hook can modify 
-000092b0: 7468 650d 0a20 2020 2020 2020 206f 7574  the..        out
-000092c0: 7075 742e 2049 7420 6361 6e20 6d6f 6469  put. It can modi
-000092d0: 6679 2074 6865 2069 6e70 7574 2069 6e70  fy the input inp
-000092e0: 6c61 6365 2062 7574 2069 7420 7769 6c6c  lace but it will
-000092f0: 206e 6f74 2068 6176 6520 6566 6665 6374   not have effect
-00009300: 206f 6e0d 0a20 2020 2020 2020 2066 6f72   on..        for
-00009310: 7761 7264 2073 696e 6365 2074 6869 7320  ward since this 
-00009320: 6973 2063 616c 6c65 6420 6166 7465 7220  is called after 
-00009330: 3a66 756e 633a 6066 6f72 7761 7264 6020  :func:`forward` 
-00009340: 6973 2063 616c 6c65 642e 2054 6865 2068  is called. The h
-00009350: 6f6f 6b0d 0a20 2020 2020 2020 2073 686f  ook..        sho
-00009360: 756c 6420 6861 7665 2074 6865 2066 6f6c  uld have the fol
-00009370: 6c6f 7769 6e67 2073 6967 6e61 7475 7265  lowing signature
-00009380: 3a3a 0d0a 0d0a 2020 2020 2020 2020 2020  ::....          
-00009390: 2020 686f 6f6b 286d 6f64 756c 652c 2061    hook(module, a
-000093a0: 7267 732c 206f 7574 7075 7429 202d 3e20  rgs, output) -> 
-000093b0: 4e6f 6e65 206f 7220 6d6f 6469 6669 6564  None or modified
-000093c0: 206f 7574 7075 740d 0a0d 0a20 2020 2020   output....     
-000093d0: 2020 2049 6620 6060 7769 7468 5f6b 7761     If ``with_kwa
-000093e0: 7267 7360 6020 6973 2060 6054 7275 6560  rgs`` is ``True`
-000093f0: 602c 2074 6865 2066 6f72 7761 7264 2068  `, the forward h
-00009400: 6f6f 6b20 7769 6c6c 2062 6520 7061 7373  ook will be pass
-00009410: 6564 2074 6865 0d0a 2020 2020 2020 2020  ed the..        
-00009420: 6060 6b77 6172 6773 6060 2067 6976 656e  ``kwargs`` given
-00009430: 2074 6f20 7468 6520 666f 7277 6172 6420   to the forward 
-00009440: 6675 6e63 7469 6f6e 2061 6e64 2062 6520  function and be 
-00009450: 6578 7065 6374 6564 2074 6f20 7265 7475  expected to retu
-00009460: 726e 2074 6865 0d0a 2020 2020 2020 2020  rn the..        
-00009470: 6f75 7470 7574 2070 6f73 7369 626c 7920  output possibly 
-00009480: 6d6f 6469 6669 6564 2e20 5468 6520 686f  modified. The ho
-00009490: 6f6b 2073 686f 756c 6420 6861 7665 2074  ok should have t
-000094a0: 6865 2066 6f6c 6c6f 7769 6e67 2073 6967  he following sig
-000094b0: 6e61 7475 7265 3a3a 0d0a 0d0a 2020 2020  nature::....    
-000094c0: 2020 2020 2020 2020 686f 6f6b 286d 6f64          hook(mod
-000094d0: 756c 652c 2061 7267 732c 206b 7761 7267  ule, args, kwarg
-000094e0: 732c 206f 7574 7075 7429 202d 3e20 4e6f  s, output) -> No
-000094f0: 6e65 206f 7220 6d6f 6469 6669 6564 206f  ne or modified o
-00009500: 7574 7075 740d 0a0d 0a20 2020 2020 2020  utput....       
-00009510: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00009520: 2020 2020 686f 6f6b 2028 4361 6c6c 6162      hook (Callab
-00009530: 6c65 293a 2054 6865 2075 7365 7220 6465  le): The user de
-00009540: 6669 6e65 6420 686f 6f6b 2074 6f20 6265  fined hook to be
-00009550: 2072 6567 6973 7465 7265 642e 0d0a 2020   registered...  
-00009560: 2020 2020 2020 2020 2020 7072 6570 656e            prepen
-00009570: 6420 2862 6f6f 6c29 3a20 4966 2060 6054  d (bool): If ``T
-00009580: 7275 6560 602c 2074 6865 2070 726f 7669  rue``, the provi
-00009590: 6465 6420 6060 686f 6f6b 6060 2077 696c  ded ``hook`` wil
-000095a0: 6c20 6265 2066 6972 6564 0d0a 2020 2020  l be fired..    
-000095b0: 2020 2020 2020 2020 2020 2020 6265 666f              befo
-000095c0: 7265 2061 6c6c 2065 7869 7374 696e 6720  re all existing 
-000095d0: 6060 666f 7277 6172 6460 6020 686f 6f6b  ``forward`` hook
-000095e0: 7320 6f6e 2074 6869 730d 0a20 2020 2020  s on this..     
-000095f0: 2020 2020 2020 2020 2020 203a 636c 6173             :clas
-00009600: 733a 6074 6f72 6368 2e6e 6e2e 6d6f 6475  s:`torch.nn.modu
-00009610: 6c65 732e 4d6f 6475 6c65 602e 204f 7468  les.Module`. Oth
-00009620: 6572 7769 7365 2c20 7468 6520 7072 6f76  erwise, the prov
-00009630: 6964 6564 0d0a 2020 2020 2020 2020 2020  ided..          
-00009640: 2020 2020 2020 6060 686f 6f6b 6060 2077        ``hook`` w
-00009650: 696c 6c20 6265 2066 6972 6564 2061 6674  ill be fired aft
-00009660: 6572 2061 6c6c 2065 7869 7374 696e 6720  er all existing 
-00009670: 6060 666f 7277 6172 6460 6020 686f 6f6b  ``forward`` hook
-00009680: 7320 6f6e 0d0a 2020 2020 2020 2020 2020  s on..          
-00009690: 2020 2020 2020 7468 6973 203a 636c 6173        this :clas
-000096a0: 733a 6074 6f72 6368 2e6e 6e2e 6d6f 6475  s:`torch.nn.modu
-000096b0: 6c65 732e 4d6f 6475 6c65 602e 204e 6f74  les.Module`. Not
-000096c0: 6520 7468 6174 2067 6c6f 6261 6c0d 0a20  e that global.. 
-000096d0: 2020 2020 2020 2020 2020 2020 2020 2060                 `
-000096e0: 6066 6f72 7761 7264 6060 2068 6f6f 6b73  `forward`` hooks
-000096f0: 2072 6567 6973 7465 7265 6420 7769 7468   registered with
-00009700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009710: 2020 3a66 756e 633a 6072 6567 6973 7465    :func:`registe
-00009720: 725f 6d6f 6475 6c65 5f66 6f72 7761 7264  r_module_forward
-00009730: 5f68 6f6f 6b60 2077 696c 6c20 6669 7265  _hook` will fire
-00009740: 2062 6566 6f72 6520 616c 6c20 686f 6f6b   before all hook
-00009750: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00009760: 2020 2072 6567 6973 7465 7265 6420 6279     registered by
-00009770: 2074 6869 7320 6d65 7468 6f64 2e0d 0a20   this method... 
-00009780: 2020 2020 2020 2020 2020 2020 2020 2044                 D
-00009790: 6566 6175 6c74 3a20 6060 4661 6c73 6560  efault: ``False`
-000097a0: 600d 0a20 2020 2020 2020 2020 2020 2077  `..            w
-000097b0: 6974 685f 6b77 6172 6773 2028 626f 6f6c  ith_kwargs (bool
-000097c0: 293a 2049 6620 6060 5472 7565 6060 2c20  ): If ``True``, 
-000097d0: 7468 6520 6060 686f 6f6b 6060 2077 696c  the ``hook`` wil
-000097e0: 6c20 6265 2070 6173 7365 6420 7468 650d  l be passed the.
-000097f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009800: 206b 7761 7267 7320 6769 7665 6e20 746f   kwargs given to
-00009810: 2074 6865 2066 6f72 7761 7264 2066 756e   the forward fun
-00009820: 6374 696f 6e2e 0d0a 2020 2020 2020 2020  ction...        
-00009830: 2020 2020 2020 2020 4465 6661 756c 743a          Default:
-00009840: 2060 6046 616c 7365 6060 0d0a 0d0a 2020   ``False``....  
-00009850: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
-00009860: 2020 2020 2020 2020 2020 2020 3a63 6c61              :cla
-00009870: 7373 3a60 746f 7263 682e 7574 696c 732e  ss:`torch.utils.
-00009880: 686f 6f6b 732e 5265 6d6f 7661 626c 6548  hooks.RemovableH
-00009890: 616e 646c 6560 3a0d 0a20 2020 2020 2020  andle`:..       
-000098a0: 2020 2020 2020 2020 2061 2068 616e 646c           a handl
-000098b0: 6520 7468 6174 2063 616e 2062 6520 7573  e that can be us
-000098c0: 6564 2074 6f20 7265 6d6f 7665 2074 6865  ed to remove the
-000098d0: 2061 6464 6564 2068 6f6f 6b20 6279 2063   added hook by c
-000098e0: 616c 6c69 6e67 0d0a 2020 2020 2020 2020  alling..        
-000098f0: 2020 2020 2020 2020 6060 6861 6e64 6c65          ``handle
-00009900: 2e72 656d 6f76 6528 2960 600d 0a20 2020  .remove()``..   
-00009910: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00009920: 2020 6861 6e64 6c65 203d 2068 6f6f 6b73    handle = hooks
-00009930: 2e52 656d 6f76 6162 6c65 4861 6e64 6c65  .RemovableHandle
-00009940: 280d 0a20 2020 2020 2020 2020 2020 2073  (..            s
-00009950: 656c 662e 5f66 6f72 7761 7264 5f68 6f6f  elf._forward_hoo
-00009960: 6b73 2c0d 0a20 2020 2020 2020 2020 2020  ks,..           
-00009970: 2065 7874 7261 5f64 6963 743d 7365 6c66   extra_dict=self
-00009980: 2e5f 666f 7277 6172 645f 686f 6f6b 735f  ._forward_hooks_
-00009990: 7769 7468 5f6b 7761 7267 730d 0a20 2020  with_kwargs..   
-000099a0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000099b0: 7365 6c66 2e5f 666f 7277 6172 645f 686f  self._forward_ho
-000099c0: 6f6b 735b 6861 6e64 6c65 2e69 645d 203d  oks[handle.id] =
-000099d0: 2068 6f6f 6b0d 0a20 2020 2020 2020 2069   hook..        i
-000099e0: 6620 7769 7468 5f6b 7761 7267 733a 0d0a  f with_kwargs:..
-000099f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009a00: 2e5f 666f 7277 6172 645f 686f 6f6b 735f  ._forward_hooks_
-00009a10: 7769 7468 5f6b 7761 7267 735b 6861 6e64  with_kwargs[hand
-00009a20: 6c65 2e69 645d 203d 2054 7275 650d 0a0d  le.id] = True...
-00009a30: 0a20 2020 2020 2020 2069 6620 7072 6570  .        if prep
-00009a40: 656e 643a 0d0a 2020 2020 2020 2020 2020  end:..          
-00009a50: 2020 7365 6c66 2e5f 666f 7277 6172 645f    self._forward_
-00009a60: 686f 6f6b 732e 6d6f 7665 5f74 6f5f 656e  hooks.move_to_en
-00009a70: 6428 6861 6e64 6c65 2e69 642c 206c 6173  d(handle.id, las
-00009a80: 743d 4661 6c73 6529 2020 2320 7479 7065  t=False)  # type
-00009a90: 3a20 6967 6e6f 7265 5b61 7474 722d 6465  : ignore[attr-de
-00009aa0: 6669 6e65 645d 0d0a 2020 2020 2020 2020  fined]..        
-00009ab0: 7265 7475 726e 2068 616e 646c 650d 0a0d  return handle...
-00009ac0: 0a20 2020 2064 6566 205f 6765 745f 6e61  .    def _get_na
-00009ad0: 6d65 2873 656c 6629 3a0d 0a20 2020 2020  me(self):..     
-00009ae0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00009af0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00009b00: 5f0d 0a0d 0a20 2020 2064 6566 2072 6567  _....    def reg
-00009b10: 6973 7465 725f 6275 6666 6572 2873 656c  ister_buffer(sel
-00009b20: 662c 206e 616d 653a 2073 7472 2c20 7465  f, name: str, te
-00009b30: 6e73 6f72 3a20 4f70 7469 6f6e 616c 5b54  nsor: Optional[T
-00009b40: 656e 736f 725d 2c20 7065 7273 6973 7465  ensor], persiste
-00009b50: 6e74 3a20 626f 6f6c 203d 2054 7275 6529  nt: bool = True)
-00009b60: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
-00009b70: 2020 2072 2222 2241 6464 7320 6120 7065     r"""Adds a pe
-00009b80: 7273 6973 7465 6e74 2062 7566 6665 7220  rsistent buffer 
-00009b90: 746f 2074 6865 206d 6f64 756c 652e 0d0a  to the module...
-00009ba0: 0d0a 2020 2020 2020 2020 5468 6973 2069  ..        This i
-00009bb0: 7320 7479 7069 6361 6c6c 7920 7573 6564  s typically used
-00009bc0: 2074 6f20 7265 6769 7374 6572 2061 2062   to register a b
-00009bd0: 7566 6665 7220 7468 6174 2073 686f 756c  uffer that shoul
-00009be0: 6420 6e6f 7420 746f 2062 650d 0a20 2020  d not to be..   
-00009bf0: 2020 2020 2063 6f6e 7369 6465 7265 6420       considered 
-00009c00: 6120 6d6f 6465 6c20 7061 7261 6d65 7465  a model paramete
-00009c10: 722e 2046 6f72 2065 7861 6d70 6c65 2c20  r. For example, 
-00009c20: 4261 7463 684e 6f72 6d27 7320 6060 7275  BatchNorm's ``ru
-00009c30: 6e6e 696e 675f 6d65 616e 6060 0d0a 2020  nning_mean``..  
-00009c40: 2020 2020 2020 6973 206e 6f74 2061 2070        is not a p
-00009c50: 6172 616d 6574 6572 2c20 6275 7420 6973  arameter, but is
-00009c60: 2070 6172 7420 6f66 2074 6865 2070 6572   part of the per
-00009c70: 7369 7374 656e 7420 7374 6174 652e 0d0a  sistent state...
-00009c80: 0d0a 2020 2020 2020 2020 4275 6666 6572  ..        Buffer
-00009c90: 7320 6361 6e20 6265 2061 6363 6573 7365  s can be accesse
-00009ca0: 6420 6173 2061 7474 7269 6275 7465 7320  d as attributes 
-00009cb0: 7573 696e 6720 6769 7665 6e20 6e61 6d65  using given name
-00009cc0: 732e 0d0a 0d0a 2020 2020 2020 2020 4172  s.....        Ar
-00009cd0: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00009ce0: 206e 616d 6520 2873 7472 696e 6729 3a20   name (string): 
-00009cf0: 6e61 6d65 206f 6620 7468 6520 6275 6666  name of the buff
-00009d00: 6572 2e20 5468 6520 6275 6666 6572 2063  er. The buffer c
-00009d10: 616e 2062 6520 6163 6365 7373 6564 0d0a  an be accessed..
-00009d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d30: 6672 6f6d 2074 6869 7320 6d6f 6475 6c65  from this module
-00009d40: 2075 7369 6e67 2074 6865 2067 6976 656e   using the given
-00009d50: 206e 616d 650d 0a20 2020 2020 2020 2020   name..         
-00009d60: 2020 2074 656e 736f 7220 2854 656e 736f     tensor (Tenso
-00009d70: 7229 3a20 6275 6666 6572 2074 6f20 6265  r): buffer to be
-00009d80: 2072 6567 6973 7465 7265 642e 0d0a 2020   registered...  
-00009d90: 2020 2020 2020 2020 2020 7065 7273 6973            persis
-00009da0: 7465 6e74 2028 626f 6f6c 293a 2077 6865  tent (bool): whe
-00009db0: 7468 6572 2074 6865 2062 7566 6665 7220  ther the buffer 
-00009dc0: 6973 2070 6172 7420 6f66 2074 6869 7320  is part of this 
-00009dd0: 6d6f 6475 6c65 2773 0d0a 2020 2020 2020  module's..      
-00009de0: 2020 2020 2020 2020 2020 3a61 7474 723a            :attr:
-00009df0: 6073 7461 7465 5f64 6963 7460 2e0d 0a0d  `state_dict`....
-00009e00: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00009e10: 733a 0d0a 0d0a 2020 2020 2020 2020 2020  s:....          
-00009e20: 2020 3e3e 3e20 7365 6c66 2e72 6567 6973    >>> self.regis
-00009e30: 7465 725f 6275 6666 6572 2827 7275 6e6e  ter_buffer('runn
-00009e40: 696e 675f 6d65 616e 272c 2074 662e 7a65  ing_mean', tf.ze
-00009e50: 726f 7328 5b35 5d29 290d 0a0d 0a20 2020  ros([5]))....   
-00009e60: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00009e70: 2020 6966 2027 5f62 7566 6665 7273 2720    if '_buffers' 
-00009e80: 6e6f 7420 696e 2073 656c 662e 5f5f 6469  not in self.__di
-00009e90: 6374 5f5f 3a0d 0a20 2020 2020 2020 2020  ct__:..         
-00009ea0: 2020 2072 6169 7365 2041 7474 7269 6275     raise Attribu
-00009eb0: 7465 4572 726f 7228 2263 616e 6e6f 7420  teError("cannot 
-00009ec0: 6173 7369 676e 2062 7566 6665 7220 6265  assign buffer be
-00009ed0: 666f 7265 204d 6f64 756c 652e 5f5f 696e  fore Module.__in
-00009ee0: 6974 5f5f 2829 2063 616c 6c22 290d 0a20  it__() call").. 
-00009ef0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-00009f00: 6973 696e 7374 616e 6365 286e 616d 652c  isinstance(name,
-00009f10: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
-00009f20: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00009f30: 726f 7228 2262 7566 6665 7220 6e61 6d65  ror("buffer name
-00009f40: 2073 686f 756c 6420 6265 2061 2073 7472   should be a str
-00009f50: 696e 672e 2022 0d0a 2020 2020 2020 2020  ing. "..        
-00009f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f70: 2020 2020 2247 6f74 207b 7d22 2e66 6f72      "Got {}".for
-00009f80: 6d61 7428 7479 7065 286e 616d 6529 2e5f  mat(type(name)._
-00009f90: 5f6e 616d 655f 5f29 290d 0a20 2020 2020  _name__))..     
-00009fa0: 2020 2065 6c69 6620 272e 2720 696e 206e     elif '.' in n
-00009fb0: 616d 653a 0d0a 2020 2020 2020 2020 2020  ame:..          
-00009fc0: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-00009fd0: 2822 6275 6666 6572 206e 616d 6520 6361  ("buffer name ca
-00009fe0: 6e27 7420 636f 6e74 6169 6e20 5c22 2e5c  n't contain \".\
-00009ff0: 2222 290d 0a20 2020 2020 2020 2065 6c69  "")..        eli
-0000a000: 6620 6e61 6d65 203d 3d20 2727 3a0d 0a20  f name == '':.. 
-0000a010: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000a020: 204b 6579 4572 726f 7228 2262 7566 6665   KeyError("buffe
-0000a030: 7220 6e61 6d65 2063 616e 2774 2062 6520  r name can't be 
-0000a040: 656d 7074 7920 7374 7269 6e67 205c 225c  empty string \"\
-0000a050: 2222 290d 0a20 2020 2020 2020 2065 6c69  "")..        eli
-0000a060: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
-0000a070: 6e61 6d65 2920 616e 6420 6e61 6d65 206e  name) and name n
-0000a080: 6f74 2069 6e20 7365 6c66 2e5f 6275 6666  ot in self._buff
-0000a090: 6572 733a 0d0a 2020 2020 2020 2020 2020  ers:..          
-0000a0a0: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-0000a0b0: 2822 6174 7472 6962 7574 6520 277b 7d27  ("attribute '{}'
-0000a0c0: 2061 6c72 6561 6479 2065 7869 7374 7322   already exists"
-0000a0d0: 2e66 6f72 6d61 7428 6e61 6d65 2929 0d0a  .format(name))..
-0000a0e0: 2020 2020 2020 2020 656c 6966 2074 656e          elif ten
-0000a0f0: 736f 7220 6973 206e 6f74 204e 6f6e 6520  sor is not None 
-0000a100: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
-0000a110: 6365 2874 656e 736f 722c 2074 662e 5465  ce(tensor, tf.Te
-0000a120: 6e73 6f72 2920 616e 6420 6e6f 7420 6973  nsor) and not is
-0000a130: 5f74 656e 736f 7228 7465 6e73 6f72 293a  _tensor(tensor):
-0000a140: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-0000a150: 6973 6520 5479 7065 4572 726f 7228 2263  ise TypeError("c
-0000a160: 616e 6e6f 7420 6173 7369 676e 2027 7b7d  annot assign '{}
-0000a170: 2720 6f62 6a65 6374 2074 6f20 6275 6666  ' object to buff
-0000a180: 6572 2027 7b7d 2720 220d 0a20 2020 2020  er '{}' "..     
-0000a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1a0: 2020 2020 2020 2022 2874 656e 736f 7266         "(tensorf
-0000a1b0: 6c6f 7720 5465 6e73 6f72 206f 7220 4e6f  low Tensor or No
-0000a1c0: 6e65 2072 6571 7569 7265 6429 222e 666f  ne required)".fo
-0000a1d0: 726d 6174 2874 7970 6528 7465 6e73 6f72  rmat(type(tensor
-0000a1e0: 292e 5f5f 6e61 6d65 5f5f 2c20 6e61 6d65  ).__name__, name
-0000a1f0: 2929 0d0a 2020 2020 2020 2020 656c 7365  ))..        else
-0000a200: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
-0000a210: 6974 6820 7365 6c66 2e6e 616d 655f 7363  ith self.name_sc
-0000a220: 6f70 653a 0d0a 2020 2020 2020 2020 2020  ope:..          
-0000a230: 2020 2020 2020 7365 6c66 2e5f 6275 6666        self._buff
-0000a240: 6572 735b 6e61 6d65 5d20 3d20 7465 6e73  ers[name] = tens
-0000a250: 6f72 0d0a 2020 2020 2020 2020 2020 2020  or..            
-0000a260: 2020 2020 6966 2070 6572 7369 7374 656e      if persisten
-0000a270: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0000a280: 2020 2020 2020 2020 7365 6c66 2e5f 6e6f          self._no
-0000a290: 6e5f 7065 7273 6973 7465 6e74 5f62 7566  n_persistent_buf
-0000a2a0: 6665 7273 5f73 6574 2e64 6973 6361 7264  fers_set.discard
-0000a2b0: 286e 616d 6529 0d0a 2020 2020 2020 2020  (name)..        
-0000a2c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2020 2073 656c 662e 5f6e 6f6e 5f70 6572     self._non_per
-0000a2f0: 7369 7374 656e 745f 6275 6666 6572 735f  sistent_buffers_
-0000a300: 7365 742e 6164 6428 6e61 6d65 290d 0a0d  set.add(name)...
-0000a310: 0a20 2020 2064 6566 2072 6567 6973 7465  .    def registe
-0000a320: 725f 7061 7261 6d65 7465 7228 7365 6c66  r_parameter(self
-0000a330: 2c20 206e 616d 653a 2073 7472 2c20 7061  ,  name: str, pa
-0000a340: 7261 6d3a 204f 7074 696f 6e61 6c5b 7466  ram: Optional[tf
-0000a350: 2e56 6172 6961 626c 655d 2920 2d3e 204e  .Variable]) -> N
-0000a360: 6f6e 653a 0d0a 2020 2020 2020 2020 7222  one:..        r"
-0000a370: 2222 4164 6473 2061 2070 6172 616d 6574  ""Adds a paramet
-0000a380: 6572 2074 6f20 7468 6520 6d6f 6475 6c65  er to the module
-0000a390: 2e0d 0a0d 0a20 2020 2020 2020 2054 6865  .....        The
-0000a3a0: 2070 6172 616d 6574 6572 2063 616e 2062   parameter can b
-0000a3b0: 6520 6163 6365 7373 6564 2061 7320 616e  e accessed as an
-0000a3c0: 2061 7474 7269 6275 7465 2075 7369 6e67   attribute using
-0000a3d0: 2067 6976 656e 206e 616d 652e 0d0a 0d0a   given name.....
-0000a3e0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
-0000a3f0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-0000a400: 2873 7472 696e 6729 3a20 6e61 6d65 206f  (string): name o
-0000a410: 6620 7468 6520 7061 7261 6d65 7465 722e  f the parameter.
-0000a420: 2054 6865 2070 6172 616d 6574 6572 2063   The parameter c
-0000a430: 616e 2062 6520 6163 6365 7373 6564 0d0a  an be accessed..
-0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a450: 6672 6f6d 2074 6869 7320 6d6f 6475 6c65  from this module
-0000a460: 2075 7369 6e67 2074 6865 2067 6976 656e   using the given
-0000a470: 206e 616d 650d 0a20 2020 2020 2020 2020   name..         
-0000a480: 2020 2070 6172 616d 2028 5061 7261 6d65     param (Parame
-0000a490: 7465 7229 3a20 7061 7261 6d65 7465 7220  ter): parameter 
-0000a4a0: 746f 2062 6520 6164 6465 6420 746f 2074  to be added to t
-0000a4b0: 6865 206d 6f64 756c 652e 0d0a 0d0a 2020  he module.....  
-0000a4c0: 2020 2020 2020 2222 220d 0a0d 0a20 2020        """....   
-0000a4d0: 2020 2020 2069 6620 275f 7061 7261 6d65       if '_parame
-0000a4e0: 7465 7273 2720 6e6f 7420 696e 2073 656c  ters' not in sel
-0000a4f0: 662e 5f5f 6469 6374 5f5f 3a0d 0a20 2020  f.__dict__:..   
-0000a500: 2020 2020 2020 2020 2072 6169 7365 2041           raise A
-0000a510: 7474 7269 6275 7465 4572 726f 7228 2263  ttributeError("c
-0000a520: 616e 6e6f 7420 6173 7369 676e 2070 6172  annot assign par
-0000a530: 616d 6574 6572 2062 6566 6f72 6520 4d6f  ameter before Mo
-0000a540: 6475 6c65 2e5f 5f69 6e69 745f 5f28 2920  dule.__init__() 
-0000a550: 6361 6c6c 2229 0d0a 0d0a 2020 2020 2020  call")....      
-0000a560: 2020 656c 6966 206e 6f74 2069 7369 6e73    elif not isins
-0000a570: 7461 6e63 6528 6e61 6d65 2c20 7374 7229  tance(name, str)
-0000a580: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000a590: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-0000a5a0: 7061 7261 6d65 7465 7220 6e61 6d65 2073  parameter name s
-0000a5b0: 686f 756c 6420 6265 2061 2073 7472 696e  hould be a strin
-0000a5c0: 672e 2022 0d0a 2020 2020 2020 2020 2020  g. "..          
-0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2020 2247 6f74 207b 7d22 2e66 6f72 6d61    "Got {}".forma
-0000a5f0: 7428 7479 7065 286e 616d 6529 2e5f 5f6e  t(type(name).__n
-0000a600: 616d 655f 5f29 290d 0a20 2020 2020 2020  ame__))..       
-0000a610: 2065 6c69 6620 272e 2720 696e 206e 616d   elif '.' in nam
-0000a620: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000a630: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
-0000a640: 7061 7261 6d65 7465 7220 6e61 6d65 2063  parameter name c
-0000a650: 616e 2774 2063 6f6e 7461 696e 205c 222e  an't contain \".
-0000a660: 5c22 2229 0d0a 2020 2020 2020 2020 656c  \"")..        el
-0000a670: 6966 206e 616d 6520 3d3d 2027 273a 0d0a  if name == '':..
-0000a680: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000a690: 6520 4b65 7945 7272 6f72 2822 7061 7261  e KeyError("para
-0000a6a0: 6d65 7465 7220 6e61 6d65 2063 616e 2774  meter name can't
-0000a6b0: 2062 6520 656d 7074 7920 7374 7269 6e67   be empty string
-0000a6c0: 205c 225c 2222 290d 0a20 2020 2020 2020   \"\"")..       
-0000a6d0: 2065 6c69 6620 6861 7361 7474 7228 7365   elif hasattr(se
-0000a6e0: 6c66 2c20 6e61 6d65 2920 616e 6420 6e61  lf, name) and na
-0000a6f0: 6d65 206e 6f74 2069 6e20 7365 6c66 2e5f  me not in self._
-0000a700: 7061 7261 6d65 7465 7273 3a0d 0a20 2020  parameters:..   
-0000a710: 2020 2020 2020 2020 2072 6169 7365 204b           raise K
-0000a720: 6579 4572 726f 7228 2261 7474 7269 6275  eyError("attribu
-0000a730: 7465 2027 7b7d 2720 616c 7265 6164 7920  te '{}' already 
-0000a740: 6578 6973 7473 222e 666f 726d 6174 286e  exists".format(n
-0000a750: 616d 6529 290d 0a0d 0a20 2020 2020 2020  ame))....       
-0000a760: 2069 6620 7061 7261 6d20 6973 204e 6f6e   if param is Non
-0000a770: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000a780: 7365 6c66 2e5f 7061 7261 6d65 7465 7273  self._parameters
-0000a790: 5b6e 616d 655d 203d 204e 6f6e 650d 0a20  [name] = None.. 
-0000a7a0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-0000a7b0: 6973 696e 7374 616e 6365 2870 6172 616d  isinstance(param
-0000a7c0: 2c20 7466 2e56 6172 6961 626c 6529 3a0d  , tf.Variable):.
-0000a7d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000a7e0: 7365 2054 7970 6545 7272 6f72 2822 6361  se TypeError("ca
-0000a7f0: 6e6e 6f74 2061 7373 6967 6e20 277b 7d27  nnot assign '{}'
-0000a800: 206f 626a 6563 7420 746f 2070 6172 616d   object to param
-0000a810: 6574 6572 2027 7b7d 2720 220d 0a20 2020  eter '{}' "..   
-0000a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a830: 2020 2020 2020 2020 2022 2874 662e 5661           "(tf.Va
-0000a840: 7269 6162 6c65 206f 7220 4e6f 6e65 2072  riable or None r
-0000a850: 6571 7569 7265 6429 222e 666f 726d 6174  equired)".format
-0000a860: 2874 7970 6528 7061 7261 6d29 2e5f 5f6e  (type(param).__n
-0000a870: 616d 655f 5f2c 206e 616d 6529 290d 0a20  ame__, name)).. 
-0000a880: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000a890: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000a8a0: 7061 7261 6d65 7465 7273 5b6e 616d 655d  parameters[name]
-0000a8b0: 203d 2070 6172 616d 0d0a 0d0a 2020 2020   = param....    
-0000a8c0: 6465 6620 746f 2873 656c 663a 2054 2c20  def to(self: T, 
-0000a8d0: 2a61 7267 7329 202d 3e20 543a 0d0a 2020  *args) -> T:..  
-0000a8e0: 2020 2020 2020 6465 7669 6365 203d 204e        device = N
-0000a8f0: 6f6e 650d 0a20 2020 2020 2020 2064 7479  one..        dty
-0000a900: 7065 203d 204e 6f6e 650d 0a20 2020 2020  pe = None..     
-0000a910: 2020 206e 6f6e 5f62 6c6f 636b 696e 6720     non_blocking 
-0000a920: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0000a930: 666f 7220 6172 6720 696e 2061 7267 733a  for arg in args:
-0000a940: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000a950: 2027 6370 7527 2069 6e20 6172 672e 6c6f   'cpu' in arg.lo
-0000a960: 7765 7228 2920 6f72 2027 6770 7527 2069  wer() or 'gpu' i
-0000a970: 6e20 6172 672e 6c6f 7765 7228 2920 6f72  n arg.lower() or
-0000a980: 2027 6375 6475 2720 696e 2061 7267 2e6c   'cudu' in arg.l
-0000a990: 6f77 6572 2829 3a0d 0a20 2020 2020 2020  ower():..       
-0000a9a0: 2020 2020 2020 2020 2064 6576 6963 6520           device 
-0000a9b0: 3d20 6172 670d 0a20 2020 2020 2020 2020  = arg..         
-0000a9c0: 2020 2065 6c69 6620 6172 672e 6c6f 7765     elif arg.lowe
-0000a9d0: 7228 2920 696e 205b 2766 6c6f 6174 272c  r() in ['float',
-0000a9e0: 2027 696e 7427 2c20 2762 6f6f 6c27 2c20   'int', 'bool', 
-0000a9f0: 2768 616c 6627 2c20 276c 6f6e 6727 5d3a  'half', 'long']:
-0000aa00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000aa10: 2020 6474 7970 6520 3d20 6172 670d 0a20    dtype = arg.. 
-0000aa20: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000aa30: 6973 696e 7374 616e 6365 2861 7267 2c20  isinstance(arg, 
-0000aa40: 626f 6f6c 293a 0d0a 2020 2020 2020 2020  bool):..        
-0000aa50: 2020 2020 2020 2020 6e6f 6e5f 626c 6f63          non_bloc
-0000aa60: 6b69 6e67 203d 2061 7267 0d0a 0d0a 2020  king = arg....  
-0000aa70: 2020 2020 2020 6966 2064 6576 6963 6520        if device 
-0000aa80: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0000aa90: 2020 2020 2020 6465 7669 6365 203d 2067        device = g
-0000aaa0: 6574 5f64 6576 6963 6528 290d 0a20 2020  et_device()..   
-0000aab0: 2020 2020 2069 6620 6474 7970 6520 6973       if dtype is
-0000aac0: 204e 6f6e 6520 616e 6420 6c65 6e28 7365   None and len(se
-0000aad0: 6c66 2e77 6569 6768 7473 2920 3e20 303a  lf.weights) > 0:
-0000aae0: 0d0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
-0000aaf0: 7970 6520 3d20 7365 6c66 2e77 6569 6768  ype = self.weigh
-0000ab00: 7473 5b30 5d2e 6474 7970 650d 0a20 2020  ts[0].dtype..   
-0000ab10: 2020 2020 2069 6620 2763 7075 2720 696e       if 'cpu' in
-0000ab20: 2064 6576 6963 653a 0d0a 2020 2020 2020   device:..      
-0000ab30: 2020 2020 2020 7365 6c66 2e63 7075 2829        self.cpu()
-0000ab40: 0d0a 2020 2020 2020 2020 656c 6966 2027  ..        elif '
-0000ab50: 6770 7527 2069 6e20 6465 7669 6365 206f  gpu' in device o
-0000ab60: 7220 2763 7564 6127 2069 6e20 6465 7669  r 'cuda' in devi
-0000ab70: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
-0000ab80: 2073 656c 662e 6375 6461 2829 0d0a 2020   self.cuda()..  
-0000ab90: 2020 2020 2020 666f 7220 6d6f 6475 6c65        for module
-0000aba0: 2069 6e20 7365 6c66 2e6d 6f64 756c 6573   in self.modules
-0000abb0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0000abc0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-0000abd0: 2020 2020 2020 2069 6620 6d6f 6475 6c65         if module
-0000abe0: 2e5f 7061 7261 6d65 7465 7273 2069 7320  ._parameters is 
-0000abf0: 6e6f 7420 4e6f 6e65 2061 6e64 206c 656e  not None and len
-0000ac00: 286d 6f64 756c 652e 5f70 6172 616d 6574  (module._paramet
-0000ac10: 6572 7329 203e 2030 3a0d 0a20 2020 2020  ers) > 0:..     
-0000ac20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000ac30: 6f72 206e 616d 652c 2070 6172 6120 696e  or name, para in
-0000ac40: 206d 6f64 756c 652e 5f70 6172 616d 6574   module._paramet
-0000ac50: 6572 732e 6974 656d 7328 293a 0d0a 2020  ers.items():..  
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2020 2020 2020 6966 2070 6172 6120 6973        if para is
-0000ac80: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aca0: 2020 2020 6d6f 6475 6c65 2e5f 7061 7261      module._para
-0000acb0: 6d65 7465 7273 5b6e 616d 655d 203d 204e  meters[name] = N
-0000acc0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0000acd0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000ace0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad00: 6d6f 6475 6c65 2e5f 7061 7261 6d65 7465  module._paramete
-0000ad10: 7273 5b6e 616d 655d 2e61 7373 6967 6e28  rs[name].assign(
-0000ad20: 7466 2e69 6465 6e74 6974 7928 6361 7374  tf.identity(cast
-0000ad30: 2870 6172 612e 7661 6c75 6528 292c 2064  (para.value(), d
-0000ad40: 7479 7065 2929 290d 0a20 2020 2020 2020  type)))..       
-0000ad50: 2020 2020 2020 2020 2069 6620 6d6f 6475           if modu
-0000ad60: 6c65 2e5f 6275 6666 6572 7320 6973 206e  le._buffers is n
-0000ad70: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
-0000ad80: 6d6f 6475 6c65 2e5f 6275 6666 6572 7329  module._buffers)
-0000ad90: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-0000ada0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-0000adb0: 616d 652c 2062 7566 6620 696e 206d 6f64  ame, buff in mod
-0000adc0: 756c 652e 5f62 7566 6665 7273 2e69 7465  ule._buffers.ite
-0000add0: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
-0000ade0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000adf0: 6620 6275 6666 2069 7320 4e6f 6e65 3a0d  f buff is None:.
-0000ae00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ae10: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000ae20: 756c 652e 5f62 7566 6665 7273 5b6e 616d  ule._buffers[nam
-0000ae30: 655d 203d 204e 6f6e 650d 0a20 2020 2020  e] = None..     
-0000ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae50: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0000ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae70: 2020 2020 2020 6d6f 6475 6c65 2e5f 6275        module._bu
-0000ae80: 6666 6572 735b 6e61 6d65 5d20 3d20 7466  ffers[name] = tf
-0000ae90: 2e69 6465 6e74 6974 7928 6361 7374 2862  .identity(cast(b
-0000aea0: 7566 662c 2064 7479 7065 2929 0d0a 2020  uff, dtype))..  
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000aec0: 6475 6c65 2e5f 6465 7669 6365 203d 2073  dule._device = s
-0000aed0: 656c 662e 5f64 6576 6963 650d 0a20 2020  elf._device..   
-0000aee0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000aef0: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
-0000af00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af10: 2070 7269 6e74 2865 290d 0a20 2020 2020   print(e)..     
-0000af20: 2020 2020 2020 2020 2020 2050 7269 6e74             Print
-0000af30: 4578 6365 7074 696f 6e28 290d 0a0d 0a20  Exception().... 
-0000af40: 2020 2064 6566 2063 7564 6128 7365 6c66     def cuda(self
-0000af50: 3a20 542c 2064 6576 6963 653a 204f 7074  : T, device: Opt
-0000af60: 696f 6e61 6c5b 556e 696f 6e5b 696e 742c  ional[Union[int,
-0000af70: 2073 7472 5d5d 203d 204e 6f6e 6529 202d   str]] = None) -
-0000af80: 3e20 543a 0d0a 2020 2020 2020 2020 7222  > T:..        r"
-0000af90: 2222 4d6f 7665 7320 616c 6c20 6d6f 6465  ""Moves all mode
-0000afa0: 6c20 7061 7261 6d65 7465 7273 2061 6e64  l parameters and
-0000afb0: 2062 7566 6665 7273 2074 6f20 7468 6520   buffers to the 
-0000afc0: 4750 552e 0d0a 0d0a 2020 2020 2020 2020  GPU.....        
-0000afd0: 5468 6973 2061 6c73 6f20 6d61 6b65 7320  This also makes 
-0000afe0: 6173 736f 6369 6174 6564 2070 6172 616d  associated param
-0000aff0: 6574 6572 7320 616e 6420 6275 6666 6572  eters and buffer
-0000b000: 7320 6469 6666 6572 656e 7420 6f62 6a65  s different obje
-0000b010: 6374 732e 2053 6f0d 0a20 2020 2020 2020  cts. So..       
-0000b020: 2069 7420 7368 6f75 6c64 2062 6520 6361   it should be ca
-0000b030: 6c6c 6564 2062 6566 6f72 6520 636f 6e73  lled before cons
-0000b040: 7472 7563 7469 6e67 206f 7074 696d 697a  tructing optimiz
-0000b050: 6572 2069 6620 7468 6520 6d6f 6475 6c65  er if the module
-0000b060: 2077 696c 6c0d 0a20 2020 2020 2020 206c   will..        l
-0000b070: 6976 6520 6f6e 2047 5055 2077 6869 6c65  ive on GPU while
-0000b080: 2062 6569 6e67 206f 7074 696d 697a 6564   being optimized
-0000b090: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
-0000b0a0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000b0b0: 6465 7669 6365 2028 696e 742c 206f 7074  device (int, opt
-0000b0c0: 696f 6e61 6c29 3a20 6966 2073 7065 6369  ional): if speci
-0000b0d0: 6669 6564 2c20 616c 6c20 7061 7261 6d65  fied, all parame
-0000b0e0: 7465 7273 2077 696c 6c20 6265 0d0a 2020  ters will be..  
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000b100: 7069 6564 2074 6f20 7468 6174 2064 6576  pied to that dev
-0000b110: 6963 650d 0a0d 0a20 2020 2020 2020 2052  ice....        R
-0000b120: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-0000b130: 2020 2020 204d 6f64 756c 653a 2073 656c       Module: sel
-0000b140: 660d 0a20 2020 2020 2020 2022 2222 0d0a  f..        """..
-0000b150: 0d0a 2020 2020 2020 2020 6966 2074 662e  ..        if tf.
-0000b160: 7465 7374 2e69 735f 6770 755f 6176 6169  test.is_gpu_avai
-0000b170: 6c61 626c 653a 0d0a 2020 2020 2020 2020  lable:..        
-0000b180: 2020 2020 6966 2073 656c 662e 6765 745f      if self.get_
-0000b190: 726f 6f74 2829 2e5f 6465 7669 6365 2021  root()._device !
-0000b1a0: 3d20 272f 6770 753a 3027 3a0d 0a20 2020  = '/gpu:0':..   
-0000b1b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b1c0: 662e 6765 745f 726f 6f74 2829 2e5f 6465  f.get_root()._de
-0000b1d0: 7669 6365 203d 2027 2f67 7075 3a30 270d  vice = '/gpu:0'.
-0000b1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1f0: 2077 6974 6820 7466 2e64 6576 6963 6528   with tf.device(
-0000b200: 7365 6c66 2e5f 6465 7669 6365 293a 0d0a  self._device):..
-0000b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b220: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000b230: 5f61 7070 6c79 286c 616d 6264 6120 743a  _apply(lambda t:
-0000b240: 2074 662e 6964 656e 7469 7479 2874 2929   tf.identity(t))
-0000b250: 0d0a 0d0a 2020 2020 2020 2020 656c 7365  ....        else
-0000b260: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000b270: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-0000b280: 2747 5055 2069 7320 6e6f 7420 6176 6169  'GPU is not avai
-0000b290: 6c61 626c 6520 696e 2074 6869 7320 6d61  lable in this ma
-0000b2a0: 6368 6f6e 652e 2f6e 2729 0d0a 0d0a 2020  chone./n')....  
-0000b2b0: 2020 6465 6620 6370 7528 7365 6c66 3a20    def cpu(self: 
-0000b2c0: 5429 202d 3e20 543a 0d0a 2020 2020 2020  T) -> T:..      
-0000b2d0: 2020 7222 2222 4d6f 7665 7320 616c 6c20    r"""Moves all 
-0000b2e0: 6d6f 6465 6c20 7061 7261 6d65 7465 7273  model parameters
-0000b2f0: 2061 6e64 2062 7566 6665 7273 2074 6f20   and buffers to 
-0000b300: 7468 6520 4350 552e 0d0a 0d0a 2020 2020  the CPU.....    
-0000b310: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-0000b320: 2020 2020 2020 2020 2020 4d6f 6475 6c65            Module
-0000b330: 3a20 7365 6c66 0d0a 2020 2020 2020 2020  : self..        
-0000b340: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-0000b350: 7365 6c66 2e67 6574 5f72 6f6f 7428 292e  self.get_root().
-0000b360: 5f64 6576 6963 6520 213d 2027 2f63 7075  _device != '/cpu
-0000b370: 3a30 273a 0d0a 2020 2020 2020 2020 2020  :0':..          
-0000b380: 2020 7769 7468 2074 662e 6465 7669 6365    with tf.device
-0000b390: 2827 2f63 7075 3a30 2729 3a0d 0a20 2020  ('/cpu:0'):..   
-0000b3a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b3b0: 662e 6765 745f 726f 6f74 2829 2e5f 6465  f.get_root()._de
-0000b3c0: 7669 6365 203d 2027 2f63 7075 3a30 270d  vice = '/cpu:0'.
-0000b3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b3e0: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
-0000b3f0: 706c 7928 6c61 6d62 6461 2074 3a20 7466  ply(lambda t: tf
-0000b400: 2e69 6465 6e74 6974 7928 7429 290d 0a0d  .identity(t))...
-0000b410: 0a20 2020 2064 6566 2067 7075 2873 656c  .    def gpu(sel
-0000b420: 663a 2054 2c20 6465 7669 6365 3a20 4f70  f: T, device: Op
-0000b430: 7469 6f6e 616c 5b55 6e69 6f6e 5b69 6e74  tional[Union[int
-0000b440: 2c20 7374 725d 5d20 3d20 4e6f 6e65 2920  , str]] = None) 
-0000b450: 2d3e 2054 3a0d 0a20 2020 2020 2020 2072  -> T:..        r
-0000b460: 2222 224d 6f76 6573 2061 6c6c 206d 6f64  """Moves all mod
-0000b470: 656c 2070 6172 616d 6574 6572 7320 616e  el parameters an
-0000b480: 6420 6275 6666 6572 7320 746f 2074 6865  d buffers to the
-0000b490: 2047 5055 2e0d 0a0d 0a20 2020 2020 2020   GPU.....       
-0000b4a0: 2054 6869 7320 616c 736f 206d 616b 6573   This also makes
-0000b4b0: 2061 7373 6f63 6961 7465 6420 7061 7261   associated para
-0000b4c0: 6d65 7465 7273 2061 6e64 2062 7566 6665  meters and buffe
-0000b4d0: 7273 2064 6966 6665 7265 6e74 206f 626a  rs different obj
-0000b4e0: 6563 7473 2e20 536f 0d0a 2020 2020 2020  ects. So..      
-0000b4f0: 2020 6974 2073 686f 756c 6420 6265 2063    it should be c
-0000b500: 616c 6c65 6420 6265 666f 7265 2063 6f6e  alled before con
-0000b510: 7374 7275 6374 696e 6720 6f70 7469 6d69  structing optimi
-0000b520: 7a65 7220 6966 2074 6865 206d 6f64 756c  zer if the modul
-0000b530: 6520 7769 6c6c 0d0a 2020 2020 2020 2020  e will..        
-0000b540: 6c69 7665 206f 6e20 4750 5520 7768 696c  live on GPU whil
-0000b550: 6520 6265 696e 6720 6f70 7469 6d69 7a65  e being optimize
-0000b560: 642e 0d0a 0d0a 2020 2020 2020 2020 4172  d.....        Ar
-0000b570: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-0000b580: 2064 6576 6963 6520 2869 6e74 2c20 6f70   device (int, op
-0000b590: 7469 6f6e 616c 293a 2069 6620 7370 6563  tional): if spec
-0000b5a0: 6966 6965 642c 2061 6c6c 2070 6172 616d  ified, all param
-0000b5b0: 6574 6572 7320 7769 6c6c 2062 650d 0a20  eters will be.. 
-0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000b5d0: 6f70 6965 6420 746f 2074 6861 7420 6465  opied to that de
-0000b5e0: 7669 6365 0d0a 0d0a 2020 2020 2020 2020  vice....        
-0000b5f0: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-0000b600: 2020 2020 2020 4d6f 6475 6c65 3a20 7365        Module: se
-0000b610: 6c66 0d0a 2020 2020 2020 2020 2222 220d  lf..        """.
-0000b620: 0a0d 0a20 2020 2020 2020 2069 6620 7466  ...        if tf
-0000b630: 2e74 6573 742e 6973 5f67 7075 5f61 7661  .test.is_gpu_ava
-0000b640: 696c 6162 6c65 3a0d 0a20 2020 2020 2020  ilable:..       
-0000b650: 2020 2020 2069 6620 7365 6c66 2e67 6574       if self.get
-0000b660: 5f72 6f6f 7428 292e 5f64 6576 6963 6520  _root()._device 
-0000b670: 213d 2027 2f67 7075 3a30 273a 0d0a 2020  != '/gpu:0':..  
-0000b680: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000b690: 6c66 2e67 6574 5f72 6f6f 7428 292e 5f64  lf.get_root()._d
-0000b6a0: 6576 6963 6520 3d20 272f 6770 753a 3027  evice = '/gpu:0'
-0000b6b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b6c0: 2020 7769 7468 2074 662e 6465 7669 6365    with tf.device
-0000b6d0: 2873 656c 662e 5f64 6576 6963 6529 3a0d  (self._device):.
-0000b6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b6f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000b700: 2e5f 6170 706c 7928 6c61 6d62 6461 2074  ._apply(lambda t
-0000b710: 3a20 7466 2e69 6465 6e74 6974 7928 7429  : tf.identity(t)
-0000b720: 290d 0a0d 0a20 2020 2020 2020 2065 6c73  )....        els
-0000b730: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000b740: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
-0000b750: 2827 4750 5520 6973 206e 6f74 2061 7661  ('GPU is not ava
-0000b760: 696c 6162 6c65 2069 6e20 7468 6973 206d  ilable in this m
-0000b770: 6163 686f 6e65 2e2f 6e27 290d 0a0d 0a20  achone./n').... 
-0000b780: 2020 2064 6566 205f 6170 706c 7928 7365     def _apply(se
-0000b790: 6c66 2c20 666e 293a 0d0a 2020 2020 2020  lf, fn):..      
-0000b7a0: 2020 666f 7220 6d6f 6475 6c65 2069 6e20    for module in 
-0000b7b0: 7365 6c66 2e63 6869 6c64 7265 6e28 293a  self.children():
-0000b7c0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-0000b7d0: 6475 6c65 2e5f 6170 706c 7928 666e 290d  dule._apply(fn).
-0000b7e0: 0a0d 0a20 2020 2020 2020 2066 6f72 206b  ...        for k
-0000b7f0: 6579 2c20 7061 7261 6d20 696e 2073 656c  ey, param in sel
-0000b800: 662e 5f70 6172 616d 6574 6572 732e 6974  f._parameters.it
-0000b810: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-0000b820: 2020 2020 6966 2070 6172 616d 2069 7320      if param is 
-0000b830: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0000b840: 2020 2020 2020 2020 2020 2023 2054 656e             # Ten
-0000b850: 736f 7273 2073 746f 7265 6420 696e 206d  sors stored in m
-0000b860: 6f64 756c 6573 2061 7265 2067 7261 7068  odules are graph
-0000b870: 206c 6561 7665 732c 2061 6e64 2077 6520   leaves, and we 
-0000b880: 646f 6e27 7420 7761 6e74 2074 6f0d 0a20  don't want to.. 
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b8a0: 2074 7261 636b 2061 7574 6f67 7261 6420   track autograd 
-0000b8b0: 6869 7374 6f72 7920 6f66 2060 7061 7261  history of `para
-0000b8c0: 6d5f 6170 706c 6965 6460 2c20 736f 2077  m_applied`, so w
-0000b8d0: 6520 6861 7665 2074 6f20 7573 650d 0a20  e have to use.. 
-0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b8f0: 2060 7769 7468 2074 6f72 6368 2e6e 6f5f   `with torch.no_
-0000b900: 6772 6164 2829 3a60 0d0a 2020 2020 2020  grad():`..      
-0000b910: 2020 2020 2020 2020 2020 7061 7261 6d5f            param_
-0000b920: 6170 706c 6965 6420 3d20 666e 2870 6172  applied = fn(par
-0000b930: 616d 290d 0a20 2020 2020 2020 2020 2020  am)..           
-0000b940: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000b950: 6365 2870 6172 616d 2c20 7466 2e56 6172  ce(param, tf.Var
-0000b960: 6961 626c 6529 3a0d 0a20 2020 2020 2020  iable):..       
-0000b970: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b980: 662e 5f70 6172 616d 6574 6572 735b 6b65  f._parameters[ke
-0000b990: 795d 203d 2050 6172 616d 6574 6572 2870  y] = Parameter(p
-0000b9a0: 6172 616d 5f61 7070 6c69 6564 2c20 7472  aram_applied, tr
-0000b9b0: 6169 6e61 626c 653d 7061 7261 6d2e 7472  ainable=param.tr
-0000b9c0: 6169 6e61 626c 6529 0d0a 2020 2020 2020  ainable)..      
-0000b9d0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000b9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b9f0: 2020 2020 2070 6172 616d 203d 2070 6172       param = par
-0000ba00: 616d 5f61 7070 6c69 6564 0d0a 2020 2020  am_applied..    
-0000ba10: 2020 2020 2020 2020 2020 2020 230d 0a20              #.. 
-0000ba20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000ba30: 2069 6620 7061 7261 6d2e 6772 6164 2069   if param.grad i
-0000ba40: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0000ba50: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-0000ba60: 2020 2067 7261 645f 6170 706c 6965 6420     grad_applied 
-0000ba70: 3d20 666e 2870 6172 616d 2e67 7261 6429  = fn(param.grad)
-0000ba80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ba90: 2020 2320 2020 2020 7368 6f75 6c64 5f75    #     should_u
-0000baa0: 7365 5f73 6574 5f64 6174 6120 3d20 636f  se_set_data = co
-0000bab0: 6d70 7574 655f 7368 6f75 6c64 5f75 7365  mpute_should_use
-0000bac0: 5f73 6574 5f64 6174 6128 7061 7261 6d2e  _set_data(param.
-0000bad0: 6772 6164 2c20 6772 6164 5f61 7070 6c69  grad, grad_appli
-0000bae0: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
-0000baf0: 2020 2020 2023 2020 2020 2069 6620 7368       #     if sh
-0000bb00: 6f75 6c64 5f75 7365 5f73 6574 5f64 6174  ould_use_set_dat
-0000bb10: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
-0000bb20: 2020 2020 2320 2020 2020 2020 2020 7061      #         pa
-0000bb30: 7261 6d2e 6772 6164 2e64 6174 6120 3d20  ram.grad.data = 
-0000bb40: 6772 6164 5f61 7070 6c69 6564 0d0a 2020  grad_applied..  
-0000bb50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000bb60: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000bb70: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0000bb80: 2020 2020 2061 7373 6572 7420 7061 7261       assert para
-0000bb90: 6d2e 6772 6164 2e69 735f 6c65 6166 0d0a  m.grad.is_leaf..
-0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbb0: 2320 2020 2020 2020 2020 7365 6c66 2e5f  #         self._
-0000bbc0: 7061 7261 6d65 7465 7273 5b6b 6579 5d2e  parameters[key].
-0000bbd0: 6772 6164 203d 2067 7261 645f 6170 706c  grad = grad_appl
-0000bbe0: 6965 642e 7265 7175 6972 6573 5f67 7261  ied.requires_gra
-0000bbf0: 645f 2870 6172 616d 2e67 7261 642e 7265  d_(param.grad.re
-0000bc00: 7175 6972 6573 5f67 7261 6429 0d0a 0d0a  quires_grad)....
-0000bc10: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
-0000bc20: 2062 7566 2069 6e20 7365 6c66 2e5f 6275   buf in self._bu
-0000bc30: 6666 6572 732e 6974 656d 7328 293a 0d0a  ffers.items():..
-0000bc40: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-0000bc50: 7566 2069 7320 6e6f 7420 4e6f 6e65 3a0d  uf is not None:.
-0000bc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bc70: 2073 656c 662e 5f62 7566 6665 7273 5b6b   self._buffers[k
-0000bc80: 6579 5d20 3d20 666e 2862 7566 290d 0a0d  ey] = fn(buf)...
-0000bc90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000bca0: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
-0000bcb0: 6170 706c 7928 7365 6c66 3a20 542c 2066  apply(self: T, f
-0000bcc0: 6e3a 2043 616c 6c61 626c 655b 5b27 4d6f  n: Callable[['Mo
-0000bcd0: 6475 6c65 275d 2c20 4e6f 6e65 5d29 202d  dule'], None]) -
-0000bce0: 3e20 543a 0d0a 2020 2020 2020 2020 7222  > T:..        r"
-0000bcf0: 2222 4170 706c 6965 7320 6060 666e 6060  ""Applies ``fn``
-0000bd00: 2072 6563 7572 7369 7665 6c79 2074 6f20   recursively to 
-0000bd10: 6576 6572 7920 7375 626d 6f64 756c 6520  every submodule 
-0000bd20: 2861 7320 7265 7475 726e 6564 2062 7920  (as returned by 
-0000bd30: 6060 2e63 6869 6c64 7265 6e28 2960 6029  ``.children()``)
-0000bd40: 0d0a 2020 2020 2020 2020 6173 2077 656c  ..        as wel
-0000bd50: 6c20 6173 2073 656c 662e 2054 7970 6963  l as self. Typic
-0000bd60: 616c 2075 7365 2069 6e63 6c75 6465 7320  al use includes 
-0000bd70: 696e 6974 6961 6c69 7a69 6e67 2074 6865  initializing the
-0000bd80: 2070 6172 616d 6574 6572 7320 6f66 2061   parameters of a
-0000bd90: 206d 6f64 656c 0d0a 2020 2020 2020 2020   model..        
-0000bda0: 2873 6565 2061 6c73 6f20 3a72 6566 3a60  (see also :ref:`
-0000bdb0: 6e6e 2d69 6e69 742d 646f 6360 292e 0d0a  nn-init-doc`)...
-0000bdc0: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
-0000bdd0: 0a20 2020 2020 2020 2020 2020 2066 6e20  .            fn 
-0000bde0: 283a 636c 6173 733a 604d 6f64 756c 6560  (:class:`Module`
-0000bdf0: 202d 3e20 4e6f 6e65 293a 2066 756e 6374   -> None): funct
-0000be00: 696f 6e20 746f 2062 6520 6170 706c 6965  ion to be applie
-0000be10: 6420 746f 2065 6163 6820 7375 626d 6f64  d to each submod
-0000be20: 756c 650d 0a0d 0a20 2020 2020 2020 2052  ule....        R
-0000be30: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-0000be40: 2020 2020 204d 6f64 756c 653a 2073 656c       Module: sel
-0000be50: 660d 0a0d 0a20 2020 2020 2020 2045 7861  f....        Exa
-0000be60: 6d70 6c65 3a3a 0d0a 0d0a 2020 2020 2020  mple::....      
-0000be70: 2020 2020 2020 3e3e 3e20 4074 6f72 6368        >>> @torch
-0000be80: 2e6e 6f5f 6772 6164 2829 0d0a 2020 2020  .no_grad()..    
-0000be90: 2020 2020 2020 2020 3e3e 3e20 6465 6620          >>> def 
-0000bea0: 696e 6974 5f77 6569 6768 7473 286d 293a  init_weights(m):
-0000beb0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-0000bec0: 3e20 2020 2020 7072 696e 7428 6d29 0d0a  >     print(m)..
-0000bed0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-0000bee0: 2020 2020 6966 2074 7970 6528 6d29 203d      if type(m) =
-0000bef0: 3d20 6e6e 2e4c 696e 6561 723a 0d0a 2020  = nn.Linear:..  
-0000bf00: 2020 2020 2020 2020 2020 3e3e 3e20 2020            >>>   
-0000bf10: 2020 2020 2020 6d2e 7765 6967 6874 2e66        m.weight.f
-0000bf20: 696c 6c5f 2831 2e30 290d 0a20 2020 2020  ill_(1.0)..     
-0000bf30: 2020 2020 2020 203e 3e3e 2020 2020 2020         >>>      
-0000bf40: 2020 2070 7269 6e74 286d 2e77 6569 6768     print(m.weigh
-0000bf50: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0000bf60: 3e3e 3e20 6e65 7420 3d20 6e6e 2e53 6571  >>> net = nn.Seq
-0000bf70: 7565 6e74 6961 6c28 6e6e 2e4c 696e 6561  uential(nn.Linea
-0000bf80: 7228 322c 2032 292c 206e 6e2e 4c69 6e65  r(2, 2), nn.Line
-0000bf90: 6172 2832 2c20 3229 290d 0a20 2020 2020  ar(2, 2))..     
-0000bfa0: 2020 2020 2020 203e 3e3e 206e 6574 2e61         >>> net.a
-0000bfb0: 7070 6c79 2869 6e69 745f 7765 6967 6874  pply(init_weight
-0000bfc0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0000bfd0: 4c69 6e65 6172 2869 6e5f 6665 6174 7572  Linear(in_featur
-0000bfe0: 6573 3d32 2c20 6f75 745f 6665 6174 7572  es=2, out_featur
-0000bff0: 6573 3d32 2c20 6269 6173 3d54 7275 6529  es=2, bias=True)
-0000c000: 0d0a 2020 2020 2020 2020 2020 2020 5061  ..            Pa
-0000c010: 7261 6d65 7465 7220 636f 6e74 6169 6e69  rameter containi
-0000c020: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
-0000c030: 2074 656e 736f 7228 5b5b 2031 2e2c 2020   tensor([[ 1.,  
-0000c040: 312e 5d2c 0d0a 2020 2020 2020 2020 2020  1.],..          
-0000c050: 2020 2020 2020 2020 2020 5b20 312e 2c20            [ 1., 
-0000c060: 2031 2e5d 5d29 0d0a 2020 2020 2020 2020   1.]])..        
-0000c070: 2020 2020 4c69 6e65 6172 2869 6e5f 6665      Linear(in_fe
-0000c080: 6174 7572 6573 3d32 2c20 6f75 745f 6665  atures=2, out_fe
-0000c090: 6174 7572 6573 3d32 2c20 6269 6173 3d54  atures=2, bias=T
-0000c0a0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0000c0b0: 2020 5061 7261 6d65 7465 7220 636f 6e74    Parameter cont
-0000c0c0: 6169 6e69 6e67 3a0d 0a20 2020 2020 2020  aining:..       
-0000c0d0: 2020 2020 2074 656e 736f 7228 5b5b 2031       tensor([[ 1
-0000c0e0: 2e2c 2020 312e 5d2c 0d0a 2020 2020 2020  .,  1.],..      
-0000c0f0: 2020 2020 2020 2020 2020 2020 2020 5b20                [ 
-0000c100: 312e 2c20 2031 2e5d 5d29 0d0a 2020 2020  1.,  1.]])..    
-0000c110: 2020 2020 2020 2020 5365 7175 656e 7469          Sequenti
-0000c120: 616c 280d 0a20 2020 2020 2020 2020 2020  al(..           
-0000c130: 2020 2028 3029 3a20 4c69 6e65 6172 2869     (0): Linear(i
-0000c140: 6e5f 6665 6174 7572 6573 3d32 2c20 6f75  n_features=2, ou
-0000c150: 745f 6665 6174 7572 6573 3d32 2c20 6269  t_features=2, bi
-0000c160: 6173 3d54 7275 6529 0d0a 2020 2020 2020  as=True)..      
-0000c170: 2020 2020 2020 2020 2831 293a 204c 696e          (1): Lin
-0000c180: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
-0000c190: 322c 206f 7574 5f66 6561 7475 7265 733d  2, out_features=
-0000c1a0: 322c 2062 6961 733d 5472 7565 290d 0a20  2, bias=True).. 
-0000c1b0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-0000c1c0: 2020 2020 2020 2020 2020 5365 7175 656e            Sequen
-0000c1d0: 7469 616c 280d 0a20 2020 2020 2020 2020  tial(..         
-0000c1e0: 2020 2020 2028 3029 3a20 4c69 6e65 6172       (0): Linear
-0000c1f0: 2869 6e5f 6665 6174 7572 6573 3d32 2c20  (in_features=2, 
-0000c200: 6f75 745f 6665 6174 7572 6573 3d32 2c20  out_features=2, 
-0000c210: 6269 6173 3d54 7275 6529 0d0a 2020 2020  bias=True)..    
-0000c220: 2020 2020 2020 2020 2020 2831 293a 204c            (1): L
-0000c230: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
-0000c240: 733d 322c 206f 7574 5f66 6561 7475 7265  s=2, out_feature
-0000c250: 733d 322c 2062 6961 733d 5472 7565 290d  s=2, bias=True).
-0000c260: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-0000c270: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0000c280: 2020 2020 2066 6f72 206d 6f64 756c 6520       for module 
-0000c290: 696e 2073 656c 662e 6368 696c 6472 656e  in self.children
-0000c2a0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0000c2b0: 206d 6f64 756c 652e 6170 706c 7928 666e   module.apply(fn
-0000c2c0: 290d 0a20 2020 2020 2020 2066 6e28 7365  )..        fn(se
-0000c2d0: 6c66 290d 0a20 2020 2020 2020 2072 6574  lf)..        ret
-0000c2e0: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
-0000c2f0: 230d 0a20 2020 2023 2064 6566 2063 7564  #..    # def cud
-0000c300: 6128 7365 6c66 3a20 542c 2064 6576 6963  a(self: T, devic
-0000c310: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
-0000c320: 6e5b 696e 742c 2073 7472 5d5d 203d 204e  n[int, str]] = N
-0000c330: 6f6e 6529 202d 3e20 543a 0d0a 2020 2020  one) -> T:..    
-0000c340: 2320 2020 2020 7222 2222 4d6f 7665 7320  #     r"""Moves 
-0000c350: 616c 6c20 6d6f 6465 6c20 7061 7261 6d65  all model parame
-0000c360: 7465 7273 2061 6e64 2062 7566 6665 7273  ters and buffers
-0000c370: 2074 6f20 7468 6520 4750 552e 0d0a 2020   to the GPU...  
-0000c380: 2020 230d 0a20 2020 2023 2020 2020 2054    #..    #     T
-0000c390: 6869 7320 616c 736f 206d 616b 6573 2061  his also makes a
-0000c3a0: 7373 6f63 6961 7465 6420 7061 7261 6d65  ssociated parame
-0000c3b0: 7465 7273 2061 6e64 2062 7566 6665 7273  ters and buffers
-0000c3c0: 2064 6966 6665 7265 6e74 206f 626a 6563   different objec
-0000c3d0: 7473 2e20 536f 0d0a 2020 2020 2320 2020  ts. So..    #   
-0000c3e0: 2020 6974 2073 686f 756c 6420 6265 2063    it should be c
-0000c3f0: 616c 6c65 6420 6265 666f 7265 2063 6f6e  alled before con
-0000c400: 7374 7275 6374 696e 6720 6f70 7469 6d69  structing optimi
-0000c410: 7a65 7220 6966 2074 6865 206d 6f64 756c  zer if the modul
-0000c420: 6520 7769 6c6c 0d0a 2020 2020 2320 2020  e will..    #   
-0000c430: 2020 6c69 7665 206f 6e20 4750 5520 7768    live on GPU wh
-0000c440: 696c 6520 6265 696e 6720 6f70 7469 6d69  ile being optimi
-0000c450: 7a65 642e 0d0a 2020 2020 230d 0a20 2020  zed...    #..   
-0000c460: 2023 2020 2020 2041 7267 756d 656e 7473   #     Arguments
-0000c470: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0000c480: 2064 6576 6963 6520 2869 6e74 2c20 6f70   device (int, op
-0000c490: 7469 6f6e 616c 293a 2069 6620 7370 6563  tional): if spec
-0000c4a0: 6966 6965 642c 2061 6c6c 2070 6172 616d  ified, all param
-0000c4b0: 6574 6572 7320 7769 6c6c 2062 650d 0a20  eters will be.. 
-0000c4c0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000c4d0: 2063 6f70 6965 6420 746f 2074 6861 7420   copied to that 
-0000c4e0: 6465 7669 6365 0d0a 2020 2020 230d 0a20  device..    #.. 
-0000c4f0: 2020 2023 2020 2020 2052 6574 7572 6e73     #     Returns
-0000c500: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0000c510: 204d 6f64 756c 653a 2073 656c 660d 0a20   Module: self.. 
-0000c520: 2020 2023 2020 2020 2022 2222 0d0a 2020     #     """..  
-0000c530: 2020 2320 2020 2020 7769 7468 2074 662e    #     with tf.
-0000c540: 6465 7669 6365 2827 2f67 7075 3a30 2729  device('/gpu:0')
-0000c550: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0000c560: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
-0000c570: 706c 7928 6c61 6d62 6461 2074 3a20 7429  ply(lambda t: t)
-0000c580: 0d0a 2020 2020 2320 2020 2020 2372 6574  ..    #     #ret
-0000c590: 7572 6e20 7365 6c66 2e5f 6170 706c 7928  urn self._apply(
-0000c5a0: 6c61 6d62 6461 2074 3a20 742e 6375 6461  lambda t: t.cuda
-0000c5b0: 2864 6576 6963 6529 290d 0a0d 0a20 2020  (device))....   
-0000c5c0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-0000c5d0: 6465 6620 6465 7669 6365 2873 656c 6629  def device(self)
-0000c5e0: 3a0d 0a20 2020 2020 2020 205f 726f 6f74  :..        _root
-0000c5f0: 203d 2073 656c 662e 6765 745f 726f 6f74   = self.get_root
-0000c600: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-0000c610: 656c 662e 6973 5f72 6f6f 7420 6f72 205f  elf.is_root or _
-0000c620: 726f 6f74 2069 7320 4e6f 6e65 3a0d 0a20  root is None:.. 
-0000c630: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0000c640: 6e28 7365 6c66 2e77 6569 6768 7473 2920  n(self.weights) 
-0000c650: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-0000c660: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000c670: 6c66 2e66 6163 746f 7279 5f6b 7761 7267  lf.factory_kwarg
-0000c680: 735b 2764 6576 6963 6527 5d0d 0a20 2020  s['device']..   
-0000c690: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6b0: 7265 7475 726e 2073 656c 662e 7765 6967  return self.weig
-0000c6c0: 6874 735b 305d 2e64 6576 6963 652e 7479  hts[0].device.ty
-0000c6d0: 7065 0d0a 2020 2020 2020 2020 656c 7365  pe..        else
-0000c6e0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000c6f0: 6574 7572 6e20 5f72 6f6f 742e 6465 7669  eturn _root.devi
-0000c700: 6365 0d0a 0d0a 2020 2020 4064 6576 6963  ce....    @devic
-0000c710: 652e 7365 7474 6572 0d0a 2020 2020 6465  e.setter..    de
-0000c720: 6620 6465 7669 6365 2873 656c 662c 2076  f device(self, v
-0000c730: 616c 7565 293a 0d0a 2020 2020 2020 2020  alue):..        
-0000c740: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
-0000c750: 6c75 652c 2074 662e 6465 7669 6365 293a  lue, tf.device):
-0000c760: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-0000c770: 6c75 6520 3d76 616c 7565 2e5f 5f73 7472  lue =value.__str
-0000c780: 5f5f 2829 0d0a 2020 2020 2020 2020 7365  __()..        se
-0000c790: 6c66 2e66 6163 746f 7279 5f6b 7761 7267  lf.factory_kwarg
-0000c7a0: 735b 2764 6576 6963 6527 5d20 3d20 7661  s['device'] = va
-0000c7b0: 6c75 650d 0a20 2020 2020 2020 2073 656c  lue..        sel
-0000c7c0: 662e 746f 2876 616c 7565 290d 0a0d 0a0d  f.to(value).....
-0000c7d0: 0a0d 0a0d 0a20 2020 2040 7072 6f70 6572  .....    @proper
-0000c7e0: 7479 0d0a 2020 2020 6465 6620 6275 696c  ty..    def buil
-0000c7f0: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
-0000c800: 2020 7265 7475 726e 2073 656c 662e 5f62    return self._b
-0000c810: 7569 6c74 0d0a 0d0a 2020 2020 4070 726f  uilt....    @pro
-0000c820: 7065 7274 790d 0a20 2020 2064 6566 2069  perty..    def i
-0000c830: 6e70 7574 5f73 6861 7065 2873 656c 6629  nput_shape(self)
-0000c840: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0000c850: 6e20 7365 6c66 2e5f 696e 7075 745f 7368  n self._input_sh
-0000c860: 6170 650d 0a0d 0a20 2020 2040 696e 7075  ape....    @inpu
-0000c870: 745f 7368 6170 652e 7365 7474 6572 0d0a  t_shape.setter..
-0000c880: 2020 2020 6465 6620 696e 7075 745f 7368      def input_sh
-0000c890: 6170 6528 7365 6c66 2c20 7661 6c75 6529  ape(self, value)
-0000c8a0: 3a0d 0a0d 0a20 2020 2020 2020 2069 6620  :....        if 
-0000c8b0: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-0000c8c0: 2c20 7466 2e54 656e 736f 7253 6861 7065  , tf.TensorShape
-0000c8d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000c8e0: 7661 6c75 6520 3d20 5465 6e73 6f72 5368  value = TensorSh
-0000c8f0: 6170 6528 7661 6c75 652e 6173 5f6c 6973  ape(value.as_lis
-0000c900: 7428 2929 0d0a 2020 2020 2020 2020 656c  t())..        el
-0000c910: 6966 2069 735f 7465 6e73 6f72 2876 616c  if is_tensor(val
-0000c920: 7565 2920 616e 6420 7661 6c75 652e 6e64  ue) and value.nd
-0000c930: 696d 203d 3d20 3120 616e 6420 7661 6c75  im == 1 and valu
-0000c940: 652e 6474 7970 6520 3d3d 2044 7479 7065  e.dtype == Dtype
-0000c950: 2e69 6e74 3332 3a0d 0a20 2020 2020 2020  .int32:..       
-0000c960: 2020 2020 2076 616c 7565 203d 2054 656e       value = Ten
-0000c970: 736f 7253 6861 7065 285b 4e6f 6e65 2c20  sorShape([None, 
-0000c980: 5d20 2b20 746f 5f6c 6973 7428 746f 5f6e  ] + to_list(to_n
-0000c990: 756d 7079 2876 616c 7565 2929 290d 0a20  umpy(value))).. 
-0000c9a0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-0000c9b0: 7374 616e 6365 2876 616c 7565 2c20 286c  stance(value, (l
-0000c9c0: 6973 742c 2074 7570 6c65 2929 2061 6e64  ist, tuple)) and
-0000c9d0: 206c 656e 2876 616c 7565 2920 3e20 3020   len(value) > 0 
-0000c9e0: 616e 6420 616c 6c28 0d0a 2020 2020 2020  and all(..      
-0000c9f0: 2020 2020 2020 2020 2020 5b69 7369 6e73            [isins
-0000ca00: 7461 6e63 6528 6974 656d 2c20 6e75 6d62  tance(item, numb
-0000ca10: 6572 732e 496e 7465 6772 616c 2920 666f  ers.Integral) fo
-0000ca20: 7220 6974 656d 2069 6e20 7661 6c75 655d  r item in value]
-0000ca30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000ca40: 7661 6c75 6520 3d20 5465 6e73 6f72 5368  value = TensorSh
-0000ca50: 6170 6528 284e 6f6e 652c 2920 2b20 7661  ape((None,) + va
-0000ca60: 6c75 6529 0d0a 2020 2020 2020 2020 656c  lue)..        el
-0000ca70: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
-0000ca80: 6c75 652c 2028 6c69 7374 2c20 7475 706c  lue, (list, tupl
-0000ca90: 6529 2920 616e 6420 6c65 6e28 7661 6c75  e)) and len(valu
-0000caa0: 6529 203e 2030 2061 6e64 2061 6c6c 280d  e) > 0 and all(.
-0000cab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cac0: 205b 6973 5f74 656e 736f 7228 6974 656d   [is_tensor(item
-0000cad0: 2920 616e 6420 6e64 696d 2869 7465 6d29  ) and ndim(item)
-0000cae0: 203d 3d20 3120 616e 6420 6974 656d 2e64   == 1 and item.d
-0000caf0: 7479 7065 203d 3d20 7466 2e69 6e74 3332  type == tf.int32
-0000cb00: 2066 6f72 2069 7465 6d20 696e 2076 616c   for item in val
-0000cb10: 7565 5d29 3a0d 0a20 2020 2020 2020 2020  ue]):..         
-0000cb20: 2020 2076 616c 7565 203d 205b 5465 6e73     value = [Tens
-0000cb30: 6f72 5368 6170 6528 746f 5f6c 6973 7428  orShape(to_list(
-0000cb40: 746f 5f6e 756d 7079 2873 6829 2929 2066  to_numpy(sh))) f
-0000cb50: 6f72 2073 6820 696e 2076 616c 7565 5d0d  or sh in value].
-0000cb60: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0000cb70: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
-0000cb80: 5465 6e73 6f72 5368 6170 6529 3a0d 0a20  TensorShape):.. 
-0000cb90: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-0000cba0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0000cbb0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0000cbc0: 6520 3d20 5465 6e73 6f72 5368 6170 6528  e = TensorShape(
-0000cbd0: 6c69 7374 2876 616c 7565 2929 0d0a 0d0a  list(value))....
-0000cbe0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000cbf0: 5f62 7569 6c74 203d 3d20 4661 6c73 6520  _built == False 
-0000cc00: 6f72 2073 656c 662e 5f69 6e70 7574 5f73  or self._input_s
-0000cc10: 6861 7065 2069 7320 4e6f 6e65 206f 7220  hape is None or 
-0000cc20: 7365 6c66 2e69 6e70 7574 5f66 696c 7465  self.input_filte
-0000cc30: 7273 2069 7320 4e6f 6e65 3a0d 0a20 2020  rs is None:..   
-0000cc40: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-0000cc50: 6e70 7574 5f73 6861 7065 203d 2076 616c  nput_shape = val
-0000cc60: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0000cc70: 7365 6c66 2e69 6e70 7574 5f66 696c 7465  self.input_filte
-0000cc80: 7273 203d 2073 656c 662e 5f69 6e70 7574  rs = self._input
-0000cc90: 5f73 6861 7065 5b73 656c 662e 6669 6c74  _shape[self.filt
-0000cca0: 6572 5f69 6e64 6578 5d0d 0a20 2020 2020  er_index]..     
-0000ccb0: 2020 2020 2020 2073 656c 662e 6275 696c         self.buil
-0000ccc0: 6428 7661 6c75 6529 0d0a 2020 2020 2020  d(value)..      
-0000ccd0: 2020 2020 2020 7365 6c66 2e5f 6275 696c        self._buil
-0000cce0: 7420 3d20 5472 7565 0d0a 0d0a 2020 2020  t = True....    
-0000ccf0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000cd00: 6973 5f72 6f6f 743a 0d0a 2020 2020 2020  is_root:..      
-0000cd10: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000cd20: 662e 5f73 6967 6e61 7475 7265 2069 7320  f._signature is 
-0000cd30: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000cd40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cd50: 5f73 6967 6e61 7475 7265 203d 2053 6967  _signature = Sig
-0000cd60: 6e61 7475 7265 286e 616d 653d 7365 6c66  nature(name=self
-0000cd70: 2e6e 616d 6529 0d0a 2020 2020 2020 2020  .name)..        
-0000cd80: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
-0000cd90: 676e 6174 7572 652e 696e 7075 7473 203d  gnature.inputs =
-0000cda0: 204f 7264 6572 6564 4469 6374 2829 0d0a   OrderedDict()..
-0000cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdc0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-0000cdd0: 6c66 2e5f 696e 7075 745f 7368 6170 652c  lf._input_shape,
-0000cde0: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
-0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce00: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
-0000ce10: 7572 652e 696e 7075 7473 5b27 696e 7075  ure.inputs['inpu
-0000ce20: 7427 5d20 3d20 5465 6e73 6f72 5370 6563  t'] = TensorSpec
-0000ce30: 2873 6861 7065 3d73 656c 662e 5f69 6e70  (shape=self._inp
-0000ce40: 7574 5f73 6861 7065 2c20 6e61 6d65 3d27  ut_shape, name='
-0000ce50: 696e 7075 7427 290d 0a0d 0a20 2020 2020  input')....     
-0000ce60: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000ce70: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-0000ce80: 5f69 6e70 7574 5f73 6861 7065 2c20 6c69  _input_shape, li
-0000ce90: 7374 293a 0d0a 2020 2020 2020 2020 2020  st):..          
-0000cea0: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-0000ceb0: 696e 2072 616e 6765 286c 656e 2873 656c  in range(len(sel
-0000cec0: 662e 5f69 6e70 7574 5f73 6861 7065 2929  f._input_shape))
-0000ced0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000cee0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cef0: 5f73 6967 6e61 7475 7265 2e69 6e70 7574  _signature.input
-0000cf00: 735b 2769 6e70 7574 5f7b 307d 272e 666f  s['input_{0}'.fo
-0000cf10: 726d 6174 286b 295d 203d 2054 656e 736f  rmat(k)] = Tenso
-0000cf20: 7253 7065 6328 7368 6170 653d 7365 6c66  rSpec(shape=self
-0000cf30: 2e5f 696e 7075 745f 7368 6170 655b 6b5d  ._input_shape[k]
-0000cf40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00000090: 6672 6f6d 2063 6f70 7920 696d 706f 7274  from copy import
+000000a0: 2064 6565 7063 6f70 790d 0a69 6d70 6f72   deepcopy..impor
+000000b0: 7420 6675 6e63 746f 6f6c 730d 0a69 6d70  t functools..imp
+000000c0: 6f72 7420 6763 0d0a 696d 706f 7274 2069  ort gc..import i
+000000d0: 6e73 7065 6374 0d0a 696d 706f 7274 2069  nspect..import i
+000000e0: 7465 7274 6f6f 6c73 0d0a 696d 706f 7274  tertools..import
+000000f0: 206e 756d 6265 7273 0d0a 696d 706f 7274   numbers..import
+00000100: 206f 7065 7261 746f 720d 0a69 6d70 6f72   operator..impor
+00000110: 7420 6f73 0d0a 696d 706f 7274 2073 7973  t os..import sys
+00000120: 0d0a 696d 706f 7274 2074 7970 696e 670d  ..import typing.
+00000130: 0a69 6d70 6f72 7420 7575 6964 0d0a 696d  .import uuid..im
+00000140: 706f 7274 2077 6561 6b72 6566 0d0a 6672  port weakref..fr
+00000150: 6f6d 2063 6f6c 6c65 6374 696f 6e73 2069  om collections i
+00000160: 6d70 6f72 7420 6162 630d 0a66 726f 6d20  mport abc..from 
+00000170: 636f 6c6c 6563 7469 6f6e 7320 696d 706f  collections impo
+00000180: 7274 2064 6566 6175 6c74 6469 6374 2c20  rt defaultdict, 
+00000190: 6e61 6d65 6474 7570 6c65 0d0a 6672 6f6d  namedtuple..from
+000001a0: 2064 6973 7475 7469 6c73 2e76 6572 7369   distutils.versi
+000001b0: 6f6e 2069 6d70 6f72 7420 4c6f 6f73 6556  on import LooseV
+000001c0: 6572 7369 6f6e 0d0a 6672 6f6d 2066 756e  ersion..from fun
+000001d0: 6374 6f6f 6c73 2069 6d70 6f72 7420 7061  ctools import pa
+000001e0: 7274 6961 6c0d 0a66 726f 6d20 6974 6572  rtial..from iter
+000001f0: 746f 6f6c 7320 696d 706f 7274 2069 736c  tools import isl
+00000200: 6963 650d 0a66 726f 6d20 7479 7065 7320  ice..from types 
+00000210: 696d 706f 7274 204d 6574 686f 6454 7970  import MethodTyp
+00000220: 650d 0a66 726f 6d20 7479 7069 6e67 2069  e..from typing i
+00000230: 6d70 6f72 7420 556e 696f 6e2c 2054 7570  mport Union, Tup
+00000240: 6c65 2c20 416e 792c 2043 616c 6c61 626c  le, Any, Callabl
+00000250: 652c 2049 7465 7261 746f 722c 2053 6574  e, Iterator, Set
+00000260: 2c20 4f70 7469 6f6e 616c 2c20 6f76 6572  , Optional, over
+00000270: 6c6f 6164 2c20 5479 7065 5661 722c 204d  load, TypeVar, M
+00000280: 6170 7069 6e67 2c20 4469 6374 2c20 4c69  apping, Dict, Li
+00000290: 7374 2c20 5c0d 0a20 2020 2049 7465 7261  st, \..    Itera
+000002a0: 626c 650d 0a0d 0a69 6d70 6f72 7420 6e75  ble....import nu
+000002b0: 6d70 7920 6173 206e 700d 0a69 6d70 6f72  mpy as np..impor
+000002c0: 7420 7465 6e73 6f72 666c 6f77 2061 7320  t tensorflow as 
+000002d0: 7466 0d0a 0d0a 2320 6672 6f6d 2074 656e  tf....# from ten
+000002e0: 736f 7266 6c6f 772e 7079 7468 6f6e 2069  sorflow.python i
+000002f0: 6d70 6f72 7420 656e 6162 6c65 5f65 6167  mport enable_eag
+00000300: 6572 5f65 7865 6375 7469 6f6e 0d0a 0d0a  er_execution....
+00000310: 7466 2e65 7865 6375 7469 6e67 5f65 6167  tf.executing_eag
+00000320: 6572 6c79 2829 0d0a 0d0a 6672 6f6d 2074  erly()....from t
+00000330: 656e 736f 7266 6c6f 772e 7079 7468 6f6e  ensorflow.python
+00000340: 2e66 7261 6d65 776f 726b 2069 6d70 6f72  .framework impor
+00000350: 7420 6f70 730d 0a0d 0a66 726f 6d20 7465  t ops....from te
+00000360: 6e73 6f72 666c 6f77 2e70 7974 686f 6e2e  nsorflow.python.
+00000370: 6d6f 6475 6c65 2069 6d70 6f72 7420 6d6f  module import mo
+00000380: 6475 6c65 0d0a 6672 6f6d 2074 656e 736f  dule..from tenso
+00000390: 7266 6c6f 772e 7079 7468 6f6e 2e75 7469  rflow.python.uti
+000003a0: 6c20 696d 706f 7274 206f 626a 6563 745f  l import object_
+000003b0: 6964 656e 7469 7479 0d0a 6672 6f6d 2074  identity..from t
+000003c0: 7269 6465 6e74 2e62 6163 6b65 6e64 2069  rident.backend i
+000003d0: 6d70 6f72 7420 6974 6572 6174 696f 6e5f  mport iteration_
+000003e0: 746f 6f6c 730d 0a66 726f 6d20 7472 6964  tools..from trid
+000003f0: 656e 742e 6261 636b 656e 642e 636f 6d6d  ent.backend.comm
+00000400: 6f6e 2069 6d70 6f72 7420 6361 6d65 6c32  on import camel2
+00000410: 736e 616b 652c 2074 6f5f 6c69 7374 2c20  snake, to_list, 
+00000420: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
+00000430: 2c20 656e 666f 7263 655f 7369 6e67 6c65  , enforce_single
+00000440: 746f 6e2c 204f 7264 6572 6564 4469 6374  ton, OrderedDict
+00000450: 2c20 5369 676e 6174 7572 652c 205c 0d0a  , Signature, \..
+00000460: 2020 2020 5072 696e 7445 7863 6570 7469      PrintExcepti
+00000470: 6f6e 2c20 5465 6e73 6f72 5368 6170 652c  on, TensorShape,
+00000480: 205c 0d0a 2020 2020 6765 745f 6172 6773   \..    get_args
+00000490: 5f73 7065 632c 2069 735f 696e 7374 616e  _spec, is_instan
+000004a0: 6365 0d0a 6672 6f6d 2074 7269 6465 6e74  ce..from trident
+000004b0: 2e62 6163 6b65 6e64 2e74 656e 736f 7266  .backend.tensorf
+000004c0: 6c6f 775f 6f70 7320 696d 706f 7274 202a  low_ops import *
+000004d0: 0d0a 6672 6f6d 2074 7269 6465 6e74 2e62  ..from trident.b
+000004e0: 6163 6b65 6e64 2069 6d70 6f72 7420 7465  ackend import te
+000004f0: 6e73 6f72 666c 6f77 5f6f 7073 2061 7320  nsorflow_ops as 
+00000500: 746f 7073 0d0a 6672 6f6d 2074 7269 6465  tops..from tride
+00000510: 6e74 2e62 6163 6b65 6e64 2069 6d70 6f72  nt.backend impor
+00000520: 7420 6474 7970 6520 6173 2044 7479 7065  t dtype as Dtype
+00000530: 0d0a 0d0a 5f46 554e 5f4e 414d 4553 203d  ...._FUN_NAMES =
+00000540: 205b 0d0a 2020 2020 2827 666c 6f61 7427   [..    ('float'
+00000550: 2c20 746f 7073 2e66 6c6f 6174 292c 0d0a  , tops.float),..
+00000560: 2020 2020 2827 6c6f 6e67 272c 2074 6f70      ('long', top
+00000570: 732e 6c6f 6e67 292c 0d0a 2020 2020 2827  s.long),..    ('
+00000580: 6571 7561 6c27 2c20 746f 7073 2e65 7175  equal', tops.equ
+00000590: 616c 292c 0d0a 2020 2020 2827 696e 7427  al),..    ('int'
+000005a0: 2c20 746f 7073 2e69 6e74 292c 0d0a 2020  , tops.int),..  
+000005b0: 2020 2827 746f 272c 2074 6f70 732e 746f    ('to', tops.to
+000005c0: 295d 0d0a 666f 7220 7461 7267 6574 5f66  )]..for target_f
+000005d0: 756e 5f6e 616d 652c 2073 6f75 7263 655f  un_name, source_
+000005e0: 6675 6e20 696e 205f 4655 4e5f 4e41 4d45  fun in _FUN_NAME
+000005f0: 533a 0d0a 2020 2020 7365 7461 7474 7228  S:..    setattr(
+00000600: 5465 6e73 6f72 2c20 7461 7267 6574 5f66  Tensor, target_f
+00000610: 756e 5f6e 616d 652c 2073 6f75 7263 655f  un_name, source_
+00000620: 6675 6e29 0d0a 0d0a 6672 6f6d 2074 7269  fun)....from tri
+00000630: 6465 6e74 2e62 6163 6b65 6e64 2e74 656e  dent.backend.ten
+00000640: 736f 7273 7065 6320 696d 706f 7274 202a  sorspec import *
+00000650: 0d0a 6672 6f6d 2074 7269 6465 6e74 2e64  ..from trident.d
+00000660: 6174 612e 7574 696c 7320 696d 706f 7274  ata.utils import
+00000670: 2070 6963 6b6c 655f 6974 0d0a 6672 6f6d   pickle_it..from
+00000680: 2074 7269 6465 6e74 2e62 6163 6b65 6e64   trident.backend
+00000690: 2069 6d70 6f72 7420 7465 6e73 6f72 666c   import tensorfl
+000006a0: 6f77 5f73 6572 6961 6c69 7a61 7469 6f6e  ow_serialization
+000006b0: 2061 7320 7365 7269 616c 697a 6174 696f   as serializatio
+000006c0: 6e0d 0a66 726f 6d20 7472 6964 656e 7420  n..from trident 
+000006d0: 696d 706f 7274 2063 6f6e 7465 7874 0d0a  import context..
+000006e0: 0d0a 5f5f 616c 6c5f 5f20 3d20 5b27 7365  ..__all__ = ['se
+000006f0: 745f 6465 7669 6365 272c 2027 4454 5950  t_device', 'DTYP
+00000700: 455f 4d41 5050 494e 4727 2c20 274c 6179  E_MAPPING', 'Lay
+00000710: 6572 272c 2027 6765 745f 6465 7669 6365  er', 'get_device
+00000720: 272c 2027 5061 7261 6d65 7465 7227 2c20  ', 'Parameter', 
+00000730: 2753 6571 7565 6e74 6961 6c27 2c20 274d  'Sequential', 'M
+00000740: 6f64 756c 654c 6973 7427 2c20 274d 6f64  oduleList', 'Mod
+00000750: 756c 6544 6963 7427 2c0d 0a20 2020 2020  uleDict',..     
+00000760: 2020 2020 2020 2773 756d 6d61 7279 272c        'summary',
+00000770: 2027 6e6f 726d 616c 697a 655f 7061 6464   'normalize_padd
+00000780: 696e 6727 2c20 276c 6f61 6427 2c20 2773  ing', 'load', 's
+00000790: 6176 6527 2c20 2774 7279 5f6d 6170 5f61  ave', 'try_map_a
+000007a0: 7267 735f 616e 645f 6361 6c6c 272c 0d0a  rgs_and_call',..
+000007b0: 2020 2020 2020 2020 2020 2027 6669 785f             'fix_
+000007c0: 6c61 7965 7227 2c20 2766 6978 5f6b 6572  layer', 'fix_ker
+000007d0: 6173 5f6d 6f64 756c 6527 5d0d 0a0d 0a63  as_module']....c
+000007e0: 7478 203d 2063 6f6e 7465 7874 2e5f 636f  tx = context._co
+000007f0: 6e74 6578 7428 290d 0a0d 0a44 5459 5045  ntext()....DTYPE
+00000800: 5f4d 4150 5049 4e47 203d 207b 0d0a 2020  _MAPPING = {..  
+00000810: 2020 7466 2e62 6f6f 6c3a 2044 7479 7065    tf.bool: Dtype
+00000820: 2e62 6f6f 6c2c 0d0a 2020 2020 7466 2e69  .bool,..    tf.i
+00000830: 6e74 383a 2044 7479 7065 2e69 6e74 382c  nt8: Dtype.int8,
+00000840: 0d0a 2020 2020 7466 2e69 6e74 3136 3a20  ..    tf.int16: 
+00000850: 4474 7970 652e 696e 7431 362c 0d0a 2020  Dtype.int16,..  
+00000860: 2020 7466 2e69 6e74 3332 3a20 4474 7970    tf.int32: Dtyp
+00000870: 652e 696e 7433 322c 0d0a 2020 2020 7466  e.int32,..    tf
+00000880: 2e69 6e74 3634 3a20 4474 7970 652e 696e  .int64: Dtype.in
+00000890: 7436 342c 0d0a 2020 2020 7466 2e75 696e  t64,..    tf.uin
+000008a0: 7438 3a20 4474 7970 652e 7569 6e74 382c  t8: Dtype.uint8,
+000008b0: 0d0a 2020 2020 7466 2e66 6c6f 6174 3136  ..    tf.float16
+000008c0: 3a20 4474 7970 652e 666c 6f61 7431 362c  : Dtype.float16,
+000008d0: 0d0a 2020 2020 7466 2e66 6c6f 6174 3332  ..    tf.float32
+000008e0: 3a20 4474 7970 652e 666c 6f61 7433 322c  : Dtype.float32,
+000008f0: 0d0a 2020 2020 7466 2e66 6c6f 6174 3634  ..    tf.float64
+00000900: 3a20 4474 7970 652e 666c 6f61 7436 342c  : Dtype.float64,
+00000910: 0d0a 2020 2020 7466 2e63 6f6d 706c 6578  ..    tf.complex
+00000920: 3634 3a20 4474 7970 652e 636f 6d70 6c65  64: Dtype.comple
+00000930: 7836 342c 0d0a 2020 2020 7466 2e63 6f6d  x64,..    tf.com
+00000940: 706c 6578 3132 383a 2044 7479 7065 2e63  plex128: Dtype.c
+00000950: 6f6d 706c 6578 3132 382c 0d0a 0d0a 7d0d  omplex128,....}.
+00000960: 0a0d 0a0d 0a64 6566 2067 6574 5f64 6576  .....def get_dev
+00000970: 6963 6528 293a 0d0a 2020 2020 2222 2267  ice():..    """g
+00000980: 6574 2063 7572 7265 6e74 2064 6576 6963  et current devic
+00000990: 650d 0a0d 0a20 2020 2052 6574 7572 6e73  e....    Returns
+000009a0: 3a20 6465 7669 6365 2073 7472 696e 6720  : device string 
+000009b0: 2827 6370 7527 2c20 2763 7564 6129 0d0a  ('cpu', 'cuda)..
+000009c0: 0d0a 2020 2020 2222 220d 0a20 2020 2069  ..    """..    i
+000009d0: 6620 6374 782e 6465 7669 6365 2069 7320  f ctx.device is 
+000009e0: 4e6f 6e65 206f 7220 6374 782e 6465 7669  None or ctx.devi
+000009f0: 6365 203d 3d20 2763 7564 6127 3a0d 0a20  ce == 'cuda':.. 
+00000a00: 2020 2020 2020 2073 6574 5f64 6576 6963         set_devic
+00000a10: 6528 272f 6770 753a 3027 2069 6620 6c65  e('/gpu:0' if le
+00000a20: 6e28 7466 2e63 6f6e 6669 672e 6c69 7374  n(tf.config.list
+00000a30: 5f70 6879 7369 6361 6c5f 6465 7669 6365  _physical_device
+00000a40: 7328 2747 5055 2729 2920 3e20 3020 656c  s('GPU')) > 0 el
+00000a50: 7365 2022 2f63 7075 3a30 2229 0d0a 2020  se "/cpu:0")..  
+00000a60: 2020 7265 7475 726e 2063 7478 2e64 6576    return ctx.dev
+00000a70: 6963 650d 0a0d 0a0d 0a64 6566 2073 6574  ice......def set
+00000a80: 5f64 6576 6963 6528 6465 7669 6365 3d27  _device(device='
+00000a90: 2f63 7075 3a30 2729 3a0d 0a20 2020 2069  /cpu:0'):..    i
+00000aa0: 6620 6465 7669 6365 2e6c 6f77 6572 2829  f device.lower()
+00000ab0: 203d 3d20 2763 7564 6127 206f 7220 6465   == 'cuda' or de
+00000ac0: 7669 6365 2e6c 6f77 6572 2829 203d 3d20  vice.lower() == 
+00000ad0: 2767 7075 273a 0d0a 2020 2020 2020 2020  'gpu':..        
+00000ae0: 6f73 2e65 6e76 6972 6f6e 5b22 4355 4441  os.environ["CUDA
+00000af0: 5f44 4556 4943 455f 4f52 4445 5222 5d20  _DEVICE_ORDER"] 
+00000b00: 3d20 2250 4349 5f42 5553 5f49 4422 2020  = "PCI_BUS_ID"  
+00000b10: 2320 7365 6520 6973 7375 6520 2331 3532  # see issue #152
+00000b20: 0d0a 2020 2020 2020 2020 6f73 2e65 6e76  ..        os.env
+00000b30: 6972 6f6e 5b22 4355 4441 5f56 4953 4942  iron["CUDA_VISIB
+00000b40: 4c45 5f44 4556 4943 4553 225d 203d 2027  LE_DEVICES"] = '
+00000b50: 3027 0d0a 2020 2020 2020 2020 6374 782e  0'..        ctx.
+00000b60: 6465 7669 6365 203d 2027 2f67 7075 3a30  device = '/gpu:0
+00000b70: 270d 0a20 2020 2069 6620 6465 7669 6365  '..    if device
+00000b80: 2e6c 6f77 6572 2829 203d 3d20 2763 7075  .lower() == 'cpu
+00000b90: 273a 0d0a 2020 2020 2020 2020 6f73 2e65  ':..        os.e
+00000ba0: 6e76 6972 6f6e 2e70 6f70 2822 4355 4441  nviron.pop("CUDA
+00000bb0: 5f56 4953 4942 4c45 5f44 4556 4943 4553  _VISIBLE_DEVICES
+00000bc0: 2229 0d0a 2020 2020 2020 2020 6374 782e  ")..        ctx.
+00000bd0: 6465 7669 6365 203d 2027 2f63 7075 3a30  device = '/cpu:0
+00000be0: 270d 0a20 2020 2069 6620 2767 7075 2720  '..    if 'gpu' 
+00000bf0: 696e 2064 6576 6963 6520 616e 6420 6c65  in device and le
+00000c00: 6e28 7466 2e63 6f6e 6669 672e 6c69 7374  n(tf.config.list
+00000c10: 5f70 6879 7369 6361 6c5f 6465 7669 6365  _physical_device
+00000c20: 7328 2747 5055 2729 2920 3d3d 2030 3a0d  s('GPU')) == 0:.
+00000c30: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+00000c40: 616c 7565 4572 726f 7228 2747 7075 2069  alueError('Gpu i
+00000c50: 7320 6e6f 7420 6176 6169 6c61 626c 652e  s not available.
+00000c60: 2e2e 2729 0d0a 2020 2020 7472 793a 0d0a  ..')..    try:..
+00000c70: 0d0a 2020 2020 2020 2020 6763 6974 656d  ..        gcitem
+00000c80: 7320 3d20 6763 2e67 6574 5f6f 626a 6563  s = gc.get_objec
+00000c90: 7473 2829 0d0a 2020 2020 2020 2020 666f  ts()..        fo
+00000ca0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+00000cb0: 2867 6369 7465 6d73 2929 3a0d 0a20 2020  (gcitems)):..   
+00000cc0: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
+00000cd0: 6763 6974 656d 735b 695d 0d0a 2020 2020  gcitems[i]..    
+00000ce0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00000cf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00000d00: 206e 6f74 2069 6e73 7065 6374 2e69 7363   not inspect.isc
+00000d10: 6c61 7373 2869 7465 6d29 2061 6e64 2069  lass(item) and i
+00000d20: 735f 7465 6e73 6f72 2869 7465 6d29 3a0d  s_tensor(item):.
+00000d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000d40: 2020 2020 2077 6974 6820 7466 2e64 6576       with tf.dev
+00000d50: 6963 6528 6374 782e 6465 7669 6365 293a  ice(ctx.device):
+00000d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000d70: 2020 2020 2020 2020 2020 6974 656d 203d            item =
+00000d80: 2074 662e 6964 656e 7469 7479 2869 7465   tf.identity(ite
+00000d90: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+00000da0: 2020 2020 656c 6966 206e 6f74 2069 6e73      elif not ins
+00000db0: 7065 6374 2e69 7363 6c61 7373 2869 7465  pect.isclass(ite
+00000dc0: 6d29 2061 6e64 2069 735f 696e 7374 616e  m) and is_instan
+00000dd0: 6365 2869 7465 6d2c 2027 7472 6964 656e  ce(item, 'triden
+00000de0: 742e 6261 636b 656e 642e 7465 6e73 6f72  t.backend.tensor
+00000df0: 666c 6f77 5f62 6163 6b65 6e64 2e4c 6179  flow_backend.Lay
+00000e00: 6572 2729 3a0d 0a20 2020 2020 2020 2020  er'):..         
+00000e10: 2020 2020 2020 2020 2020 2069 7465 6d2e             item.
+00000e20: 746f 2864 6576 6963 6529 0d0a 2020 2020  to(device)..    
+00000e30: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00000e40: 206e 6f74 2069 6e73 7065 6374 2e69 7363   not inspect.isc
+00000e50: 6c61 7373 2869 7465 6d29 2061 6e64 2069  lass(item) and i
+00000e60: 735f 696e 7374 616e 6365 2869 7465 6d2c  s_instance(item,
+00000e70: 2027 4c61 7965 7227 293a 0d0a 2020 2020   'Layer'):..    
+00000e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e90: 7769 7468 2074 662e 6465 7669 6365 2863  with tf.device(c
+00000ea0: 7478 2e64 6576 6963 6529 3a0d 0a20 2020  tx.device):..   
+00000eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ec0: 2020 2020 2069 7465 6d20 3d20 7466 2e69       item = tf.i
+00000ed0: 6465 6e74 6974 7928 6974 656d 290d 0a20  dentity(item).. 
+00000ee0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00000ef0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00000f00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00000f10: 2020 2070 7269 6e74 2865 290d 0a0d 0a20     print(e).... 
+00000f20: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00000f30: 696f 6e20 6173 2065 3a0d 0a20 2020 2020  ion as e:..     
+00000f40: 2020 2070 7269 6e74 2865 290d 0a0d 0a0d     print(e).....
+00000f50: 0a76 6572 7369 6f6e 203d 2074 662e 7665  .version = tf.ve
+00000f60: 7273 696f 6e0d 0a73 7973 2e73 7464 6f75  rsion..sys.stdou
+00000f70: 742e 7772 6974 6528 2754 656e 736f 7266  t.write('Tensorf
+00000f80: 6c6f 7720 7665 7273 696f 6e3a 7b30 7d2e  low version:{0}.
+00000f90: 5c6e 272e 666f 726d 6174 2876 6572 7369  \n'.format(versi
+00000fa0: 6f6e 2e56 4552 5349 4f4e 2929 0d0a 0d0a  on.VERSION))....
+00000fb0: 7466 5f76 6572 7369 6f6e 203d 204c 6f6f  tf_version = Loo
+00000fc0: 7365 5665 7273 696f 6e28 7673 7472 696e  seVersion(vstrin
+00000fd0: 673d 7665 7273 696f 6e2e 5645 5253 494f  g=version.VERSIO
+00000fe0: 4e29 0d0a 6261 7365 5f76 6572 7369 6f6e  N)..base_version
+00000ff0: 203d 204c 6f6f 7365 5665 7273 696f 6e28   = LooseVersion(
+00001000: 7673 7472 696e 673d 2732 2e32 2e30 2d72  vstring='2.2.0-r
+00001010: 6330 2729 0d0a 0d0a 6966 2074 665f 7665  c0')....if tf_ve
+00001020: 7273 696f 6e2e 7665 7273 696f 6e20 3c20  rsion.version < 
+00001030: 6261 7365 5f76 6572 7369 6f6e 2e76 6572  base_version.ver
+00001040: 7369 6f6e 3a0d 0a20 2020 2072 6169 7365  sion:..    raise
+00001050: 2056 616c 7565 4572 726f 7228 2774 7269   ValueError('tri
+00001060: 6465 6e74 206f 6e6c 7920 7375 7070 6f72  dent only suppor
+00001070: 7420 5465 6e73 6f72 666c 6f77 2032 2e32  t Tensorflow 2.2
+00001080: 2e30 2d72 6330 206f 7220 6e65 7765 722e  .0-rc0 or newer.
+00001090: 5c6e 2729 0d0a 0d0a 7472 793a 0d0a 0d0a  \n')....try:....
+000010a0: 2020 2020 7466 2e65 7865 6375 7469 6e67      tf.executing
+000010b0: 5f65 6167 6572 6c79 2829 0d0a 2020 2020  _eagerly()..    
+000010c0: 7379 732e 7374 646f 7574 2e77 7269 7465  sys.stdout.write
+000010d0: 2827 6578 6563 7574 696e 675f 6561 6765  ('executing_eage
+000010e0: 726c 795c 6e27 290d 0a65 7863 6570 7420  rly\n')..except 
+000010f0: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
+00001100: 0a20 2020 2073 7973 2e73 7464 6f75 742e  .    sys.stdout.
+00001110: 7772 6974 6528 2765 7865 6375 7469 6e67  write('executing
+00001120: 5f65 6167 6572 6c79 2066 6169 6c2e 207b  _eagerly fail. {
+00001130: 307d 5c6e 272e 666f 726d 6174 2865 2929  0}\n'.format(e))
+00001140: 0d0a 0d0a 7379 732e 7374 646f 7574 2e77  ....sys.stdout.w
+00001150: 7269 7465 2827 7573 6520 6465 7669 6365  rite('use device
+00001160: 3a7b 307d 2e5c 6e27 2e66 6f72 6d61 7428  :{0}.\n'.format(
+00001170: 6765 745f 6465 7669 6365 2829 2929 0d0a  get_device()))..
+00001180: 0d0a 0d0a 6465 6620 6c6f 6164 2870 6174  ....def load(pat
+00001190: 6829 3a0d 0a20 2020 2022 2222 6c6f 6164  h):..    """load
+000011a0: 206d 6f64 656c 2066 726f 6d20 2a2e 7074   model from *.pt
+000011b0: 6820 6f72 202a 2e70 7468 2e74 6172 0d0a  h or *.pth.tar..
+000011c0: 0d0a 2020 2020 4172 6773 3a0d 0a20 2020  ..    Args:..   
+000011d0: 2020 2020 2070 6174 6820 2873 7472 293a       path (str):
+000011e0: 0d0a 0d0a 2020 2020 5265 7475 726e 733a  ....    Returns:
+000011f0: 0d0a 0d0a 2020 2020 2222 220d 0a20 2020  ....    """..   
+00001200: 2077 6974 6820 7466 2e64 6576 6963 6528   with tf.device(
+00001210: 6765 745f 6465 7669 6365 2829 293a 0d0a  get_device()):..
+00001220: 2020 2020 2020 2020 6966 2027 2e74 6172          if '.tar
+00001230: 2720 696e 2070 6174 683a 0d0a 2020 2020  ' in path:..    
+00001240: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001250: 6572 6961 6c69 7a61 7469 6f6e 2e6c 6f61  erialization.loa
+00001260: 645f 7074 6874 6172 2870 6174 6829 0d0a  d_pthtar(path)..
+00001270: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00001280: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00001290: 6e20 7365 7269 616c 697a 6174 696f 6e2e  n serialization.
+000012a0: 6c6f 6164 2870 6174 6829 0d0a 0d0a 0d0a  load(path)......
+000012b0: 6465 6620 7361 7665 286f 626a 2c20 7061  def save(obj, pa
+000012c0: 7468 2c20 6973 5f63 6f6d 7072 6573 7365  th, is_compresse
+000012d0: 643d 4661 6c73 6529 3a0d 0a20 2020 2073  d=False):..    s
+000012e0: 6572 6961 6c69 7a61 7469 6f6e 2e73 6176  erialization.sav
+000012f0: 6528 6f62 6a2c 2070 6174 682c 2069 735f  e(obj, path, is_
+00001300: 636f 6d70 7265 7373 6564 3d69 735f 636f  compressed=is_co
+00001310: 6d70 7265 7373 6564 290d 0a20 2020 2072  mpressed)..    r
+00001320: 6574 7572 6e20 5472 7565 0d0a 0d0a 0d0a  eturn True......
+00001330: 636c 6173 7320 5265 6d6f 7661 626c 6548  class RemovableH
+00001340: 616e 646c 6528 6f62 6a65 6374 293a 0d0a  andle(object):..
+00001350: 2020 2020 7222 2222 0d0a 2020 2020 4120      r"""..    A 
+00001360: 6861 6e64 6c65 2077 6869 6368 2070 726f  handle which pro
+00001370: 7669 6465 7320 7468 6520 6361 7061 6269  vides the capabi
+00001380: 6c69 7479 2074 6f20 7265 6d6f 7665 2061  lity to remove a
+00001390: 2068 6f6f 6b2e 0d0a 0d0a 2020 2020 4172   hook.....    Ar
+000013a0: 6773 3a0d 0a20 2020 2020 2020 2068 6f6f  gs:..        hoo
+000013b0: 6b73 5f64 6963 7420 2864 6963 7429 3a20  ks_dict (dict): 
+000013c0: 4120 6469 6374 696f 6e61 7279 206f 6620  A dictionary of 
+000013d0: 686f 6f6b 732c 2069 6e64 6578 6564 2062  hooks, indexed b
+000013e0: 7920 686f 6f6b 2060 6069 6460 602e 0d0a  y hook ``id``...
+000013f0: 2020 2020 2020 2020 6578 7472 615f 6469          extra_di
+00001400: 6374 2028 6469 6374 293a 2041 6e20 6164  ct (dict): An ad
+00001410: 6469 7469 6f6e 616c 2064 6963 7469 6f6e  ditional diction
+00001420: 6172 7920 7768 6f73 6520 6b65 7973 2077  ary whose keys w
+00001430: 696c 6c20 6265 2064 656c 6574 6564 0d0a  ill be deleted..
+00001440: 2020 2020 2020 2020 2020 2020 7768 656e              when
+00001450: 2074 6865 2073 616d 6520 6b65 7973 2061   the same keys a
+00001460: 7265 2072 656d 6f76 6564 2066 726f 6d20  re removed from 
+00001470: 6060 686f 6f6b 735f 6469 6374 6060 2e0d  ``hooks_dict``..
+00001480: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+00001490: 6964 3a20 696e 740d 0a20 2020 206e 6578  id: int..    nex
+000014a0: 745f 6964 3a20 696e 7420 3d20 300d 0a0d  t_id: int = 0...
+000014b0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+000014c0: 5f28 7365 6c66 2c20 686f 6f6b 735f 6469  _(self, hooks_di
+000014d0: 6374 3a20 416e 792c 202a 2c20 6578 7472  ct: Any, *, extr
+000014e0: 615f 6469 6374 3a20 416e 7920 3d20 4e6f  a_dict: Any = No
+000014f0: 6e65 2920 2d3e 204e 6f6e 653a 0d0a 2020  ne) -> None:..  
+00001500: 2020 2020 2020 7365 6c66 2e68 6f6f 6b73        self.hooks
+00001510: 5f64 6963 745f 7265 6620 3d20 7765 616b  _dict_ref = weak
+00001520: 7265 662e 7265 6628 686f 6f6b 735f 6469  ref.ref(hooks_di
+00001530: 6374 290d 0a20 2020 2020 2020 2073 656c  ct)..        sel
+00001540: 662e 6964 203d 2052 656d 6f76 6162 6c65  f.id = Removable
+00001550: 4861 6e64 6c65 2e6e 6578 745f 6964 0d0a  Handle.next_id..
+00001560: 2020 2020 2020 2020 5265 6d6f 7661 626c          Removabl
+00001570: 6548 616e 646c 652e 6e65 7874 5f69 6420  eHandle.next_id 
+00001580: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+00001590: 7365 6c66 2e65 7874 7261 5f64 6963 745f  self.extra_dict_
+000015a0: 7265 6620 3d20 280d 0a20 2020 2020 2020  ref = (..       
+000015b0: 2020 2020 2077 6561 6b72 6566 2e72 6566       weakref.ref
+000015c0: 2865 7874 7261 5f64 6963 7429 0d0a 2020  (extra_dict)..  
+000015d0: 2020 2020 2020 2020 2020 6966 2065 7874            if ext
+000015e0: 7261 5f64 6963 7420 6973 206e 6f74 204e  ra_dict is not N
+000015f0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00001600: 2065 6c73 6520 4e6f 6e65 0d0a 2020 2020   else None..    
+00001610: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
+00001620: 2072 656d 6f76 6528 7365 6c66 2920 2d3e   remove(self) ->
+00001630: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00001640: 686f 6f6b 735f 6469 6374 203d 2073 656c  hooks_dict = sel
+00001650: 662e 686f 6f6b 735f 6469 6374 5f72 6566  f.hooks_dict_ref
+00001660: 2829 0d0a 2020 2020 2020 2020 6966 2068  ()..        if h
+00001670: 6f6f 6b73 5f64 6963 7420 6973 206e 6f74  ooks_dict is not
+00001680: 204e 6f6e 6520 616e 6420 7365 6c66 2e69   None and self.i
+00001690: 6420 696e 2068 6f6f 6b73 5f64 6963 743a  d in hooks_dict:
+000016a0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+000016b0: 6c20 686f 6f6b 735f 6469 6374 5b73 656c  l hooks_dict[sel
+000016c0: 662e 6964 5d0d 0a0d 0a20 2020 2020 2020  f.id]....       
+000016d0: 2069 6620 7365 6c66 2e65 7874 7261 5f64   if self.extra_d
+000016e0: 6963 745f 7265 6620 6973 206e 6f74 204e  ict_ref is not N
+000016f0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00001700: 2020 6578 7472 615f 6469 6374 203d 2073    extra_dict = s
+00001710: 656c 662e 6578 7472 615f 6469 6374 5f72  elf.extra_dict_r
+00001720: 6566 2829 0d0a 2020 2020 2020 2020 2020  ef()..          
+00001730: 2020 6966 2065 7874 7261 5f64 6963 7420    if extra_dict 
+00001740: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00001750: 7365 6c66 2e69 6420 696e 2065 7874 7261  self.id in extra
+00001760: 5f64 6963 743a 0d0a 2020 2020 2020 2020  _dict:..        
+00001770: 2020 2020 2020 2020 6465 6c20 6578 7472          del extr
+00001780: 615f 6469 6374 5b73 656c 662e 6964 5d0d  a_dict[self.id].
+00001790: 0a0d 0a20 2020 2064 6566 205f 5f67 6574  ...    def __get
+000017a0: 7374 6174 655f 5f28 7365 6c66 293a 0d0a  state__(self):..
+000017b0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+000017c0: 0d0a 2020 2020 2020 2020 2020 2020 2873  ..            (s
+000017d0: 656c 662e 686f 6f6b 735f 6469 6374 5f72  elf.hooks_dict_r
+000017e0: 6566 2829 2c20 7365 6c66 2e69 6429 0d0a  ef(), self.id)..
+000017f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00001800: 656c 662e 6578 7472 615f 6469 6374 5f72  elf.extra_dict_r
+00001810: 6566 2069 7320 4e6f 6e65 0d0a 2020 2020  ef is None..    
+00001820: 2020 2020 2020 2020 656c 7365 2028 7365          else (se
+00001830: 6c66 2e68 6f6f 6b73 5f64 6963 745f 7265  lf.hooks_dict_re
+00001840: 6628 292c 2073 656c 662e 6964 2c20 7365  f(), self.id, se
+00001850: 6c66 2e65 7874 7261 5f64 6963 745f 7265  lf.extra_dict_re
+00001860: 6628 2929 0d0a 2020 2020 2020 2020 290d  f())..        ).
+00001870: 0a0d 0a20 2020 2064 6566 205f 5f73 6574  ...    def __set
+00001880: 7374 6174 655f 5f28 7365 6c66 2c20 7374  state__(self, st
+00001890: 6174 6529 202d 3e20 4e6f 6e65 3a0d 0a20  ate) -> None:.. 
+000018a0: 2020 2020 2020 2069 6620 7374 6174 655b         if state[
+000018b0: 305d 2069 7320 4e6f 6e65 3a0d 0a20 2020  0] is None:..   
+000018c0: 2020 2020 2020 2020 2023 2063 7265 6174           # creat
+000018d0: 6520 6120 6465 6164 2072 6566 6572 656e  e a dead referen
+000018e0: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
+000018f0: 7365 6c66 2e68 6f6f 6b73 5f64 6963 745f  self.hooks_dict_
+00001900: 7265 6620 3d20 7765 616b 7265 662e 7265  ref = weakref.re
+00001910: 6628 4f72 6465 7265 6444 6963 7428 2929  f(OrderedDict())
+00001920: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00001930: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001940: 662e 686f 6f6b 735f 6469 6374 5f72 6566  f.hooks_dict_ref
+00001950: 203d 2077 6561 6b72 6566 2e72 6566 2873   = weakref.ref(s
+00001960: 7461 7465 5b30 5d29 0d0a 2020 2020 2020  tate[0])..      
+00001970: 2020 7365 6c66 2e69 6420 3d20 7374 6174    self.id = stat
+00001980: 655b 315d 0d0a 2020 2020 2020 2020 5265  e[1]..        Re
+00001990: 6d6f 7661 626c 6548 616e 646c 652e 6e65  movableHandle.ne
+000019a0: 7874 5f69 6420 3d20 6d61 7828 5265 6d6f  xt_id = max(Remo
+000019b0: 7661 626c 6548 616e 646c 652e 6e65 7874  vableHandle.next
+000019c0: 5f69 642c 2073 656c 662e 6964 202b 2031  _id, self.id + 1
+000019d0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+000019e0: 662e 6578 7472 615f 6469 6374 5f72 6566  f.extra_dict_ref
+000019f0: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00001a00: 2020 4e6f 6e65 0d0a 2020 2020 2020 2020    None..        
+00001a10: 2020 2020 6966 206c 656e 2873 7461 7465      if len(state
+00001a20: 2920 3c20 330d 0a20 2020 2020 2020 2020  ) < 3..         
+00001a30: 2020 2065 6c73 6520 7765 616b 7265 662e     else weakref.
+00001a40: 7265 6628 4f72 6465 7265 6444 6963 7428  ref(OrderedDict(
+00001a50: 2920 6966 2073 7461 7465 5b32 5d20 6973  ) if state[2] is
+00001a60: 204e 6f6e 6520 656c 7365 2073 7461 7465   None else state
+00001a70: 5b32 5d29 0d0a 2020 2020 2020 2020 290d  [2])..        ).
+00001a80: 0a0d 0a20 2020 2064 6566 205f 5f65 6e74  ...    def __ent
+00001a90: 6572 5f5f 2873 656c 6629 202d 3e20 2252  er__(self) -> "R
+00001aa0: 656d 6f76 6162 6c65 4861 6e64 6c65 223a  emovableHandle":
+00001ab0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00001ac0: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
+00001ad0: 205f 5f65 7869 745f 5f28 7365 6c66 2c20   __exit__(self, 
+00001ae0: 7479 7065 3a20 416e 792c 2076 616c 7565  type: Any, value
+00001af0: 3a20 416e 792c 2074 623a 2041 6e79 2920  : Any, tb: Any) 
+00001b00: 2d3e 204e 6f6e 653a 0d0a 2020 2020 2020  -> None:..      
+00001b10: 2020 7365 6c66 2e72 656d 6f76 6528 290d    self.remove().
+00001b20: 0a0d 0a0d 0a64 6566 205f 6973 5f6e 6f74  .....def _is_not
+00001b30: 5f74 7261 696e 6162 6c65 5f76 6172 6961  _trainable_varia
+00001b40: 626c 6528 6f62 6a29 3a0d 0a20 2020 2072  ble(obj):..    r
+00001b50: 6574 7572 6e20 6d6f 6475 6c65 2e5f 6973  eturn module._is
+00001b60: 5f76 6172 6961 626c 6528 6f62 6a29 2061  _variable(obj) a
+00001b70: 6e64 206e 6f74 2067 6574 6174 7472 286f  nd not getattr(o
+00001b80: 626a 2c20 2274 7261 696e 6162 6c65 222c  bj, "trainable",
+00001b90: 2046 616c 7365 290d 0a0d 0a0d 0a23 2054   False)......# T
+00001ba0: 6865 2069 6e74 6572 6e61 6c20 6772 6170  he internal grap
+00001bb0: 6820 6d61 696e 7461 696e 6564 2062 7920  h maintained by 
+00001bc0: 4b65 7261 7320 616e 6420 7573 6564 2062  Keras and used b
+00001bd0: 7920 7468 6520 7379 6d62 6f6c 6963 204b  y the symbolic K
+00001be0: 6572 6173 2041 5049 730d 0a23 2077 6869  eras APIs..# whi
+00001bf0: 6c65 2065 7865 6375 7469 6e67 2065 6167  le executing eag
+00001c00: 6572 6c79 2028 7375 6368 2061 7320 7468  erly (such as th
+00001c10: 6520 6675 6e63 7469 6f6e 616c 2041 5049  e functional API
+00001c20: 2066 6f72 206d 6f64 656c 2d62 7569 6c64   for model-build
+00001c30: 696e 6729 2e0d 0a23 2054 6869 7320 6973  ing)...# This is
+00001c40: 2074 6872 6561 642d 6c6f 6361 6c20 746f   thread-local to
+00001c50: 2061 6c6c 6f77 2062 7569 6c64 696e 6720   allow building 
+00001c60: 7365 7061 7261 7465 206d 6f64 656c 7320  separate models 
+00001c70: 696e 2064 6966 6665 7265 6e74 2074 6872  in different thr
+00001c80: 6561 6473 0d0a 2320 636f 6e63 7572 7265  eads..# concurre
+00001c90: 6e74 6c79 2c20 6275 7420 636f 6d65 7320  ntly, but comes 
+00001ca0: 6174 2074 6865 2063 6f73 7420 6f66 206e  at the cost of n
+00001cb0: 6f74 2062 6569 6e67 2061 626c 6520 746f  ot being able to
+00001cc0: 2062 7569 6c64 206f 6e65 206d 6f64 656c   build one model
+00001cd0: 0d0a 2320 6163 726f 7373 2074 6872 6561  ..# across threa
+00001ce0: 6473 2e0d 0a0d 0a0d 0a23 2041 2067 6c6f  ds.......# A glo
+00001cf0: 6261 6c20 6469 6374 696f 6e61 7279 206d  bal dictionary m
+00001d00: 6170 7069 6e67 2067 7261 7068 206f 626a  apping graph obj
+00001d10: 6563 7473 2074 6f20 616e 2069 6e64 6578  ects to an index
+00001d20: 206f 6620 636f 756e 7465 7273 2075 7365   of counters use
+00001d30: 640d 0a23 2066 6f72 2076 6172 696f 7573  d..# for various
+00001d40: 206c 6179 6572 2f6f 7074 696d 697a 6572   layer/optimizer
+00001d50: 206e 616d 6573 2069 6e20 6561 6368 2067   names in each g
+00001d60: 7261 7068 2e0d 0a23 2041 6c6c 6f77 7320  raph...# Allows 
+00001d70: 746f 2067 6976 6520 756e 6971 7565 2061  to give unique a
+00001d80: 7574 6f67 656e 6572 6174 6564 206e 616d  utogenerated nam
+00001d90: 6573 2074 6f20 6c61 7965 7273 2c20 696e  es to layers, in
+00001da0: 2061 2067 7261 7068 2d73 7065 6369 6669   a graph-specifi
+00001db0: 6320 7761 792e 0d0a 5045 525f 4752 4150  c way...PER_GRAP
+00001dc0: 485f 4f42 4a45 4354 5f4e 414d 455f 5549  H_OBJECT_NAME_UI
+00001dd0: 4453 203d 2077 6561 6b72 6566 2e57 6561  DS = weakref.Wea
+00001de0: 6b4b 6579 4469 6374 696f 6e61 7279 2829  kKeyDictionary()
+00001df0: 0d0a 0d0a 0d0a 6465 6620 7265 7365 745f  ......def reset_
+00001e00: 6e61 6d65 286d 6f64 756c 653a 2074 662e  name(module: tf.
+00001e10: 4d6f 6475 6c65 2c20 7072 6566 6978 5f64  Module, prefix_d
+00001e20: 6963 743d 4e6f 6e65 293a 0d0a 2020 2020  ict=None):..    
+00001e30: 6465 6620 6765 745f 7569 6428 7072 6566  def get_uid(pref
+00001e40: 6978 2c20 7365 7129 3a0d 0a20 2020 2020  ix, seq):..     
+00001e50: 2020 2069 6620 7072 6566 6978 206e 6f74     if prefix not
+00001e60: 2069 6e20 6d6f 6475 6c65 2e5f 7569 645f   in module._uid_
+00001e70: 7072 6566 6978 7320 6f72 2073 6571 203c  prefixs or seq <
+00001e80: 206d 6f64 756c 652e 5f75 6964 5f70 7265   module._uid_pre
+00001e90: 6669 7873 5b70 7265 6669 785d 3a0d 0a20  fixs[prefix]:.. 
+00001ea0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+00001eb0: 652e 5f75 6964 5f70 7265 6669 7873 5b70  e._uid_prefixs[p
+00001ec0: 7265 6669 785d 203d 2073 6571 0d0a 2020  refix] = seq..  
+00001ed0: 2020 2020 2020 7265 7475 726e 206d 6f64        return mod
+00001ee0: 756c 652e 5f75 6964 5f70 7265 6669 7873  ule._uid_prefixs
+00001ef0: 5b70 7265 6669 785d 0d0a 0d0a 2020 2020  [prefix]....    
+00001f00: 6966 206e 6f74 2068 6173 6174 7472 286d  if not hasattr(m
+00001f10: 6f64 756c 652c 2027 5f75 6964 5f70 7265  odule, '_uid_pre
+00001f20: 6669 7873 2729 206f 7220 7072 6566 6978  fixs') or prefix
+00001f30: 5f64 6963 7420 6973 206e 6f74 204e 6f6e  _dict is not Non
+00001f40: 653a 0d0a 2020 2020 2020 2020 6d6f 6475  e:..        modu
+00001f50: 6c65 2e5f 7569 645f 7072 6566 6978 7320  le._uid_prefixs 
+00001f60: 3d20 7072 6566 6978 5f64 6963 740d 0a20  = prefix_dict.. 
+00001f70: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00001f80: 7228 6d6f 6475 6c65 2c20 2764 6566 6175  r(module, 'defau
+00001f90: 6c74 5f6e 616d 6527 293a 0d0a 2020 2020  lt_name'):..    
+00001fa0: 2020 2020 6d6f 6475 6c65 2e64 6566 6175      module.defau
+00001fb0: 6c74 5f6e 616d 6520 3d20 6361 6d65 6c32  lt_name = camel2
+00001fc0: 736e 616b 6528 6d6f 6475 6c65 2e5f 5f63  snake(module.__c
+00001fd0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f29  lass__.__name__)
+00001fe0: 202b 2027 5f27 202b 2073 7472 280d 0a20   + '_' + str(.. 
+00001ff0: 2020 2020 2020 2020 2020 2067 6574 5f67             get_g
+00002000: 6c6f 6261 6c5f 7569 6428 6361 6d65 6c32  lobal_uid(camel2
+00002010: 736e 616b 6528 6d6f 6475 6c65 2e5f 5f63  snake(module.__c
+00002020: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f29  lass__.__name__)
+00002030: 2929 0d0a 2020 2020 7072 6566 6978 2c20  ))..    prefix, 
+00002040: 7365 7120 3d20 6d6f 6475 6c65 2e64 6566  seq = module.def
+00002050: 6175 6c74 5f6e 616d 652e 7273 706c 6974  ault_name.rsplit
+00002060: 2827 5f27 2c20 3129 2020 2320 6966 2027  ('_', 1)  # if '
+00002070: 5f27 2069 6e20 6d6f 6475 6c65 2e64 6566  _' in module.def
+00002080: 6175 6c74 5f6e 616d 6520 656c 7365 0d0a  ault_name else..
+00002090: 2020 2020 7365 7120 3d20 696e 7428 7365      seq = int(se
+000020a0: 7129 0d0a 2020 2020 6d6f 6475 6c65 2e64  q)..    module.d
+000020b0: 6566 6175 6c74 5f6e 616d 6520 3d20 7072  efault_name = pr
+000020c0: 6566 6978 202b 2027 5f27 202b 2073 7472  efix + '_' + str
+000020d0: 2873 6571 202d 2067 6574 5f75 6964 2870  (seq - get_uid(p
+000020e0: 7265 6669 782c 2073 6571 2920 2b20 3129  refix, seq) + 1)
+000020f0: 0d0a 2020 2020 6966 206d 6f64 756c 652e  ..    if module.
+00002100: 5f6e 616d 6520 6973 204e 6f6e 653a 0d0a  _name is None:..
+00002110: 2020 2020 2020 2020 6d6f 6475 6c65 2e5f          module._
+00002120: 6e61 6d65 203d 206d 6f64 756c 652e 6465  name = module.de
+00002130: 6661 756c 745f 6e61 6d65 0d0a 2020 2020  fault_name..    
+00002140: 6d6f 6475 6c65 2e5f 5f6e 616d 655f 5f20  module.__name__ 
+00002150: 3d20 6d6f 6475 6c65 2e5f 6e61 6d65 0d0a  = module._name..
+00002160: 2020 2020 6d6f 6475 6c65 2e75 7064 6174      module.updat
+00002170: 655f 6e61 6d65 5f73 636f 7065 286d 6f64  e_name_scope(mod
+00002180: 756c 652e 5f6e 616d 6529 0d0a 0d0a 0d0a  ule._name)......
+00002190: 5f55 4944 5f50 5245 4649 5820 3d20 6465  _UID_PREFIX = de
+000021a0: 6661 756c 7464 6963 7428 696e 7429 0d0a  faultdict(int)..
+000021b0: 0d0a 0d0a 6465 6620 6765 745f 676c 6f62  ....def get_glob
+000021c0: 616c 5f75 6964 2870 7265 6669 783d 2727  al_uid(prefix=''
+000021d0: 293a 0d0a 2020 2020 5f55 4944 5f50 5245  ):..    _UID_PRE
+000021e0: 4649 585b 7072 6566 6978 5d20 2b3d 2031  FIX[prefix] += 1
+000021f0: 0d0a 2020 2020 7265 7475 726e 205f 5549  ..    return _UI
+00002200: 445f 5052 4546 4958 5b70 7265 6669 785d  D_PREFIX[prefix]
+00002210: 0d0a 0d0a 0d0a 636c 6173 7320 5f49 6e63  ......class _Inc
+00002220: 6f6d 7061 7469 626c 654b 6579 7328 6e61  ompatibleKeys(na
+00002230: 6d65 6474 7570 6c65 2827 496e 636f 6d70  medtuple('Incomp
+00002240: 6174 6962 6c65 4b65 7973 272c 205b 276d  atibleKeys', ['m
+00002250: 6973 7369 6e67 5f6b 6579 7327 2c20 2775  issing_keys', 'u
+00002260: 6e65 7870 6563 7465 645f 6b65 7973 275d  nexpected_keys']
+00002270: 2929 3a0d 0a20 2020 2064 6566 205f 5f72  )):..    def __r
+00002280: 6570 725f 5f28 7365 6c66 293a 0d0a 2020  epr__(self):..  
+00002290: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+000022a0: 662e 6d69 7373 696e 675f 6b65 7973 2061  f.missing_keys a
+000022b0: 6e64 206e 6f74 2073 656c 662e 756e 6578  nd not self.unex
+000022c0: 7065 6374 6564 5f6b 6579 733a 0d0a 2020  pected_keys:..  
+000022d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000022e0: 2027 3c41 6c6c 206b 6579 7320 6d61 7463   '<All keys matc
+000022f0: 6865 6420 7375 6363 6573 7366 756c 6c79  hed successfully
+00002300: 3e27 0d0a 2020 2020 2020 2020 7265 7475  >'..        retu
+00002310: 726e 2073 7570 6572 285f 496e 636f 6d70  rn super(_Incomp
+00002320: 6174 6962 6c65 4b65 7973 2c20 7365 6c66  atibleKeys, self
+00002330: 292e 5f5f 7265 7072 5f5f 2829 0d0a 0d0a  ).__repr__()....
+00002340: 2020 2020 5f5f 7374 725f 5f20 3d20 5f5f      __str__ = __
+00002350: 7265 7072 5f5f 0d0a 0d0a 0d0a 6465 6620  repr__......def 
+00002360: 5f61 6464 696e 6465 6e74 2873 5f2c 206e  _addindent(s_, n
+00002370: 756d 5370 6163 6573 293a 0d0a 2020 2020  umSpaces):..    
+00002380: 7320 3d20 735f 2e73 706c 6974 2827 5c6e  s = s_.split('\n
+00002390: 2729 0d0a 2020 2020 2320 646f 6e27 7420  ')..    # don't 
+000023a0: 646f 2061 6e79 7468 696e 6720 666f 7220  do anything for 
+000023b0: 7369 6e67 6c65 2d6c 696e 6520 7374 7566  single-line stuf
+000023c0: 660d 0a20 2020 2069 6620 6c65 6e28 7329  f..    if len(s)
+000023d0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+000023e0: 7265 7475 726e 2073 5f0d 0a20 2020 2066  return s_..    f
+000023f0: 6972 7374 203d 2073 2e70 6f70 2830 290d  irst = s.pop(0).
+00002400: 0a20 2020 2073 203d 205b 286e 756d 5370  .    s = [(numSp
+00002410: 6163 6573 202a 2027 2027 2920 2b20 6c69  aces * ' ') + li
+00002420: 6e65 2066 6f72 206c 696e 6520 696e 2073  ne for line in s
+00002430: 5d0d 0a20 2020 2073 203d 2027 5c6e 272e  ]..    s = '\n'.
+00002440: 6a6f 696e 2873 290d 0a20 2020 2073 203d  join(s)..    s =
+00002450: 2066 6972 7374 202b 2027 5c6e 2720 2b20   first + '\n' + 
+00002460: 730d 0a20 2020 2072 6574 7572 6e20 730d  s..    return s.
+00002470: 0a0d 0a0d 0a72 2222 2254 6869 7320 7472  .....r"""This tr
+00002480: 6163 6b73 2068 6f6f 6b73 2063 6f6d 6d6f  acks hooks commo
+00002490: 6e20 746f 2061 6c6c 206d 6f64 756c 6573  n to all modules
+000024a0: 2074 6861 7420 6172 6520 6578 6563 7574   that are execut
+000024b0: 6564 2062 6566 6f72 652f 6166 7465 720d  ed before/after.
+000024c0: 0a63 616c 6c69 6e67 2066 6f72 7761 7264  .calling forward
+000024d0: 2061 6e64 2062 6163 6b77 6172 642e 2054   and backward. T
+000024e0: 6869 7320 6973 2067 6c6f 6261 6c20 7374  his is global st
+000024f0: 6174 6520 7573 6564 2066 6f72 2064 6562  ate used for deb
+00002500: 7567 6769 6e67 2f70 726f 6669 6c69 6e67  ugging/profiling
+00002510: 0d0a 7075 7270 6f73 6573 2222 220d 0a5f  ..purposes""".._
+00002520: 676c 6f62 616c 5f62 6163 6b77 6172 645f  global_backward_
+00002530: 686f 6f6b 7320 3d20 4f72 6465 7265 6444  hooks = OrderedD
+00002540: 6963 7428 290d 0a5f 676c 6f62 616c 5f66  ict().._global_f
+00002550: 6f72 7761 7264 5f70 7265 5f68 6f6f 6b73  orward_pre_hooks
+00002560: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
+00002570: 0d0a 5f67 6c6f 6261 6c5f 666f 7277 6172  .._global_forwar
+00002580: 645f 686f 6f6b 7320 3d20 4f72 6465 7265  d_hooks = Ordere
+00002590: 6444 6963 7428 290d 0a0d 0a5f 676c 6f62  dDict()...._glob
+000025a0: 616c 5f62 6163 6b77 6172 645f 7072 655f  al_backward_pre_
+000025b0: 686f 6f6b 733a 2044 6963 745b 696e 742c  hooks: Dict[int,
+000025c0: 2043 616c 6c61 626c 655d 203d 204f 7264   Callable] = Ord
+000025d0: 6572 6564 4469 6374 2829 0d0a 5f67 6c6f  eredDict().._glo
+000025e0: 6261 6c5f 6973 5f66 756c 6c5f 6261 636b  bal_is_full_back
+000025f0: 7761 7264 5f68 6f6f 6b3a 204f 7074 696f  ward_hook: Optio
+00002600: 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65  nal[bool] = None
+00002610: 0d0a 0d0a 5f67 7261 645f 7420 3d20 556e  ...._grad_t = Un
+00002620: 696f 6e5b 5475 706c 655b 5465 6e73 6f72  ion[Tuple[Tensor
+00002630: 2c20 2e2e 2e5d 2c20 5465 6e73 6f72 5d0d  , ...], Tensor].
+00002640: 0a23 2053 6565 2068 7474 7073 3a2f 2f6d  .# See https://m
+00002650: 7970 792e 7265 6164 7468 6564 6f63 732e  ypy.readthedocs.
+00002660: 696f 2f65 6e2f 6c61 7465 7374 2f67 656e  io/en/latest/gen
+00002670: 6572 6963 732e 6874 6d6c 2367 656e 6572  erics.html#gener
+00002680: 6963 2d6d 6574 686f 6473 2d61 6e64 2d67  ic-methods-and-g
+00002690: 656e 6572 6963 2d73 656c 6620 666f 7220  eneric-self for 
+000026a0: 7468 6520 7573 650d 0a23 206f 6620 6054  the use..# of `T
+000026b0: 6020 746f 2061 6e6e 6f74 6174 6520 6073  ` to annotate `s
+000026c0: 656c 6660 2e20 4d61 6e79 206d 6574 686f  elf`. Many metho
+000026d0: 6473 206f 6620 604d 6f64 756c 6560 2072  ds of `Module` r
+000026e0: 6574 7572 6e20 6073 656c 6660 2061 6e64  eturn `self` and
+000026f0: 2077 6520 7761 6e74 2074 686f 7365 2072   we want those r
+00002700: 6574 7572 6e20 7661 6c75 6573 2074 6f20  eturn values to 
+00002710: 6265 0d0a 2320 7468 6520 7479 7065 206f  be..# the type o
+00002720: 6620 7468 6520 7375 6263 6c61 7373 2c20  f the subclass, 
+00002730: 6e6f 7420 7468 6520 6c6f 6f73 6572 2074  not the looser t
+00002740: 7970 6520 6f66 2060 4d6f 6475 6c65 602e  ype of `Module`.
+00002750: 0d0a 5420 3d20 5479 7065 5661 7228 2754  ..T = TypeVar('T
+00002760: 272c 2062 6f75 6e64 3d27 4c61 7965 7227  ', bound='Layer'
+00002770: 290d 0a0d 0a5f 4558 5452 415f 5354 4154  )...._EXTRA_STAT
+00002780: 455f 4b45 595f 5355 4646 4958 203d 2027  E_KEY_SUFFIX = '
+00002790: 5f65 7874 7261 5f73 7461 7465 270d 0a0d  _extra_state'...
+000027a0: 0a0d 0a64 6566 2072 6567 6973 7465 725f  ...def register_
+000027b0: 6d6f 6475 6c65 5f62 7566 6665 725f 7265  module_buffer_re
+000027c0: 6769 7374 7261 7469 6f6e 5f68 6f6f 6b28  gistration_hook(
+000027d0: 686f 6f6b 3a20 4361 6c6c 6162 6c65 5b2e  hook: Callable[.
+000027e0: 2e2e 2c20 4e6f 6e65 5d29 202d 3e20 5265  .., None]) -> Re
+000027f0: 6d6f 7661 626c 6548 616e 646c 653a 0d0a  movableHandle:..
+00002800: 2020 2020 7222 2222 5265 6769 7374 6572      r"""Register
+00002810: 7320 6120 6275 6666 6572 2072 6567 6973  s a buffer regis
+00002820: 7472 6174 696f 6e20 686f 6f6b 2063 6f6d  tration hook com
+00002830: 6d6f 6e20 746f 2061 6c6c 206d 6f64 756c  mon to all modul
+00002840: 6573 2e0d 0a0d 0a20 2020 202e 2e20 7761  es.....    .. wa
+00002850: 726e 696e 6720 3a3a 0d0a 0d0a 2020 2020  rning ::....    
+00002860: 2020 2020 5468 6973 2061 6464 7320 676c      This adds gl
+00002870: 6f62 616c 2073 7461 7465 2074 6f20 7468  obal state to th
+00002880: 6520 606e 6e2e 4d6f 6475 6c65 6020 6d6f  e `nn.Module` mo
+00002890: 6475 6c65 0d0a 0d0a 2020 2020 5468 6520  dule....    The 
+000028a0: 686f 6f6b 2077 696c 6c20 6265 2063 616c  hook will be cal
+000028b0: 6c65 6420 6576 6572 7920 7469 6d65 203a  led every time :
+000028c0: 6675 6e63 3a60 7265 6769 7374 6572 5f62  func:`register_b
+000028d0: 7566 6665 7260 2069 7320 696e 766f 6b65  uffer` is invoke
+000028e0: 642e 0d0a 2020 2020 4974 2073 686f 756c  d...    It shoul
+000028f0: 6420 6861 7665 2074 6865 2066 6f6c 6c6f  d have the follo
+00002900: 7769 6e67 2073 6967 6e61 7475 7265 3a3a  wing signature::
+00002910: 0d0a 0d0a 2020 2020 2020 2020 686f 6f6b  ....        hook
+00002920: 286d 6f64 756c 652c 206e 616d 652c 2062  (module, name, b
+00002930: 7566 6665 7229 202d 3e20 4e6f 6e65 206f  uffer) -> None o
+00002940: 7220 6e65 7720 6275 6666 6572 0d0a 0d0a  r new buffer....
+00002950: 2020 2020 5468 6520 686f 6f6b 2063 616e      The hook can
+00002960: 206d 6f64 6966 7920 7468 6520 696e 7075   modify the inpu
+00002970: 7420 6f72 2072 6574 7572 6e20 6120 7369  t or return a si
+00002980: 6e67 6c65 206d 6f64 6966 6965 6420 7661  ngle modified va
+00002990: 6c75 6520 696e 2074 6865 2068 6f6f 6b2e  lue in the hook.
+000029a0: 0d0a 0d0a 2020 2020 5265 7475 726e 733a  ....    Returns:
+000029b0: 0d0a 2020 2020 2020 2020 3a63 6c61 7373  ..        :class
+000029c0: 3a60 746f 7263 682e 7574 696c 732e 686f  :`torch.utils.ho
+000029d0: 6f6b 732e 5265 6d6f 7661 626c 6548 616e  oks.RemovableHan
+000029e0: 646c 6560 3a0d 0a20 2020 2020 2020 2020  dle`:..         
+000029f0: 2020 2061 2068 616e 646c 6520 7468 6174     a handle that
+00002a00: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
+00002a10: 7265 6d6f 7665 2074 6865 2061 6464 6564  remove the added
+00002a20: 2068 6f6f 6b20 6279 2063 616c 6c69 6e67   hook by calling
+00002a30: 0d0a 2020 2020 2020 2020 2020 2020 6060  ..            ``
+00002a40: 6861 6e64 6c65 2e72 656d 6f76 6528 2960  handle.remove()`
+00002a50: 600d 0a20 2020 2022 2222 0d0a 2020 2020  `..    """..    
+00002a60: 6861 6e64 6c65 203d 2052 656d 6f76 6162  handle = Removab
+00002a70: 6c65 4861 6e64 6c65 285f 676c 6f62 616c  leHandle(_global
+00002a80: 5f62 7566 6665 725f 7265 6769 7374 7261  _buffer_registra
+00002a90: 7469 6f6e 5f68 6f6f 6b73 290d 0a20 2020  tion_hooks)..   
+00002aa0: 205f 676c 6f62 616c 5f62 7566 6665 725f   _global_buffer_
+00002ab0: 7265 6769 7374 7261 7469 6f6e 5f68 6f6f  registration_hoo
+00002ac0: 6b73 5b68 616e 646c 652e 6964 5d20 3d20  ks[handle.id] = 
+00002ad0: 686f 6f6b 0d0a 2020 2020 7265 7475 726e  hook..    return
+00002ae0: 2068 616e 646c 650d 0a0d 0a0d 0a64 6566   handle......def
+00002af0: 2072 6567 6973 7465 725f 6d6f 6475 6c65   register_module
+00002b00: 5f6d 6f64 756c 655f 7265 6769 7374 7261  _module_registra
+00002b10: 7469 6f6e 5f68 6f6f 6b28 686f 6f6b 3a20  tion_hook(hook: 
+00002b20: 4361 6c6c 6162 6c65 5b2e 2e2e 2c20 4e6f  Callable[..., No
+00002b30: 6e65 5d29 202d 3e20 5265 6d6f 7661 626c  ne]) -> Removabl
+00002b40: 6548 616e 646c 653a 0d0a 2020 2020 7222  eHandle:..    r"
+00002b50: 2222 5265 6769 7374 6572 7320 6120 6d6f  ""Registers a mo
+00002b60: 6475 6c65 2072 6567 6973 7472 6174 696f  dule registratio
+00002b70: 6e20 686f 6f6b 2063 6f6d 6d6f 6e20 746f  n hook common to
+00002b80: 2061 6c6c 206d 6f64 756c 6573 2e0d 0a0d   all modules....
+00002b90: 0a20 2020 202e 2e20 7761 726e 696e 6720  .    .. warning 
+00002ba0: 3a3a 0d0a 0d0a 2020 2020 2020 2020 5468  ::....        Th
+00002bb0: 6973 2061 6464 7320 676c 6f62 616c 2073  is adds global s
+00002bc0: 7461 7465 2074 6f20 7468 6520 606e 6e2e  tate to the `nn.
+00002bd0: 4d6f 6475 6c65 6020 6d6f 6475 6c65 0d0a  Module` module..
+00002be0: 0d0a 2020 2020 5468 6520 686f 6f6b 2077  ..    The hook w
+00002bf0: 696c 6c20 6265 2063 616c 6c65 6420 6576  ill be called ev
+00002c00: 6572 7920 7469 6d65 203a 6675 6e63 3a60  ery time :func:`
+00002c10: 7265 6769 7374 6572 5f6d 6f64 756c 6560  register_module`
+00002c20: 2069 7320 696e 766f 6b65 642e 0d0a 2020   is invoked...  
+00002c30: 2020 4974 2073 686f 756c 6420 6861 7665    It should have
+00002c40: 2074 6865 2066 6f6c 6c6f 7769 6e67 2073   the following s
+00002c50: 6967 6e61 7475 7265 3a3a 0d0a 0d0a 2020  ignature::....  
+00002c60: 2020 2020 2020 686f 6f6b 286d 6f64 756c        hook(modul
+00002c70: 652c 206e 616d 652c 2073 7562 6d6f 6475  e, name, submodu
+00002c80: 6c65 2920 2d3e 204e 6f6e 6520 6f72 206e  le) -> None or n
+00002c90: 6577 2073 7562 6d6f 6475 6c65 0d0a 0d0a  ew submodule....
+00002ca0: 2020 2020 5468 6520 686f 6f6b 2063 616e      The hook can
+00002cb0: 206d 6f64 6966 7920 7468 6520 696e 7075   modify the inpu
+00002cc0: 7420 6f72 2072 6574 7572 6e20 6120 7369  t or return a si
+00002cd0: 6e67 6c65 206d 6f64 6966 6965 6420 7661  ngle modified va
+00002ce0: 6c75 6520 696e 2074 6865 2068 6f6f 6b2e  lue in the hook.
+00002cf0: 0d0a 0d0a 2020 2020 5265 7475 726e 733a  ....    Returns:
+00002d00: 0d0a 2020 2020 2020 2020 3a63 6c61 7373  ..        :class
+00002d10: 3a60 746f 7263 682e 7574 696c 732e 686f  :`torch.utils.ho
+00002d20: 6f6b 732e 5265 6d6f 7661 626c 6548 616e  oks.RemovableHan
+00002d30: 646c 6560 3a0d 0a20 2020 2020 2020 2020  dle`:..         
+00002d40: 2020 2061 2068 616e 646c 6520 7468 6174     a handle that
+00002d50: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
+00002d60: 7265 6d6f 7665 2074 6865 2061 6464 6564  remove the added
+00002d70: 2068 6f6f 6b20 6279 2063 616c 6c69 6e67   hook by calling
+00002d80: 0d0a 2020 2020 2020 2020 2020 2020 6060  ..            ``
+00002d90: 6861 6e64 6c65 2e72 656d 6f76 6528 2960  handle.remove()`
+00002da0: 600d 0a20 2020 2022 2222 0d0a 2020 2020  `..    """..    
+00002db0: 6861 6e64 6c65 203d 2052 656d 6f76 6162  handle = Removab
+00002dc0: 6c65 4861 6e64 6c65 285f 676c 6f62 616c  leHandle(_global
+00002dd0: 5f6d 6f64 756c 655f 7265 6769 7374 7261  _module_registra
+00002de0: 7469 6f6e 5f68 6f6f 6b73 290d 0a20 2020  tion_hooks)..   
+00002df0: 205f 676c 6f62 616c 5f6d 6f64 756c 655f   _global_module_
+00002e00: 7265 6769 7374 7261 7469 6f6e 5f68 6f6f  registration_hoo
+00002e10: 6b73 5b68 616e 646c 652e 6964 5d20 3d20  ks[handle.id] = 
+00002e20: 686f 6f6b 0d0a 2020 2020 7265 7475 726e  hook..    return
+00002e30: 2068 616e 646c 650d 0a0d 0a0d 0a64 6566   handle......def
+00002e40: 2072 6567 6973 7465 725f 6d6f 6475 6c65   register_module
+00002e50: 5f70 6172 616d 6574 6572 5f72 6567 6973  _parameter_regis
+00002e60: 7472 6174 696f 6e5f 686f 6f6b 2868 6f6f  tration_hook(hoo
+00002e70: 6b3a 2043 616c 6c61 626c 655b 2e2e 2e2c  k: Callable[...,
+00002e80: 204e 6f6e 655d 2920 2d3e 2052 656d 6f76   None]) -> Remov
+00002e90: 6162 6c65 4861 6e64 6c65 3a0d 0a20 2020  ableHandle:..   
+00002ea0: 2072 2222 2252 6567 6973 7465 7273 2061   r"""Registers a
+00002eb0: 2070 6172 616d 6574 6572 2072 6567 6973   parameter regis
+00002ec0: 7472 6174 696f 6e20 686f 6f6b 2063 6f6d  tration hook com
+00002ed0: 6d6f 6e20 746f 2061 6c6c 206d 6f64 756c  mon to all modul
+00002ee0: 6573 2e0d 0a0d 0a20 2020 202e 2e20 7761  es.....    .. wa
+00002ef0: 726e 696e 6720 3a3a 0d0a 0d0a 2020 2020  rning ::....    
+00002f00: 2020 2020 5468 6973 2061 6464 7320 676c      This adds gl
+00002f10: 6f62 616c 2073 7461 7465 2074 6f20 7468  obal state to th
+00002f20: 6520 606e 6e2e 4d6f 6475 6c65 6020 6d6f  e `nn.Module` mo
+00002f30: 6475 6c65 0d0a 0d0a 2020 2020 5468 6520  dule....    The 
+00002f40: 686f 6f6b 2077 696c 6c20 6265 2063 616c  hook will be cal
+00002f50: 6c65 6420 6576 6572 7920 7469 6d65 203a  led every time :
+00002f60: 6675 6e63 3a60 7265 6769 7374 6572 5f70  func:`register_p
+00002f70: 6172 616d 6574 6572 6020 6973 2069 6e76  arameter` is inv
+00002f80: 6f6b 6564 2e0d 0a20 2020 2049 7420 7368  oked...    It sh
+00002f90: 6f75 6c64 2068 6176 6520 7468 6520 666f  ould have the fo
+00002fa0: 6c6c 6f77 696e 6720 7369 676e 6174 7572  llowing signatur
+00002fb0: 653a 3a0d 0a0d 0a20 2020 2020 2020 2068  e::....        h
+00002fc0: 6f6f 6b28 6d6f 6475 6c65 2c20 6e61 6d65  ook(module, name
+00002fd0: 2c20 7061 7261 6d29 202d 3e20 4e6f 6e65  , param) -> None
+00002fe0: 206f 7220 6e65 7720 7061 7261 6d65 7465   or new paramete
+00002ff0: 720d 0a0d 0a20 2020 2054 6865 2068 6f6f  r....    The hoo
+00003000: 6b20 6361 6e20 6d6f 6469 6679 2074 6865  k can modify the
+00003010: 2069 6e70 7574 206f 7220 7265 7475 726e   input or return
+00003020: 2061 2073 696e 676c 6520 6d6f 6469 6669   a single modifi
+00003030: 6564 2076 616c 7565 2069 6e20 7468 6520  ed value in the 
+00003040: 686f 6f6b 2e0d 0a0d 0a20 2020 2052 6574  hook.....    Ret
+00003050: 7572 6e73 3a0d 0a20 2020 2020 2020 203a  urns:..        :
+00003060: 636c 6173 733a 6074 6f72 6368 2e75 7469  class:`torch.uti
+00003070: 6c73 2e68 6f6f 6b73 2e52 656d 6f76 6162  ls.hooks.Removab
+00003080: 6c65 4861 6e64 6c65 603a 0d0a 2020 2020  leHandle`:..    
+00003090: 2020 2020 2020 2020 6120 6861 6e64 6c65          a handle
+000030a0: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
+000030b0: 6420 746f 2072 656d 6f76 6520 7468 6520  d to remove the 
+000030c0: 6164 6465 6420 686f 6f6b 2062 7920 6361  added hook by ca
+000030d0: 6c6c 696e 670d 0a20 2020 2020 2020 2020  lling..         
+000030e0: 2020 2060 6068 616e 646c 652e 7265 6d6f     ``handle.remo
+000030f0: 7665 2829 6060 0d0a 2020 2020 2222 220d  ve()``..    """.
+00003100: 0a20 2020 2068 616e 646c 6520 3d20 5265  .    handle = Re
+00003110: 6d6f 7661 626c 6548 616e 646c 6528 5f67  movableHandle(_g
+00003120: 6c6f 6261 6c5f 7061 7261 6d65 7465 725f  lobal_parameter_
+00003130: 7265 6769 7374 7261 7469 6f6e 5f68 6f6f  registration_hoo
+00003140: 6b73 290d 0a20 2020 205f 676c 6f62 616c  ks)..    _global
+00003150: 5f70 6172 616d 6574 6572 5f72 6567 6973  _parameter_regis
+00003160: 7472 6174 696f 6e5f 686f 6f6b 735b 6861  tration_hooks[ha
+00003170: 6e64 6c65 2e69 645d 203d 2068 6f6f 6b0d  ndle.id] = hook.
+00003180: 0a20 2020 2072 6574 7572 6e20 6861 6e64  .    return hand
+00003190: 6c65 0d0a 0d0a 0d0a 6465 6620 7265 6769  le......def regi
+000031a0: 7374 6572 5f6d 6f64 756c 655f 666f 7277  ster_module_forw
+000031b0: 6172 645f 7072 655f 686f 6f6b 2868 6f6f  ard_pre_hook(hoo
+000031c0: 6b3a 2043 616c 6c61 626c 655b 2e2e 2e2c  k: Callable[...,
+000031d0: 204e 6f6e 655d 2920 2d3e 2052 656d 6f76   None]) -> Remov
+000031e0: 6162 6c65 4861 6e64 6c65 3a0d 0a20 2020  ableHandle:..   
+000031f0: 2072 2222 2252 6567 6973 7465 7273 2061   r"""Registers a
+00003200: 2066 6f72 7761 7264 2070 7265 2d68 6f6f   forward pre-hoo
+00003210: 6b20 636f 6d6d 6f6e 2074 6f20 616c 6c20  k common to all 
+00003220: 6d6f 6475 6c65 732e 0d0a 0d0a 2020 2020  modules.....    
+00003230: 2e2e 2077 6172 6e69 6e67 203a 3a0d 0a0d  .. warning ::...
+00003240: 0a20 2020 2020 2020 2054 6869 7320 6164  .        This ad
+00003250: 6473 2067 6c6f 6261 6c20 7374 6174 6520  ds global state 
+00003260: 746f 2074 6865 2060 6e6e 2e6d 6f64 756c  to the `nn.modul
+00003270: 6560 206d 6f64 756c 650d 0a20 2020 2020  e` module..     
+00003280: 2020 2061 6e64 2069 7420 6973 206f 6e6c     and it is onl
+00003290: 7920 696e 7465 6e64 6564 2066 6f72 2064  y intended for d
+000032a0: 6562 7567 6769 6e67 2f70 726f 6669 6c69  ebugging/profili
+000032b0: 6e67 2070 7572 706f 7365 732e 0d0a 0d0a  ng purposes.....
+000032c0: 2020 2020 5468 6520 686f 6f6b 2077 696c      The hook wil
+000032d0: 6c20 6265 2063 616c 6c65 6420 6576 6572  l be called ever
+000032e0: 7920 7469 6d65 2062 6566 6f72 6520 3a66  y time before :f
+000032f0: 756e 633a 6066 6f72 7761 7264 6020 6973  unc:`forward` is
+00003300: 2069 6e76 6f6b 6564 2e0d 0a20 2020 2049   invoked...    I
+00003310: 7420 7368 6f75 6c64 2068 6176 6520 7468  t should have th
+00003320: 6520 666f 6c6c 6f77 696e 6720 7369 676e  e following sign
+00003330: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
+00003340: 2020 2068 6f6f 6b28 6d6f 6475 6c65 2c20     hook(module, 
+00003350: 696e 7075 7429 202d 3e20 4e6f 6e65 206f  input) -> None o
+00003360: 7220 6d6f 6469 6669 6564 2069 6e70 7574  r modified input
+00003370: 0d0a 0d0a 2020 2020 5468 6520 696e 7075  ....    The inpu
+00003380: 7420 636f 6e74 6169 6e73 206f 6e6c 7920  t contains only 
+00003390: 7468 6520 706f 7369 7469 6f6e 616c 2061  the positional a
+000033a0: 7267 756d 656e 7473 2067 6976 656e 2074  rguments given t
+000033b0: 6f20 7468 6520 6d6f 6475 6c65 2e0d 0a20  o the module... 
+000033c0: 2020 204b 6579 776f 7264 2061 7267 756d     Keyword argum
+000033d0: 656e 7473 2077 6f6e 2774 2062 6520 7061  ents won't be pa
+000033e0: 7373 6564 2074 6f20 7468 6520 686f 6f6b  ssed to the hook
+000033f0: 7320 616e 6420 6f6e 6c79 2074 6f20 7468  s and only to th
+00003400: 6520 6060 666f 7277 6172 6460 602e 0d0a  e ``forward``...
+00003410: 2020 2020 5468 6520 686f 6f6b 2063 616e      The hook can
+00003420: 206d 6f64 6966 7920 7468 6520 696e 7075   modify the inpu
+00003430: 742e 2055 7365 7220 6361 6e20 6569 7468  t. User can eith
+00003440: 6572 2072 6574 7572 6e20 6120 7475 706c  er return a tupl
+00003450: 6520 6f72 2061 0d0a 2020 2020 7369 6e67  e or a..    sing
+00003460: 6c65 206d 6f64 6966 6965 6420 7661 6c75  le modified valu
+00003470: 6520 696e 2074 6865 2068 6f6f 6b2e 2057  e in the hook. W
+00003480: 6520 7769 6c6c 2077 7261 7020 7468 6520  e will wrap the 
+00003490: 7661 6c75 6520 696e 746f 2061 2074 7570  value into a tup
+000034a0: 6c65 0d0a 2020 2020 6966 2061 2073 696e  le..    if a sin
+000034b0: 676c 6520 7661 6c75 6520 6973 2072 6574  gle value is ret
+000034c0: 7572 6e65 6428 756e 6c65 7373 2074 6861  urned(unless tha
+000034d0: 7420 7661 6c75 6520 6973 2061 6c72 6561  t value is alrea
+000034e0: 6479 2061 2074 7570 6c65 292e 0d0a 0d0a  dy a tuple).....
+000034f0: 2020 2020 5468 6973 2068 6f6f 6b20 6861      This hook ha
+00003500: 7320 7072 6563 6564 656e 6365 206f 7665  s precedence ove
+00003510: 7220 7468 6520 7370 6563 6966 6963 206d  r the specific m
+00003520: 6f64 756c 6520 686f 6f6b 7320 7265 6769  odule hooks regi
+00003530: 7374 6572 6564 2077 6974 680d 0a20 2020  stered with..   
+00003540: 2060 6072 6567 6973 7465 725f 666f 7277   ``register_forw
+00003550: 6172 645f 7072 655f 686f 6f6b 6060 2e0d  ard_pre_hook``..
+00003560: 0a0d 0a20 2020 2052 6574 7572 6e73 3a0d  ...    Returns:.
+00003570: 0a20 2020 2020 2020 203a 636c 6173 733a  .        :class:
+00003580: 6074 6f72 6368 2e75 7469 6c73 2e68 6f6f  `torch.utils.hoo
+00003590: 6b73 2e52 656d 6f76 6162 6c65 4861 6e64  ks.RemovableHand
+000035a0: 6c65 603a 0d0a 2020 2020 2020 2020 2020  le`:..          
+000035b0: 2020 6120 6861 6e64 6c65 2074 6861 7420    a handle that 
+000035c0: 6361 6e20 6265 2075 7365 6420 746f 2072  can be used to r
+000035d0: 656d 6f76 6520 7468 6520 6164 6465 6420  emove the added 
+000035e0: 686f 6f6b 2062 7920 6361 6c6c 696e 670d  hook by calling.
+000035f0: 0a20 2020 2020 2020 2020 2020 2060 6068  .            ``h
+00003600: 616e 646c 652e 7265 6d6f 7665 2829 6060  andle.remove()``
+00003610: 0d0a 2020 2020 2222 220d 0a20 2020 2068  ..    """..    h
+00003620: 616e 646c 6520 3d20 5265 6d6f 7661 626c  andle = Removabl
+00003630: 6548 616e 646c 6528 5f67 6c6f 6261 6c5f  eHandle(_global_
+00003640: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+00003650: 7329 0d0a 2020 2020 5f67 6c6f 6261 6c5f  s)..    _global_
+00003660: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+00003670: 735b 6861 6e64 6c65 2e69 645d 203d 2068  s[handle.id] = h
+00003680: 6f6f 6b0d 0a20 2020 2072 6574 7572 6e20  ook..    return 
+00003690: 6861 6e64 6c65 0d0a 0d0a 0d0a 6465 6620  handle......def 
+000036a0: 7265 6769 7374 6572 5f6d 6f64 756c 655f  register_module_
+000036b0: 666f 7277 6172 645f 686f 6f6b 2868 6f6f  forward_hook(hoo
+000036c0: 6b3a 2043 616c 6c61 626c 655b 2e2e 2e2c  k: Callable[...,
+000036d0: 204e 6f6e 655d 2920 2d3e 2052 656d 6f76   None]) -> Remov
+000036e0: 6162 6c65 4861 6e64 6c65 3a0d 0a20 2020  ableHandle:..   
+000036f0: 2072 2222 2252 6567 6973 7465 7273 2061   r"""Registers a
+00003700: 2067 6c6f 6261 6c20 666f 7277 6172 6420   global forward 
+00003710: 686f 6f6b 2066 6f72 2061 6c6c 2074 6865  hook for all the
+00003720: 206d 6f64 756c 6573 0d0a 0d0a 2020 2020   modules....    
+00003730: 2e2e 2077 6172 6e69 6e67 203a 3a0d 0a0d  .. warning ::...
+00003740: 0a20 2020 2020 2020 2054 6869 7320 6164  .        This ad
+00003750: 6473 2067 6c6f 6261 6c20 7374 6174 6520  ds global state 
+00003760: 746f 2074 6865 2060 6e6e 2e6d 6f64 756c  to the `nn.modul
+00003770: 6560 206d 6f64 756c 650d 0a20 2020 2020  e` module..     
+00003780: 2020 2061 6e64 2069 7420 6973 206f 6e6c     and it is onl
+00003790: 7920 696e 7465 6e64 6564 2066 6f72 2064  y intended for d
+000037a0: 6562 7567 6769 6e67 2f70 726f 6669 6c69  ebugging/profili
+000037b0: 6e67 2070 7572 706f 7365 732e 0d0a 0d0a  ng purposes.....
+000037c0: 2020 2020 5468 6520 686f 6f6b 2077 696c      The hook wil
+000037d0: 6c20 6265 2063 616c 6c65 6420 6576 6572  l be called ever
+000037e0: 7920 7469 6d65 2061 6674 6572 203a 6675  y time after :fu
+000037f0: 6e63 3a60 666f 7277 6172 6460 2068 6173  nc:`forward` has
+00003800: 2063 6f6d 7075 7465 6420 616e 206f 7574   computed an out
+00003810: 7075 742e 0d0a 2020 2020 4974 2073 686f  put...    It sho
+00003820: 756c 6420 6861 7665 2074 6865 2066 6f6c  uld have the fol
+00003830: 6c6f 7769 6e67 2073 6967 6e61 7475 7265  lowing signature
+00003840: 3a3a 0d0a 0d0a 2020 2020 2020 2020 686f  ::....        ho
+00003850: 6f6b 286d 6f64 756c 652c 2069 6e70 7574  ok(module, input
+00003860: 2c20 6f75 7470 7574 2920 2d3e 204e 6f6e  , output) -> Non
+00003870: 6520 6f72 206d 6f64 6966 6965 6420 6f75  e or modified ou
+00003880: 7470 7574 0d0a 0d0a 2020 2020 5468 6520  tput....    The 
+00003890: 696e 7075 7420 636f 6e74 6169 6e73 206f  input contains o
+000038a0: 6e6c 7920 7468 6520 706f 7369 7469 6f6e  nly the position
+000038b0: 616c 2061 7267 756d 656e 7473 2067 6976  al arguments giv
+000038c0: 656e 2074 6f20 7468 6520 6d6f 6475 6c65  en to the module
+000038d0: 2e0d 0a20 2020 204b 6579 776f 7264 2061  ...    Keyword a
+000038e0: 7267 756d 656e 7473 2077 6f6e 2774 2062  rguments won't b
+000038f0: 6520 7061 7373 6564 2074 6f20 7468 6520  e passed to the 
+00003900: 686f 6f6b 7320 616e 6420 6f6e 6c79 2074  hooks and only t
+00003910: 6f20 7468 6520 6060 666f 7277 6172 6460  o the ``forward`
+00003920: 602e 0d0a 2020 2020 5468 6520 686f 6f6b  `...    The hook
+00003930: 2063 616e 206d 6f64 6966 7920 7468 6520   can modify the 
+00003940: 6f75 7470 7574 2e20 4974 2063 616e 206d  output. It can m
+00003950: 6f64 6966 7920 7468 6520 696e 7075 7420  odify the input 
+00003960: 696e 706c 6163 6520 6275 740d 0a20 2020  inplace but..   
+00003970: 2069 7420 7769 6c6c 206e 6f74 2068 6176   it will not hav
+00003980: 6520 6566 6665 6374 206f 6e20 666f 7277  e effect on forw
+00003990: 6172 6420 7369 6e63 6520 7468 6973 2069  ard since this i
+000039a0: 7320 6361 6c6c 6564 2061 6674 6572 0d0a  s called after..
+000039b0: 2020 2020 3a66 756e 633a 6066 6f72 7761      :func:`forwa
+000039c0: 7264 6020 6973 2063 616c 6c65 642e 0d0a  rd` is called...
+000039d0: 0d0a 2020 2020 5265 7475 726e 733a 0d0a  ..    Returns:..
+000039e0: 2020 2020 2020 2020 3a63 6c61 7373 3a60          :class:`
+000039f0: 746f 7263 682e 7574 696c 732e 686f 6f6b  torch.utils.hook
+00003a00: 732e 5265 6d6f 7661 626c 6548 616e 646c  s.RemovableHandl
+00003a10: 6560 3a0d 0a20 2020 2020 2020 2020 2020  e`:..           
+00003a20: 2061 2068 616e 646c 6520 7468 6174 2063   a handle that c
+00003a30: 616e 2062 6520 7573 6564 2074 6f20 7265  an be used to re
+00003a40: 6d6f 7665 2074 6865 2061 6464 6564 2068  move the added h
+00003a50: 6f6f 6b20 6279 2063 616c 6c69 6e67 0d0a  ook by calling..
+00003a60: 2020 2020 2020 2020 2020 2020 6060 6861              ``ha
+00003a70: 6e64 6c65 2e72 656d 6f76 6528 2960 600d  ndle.remove()``.
+00003a80: 0a0d 0a20 2020 2054 6869 7320 686f 6f6b  ...    This hook
+00003a90: 2077 696c 6c20 6265 2065 7865 6375 7465   will be execute
+00003aa0: 6420 6265 666f 7265 2073 7065 6369 6669  d before specifi
+00003ab0: 6320 6d6f 6475 6c65 2068 6f6f 6b73 2072  c module hooks r
+00003ac0: 6567 6973 7465 7265 6420 7769 7468 0d0a  egistered with..
+00003ad0: 2020 2020 6060 7265 6769 7374 6572 5f66      ``register_f
+00003ae0: 6f72 7761 7264 5f68 6f6f 6b60 602e 0d0a  orward_hook``...
+00003af0: 2020 2020 2222 220d 0a20 2020 2068 616e      """..    han
+00003b00: 646c 6520 3d20 5265 6d6f 7661 626c 6548  dle = RemovableH
+00003b10: 616e 646c 6528 5f67 6c6f 6261 6c5f 666f  andle(_global_fo
+00003b20: 7277 6172 645f 686f 6f6b 7329 0d0a 2020  rward_hooks)..  
+00003b30: 2020 5f67 6c6f 6261 6c5f 666f 7277 6172    _global_forwar
+00003b40: 645f 686f 6f6b 735b 6861 6e64 6c65 2e69  d_hooks[handle.i
+00003b50: 645d 203d 2068 6f6f 6b0d 0a20 2020 2072  d] = hook..    r
+00003b60: 6574 7572 6e20 6861 6e64 6c65 0d0a 0d0a  eturn handle....
+00003b70: 0d0a 6465 6620 7265 6769 7374 6572 5f6d  ..def register_m
+00003b80: 6f64 756c 655f 6261 636b 7761 7264 5f68  odule_backward_h
+00003b90: 6f6f 6b28 0d0a 2020 2020 2020 2020 686f  ook(..        ho
+00003ba0: 6f6b 3a20 4361 6c6c 6162 6c65 5b5b 274c  ok: Callable[['L
+00003bb0: 6179 6572 272c 205f 6772 6164 5f74 2c20  ayer', _grad_t, 
+00003bc0: 5f67 7261 645f 745d 2c20 556e 696f 6e5b  _grad_t], Union[
+00003bd0: 4e6f 6e65 2c20 5f67 7261 645f 745d 5d0d  None, _grad_t]].
+00003be0: 0a29 202d 3e20 5265 6d6f 7661 626c 6548  .) -> RemovableH
+00003bf0: 616e 646c 653a 0d0a 2020 2020 7222 2222  andle:..    r"""
+00003c00: 5265 6769 7374 6572 7320 6120 6261 636b  Registers a back
+00003c10: 7761 7264 2068 6f6f 6b20 636f 6d6d 6f6e  ward hook common
+00003c20: 2074 6f20 616c 6c20 7468 6520 6d6f 6475   to all the modu
+00003c30: 6c65 732e 0d0a 0d0a 2020 2020 5468 6973  les.....    This
+00003c40: 2066 756e 6374 696f 6e20 6973 2064 6570   function is dep
+00003c50: 7265 6361 7465 6420 696e 2066 6176 6f72  recated in favor
+00003c60: 206f 660d 0a20 2020 203a 6675 6e63 3a60   of..    :func:`
+00003c70: 746f 7263 682e 6e6e 2e6d 6f64 756c 6573  torch.nn.modules
+00003c80: 2e6d 6f64 756c 652e 7265 6769 7374 6572  .module.register
+00003c90: 5f6d 6f64 756c 655f 6675 6c6c 5f62 6163  _module_full_bac
+00003ca0: 6b77 6172 645f 686f 6f6b 600d 0a20 2020  kward_hook`..   
+00003cb0: 2061 6e64 2074 6865 2062 6568 6176 696f   and the behavio
+00003cc0: 7220 6f66 2074 6869 7320 6675 6e63 7469  r of this functi
+00003cd0: 6f6e 2077 696c 6c20 6368 616e 6765 2069  on will change i
+00003ce0: 6e20 6675 7475 7265 2076 6572 7369 6f6e  n future version
+00003cf0: 732e 0d0a 0d0a 2020 2020 5265 7475 726e  s.....    Return
+00003d00: 733a 0d0a 2020 2020 2020 2020 3a63 6c61  s:..        :cla
+00003d10: 7373 3a60 746f 7263 682e 7574 696c 732e  ss:`torch.utils.
+00003d20: 686f 6f6b 732e 5265 6d6f 7661 626c 6548  hooks.RemovableH
+00003d30: 616e 646c 6560 3a0d 0a20 2020 2020 2020  andle`:..       
+00003d40: 2020 2020 2061 2068 616e 646c 6520 7468       a handle th
+00003d50: 6174 2063 616e 2062 6520 7573 6564 2074  at can be used t
+00003d60: 6f20 7265 6d6f 7665 2074 6865 2061 6464  o remove the add
+00003d70: 6564 2068 6f6f 6b20 6279 2063 616c 6c69  ed hook by calli
+00003d80: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
+00003d90: 6060 6861 6e64 6c65 2e72 656d 6f76 6528  ``handle.remove(
+00003da0: 2960 600d 0a0d 0a20 2020 2022 2222 0d0a  )``....    """..
+00003db0: 2020 2020 676c 6f62 616c 205f 676c 6f62      global _glob
+00003dc0: 616c 5f69 735f 6675 6c6c 5f62 6163 6b77  al_is_full_backw
+00003dd0: 6172 645f 686f 6f6b 0d0a 2020 2020 6966  ard_hook..    if
+00003de0: 205f 676c 6f62 616c 5f69 735f 6675 6c6c   _global_is_full
+00003df0: 5f62 6163 6b77 6172 645f 686f 6f6b 2069  _backward_hook i
+00003e00: 7320 5472 7565 3a0d 0a20 2020 2020 2020  s True:..       
+00003e10: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+00003e20: 726f 7228 2243 616e 6e6f 7420 7573 6520  ror("Cannot use 
+00003e30: 626f 7468 2072 6567 756c 6172 2062 6163  both regular bac
+00003e40: 6b77 6172 6420 686f 6f6b 7320 616e 6420  kward hooks and 
+00003e50: 6675 6c6c 2062 6163 6b77 6172 6420 686f  full backward ho
+00003e60: 6f6b 7320 6173 2061 2022 0d0a 2020 2020  oks as a "..    
+00003e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e80: 2020 2020 2020 2022 676c 6f62 616c 204d         "global M
+00003e90: 6f64 756c 6520 686f 6f6b 2e20 506c 6561  odule hook. Plea
+00003ea0: 7365 2075 7365 206f 6e6c 7920 6f6e 6520  se use only one 
+00003eb0: 6f66 2074 6865 6d2e 2229 0d0a 0d0a 2020  of them.")....  
+00003ec0: 2020 5f67 6c6f 6261 6c5f 6973 5f66 756c    _global_is_ful
+00003ed0: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b20  l_backward_hook 
+00003ee0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2068  = False....    h
+00003ef0: 616e 646c 6520 3d20 5265 6d6f 7661 626c  andle = Removabl
+00003f00: 6548 616e 646c 6528 5f67 6c6f 6261 6c5f  eHandle(_global_
+00003f10: 6261 636b 7761 7264 5f68 6f6f 6b73 290d  backward_hooks).
+00003f20: 0a20 2020 205f 676c 6f62 616c 5f62 6163  .    _global_bac
+00003f30: 6b77 6172 645f 686f 6f6b 735b 6861 6e64  kward_hooks[hand
+00003f40: 6c65 2e69 645d 203d 2068 6f6f 6b0d 0a20  le.id] = hook.. 
+00003f50: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
+00003f60: 0d0a 0d0a 0d0a 6465 6620 7265 6769 7374  ......def regist
+00003f70: 6572 5f6d 6f64 756c 655f 6675 6c6c 5f62  er_module_full_b
+00003f80: 6163 6b77 6172 645f 7072 655f 686f 6f6b  ackward_pre_hook
+00003f90: 280d 0a20 2020 2020 2020 2068 6f6f 6b3a  (..        hook:
+00003fa0: 2043 616c 6c61 626c 655b 5b27 4c61 7965   Callable[['Laye
+00003fb0: 7227 2c20 5f67 7261 645f 745d 2c20 556e  r', _grad_t], Un
+00003fc0: 696f 6e5b 4e6f 6e65 2c20 5f67 7261 645f  ion[None, _grad_
+00003fd0: 745d 5d0d 0a29 202d 3e20 5265 6d6f 7661  t]]..) -> Remova
+00003fe0: 626c 6548 616e 646c 653a 0d0a 2020 2020  bleHandle:..    
+00003ff0: 7222 2222 5265 6769 7374 6572 7320 6120  r"""Registers a 
+00004000: 6261 636b 7761 7264 2070 7265 2d68 6f6f  backward pre-hoo
+00004010: 6b20 636f 6d6d 6f6e 2074 6f20 616c 6c20  k common to all 
+00004020: 7468 6520 6d6f 6475 6c65 732e 0d0a 0d0a  the modules.....
+00004030: 2020 2020 2e2e 2077 6172 6e69 6e67 203a      .. warning :
+00004040: 3a0d 0a20 2020 2020 2020 2054 6869 7320  :..        This 
+00004050: 6164 6473 2067 6c6f 6261 6c20 7374 6174  adds global stat
+00004060: 6520 746f 2074 6865 2060 6e6e 2e6d 6f64  e to the `nn.mod
+00004070: 756c 6560 206d 6f64 756c 650d 0a20 2020  ule` module..   
+00004080: 2020 2020 2061 6e64 2069 7420 6973 206f       and it is o
+00004090: 6e6c 7920 696e 7465 6e64 6564 2066 6f72  nly intended for
+000040a0: 2064 6562 7567 6769 6e67 2f70 726f 6669   debugging/profi
+000040b0: 6c69 6e67 2070 7572 706f 7365 732e 0d0a  ling purposes...
+000040c0: 0d0a 2020 2020 5468 6520 686f 6f6b 2077  ..    The hook w
+000040d0: 696c 6c20 6265 2063 616c 6c65 6420 6576  ill be called ev
+000040e0: 6572 7920 7469 6d65 2074 6865 2067 7261  ery time the gra
+000040f0: 6469 656e 7473 2066 6f72 2074 6865 206d  dients for the m
+00004100: 6f64 756c 6520 6172 6520 636f 6d70 7574  odule are comput
+00004110: 6564 2e0d 0a20 2020 2054 6865 2068 6f6f  ed...    The hoo
+00004120: 6b20 7368 6f75 6c64 2068 6176 6520 7468  k should have th
+00004130: 6520 666f 6c6c 6f77 696e 6720 7369 676e  e following sign
+00004140: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
+00004150: 2020 2068 6f6f 6b28 6d6f 6475 6c65 2c20     hook(module, 
+00004160: 6772 6164 5f6f 7574 7075 7429 202d 3e20  grad_output) -> 
+00004170: 5465 6e73 6f72 206f 7220 4e6f 6e65 0d0a  Tensor or None..
+00004180: 0d0a 2020 2020 5468 6520 3a61 7474 723a  ..    The :attr:
+00004190: 6067 7261 645f 6f75 7470 7574 6020 6973  `grad_output` is
+000041a0: 2061 2074 7570 6c65 2e20 5468 6520 686f   a tuple. The ho
+000041b0: 6f6b 2073 686f 756c 640d 0a20 2020 206e  ok should..    n
+000041c0: 6f74 206d 6f64 6966 7920 6974 7320 6172  ot modify its ar
+000041d0: 6775 6d65 6e74 732c 2062 7574 2069 7420  guments, but it 
+000041e0: 6361 6e20 6f70 7469 6f6e 616c 6c79 2072  can optionally r
+000041f0: 6574 7572 6e20 6120 6e65 7720 6772 6164  eturn a new grad
+00004200: 6965 6e74 2077 6974 680d 0a20 2020 2072  ient with..    r
+00004210: 6573 7065 6374 2074 6f20 7468 6520 6f75  espect to the ou
+00004220: 7470 7574 2074 6861 7420 7769 6c6c 2062  tput that will b
+00004230: 6520 7573 6564 2069 6e20 706c 6163 6520  e used in place 
+00004240: 6f66 203a 6174 7472 3a60 6772 6164 5f6f  of :attr:`grad_o
+00004250: 7574 7075 7460 2069 6e0d 0a20 2020 2073  utput` in..    s
+00004260: 7562 7365 7175 656e 7420 636f 6d70 7574  ubsequent comput
+00004270: 6174 696f 6e73 2e20 456e 7472 6965 7320  ations. Entries 
+00004280: 696e 203a 6174 7472 3a60 6772 6164 5f6f  in :attr:`grad_o
+00004290: 7574 7075 7460 2077 696c 6c20 6265 2060  utput` will be `
+000042a0: 604e 6f6e 6560 6020 666f 720d 0a20 2020  `None`` for..   
+000042b0: 2061 6c6c 206e 6f6e 2d54 656e 736f 7220   all non-Tensor 
+000042c0: 6172 6775 6d65 6e74 732e 0d0a 0d0a 2020  arguments.....  
+000042d0: 2020 466f 7220 7465 6368 6e69 6361 6c20    For technical 
+000042e0: 7265 6173 6f6e 732c 2077 6865 6e20 7468  reasons, when th
+000042f0: 6973 2068 6f6f 6b20 6973 2061 7070 6c69  is hook is appli
+00004300: 6564 2074 6f20 6120 4d6f 6475 6c65 2c20  ed to a Module, 
+00004310: 6974 7320 666f 7277 6172 6420 6675 6e63  its forward func
+00004320: 7469 6f6e 2077 696c 6c0d 0a20 2020 2072  tion will..    r
+00004330: 6563 6569 7665 2061 2076 6965 7720 6f66  eceive a view of
+00004340: 2065 6163 6820 5465 6e73 6f72 2070 6173   each Tensor pas
+00004350: 7365 6420 746f 2074 6865 204d 6f64 756c  sed to the Modul
+00004360: 652e 2053 696d 696c 6172 6c79 2074 6865  e. Similarly the
+00004370: 2063 616c 6c65 7220 7769 6c6c 2072 6563   caller will rec
+00004380: 6569 7665 2061 2076 6965 770d 0a20 2020  eive a view..   
+00004390: 206f 6620 6561 6368 2054 656e 736f 7220   of each Tensor 
+000043a0: 7265 7475 726e 6564 2062 7920 7468 6520  returned by the 
+000043b0: 4d6f 6475 6c65 2773 2066 6f72 7761 7264  Module's forward
+000043c0: 2066 756e 6374 696f 6e2e 0d0a 0d0a 2020   function.....  
+000043d0: 2020 476c 6f62 616c 2068 6f6f 6b73 2061    Global hooks a
+000043e0: 7265 2063 616c 6c65 6420 6265 666f 7265  re called before
+000043f0: 2068 6f6f 6b73 2072 6567 6973 7465 7265   hooks registere
+00004400: 6420 7769 7468 2060 7265 6769 7374 6572  d with `register
+00004410: 5f62 6163 6b77 6172 645f 7072 655f 686f  _backward_pre_ho
+00004420: 6f6b 600d 0a0d 0a20 2020 2052 6574 7572  ok`....    Retur
+00004430: 6e73 3a0d 0a20 2020 2020 2020 203a 636c  ns:..        :cl
+00004440: 6173 733a 6074 6f72 6368 2e75 7469 6c73  ass:`torch.utils
+00004450: 2e68 6f6f 6b73 2e52 656d 6f76 6162 6c65  .hooks.Removable
+00004460: 4861 6e64 6c65 603a 0d0a 2020 2020 2020  Handle`:..      
+00004470: 2020 2020 2020 6120 6861 6e64 6c65 2074        a handle t
+00004480: 6861 7420 6361 6e20 6265 2075 7365 6420  hat can be used 
+00004490: 746f 2072 656d 6f76 6520 7468 6520 6164  to remove the ad
+000044a0: 6465 6420 686f 6f6b 2062 7920 6361 6c6c  ded hook by call
+000044b0: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
+000044c0: 2060 6068 616e 646c 652e 7265 6d6f 7665   ``handle.remove
+000044d0: 2829 6060 0d0a 0d0a 2020 2020 2222 220d  ()``....    """.
+000044e0: 0a20 2020 2068 616e 646c 6520 3d20 5265  .    handle = Re
+000044f0: 6d6f 7661 626c 6548 616e 646c 6528 5f67  movableHandle(_g
+00004500: 6c6f 6261 6c5f 6261 636b 7761 7264 5f70  lobal_backward_p
+00004510: 7265 5f68 6f6f 6b73 290d 0a20 2020 205f  re_hooks)..    _
+00004520: 676c 6f62 616c 5f62 6163 6b77 6172 645f  global_backward_
+00004530: 7072 655f 686f 6f6b 735b 6861 6e64 6c65  pre_hooks[handle
+00004540: 2e69 645d 203d 2068 6f6f 6b0d 0a20 2020  .id] = hook..   
+00004550: 2072 6574 7572 6e20 6861 6e64 6c65 0d0a   return handle..
+00004560: 0d0a 0d0a 6465 6620 7265 6769 7374 6572  ....def register
+00004570: 5f6d 6f64 756c 655f 6675 6c6c 5f62 6163  _module_full_bac
+00004580: 6b77 6172 645f 686f 6f6b 280d 0a20 2020  kward_hook(..   
+00004590: 2020 2020 2068 6f6f 6b3a 2043 616c 6c61       hook: Calla
+000045a0: 626c 655b 5b27 4c61 7965 7227 2c20 5f67  ble[['Layer', _g
+000045b0: 7261 645f 742c 205f 6772 6164 5f74 5d2c  rad_t, _grad_t],
+000045c0: 2055 6e69 6f6e 5b4e 6f6e 652c 205f 6772   Union[None, _gr
+000045d0: 6164 5f74 5d5d 0d0a 2920 2d3e 2052 656d  ad_t]]..) -> Rem
+000045e0: 6f76 6162 6c65 4861 6e64 6c65 3a0d 0a20  ovableHandle:.. 
+000045f0: 2020 2072 2222 2252 6567 6973 7465 7273     r"""Registers
+00004600: 2061 2062 6163 6b77 6172 6420 686f 6f6b   a backward hook
+00004610: 2063 6f6d 6d6f 6e20 746f 2061 6c6c 2074   common to all t
+00004620: 6865 206d 6f64 756c 6573 2e0d 0a0d 0a20  he modules..... 
+00004630: 2020 202e 2e20 7761 726e 696e 6720 3a3a     .. warning ::
+00004640: 0d0a 2020 2020 2020 2020 5468 6973 2061  ..        This a
+00004650: 6464 7320 676c 6f62 616c 2073 7461 7465  dds global state
+00004660: 2074 6f20 7468 6520 606e 6e2e 6d6f 6475   to the `nn.modu
+00004670: 6c65 6020 6d6f 6475 6c65 0d0a 2020 2020  le` module..    
+00004680: 2020 2020 616e 6420 6974 2069 7320 6f6e      and it is on
+00004690: 6c79 2069 6e74 656e 6465 6420 666f 7220  ly intended for 
+000046a0: 6465 6275 6767 696e 672f 7072 6f66 696c  debugging/profil
+000046b0: 696e 6720 7075 7270 6f73 6573 2e0d 0a0d  ing purposes....
+000046c0: 0a20 2020 2054 6865 2068 6f6f 6b20 7769  .    The hook wi
+000046d0: 6c6c 2062 6520 6361 6c6c 6564 2065 7665  ll be called eve
+000046e0: 7279 2074 696d 6520 7468 6520 6772 6164  ry time the grad
+000046f0: 6965 6e74 7320 7769 7468 2072 6573 7065  ients with respe
+00004700: 6374 2074 6f20 6120 6d6f 6475 6c65 0d0a  ct to a module..
+00004710: 2020 2020 6172 6520 636f 6d70 7574 6564      are computed
+00004720: 2c20 692e 652e 2074 6865 2068 6f6f 6b20  , i.e. the hook 
+00004730: 7769 6c6c 2065 7865 6375 7465 2069 6620  will execute if 
+00004740: 616e 6420 6f6e 6c79 2069 6620 7468 6520  and only if the 
+00004750: 6772 6164 6965 6e74 7320 7769 7468 0d0a  gradients with..
+00004760: 2020 2020 7265 7370 6563 7420 746f 206d      respect to m
+00004770: 6f64 756c 6520 6f75 7470 7574 7320 6172  odule outputs ar
+00004780: 6520 636f 6d70 7574 6564 2e20 5468 6520  e computed. The 
+00004790: 686f 6f6b 2073 686f 756c 6420 6861 7665  hook should have
+000047a0: 2074 6865 2066 6f6c 6c6f 7769 6e67 0d0a   the following..
+000047b0: 2020 2020 7369 676e 6174 7572 653a 3a0d      signature::.
+000047c0: 0a0d 0a20 2020 2020 2020 2068 6f6f 6b28  ...        hook(
+000047d0: 6d6f 6475 6c65 2c20 6772 6164 5f69 6e70  module, grad_inp
+000047e0: 7574 2c20 6772 6164 5f6f 7574 7075 7429  ut, grad_output)
+000047f0: 202d 3e20 5465 6e73 6f72 206f 7220 4e6f   -> Tensor or No
+00004800: 6e65 0d0a 0d0a 2020 2020 5468 6520 3a61  ne....    The :a
+00004810: 7474 723a 6067 7261 645f 696e 7075 7460  ttr:`grad_input`
+00004820: 2061 6e64 203a 6174 7472 3a60 6772 6164   and :attr:`grad
+00004830: 5f6f 7574 7075 7460 2061 7265 2074 7570  _output` are tup
+00004840: 6c65 732e 2054 6865 2068 6f6f 6b20 7368  les. The hook sh
+00004850: 6f75 6c64 0d0a 2020 2020 6e6f 7420 6d6f  ould..    not mo
+00004860: 6469 6679 2069 7473 2061 7267 756d 656e  dify its argumen
+00004870: 7473 2c20 6275 7420 6974 2063 616e 206f  ts, but it can o
+00004880: 7074 696f 6e61 6c6c 7920 7265 7475 726e  ptionally return
+00004890: 2061 206e 6577 2067 7261 6469 656e 7420   a new gradient 
+000048a0: 7769 7468 0d0a 2020 2020 7265 7370 6563  with..    respec
+000048b0: 7420 746f 2074 6865 2069 6e70 7574 2074  t to the input t
+000048c0: 6861 7420 7769 6c6c 2062 6520 7573 6564  hat will be used
+000048d0: 2069 6e20 706c 6163 6520 6f66 203a 6174   in place of :at
+000048e0: 7472 3a60 6772 6164 5f69 6e70 7574 6020  tr:`grad_input` 
+000048f0: 696e 0d0a 2020 2020 7375 6273 6571 7565  in..    subseque
+00004900: 6e74 2063 6f6d 7075 7461 7469 6f6e 732e  nt computations.
+00004910: 203a 6174 7472 3a60 6772 6164 5f69 6e70   :attr:`grad_inp
+00004920: 7574 6020 7769 6c6c 206f 6e6c 7920 636f  ut` will only co
+00004930: 7272 6573 706f 6e64 2074 6f20 7468 6520  rrespond to the 
+00004940: 696e 7075 7473 2067 6976 656e 0d0a 2020  inputs given..  
+00004950: 2020 6173 2070 6f73 6974 696f 6e61 6c20    as positional 
+00004960: 6172 6775 6d65 6e74 7320 616e 6420 616c  arguments and al
+00004970: 6c20 6b77 6172 6720 6172 6775 6d65 6e74  l kwarg argument
+00004980: 7320 7769 6c6c 206e 6f74 2061 7070 6561  s will not appea
+00004990: 7220 696e 2074 6865 2068 6f6f 6b2e 2045  r in the hook. E
+000049a0: 6e74 7269 6573 0d0a 2020 2020 696e 203a  ntries..    in :
+000049b0: 6174 7472 3a60 6772 6164 5f69 6e70 7574  attr:`grad_input
+000049c0: 6020 616e 6420 3a61 7474 723a 6067 7261  ` and :attr:`gra
+000049d0: 645f 6f75 7470 7574 6020 7769 6c6c 2062  d_output` will b
+000049e0: 6520 6060 4e6f 6e65 6060 2066 6f72 2061  e ``None`` for a
+000049f0: 6c6c 206e 6f6e 2d54 656e 736f 720d 0a20  ll non-Tensor.. 
+00004a00: 2020 2061 7267 756d 656e 7473 2e0d 0a0d     arguments....
+00004a10: 0a20 2020 2046 6f72 2074 6563 686e 6963  .    For technic
+00004a20: 616c 2072 6561 736f 6e73 2c20 7768 656e  al reasons, when
+00004a30: 2074 6869 7320 686f 6f6b 2069 7320 6170   this hook is ap
+00004a40: 706c 6965 6420 746f 2061 204d 6f64 756c  plied to a Modul
+00004a50: 652c 2069 7473 2066 6f72 7761 7264 2066  e, its forward f
+00004a60: 756e 6374 696f 6e20 7769 6c6c 0d0a 2020  unction will..  
+00004a70: 2020 7265 6365 6976 6520 6120 7669 6577    receive a view
+00004a80: 206f 6620 6561 6368 2054 656e 736f 7220   of each Tensor 
+00004a90: 7061 7373 6564 2074 6f20 7468 6520 4d6f  passed to the Mo
+00004aa0: 6475 6c65 2e20 5369 6d69 6c61 726c 7920  dule. Similarly 
+00004ab0: 7468 6520 6361 6c6c 6572 2077 696c 6c20  the caller will 
+00004ac0: 7265 6365 6976 6520 6120 7669 6577 0d0a  receive a view..
+00004ad0: 2020 2020 6f66 2065 6163 6820 5465 6e73      of each Tens
+00004ae0: 6f72 2072 6574 7572 6e65 6420 6279 2074  or returned by t
+00004af0: 6865 204d 6f64 756c 6527 7320 666f 7277  he Module's forw
+00004b00: 6172 6420 6675 6e63 7469 6f6e 2e0d 0a0d  ard function....
+00004b10: 0a20 2020 2047 6c6f 6261 6c20 686f 6f6b  .    Global hook
+00004b20: 7320 6172 6520 6361 6c6c 6564 2062 6566  s are called bef
+00004b30: 6f72 6520 686f 6f6b 7320 7265 6769 7374  ore hooks regist
+00004b40: 6572 6564 2077 6974 6820 6072 6567 6973  ered with `regis
+00004b50: 7465 725f 6261 636b 7761 7264 5f68 6f6f  ter_backward_hoo
+00004b60: 6b60 0d0a 0d0a 2020 2020 5265 7475 726e  k`....    Return
+00004b70: 733a 0d0a 2020 2020 2020 2020 3a63 6c61  s:..        :cla
+00004b80: 7373 3a60 746f 7263 682e 7574 696c 732e  ss:`torch.utils.
+00004b90: 686f 6f6b 732e 5265 6d6f 7661 626c 6548  hooks.RemovableH
+00004ba0: 616e 646c 6560 3a0d 0a20 2020 2020 2020  andle`:..       
+00004bb0: 2020 2020 2061 2068 616e 646c 6520 7468       a handle th
+00004bc0: 6174 2063 616e 2062 6520 7573 6564 2074  at can be used t
+00004bd0: 6f20 7265 6d6f 7665 2074 6865 2061 6464  o remove the add
+00004be0: 6564 2068 6f6f 6b20 6279 2063 616c 6c69  ed hook by calli
+00004bf0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
+00004c00: 6060 6861 6e64 6c65 2e72 656d 6f76 6528  ``handle.remove(
+00004c10: 2960 600d 0a0d 0a20 2020 2022 2222 0d0a  )``....    """..
+00004c20: 2020 2020 676c 6f62 616c 205f 676c 6f62      global _glob
+00004c30: 616c 5f69 735f 6675 6c6c 5f62 6163 6b77  al_is_full_backw
+00004c40: 6172 645f 686f 6f6b 0d0a 2020 2020 6966  ard_hook..    if
+00004c50: 205f 676c 6f62 616c 5f69 735f 6675 6c6c   _global_is_full
+00004c60: 5f62 6163 6b77 6172 645f 686f 6f6b 2069  _backward_hook i
+00004c70: 7320 4661 6c73 653a 0d0a 2020 2020 2020  s False:..      
+00004c80: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
+00004c90: 7272 6f72 2822 4361 6e6e 6f74 2075 7365  rror("Cannot use
+00004ca0: 2062 6f74 6820 7265 6775 6c61 7220 6261   both regular ba
+00004cb0: 636b 7761 7264 2068 6f6f 6b73 2061 6e64  ckward hooks and
+00004cc0: 2066 756c 6c20 6261 636b 7761 7264 2068   full backward h
+00004cd0: 6f6f 6b73 2061 7320 6120 220d 0a20 2020  ooks as a "..   
+00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cf0: 2020 2020 2020 2020 2267 6c6f 6261 6c20          "global 
+00004d00: 4d6f 6475 6c65 2068 6f6f 6b2e 2050 6c65  Module hook. Ple
+00004d10: 6173 6520 7573 6520 6f6e 6c79 206f 6e65  ase use only one
+00004d20: 206f 6620 7468 656d 2e22 290d 0a0d 0a20   of them.").... 
+00004d30: 2020 205f 676c 6f62 616c 5f69 735f 6675     _global_is_fu
+00004d40: 6c6c 5f62 6163 6b77 6172 645f 686f 6f6b  ll_backward_hook
+00004d50: 203d 2054 7275 650d 0a0d 0a20 2020 2068   = True....    h
+00004d60: 616e 646c 6520 3d20 5265 6d6f 7661 626c  andle = Removabl
+00004d70: 6548 616e 646c 6528 5f67 6c6f 6261 6c5f  eHandle(_global_
+00004d80: 6261 636b 7761 7264 5f68 6f6f 6b73 290d  backward_hooks).
+00004d90: 0a20 2020 205f 676c 6f62 616c 5f62 6163  .    _global_bac
+00004da0: 6b77 6172 645f 686f 6f6b 735b 6861 6e64  kward_hooks[hand
+00004db0: 6c65 2e69 645d 203d 2068 6f6f 6b0d 0a20  le.id] = hook.. 
+00004dc0: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
+00004dd0: 0d0a 0d0a 0d0a 2320 5472 6963 6b20 6d79  ......# Trick my
+00004de0: 7079 2069 6e74 6f20 6e6f 7420 6170 706c  py into not appl
+00004df0: 7969 6e67 2063 6f6e 7472 6176 6172 6961  ying contravaria
+00004e00: 6e63 6520 7275 6c65 7320 746f 2069 6e70  nce rules to inp
+00004e10: 7574 7320 6279 2064 6566 696e 696e 670d  uts by defining.
+00004e20: 0a23 2066 6f72 7761 7264 2061 7320 6120  .# forward as a 
+00004e30: 7661 6c75 652c 2072 6174 6865 7220 7468  value, rather th
+00004e40: 616e 2061 2066 756e 6374 696f 6e2e 2020  an a function.  
+00004e50: 5365 6520 616c 736f 0d0a 2320 6874 7470  See also..# http
+00004e60: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
+00004e70: 7974 686f 6e2f 6d79 7079 2f69 7373 7565  ython/mypy/issue
+00004e80: 732f 3837 3935 0d0a 6465 6620 5f66 6f72  s/8795..def _for
+00004e90: 7761 7264 5f75 6e69 6d70 6c65 6d65 6e74  ward_unimplement
+00004ea0: 6564 2873 656c 662c 202a 696e 7075 743a  ed(self, *input:
+00004eb0: 2041 6e79 2920 2d3e 204e 6f6e 653a 0d0a   Any) -> None:..
+00004ec0: 2020 2020 7222 2222 4465 6669 6e65 7320      r"""Defines 
+00004ed0: 7468 6520 636f 6d70 7574 6174 696f 6e20  the computation 
+00004ee0: 7065 7266 6f72 6d65 6420 6174 2065 7665  performed at eve
+00004ef0: 7279 2063 616c 6c2e 0d0a 0d0a 2020 2020  ry call.....    
+00004f00: 5368 6f75 6c64 2062 6520 6f76 6572 7269  Should be overri
+00004f10: 6464 656e 2062 7920 616c 6c20 7375 6263  dden by all subc
+00004f20: 6c61 7373 6573 2e0d 0a0d 0a20 2020 202e  lasses.....    .
+00004f30: 2e20 6e6f 7465 3a3a 0d0a 2020 2020 2020  . note::..      
+00004f40: 2020 416c 7468 6f75 6768 2074 6865 2072    Although the r
+00004f50: 6563 6970 6520 666f 7220 666f 7277 6172  ecipe for forwar
+00004f60: 6420 7061 7373 206e 6565 6473 2074 6f20  d pass needs to 
+00004f70: 6265 2064 6566 696e 6564 2077 6974 6869  be defined withi
+00004f80: 6e0d 0a20 2020 2020 2020 2074 6869 7320  n..        this 
+00004f90: 6675 6e63 7469 6f6e 2c20 6f6e 6520 7368  function, one sh
+00004fa0: 6f75 6c64 2063 616c 6c20 7468 6520 3a63  ould call the :c
+00004fb0: 6c61 7373 3a60 4d6f 6475 6c65 6020 696e  lass:`Module` in
+00004fc0: 7374 616e 6365 2061 6674 6572 7761 7264  stance afterward
+00004fd0: 730d 0a20 2020 2020 2020 2069 6e73 7465  s..        inste
+00004fe0: 6164 206f 6620 7468 6973 2073 696e 6365  ad of this since
+00004ff0: 2074 6865 2066 6f72 6d65 7220 7461 6b65   the former take
+00005000: 7320 6361 7265 206f 6620 7275 6e6e 696e  s care of runnin
+00005010: 6720 7468 650d 0a20 2020 2020 2020 2072  g the..        r
+00005020: 6567 6973 7465 7265 6420 686f 6f6b 7320  egistered hooks 
+00005030: 7768 696c 6520 7468 6520 6c61 7474 6572  while the latter
+00005040: 2073 696c 656e 746c 7920 6967 6e6f 7265   silently ignore
+00005050: 7320 7468 656d 2e0d 0a20 2020 2022 2222  s them...    """
+00005060: 0d0a 2020 2020 7261 6973 6520 4e6f 7449  ..    raise NotI
+00005070: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+00005080: 6622 4d6f 6475 6c65 205b 7b74 7970 6528  f"Module [{type(
+00005090: 7365 6c66 292e 5f5f 6e61 6d65 5f5f 7d5d  self).__name__}]
+000050a0: 2069 7320 6d69 7373 696e 6720 7468 6520   is missing the 
+000050b0: 7265 7175 6972 6564 205c 2266 6f72 7761  required \"forwa
+000050c0: 7264 5c22 2066 756e 6374 696f 6e22 290d  rd\" function").
+000050d0: 0a0d 0a0d 0a23 2064 6566 2050 6172 616d  .....# def Param
+000050e0: 6574 6572 2864 6174 612c 2074 7261 696e  eter(data, train
+000050f0: 6162 6c65 3d54 7275 652c 2064 7479 7065  able=True, dtype
+00005100: 3d4e 6f6e 652c 206e 616d 653d 4e6f 6e65  =None, name=None
+00005110: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2320  , **kwargs):..# 
+00005120: 2020 2020 6966 2064 7479 7065 2069 7320      if dtype is 
+00005130: 4e6f 6e65 3a0d 0a23 2020 2020 2020 2020  None:..#        
+00005140: 2064 7479 7065 203d 2074 662e 666c 6f61   dtype = tf.floa
+00005150: 7433 320d 0a23 2020 2020 2072 6574 7572  t32..#     retur
+00005160: 6e20 7466 2e56 6172 6961 626c 6528 696e  n tf.Variable(in
+00005170: 6974 6961 6c5f 7661 6c75 653d 6361 7374  itial_value=cast
+00005180: 2864 6174 612c 2064 7479 7065 292c 2074  (data, dtype), t
+00005190: 7261 696e 6162 6c65 3d74 7261 696e 6162  rainable=trainab
+000051a0: 6c65 2c20 6e61 6d65 3d6e 616d 6529 0d0a  le, name=name)..
+000051b0: 0d0a 0d0a 6465 6620 5061 7261 6d65 7465  ....def Paramete
+000051c0: 7228 6461 7461 2c20 7472 6169 6e61 626c  r(data, trainabl
+000051d0: 653d 5472 7565 2c20 6e61 6d65 3d4e 6f6e  e=True, name=Non
+000051e0: 6529 3a0d 0a20 2020 2072 6574 7572 6e20  e):..    return 
+000051f0: 7466 2e56 6172 6961 626c 6528 696e 6974  tf.Variable(init
+00005200: 6961 6c5f 7661 6c75 653d 6461 7461 2c20  ial_value=data, 
+00005210: 7472 6169 6e61 626c 653d 7472 6169 6e61  trainable=traina
+00005220: 626c 652c 2064 7479 7065 3d64 6174 612e  ble, dtype=data.
+00005230: 6474 7970 652c 206e 616d 653d 6e61 6d65  dtype, name=name
+00005240: 290d 0a0d 0a0d 0a63 6c61 7373 204c 6179  )......class Lay
+00005250: 6572 2874 662e 4d6f 6475 6c65 293a 0d0a  er(tf.Module):..
+00005260: 2020 2020 2222 2254 7269 6465 6e74 2065      """Trident e
+00005270: 7874 656e 6564 2074 662e 4d6f 6475 6c65  xtened tf.Module
+00005280: 2061 7320 6261 7365 206c 6179 6572 2063   as base layer c
+00005290: 6c61 7373 2e0d 0a0d 0a20 2020 596f 7572  lass.....   Your
+000052a0: 206d 6f64 656c 7320 7368 6f75 6c64 2061   models should a
+000052b0: 6c73 6f20 7375 6263 6c61 7373 206f 6620  lso subclass of 
+000052c0: 7468 6973 2063 6c61 7373 2e0d 0a20 2020  this class...   
+000052d0: 204c 6179 6572 2063 6f6e 7461 696e 7320   Layer contains 
+000052e0: 3a0d 0a20 2020 2020 2020 206d 6f64 756c  :..        modul
+000052f0: 6573 3a20 616e 6f74 6865 7220 6368 696c  es: another chil
+00005300: 6420 6c61 7965 7228 6d6f 6475 6c65 2920  d layer(module) 
+00005310: 696e 2069 742e 0d0a 2020 2020 2020 2020  in it...        
+00005320: 7061 7261 6d65 7465 7273 3a20 7468 6520  parameters: the 
+00005330: 7472 6169 6e61 626c 6520 7061 7261 6d65  trainable parame
+00005340: 7465 7273 2069 6e20 7468 6520 6c61 7965  ters in the laye
+00005350: 722e 0d0a 2020 2020 2020 2020 6275 6666  r...        buff
+00005360: 6572 733a 2074 6865 206f 7468 6572 206e  ers: the other n
+00005370: 6f6e 5f74 7261 696e 6162 6c65 2074 656e  on_trainable ten
+00005380: 736f 7220 696e 2074 6865 206c 6179 6572  sor in the layer
+00005390: 2e0d 0a0d 0a0d 0a20 2020 2041 7474 7269  .......    Attri
+000053a0: 6275 7465 7320 3a0d 0a20 2020 2020 2020  butes :..       
+000053b0: 2074 7261 696e 696e 6720 2862 6f6f 6c29   training (bool)
+000053c0: 3a20 4966 2054 7275 652c 206d 6561 6e73  : If True, means
+000053d0: 2069 6e20 7468 6520 7472 6169 6e69 6e67   in the training
+000053e0: 2070 6861 7365 2c20 656c 7365 2069 6e20   phase, else in 
+000053f0: 7468 6520 696e 6665 7220 6f72 2065 7661  the infer or eva
+00005400: 6c75 6174 696f 6e20 7068 6173 652e 0d0a  luation phase...
+00005410: 0d0a 2020 2020 2020 2020 7261 6e6b 2028  ..        rank (
+00005420: 696e 7429 3a20 5468 6520 6e75 6d62 6572  int): The number
+00005430: 206f 6620 7468 6520 7370 6174 6961 6c20   of the spatial 
+00005440: 7265 6c61 7465 6420 6178 6573 2e0d 0a0d  related axes....
+00005450: 0a20 2020 2020 2020 205f 6d6f 6475 6c65  .        _module
+00005460: 7320 284f 7264 6572 6564 4469 6374 2920  s (OrderedDict) 
+00005470: 3a20 7374 6f72 6167 6520 6f66 2061 6c6c  : storage of all
+00005480: 2074 6865 2073 7562 2d6d 6f64 756c 6573   the sub-modules
+00005490: 2e0d 0a0d 0a20 2020 2020 2020 205f 7061  .....        _pa
+000054a0: 7261 6d65 7465 7273 2028 4f72 6465 7265  rameters (Ordere
+000054b0: 6444 6963 7429 203a 2073 746f 7261 6765  dDict) : storage
+000054c0: 206f 6620 616c 6c20 7468 6520 7472 616e   of all the tran
+000054d0: 6162 6c65 2077 6569 6768 7473 2e0d 0a0d  able weights....
+000054e0: 0a20 2020 2020 2020 205f 6275 6666 6572  .        _buffer
+000054f0: 7320 284f 7264 6572 6564 4469 6374 2920  s (OrderedDict) 
+00005500: 3a20 7374 6f72 6167 6520 6f66 2061 6c6c  : storage of all
+00005510: 2074 6865 206e 6f6e 2d74 7261 696e 6162   the non-trainab
+00005520: 6c65 2074 656e 736f 722e 0d0a 0d0a 2020  le tensor.....  
+00005530: 2020 2020 2020 5f66 6f72 7761 7264 5f68        _forward_h
+00005540: 6f6f 6b73 2028 4f72 6465 7265 6444 6963  ooks (OrderedDic
+00005550: 7429 203a 2073 746f 7261 6765 206f 6620  t) : storage of 
+00005560: 616c 6c20 7468 6520 686f 6f6b 7320 7472  all the hooks tr
+00005570: 6967 6765 7265 6420 6265 666f 7265 2074  iggered before t
+00005580: 6865 2066 6f72 7761 7264 2065 7865 6375  he forward execu
+00005590: 7469 6f6e 2e0d 0a0d 0a20 2020 2020 2020  tion.....       
+000055a0: 205f 666f 7277 6172 645f 7072 655f 686f   _forward_pre_ho
+000055b0: 6f6b 7320 284f 7264 6572 6564 4469 6374  oks (OrderedDict
+000055c0: 2920 3a20 7374 6f72 6167 6520 6f66 2061  ) : storage of a
+000055d0: 6c6c 2074 6865 2068 6f6f 6b73 2074 7269  ll the hooks tri
+000055e0: 6767 6572 6564 2020 6166 7465 7220 7468  ggered  after th
+000055f0: 6520 666f 7277 6172 6420 6578 6563 7574  e forward execut
+00005600: 696f 6e2e 0d0a 0d0a 2020 2020 2020 2020  ion.....        
+00005610: 5f73 7461 7465 5f64 6963 745f 686f 6f6b  _state_dict_hook
+00005620: 7320 284f 7264 6572 6564 4469 6374 2920  s (OrderedDict) 
+00005630: 3a20 7374 6f72 6167 6520 6f66 2061 6c6c  : storage of all
+00005640: 2074 6865 2068 6f6f 6b73 2074 7269 6767   the hooks trigg
+00005650: 6572 6564 2020 7768 656e 2073 7461 7465  ered  when state
+00005660: 5f64 6963 7420 6765 6e65 7261 7469 6e67  _dict generating
+00005670: 2020 6578 6563 7574 696f 6e2e 0d0a 0d0a    execution.....
+00005680: 2020 2020 2020 2020 5f6c 6f61 645f 7374          _load_st
+00005690: 6174 655f 6469 6374 5f70 7265 5f68 6f6f  ate_dict_pre_hoo
+000056a0: 6b73 2028 4f72 6465 7265 6444 6963 7429  ks (OrderedDict)
+000056b0: 203a 2073 746f 7261 6765 206f 6620 616c   : storage of al
+000056c0: 6c20 7468 6520 686f 6f6b 7320 7472 6967  l the hooks trig
+000056d0: 6765 7265 6420 2077 6865 6e20 6c6f 6164  gered  when load
+000056e0: 696e 6720 7374 6174 655f 6469 6374 2020  ing state_dict  
+000056f0: 2065 7865 6375 7469 6f6e 2e0d 0a0d 0a20   execution..... 
+00005700: 2020 2020 2020 2069 6e70 7574 5f66 696c         input_fil
+00005710: 7465 7273 2028 696e 7429 3a20 696e 7075  ters (int): inpu
+00005720: 7420 6368 616e 6e65 6c73 0d0a 0d0a 2020  t channels....  
+00005730: 2020 2020 2020 7369 676e 6174 7572 6520        signature 
+00005740: 2869 6e74 293a 2074 6865 2066 756e 6374  (int): the funct
+00005750: 696f 6e20 7369 676e 6174 7572 6520 6f66  ion signature of
+00005760: 2074 6869 7320 6c61 7965 722e 0d0a 0d0a   this layer.....
+00005770: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00005780: 6e61 6d65 3a20 6465 6661 756c 745f 6e61  name: default_na
+00005790: 6d65 2069 7320 7468 6520 7361 6d65 2063  me is the same c
+000057a0: 6f6e 6365 7074 2061 7320 696e 206b 6572  oncept as in ker
+000057b0: 6173 2c20 6974 2063 6f6d 6573 2066 726f  as, it comes fro
+000057c0: 6d20 636c 6173 7320 6e61 6d65 2077 6974  m class name wit
+000057d0: 6820 7365 7175 656e 6365 206e 756d 6265  h sequence numbe
+000057e0: 722e 0d0a 0d0a 2020 2020 2020 2020 7265  r.....        re
+000057f0: 6c61 7469 7665 5f6e 616d 653a 7265 6c61  lative_name:rela
+00005800: 7469 7665 5f6e 616d 6520 6973 2074 6865  tive_name is the
+00005810: 2073 616d 6520 636f 6e63 6570 7420 6173   same concept as
+00005820: 206e 616d 6564 5f6d 6f64 756c 6573 2069   named_modules i
+00005830: 6e20 7079 746f 7263 682e 2042 7574 2069  n pytorch. But i
+00005840: 6e20 7079 746f 7263 682c 2079 6f75 206e  n pytorch, you n
+00005850: 6565 6420 746f 2067 6574 2074 6865 206e  eed to get the n
+00005860: 616d 6520 6672 6f6d 2067 656e 6572 6174  ame from generat
+00005870: 6f72 2065 6e75 6d65 7261 7469 6f6e 2e20  or enumeration. 
+00005880: 496e 2074 7269 6465 6e74 2c20 796f 7520  In trident, you 
+00005890: 6361 6e20 6163 6365 7373 2074 6865 2072  can access the r
+000058a0: 656c 6174 6976 6520 6e61 6d65 2020 7769  elative name  wi
+000058b0: 7468 2074 6869 7320 6174 7472 6962 7574  th this attribut
+000058c0: 652e 0d0a 0d0a 2020 2020 5265 6665 7265  e.....    Refere
+000058d0: 6e63 6573 3a0d 0a20 2020 2020 2020 2068  nces:..        h
+000058e0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000058f0: 6d2f 7465 6e73 6f72 666c 6f77 2f74 656e  m/tensorflow/ten
+00005900: 736f 7266 6c6f 772f 626c 6f62 2f76 322e  sorflow/blob/v2.
+00005910: 322e 302f 7465 6e73 6f72 666c 6f77 2f70  2.0/tensorflow/p
+00005920: 7974 686f 6e2f 6d6f 6475 6c65 2f6d 6f64  ython/module/mod
+00005930: 756c 652e 7079 234c 3335 2d4c 3239 310d  ule.py#L35-L291.
+00005940: 0a0d 0a0d 0a20 2020 2022 2222 0d0a 2020  .....    """..  
+00005950: 2020 5f76 6572 7369 6f6e 203d 2031 0d0a    _version = 1..
+00005960: 2020 2020 5f62 7569 6c74 3a20 626f 6f6c      _built: bool
+00005970: 0d0a 2020 2020 7472 6169 6e69 6e67 3a20  ..    training: 
+00005980: 626f 6f6c 0d0a 2020 2020 5f70 6172 616d  bool..    _param
+00005990: 6574 6572 733a 2044 6963 745b 7374 722c  eters: Dict[str,
+000059a0: 204f 7074 696f 6e61 6c5b 5061 7261 6d65   Optional[Parame
+000059b0: 7465 725d 5d0d 0a20 2020 205f 6275 6666  ter]]..    _buff
+000059c0: 6572 733a 2044 6963 745b 7374 722c 204f  ers: Dict[str, O
+000059d0: 7074 696f 6e61 6c5b 5465 6e73 6f72 5d5d  ptional[Tensor]]
+000059e0: 0d0a 2020 2020 5f6e 6f6e 5f70 6572 7369  ..    _non_persi
+000059f0: 7374 656e 745f 6275 6666 6572 735f 7365  stent_buffers_se
+00005a00: 743a 2053 6574 5b73 7472 5d0d 0a20 2020  t: Set[str]..   
+00005a10: 205f 6261 636b 7761 7264 5f70 7265 5f68   _backward_pre_h
+00005a20: 6f6f 6b73 3a20 4469 6374 5b69 6e74 2c20  ooks: Dict[int, 
+00005a30: 4361 6c6c 6162 6c65 5d0d 0a20 2020 205f  Callable]..    _
+00005a40: 6261 636b 7761 7264 5f68 6f6f 6b73 3a20  backward_hooks: 
+00005a50: 4469 6374 5b69 6e74 2c20 4361 6c6c 6162  Dict[int, Callab
+00005a60: 6c65 5d0d 0a20 2020 205f 6973 5f66 756c  le]..    _is_ful
+00005a70: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b3a  l_backward_hook:
+00005a80: 204f 7074 696f 6e61 6c5b 626f 6f6c 5d0d   Optional[bool].
+00005a90: 0a20 2020 205f 666f 7277 6172 645f 686f  .    _forward_ho
+00005aa0: 6f6b 733a 2044 6963 745b 696e 742c 2043  oks: Dict[int, C
+00005ab0: 616c 6c61 626c 655d 0d0a 2020 2020 2320  allable]..    # 
+00005ac0: 4d61 726b 7320 7768 6574 6865 7220 7468  Marks whether th
+00005ad0: 6520 636f 7272 6573 706f 6e64 696e 6720  e corresponding 
+00005ae0: 5f66 6f72 7761 7264 5f68 6f6f 6b73 2061  _forward_hooks a
+00005af0: 6363 6570 7420 6b77 6172 6773 206f 7220  ccept kwargs or 
+00005b00: 6e6f 742e 0d0a 2020 2020 2320 4173 204a  not...    # As J
+00005b10: 4954 2064 6f65 7320 6e6f 7420 7375 7070  IT does not supp
+00005b20: 6f72 7420 5365 745b 696e 745d 2c20 7468  ort Set[int], th
+00005b30: 6973 2064 6963 7420 6973 2075 7365 6420  is dict is used 
+00005b40: 6173 2061 2073 6574 2c20 7768 6572 6520  as a set, where 
+00005b50: 616c 6c0d 0a20 2020 2023 2068 6f6f 6b73  all..    # hooks
+00005b60: 2072 6570 7265 7365 6e74 6564 2069 6e20   represented in 
+00005b70: 7468 6973 2064 6963 7420 6163 6365 7074  this dict accept
+00005b80: 206b 7761 7267 732e 0d0a 2020 2020 5f66   kwargs...    _f
+00005b90: 6f72 7761 7264 5f68 6f6f 6b73 5f77 6974  orward_hooks_wit
+00005ba0: 685f 6b77 6172 6773 3a20 4469 6374 5b69  h_kwargs: Dict[i
+00005bb0: 6e74 2c20 626f 6f6c 5d0d 0a20 2020 205f  nt, bool]..    _
+00005bc0: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+00005bd0: 733a 2044 6963 745b 696e 742c 2043 616c  s: Dict[int, Cal
+00005be0: 6c61 626c 655d 0d0a 2020 2020 2320 4d61  lable]..    # Ma
+00005bf0: 726b 7320 7768 6574 6865 7220 7468 6520  rks whether the 
+00005c00: 636f 7272 6573 706f 6e64 696e 6720 5f66  corresponding _f
+00005c10: 6f72 7761 7264 5f68 6f6f 6b73 2061 6363  orward_hooks acc
+00005c20: 6570 7420 6b77 6172 6773 206f 7220 6e6f  ept kwargs or no
+00005c30: 742e 0d0a 2020 2020 2320 4173 204a 4954  t...    # As JIT
+00005c40: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+00005c50: 7420 5365 745b 696e 745d 2c20 7468 6973  t Set[int], this
+00005c60: 2064 6963 7420 6973 2075 7365 6420 6173   dict is used as
+00005c70: 2061 2073 6574 2c20 7768 6572 6520 616c   a set, where al
+00005c80: 6c0d 0a20 2020 2023 2068 6f6f 6b73 2072  l..    # hooks r
+00005c90: 6570 7265 7365 6e74 6564 2069 6e20 7468  epresented in th
+00005ca0: 6973 2064 6963 7420 6163 6365 7074 206b  is dict accept k
+00005cb0: 7761 7267 732e 0d0a 2020 2020 5f66 6f72  wargs...    _for
+00005cc0: 7761 7264 5f70 7265 5f68 6f6f 6b73 5f77  ward_pre_hooks_w
+00005cd0: 6974 685f 6b77 6172 6773 3a20 4469 6374  ith_kwargs: Dict
+00005ce0: 5b69 6e74 2c20 626f 6f6c 5d0d 0a20 2020  [int, bool]..   
+00005cf0: 205f 7374 6174 655f 6469 6374 5f68 6f6f   _state_dict_hoo
+00005d00: 6b73 3a20 4469 6374 5b69 6e74 2c20 4361  ks: Dict[int, Ca
+00005d10: 6c6c 6162 6c65 5d0d 0a20 2020 205f 6c6f  llable]..    _lo
+00005d20: 6164 5f73 7461 7465 5f64 6963 745f 7072  ad_state_dict_pr
+00005d30: 655f 686f 6f6b 733a 2044 6963 745b 696e  e_hooks: Dict[in
+00005d40: 742c 2043 616c 6c61 626c 655d 0d0a 2020  t, Callable]..  
+00005d50: 2020 5f73 7461 7465 5f64 6963 745f 7072    _state_dict_pr
+00005d60: 655f 686f 6f6b 733a 2044 6963 745b 696e  e_hooks: Dict[in
+00005d70: 742c 2043 616c 6c61 626c 655d 0d0a 2020  t, Callable]..  
+00005d80: 2020 5f6c 6f61 645f 7374 6174 655f 6469    _load_state_di
+00005d90: 6374 5f70 6f73 745f 686f 6f6b 733a 2044  ct_post_hooks: D
+00005da0: 6963 745b 696e 742c 2043 616c 6c61 626c  ict[int, Callabl
+00005db0: 655d 0d0a 2020 2020 5f6d 6f64 756c 6573  e]..    _modules
+00005dc0: 3a20 4469 6374 5b73 7472 2c20 4f70 7469  : Dict[str, Opti
+00005dd0: 6f6e 616c 5b27 4d6f 6475 6c65 275d 5d0d  onal['Module']].
+00005de0: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
+00005df0: 745f 5f28 7365 6c66 2c0d 0a20 2020 2020  t__(self,..     
+00005e00: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00005e10: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+00005e20: 2020 2020 2020 2020 206b 6565 705f 6f75           keep_ou
+00005e30: 7470 7574 3d46 616c 7365 2c0d 0a20 2020  tput=False,..   
+00005e40: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00005e50: 7669 6365 3d4e 6f6e 652c 0d0a 2020 2020  vice=None,..    
+00005e60: 2020 2020 2020 2020 2020 2020 2064 7479               dty
+00005e70: 7065 3d4e 6f6e 652c 0d0a 2020 2020 2020  pe=None,..      
+00005e80: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+00005e90: 7267 7329 3a0d 0a20 2020 2020 2020 2022  rgs):..        "
+00005ea0: 2222 0d0a 2020 2020 2020 2020 4172 6773  ""..        Args
+00005eb0: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
+00005ec0: 616d 6520 2873 7472 2920 3a6e 616d 6520  ame (str) :name 
+00005ed0: 6f66 2074 6865 206c 6179 6572 2e0d 0a20  of the layer... 
+00005ee0: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
+00005ef0: 6f75 7470 7574 2028 626f 6f6c 2920 3a77  output (bool) :w
+00005f00: 6865 7468 6572 2079 6f75 206e 6565 6420  hether you need 
+00005f10: 746f 206b 6570 7420 6f75 7470 7574 2074  to kept output t
+00005f20: 656e 736f 7220 696e 2065 7865 6375 7469  ensor in executi
+00005f30: 6f6e 2074 696d 652e 0d0a 0d0a 0d0a 2020  on time.......  
+00005f40: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00005f50: 2020 206f 626a 6563 742e 5f5f 7365 7461     object.__seta
+00005f60: 7474 725f 5f28 7365 6c66 2c20 2775 7569  ttr__(self, 'uui
+00005f70: 6427 2c20 7575 6964 2e75 7569 6434 2829  d', uuid.uuid4()
+00005f80: 2e6e 6f64 6529 0d0a 2020 2020 2020 2020  .node)..        
+00005f90: 7375 7065 7228 292e 5f5f 7365 7461 7474  super().__setatt
+00005fa0: 725f 5f28 2774 7261 696e 696e 6727 2c20  r__('training', 
+00005fb0: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+00005fc0: 7570 6572 2829 2e5f 5f73 6574 6174 7472  uper().__setattr
+00005fd0: 5f5f 2827 5f62 7569 6c74 272c 2046 616c  __('_built', Fal
+00005fe0: 7365 290d 0a0d 0a20 2020 2020 2020 2073  se)....        s
+00005ff0: 7570 6572 2829 2e5f 5f73 6574 6174 7472  uper().__setattr
+00006000: 5f5f 2827 5f70 6172 616d 6574 6572 7327  __('_parameters'
+00006010: 2c20 4f72 6465 7265 6444 6963 7428 2929  , OrderedDict())
+00006020: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
+00006030: 292e 5f5f 7365 7461 7474 725f 5f28 275f  ).__setattr__('_
+00006040: 6275 6666 6572 7327 2c20 4f72 6465 7265  buffers', Ordere
+00006050: 6444 6963 7428 2929 0d0a 2020 2020 2020  dDict())..      
+00006060: 2020 7375 7065 7228 292e 5f5f 7365 7461    super().__seta
+00006070: 7474 725f 5f28 275f 6e6f 6e5f 7065 7273  ttr__('_non_pers
+00006080: 6973 7465 6e74 5f62 7566 6665 7273 5f73  istent_buffers_s
+00006090: 6574 272c 2073 6574 2829 290d 0a20 2020  et', set())..   
+000060a0: 2020 2020 2073 7570 6572 2829 2e5f 5f73       super().__s
+000060b0: 6574 6174 7472 5f5f 2827 5f62 6163 6b77  etattr__('_backw
+000060c0: 6172 645f 7072 655f 686f 6f6b 7327 2c20  ard_pre_hooks', 
+000060d0: 4f72 6465 7265 6444 6963 7428 2929 0d0a  OrderedDict())..
+000060e0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+000060f0: 5f5f 7365 7461 7474 725f 5f28 275f 6261  __setattr__('_ba
+00006100: 636b 7761 7264 5f68 6f6f 6b73 272c 204f  ckward_hooks', O
+00006110: 7264 6572 6564 4469 6374 2829 290d 0a20  rderedDict()).. 
+00006120: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+00006130: 5f73 6574 6174 7472 5f5f 2827 5f69 735f  _setattr__('_is_
+00006140: 6675 6c6c 5f62 6163 6b77 6172 645f 686f  full_backward_ho
+00006150: 6f6b 272c 204e 6f6e 6529 0d0a 2020 2020  ok', None)..    
+00006160: 2020 2020 7375 7065 7228 292e 5f5f 7365      super().__se
+00006170: 7461 7474 725f 5f28 275f 666f 7277 6172  tattr__('_forwar
+00006180: 645f 686f 6f6b 7327 2c20 4f72 6465 7265  d_hooks', Ordere
+00006190: 6444 6963 7428 2929 0d0a 2020 2020 2020  dDict())..      
+000061a0: 2020 7375 7065 7228 292e 5f5f 7365 7461    super().__seta
+000061b0: 7474 725f 5f28 275f 666f 7277 6172 645f  ttr__('_forward_
+000061c0: 686f 6f6b 735f 7769 7468 5f6b 7761 7267  hooks_with_kwarg
+000061d0: 7327 2c20 4f72 6465 7265 6444 6963 7428  s', OrderedDict(
+000061e0: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
+000061f0: 7228 292e 5f5f 7365 7461 7474 725f 5f28  r().__setattr__(
+00006200: 275f 666f 7277 6172 645f 7072 655f 686f  '_forward_pre_ho
+00006210: 6f6b 7327 2c20 4f72 6465 7265 6444 6963  oks', OrderedDic
+00006220: 7428 2929 0d0a 2020 2020 2020 2020 7375  t())..        su
+00006230: 7065 7228 292e 5f5f 7365 7461 7474 725f  per().__setattr_
+00006240: 5f28 275f 666f 7277 6172 645f 7072 655f  _('_forward_pre_
+00006250: 686f 6f6b 735f 7769 7468 5f6b 7761 7267  hooks_with_kwarg
+00006260: 7327 2c20 4f72 6465 7265 6444 6963 7428  s', OrderedDict(
+00006270: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
+00006280: 7228 292e 5f5f 7365 7461 7474 725f 5f28  r().__setattr__(
+00006290: 275f 7374 6174 655f 6469 6374 5f68 6f6f  '_state_dict_hoo
+000062a0: 6b73 272c 204f 7264 6572 6564 4469 6374  ks', OrderedDict
+000062b0: 2829 290d 0a20 2020 2020 2020 2073 7570  ())..        sup
+000062c0: 6572 2829 2e5f 5f73 6574 6174 7472 5f5f  er().__setattr__
+000062d0: 2827 5f73 7461 7465 5f64 6963 745f 7072  ('_state_dict_pr
+000062e0: 655f 686f 6f6b 7327 2c20 4f72 6465 7265  e_hooks', Ordere
+000062f0: 6444 6963 7428 2929 0d0a 2020 2020 2020  dDict())..      
+00006300: 2020 7375 7065 7228 292e 5f5f 7365 7461    super().__seta
+00006310: 7474 725f 5f28 275f 6c6f 6164 5f73 7461  ttr__('_load_sta
+00006320: 7465 5f64 6963 745f 7072 655f 686f 6f6b  te_dict_pre_hook
+00006330: 7327 2c20 4f72 6465 7265 6444 6963 7428  s', OrderedDict(
+00006340: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
+00006350: 7228 292e 5f5f 7365 7461 7474 725f 5f28  r().__setattr__(
+00006360: 275f 6c6f 6164 5f73 7461 7465 5f64 6963  '_load_state_dic
+00006370: 745f 706f 7374 5f68 6f6f 6b73 272c 204f  t_post_hooks', O
+00006380: 7264 6572 6564 4469 6374 2829 290d 0a20  rderedDict()).. 
+00006390: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+000063a0: 5f73 6574 6174 7472 5f5f 2827 5f6d 6f64  _setattr__('_mod
+000063b0: 756c 6573 272c 204f 7264 6572 6564 4469  ules', OrderedDi
+000063c0: 6374 2829 290d 0a20 2020 2020 2020 2073  ct())..        s
+000063d0: 7570 6572 2829 2e5f 5f73 6574 6174 7472  uper().__setattr
+000063e0: 5f5f 2827 6661 6374 6f72 795f 6b77 6172  __('factory_kwar
+000063f0: 6773 272c 207b 2764 6576 6963 6527 3a20  gs', {'device': 
+00006400: 6765 745f 6465 7669 6365 2829 2c20 2764  get_device(), 'd
+00006410: 7479 7065 273a 2044 7479 7065 2e66 6c6f  type': Dtype.flo
+00006420: 6174 3332 7d29 0d0a 0d0a 0d0a 2020 2020  at32})......    
+00006430: 2020 2020 7072 6566 6978 203d 2073 656c      prefix = sel
+00006440: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
+00006450: 6d65 5f5f 0d0a 2020 2020 2020 2020 7365  me__..        se
+00006460: 6c66 2e5f 7569 645f 7072 6566 6978 7320  lf._uid_prefixs 
+00006470: 3d20 7b7d 0d0a 2020 2020 2020 2020 7365  = {}..        se
+00006480: 6c66 2e5f 6e61 6d65 203d 206e 616d 650d  lf._name = name.
+00006490: 0a20 2020 2020 2020 2073 656c 662e 6973  .        self.is
+000064a0: 5f72 6f6f 7420 3d20 5472 7565 0d0a 2020  _root = True..  
+000064b0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+000064c0: 6c74 5f6e 616d 6520 3d20 6361 6d65 6c32  lt_name = camel2
+000064d0: 736e 616b 6528 7072 6566 6978 2920 2b20  snake(prefix) + 
+000064e0: 275f 2720 2b20 7374 7228 6765 745f 676c  '_' + str(get_gl
+000064f0: 6f62 616c 5f75 6964 2863 616d 656c 3273  obal_uid(camel2s
+00006500: 6e61 6b65 2870 7265 6669 7829 2929 0d0a  nake(prefix)))..
+00006510: 2020 2020 2020 2020 7365 6c66 2e72 656c          self.rel
+00006520: 6174 6976 655f 6e61 6d65 203d 2027 270d  ative_name = ''.
+00006530: 0a20 2020 2020 2020 2072 6573 6574 5f6e  .        reset_n
+00006540: 616d 6528 7365 6c66 2c20 7365 6c66 2e5f  ame(self, self._
+00006550: 7569 645f 7072 6566 6978 7329 0d0a 0d0a  uid_prefixs)....
+00006560: 2020 2020 2020 2020 7375 7065 7228 4c61          super(La
+00006570: 7965 722c 2073 656c 6629 2e5f 5f69 6e69  yer, self).__ini
+00006580: 745f 5f28 290d 0a0d 0a20 2020 2020 2020  t__()....       
+00006590: 2073 656c 662e 6261 7463 685f 696e 6465   self.batch_inde
+000065a0: 7820 3d20 300d 0a20 2020 2020 2020 2073  x = 0..        s
+000065b0: 656c 662e 6669 6c74 6572 5f69 6e64 6578  elf.filter_index
+000065c0: 203d 202d 310d 0a0d 0a0d 0a20 2020 2020   = -1......     
+000065d0: 2020 2073 656c 662e 7261 6e6b 203d 206b     self.rank = k
+000065e0: 7761 7267 732e 6765 7428 2772 616e 6b27  wargs.get('rank'
+000065f0: 2c20 4e6f 6e65 290d 0a0d 0a20 2020 2020  , None)....     
+00006600: 2020 2073 656c 662e 5f6e 6f64 6573 203d     self._nodes =
+00006610: 204f 7264 6572 6564 4469 6374 2829 0d0a   OrderedDict()..
+00006620: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
+00006630: 7075 745f 7368 6170 653a 204f 7074 696f  put_shape: Optio
+00006640: 6e61 6c5b 4e6f 6e65 2c20 5465 6e73 6f72  nal[None, Tensor
+00006650: 5368 6170 652c 204c 6973 745b 5465 6e73  Shape, List[Tens
+00006660: 6f72 5368 6170 655d 5d20 3d20 4e6f 6e65  orShape]] = None
+00006670: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00006680: 6f75 7470 7574 5f73 6861 7065 3a20 4f70  output_shape: Op
+00006690: 7469 6f6e 616c 5b4e 6f6e 652c 2054 656e  tional[None, Ten
+000066a0: 736f 7253 6861 7065 2c20 4c69 7374 5b54  sorShape, List[T
+000066b0: 656e 736f 7253 6861 7065 5d5d 203d 204e  ensorShape]] = N
+000066c0: 6f6e 650d 0a0d 0a20 2020 2020 2020 2077  one....        w
+000066d0: 6974 6820 7365 6c66 2e6e 616d 655f 7363  ith self.name_sc
+000066e0: 6f70 653a 0d0a 0d0a 2020 2020 2020 2020  ope:....        
+000066f0: 2020 2020 7365 6c66 2e5f 696e 7075 745f      self._input_
+00006700: 7368 6170 6520 3d20 4e6f 6e65 0d0a 2020  shape = None..  
+00006710: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00006720: 6f75 7470 7574 5f73 6861 7065 203d 204e  output_shape = N
+00006730: 6f6e 650d 0a0d 0a20 2020 2020 2020 2020  one....         
+00006740: 2020 2073 656c 662e 696e 7075 745f 6669     self.input_fi
+00006750: 6c74 6572 7320 3d20 4e6f 6e65 0d0a 2020  lters = None..  
+00006760: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00006770: 6e70 7574 5f73 7065 6320 3d20 4e6f 6e65  nput_spec = None
+00006780: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00006790: 7365 6c66 2e6b 6565 705f 6f75 7470 7574  self.keep_output
+000067a0: 203d 206b 6565 705f 6f75 7470 7574 0d0a   = keep_output..
+000067b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000067c0: 2e5f 6f75 7470 7574 5f74 656e 736f 7220  ._output_tensor 
+000067d0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000067e0: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
+000067f0: 7572 6520 3d20 4e6f 6e65 0d0a 0d0a 2020  ure = None....  
+00006800: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00006810: 756d 705f 7061 7463 6865 7320 3d20 5472  ump_patches = Tr
+00006820: 7565 0d0a 0d0a 0d0a 0d0a 2020 2020 2320  ue........    # 
+00006830: 5472 6963 6b20 6d79 7079 2069 6e74 6f20  Trick mypy into 
+00006840: 6e6f 7420 6170 706c 7969 6e67 2063 6f6e  not applying con
+00006850: 7472 6176 6172 6961 6e63 6520 7275 6c65  travariance rule
+00006860: 7320 746f 2069 6e70 7574 7320 6279 2064  s to inputs by d
+00006870: 6566 696e 696e 670d 0a20 2020 2023 2066  efining..    # f
+00006880: 6f72 7761 7264 2061 7320 6120 7661 6c75  orward as a valu
+00006890: 652c 2072 6174 6865 7220 7468 616e 2061  e, rather than a
+000068a0: 2066 756e 6374 696f 6e2e 2020 5365 6520   function.  See 
+000068b0: 616c 736f 0d0a 2020 2020 2320 6874 7470  also..    # http
+000068c0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
+000068d0: 7974 686f 6e2f 6d79 7079 2f69 7373 7565  ython/mypy/issue
+000068e0: 732f 3837 3935 0d0a 2020 2020 666f 7277  s/8795..    forw
+000068f0: 6172 643a 2043 616c 6c61 626c 655b 2e2e  ard: Callable[..
+00006900: 2e2c 2041 6e79 5d20 3d20 5f66 6f72 7761  ., Any] = _forwa
+00006910: 7264 5f75 6e69 6d70 6c65 6d65 6e74 6564  rd_unimplemented
+00006920: 0d0a 0d0a 2020 2020 2320 6465 6620 666f  ....    # def fo
+00006930: 7277 6172 6428 7365 6c66 2c20 2a69 6e70  rward(self, *inp
+00006940: 7574 2c20 2a2a 6b77 6172 6773 293a 0d0a  ut, **kwargs):..
+00006950: 2020 2020 2320 2020 2020 7261 6973 6520      #     raise 
+00006960: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+00006970: 726f 720d 0a0d 0a20 2020 2064 6566 2067  ror....    def g
+00006980: 6574 5f72 6f6f 7428 7365 6c66 293a 0d0a  et_root(self):..
+00006990: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
+000069a0: 6173 6174 7472 2873 656c 662c 2027 5f6e  asattr(self, '_n
+000069b0: 6f64 6573 2729 206f 7220 7365 6c66 2e5f  odes') or self._
+000069c0: 6e6f 6465 7320 6973 204e 6f6e 653a 0d0a  nodes is None:..
+000069d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000069e0: 2e69 735f 726f 6f74 203d 2054 7275 650d  .is_root = True.
+000069f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00006a00: 7572 6e20 7365 6c66 0d0a 2020 2020 2020  urn self..      
+00006a10: 2020 656c 6966 206c 656e 2873 656c 662e    elif len(self.
+00006a20: 5f6e 6f64 6573 2920 3e20 3020 616e 6420  _nodes) > 0 and 
+00006a30: 7365 6c66 2e5f 6e6f 6465 732e 7661 6c75  self._nodes.valu
+00006a40: 655f 6c69 7374 5b30 5d2e 6973 5f72 6f6f  e_list[0].is_roo
+00006a50: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00006a60: 7265 7475 726e 2073 656c 662e 5f6e 6f64  return self._nod
+00006a70: 6573 2e76 616c 7565 5f6c 6973 745b 305d  es.value_list[0]
+00006a80: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00006a90: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00006aa0: 206e 616d 652c 206e 6f64 6520 696e 2073   name, node in s
+00006ab0: 656c 662e 5f6e 6f64 6573 2e69 7465 6d5f  elf._nodes.item_
+00006ac0: 6c69 7374 3a0d 0a20 2020 2020 2020 2020  list:..         
+00006ad0: 2020 2020 2020 2069 6620 6e6f 6465 2e69         if node.i
+00006ae0: 735f 726f 6f74 3a0d 0a20 2020 2020 2020  s_root:..       
+00006af0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00006b00: 7572 6e20 6e6f 6465 0d0a 2020 2020 2020  urn node..      
+00006b10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00006b20: 660d 0a0d 0a20 2020 2040 7072 6f70 6572  f....    @proper
+00006b30: 7479 0d0a 2020 2020 6465 6620 6e61 6d65  ty..    def name
+00006b40: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00006b50: 2022 2222 4e61 6d65 206f 6620 7468 6520   """Name of the 
+00006b60: 6c61 7965 7220 2873 7472 696e 6729 2c20  layer (string), 
+00006b70: 7365 7420 696e 2074 6865 2063 6f6e 7374  set in the const
+00006b80: 7275 6374 6f72 2e22 2222 0d0a 2020 2020  ructor."""..    
+00006b90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00006ba0: 5f6e 616d 650d 0a0d 0a20 2020 2040 6e61  _name....    @na
+00006bb0: 6d65 2e73 6574 7465 720d 0a20 2020 2064  me.setter..    d
+00006bc0: 6566 206e 616d 6528 7365 6c66 2c20 7661  ef name(self, va
+00006bd0: 6c75 6529 3a0d 0a20 2020 2020 2020 2073  lue):..        s
+00006be0: 656c 662e 5f6e 616d 6520 3d20 7661 6c75  elf._name = valu
+00006bf0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00006c00: 7570 6461 7465 5f6e 616d 655f 7363 6f70  update_name_scop
+00006c10: 6528 7365 6c66 2e6e 616d 6529 0d0a 0d0a  e(self.name)....
+00006c20: 2020 2020 2320 6465 6620 5f73 6574 5f6e      # def _set_n
+00006c30: 616d 655f 7363 6f70 6528 7365 6c66 293a  ame_scope(self):
+00006c40: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+00006c50: 5f6e 616d 655f 7363 6f70 6528 7365 6c66  _name_scope(self
+00006c60: 2c20 6e61 6d65 293a 0d0a 2020 2020 2020  , name):..      
+00006c70: 2020 7365 6c66 2e5f 6e61 6d65 203d 206e    self._name = n
+00006c80: 616d 650d 0a20 2020 2020 2020 2077 6974  ame..        wit
+00006c90: 6820 6f70 732e 6e61 6d65 5f73 636f 7065  h ops.name_scope
+00006ca0: 5f76 3228 6e61 6d65 2920 6173 2073 636f  _v2(name) as sco
+00006cb0: 7065 5f6e 616d 653a 0d0a 2020 2020 2020  pe_name:..      
+00006cc0: 2020 2020 2020 7365 6c66 2e5f 6e61 6d65        self._name
+00006cd0: 5f73 636f 7065 203d 206f 7073 2e6e 616d  _scope = ops.nam
+00006ce0: 655f 7363 6f70 655f 7632 2873 636f 7065  e_scope_v2(scope
+00006cf0: 5f6e 616d 6529 0d0a 0d0a 2020 2020 4070  _name)....    @p
+00006d00: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+00006d10: 206e 6f64 6573 2873 656c 6629 3a0d 0a20   nodes(self):.. 
+00006d20: 2020 2020 2020 2022 2222 5468 6520 7768         """The wh
+00006d30: 6f6c 6520 7472 6565 2073 7472 7563 7475  ole tree structu
+00006d40: 7265 6420 4f72 6465 7265 6444 6963 7420  red OrderedDict 
+00006d50: 7b20 7575 6964 203a 206d 6f64 756c 6520  { uuid : module 
+00006d60: 7d20 2c20 666f 7220 6d6f 6475 6c65 2074  } , for module t
+00006d70: 6f20 6163 6365 7373 2061 6e79 206e 6f64  o access any nod
+00006d80: 6520 696e 2074 6869 7320 7374 7275 6374  e in this struct
+00006d90: 7572 6573 2c20 6578 2e20 5368 6f72 7463  ures, ex. Shortc
+00006da0: 7574 2222 220d 0a20 2020 2020 2020 2072  ut"""..        r
+00006db0: 6574 7572 6e20 7365 6c66 2e5f 6e6f 6465  eturn self._node
+00006dc0: 730d 0a0d 0a20 2020 2040 6e6f 6465 732e  s....    @nodes.
+00006dd0: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
+00006de0: 6e6f 6465 7328 7365 6c66 2c20 7661 6c75  nodes(self, valu
+00006df0: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
+00006e00: 7365 6c66 2e5f 6e6f 6465 7320 213d 2076  self._nodes != v
+00006e10: 616c 7565 3a0d 0a20 2020 2020 2020 2020  alue:..         
+00006e20: 2020 2073 656c 662e 5f6e 6f64 6573 203d     self._nodes =
+00006e30: 2076 616c 7565 0d0a 2020 2020 2020 2020   value..        
+00006e40: 2020 2020 666f 7220 6d6f 6420 696e 2073      for mod in s
+00006e50: 656c 662e 6d6f 6475 6c65 7328 293a 0d0a  elf.modules():..
+00006e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e70: 6d6f 642e 5f6e 6f64 6573 203d 2076 616c  mod._nodes = val
+00006e80: 7565 0d0a 0d0a 2020 2020 6465 6620 6164  ue....    def ad
+00006e90: 645f 6d6f 6475 6c65 2873 656c 662c 2020  d_module(self,  
+00006ea0: 6e61 6d65 3a20 7374 722c 206d 6f64 756c  name: str, modul
+00006eb0: 653a 204f 7074 696f 6e61 6c5b 274d 6f64  e: Optional['Mod
+00006ec0: 756c 6527 5d29 202d 3e20 4e6f 6e65 3a0d  ule']) -> None:.
+00006ed0: 0a20 2020 2020 2020 2022 2222 4164 6473  .        """Adds
+00006ee0: 2061 2063 6869 6c64 206d 6f64 756c 6520   a child module 
+00006ef0: 746f 2074 6865 2063 7572 7265 6e74 206d  to the current m
+00006f00: 6f64 756c 652e 0d0a 0d0a 2020 2020 2020  odule.....      
+00006f10: 2020 5468 6520 6d6f 6475 6c65 2063 616e    The module can
+00006f20: 2062 6520 6163 6365 7373 6564 2061 7320   be accessed as 
+00006f30: 616e 2061 7474 7269 6275 7465 2075 7369  an attribute usi
+00006f40: 6e67 2074 6865 2067 6976 656e 206e 616d  ng the given nam
+00006f50: 652e 0d0a 2020 2020 2020 2020 3129 2061  e...        1) a
+00006f60: 6464 206d 6f64 756c 6520 6173 2063 6869  dd module as chi
+00006f70: 6c64 0d0a 2020 2020 2020 2020 3229 2067  ld..        2) g
+00006f80: 656e 6572 6174 6520 6465 6661 756c 745f  enerate default_
+00006f90: 6e61 6d65 2061 6e64 2072 656c 6174 6976  name and relativ
+00006fa0: 655f 6e61 6d65 0d0a 2020 2020 2020 2020  e_name..        
+00006fb0: 3329 2075 7064 6174 6520 7468 6520 6e6f  3) update the no
+00006fc0: 6465 730d 0a0d 0a20 2020 2020 2020 2041  des....        A
+00006fd0: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+00006fe0: 2020 6e61 6d65 2028 7374 7269 6e67 293a    name (string):
+00006ff0: 206e 616d 6520 6f66 2074 6865 2063 6869   name of the chi
+00007000: 6c64 206d 6f64 756c 652e 2054 6865 2063  ld module. The c
+00007010: 6869 6c64 206d 6f64 756c 6520 6361 6e20  hild module can 
+00007020: 6265 0d0a 2020 2020 2020 2020 2020 2020  be..            
+00007030: 2020 2020 6163 6365 7373 6564 2066 726f      accessed fro
+00007040: 6d20 7468 6973 206d 6f64 756c 6520 7573  m this module us
+00007050: 696e 6720 7468 6520 6769 7665 6e20 6e61  ing the given na
+00007060: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+00007070: 6d6f 6475 6c65 2028 4d6f 6475 6c65 293a  module (Module):
+00007080: 2063 6869 6c64 206d 6f64 756c 6520 746f   child module to
+00007090: 2062 6520 6164 6465 6420 746f 2074 6865   be added to the
+000070a0: 206d 6f64 756c 652e 0d0a 0d0a 2020 2020   module.....    
+000070b0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+000070c0: 2069 6620 6e61 6d65 2069 7320 4e6f 6e65   if name is None
+000070d0: 206f 7220 6c65 6e28 6e61 6d65 2920 3d3d   or len(name) ==
+000070e0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+000070f0: 206e 616d 6520 3d20 6d6f 6475 6c65 2e5f   name = module._
+00007100: 6e61 6d65 0d0a 0d0a 2020 2020 2020 2020  name....        
+00007110: 6966 206d 6f64 756c 6520 6973 204e 6f6e  if module is Non
+00007120: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00007130: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
+00007140: 6d6f 6475 6c65 2020 6361 6e27 7420 6265  module  can't be
+00007150: 204e 6f6e 6522 290d 0a20 2020 2020 2020   None")..       
+00007160: 2065 6c69 6620 6e6f 7420 6973 696e 7374   elif not isinst
+00007170: 616e 6365 286e 616d 652c 2073 7472 293a  ance(name, str):
+00007180: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00007190: 6973 6520 5479 7065 4572 726f 7228 226d  ise TypeError("m
+000071a0: 6f64 756c 6520 6e61 6d65 2073 686f 756c  odule name shoul
+000071b0: 6420 6265 2061 2073 7472 696e 672e 2047  d be a string. G
+000071c0: 6f74 207b 7d22 2e66 6f72 6d61 7428 7479  ot {}".format(ty
+000071d0: 7065 286e 616d 6529 2e5f 5f6e 616d 655f  pe(name).__name_
+000071e0: 5f29 290d 0a20 2020 2020 2020 2065 6c69  _))..        eli
+000071f0: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
+00007200: 6e61 6d65 2920 616e 6420 6e61 6d65 206e  name) and name n
+00007210: 6f74 2069 6e20 7365 6c66 2e5f 6d6f 6475  ot in self._modu
+00007220: 6c65 733a 0d0a 2020 2020 2020 2020 2020  les:..          
+00007230: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
+00007240: 2822 6174 7472 6962 7574 6520 277b 7d27  ("attribute '{}'
+00007250: 2061 6c72 6561 6479 2065 7869 7374 7322   already exists"
+00007260: 2e66 6f72 6d61 7428 6e61 6d65 2929 0d0a  .format(name))..
+00007270: 2020 2020 2020 2020 656c 6966 2027 2e27          elif '.'
+00007280: 2069 6e20 6e61 6d65 3a0d 0a20 2020 2020   in name:..     
+00007290: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
+000072a0: 4572 726f 7228 226d 6f64 756c 6520 6e61  Error("module na
+000072b0: 6d65 2063 616e 2774 2063 6f6e 7461 696e  me can't contain
+000072c0: 205c 222e 5c22 2229 0d0a 2020 2020 2020   \".\"")..      
+000072d0: 2020 656c 6966 206e 616d 6520 3d3d 2027    elif name == '
+000072e0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+000072f0: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
+00007300: 6d6f 6475 6c65 206e 616d 6520 6361 6e27  module name can'
+00007310: 7420 6265 2065 6d70 7479 2073 7472 696e  t be empty strin
+00007320: 6720 5c22 5c22 2229 0d0a 0d0a 2020 2020  g \"\"")....    
+00007330: 2020 2020 7365 6c66 2e5f 6d6f 6475 6c65      self._module
+00007340: 735b 6e61 6d65 5d20 3d20 6d6f 6475 6c65  s[name] = module
+00007350: 0d0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
+00007360: 6f64 6573 203d 204f 7264 6572 6564 4469  odes = OrderedDi
+00007370: 6374 285b 286d 6f64 2e75 7569 642c 206d  ct([(mod.uuid, m
+00007380: 6f64 2920 666f 7220 6d6f 6420 696e 206c  od) for mod in l
+00007390: 6973 7428 7365 6c66 2e6d 6f64 756c 6573  ist(self.modules
+000073a0: 2829 2920 6966 2069 7369 6e73 7461 6e63  ()) if isinstanc
+000073b0: 6528 6d6f 642c 204c 6179 6572 295d 290d  e(mod, Layer)]).
+000073c0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+000073d0: 7374 616e 6365 286d 6f64 756c 652c 204c  stance(module, L
+000073e0: 6179 6572 293a 0d0a 2020 2020 2020 2020  ayer):..        
+000073f0: 2020 2020 666f 7220 6d6f 6420 696e 206d      for mod in m
+00007400: 6f64 756c 652e 6d6f 6475 6c65 7328 293a  odule.modules():
+00007410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007420: 2020 6d6f 642e 6e6f 6465 7320 3d20 7365    mod.nodes = se
+00007430: 6c66 2e6e 6f64 6573 0d0a 2020 2020 2020  lf.nodes..      
+00007440: 2020 2020 2020 2020 2020 6d6f 642e 6973            mod.is
+00007450: 5f72 6f6f 7420 3d20 4661 6c73 650d 0a20  _root = False.. 
+00007460: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00007470: 6573 6574 5f6e 616d 6528 6d6f 642c 2073  eset_name(mod, s
+00007480: 656c 662e 5f75 6964 5f70 7265 6669 7873  elf._uid_prefixs
+00007490: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000074a0: 2020 206d 6f64 2e72 656c 6174 6976 655f     mod.relative_
+000074b0: 6e61 6d65 203d 206e 616d 6520 6966 206d  name = name if m
+000074c0: 6f64 2e72 656c 6174 6976 655f 6e61 6d65  od.relative_name
+000074d0: 203d 3d20 2727 2065 6c73 6520 6e61 6d65   == '' else name
+000074e0: 202b 2027 2e27 202b 206d 6f64 2e72 656c   + '.' + mod.rel
+000074f0: 6174 6976 655f 6e61 6d65 0d0a 0d0a 2020  ative_name....  
+00007500: 2020 2020 2020 2320 656c 6966 2069 6e73        # elif ins
+00007510: 7065 6374 2e69 7366 756e 6374 696f 6e28  pect.isfunction(
+00007520: 6d6f 6475 6c65 2920 6f72 2063 616c 6c61  module) or calla
+00007530: 626c 6528 6d6f 6475 6c65 293a 0d0a 2020  ble(module):..  
+00007540: 2020 2020 2020 2320 2020 2020 6d6f 6475        #     modu
+00007550: 6c65 2e5f 5f6e 616d 655f 5f20 3d20 6e61  le.__name__ = na
+00007560: 6d65 0d0a 2020 2020 2020 2020 2320 2020  me..        #   
+00007570: 2020 7365 6c66 2e5f 6d6f 6475 6c65 735b    self._modules[
+00007580: 6e61 6d65 5d20 3d20 6d6f 6475 6c65 0d0a  name] = module..
+00007590: 0d0a 2020 2020 6465 6620 6164 6428 7365  ..    def add(se
+000075a0: 6c66 2c20 6d6f 6475 6c65 293a 0d0a 2020  lf, module):..  
+000075b0: 2020 2020 2020 2222 2253 696d 706c 6966        """Simplif
+000075c0: 6965 6420 2761 6464 5f6d 6f64 756c 6527  ied 'add_module'
+000075d0: 0d0a 0d0a 2020 2020 2020 2020 5573 6520  ....        Use 
+000075e0: 7468 6520 636f 756e 7420 6f66 2063 6869  the count of chi
+000075f0: 6c64 206d 6f64 756c 6573 2061 7320 7468  ld modules as th
+00007600: 6520 6465 6661 756c 7420 6e61 6d65 2e0d  e default name..
+00007610: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00007620: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00007630: 6475 6c65 2028 4d6f 6475 6c65 293a 2063  dule (Module): c
+00007640: 6869 6c64 206d 6f64 756c 6520 746f 2062  hild module to b
+00007650: 6520 6164 6465 6420 746f 2074 6865 206d  e added to the m
+00007660: 6f64 756c 652e 0d0a 0d0a 2020 2020 2020  odule.....      
+00007670: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+00007680: 6620 6d6f 6475 6c65 2069 7320 4e6f 6e65  f module is None
+00007690: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000076a0: 6169 7365 204b 6579 4572 726f 7228 226d  aise KeyError("m
+000076b0: 6f64 756c 6520 2063 616e 2774 2062 6520  odule  can't be 
+000076c0: 4e6f 6e65 2229 0d0a 2020 2020 2020 2020  None")..        
+000076d0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+000076e0: 6d6f 6475 6c65 2c20 4c61 7965 7229 3a0d  module, Layer):.
+000076f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007700: 662e 6164 645f 6d6f 6475 6c65 2873 7472  f.add_module(str
+00007710: 286c 656e 2873 656c 662e 5f6d 6f64 756c  (len(self._modul
+00007720: 6573 2929 2c0d 0a20 2020 2020 2020 2020  es)),..         
+00007730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007740: 2020 206d 6f64 756c 6529 2020 2320 7365     module)  # se
+00007750: 6c66 2e6e 6f64 6573 203d 206e 6f64 6573  lf.nodes = nodes
+00007760: 2020 2320 666f 7220 6d6f 6420 696e 2073    # for mod in s
+00007770: 656c 662e 6d6f 6475 6c65 7328 293a 2020  elf.modules():  
+00007780: 2320 2020 2020 6d6f 642e 6e6f 6465 7320  #     mod.nodes 
+00007790: 3d20 6e6f 6465 730d 0a0d 0a20 2020 2020  = nodes....     
+000077a0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000077b0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000077c0: 6545 7272 6f72 2827 4e6f 7420 7661 6c69  eError('Not vali
+000077d0: 6420 6d6f 6475 6c65 2729 0d0a 0d0a 2020  d module')....  
+000077e0: 2020 6465 6620 6275 696c 6428 7365 6c66    def build(self
+000077f0: 2c20 2a69 6e70 7574 5f73 6861 7065 3a20  , *input_shape: 
+00007800: 5465 6e73 6f72 5368 6170 6529 3a0d 0a20  TensorShape):.. 
+00007810: 2020 2020 2020 2022 2222 2044 6f20 7468         """ Do th
+00007820: 6520 7368 6170 6520 696e 6665 7265 6e63  e shape inferenc
+00007830: 6520 616e 6420 696e 6974 6961 6c69 7a65  e and initialize
+00007840: 2077 6569 6768 7473 2061 6e64 2062 6961   weights and bia
+00007850: 732e 0d0a 0d0a 2020 2020 2020 2020 6062  s.....        `b
+00007860: 7569 6c64 2720 6973 2061 206b 6579 206d  uild' is a key m
+00007870: 6574 686f 6420 696e 2074 7269 6465 6e74  ethod in trident
+00007880: 2c20 796f 7520 6361 6e20 7573 6520 2070  , you can use  p
+00007890: 726f 7065 7274 7920 6062 7569 6c74 2720  roperty `built' 
+000078a0: 746f 2063 6865 636b 2077 6865 7468 6572  to check whether
+000078b0: 2074 6865 206c 6179 6572 2064 6f20 7468   the layer do th
+000078c0: 6520 6275 696c 6420 7072 6f63 6573 732e  e build process.
+000078d0: 0d0a 2020 2020 2020 2020 496e 2062 7569  ..        In bui
+000078e0: 6c64 2720 2c20 7765 206e 6565 6420 746f  ld' , we need to
+000078f0: 2070 7574 2061 6c6c 2074 6865 206c 6f67   put all the log
+00007900: 6963 7320 6162 6f75 7420 2068 6f77 2074  ics about  how t
+00007910: 6f20 636f 6d66 6972 6d20 7468 6520 7368  o comfirm the sh
+00007920: 6170 6520 6f66 206f 7574 7075 7473 2c20  ape of outputs, 
+00007930: 7765 6967 6874 7320 616e 6420 6269 6173  weights and bias
+00007940: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+00007950: 6520 636f 6d69 6e67 2069 6e70 7574 2074  e coming input t
+00007960: 656e 736f 722e 0d0a 0d0a 2020 2020 2020  ensor.....      
+00007970: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+00007980: 2020 2020 2069 6e70 7574 5f73 6861 7065       input_shape
+00007990: 2028 7465 6e73 6f72 293a 2020 7468 6520   (tensor):  the 
+000079a0: 7368 6170 6520 7265 7072 6573 656e 7461  shape representa
+000079b0: 7469 6f6e 2065 7863 6c75 6465 2074 6865  tion exclude the
+000079c0: 2062 6174 6368 2061 7869 732e 0d0a 0d0a   batch axis.....
+000079d0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+000079e0: 2020 2020 2070 6173 730d 0a0d 0a20 2020       pass....   
+000079f0: 2064 6566 2072 6562 7569 6c64 2873 656c   def rebuild(sel
+00007a00: 662c 202a 696e 7075 745f 7368 6170 653a  f, *input_shape:
+00007a10: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
+00007a20: 2020 2020 2020 2020 2222 2220 446f 2074          """ Do t
+00007a30: 6865 2073 6861 7065 2069 6e66 6572 656e  he shape inferen
+00007a40: 6365 2061 6e64 2069 6e69 7469 616c 697a  ce and initializ
+00007a50: 6520 7765 6967 6874 7320 616e 6420 6269  e weights and bi
+00007a60: 6173 2e0d 0a0d 0a20 2020 2020 2020 2060  as.....        `
+00007a70: 6275 696c 6427 2069 7320 6120 6b65 7920  build' is a key 
+00007a80: 6d65 7468 6f64 2069 6e20 7472 6964 656e  method in triden
+00007a90: 742c 2079 6f75 2063 616e 2075 7365 2020  t, you can use  
+00007aa0: 7072 6f70 6572 7479 2060 6275 696c 7427  property `built'
+00007ab0: 2074 6f20 6368 6563 6b20 7768 6574 6865   to check whethe
+00007ac0: 7220 7468 6520 6c61 7965 7220 646f 2074  r the layer do t
+00007ad0: 6865 2062 7569 6c64 2070 726f 6365 7373  he build process
+00007ae0: 2e0d 0a20 2020 2020 2020 2049 6e20 6275  ...        In bu
+00007af0: 696c 6427 202c 2077 6520 6e65 6564 2074  ild' , we need t
+00007b00: 6f20 7075 7420 616c 6c20 7468 6520 6c6f  o put all the lo
+00007b10: 6769 6373 2061 626f 7574 2020 686f 7720  gics about  how 
+00007b20: 746f 2063 6f6d 6669 726d 2074 6865 2073  to comfirm the s
+00007b30: 6861 7065 206f 6620 6f75 7470 7574 732c  hape of outputs,
+00007b40: 2077 6569 6768 7473 2061 6e64 2062 6961   weights and bia
+00007b50: 7320 6163 636f 7264 696e 6720 746f 2074  s according to t
+00007b60: 6865 2063 6f6d 696e 6720 696e 7075 7420  he coming input 
+00007b70: 7465 6e73 6f72 2e0d 0a0d 0a20 2020 2020  tensor.....     
+00007b80: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+00007b90: 2020 2020 2020 696e 7075 745f 7368 6170        input_shap
+00007ba0: 6520 2874 656e 736f 7229 3a20 2074 6865  e (tensor):  the
+00007bb0: 2073 6861 7065 2072 6570 7265 7365 6e74   shape represent
+00007bc0: 6174 696f 6e20 6578 636c 7564 6520 7468  ation exclude th
+00007bd0: 6520 6261 7463 6820 6178 6973 2e0d 0a0d  e batch axis....
+00007be0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00007bf0: 2020 2020 2020 7072 696e 7428 0d0a 2020        print(..  
+00007c00: 2020 2020 2020 2020 2020 2759 6f75 7220            'Your 
+00007c10: 6d6f 6465 6c20 7769 6c6c 2073 7461 7274  model will start
+00007c20: 2074 6f20 7265 6275 696c 642c 2069 7420   to rebuild, it 
+00007c30: 7769 6c6c 2063 6175 7365 206c 6f73 7420  will cause lost 
+00007c40: 616c 6c20 6578 6973 7469 6e67 2074 7261  all existing tra
+00007c50: 696e 6162 6c65 2070 6172 616d 6574 6572  inable parameter
+00007c60: 732c 2077 696c 6c20 796f 7520 7761 6e74  s, will you want
+00007c70: 2074 6f20 7265 6275 696c 6420 6974 3f27   to rebuild it?'
+00007c80: 290d 0a20 2020 2020 2020 2061 6e73 203d  )..        ans =
+00007c90: 2069 6e70 7574 2827 2859 2f4e 2920 3c3c   input('(Y/N) <<
+00007ca0: 2027 292e 6c6f 7765 7228 290d 0a20 2020   ').lower()..   
+00007cb0: 2020 2020 2069 6620 616e 7320 696e 205b       if ans in [
+00007cc0: 2779 6573 272c 2027 7927 5d3a 0d0a 2020  'yes', 'y']:..  
+00007cd0: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
+00007ce0: 6d65 2c20 6d6f 6475 6c65 2069 6e20 7365  me, module in se
+00007cf0: 6c66 2e6e 616d 6564 5f6d 6f64 756c 6573  lf.named_modules
+00007d00: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00007d10: 2020 2020 2069 6620 6d6f 6475 6c65 2e74       if module.t
+00007d20: 7261 696e 6162 6c65 3a0d 0a20 2020 2020  rainable:..     
+00007d30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007d40: 6f64 756c 652e 5f69 6e70 7574 5f73 6861  odule._input_sha
+00007d50: 7065 203d 204e 6f6e 650d 0a20 2020 2020  pe = None..     
+00007d60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007d70: 6f64 756c 652e 5f6f 7574 7075 745f 7368  odule._output_sh
+00007d80: 6170 6520 3d20 4e6f 6e65 0d0a 2020 2020  ape = None..    
+00007d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007da0: 6d6f 6475 6c65 2e5f 6275 696c 7420 3d20  module._built = 
+00007db0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00007dc0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+00007dd0: 652e 5f70 6172 616d 6574 6572 7320 3d20  e._parameters = 
+00007de0: 4f72 6465 7265 6444 6963 7428 290d 0a20  OrderedDict().. 
+00007df0: 2020 2020 2020 2020 2020 2064 756d 6d61             dumma
+00007e00: 795f 696e 7075 7420 3d20 746f 5f74 656e  y_input = to_ten
+00007e10: 736f 7228 696e 7075 745f 7368 6170 652e  sor(input_shape.
+00007e20: 6765 745f 6475 6d6d 795f 7465 6e73 6f72  get_dummy_tensor
+00007e30: 2829 292e 746f 2867 6574 5f64 6576 6963  ()).to(get_devic
+00007e40: 6528 2929 0d0a 2020 2020 2020 2020 2020  e())..          
+00007e50: 2020 6f75 7420 3d20 7365 6c66 2e66 6f72    out = self.for
+00007e60: 7761 7264 2864 756d 6d61 795f 696e 7075  ward(dummay_inpu
+00007e70: 7429 0d0a 0d0a 2020 2020 6465 6620 7265  t)....    def re
+00007e80: 6769 7374 6572 5f62 6163 6b77 6172 645f  gister_backward_
+00007e90: 686f 6f6b 2873 656c 662c 2068 6f6f 6b29  hook(self, hook)
+00007ea0: 3a0d 0a20 2020 2020 2020 2072 2222 2252  :..        r"""R
+00007eb0: 6567 6973 7465 7273 2061 2062 6163 6b77  egisters a backw
+00007ec0: 6172 6420 686f 6f6b 206f 6e20 7468 6520  ard hook on the 
+00007ed0: 6d6f 6475 6c65 2e0d 0a0d 0a20 2020 2020  module.....     
+00007ee0: 2020 2054 6865 2068 6f6f 6b20 7769 6c6c     The hook will
+00007ef0: 2062 6520 6361 6c6c 6564 2065 7665 7279   be called every
+00007f00: 2074 696d 6520 7468 6520 6772 6164 6965   time the gradie
+00007f10: 6e74 7320 7769 7468 2072 6573 7065 6374  nts with respect
+00007f20: 2074 6f20 6d6f 6475 6c65 0d0a 2020 2020   to module..    
+00007f30: 2020 2020 696e 7075 7473 2061 7265 2063      inputs are c
+00007f40: 6f6d 7075 7465 642e 2054 6865 2068 6f6f  omputed. The hoo
+00007f50: 6b20 7368 6f75 6c64 2068 6176 6520 7468  k should have th
+00007f60: 6520 666f 6c6c 6f77 696e 6720 7369 676e  e following sign
+00007f70: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
+00007f80: 2020 2020 2020 2068 6f6f 6b28 6d6f 6475         hook(modu
+00007f90: 6c65 2c20 6772 6164 5f69 6e70 7574 2c20  le, grad_input, 
+00007fa0: 6772 6164 5f6f 7574 7075 7429 202d 3e20  grad_output) -> 
+00007fb0: 5465 6e73 6f72 206f 7220 4e6f 6e65 0d0a  Tensor or None..
+00007fc0: 0d0a 2020 2020 2020 2020 5468 6520 3a61  ..        The :a
+00007fd0: 7474 723a 6067 7261 645f 696e 7075 7460  ttr:`grad_input`
+00007fe0: 2061 6e64 203a 6174 7472 3a60 6772 6164   and :attr:`grad
+00007ff0: 5f6f 7574 7075 7460 206d 6179 2062 6520  _output` may be 
+00008000: 7475 706c 6573 2069 6620 7468 650d 0a20  tuples if the.. 
+00008010: 2020 2020 2020 206d 6f64 756c 6520 6861         module ha
+00008020: 7320 6d75 6c74 6970 6c65 2069 6e70 7574  s multiple input
+00008030: 7320 6f72 206f 7574 7075 7473 2e20 5468  s or outputs. Th
+00008040: 6520 686f 6f6b 2073 686f 756c 6420 6e6f  e hook should no
+00008050: 7420 6d6f 6469 6679 2069 7473 0d0a 2020  t modify its..  
+00008060: 2020 2020 2020 6172 6775 6d65 6e74 732c        arguments,
+00008070: 2062 7574 2069 7420 6361 6e20 6f70 7469   but it can opti
+00008080: 6f6e 616c 6c79 2072 6574 7572 6e20 6120  onally return a 
+00008090: 6e65 7720 6772 6164 6965 6e74 2077 6974  new gradient wit
+000080a0: 6820 7265 7370 6563 7420 746f 0d0a 2020  h respect to..  
+000080b0: 2020 2020 2020 696e 7075 7420 7468 6174        input that
+000080c0: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
+000080d0: 2070 6c61 6365 206f 6620 3a61 7474 723a   place of :attr:
+000080e0: 6067 7261 645f 696e 7075 7460 2069 6e20  `grad_input` in 
+000080f0: 7375 6273 6571 7565 6e74 0d0a 2020 2020  subsequent..    
+00008100: 2020 2020 636f 6d70 7574 6174 696f 6e73      computations
+00008110: 2e0d 0a0d 0a20 2020 2020 2020 2052 6574  .....        Ret
+00008120: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
+00008130: 2020 203a 636c 6173 733a 6074 6f72 6368     :class:`torch
+00008140: 2e75 7469 6c73 2e68 6f6f 6b73 2e52 656d  .utils.hooks.Rem
+00008150: 6f76 6162 6c65 4861 6e64 6c65 603a 0d0a  ovableHandle`:..
+00008160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008170: 6120 6861 6e64 6c65 2074 6861 7420 6361  a handle that ca
+00008180: 6e20 6265 2075 7365 6420 746f 2072 656d  n be used to rem
+00008190: 6f76 6520 7468 6520 6164 6465 6420 686f  ove the added ho
+000081a0: 6f6b 2062 7920 6361 6c6c 696e 670d 0a20  ok by calling.. 
+000081b0: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+000081c0: 6068 616e 646c 652e 7265 6d6f 7665 2829  `handle.remove()
+000081d0: 6060 0d0a 0d0a 2020 2020 2020 2020 2e2e  ``....        ..
+000081e0: 2077 6172 6e69 6e67 203a 3a0d 0a0d 0a20   warning ::.... 
+000081f0: 2020 2020 2020 2020 2020 2054 6865 2063             The c
+00008200: 7572 7265 6e74 2069 6d70 6c65 6d65 6e74  urrent implement
+00008210: 6174 696f 6e20 7769 6c6c 206e 6f74 2068  ation will not h
+00008220: 6176 6520 7468 6520 7072 6573 656e 7465  ave the presente
+00008230: 6420 6265 6861 7669 6f72 0d0a 2020 2020  d behavior..    
+00008240: 2020 2020 2020 2020 666f 7220 636f 6d70          for comp
+00008250: 6c65 7820 3a63 6c61 7373 3a60 4d6f 6475  lex :class:`Modu
+00008260: 6c65 6020 7468 6174 2070 6572 666f 726d  le` that perform
+00008270: 206d 616e 7920 6f70 6572 6174 696f 6e73   many operations
+00008280: 2e0d 0a20 2020 2020 2020 2020 2020 2049  ...            I
+00008290: 6e20 736f 6d65 2066 6169 6c75 7265 2063  n some failure c
+000082a0: 6173 6573 2c20 3a61 7474 723a 6067 7261  ases, :attr:`gra
+000082b0: 645f 696e 7075 7460 2061 6e64 203a 6174  d_input` and :at
+000082c0: 7472 3a60 6772 6164 5f6f 7574 7075 7460  tr:`grad_output`
+000082d0: 2077 696c 6c20 6f6e 6c79 0d0a 2020 2020   will only..    
+000082e0: 2020 2020 2020 2020 636f 6e74 6169 6e20          contain 
+000082f0: 7468 6520 6772 6164 6965 6e74 7320 666f  the gradients fo
+00008300: 7220 6120 7375 6273 6574 206f 6620 7468  r a subset of th
+00008310: 6520 696e 7075 7473 2061 6e64 206f 7574  e inputs and out
+00008320: 7075 7473 2e0d 0a20 2020 2020 2020 2020  puts...         
+00008330: 2020 2046 6f72 2073 7563 6820 3a63 6c61     For such :cla
+00008340: 7373 3a60 4d6f 6475 6c65 602c 2079 6f75  ss:`Module`, you
+00008350: 2073 686f 756c 6420 7573 6520 3a66 756e   should use :fun
+00008360: 633a 6074 6f72 6368 2e54 656e 736f 722e  c:`torch.Tensor.
+00008370: 7265 6769 7374 6572 5f68 6f6f 6b60 0d0a  register_hook`..
+00008380: 2020 2020 2020 2020 2020 2020 6469 7265              dire
+00008390: 6374 6c79 206f 6e20 6120 7370 6563 6966  ctly on a specif
+000083a0: 6963 2069 6e70 7574 206f 7220 6f75 7470  ic input or outp
+000083b0: 7574 2074 6f20 6765 7420 7468 6520 7265  ut to get the re
+000083c0: 7175 6972 6564 2067 7261 6469 656e 7473  quired gradients
+000083d0: 2e0d 0a0d 0a20 2020 2020 2020 2022 2222  .....        """
+000083e0: 0d0a 2020 2020 2020 2020 6861 6e64 6c65  ..        handle
+000083f0: 203d 2052 656d 6f76 6162 6c65 4861 6e64   = RemovableHand
+00008400: 6c65 2873 656c 662e 5f62 6163 6b77 6172  le(self._backwar
+00008410: 645f 686f 6f6b 7329 0d0a 2020 2020 2020  d_hooks)..      
+00008420: 2020 7365 6c66 2e5f 6261 636b 7761 7264    self._backward
+00008430: 5f68 6f6f 6b73 5b68 616e 646c 652e 6964  _hooks[handle.id
+00008440: 5d20 3d20 686f 6f6b 0d0a 2020 2020 2020  ] = hook..      
+00008450: 2020 7265 7475 726e 2068 616e 646c 650d    return handle.
+00008460: 0a0d 0a0d 0a20 2020 2064 6566 2072 6567  .....    def reg
+00008470: 6973 7465 725f 666f 7277 6172 645f 7072  ister_forward_pr
+00008480: 655f 686f 6f6b 280d 0a20 2020 2020 2020  e_hook(..       
+00008490: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+000084a0: 686f 6f6b 3a20 556e 696f 6e5b 0d0a 2020  hook: Union[..  
+000084b0: 2020 2020 2020 2020 2020 4361 6c6c 6162            Callab
+000084c0: 6c65 5b5b 542c 2054 7570 6c65 5b41 6e79  le[[T, Tuple[Any
+000084d0: 2c20 2e2e 2e5d 5d2c 204f 7074 696f 6e61  , ...]], Optiona
+000084e0: 6c5b 416e 795d 5d2c 0d0a 2020 2020 2020  l[Any]],..      
+000084f0: 2020 2020 2020 4361 6c6c 6162 6c65 5b5b        Callable[[
+00008500: 542c 2054 7570 6c65 5b41 6e79 2c20 2e2e  T, Tuple[Any, ..
+00008510: 2e5d 2c20 4469 6374 5b73 7472 2c20 416e  .], Dict[str, An
+00008520: 795d 5d2c 204f 7074 696f 6e61 6c5b 5475  y]], Optional[Tu
+00008530: 706c 655b 416e 792c 2044 6963 745b 7374  ple[Any, Dict[st
+00008540: 722c 2041 6e79 5d5d 5d5d 2c0d 0a20 2020  r, Any]]]],..   
+00008550: 2020 2020 205d 2c0d 0a20 2020 2020 2020       ],..       
+00008560: 202a 2c0d 0a20 2020 2020 2020 2070 7265   *,..        pre
+00008570: 7065 6e64 3a20 626f 6f6c 203d 2046 616c  pend: bool = Fal
+00008580: 7365 2c0d 0a20 2020 2020 2020 2077 6974  se,..        wit
+00008590: 685f 6b77 6172 6773 3a20 626f 6f6c 203d  h_kwargs: bool =
+000085a0: 2046 616c 7365 2c0d 0a20 2020 2029 202d   False,..    ) -
+000085b0: 3e20 5265 6d6f 7661 626c 6548 616e 646c  > RemovableHandl
+000085c0: 653a 0d0a 2020 2020 2020 2020 7222 2222  e:..        r"""
+000085d0: 5265 6769 7374 6572 7320 6120 666f 7277  Registers a forw
+000085e0: 6172 6420 7072 652d 686f 6f6b 206f 6e20  ard pre-hook on 
+000085f0: 7468 6520 6d6f 6475 6c65 2e0d 0a0d 0a20  the module..... 
+00008600: 2020 2020 2020 2054 6865 2068 6f6f 6b20         The hook 
+00008610: 7769 6c6c 2062 6520 6361 6c6c 6564 2065  will be called e
+00008620: 7665 7279 2074 696d 6520 6265 666f 7265  very time before
+00008630: 203a 6675 6e63 3a60 666f 7277 6172 6460   :func:`forward`
+00008640: 2069 7320 696e 766f 6b65 642e 0d0a 0d0a   is invoked.....
+00008650: 0d0a 2020 2020 2020 2020 4966 2060 6077  ..        If ``w
+00008660: 6974 685f 6b77 6172 6773 6060 2069 7320  ith_kwargs`` is 
+00008670: 6661 6c73 6520 6f72 206e 6f74 2073 7065  false or not spe
+00008680: 6369 6669 6564 2c20 7468 6520 696e 7075  cified, the inpu
+00008690: 7420 636f 6e74 6169 6e73 206f 6e6c 790d  t contains only.
+000086a0: 0a20 2020 2020 2020 2074 6865 2070 6f73  .        the pos
+000086b0: 6974 696f 6e61 6c20 6172 6775 6d65 6e74  itional argument
+000086c0: 7320 6769 7665 6e20 746f 2074 6865 206d  s given to the m
+000086d0: 6f64 756c 652e 204b 6579 776f 7264 2061  odule. Keyword a
+000086e0: 7267 756d 656e 7473 2077 6f6e 2774 2062  rguments won't b
+000086f0: 650d 0a20 2020 2020 2020 2070 6173 7365  e..        passe
+00008700: 6420 746f 2074 6865 2068 6f6f 6b73 2061  d to the hooks a
+00008710: 6e64 206f 6e6c 7920 746f 2074 6865 2060  nd only to the `
+00008720: 6066 6f72 7761 7264 6060 2e20 5468 6520  `forward``. The 
+00008730: 686f 6f6b 2063 616e 206d 6f64 6966 7920  hook can modify 
+00008740: 7468 650d 0a20 2020 2020 2020 2069 6e70  the..        inp
+00008750: 7574 2e20 5573 6572 2063 616e 2065 6974  ut. User can eit
+00008760: 6865 7220 7265 7475 726e 2061 2074 7570  her return a tup
+00008770: 6c65 206f 7220 6120 7369 6e67 6c65 206d  le or a single m
+00008780: 6f64 6966 6965 6420 7661 6c75 6520 696e  odified value in
+00008790: 2074 6865 0d0a 2020 2020 2020 2020 686f   the..        ho
+000087a0: 6f6b 2e20 5765 2077 696c 6c20 7772 6170  ok. We will wrap
+000087b0: 2074 6865 2076 616c 7565 2069 6e74 6f20   the value into 
+000087c0: 6120 7475 706c 6520 6966 2061 2073 696e  a tuple if a sin
+000087d0: 676c 6520 7661 6c75 6520 6973 2072 6574  gle value is ret
+000087e0: 7572 6e65 640d 0a20 2020 2020 2020 2028  urned..        (
+000087f0: 756e 6c65 7373 2074 6861 7420 7661 6c75  unless that valu
+00008800: 6520 6973 2061 6c72 6561 6479 2061 2074  e is already a t
+00008810: 7570 6c65 292e 2054 6865 2068 6f6f 6b20  uple). The hook 
+00008820: 7368 6f75 6c64 2068 6176 6520 7468 650d  should have the.
+00008830: 0a20 2020 2020 2020 2066 6f6c 6c6f 7769  .        followi
+00008840: 6e67 2073 6967 6e61 7475 7265 3a3a 0d0a  ng signature::..
+00008850: 0d0a 2020 2020 2020 2020 2020 2020 686f  ..            ho
+00008860: 6f6b 286d 6f64 756c 652c 2061 7267 7329  ok(module, args)
+00008870: 202d 3e20 4e6f 6e65 206f 7220 6d6f 6469   -> None or modi
+00008880: 6669 6564 2069 6e70 7574 0d0a 0d0a 2020  fied input....  
+00008890: 2020 2020 2020 4966 2060 6077 6974 685f        If ``with_
+000088a0: 6b77 6172 6773 6060 2069 7320 7472 7565  kwargs`` is true
+000088b0: 2c20 7468 6520 666f 7277 6172 6420 7072  , the forward pr
+000088c0: 652d 686f 6f6b 2077 696c 6c20 6265 2070  e-hook will be p
+000088d0: 6173 7365 6420 7468 650d 0a20 2020 2020  assed the..     
+000088e0: 2020 206b 7761 7267 7320 6769 7665 6e20     kwargs given 
+000088f0: 746f 2074 6865 2066 6f72 7761 7264 2066  to the forward f
+00008900: 756e 6374 696f 6e2e 2041 6e64 2069 6620  unction. And if 
+00008910: 7468 6520 686f 6f6b 206d 6f64 6966 6965  the hook modifie
+00008920: 7320 7468 650d 0a20 2020 2020 2020 2069  s the..        i
+00008930: 6e70 7574 2c20 626f 7468 2074 6865 2061  nput, both the a
+00008940: 7267 7320 616e 6420 6b77 6172 6773 2073  rgs and kwargs s
+00008950: 686f 756c 6420 6265 2072 6574 7572 6e65  hould be returne
+00008960: 642e 2054 6865 2068 6f6f 6b20 7368 6f75  d. The hook shou
+00008970: 6c64 2068 6176 650d 0a20 2020 2020 2020  ld have..       
+00008980: 2074 6865 2066 6f6c 6c6f 7769 6e67 2073   the following s
+00008990: 6967 6e61 7475 7265 3a3a 0d0a 0d0a 2020  ignature::....  
+000089a0: 2020 2020 2020 2020 2020 686f 6f6b 286d            hook(m
+000089b0: 6f64 756c 652c 2061 7267 732c 206b 7761  odule, args, kwa
+000089c0: 7267 7329 202d 3e20 4e6f 6e65 206f 7220  rgs) -> None or 
+000089d0: 6120 7475 706c 6520 6f66 206d 6f64 6966  a tuple of modif
+000089e0: 6965 6420 696e 7075 7420 616e 6420 6b77  ied input and kw
+000089f0: 6172 6773 0d0a 0d0a 2020 2020 2020 2020  args....        
+00008a00: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+00008a10: 2020 2068 6f6f 6b20 2843 616c 6c61 626c     hook (Callabl
+00008a20: 6529 3a20 5468 6520 7573 6572 2064 6566  e): The user def
+00008a30: 696e 6564 2068 6f6f 6b20 746f 2062 6520  ined hook to be 
+00008a40: 7265 6769 7374 6572 6564 2e0d 0a20 2020  registered...   
+00008a50: 2020 2020 2020 2020 2070 7265 7065 6e64           prepend
+00008a60: 2028 626f 6f6c 293a 2049 6620 7472 7565   (bool): If true
+00008a70: 2c20 7468 6520 7072 6f76 6964 6564 2060  , the provided `
+00008a80: 6068 6f6f 6b60 6020 7769 6c6c 2062 6520  `hook`` will be 
+00008a90: 6669 7265 6420 6265 666f 7265 0d0a 2020  fired before..  
+00008aa0: 2020 2020 2020 2020 2020 2020 2020 616c                al
+00008ab0: 6c20 6578 6973 7469 6e67 2060 6066 6f72  l existing ``for
+00008ac0: 7761 7264 5f70 7265 6060 2068 6f6f 6b73  ward_pre`` hooks
+00008ad0: 206f 6e20 7468 6973 0d0a 2020 2020 2020   on this..      
+00008ae0: 2020 2020 2020 2020 2020 3a63 6c61 7373            :class
+00008af0: 3a60 746f 7263 682e 6e6e 2e6d 6f64 756c  :`torch.nn.modul
+00008b00: 6573 2e4d 6f64 756c 6560 2e20 4f74 6865  es.Module`. Othe
+00008b10: 7277 6973 652c 2074 6865 2070 726f 7669  rwise, the provi
+00008b20: 6465 640d 0a20 2020 2020 2020 2020 2020  ded..           
+00008b30: 2020 2020 2060 6068 6f6f 6b60 6020 7769       ``hook`` wi
+00008b40: 6c6c 2062 6520 6669 7265 6420 6166 7465  ll be fired afte
+00008b50: 7220 616c 6c20 6578 6973 7469 6e67 2060  r all existing `
+00008b60: 6066 6f72 7761 7264 5f70 7265 6060 2068  `forward_pre`` h
+00008b70: 6f6f 6b73 0d0a 2020 2020 2020 2020 2020  ooks..          
+00008b80: 2020 2020 2020 6f6e 2074 6869 7320 3a63        on this :c
+00008b90: 6c61 7373 3a60 746f 7263 682e 6e6e 2e6d  lass:`torch.nn.m
+00008ba0: 6f64 756c 6573 2e4d 6f64 756c 6560 2e20  odules.Module`. 
+00008bb0: 4e6f 7465 2074 6861 7420 676c 6f62 616c  Note that global
+00008bc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008bd0: 2020 6060 666f 7277 6172 645f 7072 6560    ``forward_pre`
+00008be0: 6020 686f 6f6b 7320 7265 6769 7374 6572  ` hooks register
+00008bf0: 6564 2077 6974 680d 0a20 2020 2020 2020  ed with..       
+00008c00: 2020 2020 2020 2020 203a 6675 6e63 3a60           :func:`
+00008c10: 7265 6769 7374 6572 5f6d 6f64 756c 655f  register_module_
+00008c20: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+00008c30: 6020 7769 6c6c 2066 6972 6520 6265 666f  ` will fire befo
+00008c40: 7265 2061 6c6c 0d0a 2020 2020 2020 2020  re all..        
+00008c50: 2020 2020 2020 2020 686f 6f6b 7320 7265          hooks re
+00008c60: 6769 7374 6572 6564 2062 7920 7468 6973  gistered by this
+00008c70: 206d 6574 686f 642e 0d0a 2020 2020 2020   method...      
+00008c80: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+00008c90: 743a 2060 6046 616c 7365 6060 0d0a 2020  t: ``False``..  
+00008ca0: 2020 2020 2020 2020 2020 7769 7468 5f6b            with_k
+00008cb0: 7761 7267 7320 2862 6f6f 6c29 3a20 4966  wargs (bool): If
+00008cc0: 2074 7275 652c 2074 6865 2060 6068 6f6f   true, the ``hoo
+00008cd0: 6b60 6020 7769 6c6c 2062 6520 7061 7373  k`` will be pass
+00008ce0: 6564 2074 6865 206b 7761 7267 730d 0a20  ed the kwargs.. 
+00008cf0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00008d00: 6976 656e 2074 6f20 7468 6520 666f 7277  iven to the forw
+00008d10: 6172 6420 6675 6e63 7469 6f6e 2e0d 0a20  ard function... 
+00008d20: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+00008d30: 6566 6175 6c74 3a20 6060 4661 6c73 6560  efault: ``False`
+00008d40: 600d 0a0d 0a20 2020 2020 2020 2052 6574  `....        Ret
+00008d50: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
+00008d60: 2020 203a 636c 6173 733a 6074 6f72 6368     :class:`torch
+00008d70: 2e75 7469 6c73 2e68 6f6f 6b73 2e52 656d  .utils.hooks.Rem
+00008d80: 6f76 6162 6c65 4861 6e64 6c65 603a 0d0a  ovableHandle`:..
+00008d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008da0: 6120 6861 6e64 6c65 2074 6861 7420 6361  a handle that ca
+00008db0: 6e20 6265 2075 7365 6420 746f 2072 656d  n be used to rem
+00008dc0: 6f76 6520 7468 6520 6164 6465 6420 686f  ove the added ho
+00008dd0: 6f6b 2062 7920 6361 6c6c 696e 670d 0a20  ok by calling.. 
+00008de0: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+00008df0: 6068 616e 646c 652e 7265 6d6f 7665 2829  `handle.remove()
+00008e00: 6060 0d0a 2020 2020 2020 2020 2222 220d  ``..        """.
+00008e10: 0a20 2020 2020 2020 2068 616e 646c 6520  .        handle 
+00008e20: 3d20 686f 6f6b 732e 5265 6d6f 7661 626c  = hooks.Removabl
+00008e30: 6548 616e 646c 6528 0d0a 2020 2020 2020  eHandle(..      
+00008e40: 2020 2020 2020 7365 6c66 2e5f 666f 7277        self._forw
+00008e50: 6172 645f 7072 655f 686f 6f6b 732c 0d0a  ard_pre_hooks,..
+00008e60: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+00008e70: 615f 6469 6374 3d73 656c 662e 5f66 6f72  a_dict=self._for
+00008e80: 7761 7264 5f70 7265 5f68 6f6f 6b73 5f77  ward_pre_hooks_w
+00008e90: 6974 685f 6b77 6172 6773 0d0a 2020 2020  ith_kwargs..    
+00008ea0: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+00008eb0: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
+00008ec0: 5f68 6f6f 6b73 5b68 616e 646c 652e 6964  _hooks[handle.id
+00008ed0: 5d20 3d20 686f 6f6b 0d0a 2020 2020 2020  ] = hook..      
+00008ee0: 2020 6966 2077 6974 685f 6b77 6172 6773    if with_kwargs
+00008ef0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00008f00: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
+00008f10: 5f68 6f6f 6b73 5f77 6974 685f 6b77 6172  _hooks_with_kwar
+00008f20: 6773 5b68 616e 646c 652e 6964 5d20 3d20  gs[handle.id] = 
+00008f30: 5472 7565 0d0a 0d0a 2020 2020 2020 2020  True....        
+00008f40: 6966 2070 7265 7065 6e64 3a0d 0a20 2020  if prepend:..   
+00008f50: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+00008f60: 6f72 7761 7264 5f70 7265 5f68 6f6f 6b73  orward_pre_hooks
+00008f70: 2e6d 6f76 655f 746f 5f65 6e64 2868 616e  .move_to_end(han
+00008f80: 646c 652e 6964 2c20 6c61 7374 3d46 616c  dle.id, last=Fal
+00008f90: 7365 2920 2023 2074 7970 653a 2069 676e  se)  # type: ign
+00008fa0: 6f72 655b 6174 7472 2d64 6566 696e 6564  ore[attr-defined
+00008fb0: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+00008fc0: 6e20 6861 6e64 6c65 0d0a 0d0a 2020 2020  n handle....    
+00008fd0: 6465 6620 7265 6769 7374 6572 5f66 6f72  def register_for
+00008fe0: 7761 7264 5f68 6f6f 6b28 0d0a 2020 2020  ward_hook(..    
+00008ff0: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+00009000: 2020 2068 6f6f 6b3a 2055 6e69 6f6e 5b0d     hook: Union[.
+00009010: 0a20 2020 2020 2020 2020 2020 2043 616c  .            Cal
+00009020: 6c61 626c 655b 5b54 2c20 5475 706c 655b  lable[[T, Tuple[
+00009030: 416e 792c 202e 2e2e 5d2c 2041 6e79 5d2c  Any, ...], Any],
+00009040: 204f 7074 696f 6e61 6c5b 416e 795d 5d2c   Optional[Any]],
+00009050: 0d0a 2020 2020 2020 2020 2020 2020 4361  ..            Ca
+00009060: 6c6c 6162 6c65 5b5b 542c 2054 7570 6c65  llable[[T, Tuple
+00009070: 5b41 6e79 2c20 2e2e 2e5d 2c20 4469 6374  [Any, ...], Dict
+00009080: 5b73 7472 2c20 416e 795d 2c20 416e 795d  [str, Any], Any]
+00009090: 2c20 4f70 7469 6f6e 616c 5b41 6e79 5d5d  , Optional[Any]]
+000090a0: 2c0d 0a20 2020 2020 2020 205d 2c0d 0a20  ,..        ],.. 
+000090b0: 2020 2020 2020 202a 2c0d 0a20 2020 2020         *,..     
+000090c0: 2020 2070 7265 7065 6e64 3a20 626f 6f6c     prepend: bool
+000090d0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+000090e0: 2020 2077 6974 685f 6b77 6172 6773 3a20     with_kwargs: 
+000090f0: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+00009100: 2020 2029 202d 3e20 5265 6d6f 7661 626c     ) -> Removabl
+00009110: 6548 616e 646c 653a 0d0a 2020 2020 2020  eHandle:..      
+00009120: 2020 7222 2222 5265 6769 7374 6572 7320    r"""Registers 
+00009130: 6120 666f 7277 6172 6420 686f 6f6b 206f  a forward hook o
+00009140: 6e20 7468 6520 6d6f 6475 6c65 2e0d 0a0d  n the module....
+00009150: 0a20 2020 2020 2020 2054 6865 2068 6f6f  .        The hoo
+00009160: 6b20 7769 6c6c 2062 6520 6361 6c6c 6564  k will be called
+00009170: 2065 7665 7279 2074 696d 6520 6166 7465   every time afte
+00009180: 7220 3a66 756e 633a 6066 6f72 7761 7264  r :func:`forward
+00009190: 6020 6861 7320 636f 6d70 7574 6564 2061  ` has computed a
+000091a0: 6e20 6f75 7470 7574 2e0d 0a0d 0a20 2020  n output.....   
+000091b0: 2020 2020 2049 6620 6060 7769 7468 5f6b       If ``with_k
+000091c0: 7761 7267 7360 6020 6973 2060 6046 616c  wargs`` is ``Fal
+000091d0: 7365 6060 206f 7220 6e6f 7420 7370 6563  se`` or not spec
+000091e0: 6966 6965 642c 2074 6865 2069 6e70 7574  ified, the input
+000091f0: 2063 6f6e 7461 696e 7320 6f6e 6c79 0d0a   contains only..
+00009200: 2020 2020 2020 2020 7468 6520 706f 7369          the posi
+00009210: 7469 6f6e 616c 2061 7267 756d 656e 7473  tional arguments
+00009220: 2067 6976 656e 2074 6f20 7468 6520 6d6f   given to the mo
+00009230: 6475 6c65 2e20 4b65 7977 6f72 6420 6172  dule. Keyword ar
+00009240: 6775 6d65 6e74 7320 776f 6e27 7420 6265  guments won't be
+00009250: 0d0a 2020 2020 2020 2020 7061 7373 6564  ..        passed
+00009260: 2074 6f20 7468 6520 686f 6f6b 7320 616e   to the hooks an
+00009270: 6420 6f6e 6c79 2074 6f20 7468 6520 6060  d only to the ``
+00009280: 666f 7277 6172 6460 602e 2054 6865 2068  forward``. The h
+00009290: 6f6f 6b20 6361 6e20 6d6f 6469 6679 2074  ook can modify t
+000092a0: 6865 0d0a 2020 2020 2020 2020 6f75 7470  he..        outp
+000092b0: 7574 2e20 4974 2063 616e 206d 6f64 6966  ut. It can modif
+000092c0: 7920 7468 6520 696e 7075 7420 696e 706c  y the input inpl
+000092d0: 6163 6520 6275 7420 6974 2077 696c 6c20  ace but it will 
+000092e0: 6e6f 7420 6861 7665 2065 6666 6563 7420  not have effect 
+000092f0: 6f6e 0d0a 2020 2020 2020 2020 666f 7277  on..        forw
+00009300: 6172 6420 7369 6e63 6520 7468 6973 2069  ard since this i
+00009310: 7320 6361 6c6c 6564 2061 6674 6572 203a  s called after :
+00009320: 6675 6e63 3a60 666f 7277 6172 6460 2069  func:`forward` i
+00009330: 7320 6361 6c6c 6564 2e20 5468 6520 686f  s called. The ho
+00009340: 6f6b 0d0a 2020 2020 2020 2020 7368 6f75  ok..        shou
+00009350: 6c64 2068 6176 6520 7468 6520 666f 6c6c  ld have the foll
+00009360: 6f77 696e 6720 7369 676e 6174 7572 653a  owing signature:
+00009370: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+00009380: 2068 6f6f 6b28 6d6f 6475 6c65 2c20 6172   hook(module, ar
+00009390: 6773 2c20 6f75 7470 7574 2920 2d3e 204e  gs, output) -> N
+000093a0: 6f6e 6520 6f72 206d 6f64 6966 6965 6420  one or modified 
+000093b0: 6f75 7470 7574 0d0a 0d0a 2020 2020 2020  output....      
+000093c0: 2020 4966 2060 6077 6974 685f 6b77 6172    If ``with_kwar
+000093d0: 6773 6060 2069 7320 6060 5472 7565 6060  gs`` is ``True``
+000093e0: 2c20 7468 6520 666f 7277 6172 6420 686f  , the forward ho
+000093f0: 6f6b 2077 696c 6c20 6265 2070 6173 7365  ok will be passe
+00009400: 6420 7468 650d 0a20 2020 2020 2020 2060  d the..        `
+00009410: 606b 7761 7267 7360 6020 6769 7665 6e20  `kwargs`` given 
+00009420: 746f 2074 6865 2066 6f72 7761 7264 2066  to the forward f
+00009430: 756e 6374 696f 6e20 616e 6420 6265 2065  unction and be e
+00009440: 7870 6563 7465 6420 746f 2072 6574 7572  xpected to retur
+00009450: 6e20 7468 650d 0a20 2020 2020 2020 206f  n the..        o
+00009460: 7574 7075 7420 706f 7373 6962 6c79 206d  utput possibly m
+00009470: 6f64 6966 6965 642e 2054 6865 2068 6f6f  odified. The hoo
+00009480: 6b20 7368 6f75 6c64 2068 6176 6520 7468  k should have th
+00009490: 6520 666f 6c6c 6f77 696e 6720 7369 676e  e following sign
+000094a0: 6174 7572 653a 3a0d 0a0d 0a20 2020 2020  ature::....     
+000094b0: 2020 2020 2020 2068 6f6f 6b28 6d6f 6475         hook(modu
+000094c0: 6c65 2c20 6172 6773 2c20 6b77 6172 6773  le, args, kwargs
+000094d0: 2c20 6f75 7470 7574 2920 2d3e 204e 6f6e  , output) -> Non
+000094e0: 6520 6f72 206d 6f64 6966 6965 6420 6f75  e or modified ou
+000094f0: 7470 7574 0d0a 0d0a 2020 2020 2020 2020  tput....        
+00009500: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+00009510: 2020 2068 6f6f 6b20 2843 616c 6c61 626c     hook (Callabl
+00009520: 6529 3a20 5468 6520 7573 6572 2064 6566  e): The user def
+00009530: 696e 6564 2068 6f6f 6b20 746f 2062 6520  ined hook to be 
+00009540: 7265 6769 7374 6572 6564 2e0d 0a20 2020  registered...   
+00009550: 2020 2020 2020 2020 2070 7265 7065 6e64           prepend
+00009560: 2028 626f 6f6c 293a 2049 6620 6060 5472   (bool): If ``Tr
+00009570: 7565 6060 2c20 7468 6520 7072 6f76 6964  ue``, the provid
+00009580: 6564 2060 6068 6f6f 6b60 6020 7769 6c6c  ed ``hook`` will
+00009590: 2062 6520 6669 7265 640d 0a20 2020 2020   be fired..     
+000095a0: 2020 2020 2020 2020 2020 2062 6566 6f72             befor
+000095b0: 6520 616c 6c20 6578 6973 7469 6e67 2060  e all existing `
+000095c0: 6066 6f72 7761 7264 6060 2068 6f6f 6b73  `forward`` hooks
+000095d0: 206f 6e20 7468 6973 0d0a 2020 2020 2020   on this..      
+000095e0: 2020 2020 2020 2020 2020 3a63 6c61 7373            :class
+000095f0: 3a60 746f 7263 682e 6e6e 2e6d 6f64 756c  :`torch.nn.modul
+00009600: 6573 2e4d 6f64 756c 6560 2e20 4f74 6865  es.Module`. Othe
+00009610: 7277 6973 652c 2074 6865 2070 726f 7669  rwise, the provi
+00009620: 6465 640d 0a20 2020 2020 2020 2020 2020  ded..           
+00009630: 2020 2020 2060 6068 6f6f 6b60 6020 7769       ``hook`` wi
+00009640: 6c6c 2062 6520 6669 7265 6420 6166 7465  ll be fired afte
+00009650: 7220 616c 6c20 6578 6973 7469 6e67 2060  r all existing `
+00009660: 6066 6f72 7761 7264 6060 2068 6f6f 6b73  `forward`` hooks
+00009670: 206f 6e0d 0a20 2020 2020 2020 2020 2020   on..           
+00009680: 2020 2020 2074 6869 7320 3a63 6c61 7373       this :class
+00009690: 3a60 746f 7263 682e 6e6e 2e6d 6f64 756c  :`torch.nn.modul
+000096a0: 6573 2e4d 6f64 756c 6560 2e20 4e6f 7465  es.Module`. Note
+000096b0: 2074 6861 7420 676c 6f62 616c 0d0a 2020   that global..  
+000096c0: 2020 2020 2020 2020 2020 2020 2020 6060                ``
+000096d0: 666f 7277 6172 6460 6020 686f 6f6b 7320  forward`` hooks 
+000096e0: 7265 6769 7374 6572 6564 2077 6974 680d  registered with.
+000096f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009700: 203a 6675 6e63 3a60 7265 6769 7374 6572   :func:`register
+00009710: 5f6d 6f64 756c 655f 666f 7277 6172 645f  _module_forward_
+00009720: 686f 6f6b 6020 7769 6c6c 2066 6972 6520  hook` will fire 
+00009730: 6265 666f 7265 2061 6c6c 2068 6f6f 6b73  before all hooks
+00009740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009750: 2020 7265 6769 7374 6572 6564 2062 7920    registered by 
+00009760: 7468 6973 206d 6574 686f 642e 0d0a 2020  this method...  
+00009770: 2020 2020 2020 2020 2020 2020 2020 4465                De
+00009780: 6661 756c 743a 2060 6046 616c 7365 6060  fault: ``False``
+00009790: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
+000097a0: 7468 5f6b 7761 7267 7320 2862 6f6f 6c29  th_kwargs (bool)
+000097b0: 3a20 4966 2060 6054 7275 6560 602c 2074  : If ``True``, t
+000097c0: 6865 2060 6068 6f6f 6b60 6020 7769 6c6c  he ``hook`` will
+000097d0: 2062 6520 7061 7373 6564 2074 6865 0d0a   be passed the..
+000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097f0: 6b77 6172 6773 2067 6976 656e 2074 6f20  kwargs given to 
+00009800: 7468 6520 666f 7277 6172 6420 6675 6e63  the forward func
+00009810: 7469 6f6e 2e0d 0a20 2020 2020 2020 2020  tion...         
+00009820: 2020 2020 2020 2044 6566 6175 6c74 3a20         Default: 
+00009830: 6060 4661 6c73 6560 600d 0a0d 0a20 2020  ``False``....   
+00009840: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+00009850: 2020 2020 2020 2020 2020 203a 636c 6173             :clas
+00009860: 733a 6074 6f72 6368 2e75 7469 6c73 2e68  s:`torch.utils.h
+00009870: 6f6f 6b73 2e52 656d 6f76 6162 6c65 4861  ooks.RemovableHa
+00009880: 6e64 6c65 603a 0d0a 2020 2020 2020 2020  ndle`:..        
+00009890: 2020 2020 2020 2020 6120 6861 6e64 6c65          a handle
+000098a0: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
+000098b0: 6420 746f 2072 656d 6f76 6520 7468 6520  d to remove the 
+000098c0: 6164 6465 6420 686f 6f6b 2062 7920 6361  added hook by ca
+000098d0: 6c6c 696e 670d 0a20 2020 2020 2020 2020  lling..         
+000098e0: 2020 2020 2020 2060 6068 616e 646c 652e         ``handle.
+000098f0: 7265 6d6f 7665 2829 6060 0d0a 2020 2020  remove()``..    
+00009900: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00009910: 2068 616e 646c 6520 3d20 686f 6f6b 732e   handle = hooks.
+00009920: 5265 6d6f 7661 626c 6548 616e 646c 6528  RemovableHandle(
+00009930: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00009940: 6c66 2e5f 666f 7277 6172 645f 686f 6f6b  lf._forward_hook
+00009950: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00009960: 6578 7472 615f 6469 6374 3d73 656c 662e  extra_dict=self.
+00009970: 5f66 6f72 7761 7264 5f68 6f6f 6b73 5f77  _forward_hooks_w
+00009980: 6974 685f 6b77 6172 6773 0d0a 2020 2020  ith_kwargs..    
+00009990: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+000099a0: 656c 662e 5f66 6f72 7761 7264 5f68 6f6f  elf._forward_hoo
+000099b0: 6b73 5b68 616e 646c 652e 6964 5d20 3d20  ks[handle.id] = 
+000099c0: 686f 6f6b 0d0a 2020 2020 2020 2020 6966  hook..        if
+000099d0: 2077 6974 685f 6b77 6172 6773 3a0d 0a20   with_kwargs:.. 
+000099e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000099f0: 5f66 6f72 7761 7264 5f68 6f6f 6b73 5f77  _forward_hooks_w
+00009a00: 6974 685f 6b77 6172 6773 5b68 616e 646c  ith_kwargs[handl
+00009a10: 652e 6964 5d20 3d20 5472 7565 0d0a 0d0a  e.id] = True....
+00009a20: 2020 2020 2020 2020 6966 2070 7265 7065          if prepe
+00009a30: 6e64 3a0d 0a20 2020 2020 2020 2020 2020  nd:..           
+00009a40: 2073 656c 662e 5f66 6f72 7761 7264 5f68   self._forward_h
+00009a50: 6f6f 6b73 2e6d 6f76 655f 746f 5f65 6e64  ooks.move_to_end
+00009a60: 2868 616e 646c 652e 6964 2c20 6c61 7374  (handle.id, last
+00009a70: 3d46 616c 7365 2920 2023 2074 7970 653a  =False)  # type:
+00009a80: 2069 676e 6f72 655b 6174 7472 2d64 6566   ignore[attr-def
+00009a90: 696e 6564 5d0d 0a20 2020 2020 2020 2072  ined]..        r
+00009aa0: 6574 7572 6e20 6861 6e64 6c65 0d0a 0d0a  eturn handle....
+00009ab0: 2020 2020 6465 6620 5f67 6574 5f6e 616d      def _get_nam
+00009ac0: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
+00009ad0: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+00009ae0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00009af0: 0d0a 0d0a 2020 2020 6465 6620 7265 6769  ....    def regi
+00009b00: 7374 6572 5f62 7566 6665 7228 7365 6c66  ster_buffer(self
+00009b10: 2c20 6e61 6d65 3a20 7374 722c 2074 656e  , name: str, ten
+00009b20: 736f 723a 204f 7074 696f 6e61 6c5b 5465  sor: Optional[Te
+00009b30: 6e73 6f72 5d2c 2070 6572 7369 7374 656e  nsor], persisten
+00009b40: 743a 2062 6f6f 6c20 3d20 5472 7565 2920  t: bool = True) 
+00009b50: 2d3e 204e 6f6e 653a 0d0a 2020 2020 2020  -> None:..      
+00009b60: 2020 7222 2222 4164 6473 2061 2070 6572    r"""Adds a per
+00009b70: 7369 7374 656e 7420 6275 6666 6572 2074  sistent buffer t
+00009b80: 6f20 7468 6520 6d6f 6475 6c65 2e0d 0a0d  o the module....
+00009b90: 0a20 2020 2020 2020 2054 6869 7320 6973  .        This is
+00009ba0: 2074 7970 6963 616c 6c79 2075 7365 6420   typically used 
+00009bb0: 746f 2072 6567 6973 7465 7220 6120 6275  to register a bu
+00009bc0: 6666 6572 2074 6861 7420 7368 6f75 6c64  ffer that should
+00009bd0: 206e 6f74 2074 6f20 6265 0d0a 2020 2020   not to be..    
+00009be0: 2020 2020 636f 6e73 6964 6572 6564 2061      considered a
+00009bf0: 206d 6f64 656c 2070 6172 616d 6574 6572   model parameter
+00009c00: 2e20 466f 7220 6578 616d 706c 652c 2042  . For example, B
+00009c10: 6174 6368 4e6f 726d 2773 2060 6072 756e  atchNorm's ``run
+00009c20: 6e69 6e67 5f6d 6561 6e60 600d 0a20 2020  ning_mean``..   
+00009c30: 2020 2020 2069 7320 6e6f 7420 6120 7061       is not a pa
+00009c40: 7261 6d65 7465 722c 2062 7574 2069 7320  rameter, but is 
+00009c50: 7061 7274 206f 6620 7468 6520 7065 7273  part of the pers
+00009c60: 6973 7465 6e74 2073 7461 7465 2e0d 0a0d  istent state....
+00009c70: 0a20 2020 2020 2020 2042 7566 6665 7273  .        Buffers
+00009c80: 2063 616e 2062 6520 6163 6365 7373 6564   can be accessed
+00009c90: 2061 7320 6174 7472 6962 7574 6573 2075   as attributes u
+00009ca0: 7369 6e67 2067 6976 656e 206e 616d 6573  sing given names
+00009cb0: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+00009cc0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00009cd0: 6e61 6d65 2028 7374 7269 6e67 293a 206e  name (string): n
+00009ce0: 616d 6520 6f66 2074 6865 2062 7566 6665  ame of the buffe
+00009cf0: 722e 2054 6865 2062 7566 6665 7220 6361  r. The buffer ca
+00009d00: 6e20 6265 2061 6363 6573 7365 640d 0a20  n be accessed.. 
+00009d10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009d20: 726f 6d20 7468 6973 206d 6f64 756c 6520  rom this module 
+00009d30: 7573 696e 6720 7468 6520 6769 7665 6e20  using the given 
+00009d40: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00009d50: 2020 7465 6e73 6f72 2028 5465 6e73 6f72    tensor (Tensor
+00009d60: 293a 2062 7566 6665 7220 746f 2062 6520  ): buffer to be 
+00009d70: 7265 6769 7374 6572 6564 2e0d 0a20 2020  registered...   
+00009d80: 2020 2020 2020 2020 2070 6572 7369 7374           persist
+00009d90: 656e 7420 2862 6f6f 6c29 3a20 7768 6574  ent (bool): whet
+00009da0: 6865 7220 7468 6520 6275 6666 6572 2069  her the buffer i
+00009db0: 7320 7061 7274 206f 6620 7468 6973 206d  s part of this m
+00009dc0: 6f64 756c 6527 730d 0a20 2020 2020 2020  odule's..       
+00009dd0: 2020 2020 2020 2020 203a 6174 7472 3a60           :attr:`
+00009de0: 7374 6174 655f 6469 6374 602e 0d0a 0d0a  state_dict`.....
+00009df0: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
+00009e00: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+00009e10: 203e 3e3e 2073 656c 662e 7265 6769 7374   >>> self.regist
+00009e20: 6572 5f62 7566 6665 7228 2772 756e 6e69  er_buffer('runni
+00009e30: 6e67 5f6d 6561 6e27 2c20 7466 2e7a 6572  ng_mean', tf.zer
+00009e40: 6f73 285b 355d 2929 0d0a 0d0a 2020 2020  os([5]))....    
+00009e50: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00009e60: 2069 6620 275f 6275 6666 6572 7327 206e   if '_buffers' n
+00009e70: 6f74 2069 6e20 7365 6c66 2e5f 5f64 6963  ot in self.__dic
+00009e80: 745f 5f3a 0d0a 2020 2020 2020 2020 2020  t__:..          
+00009e90: 2020 7261 6973 6520 4174 7472 6962 7574    raise Attribut
+00009ea0: 6545 7272 6f72 2822 6361 6e6e 6f74 2061  eError("cannot a
+00009eb0: 7373 6967 6e20 6275 6666 6572 2062 6566  ssign buffer bef
+00009ec0: 6f72 6520 4d6f 6475 6c65 2e5f 5f69 6e69  ore Module.__ini
+00009ed0: 745f 5f28 2920 6361 6c6c 2229 0d0a 2020  t__() call")..  
+00009ee0: 2020 2020 2020 656c 6966 206e 6f74 2069        elif not i
+00009ef0: 7369 6e73 7461 6e63 6528 6e61 6d65 2c20  sinstance(name, 
+00009f00: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
+00009f10: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00009f20: 6f72 2822 6275 6666 6572 206e 616d 6520  or("buffer name 
+00009f30: 7368 6f75 6c64 2062 6520 6120 7374 7269  should be a stri
+00009f40: 6e67 2e20 220d 0a20 2020 2020 2020 2020  ng. "..         
+00009f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f60: 2020 2022 476f 7420 7b7d 222e 666f 726d     "Got {}".form
+00009f70: 6174 2874 7970 6528 6e61 6d65 292e 5f5f  at(type(name).__
+00009f80: 6e61 6d65 5f5f 2929 0d0a 2020 2020 2020  name__))..      
+00009f90: 2020 656c 6966 2027 2e27 2069 6e20 6e61    elif '.' in na
+00009fa0: 6d65 3a0d 0a20 2020 2020 2020 2020 2020  me:..           
+00009fb0: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
+00009fc0: 2262 7566 6665 7220 6e61 6d65 2063 616e  "buffer name can
+00009fd0: 2774 2063 6f6e 7461 696e 205c 222e 5c22  't contain \".\"
+00009fe0: 2229 0d0a 2020 2020 2020 2020 656c 6966  ")..        elif
+00009ff0: 206e 616d 6520 3d3d 2027 273a 0d0a 2020   name == '':..  
+0000a000: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000a010: 4b65 7945 7272 6f72 2822 6275 6666 6572  KeyError("buffer
+0000a020: 206e 616d 6520 6361 6e27 7420 6265 2065   name can't be e
+0000a030: 6d70 7479 2073 7472 696e 6720 5c22 5c22  mpty string \"\"
+0000a040: 2229 0d0a 2020 2020 2020 2020 656c 6966  ")..        elif
+0000a050: 2068 6173 6174 7472 2873 656c 662c 206e   hasattr(self, n
+0000a060: 616d 6529 2061 6e64 206e 616d 6520 6e6f  ame) and name no
+0000a070: 7420 696e 2073 656c 662e 5f62 7566 6665  t in self._buffe
+0000a080: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
+0000a090: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
+0000a0a0: 2261 7474 7269 6275 7465 2027 7b7d 2720  "attribute '{}' 
+0000a0b0: 616c 7265 6164 7920 6578 6973 7473 222e  already exists".
+0000a0c0: 666f 726d 6174 286e 616d 6529 290d 0a20  format(name)).. 
+0000a0d0: 2020 2020 2020 2065 6c69 6620 7465 6e73         elif tens
+0000a0e0: 6f72 2069 7320 6e6f 7420 4e6f 6e65 2061  or is not None a
+0000a0f0: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
+0000a100: 6528 7465 6e73 6f72 2c20 7466 2e54 656e  e(tensor, tf.Ten
+0000a110: 736f 7229 2061 6e64 206e 6f74 2069 735f  sor) and not is_
+0000a120: 7465 6e73 6f72 2874 656e 736f 7229 3a0d  tensor(tensor):.
+0000a130: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000a140: 7365 2054 7970 6545 7272 6f72 2822 6361  se TypeError("ca
+0000a150: 6e6e 6f74 2061 7373 6967 6e20 277b 7d27  nnot assign '{}'
+0000a160: 206f 626a 6563 7420 746f 2062 7566 6665   object to buffe
+0000a170: 7220 277b 7d27 2022 0d0a 2020 2020 2020  r '{}' "..      
+0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a190: 2020 2020 2020 2228 7465 6e73 6f72 666c        "(tensorfl
+0000a1a0: 6f77 2054 656e 736f 7220 6f72 204e 6f6e  ow Tensor or Non
+0000a1b0: 6520 7265 7175 6972 6564 2922 2e66 6f72  e required)".for
+0000a1c0: 6d61 7428 7479 7065 2874 656e 736f 7229  mat(type(tensor)
+0000a1d0: 2e5f 5f6e 616d 655f 5f2c 206e 616d 6529  .__name__, name)
+0000a1e0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0000a1f0: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
+0000a200: 7468 2073 656c 662e 6e61 6d65 5f73 636f  th self.name_sco
+0000a210: 7065 3a0d 0a20 2020 2020 2020 2020 2020  pe:..           
+0000a220: 2020 2020 2073 656c 662e 5f62 7566 6665       self._buffe
+0000a230: 7273 5b6e 616d 655d 203d 2074 656e 736f  rs[name] = tenso
+0000a240: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
+0000a250: 2020 2069 6620 7065 7273 6973 7465 6e74     if persistent
+0000a260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000a270: 2020 2020 2020 2073 656c 662e 5f6e 6f6e         self._non
+0000a280: 5f70 6572 7369 7374 656e 745f 6275 6666  _persistent_buff
+0000a290: 6572 735f 7365 742e 6469 7363 6172 6428  ers_set.discard(
+0000a2a0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
+0000a2b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2d0: 2020 7365 6c66 2e5f 6e6f 6e5f 7065 7273    self._non_pers
+0000a2e0: 6973 7465 6e74 5f62 7566 6665 7273 5f73  istent_buffers_s
+0000a2f0: 6574 2e61 6464 286e 616d 6529 0d0a 0d0a  et.add(name)....
+0000a300: 2020 2020 6465 6620 7265 6769 7374 6572      def register
+0000a310: 5f70 6172 616d 6574 6572 2873 656c 662c  _parameter(self,
+0000a320: 2020 6e61 6d65 3a20 7374 722c 2070 6172    name: str, par
+0000a330: 616d 3a20 4f70 7469 6f6e 616c 5b74 662e  am: Optional[tf.
+0000a340: 5661 7269 6162 6c65 5d29 202d 3e20 4e6f  Variable]) -> No
+0000a350: 6e65 3a0d 0a20 2020 2020 2020 2072 2222  ne:..        r""
+0000a360: 2241 6464 7320 6120 7061 7261 6d65 7465  "Adds a paramete
+0000a370: 7220 746f 2074 6865 206d 6f64 756c 652e  r to the module.
+0000a380: 0d0a 0d0a 2020 2020 2020 2020 5468 6520  ....        The 
+0000a390: 7061 7261 6d65 7465 7220 6361 6e20 6265  parameter can be
+0000a3a0: 2061 6363 6573 7365 6420 6173 2061 6e20   accessed as an 
+0000a3b0: 6174 7472 6962 7574 6520 7573 696e 6720  attribute using 
+0000a3c0: 6769 7665 6e20 6e61 6d65 2e0d 0a0d 0a20  given name..... 
+0000a3d0: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
+0000a3e0: 2020 2020 2020 2020 2020 6e61 6d65 2028            name (
+0000a3f0: 7374 7269 6e67 293a 206e 616d 6520 6f66  string): name of
+0000a400: 2074 6865 2070 6172 616d 6574 6572 2e20   the parameter. 
+0000a410: 5468 6520 7061 7261 6d65 7465 7220 6361  The parameter ca
+0000a420: 6e20 6265 2061 6363 6573 7365 640d 0a20  n be accessed.. 
+0000a430: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a440: 726f 6d20 7468 6973 206d 6f64 756c 6520  rom this module 
+0000a450: 7573 696e 6720 7468 6520 6769 7665 6e20  using the given 
+0000a460: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+0000a470: 2020 7061 7261 6d20 2850 6172 616d 6574    param (Paramet
+0000a480: 6572 293a 2070 6172 616d 6574 6572 2074  er): parameter t
+0000a490: 6f20 6265 2061 6464 6564 2074 6f20 7468  o be added to th
+0000a4a0: 6520 6d6f 6475 6c65 2e0d 0a0d 0a20 2020  e module.....   
+0000a4b0: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
+0000a4c0: 2020 2020 6966 2027 5f70 6172 616d 6574      if '_paramet
+0000a4d0: 6572 7327 206e 6f74 2069 6e20 7365 6c66  ers' not in self
+0000a4e0: 2e5f 5f64 6963 745f 5f3a 0d0a 2020 2020  .__dict__:..    
+0000a4f0: 2020 2020 2020 2020 7261 6973 6520 4174          raise At
+0000a500: 7472 6962 7574 6545 7272 6f72 2822 6361  tributeError("ca
+0000a510: 6e6e 6f74 2061 7373 6967 6e20 7061 7261  nnot assign para
+0000a520: 6d65 7465 7220 6265 666f 7265 204d 6f64  meter before Mod
+0000a530: 756c 652e 5f5f 696e 6974 5f5f 2829 2063  ule.__init__() c
+0000a540: 616c 6c22 290d 0a0d 0a20 2020 2020 2020  all")....       
+0000a550: 2065 6c69 6620 6e6f 7420 6973 696e 7374   elif not isinst
+0000a560: 616e 6365 286e 616d 652c 2073 7472 293a  ance(name, str):
+0000a570: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0000a580: 6973 6520 5479 7065 4572 726f 7228 2270  ise TypeError("p
+0000a590: 6172 616d 6574 6572 206e 616d 6520 7368  arameter name sh
+0000a5a0: 6f75 6c64 2062 6520 6120 7374 7269 6e67  ould be a string
+0000a5b0: 2e20 220d 0a20 2020 2020 2020 2020 2020  . "..           
+0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5d0: 2022 476f 7420 7b7d 222e 666f 726d 6174   "Got {}".format
+0000a5e0: 2874 7970 6528 6e61 6d65 292e 5f5f 6e61  (type(name).__na
+0000a5f0: 6d65 5f5f 2929 0d0a 2020 2020 2020 2020  me__))..        
+0000a600: 656c 6966 2027 2e27 2069 6e20 6e61 6d65  elif '.' in name
+0000a610: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000a620: 6169 7365 204b 6579 4572 726f 7228 2270  aise KeyError("p
+0000a630: 6172 616d 6574 6572 206e 616d 6520 6361  arameter name ca
+0000a640: 6e27 7420 636f 6e74 6169 6e20 5c22 2e5c  n't contain \".\
+0000a650: 2222 290d 0a20 2020 2020 2020 2065 6c69  "")..        eli
+0000a660: 6620 6e61 6d65 203d 3d20 2727 3a0d 0a20  f name == '':.. 
+0000a670: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000a680: 204b 6579 4572 726f 7228 2270 6172 616d   KeyError("param
+0000a690: 6574 6572 206e 616d 6520 6361 6e27 7420  eter name can't 
+0000a6a0: 6265 2065 6d70 7479 2073 7472 696e 6720  be empty string 
+0000a6b0: 5c22 5c22 2229 0d0a 2020 2020 2020 2020  \"\"")..        
+0000a6c0: 656c 6966 2068 6173 6174 7472 2873 656c  elif hasattr(sel
+0000a6d0: 662c 206e 616d 6529 2061 6e64 206e 616d  f, name) and nam
+0000a6e0: 6520 6e6f 7420 696e 2073 656c 662e 5f70  e not in self._p
+0000a6f0: 6172 616d 6574 6572 733a 0d0a 2020 2020  arameters:..    
+0000a700: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
+0000a710: 7945 7272 6f72 2822 6174 7472 6962 7574  yError("attribut
+0000a720: 6520 277b 7d27 2061 6c72 6561 6479 2065  e '{}' already e
+0000a730: 7869 7374 7322 2e66 6f72 6d61 7428 6e61  xists".format(na
+0000a740: 6d65 2929 0d0a 0d0a 2020 2020 2020 2020  me))....        
+0000a750: 6966 2070 6172 616d 2069 7320 4e6f 6e65  if param is None
+0000a760: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000a770: 656c 662e 5f70 6172 616d 6574 6572 735b  elf._parameters[
+0000a780: 6e61 6d65 5d20 3d20 4e6f 6e65 0d0a 2020  name] = None..  
+0000a790: 2020 2020 2020 656c 6966 206e 6f74 2069        elif not i
+0000a7a0: 7369 6e73 7461 6e63 6528 7061 7261 6d2c  sinstance(param,
+0000a7b0: 2074 662e 5661 7269 6162 6c65 293a 0d0a   tf.Variable):..
+0000a7c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000a7d0: 6520 5479 7065 4572 726f 7228 2263 616e  e TypeError("can
+0000a7e0: 6e6f 7420 6173 7369 676e 2027 7b7d 2720  not assign '{}' 
+0000a7f0: 6f62 6a65 6374 2074 6f20 7061 7261 6d65  object to parame
+0000a800: 7465 7220 277b 7d27 2022 0d0a 2020 2020  ter '{}' "..    
+0000a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a820: 2020 2020 2020 2020 2228 7466 2e56 6172          "(tf.Var
+0000a830: 6961 626c 6520 6f72 204e 6f6e 6520 7265  iable or None re
+0000a840: 7175 6972 6564 2922 2e66 6f72 6d61 7428  quired)".format(
+0000a850: 7479 7065 2870 6172 616d 292e 5f5f 6e61  type(param).__na
+0000a860: 6d65 5f5f 2c20 6e61 6d65 2929 0d0a 2020  me__, name))..  
+0000a870: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000a880: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
+0000a890: 6172 616d 6574 6572 735b 6e61 6d65 5d20  arameters[name] 
+0000a8a0: 3d20 7061 7261 6d0d 0a0d 0a20 2020 2064  = param....    d
+0000a8b0: 6566 2074 6f28 7365 6c66 3a20 542c 202a  ef to(self: T, *
+0000a8c0: 6172 6773 2920 2d3e 2054 3a0d 0a20 2020  args) -> T:..   
+0000a8d0: 2020 2020 2064 6576 6963 6520 3d20 4e6f       device = No
+0000a8e0: 6e65 0d0a 2020 2020 2020 2020 6474 7970  ne..        dtyp
+0000a8f0: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+0000a900: 2020 6e6f 6e5f 626c 6f63 6b69 6e67 203d    non_blocking =
+0000a910: 204e 6f6e 650d 0a20 2020 2020 2020 2066   None..        f
+0000a920: 6f72 2061 7267 2069 6e20 6172 6773 3a0d  or arg in args:.
+0000a930: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000a940: 2763 7075 2720 696e 2061 7267 2e6c 6f77  'cpu' in arg.low
+0000a950: 6572 2829 206f 7220 2767 7075 2720 696e  er() or 'gpu' in
+0000a960: 2061 7267 2e6c 6f77 6572 2829 206f 7220   arg.lower() or 
+0000a970: 2763 7564 7527 2069 6e20 6172 672e 6c6f  'cudu' in arg.lo
+0000a980: 7765 7228 293a 0d0a 2020 2020 2020 2020  wer():..        
+0000a990: 2020 2020 2020 2020 6465 7669 6365 203d          device =
+0000a9a0: 2061 7267 0d0a 2020 2020 2020 2020 2020   arg..          
+0000a9b0: 2020 656c 6966 2061 7267 2e6c 6f77 6572    elif arg.lower
+0000a9c0: 2829 2069 6e20 5b27 666c 6f61 7427 2c20  () in ['float', 
+0000a9d0: 2769 6e74 272c 2027 626f 6f6c 272c 2027  'int', 'bool', '
+0000a9e0: 6861 6c66 272c 2027 6c6f 6e67 275d 3a0d  half', 'long']:.
+0000a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aa00: 2064 7479 7065 203d 2061 7267 0d0a 2020   dtype = arg..  
+0000aa10: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+0000aa20: 7369 6e73 7461 6e63 6528 6172 672c 2062  sinstance(arg, b
+0000aa30: 6f6f 6c29 3a0d 0a20 2020 2020 2020 2020  ool):..         
+0000aa40: 2020 2020 2020 206e 6f6e 5f62 6c6f 636b         non_block
+0000aa50: 696e 6720 3d20 6172 670d 0a0d 0a20 2020  ing = arg....   
+0000aa60: 2020 2020 2069 6620 6465 7669 6365 2069       if device i
+0000aa70: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0000aa80: 2020 2020 2064 6576 6963 6520 3d20 6765       device = ge
+0000aa90: 745f 6465 7669 6365 2829 0d0a 2020 2020  t_device()..    
+0000aaa0: 2020 2020 6966 2064 7479 7065 2069 7320      if dtype is 
+0000aab0: 4e6f 6e65 2061 6e64 206c 656e 2873 656c  None and len(sel
+0000aac0: 662e 7765 6967 6874 7329 203e 2030 3a0d  f.weights) > 0:.
+0000aad0: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+0000aae0: 7065 203d 2073 656c 662e 7765 6967 6874  pe = self.weight
+0000aaf0: 735b 305d 2e64 7479 7065 0d0a 2020 2020  s[0].dtype..    
+0000ab00: 2020 2020 6966 2027 6370 7527 2069 6e20      if 'cpu' in 
+0000ab10: 6465 7669 6365 3a0d 0a20 2020 2020 2020  device:..       
+0000ab20: 2020 2020 2073 656c 662e 6370 7528 290d       self.cpu().
+0000ab30: 0a20 2020 2020 2020 2065 6c69 6620 2767  .        elif 'g
+0000ab40: 7075 2720 696e 2064 6576 6963 6520 6f72  pu' in device or
+0000ab50: 2027 6375 6461 2720 696e 2064 6576 6963   'cuda' in devic
+0000ab60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000ab70: 7365 6c66 2e63 7564 6128 290d 0a20 2020  self.cuda()..   
+0000ab80: 2020 2020 2066 6f72 206d 6f64 756c 6520       for module 
+0000ab90: 696e 2073 656c 662e 6d6f 6475 6c65 7328  in self.modules(
+0000aba0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000abb0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0000abc0: 2020 2020 2020 6966 206d 6f64 756c 652e        if module.
+0000abd0: 5f70 6172 616d 6574 6572 7320 6973 206e  _parameters is n
+0000abe0: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
+0000abf0: 6d6f 6475 6c65 2e5f 7061 7261 6d65 7465  module._paramete
+0000ac00: 7273 2920 3e20 303a 0d0a 2020 2020 2020  rs) > 0:..      
+0000ac10: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000ac20: 7220 6e61 6d65 2c20 7061 7261 2069 6e20  r name, para in 
+0000ac30: 6d6f 6475 6c65 2e5f 7061 7261 6d65 7465  module._paramete
+0000ac40: 7273 2e69 7465 6d73 2829 3a0d 0a20 2020  rs.items():..   
+0000ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac60: 2020 2020 2069 6620 7061 7261 2069 7320       if para is 
+0000ac70: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac90: 2020 206d 6f64 756c 652e 5f70 6172 616d     module._param
+0000aca0: 6574 6572 735b 6e61 6d65 5d20 3d20 4e6f  eters[name] = No
+0000acb0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0000acc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000acd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000ace0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000acf0: 6f64 756c 652e 5f70 6172 616d 6574 6572  odule._parameter
+0000ad00: 735b 6e61 6d65 5d2e 6173 7369 676e 2874  s[name].assign(t
+0000ad10: 662e 6964 656e 7469 7479 2863 6173 7428  f.identity(cast(
+0000ad20: 7061 7261 2e76 616c 7565 2829 2c20 6474  para.value(), dt
+0000ad30: 7970 6529 2929 0d0a 2020 2020 2020 2020  ype)))..        
+0000ad40: 2020 2020 2020 2020 6966 206d 6f64 756c          if modul
+0000ad50: 652e 5f62 7566 6665 7273 2069 7320 6e6f  e._buffers is no
+0000ad60: 7420 4e6f 6e65 2061 6e64 206c 656e 286d  t None and len(m
+0000ad70: 6f64 756c 652e 5f62 7566 6665 7273 2920  odule._buffers) 
+0000ad80: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+0000ad90: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
+0000ada0: 6d65 2c20 6275 6666 2069 6e20 6d6f 6475  me, buff in modu
+0000adb0: 6c65 2e5f 6275 6666 6572 732e 6974 656d  le._buffers.item
+0000adc0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+0000add0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000ade0: 2062 7566 6620 6973 204e 6f6e 653a 0d0a   buff is None:..
+0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae00: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+0000ae10: 6c65 2e5f 6275 6666 6572 735b 6e61 6d65  le._buffers[name
+0000ae20: 5d20 3d20 4e6f 6e65 0d0a 2020 2020 2020  ] = None..      
+0000ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae40: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae60: 2020 2020 206d 6f64 756c 652e 5f62 7566       module._buf
+0000ae70: 6665 7273 5b6e 616d 655d 203d 2074 662e  fers[name] = tf.
+0000ae80: 6964 656e 7469 7479 2863 6173 7428 6275  identity(cast(bu
+0000ae90: 6666 2c20 6474 7970 6529 290d 0a20 2020  ff, dtype))..   
+0000aea0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000aeb0: 756c 652e 6465 7669 6365 203d 2073 656c  ule.device = sel
+0000aec0: 662e 6465 7669 6365 0d0a 2020 2020 2020  f.device..      
+0000aed0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000aee0: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
+0000aef0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000af00: 696e 7428 6529 0d0a 2020 2020 2020 2020  int(e)..        
+0000af10: 2020 2020 2020 2020 5072 696e 7445 7863          PrintExc
+0000af20: 6570 7469 6f6e 2829 0d0a 0d0a 2020 2020  eption()....    
+0000af30: 6465 6620 6375 6461 2873 656c 663a 2054  def cuda(self: T
+0000af40: 2c20 6465 7669 6365 3a20 4f70 7469 6f6e  , device: Option
+0000af50: 616c 5b55 6e69 6f6e 5b69 6e74 2c20 7374  al[Union[int, st
+0000af60: 725d 5d20 3d20 4e6f 6e65 2920 2d3e 2054  r]] = None) -> T
+0000af70: 3a0d 0a20 2020 2020 2020 2072 2222 224d  :..        r"""M
+0000af80: 6f76 6573 2061 6c6c 206d 6f64 656c 2070  oves all model p
+0000af90: 6172 616d 6574 6572 7320 616e 6420 6275  arameters and bu
+0000afa0: 6666 6572 7320 746f 2074 6865 2047 5055  ffers to the GPU
+0000afb0: 2e0d 0a0d 0a20 2020 2020 2020 2054 6869  .....        Thi
+0000afc0: 7320 616c 736f 206d 616b 6573 2061 7373  s also makes ass
+0000afd0: 6f63 6961 7465 6420 7061 7261 6d65 7465  ociated paramete
+0000afe0: 7273 2061 6e64 2062 7566 6665 7273 2064  rs and buffers d
+0000aff0: 6966 6665 7265 6e74 206f 626a 6563 7473  ifferent objects
+0000b000: 2e20 536f 0d0a 2020 2020 2020 2020 6974  . So..        it
+0000b010: 2073 686f 756c 6420 6265 2063 616c 6c65   should be calle
+0000b020: 6420 6265 666f 7265 2063 6f6e 7374 7275  d before constru
+0000b030: 6374 696e 6720 6f70 7469 6d69 7a65 7220  cting optimizer 
+0000b040: 6966 2074 6865 206d 6f64 756c 6520 7769  if the module wi
+0000b050: 6c6c 0d0a 2020 2020 2020 2020 6c69 7665  ll..        live
+0000b060: 206f 6e20 4750 5520 7768 696c 6520 6265   on GPU while be
+0000b070: 696e 6720 6f70 7469 6d69 7a65 642e 0d0a  ing optimized...
+0000b080: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
+0000b090: 0a20 2020 2020 2020 2020 2020 2064 6576  .            dev
+0000b0a0: 6963 6520 2869 6e74 2c20 6f70 7469 6f6e  ice (int, option
+0000b0b0: 616c 293a 2069 6620 7370 6563 6966 6965  al): if specifie
+0000b0c0: 642c 2061 6c6c 2070 6172 616d 6574 6572  d, all parameter
+0000b0d0: 7320 7769 6c6c 2062 650d 0a20 2020 2020  s will be..     
+0000b0e0: 2020 2020 2020 2020 2020 2063 6f70 6965             copie
+0000b0f0: 6420 746f 2074 6861 7420 6465 7669 6365  d to that device
+0000b100: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0000b110: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+0000b120: 2020 4d6f 6475 6c65 3a20 7365 6c66 0d0a    Module: self..
+0000b130: 2020 2020 2020 2020 2222 220d 0a0d 0a20          """.... 
+0000b140: 2020 2020 2020 2069 6620 7466 2e74 6573         if tf.tes
+0000b150: 742e 6973 5f67 7075 5f61 7661 696c 6162  t.is_gpu_availab
+0000b160: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
+0000b170: 2069 6620 7365 6c66 2e67 6574 5f72 6f6f   if self.get_roo
+0000b180: 7428 292e 6465 7669 6365 2021 3d20 272f  t().device != '/
+0000b190: 6770 753a 3027 3a0d 0a20 2020 2020 2020  gpu:0':..       
+0000b1a0: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
+0000b1b0: 745f 726f 6f74 2829 2e64 6576 6963 6520  t_root().device 
+0000b1c0: 3d20 272f 6770 753a 3027 0d0a 2020 2020  = '/gpu:0'..    
+0000b1d0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000b1e0: 2074 662e 6465 7669 6365 2873 656c 662e   tf.device(self.
+0000b1f0: 6465 7669 6365 293a 0d0a 2020 2020 2020  device):..      
+0000b200: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000b210: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
+0000b220: 286c 616d 6264 6120 743a 2074 662e 6964  (lambda t: tf.id
+0000b230: 656e 7469 7479 2874 2929 0d0a 0d0a 2020  entity(t))....  
+0000b240: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000b250: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0000b260: 6572 722e 7772 6974 6528 2747 5055 2069  err.write('GPU i
+0000b270: 7320 6e6f 7420 6176 6169 6c61 626c 6520  s not available 
+0000b280: 696e 2074 6869 7320 6d61 6368 6f6e 652e  in this machone.
+0000b290: 2f6e 2729 0d0a 0d0a 2020 2020 6465 6620  /n')....    def 
+0000b2a0: 6370 7528 7365 6c66 3a20 5429 202d 3e20  cpu(self: T) -> 
+0000b2b0: 543a 0d0a 2020 2020 2020 2020 7222 2222  T:..        r"""
+0000b2c0: 4d6f 7665 7320 616c 6c20 6d6f 6465 6c20  Moves all model 
+0000b2d0: 7061 7261 6d65 7465 7273 2061 6e64 2062  parameters and b
+0000b2e0: 7566 6665 7273 2074 6f20 7468 6520 4350  uffers to the CP
+0000b2f0: 552e 0d0a 0d0a 2020 2020 2020 2020 5265  U.....        Re
+0000b300: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
+0000b310: 2020 2020 4d6f 6475 6c65 3a20 7365 6c66      Module: self
+0000b320: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0000b330: 2020 2020 2020 2069 6620 7365 6c66 2e67         if self.g
+0000b340: 6574 5f72 6f6f 7428 292e 6465 7669 6365  et_root().device
+0000b350: 2021 3d20 272f 6370 753a 3027 3a0d 0a20   != '/cpu:0':.. 
+0000b360: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000b370: 7466 2e64 6576 6963 6528 272f 6370 753a  tf.device('/cpu:
+0000b380: 3027 293a 0d0a 2020 2020 2020 2020 2020  0'):..          
+0000b390: 2020 2020 2020 7365 6c66 2e67 6574 5f72        self.get_r
+0000b3a0: 6f6f 7428 292e 6465 7669 6365 203d 2027  oot().device = '
+0000b3b0: 2f63 7075 3a30 270d 0a20 2020 2020 2020  /cpu:0'..       
+0000b3c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b3d0: 7365 6c66 2e5f 6170 706c 7928 6c61 6d62  self._apply(lamb
+0000b3e0: 6461 2074 3a20 7466 2e69 6465 6e74 6974  da t: tf.identit
+0000b3f0: 7928 7429 290d 0a0d 0a20 2020 2064 6566  y(t))....    def
+0000b400: 2067 7075 2873 656c 663a 2054 2c20 6465   gpu(self: T, de
+0000b410: 7669 6365 3a20 4f70 7469 6f6e 616c 5b55  vice: Optional[U
+0000b420: 6e69 6f6e 5b69 6e74 2c20 7374 725d 5d20  nion[int, str]] 
+0000b430: 3d20 4e6f 6e65 2920 2d3e 2054 3a0d 0a20  = None) -> T:.. 
+0000b440: 2020 2020 2020 2072 2222 224d 6f76 6573         r"""Moves
+0000b450: 2061 6c6c 206d 6f64 656c 2070 6172 616d   all model param
+0000b460: 6574 6572 7320 616e 6420 6275 6666 6572  eters and buffer
+0000b470: 7320 746f 2074 6865 2047 5055 2e0d 0a0d  s to the GPU....
+0000b480: 0a20 2020 2020 2020 2054 6869 7320 616c  .        This al
+0000b490: 736f 206d 616b 6573 2061 7373 6f63 6961  so makes associa
+0000b4a0: 7465 6420 7061 7261 6d65 7465 7273 2061  ted parameters a
+0000b4b0: 6e64 2062 7566 6665 7273 2064 6966 6665  nd buffers diffe
+0000b4c0: 7265 6e74 206f 626a 6563 7473 2e20 536f  rent objects. So
+0000b4d0: 0d0a 2020 2020 2020 2020 6974 2073 686f  ..        it sho
+0000b4e0: 756c 6420 6265 2063 616c 6c65 6420 6265  uld be called be
+0000b4f0: 666f 7265 2063 6f6e 7374 7275 6374 696e  fore constructin
+0000b500: 6720 6f70 7469 6d69 7a65 7220 6966 2074  g optimizer if t
+0000b510: 6865 206d 6f64 756c 6520 7769 6c6c 0d0a  he module will..
+0000b520: 2020 2020 2020 2020 6c69 7665 206f 6e20          live on 
+0000b530: 4750 5520 7768 696c 6520 6265 696e 6720  GPU while being 
+0000b540: 6f70 7469 6d69 7a65 642e 0d0a 0d0a 2020  optimized.....  
+0000b550: 2020 2020 2020 4172 6773 3a0d 0a20 2020        Args:..   
+0000b560: 2020 2020 2020 2020 2064 6576 6963 6520           device 
+0000b570: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
+0000b580: 2069 6620 7370 6563 6966 6965 642c 2061   if specified, a
+0000b590: 6c6c 2070 6172 616d 6574 6572 7320 7769  ll parameters wi
+0000b5a0: 6c6c 2062 650d 0a20 2020 2020 2020 2020  ll be..         
+0000b5b0: 2020 2020 2020 2063 6f70 6965 6420 746f         copied to
+0000b5c0: 2074 6861 7420 6465 7669 6365 0d0a 0d0a   that device....
+0000b5d0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+0000b5e0: 0d0a 2020 2020 2020 2020 2020 2020 4d6f  ..            Mo
+0000b5f0: 6475 6c65 3a20 7365 6c66 0d0a 2020 2020  dule: self..    
+0000b600: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
+0000b610: 2020 2069 6620 7466 2e74 6573 742e 6973     if tf.test.is
+0000b620: 5f67 7075 5f61 7661 696c 6162 6c65 3a0d  _gpu_available:.
+0000b630: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b640: 7365 6c66 2e67 6574 5f72 6f6f 7428 292e  self.get_root().
+0000b650: 6465 7669 6365 2021 3d20 272f 6770 753a  device != '/gpu:
+0000b660: 3027 3a0d 0a20 2020 2020 2020 2020 2020  0':..           
+0000b670: 2020 2020 2073 656c 662e 6765 745f 726f       self.get_ro
+0000b680: 6f74 2829 2e64 6576 6963 6520 3d20 272f  ot().device = '/
+0000b690: 6770 753a 3027 0d0a 2020 2020 2020 2020  gpu:0'..        
+0000b6a0: 2020 2020 2020 2020 7769 7468 2074 662e          with tf.
+0000b6b0: 6465 7669 6365 2873 656c 662e 6465 7669  device(self.devi
+0000b6c0: 6365 293a 0d0a 2020 2020 2020 2020 2020  ce):..          
+0000b6d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000b6e0: 2073 656c 662e 5f61 7070 6c79 286c 616d   self._apply(lam
+0000b6f0: 6264 6120 743a 2074 662e 6964 656e 7469  bda t: tf.identi
+0000b700: 7479 2874 2929 0d0a 0d0a 2020 2020 2020  ty(t))....      
+0000b710: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000b720: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+0000b730: 7772 6974 6528 2747 5055 2069 7320 6e6f  write('GPU is no
+0000b740: 7420 6176 6169 6c61 626c 6520 696e 2074  t available in t
+0000b750: 6869 7320 6d61 6368 6f6e 652e 2f6e 2729  his machone./n')
+0000b760: 0d0a 0d0a 2020 2020 6465 6620 5f61 7070  ....    def _app
+0000b770: 6c79 2873 656c 662c 2066 6e29 3a0d 0a20  ly(self, fn):.. 
+0000b780: 2020 2020 2020 2066 6f72 206d 6f64 756c         for modul
+0000b790: 6520 696e 2073 656c 662e 6368 696c 6472  e in self.childr
+0000b7a0: 656e 2829 3a0d 0a20 2020 2020 2020 2020  en():..         
+0000b7b0: 2020 206d 6f64 756c 652e 5f61 7070 6c79     module._apply
+0000b7c0: 2866 6e29 0d0a 0d0a 2020 2020 2020 2020  (fn)....        
+0000b7d0: 666f 7220 6b65 792c 2070 6172 616d 2069  for key, param i
+0000b7e0: 6e20 7365 6c66 2e5f 7061 7261 6d65 7465  n self._paramete
+0000b7f0: 7273 2e69 7465 6d73 2829 3a0d 0a20 2020  rs.items():..   
+0000b800: 2020 2020 2020 2020 2069 6620 7061 7261           if para
+0000b810: 6d20 6973 206e 6f74 204e 6f6e 653a 0d0a  m is not None:..
+0000b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b830: 2320 5465 6e73 6f72 7320 7374 6f72 6564  # Tensors stored
+0000b840: 2069 6e20 6d6f 6475 6c65 7320 6172 6520   in modules are 
+0000b850: 6772 6170 6820 6c65 6176 6573 2c20 616e  graph leaves, an
+0000b860: 6420 7765 2064 6f6e 2774 2077 616e 7420  d we don't want 
+0000b870: 746f 0d0a 2020 2020 2020 2020 2020 2020  to..            
+0000b880: 2020 2020 2320 7472 6163 6b20 6175 746f      # track auto
+0000b890: 6772 6164 2068 6973 746f 7279 206f 6620  grad history of 
+0000b8a0: 6070 6172 616d 5f61 7070 6c69 6564 602c  `param_applied`,
+0000b8b0: 2073 6f20 7765 2068 6176 6520 746f 2075   so we have to u
+0000b8c0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+0000b8d0: 2020 2020 2320 6077 6974 6820 746f 7263      # `with torc
+0000b8e0: 682e 6e6f 5f67 7261 6428 293a 600d 0a20  h.no_grad():`.. 
+0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000b900: 6172 616d 5f61 7070 6c69 6564 203d 2066  aram_applied = f
+0000b910: 6e28 7061 7261 6d29 0d0a 2020 2020 2020  n(param)..      
+0000b920: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0000b930: 6e73 7461 6e63 6528 7061 7261 6d2c 2074  nstance(param, t
+0000b940: 662e 5661 7269 6162 6c65 293a 0d0a 2020  f.Variable):..  
+0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b960: 2020 7365 6c66 2e5f 7061 7261 6d65 7465    self._paramete
+0000b970: 7273 5b6b 6579 5d20 3d20 5061 7261 6d65  rs[key] = Parame
+0000b980: 7465 7228 7061 7261 6d5f 6170 706c 6965  ter(param_applie
+0000b990: 642c 2074 7261 696e 6162 6c65 3d70 6172  d, trainable=par
+0000b9a0: 616d 2e74 7261 696e 6162 6c65 290d 0a20  am.trainable).. 
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000b9c0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0000b9d0: 2020 2020 2020 2020 2020 7061 7261 6d20            param 
+0000b9e0: 3d20 7061 7261 6d5f 6170 706c 6965 640d  = param_applied.
+0000b9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba00: 2023 0d0a 2020 2020 2020 2020 2020 2020   #..            
+0000ba10: 2020 2020 2320 6966 2070 6172 616d 2e67      # if param.g
+0000ba20: 7261 6420 6973 206e 6f74 204e 6f6e 653a  rad is not None:
+0000ba30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ba40: 2020 2320 2020 2020 6772 6164 5f61 7070    #     grad_app
+0000ba50: 6c69 6564 203d 2066 6e28 7061 7261 6d2e  lied = fn(param.
+0000ba60: 6772 6164 290d 0a20 2020 2020 2020 2020  grad)..         
+0000ba70: 2020 2020 2020 2023 2020 2020 2073 686f         #     sho
+0000ba80: 756c 645f 7573 655f 7365 745f 6461 7461  uld_use_set_data
+0000ba90: 203d 2063 6f6d 7075 7465 5f73 686f 756c   = compute_shoul
+0000baa0: 645f 7573 655f 7365 745f 6461 7461 2870  d_use_set_data(p
+0000bab0: 6172 616d 2e67 7261 642c 2067 7261 645f  aram.grad, grad_
+0000bac0: 6170 706c 6965 6429 0d0a 2020 2020 2020  applied)..      
+0000bad0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0000bae0: 6966 2073 686f 756c 645f 7573 655f 7365  if should_use_se
+0000baf0: 745f 6461 7461 3a0d 0a20 2020 2020 2020  t_data:..       
+0000bb00: 2020 2020 2020 2020 2023 2020 2020 2020           #      
+0000bb10: 2020 2070 6172 616d 2e67 7261 642e 6461     param.grad.da
+0000bb20: 7461 203d 2067 7261 645f 6170 706c 6965  ta = grad_applie
+0000bb30: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
+0000bb40: 2020 2023 2020 2020 2065 6c73 653a 0d0a     #     else:..
+0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb60: 2320 2020 2020 2020 2020 6173 7365 7274  #         assert
+0000bb70: 2070 6172 616d 2e67 7261 642e 6973 5f6c   param.grad.is_l
+0000bb80: 6561 660d 0a20 2020 2020 2020 2020 2020  eaf..           
+0000bb90: 2020 2020 2023 2020 2020 2020 2020 2073       #         s
+0000bba0: 656c 662e 5f70 6172 616d 6574 6572 735b  elf._parameters[
+0000bbb0: 6b65 795d 2e67 7261 6420 3d20 6772 6164  key].grad = grad
+0000bbc0: 5f61 7070 6c69 6564 2e72 6571 7569 7265  _applied.require
+0000bbd0: 735f 6772 6164 5f28 7061 7261 6d2e 6772  s_grad_(param.gr
+0000bbe0: 6164 2e72 6571 7569 7265 735f 6772 6164  ad.requires_grad
+0000bbf0: 290d 0a0d 0a20 2020 2020 2020 2066 6f72  )....        for
+0000bc00: 206b 6579 2c20 6275 6620 696e 2073 656c   key, buf in sel
+0000bc10: 662e 5f62 7566 6665 7273 2e69 7465 6d73  f._buffers.items
+0000bc20: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0000bc30: 2069 6620 6275 6620 6973 206e 6f74 204e   if buf is not N
+0000bc40: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0000bc50: 2020 2020 2020 7365 6c66 2e5f 6275 6666        self._buff
+0000bc60: 6572 735b 6b65 795d 203d 2066 6e28 6275  ers[key] = fn(bu
+0000bc70: 6629 0d0a 0d0a 2020 2020 2020 2020 7265  f)....        re
+0000bc80: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
+0000bc90: 2064 6566 2061 7070 6c79 2873 656c 663a   def apply(self:
+0000bca0: 2054 2c20 666e 3a20 4361 6c6c 6162 6c65   T, fn: Callable
+0000bcb0: 5b5b 274d 6f64 756c 6527 5d2c 204e 6f6e  [['Module'], Non
+0000bcc0: 655d 2920 2d3e 2054 3a0d 0a20 2020 2020  e]) -> T:..     
+0000bcd0: 2020 2072 2222 2241 7070 6c69 6573 2060     r"""Applies `
+0000bce0: 6066 6e60 6020 7265 6375 7273 6976 656c  `fn`` recursivel
+0000bcf0: 7920 746f 2065 7665 7279 2073 7562 6d6f  y to every submo
+0000bd00: 6475 6c65 2028 6173 2072 6574 7572 6e65  dule (as returne
+0000bd10: 6420 6279 2060 602e 6368 696c 6472 656e  d by ``.children
+0000bd20: 2829 6060 290d 0a20 2020 2020 2020 2061  ()``)..        a
+0000bd30: 7320 7765 6c6c 2061 7320 7365 6c66 2e20  s well as self. 
+0000bd40: 5479 7069 6361 6c20 7573 6520 696e 636c  Typical use incl
+0000bd50: 7564 6573 2069 6e69 7469 616c 697a 696e  udes initializin
+0000bd60: 6720 7468 6520 7061 7261 6d65 7465 7273  g the parameters
+0000bd70: 206f 6620 6120 6d6f 6465 6c0d 0a20 2020   of a model..   
+0000bd80: 2020 2020 2028 7365 6520 616c 736f 203a       (see also :
+0000bd90: 7265 663a 606e 6e2d 696e 6974 2d64 6f63  ref:`nn-init-doc
+0000bda0: 6029 2e0d 0a0d 0a20 2020 2020 2020 2041  `).....        A
+0000bdb0: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+0000bdc0: 2020 666e 2028 3a63 6c61 7373 3a60 4d6f    fn (:class:`Mo
+0000bdd0: 6475 6c65 6020 2d3e 204e 6f6e 6529 3a20  dule` -> None): 
+0000bde0: 6675 6e63 7469 6f6e 2074 6f20 6265 2061  function to be a
+0000bdf0: 7070 6c69 6564 2074 6f20 6561 6368 2073  pplied to each s
+0000be00: 7562 6d6f 6475 6c65 0d0a 0d0a 2020 2020  ubmodule....    
+0000be10: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
+0000be20: 2020 2020 2020 2020 2020 4d6f 6475 6c65            Module
+0000be30: 3a20 7365 6c66 0d0a 0d0a 2020 2020 2020  : self....      
+0000be40: 2020 4578 616d 706c 653a 3a0d 0a0d 0a20    Example::.... 
+0000be50: 2020 2020 2020 2020 2020 203e 3e3e 2040             >>> @
+0000be60: 746f 7263 682e 6e6f 5f67 7261 6428 290d  torch.no_grad().
+0000be70: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+0000be80: 2064 6566 2069 6e69 745f 7765 6967 6874   def init_weight
+0000be90: 7328 6d29 3a0d 0a20 2020 2020 2020 2020  s(m):..         
+0000bea0: 2020 203e 3e3e 2020 2020 2070 7269 6e74     >>>     print
+0000beb0: 286d 290d 0a20 2020 2020 2020 2020 2020  (m)..           
+0000bec0: 203e 3e3e 2020 2020 2069 6620 7479 7065   >>>     if type
+0000bed0: 286d 2920 3d3d 206e 6e2e 4c69 6e65 6172  (m) == nn.Linear
+0000bee0: 3a0d 0a20 2020 2020 2020 2020 2020 203e  :..            >
+0000bef0: 3e3e 2020 2020 2020 2020 206d 2e77 6569  >>         m.wei
+0000bf00: 6768 742e 6669 6c6c 5f28 312e 3029 0d0a  ght.fill_(1.0)..
+0000bf10: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+0000bf20: 2020 2020 2020 2020 7072 696e 7428 6d2e          print(m.
+0000bf30: 7765 6967 6874 290d 0a20 2020 2020 2020  weight)..       
+0000bf40: 2020 2020 203e 3e3e 206e 6574 203d 206e       >>> net = n
+0000bf50: 6e2e 5365 7175 656e 7469 616c 286e 6e2e  n.Sequential(nn.
+0000bf60: 4c69 6e65 6172 2832 2c20 3229 2c20 6e6e  Linear(2, 2), nn
+0000bf70: 2e4c 696e 6561 7228 322c 2032 2929 0d0a  .Linear(2, 2))..
+0000bf80: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+0000bf90: 6e65 742e 6170 706c 7928 696e 6974 5f77  net.apply(init_w
+0000bfa0: 6569 6768 7473 290d 0a20 2020 2020 2020  eights)..       
+0000bfb0: 2020 2020 204c 696e 6561 7228 696e 5f66       Linear(in_f
+0000bfc0: 6561 7475 7265 733d 322c 206f 7574 5f66  eatures=2, out_f
+0000bfd0: 6561 7475 7265 733d 322c 2062 6961 733d  eatures=2, bias=
+0000bfe0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+0000bff0: 2020 2050 6172 616d 6574 6572 2063 6f6e     Parameter con
+0000c000: 7461 696e 696e 673a 0d0a 2020 2020 2020  taining:..      
+0000c010: 2020 2020 2020 7465 6e73 6f72 285b 5b20        tensor([[ 
+0000c020: 312e 2c20 2031 2e5d 2c0d 0a20 2020 2020  1.,  1.],..     
+0000c030: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0000c040: 2031 2e2c 2020 312e 5d5d 290d 0a20 2020   1.,  1.]])..   
+0000c050: 2020 2020 2020 2020 204c 696e 6561 7228           Linear(
+0000c060: 696e 5f66 6561 7475 7265 733d 322c 206f  in_features=2, o
+0000c070: 7574 5f66 6561 7475 7265 733d 322c 2062  ut_features=2, b
+0000c080: 6961 733d 5472 7565 290d 0a20 2020 2020  ias=True)..     
+0000c090: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0000c0a0: 2063 6f6e 7461 696e 696e 673a 0d0a 2020   containing:..  
+0000c0b0: 2020 2020 2020 2020 2020 7465 6e73 6f72            tensor
+0000c0c0: 285b 5b20 312e 2c20 2031 2e5d 2c0d 0a20  ([[ 1.,  1.],.. 
+0000c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0e0: 2020 205b 2031 2e2c 2020 312e 5d5d 290d     [ 1.,  1.]]).
+0000c0f0: 0a20 2020 2020 2020 2020 2020 2053 6571  .            Seq
+0000c100: 7565 6e74 6961 6c28 0d0a 2020 2020 2020  uential(..      
+0000c110: 2020 2020 2020 2020 2830 293a 204c 696e          (0): Lin
+0000c120: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
+0000c130: 322c 206f 7574 5f66 6561 7475 7265 733d  2, out_features=
+0000c140: 322c 2062 6961 733d 5472 7565 290d 0a20  2, bias=True).. 
+0000c150: 2020 2020 2020 2020 2020 2020 2028 3129               (1)
+0000c160: 3a20 4c69 6e65 6172 2869 6e5f 6665 6174  : Linear(in_feat
+0000c170: 7572 6573 3d32 2c20 6f75 745f 6665 6174  ures=2, out_feat
+0000c180: 7572 6573 3d32 2c20 6269 6173 3d54 7275  ures=2, bias=Tru
+0000c190: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0000c1a0: 290d 0a20 2020 2020 2020 2020 2020 2053  )..            S
+0000c1b0: 6571 7565 6e74 6961 6c28 0d0a 2020 2020  equential(..    
+0000c1c0: 2020 2020 2020 2020 2020 2830 293a 204c            (0): L
+0000c1d0: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
+0000c1e0: 733d 322c 206f 7574 5f66 6561 7475 7265  s=2, out_feature
+0000c1f0: 733d 322c 2062 6961 733d 5472 7565 290d  s=2, bias=True).
+0000c200: 0a20 2020 2020 2020 2020 2020 2020 2028  .              (
+0000c210: 3129 3a20 4c69 6e65 6172 2869 6e5f 6665  1): Linear(in_fe
+0000c220: 6174 7572 6573 3d32 2c20 6f75 745f 6665  atures=2, out_fe
+0000c230: 6174 7572 6573 3d32 2c20 6269 6173 3d54  atures=2, bias=T
+0000c240: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+0000c250: 2020 290d 0a20 2020 2020 2020 2022 2222    )..        """
+0000c260: 0d0a 2020 2020 2020 2020 666f 7220 6d6f  ..        for mo
+0000c270: 6475 6c65 2069 6e20 7365 6c66 2e63 6869  dule in self.chi
+0000c280: 6c64 7265 6e28 293a 0d0a 2020 2020 2020  ldren():..      
+0000c290: 2020 2020 2020 6d6f 6475 6c65 2e61 7070        module.app
+0000c2a0: 6c79 2866 6e29 0d0a 2020 2020 2020 2020  ly(fn)..        
+0000c2b0: 666e 2873 656c 6629 0d0a 2020 2020 2020  fn(self)..      
+0000c2c0: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+0000c2d0: 0a20 2020 2023 0d0a 2020 2020 2320 6465  .    #..    # de
+0000c2e0: 6620 6375 6461 2873 656c 663a 2054 2c20  f cuda(self: T, 
+0000c2f0: 6465 7669 6365 3a20 4f70 7469 6f6e 616c  device: Optional
+0000c300: 5b55 6e69 6f6e 5b69 6e74 2c20 7374 725d  [Union[int, str]
+0000c310: 5d20 3d20 4e6f 6e65 2920 2d3e 2054 3a0d  ] = None) -> T:.
+0000c320: 0a20 2020 2023 2020 2020 2072 2222 224d  .    #     r"""M
+0000c330: 6f76 6573 2061 6c6c 206d 6f64 656c 2070  oves all model p
+0000c340: 6172 616d 6574 6572 7320 616e 6420 6275  arameters and bu
+0000c350: 6666 6572 7320 746f 2074 6865 2047 5055  ffers to the GPU
+0000c360: 2e0d 0a20 2020 2023 0d0a 2020 2020 2320  ...    #..    # 
+0000c370: 2020 2020 5468 6973 2061 6c73 6f20 6d61      This also ma
+0000c380: 6b65 7320 6173 736f 6369 6174 6564 2070  kes associated p
+0000c390: 6172 616d 6574 6572 7320 616e 6420 6275  arameters and bu
+0000c3a0: 6666 6572 7320 6469 6666 6572 656e 7420  ffers different 
+0000c3b0: 6f62 6a65 6374 732e 2053 6f0d 0a20 2020  objects. So..   
+0000c3c0: 2023 2020 2020 2069 7420 7368 6f75 6c64   #     it should
+0000c3d0: 2062 6520 6361 6c6c 6564 2062 6566 6f72   be called befor
+0000c3e0: 6520 636f 6e73 7472 7563 7469 6e67 206f  e constructing o
+0000c3f0: 7074 696d 697a 6572 2069 6620 7468 6520  ptimizer if the 
+0000c400: 6d6f 6475 6c65 2077 696c 6c0d 0a20 2020  module will..   
+0000c410: 2023 2020 2020 206c 6976 6520 6f6e 2047   #     live on G
+0000c420: 5055 2077 6869 6c65 2062 6569 6e67 206f  PU while being o
+0000c430: 7074 696d 697a 6564 2e0d 0a20 2020 2023  ptimized...    #
+0000c440: 0d0a 2020 2020 2320 2020 2020 4172 6775  ..    #     Argu
+0000c450: 6d65 6e74 733a 0d0a 2020 2020 2320 2020  ments:..    #   
+0000c460: 2020 2020 2020 6465 7669 6365 2028 696e        device (in
+0000c470: 742c 206f 7074 696f 6e61 6c29 3a20 6966  t, optional): if
+0000c480: 2073 7065 6369 6669 6564 2c20 616c 6c20   specified, all 
+0000c490: 7061 7261 6d65 7465 7273 2077 696c 6c20  parameters will 
+0000c4a0: 6265 0d0a 2020 2020 2320 2020 2020 2020  be..    #       
+0000c4b0: 2020 2020 2020 636f 7069 6564 2074 6f20        copied to 
+0000c4c0: 7468 6174 2064 6576 6963 650d 0a20 2020  that device..   
+0000c4d0: 2023 0d0a 2020 2020 2320 2020 2020 5265   #..    #     Re
+0000c4e0: 7475 726e 733a 0d0a 2020 2020 2320 2020  turns:..    #   
+0000c4f0: 2020 2020 2020 4d6f 6475 6c65 3a20 7365        Module: se
+0000c500: 6c66 0d0a 2020 2020 2320 2020 2020 2222  lf..    #     ""
+0000c510: 220d 0a20 2020 2023 2020 2020 2077 6974  "..    #     wit
+0000c520: 6820 7466 2e64 6576 6963 6528 272f 6770  h tf.device('/gp
+0000c530: 753a 3027 293a 0d0a 2020 2020 2320 2020  u:0'):..    #   
+0000c540: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000c550: 662e 5f61 7070 6c79 286c 616d 6264 6120  f._apply(lambda 
+0000c560: 743a 2074 290d 0a20 2020 2023 2020 2020  t: t)..    #    
+0000c570: 2023 7265 7475 726e 2073 656c 662e 5f61   #return self._a
+0000c580: 7070 6c79 286c 616d 6264 6120 743a 2074  pply(lambda t: t
+0000c590: 2e63 7564 6128 6465 7669 6365 2929 0d0a  .cuda(device))..
+0000c5a0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+0000c5b0: 0a20 2020 2064 6566 2064 6576 6963 6528  .    def device(
+0000c5c0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0000c5d0: 5f72 6f6f 7420 3d20 7365 6c66 2e67 6574  _root = self.get
+0000c5e0: 5f72 6f6f 7428 290d 0a20 2020 2020 2020  _root()..       
+0000c5f0: 2069 6620 7365 6c66 2e69 735f 726f 6f74   if self.is_root
+0000c600: 206f 7220 5f72 6f6f 7420 6973 204e 6f6e   or _root is Non
+0000c610: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000c620: 6966 206c 656e 2873 656c 662e 7765 6967  if len(self.weig
+0000c630: 6874 7329 203d 3d20 303a 0d0a 2020 2020  hts) == 0:..    
+0000c640: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000c650: 726e 2073 656c 662e 6661 6374 6f72 795f  rn self.factory_
+0000c660: 6b77 6172 6773 5b27 6465 7669 6365 275d  kwargs['device']
+0000c670: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000c680: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000c690: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000c6a0: 2e77 6569 6768 7473 5b30 5d2e 6465 7669  .weights[0].devi
+0000c6b0: 6365 2e74 7970 650d 0a20 2020 2020 2020  ce.type..       
+0000c6c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000c6d0: 2020 2020 7265 7475 726e 205f 726f 6f74      return _root
+0000c6e0: 2e64 6576 6963 650d 0a0d 0a20 2020 2040  .device....    @
+0000c6f0: 6465 7669 6365 2e73 6574 7465 720d 0a20  device.setter.. 
+0000c700: 2020 2064 6566 2064 6576 6963 6528 7365     def device(se
+0000c710: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
+0000c720: 2020 2020 2023 2069 6620 6973 696e 7374       # if isinst
+0000c730: 616e 6365 2876 616c 7565 2c20 7466 2e64  ance(value, tf.d
+0000c740: 6576 6963 6529 3a0d 0a20 2020 2020 2020  evice):..       
+0000c750: 2076 616c 7565 203d 7661 6c75 652e 5f5f   value =value.__
+0000c760: 7374 725f 5f28 290d 0a20 2020 2020 2020  str__()..       
+0000c770: 2073 656c 662e 6661 6374 6f72 795f 6b77   self.factory_kw
+0000c780: 6172 6773 5b27 6465 7669 6365 275d 203d  args['device'] =
+0000c790: 2076 616c 7565 0d0a 2020 2020 2020 2020   value..        
+0000c7a0: 7365 6c66 2e74 6f28 7661 6c75 6529 0d0a  self.to(value)..
+0000c7b0: 0d0a 0d0a 0d0a 0d0a 2020 2020 4070 726f  ........    @pro
+0000c7c0: 7065 7274 790d 0a20 2020 2064 6566 2062  perty..    def b
+0000c7d0: 7569 6c74 2873 656c 6629 3a0d 0a20 2020  uilt(self):..   
+0000c7e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000c7f0: 2e5f 6275 696c 740d 0a0d 0a20 2020 2040  ._built....    @
+0000c800: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+0000c810: 6620 696e 7075 745f 7368 6170 6528 7365  f input_shape(se
+0000c820: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+0000c830: 7475 726e 2073 656c 662e 5f69 6e70 7574  turn self._input
+0000c840: 5f73 6861 7065 0d0a 0d0a 2020 2020 4069  _shape....    @i
+0000c850: 6e70 7574 5f73 6861 7065 2e73 6574 7465  nput_shape.sette
+0000c860: 720d 0a20 2020 2064 6566 2069 6e70 7574  r..    def input
+0000c870: 5f73 6861 7065 2873 656c 662c 2076 616c  _shape(self, val
+0000c880: 7565 293a 0d0a 0d0a 2020 2020 2020 2020  ue):....        
+0000c890: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
+0000c8a0: 6c75 652c 2074 662e 5465 6e73 6f72 5368  lue, tf.TensorSh
+0000c8b0: 6170 6529 3a0d 0a20 2020 2020 2020 2020  ape):..         
+0000c8c0: 2020 2076 616c 7565 203d 2054 656e 736f     value = Tenso
+0000c8d0: 7253 6861 7065 2876 616c 7565 2e61 735f  rShape(value.as_
+0000c8e0: 6c69 7374 2829 290d 0a20 2020 2020 2020  list())..       
+0000c8f0: 2065 6c69 6620 6973 5f74 656e 736f 7228   elif is_tensor(
+0000c900: 7661 6c75 6529 2061 6e64 2076 616c 7565  value) and value
+0000c910: 2e6e 6469 6d20 3d3d 2031 2061 6e64 2076  .ndim == 1 and v
+0000c920: 616c 7565 2e64 7479 7065 203d 3d20 4474  alue.dtype == Dt
+0000c930: 7970 652e 696e 7433 323a 0d0a 2020 2020  ype.int32:..    
+0000c940: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
+0000c950: 5465 6e73 6f72 5368 6170 6528 5b4e 6f6e  TensorShape([Non
+0000c960: 652c 205d 202b 2074 6f5f 6c69 7374 2874  e, ] + to_list(t
+0000c970: 6f5f 6e75 6d70 7928 7661 6c75 6529 2929  o_numpy(value)))
+0000c980: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+0000c990: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
+0000c9a0: 2028 6c69 7374 2c20 7475 706c 6529 2920   (list, tuple)) 
+0000c9b0: 616e 6420 6c65 6e28 7661 6c75 6529 203e  and len(value) >
+0000c9c0: 2030 2061 6e64 2061 6c6c 280d 0a20 2020   0 and all(..   
+0000c9d0: 2020 2020 2020 2020 2020 2020 205b 6973               [is
+0000c9e0: 696e 7374 616e 6365 2869 7465 6d2c 206e  instance(item, n
+0000c9f0: 756d 6265 7273 2e49 6e74 6567 7261 6c29  umbers.Integral)
+0000ca00: 2066 6f72 2069 7465 6d20 696e 2076 616c   for item in val
+0000ca10: 7565 5d29 3a0d 0a20 2020 2020 2020 2020  ue]):..         
+0000ca20: 2020 2076 616c 7565 203d 2054 656e 736f     value = Tenso
+0000ca30: 7253 6861 7065 2828 4e6f 6e65 2c29 202b  rShape((None,) +
+0000ca40: 2076 616c 7565 290d 0a20 2020 2020 2020   value)..       
+0000ca50: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0000ca60: 2876 616c 7565 2c20 286c 6973 742c 2074  (value, (list, t
+0000ca70: 7570 6c65 2929 2061 6e64 206c 656e 2876  uple)) and len(v
+0000ca80: 616c 7565 2920 3e20 3020 616e 6420 616c  alue) > 0 and al
+0000ca90: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
+0000caa0: 2020 2020 5b69 735f 7465 6e73 6f72 2869      [is_tensor(i
+0000cab0: 7465 6d29 2061 6e64 206e 6469 6d28 6974  tem) and ndim(it
+0000cac0: 656d 2920 3d3d 2031 2061 6e64 2069 7465  em) == 1 and ite
+0000cad0: 6d2e 6474 7970 6520 3d3d 2074 662e 696e  m.dtype == tf.in
+0000cae0: 7433 3220 666f 7220 6974 656d 2069 6e20  t32 for item in 
+0000caf0: 7661 6c75 655d 293a 0d0a 2020 2020 2020  value]):..      
+0000cb00: 2020 2020 2020 7661 6c75 6520 3d20 5b54        value = [T
+0000cb10: 656e 736f 7253 6861 7065 2874 6f5f 6c69  ensorShape(to_li
+0000cb20: 7374 2874 6f5f 6e75 6d70 7928 7368 2929  st(to_numpy(sh))
+0000cb30: 2920 666f 7220 7368 2069 6e20 7661 6c75  ) for sh in valu
+0000cb40: 655d 0d0a 2020 2020 2020 2020 656c 6966  e]..        elif
+0000cb50: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+0000cb60: 652c 2054 656e 736f 7253 6861 7065 293a  e, TensorShape):
+0000cb70: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0000cb80: 7373 0d0a 2020 2020 2020 2020 656c 7365  ss..        else
+0000cb90: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
+0000cba0: 616c 7565 203d 2054 656e 736f 7253 6861  alue = TensorSha
+0000cbb0: 7065 286c 6973 7428 7661 6c75 6529 290d  pe(list(value)).
+0000cbc0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+0000cbd0: 6c66 2e5f 6275 696c 7420 3d3d 2046 616c  lf._built == Fal
+0000cbe0: 7365 206f 7220 7365 6c66 2e5f 696e 7075  se or self._inpu
+0000cbf0: 745f 7368 6170 6520 6973 204e 6f6e 6520  t_shape is None 
+0000cc00: 6f72 2073 656c 662e 696e 7075 745f 6669  or self.input_fi
+0000cc10: 6c74 6572 7320 6973 204e 6f6e 653a 0d0a  lters is None:..
+0000cc20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000cc30: 2e5f 696e 7075 745f 7368 6170 6520 3d20  ._input_shape = 
+0000cc40: 7661 6c75 650d 0a20 2020 2020 2020 2020  value..         
+0000cc50: 2020 2073 656c 662e 696e 7075 745f 6669     self.input_fi
+0000cc60: 6c74 6572 7320 3d20 7365 6c66 2e5f 696e  lters = self._in
+0000cc70: 7075 745f 7368 6170 655b 7365 6c66 2e66  put_shape[self.f
+0000cc80: 696c 7465 725f 696e 6465 785d 0d0a 2020  ilter_index]..  
+0000cc90: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+0000cca0: 7569 6c64 2876 616c 7565 290d 0a20 2020  uild(value)..   
+0000ccb0: 2020 2020 2020 2020 2073 656c 662e 5f62           self._b
+0000ccc0: 7569 6c74 203d 2054 7275 650d 0a0d 0a20  uilt = True.... 
+0000ccd0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000cce0: 6c66 2e69 735f 726f 6f74 3a0d 0a20 2020  lf.is_root:..   
+0000ccf0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000cd00: 7365 6c66 2e5f 7369 676e 6174 7572 6520  self._signature 
+0000cd10: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0000cd20: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000cd30: 6c66 2e5f 7369 676e 6174 7572 6520 3d20  lf._signature = 
+0000cd40: 5369 676e 6174 7572 6528 6e61 6d65 3d73  Signature(name=s
+0000cd50: 656c 662e 6e61 6d65 290d 0a20 2020 2020  elf.name)..     
+0000cd60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000cd70: 5f73 6967 6e61 7475 7265 2e69 6e70 7574  _signature.input
+0000cd80: 7320 3d20 4f72 6465 7265 6444 6963 7428  s = OrderedDict(
+0000cd90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000cda0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000cdb0: 2873 656c 662e 5f69 6e70 7574 5f73 6861  (self._input_sha
+0000cdc0: 7065 2c20 5465 6e73 6f72 5368 6170 6529  pe, TensorShape)
+0000cdd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000cde0: 2020 2020 2020 2073 656c 662e 5f73 6967         self._sig
+0000cdf0: 6e61 7475 7265 2e69 6e70 7574 735b 2769  nature.inputs['i
+0000ce00: 6e70 7574 275d 203d 2054 656e 736f 7253  nput'] = TensorS
+0000ce10: 7065 6328 7368 6170 653d 7365 6c66 2e5f  pec(shape=self._
+0000ce20: 696e 7075 745f 7368 6170 652c 206e 616d  input_shape, nam
+0000ce30: 653d 2769 6e70 7574 2729 0d0a 0d0a 2020  e='input')....  
+0000ce40: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000ce50: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+0000ce60: 6c66 2e5f 696e 7075 745f 7368 6170 652c  lf._input_shape,
+0000ce70: 206c 6973 7429 3a0d 0a20 2020 2020 2020   list):..       
+0000ce80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000ce90: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
+0000cea0: 7365 6c66 2e5f 696e 7075 745f 7368 6170  self._input_shap
+0000ceb0: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
+0000cec0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ced0: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
+0000cee0: 7075 7473 5b27 696e 7075 745f 7b30 7d27  puts['input_{0}'
+0000cef0: 2e66 6f72 6d61 7428 6b29 5d20 3d20 5465  .format(k)] = Te
+0000cf00: 6e73 6f72 5370 6563 2873 6861 7065 3d73  nsorSpec(shape=s
+0000cf10: 656c 662e 5f69 6e70 7574 5f73 6861 7065  elf._input_shape
+0000cf20: 5b6b 5d2c 0d0a 2020 2020 2020 2020 2020  [k],..          
+0000cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 2020 2020 2020 6e61 6d65 3d27 696e 7075        name='inpu
-0000cfa0: 745f 7b30 7d27 2e66 6f72 6d61 7428 6b29  t_{0}'.format(k)
-0000cfb0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
-0000cfc0: 7479 0d0a 2020 2020 6465 6620 6f75 7470  ty..    def outp
-0000cfd0: 7574 5f73 6861 7065 2873 656c 6629 3a0d  ut_shape(self):.
-0000cfe0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000cff0: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
-0000d000: 7065 0d0a 0d0a 2020 2020 406f 7574 7075  pe....    @outpu
-0000d010: 745f 7368 6170 652e 7365 7474 6572 0d0a  t_shape.setter..
-0000d020: 2020 2020 6465 6620 6f75 7470 7574 5f73      def output_s
-0000d030: 6861 7065 2873 656c 662c 2076 616c 7565  hape(self, value
-0000d040: 293a 0d0a 2020 2020 2020 2020 6966 2076  ):..        if v
-0000d050: 616c 7565 2069 7320 4e6f 6e65 3a0d 0a20  alue is None:.. 
-0000d060: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d070: 5f6f 7574 7075 745f 7368 6170 6520 3d20  _output_shape = 
-0000d080: 7661 6c75 650d 0a20 2020 2020 2020 2020  value..         
-0000d090: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
-0000d0a0: 7265 203d 204e 6f6e 650d 0a20 2020 2020  re = None..     
-0000d0b0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0000d0c0: 2020 2020 2020 6966 2069 735f 7465 6e73        if is_tens
-0000d0d0: 6f72 2876 616c 7565 2920 616e 6420 7661  or(value) and va
-0000d0e0: 6c75 652e 6e64 696d 203d 3d20 3120 616e  lue.ndim == 1 an
-0000d0f0: 6420 7661 6c75 652e 6474 7970 6520 3d3d  d value.dtype ==
-0000d100: 2044 7479 7065 2e69 6e74 3332 3a0d 0a20   Dtype.int32:.. 
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000d120: 616c 7565 203d 2054 656e 736f 7253 6861  alue = TensorSha
-0000d130: 7065 285b 4e6f 6e65 2c20 5d20 2b20 746f  pe([None, ] + to
-0000d140: 5f6c 6973 7428 746f 5f6e 756d 7079 2876  _list(to_numpy(v
-0000d150: 616c 7565 2929 290d 0a20 2020 2020 2020  alue)))..       
-0000d160: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0000d170: 616e 6365 2876 616c 7565 2c20 7466 2e54  ance(value, tf.T
-0000d180: 656e 736f 7253 6861 7065 293a 0d0a 2020  ensorShape):..  
-0000d190: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0000d1a0: 6c75 6520 3d20 5465 6e73 6f72 5368 6170  lue = TensorShap
-0000d1b0: 6528 7661 6c75 652e 6173 5f6c 6973 7428  e(value.as_list(
-0000d1c0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0000d1d0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0000d1e0: 7661 6c75 652c 2028 6c69 7374 2c20 7475  value, (list, tu
-0000d1f0: 706c 6529 2920 616e 6420 6c65 6e28 7661  ple)) and len(va
-0000d200: 6c75 6529 203e 2030 2061 6e64 2061 6c6c  lue) > 0 and all
-0000d210: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000d220: 2020 2020 2020 205b 6973 696e 7374 616e         [isinstan
-0000d230: 6365 2869 7465 6d2c 206e 756d 6265 7273  ce(item, numbers
-0000d240: 2e49 6e74 6567 7261 6c29 2066 6f72 2069  .Integral) for i
-0000d250: 7465 6d20 696e 2076 616c 7565 5d29 3a0d  tem in value]):.
-0000d260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d270: 2076 616c 7565 203d 2054 656e 736f 7253   value = TensorS
-0000d280: 6861 7065 2828 4e6f 6e65 2c29 202b 2076  hape((None,) + v
-0000d290: 616c 7565 290d 0a20 2020 2020 2020 2020  alue)..         
-0000d2a0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0000d2b0: 6365 2876 616c 7565 2c20 286c 6973 742c  ce(value, (list,
-0000d2c0: 2074 7570 6c65 2929 2061 6e64 206c 656e   tuple)) and len
-0000d2d0: 2876 616c 7565 2920 3e20 3020 616e 6420  (value) > 0 and 
-0000d2e0: 616c 6c28 0d0a 2020 2020 2020 2020 2020  all(..          
-0000d2f0: 2020 2020 2020 2020 2020 5b69 735f 7465            [is_te
-0000d300: 6e73 6f72 2869 7465 6d29 2061 6e64 206e  nsor(item) and n
-0000d310: 6469 6d28 6974 656d 2920 3d3d 2031 2061  dim(item) == 1 a
-0000d320: 6e64 2069 7465 6d2e 6474 7970 6520 3d3d  nd item.dtype ==
-0000d330: 2074 662e 696e 7433 3220 666f 7220 6974   tf.int32 for it
-0000d340: 656d 2069 6e20 7661 6c75 655d 293a 0d0a  em in value]):..
-0000d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d360: 7661 6c75 6520 3d20 5b54 656e 736f 7253  value = [TensorS
-0000d370: 6861 7065 2874 6f5f 6c69 7374 2874 6f5f  hape(to_list(to_
-0000d380: 6e75 6d70 7928 7368 2929 2920 666f 7220  numpy(sh))) for 
-0000d390: 7368 2069 6e20 7661 6c75 655d 0d0a 2020  sh in value]..  
-0000d3a0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-0000d3b0: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-0000d3c0: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
-0000d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3e0: 7061 7373 0d0a 2020 2020 2020 2020 2020  pass..          
-0000d3f0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0000d400: 2020 2020 2020 2020 2076 616c 7565 203d           value =
-0000d410: 2054 656e 736f 7253 6861 7065 286c 6973   TensorShape(lis
-0000d420: 7428 7661 6c75 6529 290d 0a0d 0a20 2020  t(value))....   
-0000d430: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
-0000d440: 7574 7075 745f 7368 6170 6520 3d20 7661  utput_shape = va
-0000d450: 6c75 650d 0a0d 0a20 2020 2020 2020 2020  lue....         
-0000d460: 2020 2069 6620 7365 6c66 2e69 735f 726f     if self.is_ro
-0000d470: 6f74 3a0d 0a20 2020 2020 2020 2020 2020  ot:..           
-0000d480: 2020 2020 2069 6620 7365 6c66 2e5f 7369       if self._si
-0000d490: 676e 6174 7572 6520 6973 204e 6f6e 653a  gnature is None:
-0000d4a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d4b0: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
-0000d4c0: 6174 7572 6520 3d20 5369 676e 6174 7572  ature = Signatur
-0000d4d0: 6528 6e61 6d65 3d73 656c 662e 6e61 6d65  e(name=self.name
-0000d4e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000d4f0: 2020 2073 656c 662e 5f73 6967 6e61 7475     self._signatu
-0000d500: 7265 2e6f 7574 7075 7473 203d 204f 7264  re.outputs = Ord
-0000d510: 6572 6564 4469 6374 2829 0d0a 2020 2020  eredDict()..    
-0000d520: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000d530: 7369 6e73 7461 6e63 6528 7365 6c66 2e5f  sinstance(self._
-0000d540: 6f75 7470 7574 5f73 6861 7065 2c20 5465  output_shape, Te
-0000d550: 6e73 6f72 5368 6170 6529 3a0d 0a20 2020  nsorShape):..   
-0000d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d570: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
-0000d580: 2e6f 7574 7075 7473 5b27 6f75 7470 7574  .outputs['output
-0000d590: 275d 203d 2054 656e 736f 7253 7065 6328  '] = TensorSpec(
-0000d5a0: 7368 6170 653d 7365 6c66 2e5f 6f75 7470  shape=self._outp
-0000d5b0: 7574 5f73 6861 7065 2c20 6e61 6d65 3d27  ut_shape, name='
-0000d5c0: 6f75 7470 7574 2729 0d0a 0d0a 2020 2020  output')....    
-0000d5d0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000d5e0: 2069 735f 7465 6e73 6f72 2873 656c 662e   is_tensor(self.
-0000d5f0: 5f6f 7574 7075 745f 7368 6170 6529 3a0d  _output_shape):.
-0000d600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d610: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
-0000d620: 7475 7265 2e6f 7574 7075 7473 5b27 6f75  ture.outputs['ou
-0000d630: 7470 7574 275d 203d 2054 656e 736f 7253  tput'] = TensorS
-0000d640: 7065 6328 0d0a 2020 2020 2020 2020 2020  pec(..          
-0000d650: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-0000d660: 6170 653d 5465 6e73 6f72 5368 6170 6528  ape=TensorShape(
-0000d670: 746f 5f6c 6973 7428 746f 5f6e 756d 7079  to_list(to_numpy
-0000d680: 2873 656c 662e 5f6f 7574 7075 745f 7368  (self._output_sh
-0000d690: 6170 6529 2929 2c20 6e61 6d65 3d27 6f75  ape))), name='ou
-0000d6a0: 7470 7574 2729 0d0a 2020 2020 2020 2020  tput')..        
-0000d6b0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6d0: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-0000d6e0: 6528 6c65 6e28 7365 6c66 2e5f 6f75 7470  e(len(self._outp
-0000d6f0: 7574 5f73 6861 7065 2929 3a0d 0a20 2020  ut_shape)):..   
-0000d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d710: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
-0000d720: 7475 7265 2e6f 7574 7075 7473 5b27 6f75  ture.outputs['ou
-0000d730: 7470 7574 5f7b 307d 272e 666f 726d 6174  tput_{0}'.format
-0000d740: 286b 295d 203d 2054 656e 736f 7253 7065  (k)] = TensorSpe
-0000d750: 6328 7368 6170 653d 7365 6c66 2e5f 6f75  c(shape=self._ou
-0000d760: 7470 7574 5f73 6861 7065 5b6b 5d2c 0d0a  tput_shape[k],..
+0000cf70: 2020 2020 2020 2020 206e 616d 653d 2769           name='i
+0000cf80: 6e70 7574 5f7b 307d 272e 666f 726d 6174  nput_{0}'.format
+0000cf90: 286b 2929 0d0a 0d0a 2020 2020 4070 726f  (k))....    @pro
+0000cfa0: 7065 7274 790d 0a20 2020 2064 6566 206f  perty..    def o
+0000cfb0: 7574 7075 745f 7368 6170 6528 7365 6c66  utput_shape(self
+0000cfc0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+0000cfd0: 726e 2073 656c 662e 5f6f 7574 7075 745f  rn self._output_
+0000cfe0: 7368 6170 650d 0a0d 0a20 2020 2040 6f75  shape....    @ou
+0000cff0: 7470 7574 5f73 6861 7065 2e73 6574 7465  tput_shape.sette
+0000d000: 720d 0a20 2020 2064 6566 206f 7574 7075  r..    def outpu
+0000d010: 745f 7368 6170 6528 7365 6c66 2c20 7661  t_shape(self, va
+0000d020: 6c75 6529 3a0d 0a20 2020 2020 2020 2069  lue):..        i
+0000d030: 6620 7661 6c75 6520 6973 204e 6f6e 653a  f value is None:
+0000d040: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000d050: 6c66 2e5f 6f75 7470 7574 5f73 6861 7065  lf._output_shape
+0000d060: 203d 2076 616c 7565 0d0a 2020 2020 2020   = value..      
+0000d070: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
+0000d080: 6174 7572 6520 3d20 4e6f 6e65 0d0a 2020  ature = None..  
+0000d090: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000d0a0: 2020 2020 2020 2020 2069 6620 6973 5f74           if is_t
+0000d0b0: 656e 736f 7228 7661 6c75 6529 2061 6e64  ensor(value) and
+0000d0c0: 2076 616c 7565 2e6e 6469 6d20 3d3d 2031   value.ndim == 1
+0000d0d0: 2061 6e64 2076 616c 7565 2e64 7479 7065   and value.dtype
+0000d0e0: 203d 3d20 4474 7970 652e 696e 7433 323a   == Dtype.int32:
+0000d0f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d100: 2020 7661 6c75 6520 3d20 5465 6e73 6f72    value = Tensor
+0000d110: 5368 6170 6528 5b4e 6f6e 652c 205d 202b  Shape([None, ] +
+0000d120: 2074 6f5f 6c69 7374 2874 6f5f 6e75 6d70   to_list(to_nump
+0000d130: 7928 7661 6c75 6529 2929 0d0a 2020 2020  y(value)))..    
+0000d140: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+0000d150: 6e73 7461 6e63 6528 7661 6c75 652c 2074  nstance(value, t
+0000d160: 662e 5465 6e73 6f72 5368 6170 6529 3a0d  f.TensorShape):.
+0000d170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d180: 2076 616c 7565 203d 2054 656e 736f 7253   value = TensorS
+0000d190: 6861 7065 2876 616c 7565 2e61 735f 6c69  hape(value.as_li
+0000d1a0: 7374 2829 290d 0a20 2020 2020 2020 2020  st())..         
+0000d1b0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0000d1c0: 6365 2876 616c 7565 2c20 286c 6973 742c  ce(value, (list,
+0000d1d0: 2074 7570 6c65 2929 2061 6e64 206c 656e   tuple)) and len
+0000d1e0: 2876 616c 7565 2920 3e20 3020 616e 6420  (value) > 0 and 
+0000d1f0: 616c 6c28 0d0a 2020 2020 2020 2020 2020  all(..          
+0000d200: 2020 2020 2020 2020 2020 5b69 7369 6e73            [isins
+0000d210: 7461 6e63 6528 6974 656d 2c20 6e75 6d62  tance(item, numb
+0000d220: 6572 732e 496e 7465 6772 616c 2920 666f  ers.Integral) fo
+0000d230: 7220 6974 656d 2069 6e20 7661 6c75 655d  r item in value]
+0000d240: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000d250: 2020 2020 7661 6c75 6520 3d20 5465 6e73      value = Tens
+0000d260: 6f72 5368 6170 6528 284e 6f6e 652c 2920  orShape((None,) 
+0000d270: 2b20 7661 6c75 6529 0d0a 2020 2020 2020  + value)..      
+0000d280: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0000d290: 7461 6e63 6528 7661 6c75 652c 2028 6c69  tance(value, (li
+0000d2a0: 7374 2c20 7475 706c 6529 2920 616e 6420  st, tuple)) and 
+0000d2b0: 6c65 6e28 7661 6c75 6529 203e 2030 2061  len(value) > 0 a
+0000d2c0: 6e64 2061 6c6c 280d 0a20 2020 2020 2020  nd all(..       
+0000d2d0: 2020 2020 2020 2020 2020 2020 205b 6973               [is
+0000d2e0: 5f74 656e 736f 7228 6974 656d 2920 616e  _tensor(item) an
+0000d2f0: 6420 6e64 696d 2869 7465 6d29 203d 3d20  d ndim(item) == 
+0000d300: 3120 616e 6420 6974 656d 2e64 7479 7065  1 and item.dtype
+0000d310: 203d 3d20 7466 2e69 6e74 3332 2066 6f72   == tf.int32 for
+0000d320: 2069 7465 6d20 696e 2076 616c 7565 5d29   item in value])
+0000d330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000d340: 2020 2076 616c 7565 203d 205b 5465 6e73     value = [Tens
+0000d350: 6f72 5368 6170 6528 746f 5f6c 6973 7428  orShape(to_list(
+0000d360: 746f 5f6e 756d 7079 2873 6829 2929 2066  to_numpy(sh))) f
+0000d370: 6f72 2073 6820 696e 2076 616c 7565 5d0d  or sh in value].
+0000d380: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000d390: 6620 6973 696e 7374 616e 6365 2876 616c  f isinstance(val
+0000d3a0: 7565 2c20 5465 6e73 6f72 5368 6170 6529  ue, TensorShape)
+0000d3b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000d3c0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+0000d3d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000d3e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0000d3f0: 6520 3d20 5465 6e73 6f72 5368 6170 6528  e = TensorShape(
+0000d400: 6c69 7374 2876 616c 7565 2929 0d0a 0d0a  list(value))....
+0000d410: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d420: 2e5f 6f75 7470 7574 5f73 6861 7065 203d  ._output_shape =
+0000d430: 2076 616c 7565 0d0a 0d0a 2020 2020 2020   value....      
+0000d440: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+0000d450: 5f72 6f6f 743a 0d0a 2020 2020 2020 2020  _root:..        
+0000d460: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000d470: 5f73 6967 6e61 7475 7265 2069 7320 4e6f  _signature is No
+0000d480: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000d490: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+0000d4a0: 6967 6e61 7475 7265 203d 2053 6967 6e61  ignature = Signa
+0000d4b0: 7475 7265 286e 616d 653d 7365 6c66 2e6e  ture(name=self.n
+0000d4c0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+0000d4d0: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
+0000d4e0: 6174 7572 652e 6f75 7470 7574 7320 3d20  ature.outputs = 
+0000d4f0: 4f72 6465 7265 6444 6963 7428 290d 0a20  OrderedDict().. 
+0000d500: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d510: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
+0000d520: 662e 5f6f 7574 7075 745f 7368 6170 652c  f._output_shape,
+0000d530: 2054 656e 736f 7253 6861 7065 293a 0d0a   TensorShape):..
+0000d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d550: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
+0000d560: 7572 652e 6f75 7470 7574 735b 276f 7574  ure.outputs['out
+0000d570: 7075 7427 5d20 3d20 5465 6e73 6f72 5370  put'] = TensorSp
+0000d580: 6563 2873 6861 7065 3d73 656c 662e 5f6f  ec(shape=self._o
+0000d590: 7574 7075 745f 7368 6170 652c 206e 616d  utput_shape, nam
+0000d5a0: 653d 276f 7574 7075 7427 290d 0a0d 0a20  e='output').... 
+0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000d5c0: 6c69 6620 6973 5f74 656e 736f 7228 7365  lif is_tensor(se
+0000d5d0: 6c66 2e5f 6f75 7470 7574 5f73 6861 7065  lf._output_shape
+0000d5e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000d5f0: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
+0000d600: 676e 6174 7572 652e 6f75 7470 7574 735b  gnature.outputs[
+0000d610: 276f 7574 7075 7427 5d20 3d20 5465 6e73  'output'] = Tens
+0000d620: 6f72 5370 6563 280d 0a20 2020 2020 2020  orSpec(..       
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d640: 2073 6861 7065 3d54 656e 736f 7253 6861   shape=TensorSha
+0000d650: 7065 2874 6f5f 6c69 7374 2874 6f5f 6e75  pe(to_list(to_nu
+0000d660: 6d70 7928 7365 6c66 2e5f 6f75 7470 7574  mpy(self._output
+0000d670: 5f73 6861 7065 2929 292c 206e 616d 653d  _shape))), name=
+0000d680: 276f 7574 7075 7427 290d 0a20 2020 2020  'output')..     
+0000d690: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000d6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d6b0: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
+0000d6c0: 616e 6765 286c 656e 2873 656c 662e 5f6f  ange(len(self._o
+0000d6d0: 7574 7075 745f 7368 6170 6529 293a 0d0a  utput_shape)):..
+0000d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6f0: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
+0000d700: 676e 6174 7572 652e 6f75 7470 7574 735b  gnature.outputs[
+0000d710: 276f 7574 7075 745f 7b30 7d27 2e66 6f72  'output_{0}'.for
+0000d720: 6d61 7428 6b29 5d20 3d20 5465 6e73 6f72  mat(k)] = Tensor
+0000d730: 5370 6563 2873 6861 7065 3d73 656c 662e  Spec(shape=self.
+0000d740: 5f6f 7574 7075 745f 7368 6170 655b 6b5d  _output_shape[k]
+0000d750: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7c0: 2020 2020 206e 616d 653d 276f 7574 7075       name='outpu
-0000d7d0: 745f 7b30 7d27 2e66 6f72 6d61 7428 6b29  t_{0}'.format(k)
-0000d7e0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
-0000d7f0: 7479 0d0a 2020 2020 6465 6620 7369 676e  ty..    def sign
-0000d800: 6174 7572 6528 7365 6c66 293a 0d0a 2020  ature(self):..  
-0000d810: 2020 2020 2020 2222 220d 0a0d 0a20 2020        """....   
-0000d820: 2020 2020 2052 6574 7572 6e73 3a0d 0a0d       Returns:...
-0000d830: 0a20 2020 2020 2020 2022 2222 0d0a 0d0a  .        """....
-0000d840: 2020 2020 2020 2020 6172 675f 7370 6563          arg_spec
-0000d850: 203d 2067 6574 5f61 7267 735f 7370 6563   = get_args_spec
-0000d860: 2873 656c 662e 666f 7277 6172 6429 0d0a  (self.forward)..
-0000d870: 2020 2020 2020 2020 696e 7370 6563 745f          inspect_
-0000d880: 6172 6773 203d 205b 6172 6720 666f 7220  args = [arg for 
-0000d890: 6172 6720 696e 206c 6973 7428 6172 675f  arg in list(arg_
-0000d8a0: 7370 6563 2e61 7267 7329 2069 6620 6172  spec.args) if ar
-0000d8b0: 6720 6e6f 7420 696e 205b 2773 656c 6627  g not in ['self'
-0000d8c0: 2c20 276b 7761 7267 7327 5d5d 0d0a 2020  , 'kwargs']]..  
-0000d8d0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000d8e0: 6e63 6528 6172 675f 7370 6563 2e76 6172  nce(arg_spec.var
-0000d8f0: 6172 6773 2c20 7374 7229 3a0d 0a20 2020  args, str):..   
-0000d900: 2020 2020 2020 2020 2069 6e73 7065 6374           inspect
-0000d910: 5f61 7267 732e 6170 7065 6e64 2861 7267  _args.append(arg
-0000d920: 5f73 7065 632e 7661 7261 7267 7329 0d0a  _spec.varargs)..
-0000d930: 2020 2020 2020 2020 696e 7370 6563 745f          inspect_
-0000d940: 6172 6773 203d 2075 6e70 6163 6b5f 7369  args = unpack_si
-0000d950: 6e67 6c65 746f 6e28 696e 7370 6563 745f  ngleton(inspect_
-0000d960: 6172 6773 290d 0a0d 0a20 2020 2020 2020  args)....       
-0000d970: 2069 6620 7365 6c66 2e5f 7369 676e 6174   if self._signat
-0000d980: 7572 6520 6973 204e 6f6e 6520 6f72 206c  ure is None or l
+0000d7a0: 2020 2020 2020 2020 6e61 6d65 3d27 6f75          name='ou
+0000d7b0: 7470 7574 5f7b 307d 272e 666f 726d 6174  tput_{0}'.format
+0000d7c0: 286b 2929 0d0a 0d0a 2020 2020 4070 726f  (k))....    @pro
+0000d7d0: 7065 7274 790d 0a20 2020 2064 6566 2073  perty..    def s
+0000d7e0: 6967 6e61 7475 7265 2873 656c 6629 3a0d  ignature(self):.
+0000d7f0: 0a20 2020 2020 2020 2022 2222 0d0a 0d0a  .        """....
+0000d800: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+0000d810: 0d0a 0d0a 2020 2020 2020 2020 2222 220d  ....        """.
+0000d820: 0a0d 0a20 2020 2020 2020 2061 7267 5f73  ...        arg_s
+0000d830: 7065 6320 3d20 6765 745f 6172 6773 5f73  pec = get_args_s
+0000d840: 7065 6328 7365 6c66 2e66 6f72 7761 7264  pec(self.forward
+0000d850: 290d 0a20 2020 2020 2020 2069 6e73 7065  )..        inspe
+0000d860: 6374 5f61 7267 7320 3d20 5b61 7267 2066  ct_args = [arg f
+0000d870: 6f72 2061 7267 2069 6e20 6c69 7374 2861  or arg in list(a
+0000d880: 7267 5f73 7065 632e 6172 6773 2920 6966  rg_spec.args) if
+0000d890: 2061 7267 206e 6f74 2069 6e20 5b27 7365   arg not in ['se
+0000d8a0: 6c66 272c 2027 6b77 6172 6773 275d 5d0d  lf', 'kwargs']].
+0000d8b0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0000d8c0: 7374 616e 6365 2861 7267 5f73 7065 632e  stance(arg_spec.
+0000d8d0: 7661 7261 7267 732c 2073 7472 293a 0d0a  varargs, str):..
+0000d8e0: 2020 2020 2020 2020 2020 2020 696e 7370              insp
+0000d8f0: 6563 745f 6172 6773 2e61 7070 656e 6428  ect_args.append(
+0000d900: 6172 675f 7370 6563 2e76 6172 6172 6773  arg_spec.varargs
+0000d910: 290d 0a20 2020 2020 2020 2069 6e73 7065  )..        inspe
+0000d920: 6374 5f61 7267 7320 3d20 756e 7061 636b  ct_args = unpack
+0000d930: 5f73 696e 676c 6574 6f6e 2869 6e73 7065  _singleton(inspe
+0000d940: 6374 5f61 7267 7329 0d0a 0d0a 2020 2020  ct_args)....    
+0000d950: 2020 2020 6966 2073 656c 662e 5f73 6967      if self._sig
+0000d960: 6e61 7475 7265 2069 7320 4e6f 6e65 206f  nature is None o
+0000d970: 7220 6c65 6e28 7365 6c66 2e5f 7369 676e  r len(self._sign
+0000d980: 6174 7572 6529 203d 3d20 3020 6f72 206c  ature) == 0 or l
 0000d990: 656e 2873 656c 662e 5f73 6967 6e61 7475  en(self._signatu
-0000d9a0: 7265 2920 3d3d 2030 206f 7220 6c65 6e28  re) == 0 or len(
-0000d9b0: 7365 6c66 2e5f 7369 676e 6174 7572 652e  self._signature.
-0000d9c0: 696e 7075 7473 2920 3d3d 2030 3a0d 0a20  inputs) == 0:.. 
-0000d9d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d9e0: 5f73 6967 6e61 7475 7265 203d 2053 6967  _signature = Sig
-0000d9f0: 6e61 7475 7265 286e 616d 653d 7365 6c66  nature(name=self
-0000da00: 2e6e 616d 6529 0d0a 0d0a 2020 2020 2020  .name)....      
-0000da10: 2020 2020 2020 6966 2073 656c 662e 5f69        if self._i
-0000da20: 6e70 7574 5f73 6861 7065 2069 7320 6e6f  nput_shape is no
-0000da30: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0000da40: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0000da50: 7374 616e 6365 2873 656c 662e 5f69 6e70  stance(self._inp
-0000da60: 7574 5f73 6861 7065 2c20 5465 6e73 6f72  ut_shape, Tensor
-0000da70: 5368 6170 6529 2061 6e64 2069 7369 6e73  Shape) and isins
-0000da80: 7461 6e63 6528 696e 7370 6563 745f 6172  tance(inspect_ar
-0000da90: 6773 2c20 7374 7229 3a0d 0a20 2020 2020  gs, str):..     
-0000daa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000dab0: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
-0000dac0: 6e70 7574 735b 696e 7370 6563 745f 6172  nputs[inspect_ar
-0000dad0: 6773 5d20 3d20 5465 6e73 6f72 5370 6563  gs] = TensorSpec
-0000dae0: 2873 6861 7065 3d54 656e 736f 7253 6861  (shape=TensorSha
-0000daf0: 7065 2873 656c 662e 5f69 6e70 7574 5f73  pe(self._input_s
-0000db00: 6861 7065 292c 0d0a 2020 2020 2020 2020  hape),..        
+0000d9a0: 7265 2e69 6e70 7574 7329 203d 3d20 303a  re.inputs) == 0:
+0000d9b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000d9c0: 6c66 2e5f 7369 676e 6174 7572 6520 3d20  lf._signature = 
+0000d9d0: 5369 676e 6174 7572 6528 6e61 6d65 3d73  Signature(name=s
+0000d9e0: 656c 662e 6e61 6d65 290d 0a0d 0a20 2020  elf.name)....   
+0000d9f0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000da00: 2e5f 696e 7075 745f 7368 6170 6520 6973  ._input_shape is
+0000da10: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+0000da20: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000da30: 7369 6e73 7461 6e63 6528 7365 6c66 2e5f  sinstance(self._
+0000da40: 696e 7075 745f 7368 6170 652c 2054 656e  input_shape, Ten
+0000da50: 736f 7253 6861 7065 2920 616e 6420 6973  sorShape) and is
+0000da60: 696e 7374 616e 6365 2869 6e73 7065 6374  instance(inspect
+0000da70: 5f61 7267 732c 2073 7472 293a 0d0a 2020  _args, str):..  
+0000da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da90: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
+0000daa0: 652e 696e 7075 7473 5b69 6e73 7065 6374  e.inputs[inspect
+0000dab0: 5f61 7267 735d 203d 2054 656e 736f 7253  _args] = TensorS
+0000dac0: 7065 6328 7368 6170 653d 5465 6e73 6f72  pec(shape=Tensor
+0000dad0: 5368 6170 6528 7365 6c66 2e5f 696e 7075  Shape(self._inpu
+0000dae0: 745f 7368 6170 6529 2c0d 0a20 2020 2020  t_shape),..     
+0000daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db40: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0000db50: 6d65 3d69 6e73 7065 6374 5f61 7267 7329  me=inspect_args)
-0000db60: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0000db70: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0000db80: 6e63 6528 7365 6c66 2e5f 696e 7075 745f  nce(self._input_
-0000db90: 7368 6170 652c 2074 7570 6c65 293a 0d0a  shape, tuple):..
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbb0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0000dbc0: 6765 286c 656e 2873 656c 662e 5f69 6e70  ge(len(self._inp
-0000dbd0: 7574 5f73 6861 7065 2929 3a0d 0a20 2020  ut_shape)):..   
-0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbf0: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
-0000dc00: 7475 7265 2e69 6e70 7574 735b 2269 6e70  ture.inputs["inp
-0000dc10: 7574 5f7b 307d 222e 666f 726d 6174 2869  ut_{0}".format(i
-0000dc20: 295d 203d 2054 656e 736f 7253 7065 6328  )] = TensorSpec(
-0000dc30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dc40: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-0000dc50: 6170 653d 5465 6e73 6f72 5368 6170 6528  ape=TensorShape(
-0000dc60: 7365 6c66 2e5f 696e 7075 745f 7368 6170  self._input_shap
-0000dc70: 655b 695d 292c 206e 616d 653d 2269 6e70  e[i]), name="inp
-0000dc80: 7574 5f7b 307d 222e 666f 726d 6174 2869  ut_{0}".format(i
-0000dc90: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0000dca0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000dcb0: 2020 2020 2020 2066 6f72 2061 7267 2069         for arg i
-0000dcc0: 6e20 696e 7370 6563 745f 6172 6773 3a0d  n inspect_args:.
-0000dcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dce0: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
-0000dcf0: 7475 7265 2e69 6e70 7574 735b 6172 675d  ture.inputs[arg]
-0000dd00: 203d 2054 656e 736f 7253 7065 6328 7368   = TensorSpec(sh
-0000dd10: 6170 653d 4e6f 6e65 290d 0a0d 0a20 2020  ape=None)....   
-0000dd20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000dd30: 2e5f 6f75 7470 7574 5f73 6861 7065 2069  ._output_shape i
-0000dd40: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0000dd50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000dd60: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-0000dd70: 5f6f 7574 7075 745f 7368 6170 652c 2054  _output_shape, T
-0000dd80: 656e 736f 7253 6861 7065 293a 0d0a 2020  ensorShape):..  
-0000dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dda0: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
-0000ddb0: 652e 6f75 7470 7574 735b 226f 7574 7075  e.outputs["outpu
-0000ddc0: 7422 5d20 3d20 5465 6e73 6f72 5370 6563  t"] = TensorSpec
-0000ddd0: 2873 6861 7065 3d54 656e 736f 7253 6861  (shape=TensorSha
-0000dde0: 7065 2873 656c 662e 5f6f 7574 7075 745f  pe(self._output_
-0000ddf0: 7368 6170 6529 2c20 6e61 6d65 3d22 6f75  shape), name="ou
-0000de00: 7470 7574 2229 0d0a 2020 2020 2020 2020  tput")..        
-0000de10: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-0000de20: 6e73 7461 6e63 6528 7365 6c66 2e5f 6f75  nstance(self._ou
-0000de30: 7470 7574 5f73 6861 7065 2c20 7475 706c  tput_shape, tupl
-0000de40: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-0000de50: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-0000de60: 6e20 7261 6e67 6528 6c65 6e28 7365 6c66  n range(len(self
-0000de70: 2e5f 6f75 7470 7574 5f73 6861 7065 2929  ._output_shape))
-0000de80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000de90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000dea0: 5f73 6967 6e61 7475 7265 2e6f 7574 7075  _signature.outpu
-0000deb0: 7473 5b22 6f75 7470 7574 5f7b 307d 222e  ts["output_{0}".
-0000dec0: 666f 726d 6174 2869 295d 203d 2054 656e  format(i)] = Ten
-0000ded0: 736f 7253 7065 6328 0d0a 2020 2020 2020  sorSpec(..      
-0000dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000def0: 2020 2020 2020 7368 6170 653d 746f 5f74        shape=to_t
-0000df00: 656e 736f 7228 7365 6c66 2e5f 6f75 7470  ensor(self._outp
-0000df10: 7574 5f73 6861 7065 5b69 5d29 2c20 6e61  ut_shape[i]), na
-0000df20: 6d65 3d22 6f75 7470 7574 5f7b 307d 222e  me="output_{0}".
-0000df30: 666f 726d 6174 2869 2929 0d0a 2020 2020  format(i))..    
-0000df40: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000df50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000df60: 656c 662e 5f73 6967 6e61 7475 7265 2e6f  elf._signature.o
-0000df70: 7574 7075 7473 5b22 6f75 7470 7574 225d  utputs["output"]
-0000df80: 203d 2054 656e 736f 7253 7065 6328 7368   = TensorSpec(sh
-0000df90: 6170 653d 4e6f 6e65 290d 0a20 2020 2020  ape=None)..     
-0000dfa0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000dfb0: 2869 6e73 7065 6374 5f61 7267 732c 2073  (inspect_args, s
-0000dfc0: 7472 2920 616e 6420 6c65 6e28 7365 6c66  tr) and len(self
-0000dfd0: 2e5f 7369 676e 6174 7572 652e 696e 7075  ._signature.inpu
-0000dfe0: 7473 2920 3d3d 2031 2061 6e64 2073 656c  ts) == 1 and sel
-0000dff0: 662e 5f73 6967 6e61 7475 7265 2e69 6e70  f._signature.inp
-0000e000: 7574 732e 6b65 795f 6c69 7374 5b30 5d20  uts.key_list[0] 
-0000e010: 213d 2069 6e73 7065 6374 5f61 7267 733a  != inspect_args:
-0000e020: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000e030: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
-0000e040: 7075 7473 5b69 6e73 7065 6374 5f61 7267  puts[inspect_arg
-0000e050: 735d 203d 2073 656c 662e 5f73 6967 6e61  s] = self._signa
-0000e060: 7475 7265 2e69 6e70 7574 732e 7661 6c75  ture.inputs.valu
-0000e070: 655f 6c69 7374 5b30 5d0d 0a20 2020 2020  e_list[0]..     
-0000e080: 2020 2020 2020 2073 656c 662e 5f73 6967         self._sig
-0000e090: 6e61 7475 7265 2e69 6e70 7574 732e 706f  nature.inputs.po
-0000e0a0: 7028 7365 6c66 2e5f 7369 676e 6174 7572  p(self._signatur
-0000e0b0: 652e 696e 7075 7473 2e6b 6579 5f6c 6973  e.inputs.key_lis
-0000e0c0: 745b 305d 290d 0a20 2020 2020 2020 2065  t[0])..        e
-0000e0d0: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
-0000e0e0: 6e73 7065 6374 5f61 7267 732c 206c 6973  nspect_args, lis
-0000e0f0: 7429 2061 6e64 206c 656e 2873 656c 662e  t) and len(self.
-0000e100: 5f73 6967 6e61 7475 7265 2e69 6e70 7574  _signature.input
-0000e110: 7329 203d 3d20 6c65 6e28 696e 7370 6563  s) == len(inspec
-0000e120: 745f 6172 6773 293a 0d0a 2020 2020 2020  t_args):..      
-0000e130: 2020 2020 2020 666f 7220 6b31 2c20 6b32        for k1, k2
-0000e140: 2069 6e20 7a69 7028 696e 7370 6563 745f   in zip(inspect_
-0000e150: 6172 6773 2c20 7365 6c66 2e5f 7369 676e  args, self._sign
-0000e160: 6174 7572 652e 696e 7075 7473 2e6b 6579  ature.inputs.key
-0000e170: 5f6c 6973 742e 636f 7079 2829 293a 0d0a  _list.copy()):..
-0000e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e190: 6966 206b 3120 213d 206b 323a 0d0a 2020  if k1 != k2:..  
-0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1b0: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
-0000e1c0: 652e 696e 7075 7473 5b6b 315d 203d 2073  e.inputs[k1] = s
-0000e1d0: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
-0000e1e0: 6e70 7574 735b 6b32 5d0d 0a20 2020 2020  nputs[k2]..     
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000e200: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
-0000e210: 6e70 7574 732e 706f 7028 6b32 290d 0a20  nputs.pop(k2).. 
-0000e220: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000e230: 6c66 2e5f 7369 676e 6174 7572 650d 0a0d  lf._signature...
-0000e240: 0a20 2020 2040 7369 676e 6174 7572 652e  .    @signature.
-0000e250: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
-0000e260: 7369 676e 6174 7572 6528 7365 6c66 2c20  signature(self, 
-0000e270: 7661 6c75 6529 3a0d 0a20 2020 2020 2020  value):..       
-0000e280: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
-0000e290: 203d 2076 616c 7565 0d0a 0d0a 2020 2020   = value....    
-0000e2a0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0000e2b0: 6566 206f 7574 7075 7428 7365 6c66 293a  ef output(self):
-0000e2c0: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
-0000e2d0: 7269 6576 6573 2074 6865 206f 7574 7075  rieves the outpu
-0000e2e0: 7420 7465 6e73 6f72 2873 2920 6f66 2061  t tensor(s) of a
-0000e2f0: 206c 6179 6572 2e0d 0a20 2020 2020 2020   layer...       
-0000e300: 2020 2020 2066 6f72 206d 656d 6f72 7920       for memory 
-0000e310: 7361 7669 6e67 2069 7373 7565 2c20 7765  saving issue, we
-0000e320: 2064 6f6e 2774 6220 7072 6566 6572 2074   don'tb prefer t
-0000e330: 6f20 6b65 6570 2065 7665 7279 2069 6e70  o keep every inp
-0000e340: 7574 2f6f 7574 7075 740d 0a20 2020 2020  ut/output..     
-0000e350: 2020 2020 2020 2074 656e 736f 7220 696e         tensor in
-0000e360: 2065 7665 7279 206c 6179 6572 2e59 6f75   every layer.You
-0000e370: 2073 686f 756c 6420 7365 7420 7365 6c66   should set self
-0000e380: 2e6b 6565 705f 6f75 7470 7574 2066 6c61  .keep_output fla
-0000e390: 6720 746f 2054 7275 652c 2061 6e64 2074  g to True, and t
-0000e3a0: 6865 6e0d 0a20 2020 2020 2020 2020 2020  hen..           
-0000e3b0: 2072 6574 7269 7665 2074 6865 206f 7574   retrive the out
-0000e3c0: 7075 7420 7465 6e73 6f72 2077 6865 6e20  put tensor when 
-0000e3d0: 7468 6520 6361 6c6c 6c28 2920 6973 2065  the calll() is e
-0000e3e0: 7865 6375 7469 6e67 2e0d 0a20 2020 2020  xecuting...     
-0000e3f0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-0000e400: 2020 2020 2020 2020 2020 2020 4f75 7470              Outp
-0000e410: 7574 2074 656e 736f 7220 6f72 206c 6973  ut tensor or lis
-0000e420: 7420 6f66 206f 7574 7075 7420 7465 6e73  t of output tens
-0000e430: 6f72 732e 0d0a 2020 2020 2052 6169 7365  ors...     Raise
-0000e440: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0000e450: 2020 2041 7474 7269 6275 7465 4572 726f     AttributeErro
-0000e460: 723a 2069 6620 7468 6520 6c61 7965 7220  r: if the layer 
-0000e470: 6973 2063 6f6e 6e65 6374 6564 2074 6f0d  is connected to.
-0000e480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e490: 206d 6f72 6520 7468 616e 206f 6e65 2069   more than one i
-0000e4a0: 6e63 6f6d 696e 6720 6c61 7965 7273 2e0d  ncoming layers..
-0000e4b0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0000e4c0: 2020 2020 2020 6966 2073 656c 662e 6b65        if self.ke
-0000e4d0: 6570 5f6f 7574 7075 7420 3d3d 2046 616c  ep_output == Fal
-0000e4e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0000e4f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000e500: 7228 274c 6179 6572 207b 307d 2068 6173  r('Layer {0} has
-0000e510: 206e 6f74 2073 6574 2073 656c 662e 6b65   not set self.ke
-0000e520: 6570 5f6f 7574 7075 7420 2074 6f20 5472  ep_output  to Tr
-0000e530: 7565 2c20 6361 6e6e 6f74 2061 6363 6573  ue, cannot acces
-0000e540: 7320 6f75 7470 7574 2027 2e66 6f72 6d61  s output '.forma
-0000e550: 7428 7365 6c66 2e6e 616d 6529 290d 0a20  t(self.name)).. 
-0000e560: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
-0000e570: 7374 2873 656c 662e 5f6f 7574 7075 745f  st(self._output_
-0000e580: 7465 6e73 6f72 2920 6966 2069 7369 6e73  tensor) if isins
-0000e590: 7461 6e63 6528 7365 6c66 2e5f 6f75 7470  tance(self._outp
-0000e5a0: 7574 5f74 656e 736f 722c 2074 7570 6c65  ut_tensor, tuple
-0000e5b0: 2920 656c 7365 2073 656c 662e 5f6f 7574  ) else self._out
-0000e5c0: 7075 745f 7465 6e73 6f72 0d0a 0d0a 2020  put_tensor....  
-0000e5d0: 2020 6465 6620 7265 7365 745f 7061 7261    def reset_para
-0000e5e0: 6d65 7465 7273 2873 656c 6629 3a0d 0a20  meters(self):.. 
-0000e5f0: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
-0000e600: 2020 2064 6566 2063 6f70 7928 7365 6c66     def copy(self
-0000e610: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
-0000e620: 7265 6174 6520 6120 6e65 7720 4672 6f7a  reate a new Froz
-0000e630: 656e 4469 6374 2077 6974 6820 6164 6469  enDict with addi
-0000e640: 7469 6f6e 616c 206f 7220 7265 706c 6163  tional or replac
-0000e650: 6564 2065 6e74 7269 6573 2e22 2222 0d0a  ed entries."""..
-0000e660: 2020 2020 2020 2020 7369 6720 3d20 6765          sig = ge
-0000e670: 745f 7369 676e 6174 7572 6528 7479 7065  t_signature(type
-0000e680: 2873 656c 6629 2e5f 5f69 6e69 745f 5f29  (self).__init__)
-0000e690: 0d0a 2020 2020 2020 2020 5f61 7267 7320  ..        _args 
-0000e6a0: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
-0000e6b0: 0a20 2020 2020 2020 2066 6f72 2069 6e70  .        for inp
-0000e6c0: 2069 6e20 7369 672e 696e 7075 7473 2e6b   in sig.inputs.k
-0000e6d0: 6579 5f6c 6973 743a 0d0a 2020 2020 2020  ey_list:..      
-0000e6e0: 2020 2020 2020 6966 2069 6e70 2069 6e20        if inp in 
-0000e6f0: 7365 6c66 2e5f 5f64 6963 745f 5f3a 0d0a  self.__dict__:..
-0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e710: 5f61 7267 735b 696e 705d 203d 2073 656c  _args[inp] = sel
-0000e720: 662e 5f5f 6469 6374 5f5f 5b69 6e70 5d0d  f.__dict__[inp].
-0000e730: 0a20 2020 2020 2020 2073 6861 646f 7720  .        shadow 
-0000e740: 3d20 7479 7065 2873 656c 6629 282a 2a5f  = type(self)(**_
-0000e750: 6172 6773 290d 0a20 2020 2020 2020 2073  args)..        s
-0000e760: 6861 646f 772e 6275 696c 6428 7365 6c66  hadow.build(self
-0000e770: 2e69 6e70 7574 5f73 6861 7065 290d 0a20  .input_shape).. 
-0000e780: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-0000e790: 696e 2073 656c 662e 5f5f 6469 6374 5f5f  in self.__dict__
-0000e7a0: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-0000e7b0: 2020 2020 2020 2069 6620 6b20 6e6f 7420         if k not 
-0000e7c0: 696e 205f 6172 6773 2061 6e64 206b 206e  in _args and k n
-0000e7d0: 6f74 2069 6e20 5b27 5f6d 6f64 756c 6573  ot in ['_modules
-0000e7e0: 272c 2027 5f70 6172 616d 6574 6572 7327  ', '_parameters'
-0000e7f0: 2c20 275f 6275 6666 6572 7327 5d3a 0d0a  , '_buffers']:..
-0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e810: 6966 2069 735f 7465 6e73 6f72 2876 293a  if is_tensor(v):
-0000e820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e830: 2020 2020 2020 7368 6164 6f77 2e5f 5f64        shadow.__d
-0000e840: 6963 745f 5f5b 6b5d 203d 2074 6f5f 7465  ict__[k] = to_te
-0000e850: 6e73 6f72 2874 6f5f 6e75 6d70 7928 7629  nsor(to_numpy(v)
-0000e860: 2c20 6474 7970 653d 762e 6474 7970 652c  , dtype=v.dtype,
-0000e870: 2064 6576 6963 653d 762e 6465 7669 6365   device=v.device
-0000e880: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8b0: 2020 2020 2020 7265 7175 6972 6573 5f67        requires_g
-0000e8c0: 7261 643d 762e 7265 7175 6972 6573 5f67  rad=v.requires_g
-0000e8d0: 7261 6429 0d0a 2020 2020 2020 2020 2020  rad)..          
-0000e8e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0000e8f0: 7461 6e63 6528 762c 2028 7374 722c 2062  tance(v, (str, b
-0000e900: 6f6f 6c2c 206e 756d 6265 7273 2e4e 756d  ool, numbers.Num
-0000e910: 6265 7229 2920 6f72 206b 2069 6e20 5b27  ber)) or k in ['
-0000e920: 5f6e 6f64 6573 275d 3a0d 0a20 2020 2020  _nodes']:..     
-0000e930: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000e940: 6574 6174 7472 2873 6861 646f 772c 206b  etattr(shadow, k
-0000e950: 2c20 7629 0d0a 2020 2020 2020 2020 2020  , v)..          
-0000e960: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e980: 2073 6574 6174 7472 2873 6861 646f 772c   setattr(shadow,
-0000e990: 206b 2c20 636f 7079 2e64 6565 7063 6f70   k, copy.deepcop
-0000e9a0: 7928 7629 290d 0a20 2020 2020 2020 2073  y(v))..        s
-0000e9b0: 6861 646f 772e 6c6f 6164 5f73 7461 7465  hadow.load_state
-0000e9c0: 5f64 6963 7428 7365 6c66 2e73 7461 7465  _dict(self.state
-0000e9d0: 5f64 6963 7428 2929 0d0a 2020 2020 2020  _dict())..      
-0000e9e0: 2020 7368 6164 6f77 2e74 6f28 7365 6c66    shadow.to(self
-0000e9f0: 2e64 6576 6963 6529 0d0a 2020 2020 2020  .device)..      
-0000ea00: 2020 7265 7475 726e 2073 6861 646f 770d    return shadow.
-0000ea10: 0a0d 0a20 2020 2020 2020 2023 2054 6865  ...        # The
-0000ea20: 2075 7365 7220 6361 6e20 7061 7373 2061   user can pass a
-0000ea30: 6e20 6f70 7469 6f6e 616c 2061 7262 6974  n optional arbit
-0000ea40: 7261 7279 206d 6170 7061 626c 6520 6f62  rary mappable ob
-0000ea50: 6a65 6374 2074 6f20 6073 7461 7465 5f64  ject to `state_d
-0000ea60: 6963 7460 2c20 696e 2077 6869 6368 2063  ict`, in which c
-0000ea70: 6173 6520 6073 7461 7465 5f64 6963 7460  ase `state_dict`
-0000ea80: 2072 6574 7572 6e73 0d0a 2020 2020 2020   returns..      
-0000ea90: 2020 2320 6261 636b 2074 6861 7420 7361    # back that sa
-0000eaa0: 6d65 206f 626a 6563 742e 2042 7574 2069  me object. But i
-0000eab0: 6620 7468 6579 2070 6173 7320 6e6f 7468  f they pass noth
-0000eac0: 696e 672c 2061 6e20 604f 7265 6465 7265  ing, an `Oredere
-0000ead0: 6444 6963 7460 2069 7320 6372 6561 7465  dDict` is create
-0000eae0: 6420 616e 6420 7265 7475 726e 6564 2e0d  d and returned..
-0000eaf0: 0a0d 0a0d 0a0d 0a20 2020 2064 6566 205f  .......    def _
-0000eb00: 7361 7665 5f74 6f5f 7374 6174 655f 6469  save_to_state_di
-0000eb10: 6374 2873 656c 662c 2064 6573 7469 6e61  ct(self, destina
-0000eb20: 7469 6f6e 2c20 7072 6566 6978 2c20 6b65  tion, prefix, ke
-0000eb30: 6570 5f76 6172 7329 3a0d 0a20 2020 2020  ep_vars):..     
-0000eb40: 2020 2072 2222 2253 6176 6573 206d 6f64     r"""Saves mod
-0000eb50: 756c 6520 7374 6174 6520 746f 2060 6465  ule state to `de
-0000eb60: 7374 696e 6174 696f 6e60 2064 6963 7469  stination` dicti
-0000eb70: 6f6e 6172 792c 2063 6f6e 7461 696e 696e  onary, containin
-0000eb80: 6720 6120 7374 6174 650d 0a20 2020 2020  g a state..     
-0000eb90: 2020 206f 6620 7468 6520 6d6f 6475 6c65     of the module
-0000eba0: 2c20 6275 7420 6e6f 7420 6974 7320 6465  , but not its de
-0000ebb0: 7363 656e 6461 6e74 732e 2054 6869 7320  scendants. This 
-0000ebc0: 6973 2063 616c 6c65 6420 6f6e 2065 7665  is called on eve
-0000ebd0: 7279 0d0a 2020 2020 2020 2020 7375 626d  ry..        subm
-0000ebe0: 6f64 756c 6520 696e 203a 6d65 7468 3a60  odule in :meth:`
-0000ebf0: 4c61 7965 722e 7374 6174 655f 6469 6374  Layer.state_dict
-0000ec00: 602e 0d0a 2020 2020 2020 2020 496e 2072  `...        In r
-0000ec10: 6172 6520 6361 7365 732c 2073 7562 636c  are cases, subcl
-0000ec20: 6173 7365 7320 6361 6e20 6163 6869 6576  asses can achiev
-0000ec30: 6520 636c 6173 732d 7370 6563 6966 6963  e class-specific
-0000ec40: 2062 6568 6176 696f 7220 6279 0d0a 2020   behavior by..  
-0000ec50: 2020 2020 2020 6f76 6572 7269 6469 6e67        overriding
-0000ec60: 2074 6869 7320 6d65 7468 6f64 2077 6974   this method wit
-0000ec70: 6820 6375 7374 6f6d 206c 6f67 6963 2e0d  h custom logic..
-0000ec80: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-0000ec90: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-0000eca0: 696e 6174 696f 6e20 2864 6963 7429 3a20  ination (dict): 
-0000ecb0: 6120 6469 6374 2077 6865 7265 2073 7461  a dict where sta
-0000ecc0: 7465 2077 696c 6c20 6265 2073 746f 7265  te will be store
-0000ecd0: 640d 0a20 2020 2020 2020 2020 2020 2070  d..            p
-0000ece0: 7265 6669 7820 2873 7472 293a 2074 6865  refix (str): the
-0000ecf0: 2070 7265 6669 7820 666f 7220 7061 7261   prefix for para
-0000ed00: 6d65 7465 7273 2061 6e64 2062 7566 6665  meters and buffe
-0000ed10: 7273 2075 7365 6420 696e 2074 6869 730d  rs used in this.
-0000ed20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed30: 206d 6f64 756c 650d 0a20 2020 2020 2020   module..       
-0000ed40: 2022 2222 0d0a 2020 2020 2020 2020 666f   """..        fo
-0000ed50: 7220 6e61 6d65 2c20 7061 7261 6d20 696e  r name, param in
-0000ed60: 2073 656c 662e 5f70 6172 616d 6574 6572   self._parameter
-0000ed70: 732e 6974 656d 7328 293a 0d0a 2020 2020  s.items():..    
-0000ed80: 2020 2020 2020 2020 6966 2070 6172 616d          if param
-0000ed90: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0000eda0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000edb0: 6573 7469 6e61 7469 6f6e 5b70 7265 6669  estination[prefi
-0000edc0: 7820 2b20 6e61 6d65 5d20 3d20 7061 7261  x + name] = para
-0000edd0: 6d20 6966 206b 6565 705f 7661 7273 2065  m if keep_vars e
-0000ede0: 6c73 6520 7061 7261 6d2e 7661 6c75 6528  lse param.value(
-0000edf0: 292e 6465 7461 6368 2829 0d0a 2020 2020  ).detach()..    
-0000ee00: 2020 2020 666f 7220 6e61 6d65 2c20 6275      for name, bu
-0000ee10: 6620 696e 2073 656c 662e 5f62 7566 6665  f in self._buffe
-0000ee20: 7273 2e69 7465 6d73 2829 3a0d 0a20 2020  rs.items():..   
-0000ee30: 2020 2020 2020 2020 2069 6620 6275 6620           if buf 
-0000ee40: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000ee50: 6e61 6d65 206e 6f74 2069 6e20 7365 6c66  name not in self
-0000ee60: 2e5f 6e6f 6e5f 7065 7273 6973 7465 6e74  ._non_persistent
-0000ee70: 5f62 7566 6665 7273 5f73 6574 3a0d 0a20  _buffers_set:.. 
-0000ee80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000ee90: 6573 7469 6e61 7469 6f6e 5b70 7265 6669  estination[prefi
-0000eea0: 7820 2b20 6e61 6d65 5d20 3d20 6275 6620  x + name] = buf 
-0000eeb0: 6966 206b 6565 705f 7661 7273 2065 6c73  if keep_vars els
-0000eec0: 6520 6275 662e 636f 7079 2829 2e64 6574  e buf.copy().det
-0000eed0: 6163 6828 290d 0a0d 0a20 2020 2054 5f64  ach()....    T_d
-0000eee0: 6573 7469 6e61 7469 6f6e 203d 2054 7970  estination = Typ
-0000eef0: 6556 6172 2827 545f 6465 7374 696e 6174  eVar('T_destinat
-0000ef00: 696f 6e27 2c20 626f 756e 643d 4469 6374  ion', bound=Dict
-0000ef10: 5b73 7472 2c20 416e 795d 290d 0a20 2020  [str, Any])..   
-0000ef20: 2040 6f76 6572 6c6f 6164 0d0a 2020 2020   @overload..    
-0000ef30: 6465 6620 7374 6174 655f 6469 6374 2873  def state_dict(s
-0000ef40: 656c 662c 2020 6465 7374 696e 6174 696f  elf,  destinatio
-0000ef50: 6e3a 2054 5f64 6573 7469 6e61 7469 6f6e  n: T_destination
-0000ef60: 2c20 7072 6566 6978 3a20 7374 7220 3d20  , prefix: str = 
-0000ef70: 2e2e 2e2c 206b 6565 705f 7661 7273 3a20  ..., keep_vars: 
-0000ef80: 626f 6f6c 203d 202e 2e2e 2920 2d3e 2054  bool = ...) -> T
-0000ef90: 5f64 6573 7469 6e61 7469 6f6e 3a0d 0a20  _destination:.. 
-0000efa0: 2020 2020 2020 202e 2e2e 0d0a 0d0a 2020         .......  
-0000efb0: 2020 2320 544f 444f 3a20 616e 6e6f 7461    # TODO: annota
-0000efc0: 7465 2077 6974 6820 4f72 6465 7265 6444  te with OrderedD
-0000efd0: 6963 7420 6e6f 7420 4469 6374 2c20 6275  ict not Dict, bu
-0000efe0: 7420 7468 6572 6520 6973 2061 2070 726f  t there is a pro
-0000eff0: 626c 656d 3a0d 0a20 2020 2023 2068 7474  blem:..    # htt
-0000f000: 7073 3a2f 2f64 6f63 732e 7079 7468 6f6e  ps://docs.python
-0000f010: 2e6f 7267 2f33 2f6c 6962 7261 7279 2f74  .org/3/library/t
-0000f020: 7970 696e 672e 6874 6d6c 2374 7970 696e  yping.html#typin
-0000f030: 672e 4f72 6465 7265 6444 6963 740d 0a20  g.OrderedDict.. 
-0000f040: 2020 2040 6f76 6572 6c6f 6164 0d0a 2020     @overload..  
-0000f050: 2020 6465 6620 7374 6174 655f 6469 6374    def state_dict
-0000f060: 2873 656c 662c 2020 2a2c 2070 7265 6669  (self,  *, prefi
-0000f070: 783a 2073 7472 203d 202e 2e2e 2c20 6b65  x: str = ..., ke
-0000f080: 6570 5f76 6172 733a 2062 6f6f 6c20 3d20  ep_vars: bool = 
-0000f090: 2e2e 2e29 202d 3e20 4469 6374 5b73 7472  ...) -> Dict[str
-0000f0a0: 2c20 416e 795d 3a0d 0a20 2020 2020 2020  , Any]:..       
-0000f0b0: 202e 2e2e 0d0a 0d0a 2020 2020 6465 6620   .......    def 
-0000f0c0: 7374 6174 655f 6469 6374 2873 656c 662c  state_dict(self,
-0000f0d0: 2020 6465 7374 696e 6174 696f 6e3d 4e6f    destination=No
-0000f0e0: 6e65 2c20 7072 6566 6978 3d27 272c 206b  ne, prefix='', k
-0000f0f0: 6565 705f 7661 7273 3d46 616c 7365 293a  eep_vars=False):
-0000f100: 0d0a 2020 2020 2020 2020 7222 2222 5265  ..        r"""Re
-0000f110: 7475 726e 7320 6120 6469 6374 696f 6e61  turns a dictiona
-0000f120: 7279 2063 6f6e 7461 696e 696e 6720 6120  ry containing a 
-0000f130: 7768 6f6c 6520 7374 6174 6520 6f66 2074  whole state of t
-0000f140: 6865 206d 6f64 756c 652e 0d0a 0d0a 2020  he module.....  
-0000f150: 2020 2020 2020 426f 7468 2070 6172 616d        Both param
-0000f160: 6574 6572 7320 616e 6420 7065 7273 6973  eters and persis
-0000f170: 7465 6e74 2062 7566 6665 7273 2028 652e  tent buffers (e.
-0000f180: 672e 2072 756e 6e69 6e67 2061 7665 7261  g. running avera
-0000f190: 6765 7329 2061 7265 0d0a 2020 2020 2020  ges) are..      
-0000f1a0: 2020 696e 636c 7564 6564 2e20 4b65 7973    included. Keys
-0000f1b0: 2061 7265 2063 6f72 7265 7370 6f6e 6469   are correspondi
-0000f1c0: 6e67 2070 6172 616d 6574 6572 2061 6e64  ng parameter and
-0000f1d0: 2062 7566 6665 7220 6e61 6d65 732e 0d0a   buffer names...
-0000f1e0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000f1f0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000f200: 6469 6374 3a0d 0a20 2020 2020 2020 2020  dict:..         
-0000f210: 2020 2020 2020 2061 2064 6963 7469 6f6e         a diction
-0000f220: 6172 7920 636f 6e74 6169 6e69 6e67 2061  ary containing a
-0000f230: 2077 686f 6c65 2073 7461 7465 206f 6620   whole state of 
-0000f240: 7468 6520 6d6f 6475 6c65 0d0a 0d0a 2020  the module....  
-0000f250: 2020 2020 2020 4578 616d 706c 653a 3a0d        Example::.
-0000f260: 0a0d 0a20 2020 2020 2020 2020 2020 203e  ...            >
-0000f270: 3e3e 206d 6f64 756c 652e 7374 6174 655f  >> module.state_
-0000f280: 6469 6374 2829 2e6b 6579 7328 290d 0a20  dict().keys().. 
-0000f290: 2020 2020 2020 2020 2020 205b 2762 6961             ['bia
-0000f2a0: 7327 2c20 2777 6569 6768 7427 5d0d 0a0d  s', 'weight']...
-0000f2b0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0000f2c0: 2020 2020 2020 7769 7468 2074 662e 6465        with tf.de
-0000f2d0: 7669 6365 2873 656c 662e 6765 745f 726f  vice(self.get_ro
-0000f2e0: 6f74 2829 2e64 6576 6963 6529 3a0d 0a20  ot().device):.. 
-0000f2f0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-0000f300: 7374 696e 6174 696f 6e20 6973 204e 6f6e  stination is Non
-0000f310: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000f320: 2020 2020 6465 7374 696e 6174 696f 6e20      destination 
-0000f330: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
-0000f340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f350: 2064 6573 7469 6e61 7469 6f6e 2e5f 6d65   destination._me
-0000f360: 7461 6461 7461 203d 204f 7264 6572 6564  tadata = Ordered
-0000f370: 4469 6374 2829 0d0a 2020 2020 2020 2020  Dict()..        
-0000f380: 2020 2020 6465 7374 696e 6174 696f 6e2e      destination.
-0000f390: 5f6d 6574 6164 6174 615b 7072 6566 6978  _metadata[prefix
-0000f3a0: 5b3a 2d31 5d5d 203d 206c 6f63 616c 5f6d  [:-1]] = local_m
-0000f3b0: 6574 6164 6174 6120 3d20 6469 6374 2876  etadata = dict(v
-0000f3c0: 6572 7369 6f6e 3d73 656c 662e 5f76 6572  ersion=self._ver
-0000f3d0: 7369 6f6e 290d 0a0d 0a20 2020 2020 2020  sion)....       
-0000f3e0: 2020 2020 2073 656c 662e 5f73 6176 655f       self._save_
-0000f3f0: 746f 5f73 7461 7465 5f64 6963 7428 6465  to_state_dict(de
-0000f400: 7374 696e 6174 696f 6e2c 2070 7265 6669  stination, prefi
-0000f410: 782c 206b 6565 705f 7661 7273 290d 0a20  x, keep_vars).. 
-0000f420: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-0000f430: 616d 652c 206d 6f64 756c 6520 696e 2073  ame, module in s
-0000f440: 656c 662e 5f6d 6f64 756c 6573 2e69 7465  elf._modules.ite
-0000f450: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
-0000f460: 2020 2020 2020 2069 6620 6d6f 6475 6c65         if module
-0000f470: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f490: 2020 206d 6f64 756c 652e 7374 6174 655f     module.state_
-0000f4a0: 6469 6374 2864 6573 7469 6e61 7469 6f6e  dict(destination
-0000f4b0: 2c20 7072 6566 6978 202b 206e 616d 6520  , prefix + name 
-0000f4c0: 2b20 272e 272c 206b 6565 705f 7661 7273  + '.', keep_vars
-0000f4d0: 3d6b 6565 705f 7661 7273 290d 0a20 2020  =keep_vars)..   
-0000f4e0: 2020 2020 2020 2020 2066 6f72 2068 6f6f           for hoo
-0000f4f0: 6b20 696e 2073 656c 662e 5f73 7461 7465  k in self._state
-0000f500: 5f64 6963 745f 686f 6f6b 732e 7661 6c75  _dict_hooks.valu
-0000f510: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
-0000f520: 2020 2020 2020 2068 6f6f 6b5f 7265 7375         hook_resu
-0000f530: 6c74 203d 2068 6f6f 6b28 7365 6c66 2c20  lt = hook(self, 
-0000f540: 6465 7374 696e 6174 696f 6e2c 2070 7265  destination, pre
-0000f550: 6669 782c 206c 6f63 616c 5f6d 6574 6164  fix, local_metad
-0000f560: 6174 6129 0d0a 2020 2020 2020 2020 2020  ata)..          
-0000f570: 2020 2020 2020 6966 2068 6f6f 6b5f 7265        if hook_re
-0000f580: 7375 6c74 2069 7320 6e6f 7420 4e6f 6e65  sult is not None
-0000f590: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000f5a0: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
-0000f5b0: 6f6e 203d 2068 6f6f 6b5f 7265 7375 6c74  on = hook_result
-0000f5c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000f5d0: 7475 726e 2064 6573 7469 6e61 7469 6f6e  turn destination
-0000f5e0: 0d0a 0d0a 2020 2020 6465 6620 5f72 6567  ....    def _reg
-0000f5f0: 6973 7465 725f 6c6f 6164 5f73 7461 7465  ister_load_state
-0000f600: 5f64 6963 745f 7072 655f 686f 6f6b 2873  _dict_pre_hook(s
-0000f610: 656c 662c 2068 6f6f 6b29 3a0d 0a20 2020  elf, hook):..   
-0000f620: 2020 2020 2072 2222 2254 6865 7365 2068       r"""These h
-0000f630: 6f6f 6b73 2077 696c 6c20 6265 2063 616c  ooks will be cal
-0000f640: 6c65 6420 7769 7468 2061 7267 756d 656e  led with argumen
-0000f650: 7473 3a20 6073 7461 7465 5f64 6963 7460  ts: `state_dict`
-0000f660: 2c20 6070 7265 6669 7860 2c0d 0a20 2020  , `prefix`,..   
-0000f670: 2020 2020 2060 6c6f 6361 6c5f 6d65 7461       `local_meta
-0000f680: 6461 7461 602c 2060 7374 7269 6374 602c  data`, `strict`,
-0000f690: 2060 6d69 7373 696e 675f 6b65 7973 602c   `missing_keys`,
-0000f6a0: 2060 756e 6578 7065 6374 6564 5f6b 6579   `unexpected_key
-0000f6b0: 7360 2c0d 0a20 2020 2020 2020 2060 6572  s`,..        `er
-0000f6c0: 726f 725f 6d73 6773 602c 2062 6566 6f72  ror_msgs`, befor
-0000f6d0: 6520 6c6f 6164 696e 6720 6073 7461 7465  e loading `state
-0000f6e0: 5f64 6963 7460 2069 6e74 6f20 6073 656c  _dict` into `sel
-0000f6f0: 6660 2e20 5468 6573 6520 6172 6775 6d65  f`. These argume
-0000f700: 6e74 730d 0a20 2020 2020 2020 2061 7265  nts..        are
-0000f710: 2065 7861 6374 6c79 2074 6865 2073 616d   exactly the sam
-0000f720: 6520 6173 2074 686f 7365 206f 6620 605f  e as those of `_
-0000f730: 6c6f 6164 5f66 726f 6d5f 7374 6174 655f  load_from_state_
-0000f740: 6469 6374 602e 0d0a 2020 2020 2020 2020  dict`...        
-0000f750: 2222 220d 0a20 2020 2020 2020 2068 616e  """..        han
-0000f760: 646c 6520 3d20 5265 6d6f 7661 626c 6548  dle = RemovableH
-0000f770: 616e 646c 6528 7365 6c66 2e5f 6c6f 6164  andle(self._load
-0000f780: 5f73 7461 7465 5f64 6963 745f 7072 655f  _state_dict_pre_
-0000f790: 686f 6f6b 7329 0d0a 2020 2020 2020 2020  hooks)..        
-0000f7a0: 7365 6c66 2e5f 6c6f 6164 5f73 7461 7465  self._load_state
-0000f7b0: 5f64 6963 745f 7072 655f 686f 6f6b 735b  _dict_pre_hooks[
-0000f7c0: 6861 6e64 6c65 2e69 645d 203d 2068 6f6f  handle.id] = hoo
-0000f7d0: 6b0d 0a20 2020 2020 2020 2072 6574 7572  k..        retur
-0000f7e0: 6e20 6861 6e64 6c65 0d0a 0d0a 2020 2020  n handle....    
-0000f7f0: 6465 6620 5f6c 6f61 645f 6672 6f6d 5f73  def _load_from_s
-0000f800: 7461 7465 5f64 6963 7428 7365 6c66 2c20  tate_dict(self, 
-0000f810: 7374 6174 655f 6469 6374 2c20 7072 6566  state_dict, pref
-0000f820: 6978 2c20 6c6f 6361 6c5f 6d65 7461 6461  ix, local_metada
-0000f830: 7461 2c20 7374 7269 6374 2c0d 0a20 2020  ta, strict,..   
-0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f850: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-0000f860: 6e67 5f6b 6579 732c 2075 6e65 7870 6563  ng_keys, unexpec
-0000f870: 7465 645f 6b65 7973 2c20 6572 726f 725f  ted_keys, error_
-0000f880: 6d73 6773 293a 0d0a 2020 2020 2020 2020  msgs):..        
-0000f890: 7222 2222 436f 7069 6573 2070 6172 616d  r"""Copies param
-0000f8a0: 6574 6572 7320 616e 6420 6275 6666 6572  eters and buffer
-0000f8b0: 7320 6672 6f6d 203a 6174 7472 3a60 7374  s from :attr:`st
-0000f8c0: 6174 655f 6469 6374 6020 696e 746f 206f  ate_dict` into o
-0000f8d0: 6e6c 790d 0a20 2020 2020 2020 2074 6869  nly..        thi
-0000f8e0: 7320 6d6f 6475 6c65 2c20 6275 7420 6e6f  s module, but no
-0000f8f0: 7420 6974 7320 6465 7363 656e 6461 6e74  t its descendant
-0000f900: 732e 2054 6869 7320 6973 2063 616c 6c65  s. This is calle
-0000f910: 6420 6f6e 2065 7665 7279 2073 7562 6d6f  d on every submo
-0000f920: 6475 6c65 0d0a 2020 2020 2020 2020 696e  dule..        in
-0000f930: 203a 6d65 7468 3a60 7e74 656e 736f 7266   :meth:`~tensorf
-0000f940: 6c6f 772e 6e6e 2e4d 6f64 756c 652e 6c6f  low.nn.Module.lo
-0000f950: 6164 5f73 7461 7465 5f64 6963 7460 2e20  ad_state_dict`. 
-0000f960: 4d65 7461 6461 7461 2073 6176 6564 2066  Metadata saved f
-0000f970: 6f72 2074 6869 730d 0a20 2020 2020 2020  or this..       
-0000f980: 206d 6f64 756c 6520 696e 2069 6e70 7574   module in input
-0000f990: 203a 6174 7472 3a60 7374 6174 655f 6469   :attr:`state_di
-0000f9a0: 6374 6020 6973 2070 726f 7669 6465 6420  ct` is provided 
-0000f9b0: 6173 203a 6174 7472 3a60 6c6f 6361 6c5f  as :attr:`local_
-0000f9c0: 6d65 7461 6461 7461 602e 0d0a 2020 2020  metadata`...    
-0000f9d0: 2020 2020 466f 7220 7374 6174 6520 6469      For state di
-0000f9e0: 6374 7320 7769 7468 6f75 7420 6d65 7461  cts without meta
-0000f9f0: 6461 7461 2c20 3a61 7474 723a 606c 6f63  data, :attr:`loc
-0000fa00: 616c 5f6d 6574 6164 6174 6160 2069 7320  al_metadata` is 
-0000fa10: 656d 7074 792e 0d0a 2020 2020 2020 2020  empty...        
-0000fa20: 5375 6263 6c61 7373 6573 2063 616e 2061  Subclasses can a
-0000fa30: 6368 6965 7665 2063 6c61 7373 2d73 7065  chieve class-spe
-0000fa40: 6369 6669 6320 6261 636b 7761 7264 2063  cific backward c
-0000fa50: 6f6d 7061 7469 626c 6520 6c6f 6164 696e  ompatible loadin
-0000fa60: 6720 7573 696e 670d 0a20 2020 2020 2020  g using..       
-0000fa70: 2074 6865 2076 6572 7369 6f6e 206e 756d   the version num
-0000fa80: 6265 7220 6174 2060 6c6f 6361 6c5f 6d65  ber at `local_me
-0000fa90: 7461 6461 7461 2e67 6574 2822 7665 7273  tadata.get("vers
-0000faa0: 696f 6e22 2c20 4e6f 6e65 2960 2e0d 0a0d  ion", None)`....
-0000fab0: 0a20 2020 2020 2020 202e 2e20 6e6f 7465  .        .. note
-0000fac0: 3a3a 0d0a 2020 2020 2020 2020 2020 2020  ::..            
-0000fad0: 3a61 7474 723a 6073 7461 7465 5f64 6963  :attr:`state_dic
-0000fae0: 7460 2069 7320 6e6f 7420 7468 6520 7361  t` is not the sa
-0000faf0: 6d65 206f 626a 6563 7420 6173 2074 6865  me object as the
-0000fb00: 2069 6e70 7574 0d0a 2020 2020 2020 2020   input..        
-0000fb10: 2020 2020 3a61 7474 723a 6073 7461 7465      :attr:`state
-0000fb20: 5f64 6963 7460 2074 6f20 3a6d 6574 683a  _dict` to :meth:
-0000fb30: 607e 7465 6e73 6f72 666c 6f77 2e6e 6e2e  `~tensorflow.nn.
-0000fb40: 4d6f 6475 6c65 2e6c 6f61 645f 7374 6174  Module.load_stat
-0000fb50: 655f 6469 6374 602e 2053 6f0d 0a20 2020  e_dict`. So..   
-0000fb60: 2020 2020 2020 2020 2069 7420 6361 6e20           it can 
-0000fb70: 6265 206d 6f64 6966 6965 642e 0d0a 0d0a  be modified.....
-0000fb80: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-0000fb90: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000fba0: 7374 6174 655f 6469 6374 2028 6469 6374  state_dict (dict
-0000fbb0: 293a 2061 2064 6963 7420 636f 6e74 6169  ): a dict contai
-0000fbc0: 6e69 6e67 2070 6172 616d 6574 6572 7320  ning parameters 
-0000fbd0: 616e 640d 0a20 2020 2020 2020 2020 2020  and..           
-0000fbe0: 2020 2020 2070 6572 7369 7374 656e 7420       persistent 
-0000fbf0: 6275 6666 6572 732e 0d0a 2020 2020 2020  buffers...      
-0000fc00: 2020 2020 2020 7072 6566 6978 2028 7374        prefix (st
-0000fc10: 7229 3a20 7468 6520 7072 6566 6978 2066  r): the prefix f
-0000fc20: 6f72 2070 6172 616d 6574 6572 7320 616e  or parameters an
-0000fc30: 6420 6275 6666 6572 7320 7573 6564 2069  d buffers used i
-0000fc40: 6e20 7468 6973 0d0a 2020 2020 2020 2020  n this..        
-0000fc50: 2020 2020 2020 2020 6d6f 6475 6c65 0d0a          module..
-0000fc60: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
-0000fc70: 6c5f 6d65 7461 6461 7461 2028 6469 6374  l_metadata (dict
-0000fc80: 293a 2061 2064 6963 7420 636f 6e74 6169  ): a dict contai
-0000fc90: 6e69 6e67 2074 6865 206d 6574 6164 6174  ning the metadat
-0000fca0: 6120 666f 7220 7468 6973 206d 6f64 756c  a for this modul
-0000fcb0: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-0000fcc0: 2020 2020 5365 650d 0a20 2020 2020 2020      See..       
-0000fcd0: 2020 2020 2073 7472 6963 7420 2862 6f6f       strict (boo
-0000fce0: 6c29 3a20 7768 6574 6865 7220 746f 2073  l): whether to s
-0000fcf0: 7472 6963 746c 7920 656e 666f 7263 6520  trictly enforce 
-0000fd00: 7468 6174 2074 6865 206b 6579 7320 696e  that the keys in
-0000fd10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fd20: 2020 3a61 7474 723a 6073 7461 7465 5f64    :attr:`state_d
-0000fd30: 6963 7460 2077 6974 6820 3a61 7474 723a  ict` with :attr:
-0000fd40: 6070 7265 6669 7860 206d 6174 6368 2074  `prefix` match t
-0000fd50: 6865 206e 616d 6573 206f 660d 0a20 2020  he names of..   
-0000fd60: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000fd70: 616d 6574 6572 7320 616e 6420 6275 6666  ameters and buff
-0000fd80: 6572 7320 696e 2074 6869 7320 6d6f 6475  ers in this modu
-0000fd90: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
-0000fda0: 6d69 7373 696e 675f 6b65 7973 2028 6c69  missing_keys (li
-0000fdb0: 7374 206f 6620 7374 7229 3a20 6966 2060  st of str): if `
-0000fdc0: 6073 7472 6963 743d 5472 7565 6060 2c20  `strict=True``, 
-0000fdd0: 6164 6420 6d69 7373 696e 6720 6b65 7973  add missing keys
-0000fde0: 2074 6f0d 0a20 2020 2020 2020 2020 2020   to..           
-0000fdf0: 2020 2020 2074 6869 7320 6c69 7374 0d0a       this list..
-0000fe00: 2020 2020 2020 2020 2020 2020 756e 6578              unex
-0000fe10: 7065 6374 6564 5f6b 6579 7320 286c 6973  pected_keys (lis
-0000fe20: 7420 6f66 2073 7472 293a 2069 6620 6060  t of str): if ``
-0000fe30: 7374 7269 6374 3d54 7275 6560 602c 2061  strict=True``, a
-0000fe40: 6464 2075 6e65 7870 6563 7465 640d 0a20  dd unexpected.. 
-0000fe50: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0000fe60: 6579 7320 746f 2074 6869 7320 6c69 7374  eys to this list
-0000fe70: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
-0000fe80: 726f 725f 6d73 6773 2028 6c69 7374 206f  ror_msgs (list o
-0000fe90: 6620 7374 7229 3a20 6572 726f 7220 6d65  f str): error me
-0000fea0: 7373 6167 6573 2073 686f 756c 6420 6265  ssages should be
-0000feb0: 2061 6464 6564 2074 6f20 7468 6973 0d0a   added to this..
-0000fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fed0: 6c69 7374 2c20 616e 6420 7769 6c6c 2062  list, and will b
-0000fee0: 6520 7265 706f 7274 6564 2074 6f67 6574  e reported toget
-0000fef0: 6865 7220 696e 0d0a 2020 2020 2020 2020  her in..        
-0000ff00: 2020 2020 2020 2020 3a6d 6574 683a 607e          :meth:`~
-0000ff10: 7465 6e73 6f72 666c 6f77 2e6e 6e2e 4d6f  tensorflow.nn.Mo
-0000ff20: 6475 6c65 2e6c 6f61 645f 7374 6174 655f  dule.load_state_
-0000ff30: 6469 6374 600d 0a20 2020 2020 2020 2022  dict`..        "
-0000ff40: 2222 0d0a 2020 2020 2020 2020 666f 7220  ""..        for 
-0000ff50: 686f 6f6b 2069 6e20 7365 6c66 2e5f 6c6f  hook in self._lo
-0000ff60: 6164 5f73 7461 7465 5f64 6963 745f 7072  ad_state_dict_pr
-0000ff70: 655f 686f 6f6b 732e 7661 6c75 6573 2829  e_hooks.values()
-0000ff80: 3a0d 0a20 2020 2020 2020 2020 2020 2068  :..            h
-0000ff90: 6f6f 6b28 7374 6174 655f 6469 6374 2c20  ook(state_dict, 
-0000ffa0: 7072 6566 6978 2c20 6c6f 6361 6c5f 6d65  prefix, local_me
-0000ffb0: 7461 6461 7461 2c20 7374 7269 6374 2c20  tadata, strict, 
-0000ffc0: 6d69 7373 696e 675f 6b65 7973 2c20 756e  missing_keys, un
-0000ffd0: 6578 7065 6374 6564 5f6b 6579 732c 2065  expected_keys, e
-0000ffe0: 7272 6f72 5f6d 7367 7329 0d0a 0d0a 2020  rror_msgs)....  
-0000fff0: 2020 2020 2020 7065 7273 6973 7465 6e74        persistent
-00010000: 5f62 7566 6665 7273 203d 207b 6b3a 2076  _buffers = {k: v
-00010010: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-00010020: 662e 5f62 7566 6665 7273 2e69 7465 6d73  f._buffers.items
-00010030: 2829 2069 6620 6b20 6e6f 7420 696e 2073  () if k not in s
-00010040: 656c 662e 5f6e 6f6e 5f70 6572 7369 7374  elf._non_persist
-00010050: 656e 745f 6275 6666 6572 735f 7365 747d  ent_buffers_set}
-00010060: 0d0a 2020 2020 2020 2020 6c6f 6361 6c5f  ..        local_
-00010070: 6e61 6d65 5f70 6172 616d 7320 3d20 6974  name_params = it
-00010080: 6572 746f 6f6c 732e 6368 6169 6e28 7365  ertools.chain(se
-00010090: 6c66 2e5f 7061 7261 6d65 7465 7273 2e69  lf._parameters.i
-000100a0: 7465 6d73 2829 2c20 7065 7273 6973 7465  tems(), persiste
-000100b0: 6e74 5f62 7566 6665 7273 2e69 7465 6d73  nt_buffers.items
-000100c0: 2829 290d 0a20 2020 2020 2020 206c 6f63  ())..        loc
-000100d0: 616c 5f73 7461 7465 203d 207b 6b3a 2076  al_state = {k: v
-000100e0: 2066 6f72 206b 2c20 7620 696e 206c 6f63   for k, v in loc
-000100f0: 616c 5f6e 616d 655f 7061 7261 6d73 2069  al_name_params i
-00010100: 6620 7620 6973 206e 6f74 204e 6f6e 657d  f v is not None}
-00010110: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-00010120: 6e61 6d65 2c20 7061 7261 6d20 696e 206c  name, param in l
-00010130: 6f63 616c 5f73 7461 7465 2e69 7465 6d73  ocal_state.items
-00010140: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00010150: 206b 6579 203d 2070 7265 6669 7820 2b20   key = prefix + 
-00010160: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00010170: 2020 6966 206b 6579 2069 6e20 7374 6174    if key in stat
-00010180: 655f 6469 6374 3a0d 0a20 2020 2020 2020  e_dict:..       
-00010190: 2020 2020 2020 2020 2069 6e70 7574 5f70           input_p
-000101a0: 6172 616d 203d 2073 7461 7465 5f64 6963  aram = state_dic
-000101b0: 745b 6b65 795d 0d0a 0d0a 2020 2020 2020  t[key]....      
-000101c0: 2020 2020 2020 2020 2020 2320 4261 636b            # Back
-000101d0: 7761 7264 2063 6f6d 7061 7469 6269 6c69  ward compatibili
-000101e0: 7479 3a20 6c6f 6164 696e 6720 312d 6469  ty: loading 1-di
-000101f0: 6d20 7465 6e73 6f72 2066 726f 6d20 302e  m tensor from 0.
-00010200: 332e 2a20 746f 2076 6572 7369 6f6e 2030  3.* to version 0
-00010210: 2e34 2b0d 0a20 2020 2020 2020 2020 2020  .4+..           
-00010220: 2020 2020 2069 6620 6c65 6e28 7061 7261       if len(para
-00010230: 6d2e 7368 6170 6529 203d 3d20 3020 616e  m.shape) == 0 an
-00010240: 6420 6c65 6e28 696e 7075 745f 7061 7261  d len(input_para
-00010250: 6d2e 7368 6170 6529 203d 3d20 313a 0d0a  m.shape) == 1:..
-00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010270: 2020 2020 696e 7075 745f 7061 7261 6d20      input_param 
-00010280: 3d20 696e 7075 745f 7061 7261 6d5b 305d  = input_param[0]
-00010290: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000102a0: 2020 2020 6966 2069 6e70 7574 5f70 6172      if input_par
-000102b0: 616d 2e73 6861 7065 2021 3d20 7061 7261  am.shape != para
-000102c0: 6d2e 7368 6170 653a 0d0a 2020 2020 2020  m.shape:..      
-000102d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000102e0: 6c6f 6361 6c20 7368 6170 6520 7368 6f75  local shape shou
-000102f0: 6c64 206d 6174 6368 2074 6865 206f 6e65  ld match the one
-00010300: 2069 6e20 6368 6563 6b70 6f69 6e74 0d0a   in checkpoint..
-00010310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010320: 2020 2020 6572 726f 725f 6d73 6773 2e61      error_msgs.a
-00010330: 7070 656e 6428 2773 697a 6520 6d69 736d  ppend('size mism
-00010340: 6174 6368 2066 6f72 207b 7d3a 2063 6f70  atch for {}: cop
-00010350: 7969 6e67 2061 2070 6172 616d 2077 6974  ying a param wit
-00010360: 6820 7368 6170 6520 7b7d 2066 726f 6d20  h shape {} from 
-00010370: 6368 6563 6b70 6f69 6e74 2c20 270d 0a20  checkpoint, '.. 
-00010380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103a0: 2020 2020 2027 7468 6520 7368 6170 6520       'the shape 
-000103b0: 696e 2063 7572 7265 6e74 206d 6f64 656c  in current model
-000103c0: 2069 7320 7b7d 2e27 0d0a 2020 2020 2020   is {}.'..      
-000103d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103f0: 2e66 6f72 6d61 7428 6b65 792c 2069 6e70  .format(key, inp
-00010400: 7574 5f70 6172 616d 2e73 6861 7065 2c20  ut_param.shape, 
-00010410: 7061 7261 6d2e 7368 6170 6529 290d 0a20  param.shape)).. 
-00010420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010430: 2020 2063 6f6e 7469 6e75 650d 0a0d 0a20     continue.... 
-00010440: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00010450: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00010460: 2020 2020 2020 2020 2070 6172 616d 2e61           param.a
-00010470: 7373 6967 6e28 746f 5f74 656e 736f 7228  ssign(to_tensor(
-00010480: 696e 7075 745f 7061 7261 6d29 290d 0a0d  input_param))...
-00010490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000104a0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000104b0: 6e20 6173 2065 783a 0d0a 2020 2020 2020  n as ex:..      
-000104c0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-000104d0: 726f 725f 6d73 6773 2e61 7070 656e 6428  ror_msgs.append(
-000104e0: 2757 6869 6c65 2063 6f70 7969 6e67 2074  'While copying t
-000104f0: 6865 2070 6172 616d 6574 6572 206e 616d  he parameter nam
-00010500: 6564 2022 7b7d 222c 2027 0d0a 2020 2020  ed "{}", '..    
-00010510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010530: 2020 2777 686f 7365 2064 696d 656e 7369    'whose dimensi
-00010540: 6f6e 7320 696e 2074 6865 206d 6f64 656c  ons in the model
-00010550: 2061 7265 207b 7d20 616e 6420 270d 0a20   are {} and '.. 
-00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010580: 2020 2020 2027 7768 6f73 6520 6469 6d65       'whose dime
-00010590: 6e73 696f 6e73 2069 6e20 7468 6520 6368  nsions in the ch
-000105a0: 6563 6b70 6f69 6e74 2061 7265 207b 7d2c  eckpoint are {},
-000105b0: 2027 0d0a 2020 2020 2020 2020 2020 2020   '..            
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105d0: 2020 2020 2020 2020 2020 2761 6e20 6578            'an ex
-000105e0: 6365 7074 696f 6e20 6f63 6375 7265 6420  ception occured 
-000105f0: 3a20 7b7d 2e27 0d0a 2020 2020 2020 2020  : {}.'..        
-00010600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010610: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
-00010620: 6f72 6d61 7428 6b65 792c 206e 756d 656c  ormat(key, numel
-00010630: 2870 6172 616d 292c 206e 756d 656c 2869  (param), numel(i
-00010640: 6e70 7574 5f70 6172 616d 292c 2065 782e  nput_param), ex.
-00010650: 6172 6773 2929 0d0a 2020 2020 2020 2020  args))..        
-00010660: 2020 2020 656c 6966 2073 7472 6963 743a      elif strict:
-00010670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010680: 2020 6d69 7373 696e 675f 6b65 7973 2e61    missing_keys.a
-00010690: 7070 656e 6428 6b65 7929 0d0a 0d0a 2020  ppend(key)....  
-000106a0: 2020 2020 2020 6966 2073 7472 6963 743a        if strict:
-000106b0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-000106c0: 7220 6b65 7920 696e 2073 7461 7465 5f64  r key in state_d
-000106d0: 6963 742e 6b65 7973 2829 3a0d 0a20 2020  ict.keys():..   
-000106e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000106f0: 6b65 792e 7374 6172 7473 7769 7468 2870  key.startswith(p
-00010700: 7265 6669 7829 3a0d 0a20 2020 2020 2020  refix):..       
-00010710: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
-00010720: 7574 5f6e 616d 6520 3d20 6b65 795b 6c65  ut_name = key[le
-00010730: 6e28 7072 6566 6978 293a 5d0d 0a20 2020  n(prefix):]..   
-00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010750: 2069 6e70 7574 5f6e 616d 6520 3d20 696e   input_name = in
-00010760: 7075 745f 6e61 6d65 2e73 706c 6974 2827  put_name.split('
-00010770: 2e27 2c20 3129 5b30 5d20 2023 2067 6574  .', 1)[0]  # get
-00010780: 2074 6865 206e 616d 6520 6f66 2070 6172   the name of par
-00010790: 616d 2f62 7566 6665 722f 6368 696c 640d  am/buffer/child.
-000107a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000107b0: 2020 2020 2069 6620 696e 7075 745f 6e61       if input_na
-000107c0: 6d65 206e 6f74 2069 6e20 7365 6c66 2e5f  me not in self._
-000107d0: 6d6f 6475 6c65 7320 616e 6420 696e 7075  modules and inpu
-000107e0: 745f 6e61 6d65 206e 6f74 2069 6e20 6c6f  t_name not in lo
-000107f0: 6361 6c5f 7374 6174 653a 0d0a 2020 2020  cal_state:..    
-00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010810: 2020 2020 756e 6578 7065 6374 6564 5f6b      unexpected_k
-00010820: 6579 732e 6170 7065 6e64 286b 6579 290d  eys.append(key).
-00010830: 0a0d 0a20 2020 2064 6566 206c 6f61 645f  ...    def load_
-00010840: 7374 6174 655f 6469 6374 2873 656c 662c  state_dict(self,
-00010850: 2073 7461 7465 5f64 6963 742c 2073 7472   state_dict, str
-00010860: 6963 743d 5472 7565 293a 0d0a 2020 2020  ict=True):..    
-00010870: 2020 2020 7222 2222 436f 7069 6573 2070      r"""Copies p
-00010880: 6172 616d 6574 6572 7320 616e 6420 6275  arameters and bu
-00010890: 6666 6572 7320 6672 6f6d 203a 6174 7472  ffers from :attr
-000108a0: 3a60 7374 6174 655f 6469 6374 6020 696e  :`state_dict` in
-000108b0: 746f 0d0a 2020 2020 2020 2020 7468 6973  to..        this
-000108c0: 206d 6f64 756c 6520 616e 6420 6974 7320   module and its 
-000108d0: 6465 7363 656e 6461 6e74 732e 2049 6620  descendants. If 
-000108e0: 3a61 7474 723a 6073 7472 6963 7460 2069  :attr:`strict` i
-000108f0: 7320 6060 5472 7565 6060 2c20 7468 656e  s ``True``, then
-00010900: 0d0a 2020 2020 2020 2020 7468 6520 6b65  ..        the ke
-00010910: 7973 206f 6620 3a61 7474 723a 6073 7461  ys of :attr:`sta
-00010920: 7465 5f64 6963 7460 206d 7573 7420 6578  te_dict` must ex
-00010930: 6163 746c 7920 6d61 7463 6820 7468 6520  actly match the 
-00010940: 6b65 7973 2072 6574 7572 6e65 640d 0a20  keys returned.. 
-00010950: 2020 2020 2020 2062 7920 7468 6973 206d         by this m
-00010960: 6f64 756c 6527 7320 3a6d 6574 683a 607e  odule's :meth:`~
-00010970: 7465 6e73 6f72 666c 6f77 2e6e 6e2e 4d6f  tensorflow.nn.Mo
-00010980: 6475 6c65 2e73 7461 7465 5f64 6963 7460  dule.state_dict`
-00010990: 2066 756e 6374 696f 6e2e 0d0a 2020 2020   function...    
-000109a0: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-000109b0: 2020 2020 2020 2073 7461 7465 5f64 6963         state_dic
-000109c0: 7420 2864 6963 7429 3a20 6120 6469 6374  t (dict): a dict
-000109d0: 2063 6f6e 7461 696e 696e 6720 7061 7261   containing para
-000109e0: 6d65 7465 7273 2061 6e64 0d0a 2020 2020  meters and..    
-000109f0: 2020 2020 2020 2020 2020 2020 7065 7273              pers
-00010a00: 6973 7465 6e74 2062 7566 6665 7273 2e0d  istent buffers..
-00010a10: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-00010a20: 6963 7420 2862 6f6f 6c2c 206f 7074 696f  ict (bool, optio
-00010a30: 6e61 6c29 3a20 7768 6574 6865 7220 746f  nal): whether to
-00010a40: 2073 7472 6963 746c 7920 656e 666f 7263   strictly enforc
-00010a50: 6520 7468 6174 2074 6865 206b 6579 730d  e that the keys.
-00010a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010a70: 2069 6e20 3a61 7474 723a 6073 7461 7465   in :attr:`state
-00010a80: 5f64 6963 7460 206d 6174 6368 2074 6865  _dict` match the
-00010a90: 206b 6579 7320 7265 7475 726e 6564 2062   keys returned b
-00010aa0: 7920 7468 6973 206d 6f64 756c 6527 730d  y this module's.
-00010ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ac0: 203a 6d65 7468 3a60 7e74 656e 736f 7266   :meth:`~tensorf
-00010ad0: 6c6f 772e 6e6e 2e4d 6f64 756c 652e 7374  low.nn.Module.st
-00010ae0: 6174 655f 6469 6374 6020 6675 6e63 7469  ate_dict` functi
-00010af0: 6f6e 2e20 4465 6661 756c 743a 2060 6054  on. Default: ``T
-00010b00: 7275 6560 600d 0a20 2020 2020 2020 2052  rue``..        R
-00010b10: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-00010b20: 2020 2020 2060 604e 616d 6564 5475 706c       ``NamedTupl
-00010b30: 6560 6020 7769 7468 2060 606d 6973 7369  e`` with ``missi
-00010b40: 6e67 5f6b 6579 7360 6020 616e 6420 6060  ng_keys`` and ``
-00010b50: 756e 6578 7065 6374 6564 5f6b 6579 7360  unexpected_keys`
-00010b60: 6020 6669 656c 6473 3a0d 0a20 2020 2020  ` fields:..     
-00010b70: 2020 2020 2020 2020 2020 202a 202a 2a6d             * **m
-00010b80: 6973 7369 6e67 5f6b 6579 732a 2a20 6973  issing_keys** is
-00010b90: 2061 206c 6973 7420 6f66 2073 7472 2063   a list of str c
-00010ba0: 6f6e 7461 696e 696e 6720 7468 6520 6d69  ontaining the mi
-00010bb0: 7373 696e 6720 6b65 7973 0d0a 2020 2020  ssing keys..    
-00010bc0: 2020 2020 2020 2020 2020 2020 2a20 2a2a              * **
-00010bd0: 756e 6578 7065 6374 6564 5f6b 6579 732a  unexpected_keys*
-00010be0: 2a20 6973 2061 206c 6973 7420 6f66 2073  * is a list of s
-00010bf0: 7472 2063 6f6e 7461 696e 696e 6720 7468  tr containing th
-00010c00: 6520 756e 6578 7065 6374 6564 206b 6579  e unexpected key
-00010c10: 730d 0a20 2020 2020 2020 2022 2222 0d0a  s..        """..
-00010c20: 2020 2020 2020 2020 7769 7468 2074 662e          with tf.
-00010c30: 6465 7669 6365 2873 656c 662e 6765 745f  device(self.get_
-00010c40: 726f 6f74 2829 2e64 6576 6963 6529 3a0d  root().device):.
-00010c50: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
-00010c60: 7369 6e67 5f6b 6579 7320 3d20 5b5d 0d0a  sing_keys = []..
-00010c70: 2020 2020 2020 2020 2020 2020 756e 6578              unex
-00010c80: 7065 6374 6564 5f6b 6579 7320 3d20 5b5d  pected_keys = []
-00010c90: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
-00010ca0: 726f 725f 6d73 6773 203d 205b 5d0d 0a0d  ror_msgs = []...
-00010cb0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-00010cc0: 6f70 7920 7374 6174 655f 6469 6374 2073  opy state_dict s
-00010cd0: 6f20 5f6c 6f61 645f 6672 6f6d 5f73 7461  o _load_from_sta
-00010ce0: 7465 5f64 6963 7420 6361 6e20 6d6f 6469  te_dict can modi
-00010cf0: 6679 2069 740d 0a20 2020 2020 2020 2020  fy it..         
-00010d00: 2020 206d 6574 6164 6174 6120 3d20 6765     metadata = ge
-00010d10: 7461 7474 7228 7374 6174 655f 6469 6374  tattr(state_dict
-00010d20: 2c20 275f 6d65 7461 6461 7461 272c 204e  , '_metadata', N
-00010d30: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-00010d40: 2020 7374 6174 655f 6469 6374 203d 2073    state_dict = s
-00010d50: 7461 7465 5f64 6963 742e 636f 7079 2829  tate_dict.copy()
-00010d60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00010d70: 206d 6574 6164 6174 6120 6973 206e 6f74   metadata is not
-00010d80: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00010d90: 2020 2020 2020 2020 7374 6174 655f 6469          state_di
-00010da0: 6374 2e5f 6d65 7461 6461 7461 203d 206d  ct._metadata = m
-00010db0: 6574 6164 6174 610d 0a0d 0a20 2020 2020  etadata....     
-00010dc0: 2020 2020 2020 2064 6566 206c 6f61 6428         def load(
-00010dd0: 6d6f 6475 6c65 2c20 7072 6566 6978 3d27  module, prefix='
-00010de0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00010df0: 2020 2020 206c 6f63 616c 5f6d 6574 6164       local_metad
-00010e00: 6174 6120 3d20 7b7d 2069 6620 6d65 7461  ata = {} if meta
-00010e10: 6461 7461 2069 7320 4e6f 6e65 2065 6c73  data is None els
-00010e20: 6520 6d65 7461 6461 7461 2e67 6574 2870  e metadata.get(p
-00010e30: 7265 6669 785b 3a2d 315d 2c20 7b7d 290d  refix[:-1], {}).
-00010e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010e50: 206d 6f64 756c 652e 5f6c 6f61 645f 6672   module._load_fr
-00010e60: 6f6d 5f73 7461 7465 5f64 6963 7428 7374  om_state_dict(st
-00010e70: 6174 655f 6469 6374 2c20 7072 6566 6978  ate_dict, prefix
-00010e80: 2c20 6c6f 6361 6c5f 6d65 7461 6461 7461  , local_metadata
-00010e90: 2c20 5472 7565 2c20 6d69 7373 696e 675f  , True, missing_
-00010ea0: 6b65 7973 2c20 756e 6578 7065 6374 6564  keys, unexpected
-00010eb0: 5f6b 6579 732c 0d0a 2020 2020 2020 2020  _keys,..        
-00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db30: 206e 616d 653d 696e 7370 6563 745f 6172   name=inspect_ar
+0000db40: 6773 290d 0a0d 0a20 2020 2020 2020 2020  gs)....         
+0000db50: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0000db60: 7374 616e 6365 2873 656c 662e 5f69 6e70  stance(self._inp
+0000db70: 7574 5f73 6861 7065 2c20 7475 706c 6529  ut_shape, tuple)
+0000db80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000db90: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0000dba0: 7261 6e67 6528 6c65 6e28 7365 6c66 2e5f  range(len(self._
+0000dbb0: 696e 7075 745f 7368 6170 6529 293a 0d0a  input_shape)):..
+0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbd0: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
+0000dbe0: 676e 6174 7572 652e 696e 7075 7473 5b22  gnature.inputs["
+0000dbf0: 696e 7075 745f 7b30 7d22 2e66 6f72 6d61  input_{0}".forma
+0000dc00: 7428 6929 5d20 3d20 5465 6e73 6f72 5370  t(i)] = TensorSp
+0000dc10: 6563 280d 0a20 2020 2020 2020 2020 2020  ec(..           
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 2073 6861 7065 3d54 656e 736f 7253 6861   shape=TensorSha
+0000dc40: 7065 2873 656c 662e 5f69 6e70 7574 5f73  pe(self._input_s
+0000dc50: 6861 7065 5b69 5d29 2c20 6e61 6d65 3d22  hape[i]), name="
+0000dc60: 696e 7075 745f 7b30 7d22 2e66 6f72 6d61  input_{0}".forma
+0000dc70: 7428 6929 290d 0a20 2020 2020 2020 2020  t(i))..         
+0000dc80: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000dc90: 2020 2020 2020 2020 2020 666f 7220 6172            for ar
+0000dca0: 6720 696e 2069 6e73 7065 6374 5f61 7267  g in inspect_arg
+0000dcb0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0000dcc0: 2020 2020 2020 2020 7365 6c66 2e5f 7369          self._si
+0000dcd0: 676e 6174 7572 652e 696e 7075 7473 5b61  gnature.inputs[a
+0000dce0: 7267 5d20 3d20 5465 6e73 6f72 5370 6563  rg] = TensorSpec
+0000dcf0: 2873 6861 7065 3d4e 6f6e 6529 0d0a 0d0a  (shape=None)....
+0000dd00: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000dd10: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
+0000dd20: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+0000dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd40: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+0000dd50: 6c66 2e5f 6f75 7470 7574 5f73 6861 7065  lf._output_shape
+0000dd60: 2c20 5465 6e73 6f72 5368 6170 6529 3a0d  , TensorShape):.
+0000dd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd80: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
+0000dd90: 7475 7265 2e6f 7574 7075 7473 5b22 6f75  ture.outputs["ou
+0000dda0: 7470 7574 225d 203d 2054 656e 736f 7253  tput"] = TensorS
+0000ddb0: 7065 6328 7368 6170 653d 5465 6e73 6f72  pec(shape=Tensor
+0000ddc0: 5368 6170 6528 7365 6c66 2e5f 6f75 7470  Shape(self._outp
+0000ddd0: 7574 5f73 6861 7065 292c 206e 616d 653d  ut_shape), name=
+0000dde0: 226f 7574 7075 7422 290d 0a20 2020 2020  "output")..     
+0000ddf0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000de00: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0000de10: 5f6f 7574 7075 745f 7368 6170 652c 2074  _output_shape, t
+0000de20: 7570 6c65 293a 0d0a 2020 2020 2020 2020  uple):..        
+0000de30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000de40: 6920 696e 2072 616e 6765 286c 656e 2873  i in range(len(s
+0000de50: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
+0000de60: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
+0000de70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000de80: 6c66 2e5f 7369 676e 6174 7572 652e 6f75  lf._signature.ou
+0000de90: 7470 7574 735b 226f 7574 7075 745f 7b30  tputs["output_{0
+0000dea0: 7d22 2e66 6f72 6d61 7428 6929 5d20 3d20  }".format(i)] = 
+0000deb0: 5465 6e73 6f72 5370 6563 280d 0a20 2020  TensorSpec(..   
+0000dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ded0: 2020 2020 2020 2020 2073 6861 7065 3d74           shape=t
+0000dee0: 6f5f 7465 6e73 6f72 2873 656c 662e 5f6f  o_tensor(self._o
+0000def0: 7574 7075 745f 7368 6170 655b 695d 292c  utput_shape[i]),
+0000df00: 206e 616d 653d 226f 7574 7075 745f 7b30   name="output_{0
+0000df10: 7d22 2e66 6f72 6d61 7428 6929 290d 0a20  }".format(i)).. 
+0000df20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000df30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000df40: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
+0000df50: 652e 6f75 7470 7574 735b 226f 7574 7075  e.outputs["outpu
+0000df60: 7422 5d20 3d20 5465 6e73 6f72 5370 6563  t"] = TensorSpec
+0000df70: 2873 6861 7065 3d4e 6f6e 6529 0d0a 2020  (shape=None)..  
+0000df80: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000df90: 6e63 6528 696e 7370 6563 745f 6172 6773  nce(inspect_args
+0000dfa0: 2c20 7374 7229 2061 6e64 206c 656e 2873  , str) and len(s
+0000dfb0: 656c 662e 5f73 6967 6e61 7475 7265 2e69  elf._signature.i
+0000dfc0: 6e70 7574 7329 203d 3d20 3120 616e 6420  nputs) == 1 and 
+0000dfd0: 7365 6c66 2e5f 7369 676e 6174 7572 652e  self._signature.
+0000dfe0: 696e 7075 7473 2e6b 6579 5f6c 6973 745b  inputs.key_list[
+0000dff0: 305d 2021 3d20 696e 7370 6563 745f 6172  0] != inspect_ar
+0000e000: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
+0000e010: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
+0000e020: 2e69 6e70 7574 735b 696e 7370 6563 745f  .inputs[inspect_
+0000e030: 6172 6773 5d20 3d20 7365 6c66 2e5f 7369  args] = self._si
+0000e040: 676e 6174 7572 652e 696e 7075 7473 2e76  gnature.inputs.v
+0000e050: 616c 7565 5f6c 6973 745b 305d 0d0a 2020  alue_list[0]..  
+0000e060: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000e070: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
+0000e080: 2e70 6f70 2873 656c 662e 5f73 6967 6e61  .pop(self._signa
+0000e090: 7475 7265 2e69 6e70 7574 732e 6b65 795f  ture.inputs.key_
+0000e0a0: 6c69 7374 5b30 5d29 0d0a 2020 2020 2020  list[0])..      
+0000e0b0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0000e0c0: 6528 696e 7370 6563 745f 6172 6773 2c20  e(inspect_args, 
+0000e0d0: 6c69 7374 2920 616e 6420 6c65 6e28 7365  list) and len(se
+0000e0e0: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
+0000e0f0: 7075 7473 2920 3d3d 206c 656e 2869 6e73  puts) == len(ins
+0000e100: 7065 6374 5f61 7267 7329 3a0d 0a20 2020  pect_args):..   
+0000e110: 2020 2020 2020 2020 2066 6f72 206b 312c           for k1,
+0000e120: 206b 3220 696e 207a 6970 2869 6e73 7065   k2 in zip(inspe
+0000e130: 6374 5f61 7267 732c 2073 656c 662e 5f73  ct_args, self._s
+0000e140: 6967 6e61 7475 7265 2e69 6e70 7574 732e  ignature.inputs.
+0000e150: 6b65 795f 6c69 7374 2e63 6f70 7928 2929  key_list.copy())
+0000e160: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e170: 2020 2069 6620 6b31 2021 3d20 6b32 3a0d     if k1 != k2:.
+0000e180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e190: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
+0000e1a0: 7475 7265 2e69 6e70 7574 735b 6b31 5d20  ture.inputs[k1] 
+0000e1b0: 3d20 7365 6c66 2e5f 7369 676e 6174 7572  = self._signatur
+0000e1c0: 652e 696e 7075 7473 5b6b 325d 0d0a 2020  e.inputs[k2]..  
+0000e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1e0: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
+0000e1f0: 652e 696e 7075 7473 2e70 6f70 286b 3229  e.inputs.pop(k2)
+0000e200: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000e210: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
+0000e220: 0d0a 0d0a 2020 2020 4073 6967 6e61 7475  ....    @signatu
+0000e230: 7265 2e73 6574 7465 720d 0a20 2020 2064  re.setter..    d
+0000e240: 6566 2073 6967 6e61 7475 7265 2873 656c  ef signature(sel
+0000e250: 662c 2076 616c 7565 293a 0d0a 2020 2020  f, value):..    
+0000e260: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
+0000e270: 7572 6520 3d20 7661 6c75 650d 0a0d 0a20  ure = value.... 
+0000e280: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0000e290: 2020 6465 6620 6f75 7470 7574 2873 656c    def output(sel
+0000e2a0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+0000e2b0: 5265 7472 6965 7665 7320 7468 6520 6f75  Retrieves the ou
+0000e2c0: 7470 7574 2074 656e 736f 7228 7329 206f  tput tensor(s) o
+0000e2d0: 6620 6120 6c61 7965 722e 0d0a 2020 2020  f a layer...    
+0000e2e0: 2020 2020 2020 2020 666f 7220 6d65 6d6f          for memo
+0000e2f0: 7279 2073 6176 696e 6720 6973 7375 652c  ry saving issue,
+0000e300: 2077 6520 646f 6e27 7462 2070 7265 6665   we don'tb prefe
+0000e310: 7220 746f 206b 6565 7020 6576 6572 7920  r to keep every 
+0000e320: 696e 7075 742f 6f75 7470 7574 0d0a 2020  input/output..  
+0000e330: 2020 2020 2020 2020 2020 7465 6e73 6f72            tensor
+0000e340: 2069 6e20 6576 6572 7920 6c61 7965 722e   in every layer.
+0000e350: 596f 7520 7368 6f75 6c64 2073 6574 2073  You should set s
+0000e360: 656c 662e 6b65 6570 5f6f 7574 7075 7420  elf.keep_output 
+0000e370: 666c 6167 2074 6f20 5472 7565 2c20 616e  flag to True, an
+0000e380: 6420 7468 656e 0d0a 2020 2020 2020 2020  d then..        
+0000e390: 2020 2020 7265 7472 6976 6520 7468 6520      retrive the 
+0000e3a0: 6f75 7470 7574 2074 656e 736f 7220 7768  output tensor wh
+0000e3b0: 656e 2074 6865 2063 616c 6c6c 2829 2069  en the calll() i
+0000e3c0: 7320 6578 6563 7574 696e 672e 0d0a 2020  s executing...  
+0000e3d0: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+0000e3e0: 2020 2020 2020 2020 2020 2020 2020 204f                 O
+0000e3f0: 7574 7075 7420 7465 6e73 6f72 206f 7220  utput tensor or 
+0000e400: 6c69 7374 206f 6620 6f75 7470 7574 2074  list of output t
+0000e410: 656e 736f 7273 2e0d 0a20 2020 2020 5261  ensors...     Ra
+0000e420: 6973 6573 0d0a 2020 2020 2020 2020 2020  ises..          
+0000e430: 2020 2020 2020 4174 7472 6962 7574 6545        AttributeE
+0000e440: 7272 6f72 3a20 6966 2074 6865 206c 6179  rror: if the lay
+0000e450: 6572 2069 7320 636f 6e6e 6563 7465 6420  er is connected 
+0000e460: 746f 0d0a 2020 2020 2020 2020 2020 2020  to..            
+0000e470: 2020 2020 6d6f 7265 2074 6861 6e20 6f6e      more than on
+0000e480: 6520 696e 636f 6d69 6e67 206c 6179 6572  e incoming layer
+0000e490: 732e 0d0a 2020 2020 2020 2020 2222 220d  s...        """.
+0000e4a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000e4b0: 2e6b 6565 705f 6f75 7470 7574 203d 3d20  .keep_output == 
+0000e4c0: 4661 6c73 653a 0d0a 2020 2020 2020 2020  False:..        
+0000e4d0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000e4e0: 7272 6f72 2827 4c61 7965 7220 7b30 7d20  rror('Layer {0} 
+0000e4f0: 6861 7320 6e6f 7420 7365 7420 7365 6c66  has not set self
+0000e500: 2e6b 6565 705f 6f75 7470 7574 2020 746f  .keep_output  to
+0000e510: 2054 7275 652c 2063 616e 6e6f 7420 6163   True, cannot ac
+0000e520: 6365 7373 206f 7574 7075 7420 272e 666f  cess output '.fo
+0000e530: 726d 6174 2873 656c 662e 6e61 6d65 2929  rmat(self.name))
+0000e540: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000e550: 206c 6973 7428 7365 6c66 2e5f 6f75 7470   list(self._outp
+0000e560: 7574 5f74 656e 736f 7229 2069 6620 6973  ut_tensor) if is
+0000e570: 696e 7374 616e 6365 2873 656c 662e 5f6f  instance(self._o
+0000e580: 7574 7075 745f 7465 6e73 6f72 2c20 7475  utput_tensor, tu
+0000e590: 706c 6529 2065 6c73 6520 7365 6c66 2e5f  ple) else self._
+0000e5a0: 6f75 7470 7574 5f74 656e 736f 720d 0a0d  output_tensor...
+0000e5b0: 0a20 2020 2064 6566 2072 6573 6574 5f70  .    def reset_p
+0000e5c0: 6172 616d 6574 6572 7328 7365 6c66 293a  arameters(self):
+0000e5d0: 0d0a 2020 2020 2020 2020 7061 7373 0d0a  ..        pass..
+0000e5e0: 0d0a 2020 2020 6465 6620 636f 7079 2873  ..    def copy(s
+0000e5f0: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+0000e600: 2222 4372 6561 7465 2061 206e 6577 2046  ""Create a new F
+0000e610: 726f 7a65 6e44 6963 7420 7769 7468 2061  rozenDict with a
+0000e620: 6464 6974 696f 6e61 6c20 6f72 2072 6570  dditional or rep
+0000e630: 6c61 6365 6420 656e 7472 6965 732e 2222  laced entries.""
+0000e640: 220d 0a20 2020 2020 2020 2073 6967 203d  "..        sig =
+0000e650: 2067 6574 5f73 6967 6e61 7475 7265 2874   get_signature(t
+0000e660: 7970 6528 7365 6c66 292e 5f5f 696e 6974  ype(self).__init
+0000e670: 5f5f 290d 0a20 2020 2020 2020 205f 6172  __)..        _ar
+0000e680: 6773 203d 204f 7264 6572 6564 4469 6374  gs = OrderedDict
+0000e690: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
+0000e6a0: 696e 7020 696e 2073 6967 2e69 6e70 7574  inp in sig.input
+0000e6b0: 732e 6b65 795f 6c69 7374 3a0d 0a20 2020  s.key_list:..   
+0000e6c0: 2020 2020 2020 2020 2069 6620 696e 7020           if inp 
+0000e6d0: 696e 2073 656c 662e 5f5f 6469 6374 5f5f  in self.__dict__
+0000e6e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e6f0: 2020 205f 6172 6773 5b69 6e70 5d20 3d20     _args[inp] = 
+0000e700: 7365 6c66 2e5f 5f64 6963 745f 5f5b 696e  self.__dict__[in
+0000e710: 705d 0d0a 2020 2020 2020 2020 7368 6164  p]..        shad
+0000e720: 6f77 203d 2074 7970 6528 7365 6c66 2928  ow = type(self)(
+0000e730: 2a2a 5f61 7267 7329 0d0a 2020 2020 2020  **_args)..      
+0000e740: 2020 7368 6164 6f77 2e62 7569 6c64 2873    shadow.build(s
+0000e750: 656c 662e 696e 7075 745f 7368 6170 6529  elf.input_shape)
+0000e760: 0d0a 2020 2020 2020 2020 666f 7220 6b2c  ..        for k,
+0000e770: 2076 2069 6e20 7365 6c66 2e5f 5f64 6963   v in self.__dic
+0000e780: 745f 5f2e 6974 656d 7328 293a 0d0a 2020  t__.items():..  
+0000e790: 2020 2020 2020 2020 2020 6966 206b 206e            if k n
+0000e7a0: 6f74 2069 6e20 5f61 7267 7320 616e 6420  ot in _args and 
+0000e7b0: 6b20 6e6f 7420 696e 205b 275f 6d6f 6475  k not in ['_modu
+0000e7c0: 6c65 7327 2c20 275f 7061 7261 6d65 7465  les', '_paramete
+0000e7d0: 7273 272c 2027 5f62 7566 6665 7273 275d  rs', '_buffers']
+0000e7e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e7f0: 2020 2069 6620 6973 5f74 656e 736f 7228     if is_tensor(
+0000e800: 7629 3a0d 0a20 2020 2020 2020 2020 2020  v):..           
+0000e810: 2020 2020 2020 2020 2073 6861 646f 772e           shadow.
+0000e820: 5f5f 6469 6374 5f5f 5b6b 5d20 3d20 746f  __dict__[k] = to
+0000e830: 5f74 656e 736f 7228 746f 5f6e 756d 7079  _tensor(to_numpy
+0000e840: 2876 292c 2064 7479 7065 3d76 2e64 7479  (v), dtype=v.dty
+0000e850: 7065 2c20 6465 7669 6365 3d76 2e64 6576  pe, device=v.dev
+0000e860: 6963 652c 0d0a 2020 2020 2020 2020 2020  ice,..          
+0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e890: 2020 2020 2020 2020 2072 6571 7569 7265           require
+0000e8a0: 735f 6772 6164 3d76 2e72 6571 7569 7265  s_grad=v.require
+0000e8b0: 735f 6772 6164 290d 0a20 2020 2020 2020  s_grad)..       
+0000e8c0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+0000e8d0: 696e 7374 616e 6365 2876 2c20 2873 7472  instance(v, (str
+0000e8e0: 2c20 626f 6f6c 2c20 6e75 6d62 6572 732e  , bool, numbers.
+0000e8f0: 4e75 6d62 6572 2929 206f 7220 6b20 696e  Number)) or k in
+0000e900: 205b 275f 6e6f 6465 7327 5d3a 0d0a 2020   ['_nodes']:..  
+0000e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e920: 2020 7365 7461 7474 7228 7368 6164 6f77    setattr(shadow
+0000e930: 2c20 6b2c 2076 290d 0a20 2020 2020 2020  , k, v)..       
+0000e940: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e960: 2020 2020 7365 7461 7474 7228 7368 6164      setattr(shad
+0000e970: 6f77 2c20 6b2c 2064 6565 7063 6f70 7928  ow, k, deepcopy(
+0000e980: 7629 290d 0a20 2020 2020 2020 2073 6861  v))..        sha
+0000e990: 646f 772e 6c6f 6164 5f73 7461 7465 5f64  dow.load_state_d
+0000e9a0: 6963 7428 7365 6c66 2e73 7461 7465 5f64  ict(self.state_d
+0000e9b0: 6963 7428 2929 0d0a 2020 2020 2020 2020  ict())..        
+0000e9c0: 7368 6164 6f77 2e74 6f28 7365 6c66 2e64  shadow.to(self.d
+0000e9d0: 6576 6963 6529 0d0a 2020 2020 2020 2020  evice)..        
+0000e9e0: 7265 7475 726e 2073 6861 646f 770d 0a0d  return shadow...
+0000e9f0: 0a20 2020 2020 2020 2023 2054 6865 2075  .        # The u
+0000ea00: 7365 7220 6361 6e20 7061 7373 2061 6e20  ser can pass an 
+0000ea10: 6f70 7469 6f6e 616c 2061 7262 6974 7261  optional arbitra
+0000ea20: 7279 206d 6170 7061 626c 6520 6f62 6a65  ry mappable obje
+0000ea30: 6374 2074 6f20 6073 7461 7465 5f64 6963  ct to `state_dic
+0000ea40: 7460 2c20 696e 2077 6869 6368 2063 6173  t`, in which cas
+0000ea50: 6520 6073 7461 7465 5f64 6963 7460 2072  e `state_dict` r
+0000ea60: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+0000ea70: 2320 6261 636b 2074 6861 7420 7361 6d65  # back that same
+0000ea80: 206f 626a 6563 742e 2042 7574 2069 6620   object. But if 
+0000ea90: 7468 6579 2070 6173 7320 6e6f 7468 696e  they pass nothin
+0000eaa0: 672c 2061 6e20 604f 7265 6465 7265 6444  g, an `OrederedD
+0000eab0: 6963 7460 2069 7320 6372 6561 7465 6420  ict` is created 
+0000eac0: 616e 6420 7265 7475 726e 6564 2e0d 0a0d  and returned....
+0000ead0: 0a0d 0a0d 0a20 2020 2064 6566 205f 7361  .....    def _sa
+0000eae0: 7665 5f74 6f5f 7374 6174 655f 6469 6374  ve_to_state_dict
+0000eaf0: 2873 656c 662c 2064 6573 7469 6e61 7469  (self, destinati
+0000eb00: 6f6e 2c20 7072 6566 6978 2c20 6b65 6570  on, prefix, keep
+0000eb10: 5f76 6172 7329 3a0d 0a20 2020 2020 2020  _vars):..       
+0000eb20: 2072 2222 2253 6176 6573 206d 6f64 756c   r"""Saves modul
+0000eb30: 6520 7374 6174 6520 746f 2060 6465 7374  e state to `dest
+0000eb40: 696e 6174 696f 6e60 2064 6963 7469 6f6e  ination` diction
+0000eb50: 6172 792c 2063 6f6e 7461 696e 696e 6720  ary, containing 
+0000eb60: 6120 7374 6174 650d 0a20 2020 2020 2020  a state..       
+0000eb70: 206f 6620 7468 6520 6d6f 6475 6c65 2c20   of the module, 
+0000eb80: 6275 7420 6e6f 7420 6974 7320 6465 7363  but not its desc
+0000eb90: 656e 6461 6e74 732e 2054 6869 7320 6973  endants. This is
+0000eba0: 2063 616c 6c65 6420 6f6e 2065 7665 7279   called on every
+0000ebb0: 0d0a 2020 2020 2020 2020 7375 626d 6f64  ..        submod
+0000ebc0: 756c 6520 696e 203a 6d65 7468 3a60 4c61  ule in :meth:`La
+0000ebd0: 7965 722e 7374 6174 655f 6469 6374 602e  yer.state_dict`.
+0000ebe0: 0d0a 2020 2020 2020 2020 496e 2072 6172  ..        In rar
+0000ebf0: 6520 6361 7365 732c 2073 7562 636c 6173  e cases, subclas
+0000ec00: 7365 7320 6361 6e20 6163 6869 6576 6520  ses can achieve 
+0000ec10: 636c 6173 732d 7370 6563 6966 6963 2062  class-specific b
+0000ec20: 6568 6176 696f 7220 6279 0d0a 2020 2020  ehavior by..    
+0000ec30: 2020 2020 6f76 6572 7269 6469 6e67 2074      overriding t
+0000ec40: 6869 7320 6d65 7468 6f64 2077 6974 6820  his method with 
+0000ec50: 6375 7374 6f6d 206c 6f67 6963 2e0d 0a20  custom logic... 
+0000ec60: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
+0000ec70: 2020 2020 2020 2020 2020 6465 7374 696e            destin
+0000ec80: 6174 696f 6e20 2864 6963 7429 3a20 6120  ation (dict): a 
+0000ec90: 6469 6374 2077 6865 7265 2073 7461 7465  dict where state
+0000eca0: 2077 696c 6c20 6265 2073 746f 7265 640d   will be stored.
+0000ecb0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+0000ecc0: 6669 7820 2873 7472 293a 2074 6865 2070  fix (str): the p
+0000ecd0: 7265 6669 7820 666f 7220 7061 7261 6d65  refix for parame
+0000ece0: 7465 7273 2061 6e64 2062 7566 6665 7273  ters and buffers
+0000ecf0: 2075 7365 6420 696e 2074 6869 730d 0a20   used in this.. 
+0000ed00: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000ed10: 6f64 756c 650d 0a20 2020 2020 2020 2022  odule..        "
+0000ed20: 2222 0d0a 2020 2020 2020 2020 666f 7220  ""..        for 
+0000ed30: 6e61 6d65 2c20 7061 7261 6d20 696e 2073  name, param in s
+0000ed40: 656c 662e 5f70 6172 616d 6574 6572 732e  elf._parameters.
+0000ed50: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
+0000ed60: 2020 2020 2020 6966 2070 6172 616d 2069        if param i
+0000ed70: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0000ed80: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0000ed90: 7469 6e61 7469 6f6e 5b70 7265 6669 7820  tination[prefix 
+0000eda0: 2b20 6e61 6d65 5d20 3d20 7061 7261 6d20  + name] = param 
+0000edb0: 6966 206b 6565 705f 7661 7273 2065 6c73  if keep_vars els
+0000edc0: 6520 7061 7261 6d2e 7661 6c75 6528 292e  e param.value().
+0000edd0: 6465 7461 6368 2829 0d0a 2020 2020 2020  detach()..      
+0000ede0: 2020 666f 7220 6e61 6d65 2c20 6275 6620    for name, buf 
+0000edf0: 696e 2073 656c 662e 5f62 7566 6665 7273  in self._buffers
+0000ee00: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
+0000ee10: 2020 2020 2020 2069 6620 6275 6620 6973         if buf is
+0000ee20: 206e 6f74 204e 6f6e 6520 616e 6420 6e61   not None and na
+0000ee30: 6d65 206e 6f74 2069 6e20 7365 6c66 2e5f  me not in self._
+0000ee40: 6e6f 6e5f 7065 7273 6973 7465 6e74 5f62  non_persistent_b
+0000ee50: 7566 6665 7273 5f73 6574 3a0d 0a20 2020  uffers_set:..   
+0000ee60: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0000ee70: 7469 6e61 7469 6f6e 5b70 7265 6669 7820  tination[prefix 
+0000ee80: 2b20 6e61 6d65 5d20 3d20 6275 6620 6966  + name] = buf if
+0000ee90: 206b 6565 705f 7661 7273 2065 6c73 6520   keep_vars else 
+0000eea0: 6275 662e 636f 7079 2829 2e64 6574 6163  buf.copy().detac
+0000eeb0: 6828 290d 0a0d 0a20 2020 2054 5f64 6573  h()....    T_des
+0000eec0: 7469 6e61 7469 6f6e 203d 2054 7970 6556  tination = TypeV
+0000eed0: 6172 2827 545f 6465 7374 696e 6174 696f  ar('T_destinatio
+0000eee0: 6e27 2c20 626f 756e 643d 4469 6374 5b73  n', bound=Dict[s
+0000eef0: 7472 2c20 416e 795d 290d 0a20 2020 2040  tr, Any])..    @
+0000ef00: 6f76 6572 6c6f 6164 0d0a 2020 2020 6465  overload..    de
+0000ef10: 6620 7374 6174 655f 6469 6374 2873 656c  f state_dict(sel
+0000ef20: 662c 2020 6465 7374 696e 6174 696f 6e3a  f,  destination:
+0000ef30: 2054 5f64 6573 7469 6e61 7469 6f6e 2c20   T_destination, 
+0000ef40: 7072 6566 6978 3a20 7374 7220 3d20 2e2e  prefix: str = ..
+0000ef50: 2e2c 206b 6565 705f 7661 7273 3a20 626f  ., keep_vars: bo
+0000ef60: 6f6c 203d 202e 2e2e 2920 2d3e 2054 5f64  ol = ...) -> T_d
+0000ef70: 6573 7469 6e61 7469 6f6e 3a0d 0a20 2020  estination:..   
+0000ef80: 2020 2020 202e 2e2e 0d0a 0d0a 2020 2020       .......    
+0000ef90: 2320 544f 444f 3a20 616e 6e6f 7461 7465  # TODO: annotate
+0000efa0: 2077 6974 6820 4f72 6465 7265 6444 6963   with OrderedDic
+0000efb0: 7420 6e6f 7420 4469 6374 2c20 6275 7420  t not Dict, but 
+0000efc0: 7468 6572 6520 6973 2061 2070 726f 626c  there is a probl
+0000efd0: 656d 3a0d 0a20 2020 2023 2068 7474 7073  em:..    # https
+0000efe0: 3a2f 2f64 6f63 732e 7079 7468 6f6e 2e6f  ://docs.python.o
+0000eff0: 7267 2f33 2f6c 6962 7261 7279 2f74 7970  rg/3/library/typ
+0000f000: 696e 672e 6874 6d6c 2374 7970 696e 672e  ing.html#typing.
+0000f010: 4f72 6465 7265 6444 6963 740d 0a20 2020  OrderedDict..   
+0000f020: 2040 6f76 6572 6c6f 6164 0d0a 2020 2020   @overload..    
+0000f030: 6465 6620 7374 6174 655f 6469 6374 2873  def state_dict(s
+0000f040: 656c 662c 2020 2a2c 2070 7265 6669 783a  elf,  *, prefix:
+0000f050: 2073 7472 203d 202e 2e2e 2c20 6b65 6570   str = ..., keep
+0000f060: 5f76 6172 733a 2062 6f6f 6c20 3d20 2e2e  _vars: bool = ..
+0000f070: 2e29 202d 3e20 4469 6374 5b73 7472 2c20  .) -> Dict[str, 
+0000f080: 416e 795d 3a0d 0a20 2020 2020 2020 202e  Any]:..        .
+0000f090: 2e2e 0d0a 0d0a 2020 2020 6465 6620 7374  ......    def st
+0000f0a0: 6174 655f 6469 6374 2873 656c 662c 2020  ate_dict(self,  
+0000f0b0: 6465 7374 696e 6174 696f 6e3d 4e6f 6e65  destination=None
+0000f0c0: 2c20 7072 6566 6978 3d27 272c 206b 6565  , prefix='', kee
+0000f0d0: 705f 7661 7273 3d46 616c 7365 293a 0d0a  p_vars=False):..
+0000f0e0: 2020 2020 2020 2020 7222 2222 5265 7475          r"""Retu
+0000f0f0: 726e 7320 6120 6469 6374 696f 6e61 7279  rns a dictionary
+0000f100: 2063 6f6e 7461 696e 696e 6720 6120 7768   containing a wh
+0000f110: 6f6c 6520 7374 6174 6520 6f66 2074 6865  ole state of the
+0000f120: 206d 6f64 756c 652e 0d0a 0d0a 2020 2020   module.....    
+0000f130: 2020 2020 426f 7468 2070 6172 616d 6574      Both paramet
+0000f140: 6572 7320 616e 6420 7065 7273 6973 7465  ers and persiste
+0000f150: 6e74 2062 7566 6665 7273 2028 652e 672e  nt buffers (e.g.
+0000f160: 2072 756e 6e69 6e67 2061 7665 7261 6765   running average
+0000f170: 7329 2061 7265 0d0a 2020 2020 2020 2020  s) are..        
+0000f180: 696e 636c 7564 6564 2e20 4b65 7973 2061  included. Keys a
+0000f190: 7265 2063 6f72 7265 7370 6f6e 6469 6e67  re corresponding
+0000f1a0: 2070 6172 616d 6574 6572 2061 6e64 2062   parameter and b
+0000f1b0: 7566 6665 7220 6e61 6d65 732e 0d0a 0d0a  uffer names.....
+0000f1c0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+0000f1d0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0000f1e0: 6374 3a0d 0a20 2020 2020 2020 2020 2020  ct:..           
+0000f1f0: 2020 2020 2061 2064 6963 7469 6f6e 6172       a dictionar
+0000f200: 7920 636f 6e74 6169 6e69 6e67 2061 2077  y containing a w
+0000f210: 686f 6c65 2073 7461 7465 206f 6620 7468  hole state of th
+0000f220: 6520 6d6f 6475 6c65 0d0a 0d0a 2020 2020  e module....    
+0000f230: 2020 2020 4578 616d 706c 653a 3a0d 0a0d      Example::...
+0000f240: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+0000f250: 206d 6f64 756c 652e 7374 6174 655f 6469   module.state_di
+0000f260: 6374 2829 2e6b 6579 7328 290d 0a20 2020  ct().keys()..   
+0000f270: 2020 2020 2020 2020 205b 2762 6961 7327           ['bias'
+0000f280: 2c20 2777 6569 6768 7427 5d0d 0a0d 0a20  , 'weight'].... 
+0000f290: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0000f2a0: 2020 2020 7769 7468 2074 662e 6465 7669      with tf.devi
+0000f2b0: 6365 2873 656c 662e 6765 745f 726f 6f74  ce(self.get_root
+0000f2c0: 2829 2e64 6576 6963 6529 3a0d 0a20 2020  ().device):..   
+0000f2d0: 2020 2020 2020 2020 2069 6620 6465 7374           if dest
+0000f2e0: 696e 6174 696f 6e20 6973 204e 6f6e 653a  ination is None:
+0000f2f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f300: 2020 6465 7374 696e 6174 696f 6e20 3d20    destination = 
+0000f310: 4f72 6465 7265 6444 6963 7428 290d 0a20  OrderedDict().. 
+0000f320: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000f330: 6573 7469 6e61 7469 6f6e 2e5f 6d65 7461  estination._meta
+0000f340: 6461 7461 203d 204f 7264 6572 6564 4469  data = OrderedDi
+0000f350: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
+0000f360: 2020 6465 7374 696e 6174 696f 6e2e 5f6d    destination._m
+0000f370: 6574 6164 6174 615b 7072 6566 6978 5b3a  etadata[prefix[:
+0000f380: 2d31 5d5d 203d 206c 6f63 616c 5f6d 6574  -1]] = local_met
+0000f390: 6164 6174 6120 3d20 6469 6374 2876 6572  adata = dict(ver
+0000f3a0: 7369 6f6e 3d73 656c 662e 5f76 6572 7369  sion=self._versi
+0000f3b0: 6f6e 290d 0a0d 0a20 2020 2020 2020 2020  on)....         
+0000f3c0: 2020 2073 656c 662e 5f73 6176 655f 746f     self._save_to
+0000f3d0: 5f73 7461 7465 5f64 6963 7428 6465 7374  _state_dict(dest
+0000f3e0: 696e 6174 696f 6e2c 2070 7265 6669 782c  ination, prefix,
+0000f3f0: 206b 6565 705f 7661 7273 290d 0a20 2020   keep_vars)..   
+0000f400: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
+0000f410: 652c 206d 6f64 756c 6520 696e 2073 656c  e, module in sel
+0000f420: 662e 5f6d 6f64 756c 6573 2e69 7465 6d73  f._modules.items
+0000f430: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0000f440: 2020 2020 2069 6620 6d6f 6475 6c65 2069       if module i
+0000f450: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0000f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f470: 206d 6f64 756c 652e 7374 6174 655f 6469   module.state_di
+0000f480: 6374 2864 6573 7469 6e61 7469 6f6e 2c20  ct(destination, 
+0000f490: 7072 6566 6978 202b 206e 616d 6520 2b20  prefix + name + 
+0000f4a0: 272e 272c 206b 6565 705f 7661 7273 3d6b  '.', keep_vars=k
+0000f4b0: 6565 705f 7661 7273 290d 0a20 2020 2020  eep_vars)..     
+0000f4c0: 2020 2020 2020 2066 6f72 2068 6f6f 6b20         for hook 
+0000f4d0: 696e 2073 656c 662e 5f73 7461 7465 5f64  in self._state_d
+0000f4e0: 6963 745f 686f 6f6b 732e 7661 6c75 6573  ict_hooks.values
+0000f4f0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0000f500: 2020 2020 2068 6f6f 6b5f 7265 7375 6c74       hook_result
+0000f510: 203d 2068 6f6f 6b28 7365 6c66 2c20 6465   = hook(self, de
+0000f520: 7374 696e 6174 696f 6e2c 2070 7265 6669  stination, prefi
+0000f530: 782c 206c 6f63 616c 5f6d 6574 6164 6174  x, local_metadat
+0000f540: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
+0000f550: 2020 2020 6966 2068 6f6f 6b5f 7265 7375      if hook_resu
+0000f560: 6c74 2069 7320 6e6f 7420 4e6f 6e65 3a0d  lt is not None:.
+0000f570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f580: 2020 2020 2064 6573 7469 6e61 7469 6f6e       destination
+0000f590: 203d 2068 6f6f 6b5f 7265 7375 6c74 0d0a   = hook_result..
+0000f5a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000f5b0: 726e 2064 6573 7469 6e61 7469 6f6e 0d0a  rn destination..
+0000f5c0: 0d0a 2020 2020 6465 6620 5f72 6567 6973  ..    def _regis
+0000f5d0: 7465 725f 6c6f 6164 5f73 7461 7465 5f64  ter_load_state_d
+0000f5e0: 6963 745f 7072 655f 686f 6f6b 2873 656c  ict_pre_hook(sel
+0000f5f0: 662c 2068 6f6f 6b29 3a0d 0a20 2020 2020  f, hook):..     
+0000f600: 2020 2072 2222 2254 6865 7365 2068 6f6f     r"""These hoo
+0000f610: 6b73 2077 696c 6c20 6265 2063 616c 6c65  ks will be calle
+0000f620: 6420 7769 7468 2061 7267 756d 656e 7473  d with arguments
+0000f630: 3a20 6073 7461 7465 5f64 6963 7460 2c20  : `state_dict`, 
+0000f640: 6070 7265 6669 7860 2c0d 0a20 2020 2020  `prefix`,..     
+0000f650: 2020 2060 6c6f 6361 6c5f 6d65 7461 6461     `local_metada
+0000f660: 7461 602c 2060 7374 7269 6374 602c 2060  ta`, `strict`, `
+0000f670: 6d69 7373 696e 675f 6b65 7973 602c 2060  missing_keys`, `
+0000f680: 756e 6578 7065 6374 6564 5f6b 6579 7360  unexpected_keys`
+0000f690: 2c0d 0a20 2020 2020 2020 2060 6572 726f  ,..        `erro
+0000f6a0: 725f 6d73 6773 602c 2062 6566 6f72 6520  r_msgs`, before 
+0000f6b0: 6c6f 6164 696e 6720 6073 7461 7465 5f64  loading `state_d
+0000f6c0: 6963 7460 2069 6e74 6f20 6073 656c 6660  ict` into `self`
+0000f6d0: 2e20 5468 6573 6520 6172 6775 6d65 6e74  . These argument
+0000f6e0: 730d 0a20 2020 2020 2020 2061 7265 2065  s..        are e
+0000f6f0: 7861 6374 6c79 2074 6865 2073 616d 6520  xactly the same 
+0000f700: 6173 2074 686f 7365 206f 6620 605f 6c6f  as those of `_lo
+0000f710: 6164 5f66 726f 6d5f 7374 6174 655f 6469  ad_from_state_di
+0000f720: 6374 602e 0d0a 2020 2020 2020 2020 2222  ct`...        ""
+0000f730: 220d 0a20 2020 2020 2020 2068 616e 646c  "..        handl
+0000f740: 6520 3d20 5265 6d6f 7661 626c 6548 616e  e = RemovableHan
+0000f750: 646c 6528 7365 6c66 2e5f 6c6f 6164 5f73  dle(self._load_s
+0000f760: 7461 7465 5f64 6963 745f 7072 655f 686f  tate_dict_pre_ho
+0000f770: 6f6b 7329 0d0a 2020 2020 2020 2020 7365  oks)..        se
+0000f780: 6c66 2e5f 6c6f 6164 5f73 7461 7465 5f64  lf._load_state_d
+0000f790: 6963 745f 7072 655f 686f 6f6b 735b 6861  ict_pre_hooks[ha
+0000f7a0: 6e64 6c65 2e69 645d 203d 2068 6f6f 6b0d  ndle.id] = hook.
+0000f7b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f7c0: 6861 6e64 6c65 0d0a 0d0a 2020 2020 6465  handle....    de
+0000f7d0: 6620 5f6c 6f61 645f 6672 6f6d 5f73 7461  f _load_from_sta
+0000f7e0: 7465 5f64 6963 7428 7365 6c66 2c20 7374  te_dict(self, st
+0000f7f0: 6174 655f 6469 6374 2c20 7072 6566 6978  ate_dict, prefix
+0000f800: 2c20 6c6f 6361 6c5f 6d65 7461 6461 7461  , local_metadata
+0000f810: 2c20 7374 7269 6374 2c0d 0a20 2020 2020  , strict,..     
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f830: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
+0000f840: 5f6b 6579 732c 2075 6e65 7870 6563 7465  _keys, unexpecte
+0000f850: 645f 6b65 7973 2c20 6572 726f 725f 6d73  d_keys, error_ms
+0000f860: 6773 293a 0d0a 2020 2020 2020 2020 7222  gs):..        r"
+0000f870: 2222 436f 7069 6573 2070 6172 616d 6574  ""Copies paramet
+0000f880: 6572 7320 616e 6420 6275 6666 6572 7320  ers and buffers 
+0000f890: 6672 6f6d 203a 6174 7472 3a60 7374 6174  from :attr:`stat
+0000f8a0: 655f 6469 6374 6020 696e 746f 206f 6e6c  e_dict` into onl
+0000f8b0: 790d 0a20 2020 2020 2020 2074 6869 7320  y..        this 
+0000f8c0: 6d6f 6475 6c65 2c20 6275 7420 6e6f 7420  module, but not 
+0000f8d0: 6974 7320 6465 7363 656e 6461 6e74 732e  its descendants.
+0000f8e0: 2054 6869 7320 6973 2063 616c 6c65 6420   This is called 
+0000f8f0: 6f6e 2065 7665 7279 2073 7562 6d6f 6475  on every submodu
+0000f900: 6c65 0d0a 2020 2020 2020 2020 696e 203a  le..        in :
+0000f910: 6d65 7468 3a60 7e74 656e 736f 7266 6c6f  meth:`~tensorflo
+0000f920: 772e 6e6e 2e4d 6f64 756c 652e 6c6f 6164  w.nn.Module.load
+0000f930: 5f73 7461 7465 5f64 6963 7460 2e20 4d65  _state_dict`. Me
+0000f940: 7461 6461 7461 2073 6176 6564 2066 6f72  tadata saved for
+0000f950: 2074 6869 730d 0a20 2020 2020 2020 206d   this..        m
+0000f960: 6f64 756c 6520 696e 2069 6e70 7574 203a  odule in input :
+0000f970: 6174 7472 3a60 7374 6174 655f 6469 6374  attr:`state_dict
+0000f980: 6020 6973 2070 726f 7669 6465 6420 6173  ` is provided as
+0000f990: 203a 6174 7472 3a60 6c6f 6361 6c5f 6d65   :attr:`local_me
+0000f9a0: 7461 6461 7461 602e 0d0a 2020 2020 2020  tadata`...      
+0000f9b0: 2020 466f 7220 7374 6174 6520 6469 6374    For state dict
+0000f9c0: 7320 7769 7468 6f75 7420 6d65 7461 6461  s without metada
+0000f9d0: 7461 2c20 3a61 7474 723a 606c 6f63 616c  ta, :attr:`local
+0000f9e0: 5f6d 6574 6164 6174 6160 2069 7320 656d  _metadata` is em
+0000f9f0: 7074 792e 0d0a 2020 2020 2020 2020 5375  pty...        Su
+0000fa00: 6263 6c61 7373 6573 2063 616e 2061 6368  bclasses can ach
+0000fa10: 6965 7665 2063 6c61 7373 2d73 7065 6369  ieve class-speci
+0000fa20: 6669 6320 6261 636b 7761 7264 2063 6f6d  fic backward com
+0000fa30: 7061 7469 626c 6520 6c6f 6164 696e 6720  patible loading 
+0000fa40: 7573 696e 670d 0a20 2020 2020 2020 2074  using..        t
+0000fa50: 6865 2076 6572 7369 6f6e 206e 756d 6265  he version numbe
+0000fa60: 7220 6174 2060 6c6f 6361 6c5f 6d65 7461  r at `local_meta
+0000fa70: 6461 7461 2e67 6574 2822 7665 7273 696f  data.get("versio
+0000fa80: 6e22 2c20 4e6f 6e65 2960 2e0d 0a0d 0a20  n", None)`..... 
+0000fa90: 2020 2020 2020 202e 2e20 6e6f 7465 3a3a         .. note::
+0000faa0: 0d0a 2020 2020 2020 2020 2020 2020 3a61  ..            :a
+0000fab0: 7474 723a 6073 7461 7465 5f64 6963 7460  ttr:`state_dict`
+0000fac0: 2069 7320 6e6f 7420 7468 6520 7361 6d65   is not the same
+0000fad0: 206f 626a 6563 7420 6173 2074 6865 2069   object as the i
+0000fae0: 6e70 7574 0d0a 2020 2020 2020 2020 2020  nput..          
+0000faf0: 2020 3a61 7474 723a 6073 7461 7465 5f64    :attr:`state_d
+0000fb00: 6963 7460 2074 6f20 3a6d 6574 683a 607e  ict` to :meth:`~
+0000fb10: 7465 6e73 6f72 666c 6f77 2e6e 6e2e 4d6f  tensorflow.nn.Mo
+0000fb20: 6475 6c65 2e6c 6f61 645f 7374 6174 655f  dule.load_state_
+0000fb30: 6469 6374 602e 2053 6f0d 0a20 2020 2020  dict`. So..     
+0000fb40: 2020 2020 2020 2069 7420 6361 6e20 6265         it can be
+0000fb50: 206d 6f64 6966 6965 642e 0d0a 0d0a 2020   modified.....  
+0000fb60: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
+0000fb70: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+0000fb80: 6174 655f 6469 6374 2028 6469 6374 293a  ate_dict (dict):
+0000fb90: 2061 2064 6963 7420 636f 6e74 6169 6e69   a dict containi
+0000fba0: 6e67 2070 6172 616d 6574 6572 7320 616e  ng parameters an
+0000fbb0: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
+0000fbc0: 2020 2070 6572 7369 7374 656e 7420 6275     persistent bu
+0000fbd0: 6666 6572 732e 0d0a 2020 2020 2020 2020  ffers...        
+0000fbe0: 2020 2020 7072 6566 6978 2028 7374 7229      prefix (str)
+0000fbf0: 3a20 7468 6520 7072 6566 6978 2066 6f72  : the prefix for
+0000fc00: 2070 6172 616d 6574 6572 7320 616e 6420   parameters and 
+0000fc10: 6275 6666 6572 7320 7573 6564 2069 6e20  buffers used in 
+0000fc20: 7468 6973 0d0a 2020 2020 2020 2020 2020  this..          
+0000fc30: 2020 2020 2020 6d6f 6475 6c65 0d0a 2020        module..  
+0000fc40: 2020 2020 2020 2020 2020 6c6f 6361 6c5f            local_
+0000fc50: 6d65 7461 6461 7461 2028 6469 6374 293a  metadata (dict):
+0000fc60: 2061 2064 6963 7420 636f 6e74 6169 6e69   a dict containi
+0000fc70: 6e67 2074 6865 206d 6574 6164 6174 6120  ng the metadata 
+0000fc80: 666f 7220 7468 6973 206d 6f64 756c 652e  for this module.
+0000fc90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fca0: 2020 5365 650d 0a20 2020 2020 2020 2020    See..         
+0000fcb0: 2020 2073 7472 6963 7420 2862 6f6f 6c29     strict (bool)
+0000fcc0: 3a20 7768 6574 6865 7220 746f 2073 7472  : whether to str
+0000fcd0: 6963 746c 7920 656e 666f 7263 6520 7468  ictly enforce th
+0000fce0: 6174 2074 6865 206b 6579 7320 696e 0d0a  at the keys in..
+0000fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd00: 3a61 7474 723a 6073 7461 7465 5f64 6963  :attr:`state_dic
+0000fd10: 7460 2077 6974 6820 3a61 7474 723a 6070  t` with :attr:`p
+0000fd20: 7265 6669 7860 206d 6174 6368 2074 6865  refix` match the
+0000fd30: 206e 616d 6573 206f 660d 0a20 2020 2020   names of..     
+0000fd40: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000fd50: 6574 6572 7320 616e 6420 6275 6666 6572  eters and buffer
+0000fd60: 7320 696e 2074 6869 7320 6d6f 6475 6c65  s in this module
+0000fd70: 0d0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
+0000fd80: 7373 696e 675f 6b65 7973 2028 6c69 7374  ssing_keys (list
+0000fd90: 206f 6620 7374 7229 3a20 6966 2060 6073   of str): if ``s
+0000fda0: 7472 6963 743d 5472 7565 6060 2c20 6164  trict=True``, ad
+0000fdb0: 6420 6d69 7373 696e 6720 6b65 7973 2074  d missing keys t
+0000fdc0: 6f0d 0a20 2020 2020 2020 2020 2020 2020  o..             
+0000fdd0: 2020 2074 6869 7320 6c69 7374 0d0a 2020     this list..  
+0000fde0: 2020 2020 2020 2020 2020 756e 6578 7065            unexpe
+0000fdf0: 6374 6564 5f6b 6579 7320 286c 6973 7420  cted_keys (list 
+0000fe00: 6f66 2073 7472 293a 2069 6620 6060 7374  of str): if ``st
+0000fe10: 7269 6374 3d54 7275 6560 602c 2061 6464  rict=True``, add
+0000fe20: 2075 6e65 7870 6563 7465 640d 0a20 2020   unexpected..   
+0000fe30: 2020 2020 2020 2020 2020 2020 206b 6579               key
+0000fe40: 7320 746f 2074 6869 7320 6c69 7374 0d0a  s to this list..
+0000fe50: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0000fe60: 725f 6d73 6773 2028 6c69 7374 206f 6620  r_msgs (list of 
+0000fe70: 7374 7229 3a20 6572 726f 7220 6d65 7373  str): error mess
+0000fe80: 6167 6573 2073 686f 756c 6420 6265 2061  ages should be a
+0000fe90: 6464 6564 2074 6f20 7468 6973 0d0a 2020  dded to this..  
+0000fea0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000feb0: 7374 2c20 616e 6420 7769 6c6c 2062 6520  st, and will be 
+0000fec0: 7265 706f 7274 6564 2074 6f67 6574 6865  reported togethe
+0000fed0: 7220 696e 0d0a 2020 2020 2020 2020 2020  r in..          
+0000fee0: 2020 2020 2020 3a6d 6574 683a 607e 7465        :meth:`~te
+0000fef0: 6e73 6f72 666c 6f77 2e6e 6e2e 4d6f 6475  nsorflow.nn.Modu
+0000ff00: 6c65 2e6c 6f61 645f 7374 6174 655f 6469  le.load_state_di
+0000ff10: 6374 600d 0a20 2020 2020 2020 2022 2222  ct`..        """
+0000ff20: 0d0a 2020 2020 2020 2020 666f 7220 686f  ..        for ho
+0000ff30: 6f6b 2069 6e20 7365 6c66 2e5f 6c6f 6164  ok in self._load
+0000ff40: 5f73 7461 7465 5f64 6963 745f 7072 655f  _state_dict_pre_
+0000ff50: 686f 6f6b 732e 7661 6c75 6573 2829 3a0d  hooks.values():.
+0000ff60: 0a20 2020 2020 2020 2020 2020 2068 6f6f  .            hoo
+0000ff70: 6b28 7374 6174 655f 6469 6374 2c20 7072  k(state_dict, pr
+0000ff80: 6566 6978 2c20 6c6f 6361 6c5f 6d65 7461  efix, local_meta
+0000ff90: 6461 7461 2c20 7374 7269 6374 2c20 6d69  data, strict, mi
+0000ffa0: 7373 696e 675f 6b65 7973 2c20 756e 6578  ssing_keys, unex
+0000ffb0: 7065 6374 6564 5f6b 6579 732c 2065 7272  pected_keys, err
+0000ffc0: 6f72 5f6d 7367 7329 0d0a 0d0a 2020 2020  or_msgs)....    
+0000ffd0: 2020 2020 7065 7273 6973 7465 6e74 5f62      persistent_b
+0000ffe0: 7566 6665 7273 203d 207b 6b3a 2076 2066  uffers = {k: v f
+0000fff0: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+00010000: 5f62 7566 6665 7273 2e69 7465 6d73 2829  _buffers.items()
+00010010: 2069 6620 6b20 6e6f 7420 696e 2073 656c   if k not in sel
+00010020: 662e 5f6e 6f6e 5f70 6572 7369 7374 656e  f._non_persisten
+00010030: 745f 6275 6666 6572 735f 7365 747d 0d0a  t_buffers_set}..
+00010040: 2020 2020 2020 2020 6c6f 6361 6c5f 6e61          local_na
+00010050: 6d65 5f70 6172 616d 7320 3d20 6974 6572  me_params = iter
+00010060: 746f 6f6c 732e 6368 6169 6e28 7365 6c66  tools.chain(self
+00010070: 2e5f 7061 7261 6d65 7465 7273 2e69 7465  ._parameters.ite
+00010080: 6d73 2829 2c20 7065 7273 6973 7465 6e74  ms(), persistent
+00010090: 5f62 7566 6665 7273 2e69 7465 6d73 2829  _buffers.items()
+000100a0: 290d 0a20 2020 2020 2020 206c 6f63 616c  )..        local
+000100b0: 5f73 7461 7465 203d 207b 6b3a 2076 2066  _state = {k: v f
+000100c0: 6f72 206b 2c20 7620 696e 206c 6f63 616c  or k, v in local
+000100d0: 5f6e 616d 655f 7061 7261 6d73 2069 6620  _name_params if 
+000100e0: 7620 6973 206e 6f74 204e 6f6e 657d 0d0a  v is not None}..
+000100f0: 0d0a 2020 2020 2020 2020 666f 7220 6e61  ..        for na
+00010100: 6d65 2c20 7061 7261 6d20 696e 206c 6f63  me, param in loc
+00010110: 616c 5f73 7461 7465 2e69 7465 6d73 2829  al_state.items()
+00010120: 3a0d 0a20 2020 2020 2020 2020 2020 206b  :..            k
+00010130: 6579 203d 2070 7265 6669 7820 2b20 6e61  ey = prefix + na
+00010140: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+00010150: 6966 206b 6579 2069 6e20 7374 6174 655f  if key in state_
+00010160: 6469 6374 3a0d 0a20 2020 2020 2020 2020  dict:..         
+00010170: 2020 2020 2020 2069 6e70 7574 5f70 6172         input_par
+00010180: 616d 203d 2073 7461 7465 5f64 6963 745b  am = state_dict[
+00010190: 6b65 795d 0d0a 0d0a 2020 2020 2020 2020  key]....        
+000101a0: 2020 2020 2020 2020 2320 4261 636b 7761          # Backwa
+000101b0: 7264 2063 6f6d 7061 7469 6269 6c69 7479  rd compatibility
+000101c0: 3a20 6c6f 6164 696e 6720 312d 6469 6d20  : loading 1-dim 
+000101d0: 7465 6e73 6f72 2066 726f 6d20 302e 332e  tensor from 0.3.
+000101e0: 2a20 746f 2076 6572 7369 6f6e 2030 2e34  * to version 0.4
+000101f0: 2b0d 0a20 2020 2020 2020 2020 2020 2020  +..             
+00010200: 2020 2069 6620 6c65 6e28 7061 7261 6d2e     if len(param.
+00010210: 7368 6170 6529 203d 3d20 3020 616e 6420  shape) == 0 and 
+00010220: 6c65 6e28 696e 7075 745f 7061 7261 6d2e  len(input_param.
+00010230: 7368 6170 6529 203d 3d20 313a 0d0a 2020  shape) == 1:..  
+00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010250: 2020 696e 7075 745f 7061 7261 6d20 3d20    input_param = 
+00010260: 696e 7075 745f 7061 7261 6d5b 305d 0d0a  input_param[0]..
+00010270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010280: 2020 6966 2069 6e70 7574 5f70 6172 616d    if input_param
+00010290: 2e73 6861 7065 2021 3d20 7061 7261 6d2e  .shape != param.
+000102a0: 7368 6170 653a 0d0a 2020 2020 2020 2020  shape:..        
+000102b0: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
+000102c0: 6361 6c20 7368 6170 6520 7368 6f75 6c64  cal shape should
+000102d0: 206d 6174 6368 2074 6865 206f 6e65 2069   match the one i
+000102e0: 6e20 6368 6563 6b70 6f69 6e74 0d0a 2020  n checkpoint..  
+000102f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010300: 2020 6572 726f 725f 6d73 6773 2e61 7070    error_msgs.app
+00010310: 656e 6428 2773 697a 6520 6d69 736d 6174  end('size mismat
+00010320: 6368 2066 6f72 207b 7d3a 2063 6f70 7969  ch for {}: copyi
+00010330: 6e67 2061 2070 6172 616d 2077 6974 6820  ng a param with 
+00010340: 7368 6170 6520 7b7d 2066 726f 6d20 6368  shape {} from ch
+00010350: 6563 6b70 6f69 6e74 2c20 270d 0a20 2020  eckpoint, '..   
+00010360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010380: 2020 2027 7468 6520 7368 6170 6520 696e     'the shape in
+00010390: 2063 7572 7265 6e74 206d 6f64 656c 2069   current model i
+000103a0: 7320 7b7d 2e27 0d0a 2020 2020 2020 2020  s {}.'..        
+000103b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103c0: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
+000103d0: 6f72 6d61 7428 6b65 792c 2069 6e70 7574  ormat(key, input
+000103e0: 5f70 6172 616d 2e73 6861 7065 2c20 7061  _param.shape, pa
+000103f0: 7261 6d2e 7368 6170 6529 290d 0a20 2020  ram.shape))..   
+00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010410: 2063 6f6e 7469 6e75 650d 0a0d 0a20 2020   continue....   
+00010420: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00010430: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00010440: 2020 2020 2020 2070 6172 616d 2e61 7373         param.ass
+00010450: 6967 6e28 746f 5f74 656e 736f 7228 696e  ign(to_tensor(in
+00010460: 7075 745f 7061 7261 6d29 290d 0a0d 0a20  put_param)).... 
+00010470: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010480: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00010490: 6173 2065 783a 0d0a 2020 2020 2020 2020  as ex:..        
+000104a0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000104b0: 725f 6d73 6773 2e61 7070 656e 6428 2757  r_msgs.append('W
+000104c0: 6869 6c65 2063 6f70 7969 6e67 2074 6865  hile copying the
+000104d0: 2070 6172 616d 6574 6572 206e 616d 6564   parameter named
+000104e0: 2022 7b7d 222c 2027 0d0a 2020 2020 2020   "{}", '..      
+000104f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010510: 2777 686f 7365 2064 696d 656e 7369 6f6e  'whose dimension
+00010520: 7320 696e 2074 6865 206d 6f64 656c 2061  s in the model a
+00010530: 7265 207b 7d20 616e 6420 270d 0a20 2020  re {} and '..   
+00010540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010560: 2020 2027 7768 6f73 6520 6469 6d65 6e73     'whose dimens
+00010570: 696f 6e73 2069 6e20 7468 6520 6368 6563  ions in the chec
+00010580: 6b70 6f69 6e74 2061 7265 207b 7d2c 2027  kpoint are {}, '
+00010590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000105a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105b0: 2020 2020 2020 2020 2761 6e20 6578 6365          'an exce
+000105c0: 7074 696f 6e20 6f63 6375 7265 6420 3a20  ption occured : 
+000105d0: 7b7d 2e27 0d0a 2020 2020 2020 2020 2020  {}.'..          
+000105e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105f0: 2020 2020 2020 2020 2020 2020 2e66 6f72              .for
+00010600: 6d61 7428 6b65 792c 206e 756d 656c 2870  mat(key, numel(p
+00010610: 6172 616d 292c 206e 756d 656c 2869 6e70  aram), numel(inp
+00010620: 7574 5f70 6172 616d 292c 2065 782e 6172  ut_param), ex.ar
+00010630: 6773 2929 0d0a 2020 2020 2020 2020 2020  gs))..          
+00010640: 2020 656c 6966 2073 7472 6963 743a 0d0a    elif strict:..
+00010650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010660: 6d69 7373 696e 675f 6b65 7973 2e61 7070  missing_keys.app
+00010670: 656e 6428 6b65 7929 0d0a 0d0a 2020 2020  end(key)....    
+00010680: 2020 2020 6966 2073 7472 6963 743a 0d0a      if strict:..
+00010690: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000106a0: 6b65 7920 696e 2073 7461 7465 5f64 6963  key in state_dic
+000106b0: 742e 6b65 7973 2829 3a0d 0a20 2020 2020  t.keys():..     
+000106c0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+000106d0: 792e 7374 6172 7473 7769 7468 2870 7265  y.startswith(pre
+000106e0: 6669 7829 3a0d 0a20 2020 2020 2020 2020  fix):..         
+000106f0: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+00010700: 5f6e 616d 6520 3d20 6b65 795b 6c65 6e28  _name = key[len(
+00010710: 7072 6566 6978 293a 5d0d 0a20 2020 2020  prefix):]..     
+00010720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010730: 6e70 7574 5f6e 616d 6520 3d20 696e 7075  nput_name = inpu
+00010740: 745f 6e61 6d65 2e73 706c 6974 2827 2e27  t_name.split('.'
+00010750: 2c20 3129 5b30 5d20 2023 2067 6574 2074  , 1)[0]  # get t
+00010760: 6865 206e 616d 6520 6f66 2070 6172 616d  he name of param
+00010770: 2f62 7566 6665 722f 6368 696c 640d 0a20  /buffer/child.. 
+00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010790: 2020 2069 6620 696e 7075 745f 6e61 6d65     if input_name
+000107a0: 206e 6f74 2069 6e20 7365 6c66 2e5f 6d6f   not in self._mo
+000107b0: 6475 6c65 7320 616e 6420 696e 7075 745f  dules and input_
+000107c0: 6e61 6d65 206e 6f74 2069 6e20 6c6f 6361  name not in loca
+000107d0: 6c5f 7374 6174 653a 0d0a 2020 2020 2020  l_state:..      
+000107e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107f0: 2020 756e 6578 7065 6374 6564 5f6b 6579    unexpected_key
+00010800: 732e 6170 7065 6e64 286b 6579 290d 0a0d  s.append(key)...
+00010810: 0a20 2020 2064 6566 206c 6f61 645f 7374  .    def load_st
+00010820: 6174 655f 6469 6374 2873 656c 662c 2073  ate_dict(self, s
+00010830: 7461 7465 5f64 6963 742c 2073 7472 6963  tate_dict, stric
+00010840: 743d 5472 7565 293a 0d0a 2020 2020 2020  t=True):..      
+00010850: 2020 7222 2222 436f 7069 6573 2070 6172    r"""Copies par
+00010860: 616d 6574 6572 7320 616e 6420 6275 6666  ameters and buff
+00010870: 6572 7320 6672 6f6d 203a 6174 7472 3a60  ers from :attr:`
+00010880: 7374 6174 655f 6469 6374 6020 696e 746f  state_dict` into
+00010890: 0d0a 2020 2020 2020 2020 7468 6973 206d  ..        this m
+000108a0: 6f64 756c 6520 616e 6420 6974 7320 6465  odule and its de
+000108b0: 7363 656e 6461 6e74 732e 2049 6620 3a61  scendants. If :a
+000108c0: 7474 723a 6073 7472 6963 7460 2069 7320  ttr:`strict` is 
+000108d0: 6060 5472 7565 6060 2c20 7468 656e 0d0a  ``True``, then..
+000108e0: 2020 2020 2020 2020 7468 6520 6b65 7973          the keys
+000108f0: 206f 6620 3a61 7474 723a 6073 7461 7465   of :attr:`state
+00010900: 5f64 6963 7460 206d 7573 7420 6578 6163  _dict` must exac
+00010910: 746c 7920 6d61 7463 6820 7468 6520 6b65  tly match the ke
+00010920: 7973 2072 6574 7572 6e65 640d 0a20 2020  ys returned..   
+00010930: 2020 2020 2062 7920 7468 6973 206d 6f64       by this mod
+00010940: 756c 6527 7320 3a6d 6574 683a 607e 7465  ule's :meth:`~te
+00010950: 6e73 6f72 666c 6f77 2e6e 6e2e 4d6f 6475  nsorflow.nn.Modu
+00010960: 6c65 2e73 7461 7465 5f64 6963 7460 2066  le.state_dict` f
+00010970: 756e 6374 696f 6e2e 0d0a 2020 2020 2020  unction...      
+00010980: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+00010990: 2020 2020 2073 7461 7465 5f64 6963 7420       state_dict 
+000109a0: 2864 6963 7429 3a20 6120 6469 6374 2063  (dict): a dict c
+000109b0: 6f6e 7461 696e 696e 6720 7061 7261 6d65  ontaining parame
+000109c0: 7465 7273 2061 6e64 0d0a 2020 2020 2020  ters and..      
+000109d0: 2020 2020 2020 2020 2020 7065 7273 6973            persis
+000109e0: 7465 6e74 2062 7566 6665 7273 2e0d 0a20  tent buffers... 
+000109f0: 2020 2020 2020 2020 2020 2073 7472 6963             stric
+00010a00: 7420 2862 6f6f 6c2c 206f 7074 696f 6e61  t (bool, optiona
+00010a10: 6c29 3a20 7768 6574 6865 7220 746f 2073  l): whether to s
+00010a20: 7472 6963 746c 7920 656e 666f 7263 6520  trictly enforce 
+00010a30: 7468 6174 2074 6865 206b 6579 730d 0a20  that the keys.. 
+00010a40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010a50: 6e20 3a61 7474 723a 6073 7461 7465 5f64  n :attr:`state_d
+00010a60: 6963 7460 206d 6174 6368 2074 6865 206b  ict` match the k
+00010a70: 6579 7320 7265 7475 726e 6564 2062 7920  eys returned by 
+00010a80: 7468 6973 206d 6f64 756c 6527 730d 0a20  this module's.. 
+00010a90: 2020 2020 2020 2020 2020 2020 2020 203a                 :
+00010aa0: 6d65 7468 3a60 7e74 656e 736f 7266 6c6f  meth:`~tensorflo
+00010ab0: 772e 6e6e 2e4d 6f64 756c 652e 7374 6174  w.nn.Module.stat
+00010ac0: 655f 6469 6374 6020 6675 6e63 7469 6f6e  e_dict` function
+00010ad0: 2e20 4465 6661 756c 743a 2060 6054 7275  . Default: ``Tru
+00010ae0: 6560 600d 0a20 2020 2020 2020 2052 6574  e``..        Ret
+00010af0: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
+00010b00: 2020 2060 604e 616d 6564 5475 706c 6560     ``NamedTuple`
+00010b10: 6020 7769 7468 2060 606d 6973 7369 6e67  ` with ``missing
+00010b20: 5f6b 6579 7360 6020 616e 6420 6060 756e  _keys`` and ``un
+00010b30: 6578 7065 6374 6564 5f6b 6579 7360 6020  expected_keys`` 
+00010b40: 6669 656c 6473 3a0d 0a20 2020 2020 2020  fields:..       
+00010b50: 2020 2020 2020 2020 202a 202a 2a6d 6973           * **mis
+00010b60: 7369 6e67 5f6b 6579 732a 2a20 6973 2061  sing_keys** is a
+00010b70: 206c 6973 7420 6f66 2073 7472 2063 6f6e   list of str con
+00010b80: 7461 696e 696e 6720 7468 6520 6d69 7373  taining the miss
+00010b90: 696e 6720 6b65 7973 0d0a 2020 2020 2020  ing keys..      
+00010ba0: 2020 2020 2020 2020 2020 2a20 2a2a 756e            * **un
+00010bb0: 6578 7065 6374 6564 5f6b 6579 732a 2a20  expected_keys** 
+00010bc0: 6973 2061 206c 6973 7420 6f66 2073 7472  is a list of str
+00010bd0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+00010be0: 756e 6578 7065 6374 6564 206b 6579 730d  unexpected keys.
+00010bf0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00010c00: 2020 2020 2020 7769 7468 2074 662e 6465        with tf.de
+00010c10: 7669 6365 2873 656c 662e 6765 745f 726f  vice(self.get_ro
+00010c20: 6f74 2829 2e64 6576 6963 6529 3a0d 0a20  ot().device):.. 
+00010c30: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+00010c40: 6e67 5f6b 6579 7320 3d20 5b5d 0d0a 2020  ng_keys = []..  
+00010c50: 2020 2020 2020 2020 2020 756e 6578 7065            unexpe
+00010c60: 6374 6564 5f6b 6579 7320 3d20 5b5d 0d0a  cted_keys = []..
+00010c70: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00010c80: 725f 6d73 6773 203d 205b 5d0d 0a0d 0a20  r_msgs = [].... 
+00010c90: 2020 2020 2020 2020 2020 2023 2063 6f70             # cop
+00010ca0: 7920 7374 6174 655f 6469 6374 2073 6f20  y state_dict so 
+00010cb0: 5f6c 6f61 645f 6672 6f6d 5f73 7461 7465  _load_from_state
+00010cc0: 5f64 6963 7420 6361 6e20 6d6f 6469 6679  _dict can modify
+00010cd0: 2069 740d 0a20 2020 2020 2020 2020 2020   it..           
+00010ce0: 206d 6574 6164 6174 6120 3d20 6765 7461   metadata = geta
+00010cf0: 7474 7228 7374 6174 655f 6469 6374 2c20  ttr(state_dict, 
+00010d00: 275f 6d65 7461 6461 7461 272c 204e 6f6e  '_metadata', Non
+00010d10: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00010d20: 7374 6174 655f 6469 6374 203d 2073 7461  state_dict = sta
+00010d30: 7465 5f64 6963 742e 636f 7079 2829 0d0a  te_dict.copy()..
+00010d40: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00010d50: 6574 6164 6174 6120 6973 206e 6f74 204e  etadata is not N
+00010d60: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00010d70: 2020 2020 2020 7374 6174 655f 6469 6374        state_dict
+00010d80: 2e5f 6d65 7461 6461 7461 203d 206d 6574  ._metadata = met
+00010d90: 6164 6174 610d 0a0d 0a20 2020 2020 2020  adata....       
+00010da0: 2020 2020 2064 6566 206c 6f61 6428 6d6f       def load(mo
+00010db0: 6475 6c65 2c20 7072 6566 6978 3d27 2729  dule, prefix='')
+00010dc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00010dd0: 2020 206c 6f63 616c 5f6d 6574 6164 6174     local_metadat
+00010de0: 6120 3d20 7b7d 2069 6620 6d65 7461 6461  a = {} if metada
+00010df0: 7461 2069 7320 4e6f 6e65 2065 6c73 6520  ta is None else 
+00010e00: 6d65 7461 6461 7461 2e67 6574 2870 7265  metadata.get(pre
+00010e10: 6669 785b 3a2d 315d 2c20 7b7d 290d 0a20  fix[:-1], {}).. 
+00010e20: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00010e30: 6f64 756c 652e 5f6c 6f61 645f 6672 6f6d  odule._load_from
+00010e40: 5f73 7461 7465 5f64 6963 7428 7374 6174  _state_dict(stat
+00010e50: 655f 6469 6374 2c20 7072 6566 6978 2c20  e_dict, prefix, 
+00010e60: 6c6f 6361 6c5f 6d65 7461 6461 7461 2c20  local_metadata, 
+00010e70: 5472 7565 2c20 6d69 7373 696e 675f 6b65  True, missing_ke
+00010e80: 7973 2c20 756e 6578 7065 6374 6564 5f6b  ys, unexpected_k
+00010e90: 6579 732c 0d0a 2020 2020 2020 2020 2020  eys,..          
+00010ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2020 2065 7272 6f72 5f6d 7367 7329 0d0a     error_msgs)..
 00010ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ee0: 2020 2020 2065 7272 6f72 5f6d 7367 7329       error_msgs)
-00010ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010f00: 2020 666f 7220 6e61 6d65 2c20 6368 696c    for name, chil
-00010f10: 6420 696e 206d 6f64 756c 652e 5f6d 6f64  d in module._mod
-00010f20: 756c 6573 2e69 7465 6d73 2829 3a0d 0a20  ules.items():.. 
-00010f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f40: 2020 2069 6620 6368 696c 6420 6973 206e     if child is n
-00010f50: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00010f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f70: 2020 6c6f 6164 2863 6869 6c64 2c20 7072    load(child, pr
-00010f80: 6566 6978 202b 206e 616d 6520 2b20 272e  efix + name + '.
-00010f90: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
-00010fa0: 2020 6c6f 6164 2873 656c 6629 0d0a 2020    load(self)..  
-00010fb0: 2020 2020 2020 2020 2020 6c6f 6164 203d            load =
-00010fc0: 204e 6f6e 6520 2023 2062 7265 616b 206c   None  # break l
-00010fd0: 6f61 642d 3e6c 6f61 6420 7265 6665 7265  oad->load refere
-00010fe0: 6e63 6520 6379 636c 650d 0a0d 0a20 2020  nce cycle....   
-00010ff0: 2020 2020 2020 2020 2069 6620 7374 7269           if stri
-00011000: 6374 3a0d 0a20 2020 2020 2020 2020 2020  ct:..           
-00011010: 2020 2020 2069 6620 6c65 6e28 756e 6578       if len(unex
-00011020: 7065 6374 6564 5f6b 6579 7329 203e 2030  pected_keys) > 0
-00011030: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011040: 2020 2020 2020 2065 7272 6f72 5f6d 7367         error_msg
-00011050: 732e 696e 7365 7274 2830 2c20 2755 6e65  s.insert(0, 'Une
-00011060: 7870 6563 7465 6420 6b65 7928 7329 2069  xpected key(s) i
-00011070: 6e20 7374 6174 655f 6469 6374 3a20 7b7d  n state_dict: {}
-00011080: 2e20 272e 666f 726d 6174 280d 0a20 2020  . '.format(..   
-00011090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110a0: 2020 2020 2027 2c20 272e 6a6f 696e 2827       ', '.join('
-000110b0: 227b 7d22 272e 666f 726d 6174 286b 2920  "{}"'.format(k) 
-000110c0: 666f 7220 6b20 696e 2075 6e65 7870 6563  for k in unexpec
-000110d0: 7465 645f 6b65 7973 2929 290d 0a20 2020  ted_keys)))..   
-000110e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000110f0: 6c65 6e28 6d69 7373 696e 675f 6b65 7973  len(missing_keys
-00011100: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-00011110: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00011120: 725f 6d73 6773 2e69 6e73 6572 7428 302c  r_msgs.insert(0,
-00011130: 2027 4d69 7373 696e 6720 6b65 7928 7329   'Missing key(s)
-00011140: 2069 6e20 7374 6174 655f 6469 6374 3a20   in state_dict: 
-00011150: 7b7d 2e20 272e 666f 726d 6174 280d 0a20  {}. '.format(.. 
-00011160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011170: 2020 2020 2020 2027 2c20 272e 6a6f 696e         ', '.join
-00011180: 2827 227b 7d22 272e 666f 726d 6174 286b  ('"{}"'.format(k
-00011190: 2920 666f 7220 6b20 696e 206d 6973 7369  ) for k in missi
-000111a0: 6e67 5f6b 6579 7329 2929 0d0a 0d0a 2020  ng_keys)))....  
-000111b0: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
-000111c0: 656e 2865 7272 6f72 5f6d 7367 7329 203e  en(error_msgs) >
-000111d0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-000111e0: 2023 2020 2020 2072 6169 7365 2052 756e   #     raise Run
-000111f0: 7469 6d65 4572 726f 7228 0d0a 2020 2020  timeError(..    
-00011200: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00011210: 2020 2745 7272 6f72 2873 2920 696e 206c    'Error(s) in l
-00011220: 6f61 6469 6e67 2073 7461 7465 5f64 6963  oading state_dic
-00011230: 7420 666f 7220 7b7d 3a5c 6e5c 747b 7d27  t for {}:\n\t{}'
-00011240: 2e66 6f72 6d61 7428 7365 6c66 2e5f 5f63  .format(self.__c
-00011250: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
-00011260: 2022 5c6e 5c74 222e 6a6f 696e 2865 7272   "\n\t".join(err
-00011270: 6f72 5f6d 7367 7329 2929 0d0a 2020 2020  or_msgs)))..    
-00011280: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-00011290: 496e 636f 6d70 6174 6962 6c65 4b65 7973  IncompatibleKeys
-000112a0: 286d 6973 7369 6e67 5f6b 6579 732c 2075  (missing_keys, u
-000112b0: 6e65 7870 6563 7465 645f 6b65 7973 290d  nexpected_keys).
-000112c0: 0a0d 0a20 2020 2064 6566 2073 6176 6528  ...    def save(
-000112d0: 7365 6c66 2c20 6669 6c65 5f70 6174 683d  self, file_path=
-000112e0: 2727 293a 0d0a 2020 2020 2020 2020 2320  ''):..        # 
-000112f0: 7361 7665 287b 2773 7461 7465 5f64 6963  save({'state_dic
-00011300: 7427 3a20 7365 6c66 2e73 7461 7465 5f64  t': self.state_d
-00011310: 6963 7428 297d 2c20 6669 6c65 5f70 6174  ict()}, file_pat
-00011320: 6829 0d0a 2020 2020 2020 2020 7069 636b  h)..        pick
-00011330: 6c65 5f69 7428 6669 6c65 5f70 6174 682c  le_it(file_path,
-00011340: 207b 2773 7461 7465 5f64 6963 7427 3a20   {'state_dict': 
-00011350: 7365 6c66 2e73 7461 7465 5f64 6963 7428  self.state_dict(
-00011360: 297d 290d 0a0d 0a20 2020 2064 6566 2073  )})....    def s
-00011370: 6176 655f 6f6e 6e78 2873 656c 662c 2066  ave_onnx(self, f
-00011380: 696c 655f 7061 7468 3d27 2729 3a0d 0a20  ile_path=''):.. 
-00011390: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
-000113a0: 2020 2064 6566 2073 6176 655f 7765 6967     def save_weig
-000113b0: 6874 2873 656c 662c 2066 696c 655f 7061  ht(self, file_pa
-000113c0: 7468 3d27 2729 3a0d 0a20 2020 2020 2020  th=''):..       
-000113d0: 2070 6173 730d 0a0d 0a20 2020 2023 2064   pass....    # d
-000113e0: 6566 2066 6f72 7761 7264 2873 656c 662c  ef forward(self,
-000113f0: 202a 696e 7075 742c 202a 2a6b 7761 7267   *input, **kwarg
-00011400: 7329 3a0d 0a20 2020 2023 2020 2020 2072  s):..    #     r
-00011410: 2222 2244 6566 696e 6573 2074 6865 2063  """Defines the c
-00011420: 6f6d 7075 7461 7469 6f6e 2070 6572 666f  omputation perfo
-00011430: 726d 6564 2061 7420 6576 6572 7920 6361  rmed at every ca
-00011440: 6c6c 2e0d 0a20 2020 2023 0d0a 2020 2020  ll...    #..    
-00011450: 2320 2020 2020 5368 6f75 6c64 2062 6520  #     Should be 
-00011460: 6f76 6572 7269 6464 656e 2062 7920 616c  overridden by al
-00011470: 6c20 7375 6263 6c61 7373 6573 2e0d 0a20  l subclasses... 
-00011480: 2020 2023 0d0a 2020 2020 2320 2020 2020     #..    #     
-00011490: 2e2e 206e 6f74 653a 3a0d 0a20 2020 2023  .. note::..    #
-000114a0: 2020 2020 2020 2020 2041 6c74 686f 7567           Althoug
-000114b0: 6820 7468 6520 7265 6369 7065 2066 6f72  h the recipe for
-000114c0: 2066 6f72 7761 7264 2070 6173 7320 6e65   forward pass ne
-000114d0: 6564 7320 746f 2062 6520 6465 6669 6e65  eds to be define
-000114e0: 6420 7769 7468 696e 0d0a 2020 2020 2320  d within..    # 
-000114f0: 2020 2020 2020 2020 7468 6973 2066 756e          this fun
-00011500: 6374 696f 6e2c 206f 6e65 2073 686f 756c  ction, one shoul
-00011510: 6420 6361 6c6c 2074 6865 203a 636c 6173  d call the :clas
-00011520: 733a 604d 6f64 756c 6560 2069 6e73 7461  s:`Module` insta
-00011530: 6e63 6520 6166 7465 7277 6172 6473 0d0a  nce afterwards..
-00011540: 2020 2020 2320 2020 2020 2020 2020 696e      #         in
-00011550: 7374 6561 6420 6f66 2074 6869 7320 7369  stead of this si
-00011560: 6e63 6520 7468 6520 666f 726d 6572 2074  nce the former t
-00011570: 616b 6573 2063 6172 6520 6f66 2072 756e  akes care of run
-00011580: 6e69 6e67 2074 6865 0d0a 2020 2020 2320  ning the..    # 
-00011590: 2020 2020 2020 2020 7265 6769 7374 6572          register
-000115a0: 6564 2068 6f6f 6b73 2077 6869 6c65 2074  ed hooks while t
-000115b0: 6865 206c 6174 7465 7220 7369 6c65 6e74  he latter silent
-000115c0: 6c79 2069 676e 6f72 6573 2074 6865 6d2e  ly ignores them.
-000115d0: 0d0a 2020 2020 2320 2020 2020 2222 220d  ..    #     """.
-000115e0: 0a20 2020 2023 2020 2020 2072 6169 7365  .    #     raise
-000115f0: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-00011600: 7272 6f72 0d0a 0d0a 2020 2020 6465 6620  rror....    def 
-00011610: 5f73 6c6f 775f 666f 7277 6172 6428 7365  _slow_forward(se
-00011620: 6c66 2c20 2a69 6e70 7574 2c20 2a2a 6b77  lf, *input, **kw
-00011630: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00011640: 7265 7475 726e 2073 656c 662e 5f63 616c  return self._cal
-00011650: 6c5f 696d 706c 282a 696e 7075 742c 202a  l_impl(*input, *
-00011660: 2a6b 7761 7267 7329 0d0a 0d0a 2020 2020  *kwargs)....    
-00011670: 4074 662e 4d6f 6475 6c65 2e77 6974 685f  @tf.Module.with_
-00011680: 6e61 6d65 5f73 636f 7065 0d0a 2020 2020  name_scope..    
-00011690: 6465 6620 5f63 616c 6c5f 696d 706c 2873  def _call_impl(s
-000116a0: 656c 662c 202a 696e 7075 742c 202a 2a6b  elf, *input, **k
-000116b0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-000116c0: 2066 6f72 7761 7264 5f63 616c 6c20 3d20   forward_call = 
-000116d0: 7365 6c66 2e66 6f72 7761 7264 0d0a 0d0a  self.forward....
-000116e0: 2020 2020 2020 2020 6973 5f61 6c6c 5f6e          is_all_n
-000116f0: 756d 7079 203d 2046 616c 7365 0d0a 2020  umpy = False..  
-00011700: 2020 2020 2020 6973 5f62 7569 6c74 203d        is_built =
-00011710: 2073 656c 662e 5f62 7569 6c74 0d0a 0d0a   self._built....
-00011720: 2020 2020 2020 2020 2320 6f6e 6c79 2064          # only d
-00011730: 6f20 696e 2074 6865 2072 6f6f 740d 0a20  o in the root.. 
-00011740: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00011750: 735f 726f 6f74 3a0d 0a0d 0a20 2020 2020  s_root:....     
-00011760: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00011770: 616e 6365 2861 7267 732c 2074 7570 6c65  ance(args, tuple
-00011780: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00011790: 2020 2020 6973 5f61 6c6c 5f6e 756d 7079      is_all_numpy
-000117a0: 203d 2061 6c6c 285b 6973 696e 7374 616e   = all([isinstan
-000117b0: 6365 2869 6e70 2c20 6e70 2e6e 6461 7272  ce(inp, np.ndarr
-000117c0: 6179 2920 666f 7220 696e 7020 696e 2061  ay) for inp in a
-000117d0: 7267 735d 290d 0a20 2020 2020 2020 2020  rgs])..         
-000117e0: 2020 2020 2020 2061 7267 7320 3d20 7475         args = tu
-000117f0: 706c 6528 5b74 6f5f 7465 6e73 6f72 2869  ple([to_tensor(i
-00011800: 6e70 2c20 6465 7669 6365 3d67 6574 5f64  np, device=get_d
-00011810: 6576 6963 6528 2929 2066 6f72 2069 6e70  evice()) for inp
-00011820: 2069 6e20 6172 6773 5d29 0d0a 2020 2020   in args])..    
-00011830: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00011840: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011850: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
-00011860: 732c 206e 702e 6e64 6172 7261 7929 3a0d  s, np.ndarray):.
-00011870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011880: 2020 2020 2069 735f 616c 6c5f 6e75 6d70       is_all_nump
-00011890: 7920 3d20 5472 7565 0d0a 2020 2020 2020  y = True..      
-000118a0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
-000118b0: 2074 6f5f 7465 6e73 6f72 2861 7267 732c   to_tensor(args,
-000118c0: 2064 6576 6963 653d 6765 745f 6465 7669   device=get_devi
-000118d0: 6365 2829 290d 0a20 2020 2020 2020 2020  ce())..         
-000118e0: 2020 2020 2020 2061 7267 7320 3d20 2861         args = (a
-000118f0: 7267 732c 290d 0a0d 0a20 2020 2020 2020  rgs,)....       
-00011900: 2069 6620 6e6f 7420 7365 6c66 2e5f 6275   if not self._bu
-00011910: 696c 743a 0d0a 2020 2020 2020 2020 2020  ilt:..          
-00011920: 2020 696e 7020 3d20 756e 7061 636b 5f73    inp = unpack_s
-00011930: 696e 676c 6574 6f6e 2861 7267 7329 0d0a  ingleton(args)..
-00011940: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00011950: 735f 7465 6e73 6f72 2869 6e70 293a 0d0a  s_tensor(inp):..
-00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011970: 7368 7020 3d20 7465 6e73 6f72 5f74 6f5f  shp = tensor_to_
-00011980: 7368 6170 6528 696e 702c 206e 6565 645f  shape(inp, need_
-00011990: 6578 636c 7564 655f 6261 7463 685f 6178  exclude_batch_ax
-000119a0: 6973 3d54 7275 6529 0d0a 2020 2020 2020  is=True)..      
-000119b0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-000119c0: 6e70 7574 5f73 6861 7065 203d 2073 6870  nput_shape = shp
-000119d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000119e0: 2020 7365 6c66 2e69 6e70 7574 5f66 696c    self.input_fil
-000119f0: 7465 7273 203d 2073 6870 5b73 656c 662e  ters = shp[self.
-00011a00: 6669 6c74 6572 5f69 6e64 6578 5d0d 0a0d  filter_index]...
-00011a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a20: 2069 6620 7365 6c66 2e69 735f 726f 6f74   if self.is_root
-00011a30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011a40: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00011a50: 7369 676e 6174 7572 6520 6973 204e 6f6e  signature is Non
-00011a60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00011a70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011a80: 2e5f 7369 676e 6174 7572 6520 3d20 6765  ._signature = ge
-00011a90: 745f 7369 676e 6174 7572 6528 7365 6c66  t_signature(self
-00011aa0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00011ab0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00011ac0: 7369 676e 6174 7572 6520 6973 206e 6f74  signature is not
-00011ad0: 204e 6f6e 6520 616e 6420 6c65 6e28 7365   None and len(se
-00011ae0: 6c66 2e5f 7369 676e 6174 7572 652e 696e  lf._signature.in
-00011af0: 7075 7473 2920 3e20 303a 0d0a 2020 2020  puts) > 0:..    
-00011b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b10: 2020 2020 7365 6c66 2e5f 7369 676e 6174      self._signat
-00011b20: 7572 652e 696e 7075 7473 5b73 656c 662e  ure.inputs[self.
-00011b30: 5f73 6967 6e61 7475 7265 2e69 6e70 7574  _signature.input
-00011b40: 732e 6b65 795f 6c69 7374 5b30 5d5d 2e73  s.key_list[0]].s
-00011b50: 6861 7065 203d 2074 656e 736f 725f 746f  hape = tensor_to
-00011b60: 5f73 6861 7065 2869 6e70 2c0d 0a20 2020  _shape(inp,..   
+00010ee0: 666f 7220 6e61 6d65 2c20 6368 696c 6420  for name, child 
+00010ef0: 696e 206d 6f64 756c 652e 5f6d 6f64 756c  in module._modul
+00010f00: 6573 2e69 7465 6d73 2829 3a0d 0a20 2020  es.items():..   
+00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f20: 2069 6620 6368 696c 6420 6973 206e 6f74   if child is not
+00010f30: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00010f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f50: 6c6f 6164 2863 6869 6c64 2c20 7072 6566  load(child, pref
+00010f60: 6978 202b 206e 616d 6520 2b20 272e 2729  ix + name + '.')
+00010f70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00010f80: 6c6f 6164 2873 656c 6629 0d0a 2020 2020  load(self)..    
+00010f90: 2020 2020 2020 2020 6c6f 6164 203d 204e          load = N
+00010fa0: 6f6e 6520 2023 2062 7265 616b 206c 6f61  one  # break loa
+00010fb0: 642d 3e6c 6f61 6420 7265 6665 7265 6e63  d->load referenc
+00010fc0: 6520 6379 636c 650d 0a0d 0a20 2020 2020  e cycle....     
+00010fd0: 2020 2020 2020 2069 6620 7374 7269 6374         if strict
+00010fe0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00010ff0: 2020 2069 6620 6c65 6e28 756e 6578 7065     if len(unexpe
+00011000: 6374 6564 5f6b 6579 7329 203e 2030 3a0d  cted_keys) > 0:.
+00011010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011020: 2020 2020 2065 7272 6f72 5f6d 7367 732e       error_msgs.
+00011030: 696e 7365 7274 2830 2c20 2755 6e65 7870  insert(0, 'Unexp
+00011040: 6563 7465 6420 6b65 7928 7329 2069 6e20  ected key(s) in 
+00011050: 7374 6174 655f 6469 6374 3a20 7b7d 2e20  state_dict: {}. 
+00011060: 272e 666f 726d 6174 280d 0a20 2020 2020  '.format(..     
+00011070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011080: 2020 2027 2c20 272e 6a6f 696e 2827 227b     ', '.join('"{
+00011090: 7d22 272e 666f 726d 6174 286b 2920 666f  }"'.format(k) fo
+000110a0: 7220 6b20 696e 2075 6e65 7870 6563 7465  r k in unexpecte
+000110b0: 645f 6b65 7973 2929 290d 0a20 2020 2020  d_keys)))..     
+000110c0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000110d0: 6e28 6d69 7373 696e 675f 6b65 7973 2920  n(missing_keys) 
+000110e0: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+000110f0: 2020 2020 2020 2020 2020 6572 726f 725f            error_
+00011100: 6d73 6773 2e69 6e73 6572 7428 302c 2027  msgs.insert(0, '
+00011110: 4d69 7373 696e 6720 6b65 7928 7329 2069  Missing key(s) i
+00011120: 6e20 7374 6174 655f 6469 6374 3a20 7b7d  n state_dict: {}
+00011130: 2e20 272e 666f 726d 6174 280d 0a20 2020  . '.format(..   
+00011140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011150: 2020 2020 2027 2c20 272e 6a6f 696e 2827       ', '.join('
+00011160: 227b 7d22 272e 666f 726d 6174 286b 2920  "{}"'.format(k) 
+00011170: 666f 7220 6b20 696e 206d 6973 7369 6e67  for k in missing
+00011180: 5f6b 6579 7329 2929 0d0a 0d0a 2020 2020  _keys)))....    
+00011190: 2020 2020 2020 2020 2320 6966 206c 656e          # if len
+000111a0: 2865 7272 6f72 5f6d 7367 7329 203e 2030  (error_msgs) > 0
+000111b0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+000111c0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+000111d0: 6d65 4572 726f 7228 0d0a 2020 2020 2020  meError(..      
+000111e0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+000111f0: 2745 7272 6f72 2873 2920 696e 206c 6f61  'Error(s) in loa
+00011200: 6469 6e67 2073 7461 7465 5f64 6963 7420  ding state_dict 
+00011210: 666f 7220 7b7d 3a5c 6e5c 747b 7d27 2e66  for {}:\n\t{}'.f
+00011220: 6f72 6d61 7428 7365 6c66 2e5f 5f63 6c61  ormat(self.__cla
+00011230: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2022  ss__.__name__, "
+00011240: 5c6e 5c74 222e 6a6f 696e 2865 7272 6f72  \n\t".join(error
+00011250: 5f6d 7367 7329 2929 0d0a 2020 2020 2020  _msgs)))..      
+00011260: 2020 2020 2020 7265 7475 726e 205f 496e        return _In
+00011270: 636f 6d70 6174 6962 6c65 4b65 7973 286d  compatibleKeys(m
+00011280: 6973 7369 6e67 5f6b 6579 732c 2075 6e65  issing_keys, une
+00011290: 7870 6563 7465 645f 6b65 7973 290d 0a0d  xpected_keys)...
+000112a0: 0a20 2020 2064 6566 2073 6176 6528 7365  .    def save(se
+000112b0: 6c66 2c20 6669 6c65 5f70 6174 683d 2727  lf, file_path=''
+000112c0: 293a 0d0a 2020 2020 2020 2020 2320 7361  ):..        # sa
+000112d0: 7665 287b 2773 7461 7465 5f64 6963 7427  ve({'state_dict'
+000112e0: 3a20 7365 6c66 2e73 7461 7465 5f64 6963  : self.state_dic
+000112f0: 7428 297d 2c20 6669 6c65 5f70 6174 6829  t()}, file_path)
+00011300: 0d0a 2020 2020 2020 2020 7069 636b 6c65  ..        pickle
+00011310: 5f69 7428 6669 6c65 5f70 6174 682c 207b  _it(file_path, {
+00011320: 2773 7461 7465 5f64 6963 7427 3a20 7365  'state_dict': se
+00011330: 6c66 2e73 7461 7465 5f64 6963 7428 297d  lf.state_dict()}
+00011340: 290d 0a0d 0a20 2020 2064 6566 2073 6176  )....    def sav
+00011350: 655f 6f6e 6e78 2873 656c 662c 2066 696c  e_onnx(self, fil
+00011360: 655f 7061 7468 3d27 2729 3a0d 0a20 2020  e_path=''):..   
+00011370: 2020 2020 2070 6173 730d 0a0d 0a20 2020       pass....   
+00011380: 2064 6566 2073 6176 655f 7765 6967 6874   def save_weight
+00011390: 2873 656c 662c 2066 696c 655f 7061 7468  (self, file_path
+000113a0: 3d27 2729 3a0d 0a20 2020 2020 2020 2070  =''):..        p
+000113b0: 6173 730d 0a0d 0a20 2020 2023 2064 6566  ass....    # def
+000113c0: 2066 6f72 7761 7264 2873 656c 662c 202a   forward(self, *
+000113d0: 696e 7075 742c 202a 2a6b 7761 7267 7329  input, **kwargs)
+000113e0: 3a0d 0a20 2020 2023 2020 2020 2072 2222  :..    #     r""
+000113f0: 2244 6566 696e 6573 2074 6865 2063 6f6d  "Defines the com
+00011400: 7075 7461 7469 6f6e 2070 6572 666f 726d  putation perform
+00011410: 6564 2061 7420 6576 6572 7920 6361 6c6c  ed at every call
+00011420: 2e0d 0a20 2020 2023 0d0a 2020 2020 2320  ...    #..    # 
+00011430: 2020 2020 5368 6f75 6c64 2062 6520 6f76      Should be ov
+00011440: 6572 7269 6464 656e 2062 7920 616c 6c20  erridden by all 
+00011450: 7375 6263 6c61 7373 6573 2e0d 0a20 2020  subclasses...   
+00011460: 2023 0d0a 2020 2020 2320 2020 2020 2e2e   #..    #     ..
+00011470: 206e 6f74 653a 3a0d 0a20 2020 2023 2020   note::..    #  
+00011480: 2020 2020 2020 2041 6c74 686f 7567 6820         Although 
+00011490: 7468 6520 7265 6369 7065 2066 6f72 2066  the recipe for f
+000114a0: 6f72 7761 7264 2070 6173 7320 6e65 6564  orward pass need
+000114b0: 7320 746f 2062 6520 6465 6669 6e65 6420  s to be defined 
+000114c0: 7769 7468 696e 0d0a 2020 2020 2320 2020  within..    #   
+000114d0: 2020 2020 2020 7468 6973 2066 756e 6374        this funct
+000114e0: 696f 6e2c 206f 6e65 2073 686f 756c 6420  ion, one should 
+000114f0: 6361 6c6c 2074 6865 203a 636c 6173 733a  call the :class:
+00011500: 604d 6f64 756c 6560 2069 6e73 7461 6e63  `Module` instanc
+00011510: 6520 6166 7465 7277 6172 6473 0d0a 2020  e afterwards..  
+00011520: 2020 2320 2020 2020 2020 2020 696e 7374    #         inst
+00011530: 6561 6420 6f66 2074 6869 7320 7369 6e63  ead of this sinc
+00011540: 6520 7468 6520 666f 726d 6572 2074 616b  e the former tak
+00011550: 6573 2063 6172 6520 6f66 2072 756e 6e69  es care of runni
+00011560: 6e67 2074 6865 0d0a 2020 2020 2320 2020  ng the..    #   
+00011570: 2020 2020 2020 7265 6769 7374 6572 6564        registered
+00011580: 2068 6f6f 6b73 2077 6869 6c65 2074 6865   hooks while the
+00011590: 206c 6174 7465 7220 7369 6c65 6e74 6c79   latter silently
+000115a0: 2069 676e 6f72 6573 2074 6865 6d2e 0d0a   ignores them...
+000115b0: 2020 2020 2320 2020 2020 2222 220d 0a20      #     """.. 
+000115c0: 2020 2023 2020 2020 2072 6169 7365 204e     #     raise N
+000115d0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+000115e0: 6f72 0d0a 0d0a 2020 2020 6465 6620 5f73  or....    def _s
+000115f0: 6c6f 775f 666f 7277 6172 6428 7365 6c66  low_forward(self
+00011600: 2c20 2a69 6e70 7574 2c20 2a2a 6b77 6172  , *input, **kwar
+00011610: 6773 293a 0d0a 2020 2020 2020 2020 7265  gs):..        re
+00011620: 7475 726e 2073 656c 662e 5f63 616c 6c5f  turn self._call_
+00011630: 696d 706c 282a 696e 7075 742c 202a 2a6b  impl(*input, **k
+00011640: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
+00011650: 662e 4d6f 6475 6c65 2e77 6974 685f 6e61  f.Module.with_na
+00011660: 6d65 5f73 636f 7065 0d0a 2020 2020 6465  me_scope..    de
+00011670: 6620 5f63 616c 6c5f 696d 706c 2873 656c  f _call_impl(sel
+00011680: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+00011690: 6773 293a 0d0a 2020 2020 2020 2020 666f  gs):..        fo
+000116a0: 7277 6172 645f 6361 6c6c 203d 2073 656c  rward_call = sel
+000116b0: 662e 666f 7277 6172 640d 0a0d 0a20 2020  f.forward....   
+000116c0: 2020 2020 2069 735f 616c 6c5f 6e75 6d70       is_all_nump
+000116d0: 7920 3d20 4661 6c73 650d 0a20 2020 2020  y = False..     
+000116e0: 2020 2069 735f 6275 696c 7420 3d20 7365     is_built = se
+000116f0: 6c66 2e5f 6275 696c 740d 0a0d 0a20 2020  lf._built....   
+00011700: 2020 2020 2023 206f 6e6c 7920 646f 2069       # only do i
+00011710: 6e20 7468 6520 726f 6f74 0d0a 2020 2020  n the root..    
+00011720: 2020 2020 6966 2073 656c 662e 6973 5f72      if self.is_r
+00011730: 6f6f 743a 0d0a 0d0a 2020 2020 2020 2020  oot:....        
+00011740: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00011750: 6528 6172 6773 2c20 7475 706c 6529 3a0d  e(args, tuple):.
+00011760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011770: 2069 735f 616c 6c5f 6e75 6d70 7920 3d20   is_all_numpy = 
+00011780: 616c 6c28 5b69 7369 6e73 7461 6e63 6528  all([isinstance(
+00011790: 696e 702c 206e 702e 6e64 6172 7261 7929  inp, np.ndarray)
+000117a0: 2066 6f72 2069 6e70 2069 6e20 6172 6773   for inp in args
+000117b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+000117c0: 2020 2020 6172 6773 203d 2074 7570 6c65      args = tuple
+000117d0: 285b 746f 5f74 656e 736f 7228 696e 702c  ([to_tensor(inp,
+000117e0: 2064 6576 6963 653d 6765 745f 6465 7669   device=get_devi
+000117f0: 6365 2829 2920 666f 7220 696e 7020 696e  ce()) for inp in
+00011800: 2061 7267 735d 290d 0a20 2020 2020 2020   args])..       
+00011810: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00011820: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00011830: 7369 6e73 7461 6e63 6528 6172 6773 2c20  sinstance(args, 
+00011840: 6e70 2e6e 6461 7272 6179 293a 0d0a 2020  np.ndarray):..  
+00011850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011860: 2020 6973 5f61 6c6c 5f6e 756d 7079 203d    is_all_numpy =
+00011870: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00011880: 2020 2020 2020 2061 7267 7320 3d20 746f         args = to
+00011890: 5f74 656e 736f 7228 6172 6773 2c20 6465  _tensor(args, de
+000118a0: 7669 6365 3d67 6574 5f64 6576 6963 6528  vice=get_device(
+000118b0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+000118c0: 2020 2020 6172 6773 203d 2028 6172 6773      args = (args
+000118d0: 2c29 0d0a 0d0a 2020 2020 2020 2020 6966  ,)....        if
+000118e0: 206e 6f74 2073 656c 662e 5f62 7569 6c74   not self._built
+000118f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00011900: 6e70 203d 2075 6e70 6163 6b5f 7369 6e67  np = unpack_sing
+00011910: 6c65 746f 6e28 6172 6773 290d 0a20 2020  leton(args)..   
+00011920: 2020 2020 2020 2020 2069 6620 6973 5f74           if is_t
+00011930: 656e 736f 7228 696e 7029 3a0d 0a20 2020  ensor(inp):..   
+00011940: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+00011950: 203d 2074 656e 736f 725f 746f 5f73 6861   = tensor_to_sha
+00011960: 7065 2869 6e70 2c20 6e65 6564 5f65 7863  pe(inp, need_exc
+00011970: 6c75 6465 5f62 6174 6368 5f61 7869 733d  lude_batch_axis=
+00011980: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00011990: 2020 2020 2020 2073 656c 662e 696e 7075         self.inpu
+000119a0: 745f 7368 6170 6520 3d20 7368 700d 0a20  t_shape = shp.. 
+000119b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000119c0: 656c 662e 696e 7075 745f 6669 6c74 6572  elf.input_filter
+000119d0: 7320 3d20 7368 705b 7365 6c66 2e66 696c  s = shp[self.fil
+000119e0: 7465 725f 696e 6465 785d 0d0a 0d0a 2020  ter_index]....  
+000119f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011a00: 2073 656c 662e 6973 5f72 6f6f 743a 0d0a   self.is_root:..
+00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a20: 2020 2020 6966 2073 656c 662e 5f73 6967      if self._sig
+00011a30: 6e61 7475 7265 2069 7320 4e6f 6e65 3a0d  nature is None:.
+00011a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011a50: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00011a60: 6967 6e61 7475 7265 203d 2067 6574 5f73  ignature = get_s
+00011a70: 6967 6e61 7475 7265 2873 656c 6629 0d0a  ignature(self)..
+00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a90: 2020 2020 6966 2073 656c 662e 5f73 6967      if self._sig
+00011aa0: 6e61 7475 7265 2069 7320 6e6f 7420 4e6f  nature is not No
+00011ab0: 6e65 2061 6e64 206c 656e 2873 656c 662e  ne and len(self.
+00011ac0: 5f73 6967 6e61 7475 7265 2e69 6e70 7574  _signature.input
+00011ad0: 7329 203e 2030 3a0d 0a20 2020 2020 2020  s) > 0:..       
+00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011af0: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
+00011b00: 2e69 6e70 7574 735b 7365 6c66 2e5f 7369  .inputs[self._si
+00011b10: 676e 6174 7572 652e 696e 7075 7473 2e6b  gnature.inputs.k
+00011b20: 6579 5f6c 6973 745b 305d 5d2e 7368 6170  ey_list[0]].shap
+00011b30: 6520 3d20 7465 6e73 6f72 5f74 6f5f 7368  e = tensor_to_sh
+00011b40: 6170 6528 696e 702c 0d0a 2020 2020 2020  ape(inp,..      
+00011b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bd0: 2020 2020 2020 2020 6e65 6564 5f65 7863          need_exc
-00011be0: 6c75 6465 5f62 6174 6368 5f61 7869 733d  lude_batch_axis=
-00011bf0: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
+00011bb0: 2020 2020 206e 6565 645f 6578 636c 7564       need_exclud
+00011bc0: 655f 6261 7463 685f 6178 6973 3d54 7275  e_batch_axis=Tru
+00011bd0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00011be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c60: 2020 6973 5f73 696e 676c 6574 6f6e 3d46    is_singleton=F
-00011c70: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00011c80: 2020 2020 2020 2064 656c 2069 6e70 0d0a         del inp..
-00011c90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00011ca0: 2069 7369 6e73 7461 6e63 6528 696e 702c   isinstance(inp,
-00011cb0: 2028 7475 706c 652c 206c 6973 7429 293a   (tuple, list)):
-00011cc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011cd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00011ce0: 696e 705b 305d 2c20 6e75 6d62 6572 732e  inp[0], numbers.
-00011cf0: 4e75 6d62 6572 293a 0d0a 2020 2020 2020  Number):..      
-00011d00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00011d10: 6c66 2e69 6e70 7574 5f73 6861 7065 203d  lf.input_shape =
-00011d20: 2054 656e 736f 7253 6861 7065 286c 6973   TensorShape(lis
-00011d30: 7428 696e 7029 290d 0a20 2020 2020 2020  t(inp))..       
-00011d40: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00011d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d60: 2020 2020 6f75 7420 3d20 7365 6c66 2e66      out = self.f
-00011d70: 6f72 7761 7264 282a 696e 702c 202a 2a6b  orward(*inp, **k
-00011d80: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
-00011d90: 2020 2020 2020 2020 2020 2020 2320 7368              # sh
-00011da0: 7020 3d5b 2074 656e 736f 725f 746f 5f73  p =[ tensor_to_s
-00011db0: 6861 7065 2869 2c20 6e65 6564 5f65 7863  hape(i, need_exc
-00011dc0: 6c75 6465 5f62 6174 6368 5f61 7869 733d  lude_batch_axis=
-00011dd0: 5472 7565 2c69 735f 7369 6e67 6c65 746f  True,is_singleto
-00011de0: 6e3d 4661 6c73 6529 2066 6f72 2069 2069  n=False) for i i
-00011df0: 6e20 696e 705d 0d0a 2020 2020 2020 2020  n inp]..        
-00011e00: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-00011e10: 6c66 2e62 7569 6c64 282a 7368 7029 0d0a  lf.build(*shp)..
-00011e20: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00011e30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011e40: 2020 2073 656c 662e 696e 7075 745f 7368     self.input_sh
-00011e50: 6170 6520 3d20 5465 6e73 6f72 5368 6170  ape = TensorShap
-00011e60: 6528 6c69 7374 2869 6e70 2929 0d0a 2020  e(list(inp))..  
-00011e70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00011e80: 696e 7428 2769 6e70 7574 2073 686f 7520  int('input shou 
-00011e90: 6265 2074 656e 736f 7220 6f72 2074 7570  be tensor or tup
-00011ea0: 6c65 206f 6620 7465 6e73 6f72 2729 0d0a  le of tensor')..
-00011eb0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00011ec0: 6c66 2e5f 6275 696c 7420 3d20 5472 7565  lf._built = True
-00011ed0: 0d0a 0d0a 2020 2020 2020 2020 6966 206e  ....        if n
-00011ee0: 6f74 2028 7365 6c66 2e5f 6261 636b 7761  ot (self._backwa
-00011ef0: 7264 5f68 6f6f 6b73 206f 7220 7365 6c66  rd_hooks or self
-00011f00: 2e5f 6261 636b 7761 7264 5f70 7265 5f68  ._backward_pre_h
-00011f10: 6f6f 6b73 206f 7220 7365 6c66 2e5f 666f  ooks or self._fo
-00011f20: 7277 6172 645f 686f 6f6b 7320 6f72 2073  rward_hooks or s
-00011f30: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
-00011f40: 5f68 6f6f 6b73 0d0a 2020 2020 2020 2020  _hooks..        
-00011f50: 2020 2020 2020 2020 6f72 205f 676c 6f62          or _glob
-00011f60: 616c 5f62 6163 6b77 6172 645f 7072 655f  al_backward_pre_
-00011f70: 686f 6f6b 7320 6f72 205f 676c 6f62 616c  hooks or _global
-00011f80: 5f62 6163 6b77 6172 645f 686f 6f6b 730d  _backward_hooks.
-00011f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011fa0: 206f 7220 5f67 6c6f 6261 6c5f 666f 7277   or _global_forw
-00011fb0: 6172 645f 686f 6f6b 7320 6f72 205f 676c  ard_hooks or _gl
-00011fc0: 6f62 616c 5f66 6f72 7761 7264 5f70 7265  obal_forward_pre
-00011fd0: 5f68 6f6f 6b73 293a 0d0a 2020 2020 2020  _hooks):..      
-00011fe0: 2020 2020 2020 7265 7375 6c74 203d 2066        result = f
-00011ff0: 6f72 7761 7264 5f63 616c 6c28 2a61 7267  orward_call(*arg
-00012000: 732c 202a 2a6b 7761 7267 7329 0d0a 2020  s, **kwargs)..  
-00012010: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00012020: 203d 2075 6e70 6163 6b5f 7369 6e67 6c65   = unpack_single
-00012030: 746f 6e28 7265 7375 6c74 290d 0a0d 0a20  ton(result).... 
-00012040: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-00012050: 7361 7474 7228 7365 6c66 2c20 276b 6565  sattr(self, 'kee
-00012060: 705f 6f75 7470 7574 2729 2061 6e64 2073  p_output') and s
-00012070: 656c 662e 6b65 6570 5f6f 7574 7075 7420  elf.keep_output 
-00012080: 3d3d 2054 7275 653a 0d0a 2020 2020 2020  == True:..      
-00012090: 2020 2020 2020 2020 2020 2320 6d61 6b65            # make
-000120a0: 2061 206f 700d 0a20 2020 2020 2020 2020   a op..         
-000120b0: 2020 2020 2020 2073 656c 662e 5f6f 7574         self._out
-000120c0: 7075 745f 7465 6e73 6f72 203d 2072 6573  put_tensor = res
-000120d0: 756c 740d 0a20 2020 2020 2020 2020 2020  ult..           
-000120e0: 2069 6620 7365 6c66 2e5f 6f75 7470 7574   if self._output
-000120f0: 5f73 6861 7065 2069 7320 4e6f 6e65 206f  _shape is None o
-00012100: 7220 6973 5f62 7569 6c74 203d 3d20 4661  r is_built == Fa
-00012110: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00012120: 2020 2020 2020 6f75 7470 7574 203d 2072        output = r
-00012130: 6573 756c 740d 0a20 2020 2020 2020 2020  esult..         
-00012140: 2020 2020 2020 2069 6620 6973 5f74 656e         if is_ten
-00012150: 736f 7228 6f75 7470 7574 293a 2020 2320  sor(output):  # 
-00012160: 6f6e 6520 6f75 7470 7574 0d0a 2020 2020  one output..    
-00012170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012180: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
-00012190: 7065 203d 2074 656e 736f 725f 746f 5f73  pe = tensor_to_s
-000121a0: 6861 7065 286f 7574 7075 7429 0d0a 2020  hape(output)..  
-000121b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000121c0: 6966 2069 7369 6e73 7461 6e63 6528 6f75  if isinstance(ou
-000121d0: 7470 7574 2c20 286c 6973 742c 2074 7570  tput, (list, tup
-000121e0: 6c65 2929 3a0d 0a20 2020 2020 2020 2020  le)):..         
-000121f0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00012200: 745f 7368 6170 6520 3d20 7475 706c 6528  t_shape = tuple(
-00012210: 5b74 656e 736f 725f 746f 5f73 6861 7065  [tensor_to_shape
-00012220: 2869 7465 6d29 2066 6f72 2069 7465 6d20  (item) for item 
-00012230: 696e 206f 7574 7075 7420 6966 0d0a 2020  in output if..  
-00012240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2020 2020 2020 2020 6974 656d 2069 7320          item is 
-00012270: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
-00012280: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-00012290: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-000122a0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000122b0: 2020 2020 2020 2020 2320 6966 206e 6f74          # if not
-000122c0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-000122d0: 2c20 286c 6973 742c 7475 706c 6529 2920  , (list,tuple)) 
-000122e0: 6c73 746d 0d0a 2020 2020 2020 2020 2020  lstm..          
-000122f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00012300: 6f75 7470 7574 5f73 6861 7065 203d 2075  output_shape = u
-00012310: 6e70 6163 6b5f 7369 6e67 6c65 746f 6e28  npack_singleton(
-00012320: 6f75 7470 7574 5f73 6861 7065 290d 0a20  output_shape).. 
-00012330: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00012340: 5f61 6c6c 5f6e 756d 7079 203d 3d20 5472  _all_numpy == Tr
-00012350: 7565 2061 6e64 2073 656c 662e 7472 6169  ue and self.trai
-00012360: 6e69 6e67 203d 3d20 4661 6c73 6520 616e  ning == False an
-00012370: 6420 7365 6c66 2e69 735f 726f 6f74 203d  d self.is_root =
-00012380: 3d20 5472 7565 3a0d 0a20 2020 2020 2020  = True:..       
-00012390: 2020 2020 2020 2020 2069 6620 6973 5f74           if is_t
-000123a0: 656e 736f 7228 7265 7375 6c74 293a 0d0a  ensor(result):..
-000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123c0: 2020 2020 7265 7475 726e 2074 6f5f 6e75      return to_nu
-000123d0: 6d70 7928 7265 7375 6c74 290d 0a20 2020  mpy(result)..   
-000123e0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000123f0: 6620 6973 696e 7374 616e 6365 2872 6573  f isinstance(res
-00012400: 756c 742c 2028 6c69 7374 2c20 7475 706c  ult, (list, tupl
-00012410: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-00012420: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00012430: 203d 206c 6973 7428 7265 7375 6c74 290d   = list(result).
-00012440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012450: 2020 2020 2072 6574 7572 6e20 7475 706c       return tupl
-00012460: 6528 5b74 6f5f 6e75 6d70 7928 7265 7329  e([to_numpy(res)
-00012470: 2069 6620 6973 5f74 656e 736f 7228 7265   if is_tensor(re
-00012480: 7329 2065 6c73 6520 7265 7320 666f 7220  s) else res for 
-00012490: 7265 7320 696e 2072 6573 756c 745d 290d  res in result]).
-000124a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000124b0: 7572 6e20 7265 7375 6c74 0d0a 0d0a 2020  urn result....  
-000124c0: 2020 2020 2020 6675 6c6c 5f62 6163 6b77        full_backw
-000124d0: 6172 645f 686f 6f6b 732c 206e 6f6e 5f66  ard_hooks, non_f
-000124e0: 756c 6c5f 6261 636b 7761 7264 5f68 6f6f  ull_backward_hoo
-000124f0: 6b73 203d 205b 5d2c 205b 5d0d 0a20 2020  ks = [], []..   
-00012500: 2020 2020 2062 6163 6b77 6172 645f 7072       backward_pr
-00012510: 655f 686f 6f6b 7320 3d20 5b5d 0d0a 2020  e_hooks = []..  
-00012520: 2020 2020 2020 6966 2073 656c 662e 5f62        if self._b
-00012530: 6163 6b77 6172 645f 7072 655f 686f 6f6b  ackward_pre_hook
-00012540: 7320 6f72 205f 676c 6f62 616c 5f62 6163  s or _global_bac
-00012550: 6b77 6172 645f 7072 655f 686f 6f6b 733a  kward_pre_hooks:
-00012560: 0d0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
-00012570: 636b 7761 7264 5f70 7265 5f68 6f6f 6b73  ckward_pre_hooks
-00012580: 203d 2073 656c 662e 5f67 6574 5f62 6163   = self._get_bac
-00012590: 6b77 6172 645f 7072 655f 686f 6f6b 7328  kward_pre_hooks(
-000125a0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-000125b0: 7365 6c66 2e5f 6261 636b 7761 7264 5f68  self._backward_h
-000125c0: 6f6f 6b73 206f 7220 5f67 6c6f 6261 6c5f  ooks or _global_
-000125d0: 6261 636b 7761 7264 5f68 6f6f 6b73 3a0d  backward_hooks:.
-000125e0: 0a20 2020 2020 2020 2020 2020 2066 756c  .            ful
-000125f0: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b73  l_backward_hooks
-00012600: 2c20 6e6f 6e5f 6675 6c6c 5f62 6163 6b77  , non_full_backw
-00012610: 6172 645f 686f 6f6b 7320 3d20 7365 6c66  ard_hooks = self
-00012620: 2e5f 6765 745f 6261 636b 7761 7264 5f68  ._get_backward_h
-00012630: 6f6f 6b73 2829 0d0a 0d0a 2020 2020 2020  ooks()....      
-00012640: 2020 6966 205f 676c 6f62 616c 5f66 6f72    if _global_for
-00012650: 7761 7264 5f70 7265 5f68 6f6f 6b73 206f  ward_pre_hooks o
-00012660: 7220 7365 6c66 2e5f 666f 7277 6172 645f  r self._forward_
-00012670: 7072 655f 686f 6f6b 733a 0d0a 2020 2020  pre_hooks:..    
-00012680: 2020 2020 2020 2020 666f 7220 686f 6f6b          for hook
-00012690: 5f69 642c 2068 6f6f 6b20 696e 2028 0d0a  _id, hook in (..
-000126a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126b0: 2020 2020 2a5f 676c 6f62 616c 5f66 6f72      *_global_for
-000126c0: 7761 7264 5f70 7265 5f68 6f6f 6b73 2e69  ward_pre_hooks.i
-000126d0: 7465 6d73 2829 2c0d 0a20 2020 2020 2020  tems(),..       
-000126e0: 2020 2020 2020 2020 2020 2020 202a 7365               *se
-000126f0: 6c66 2e5f 666f 7277 6172 645f 7072 655f  lf._forward_pre_
-00012700: 686f 6f6b 732e 6974 656d 7328 292c 0d0a  hooks.items(),..
-00012710: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
-00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012730: 6966 2068 6f6f 6b5f 6964 2069 6e20 7365  if hook_id in se
-00012740: 6c66 2e5f 666f 7277 6172 645f 7072 655f  lf._forward_pre_
-00012750: 686f 6f6b 735f 7769 7468 5f6b 7761 7267  hooks_with_kwarg
-00012760: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00012770: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00012780: 2068 6f6f 6b28 7365 6c66 2c20 6172 6773   hook(self, args
-00012790: 2c20 6b77 6172 6773 2920 2023 2074 7970  , kwargs)  # typ
-000127a0: 653a 2069 676e 6f72 655b 6d69 7363 5d0d  e: ignore[misc].
-000127b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000127c0: 2020 2020 2069 6620 7265 7375 6c74 2069       if result i
-000127d0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127f0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00012800: 6365 2872 6573 756c 742c 2074 7570 6c65  ce(result, tuple
-00012810: 2920 616e 6420 6c65 6e28 7265 7375 6c74  ) and len(result
-00012820: 2920 3d3d 2032 3a0d 0a20 2020 2020 2020  ) == 2:..       
-00012830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012840: 2020 2020 2061 7267 732c 206b 7761 7267       args, kwarg
-00012850: 7320 3d20 7265 7375 6c74 0d0a 2020 2020  s = result..    
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011c40: 735f 7369 6e67 6c65 746f 6e3d 4661 6c73  s_singleton=Fals
+00011c50: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00011c60: 2020 2020 6465 6c20 696e 700d 0a20 2020      del inp..   
+00011c70: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00011c80: 696e 7374 616e 6365 2869 6e70 2c20 2874  instance(inp, (t
+00011c90: 7570 6c65 2c20 6c69 7374 2929 3a0d 0a20  uple, list)):.. 
+00011ca0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011cb0: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
+00011cc0: 5b30 5d2c 206e 756d 6265 7273 2e4e 756d  [0], numbers.Num
+00011cd0: 6265 7229 3a0d 0a20 2020 2020 2020 2020  ber):..         
+00011ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011cf0: 696e 7075 745f 7368 6170 6520 3d20 5465  input_shape = Te
+00011d00: 6e73 6f72 5368 6170 6528 6c69 7374 2869  nsorShape(list(i
+00011d10: 6e70 2929 0d0a 2020 2020 2020 2020 2020  np))..          
+00011d20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00011d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d40: 206f 7574 203d 2073 656c 662e 666f 7277   out = self.forw
+00011d50: 6172 6428 2a69 6e70 2c20 2a2a 6b77 6172  ard(*inp, **kwar
+00011d60: 6773 290d 0a20 2020 2020 2020 2020 2020  gs)..           
+00011d70: 2020 2020 2020 2020 2023 2073 6870 203d           # shp =
+00011d80: 5b20 7465 6e73 6f72 5f74 6f5f 7368 6170  [ tensor_to_shap
+00011d90: 6528 692c 206e 6565 645f 6578 636c 7564  e(i, need_exclud
+00011da0: 655f 6261 7463 685f 6178 6973 3d54 7275  e_batch_axis=Tru
+00011db0: 652c 6973 5f73 696e 676c 6574 6f6e 3d46  e,is_singleton=F
+00011dc0: 616c 7365 2920 666f 7220 6920 696e 2069  alse) for i in i
+00011dd0: 6e70 5d0d 0a20 2020 2020 2020 2020 2020  np]..           
+00011de0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+00011df0: 6275 696c 6428 2a73 6870 290d 0a20 2020  build(*shp)..   
+00011e00: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00011e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e20: 7365 6c66 2e69 6e70 7574 5f73 6861 7065  self.input_shape
+00011e30: 203d 2054 656e 736f 7253 6861 7065 286c   = TensorShape(l
+00011e40: 6973 7428 696e 7029 290d 0a20 2020 2020  ist(inp))..     
+00011e50: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00011e60: 2827 696e 7075 7420 7368 6f75 2062 6520  ('input shou be 
+00011e70: 7465 6e73 6f72 206f 7220 7475 706c 6520  tensor or tuple 
+00011e80: 6f66 2074 656e 736f 7227 290d 0a0d 0a20  of tensor').... 
+00011e90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011ea0: 5f62 7569 6c74 203d 2054 7275 650d 0a0d  _built = True...
+00011eb0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00011ec0: 2873 656c 662e 5f62 6163 6b77 6172 645f  (self._backward_
+00011ed0: 686f 6f6b 7320 6f72 2073 656c 662e 5f62  hooks or self._b
+00011ee0: 6163 6b77 6172 645f 7072 655f 686f 6f6b  ackward_pre_hook
+00011ef0: 7320 6f72 2073 656c 662e 5f66 6f72 7761  s or self._forwa
+00011f00: 7264 5f68 6f6f 6b73 206f 7220 7365 6c66  rd_hooks or self
+00011f10: 2e5f 666f 7277 6172 645f 7072 655f 686f  ._forward_pre_ho
+00011f20: 6f6b 730d 0a20 2020 2020 2020 2020 2020  oks..           
+00011f30: 2020 2020 206f 7220 5f67 6c6f 6261 6c5f       or _global_
+00011f40: 6261 636b 7761 7264 5f70 7265 5f68 6f6f  backward_pre_hoo
+00011f50: 6b73 206f 7220 5f67 6c6f 6261 6c5f 6261  ks or _global_ba
+00011f60: 636b 7761 7264 5f68 6f6f 6b73 0d0a 2020  ckward_hooks..  
+00011f70: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00011f80: 205f 676c 6f62 616c 5f66 6f72 7761 7264   _global_forward
+00011f90: 5f68 6f6f 6b73 206f 7220 5f67 6c6f 6261  _hooks or _globa
+00011fa0: 6c5f 666f 7277 6172 645f 7072 655f 686f  l_forward_pre_ho
+00011fb0: 6f6b 7329 3a0d 0a20 2020 2020 2020 2020  oks):..         
+00011fc0: 2020 2072 6573 756c 7420 3d20 666f 7277     result = forw
+00011fd0: 6172 645f 6361 6c6c 282a 6172 6773 2c20  ard_call(*args, 
+00011fe0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00011ff0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00012000: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
+00012010: 2872 6573 756c 7429 0d0a 0d0a 2020 2020  (result)....    
+00012020: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00012030: 7472 2873 656c 662c 2027 6b65 6570 5f6f  tr(self, 'keep_o
+00012040: 7574 7075 7427 2920 616e 6420 7365 6c66  utput') and self
+00012050: 2e6b 6565 705f 6f75 7470 7574 203d 3d20  .keep_output == 
+00012060: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
+00012070: 2020 2020 2020 2023 206d 616b 6520 6120         # make a 
+00012080: 6f70 0d0a 2020 2020 2020 2020 2020 2020  op..            
+00012090: 2020 2020 7365 6c66 2e5f 6f75 7470 7574      self._output
+000120a0: 5f74 656e 736f 7220 3d20 7265 7375 6c74  _tensor = result
+000120b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000120c0: 2073 656c 662e 5f6f 7574 7075 745f 7368   self._output_sh
+000120d0: 6170 6520 6973 204e 6f6e 6520 6f72 2069  ape is None or i
+000120e0: 735f 6275 696c 7420 3d3d 2046 616c 7365  s_built == False
+000120f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012100: 2020 206f 7574 7075 7420 3d20 7265 7375     output = resu
+00012110: 6c74 0d0a 2020 2020 2020 2020 2020 2020  lt..            
+00012120: 2020 2020 6966 2069 735f 7465 6e73 6f72      if is_tensor
+00012130: 286f 7574 7075 7429 3a20 2023 206f 6e65  (output):  # one
+00012140: 206f 7574 7075 740d 0a20 2020 2020 2020   output..       
+00012150: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012160: 662e 5f6f 7574 7075 745f 7368 6170 6520  f._output_shape 
+00012170: 3d20 7465 6e73 6f72 5f74 6f5f 7368 6170  = tensor_to_shap
+00012180: 6528 6f75 7470 7574 290d 0a20 2020 2020  e(output)..     
+00012190: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000121a0: 6973 696e 7374 616e 6365 286f 7574 7075  isinstance(outpu
+000121b0: 742c 2028 6c69 7374 2c20 7475 706c 6529  t, (list, tuple)
+000121c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000121d0: 2020 2020 2020 2020 6f75 7470 7574 5f73          output_s
+000121e0: 6861 7065 203d 2074 7570 6c65 285b 7465  hape = tuple([te
+000121f0: 6e73 6f72 5f74 6f5f 7368 6170 6528 6974  nsor_to_shape(it
+00012200: 656d 2920 666f 7220 6974 656d 2069 6e20  em) for item in 
+00012210: 6f75 7470 7574 2069 660d 0a20 2020 2020  output if..     
+00012220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012240: 2020 2020 2069 7465 6d20 6973 206e 6f74       item is not
+00012250: 204e 6f6e 6520 616e 6420 6e6f 7420 6973   None and not is
+00012260: 696e 7374 616e 6365 2869 7465 6d2c 2028  instance(item, (
+00012270: 6c69 7374 2c20 7475 706c 6529 295d 290d  list, tuple))]).
+00012280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012290: 2020 2020 2023 2069 6620 6e6f 7420 6973       # if not is
+000122a0: 696e 7374 616e 6365 2869 7465 6d2c 2028  instance(item, (
+000122b0: 6c69 7374 2c74 7570 6c65 2929 206c 7374  list,tuple)) lst
+000122c0: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
+000122d0: 2020 2020 2020 2073 656c 662e 5f6f 7574         self._out
+000122e0: 7075 745f 7368 6170 6520 3d20 756e 7061  put_shape = unpa
+000122f0: 636b 5f73 696e 676c 6574 6f6e 286f 7574  ck_singleton(out
+00012300: 7075 745f 7368 6170 6529 0d0a 2020 2020  put_shape)..    
+00012310: 2020 2020 2020 2020 6966 2069 735f 616c          if is_al
+00012320: 6c5f 6e75 6d70 7920 3d3d 2054 7275 6520  l_numpy == True 
+00012330: 616e 6420 7365 6c66 2e74 7261 696e 696e  and self.trainin
+00012340: 6720 3d3d 2046 616c 7365 2061 6e64 2073  g == False and s
+00012350: 656c 662e 6973 5f72 6f6f 7420 3d3d 2054  elf.is_root == T
+00012360: 7275 653a 0d0a 2020 2020 2020 2020 2020  rue:..          
+00012370: 2020 2020 2020 6966 2069 735f 7465 6e73        if is_tens
+00012380: 6f72 2872 6573 756c 7429 3a0d 0a20 2020  or(result):..   
+00012390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123a0: 2072 6574 7572 6e20 746f 5f6e 756d 7079   return to_numpy
+000123b0: 2872 6573 756c 7429 0d0a 2020 2020 2020  (result)..      
+000123c0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+000123d0: 7369 6e73 7461 6e63 6528 7265 7375 6c74  sinstance(result
+000123e0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+000123f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012400: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00012410: 6c69 7374 2872 6573 756c 7429 0d0a 2020  list(result)..  
+00012420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012430: 2020 7265 7475 726e 2074 7570 6c65 285b    return tuple([
+00012440: 746f 5f6e 756d 7079 2872 6573 2920 6966  to_numpy(res) if
+00012450: 2069 735f 7465 6e73 6f72 2872 6573 2920   is_tensor(res) 
+00012460: 656c 7365 2072 6573 2066 6f72 2072 6573  else res for res
+00012470: 2069 6e20 7265 7375 6c74 5d29 0d0a 2020   in result])..  
+00012480: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012490: 2072 6573 756c 740d 0a0d 0a20 2020 2020   result....     
+000124a0: 2020 2066 756c 6c5f 6261 636b 7761 7264     full_backward
+000124b0: 5f68 6f6f 6b73 2c20 6e6f 6e5f 6675 6c6c  _hooks, non_full
+000124c0: 5f62 6163 6b77 6172 645f 686f 6f6b 7320  _backward_hooks 
+000124d0: 3d20 5b5d 2c20 5b5d 0d0a 2020 2020 2020  = [], []..      
+000124e0: 2020 6261 636b 7761 7264 5f70 7265 5f68    backward_pre_h
+000124f0: 6f6f 6b73 203d 205b 5d0d 0a20 2020 2020  ooks = []..     
+00012500: 2020 2069 6620 7365 6c66 2e5f 6261 636b     if self._back
+00012510: 7761 7264 5f70 7265 5f68 6f6f 6b73 206f  ward_pre_hooks o
+00012520: 7220 5f67 6c6f 6261 6c5f 6261 636b 7761  r _global_backwa
+00012530: 7264 5f70 7265 5f68 6f6f 6b73 3a0d 0a20  rd_pre_hooks:.. 
+00012540: 2020 2020 2020 2020 2020 2062 6163 6b77             backw
+00012550: 6172 645f 7072 655f 686f 6f6b 7320 3d20  ard_pre_hooks = 
+00012560: 7365 6c66 2e5f 6765 745f 6261 636b 7761  self._get_backwa
+00012570: 7264 5f70 7265 5f68 6f6f 6b73 2829 0d0a  rd_pre_hooks()..
+00012580: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00012590: 662e 5f62 6163 6b77 6172 645f 686f 6f6b  f._backward_hook
+000125a0: 7320 6f72 205f 676c 6f62 616c 5f62 6163  s or _global_bac
+000125b0: 6b77 6172 645f 686f 6f6b 733a 0d0a 2020  kward_hooks:..  
+000125c0: 2020 2020 2020 2020 2020 6675 6c6c 5f62            full_b
+000125d0: 6163 6b77 6172 645f 686f 6f6b 732c 206e  ackward_hooks, n
+000125e0: 6f6e 5f66 756c 6c5f 6261 636b 7761 7264  on_full_backward
+000125f0: 5f68 6f6f 6b73 203d 2073 656c 662e 5f67  _hooks = self._g
+00012600: 6574 5f62 6163 6b77 6172 645f 686f 6f6b  et_backward_hook
+00012610: 7328 290d 0a0d 0a20 2020 2020 2020 2069  s()....        i
+00012620: 6620 5f67 6c6f 6261 6c5f 666f 7277 6172  f _global_forwar
+00012630: 645f 7072 655f 686f 6f6b 7320 6f72 2073  d_pre_hooks or s
+00012640: 656c 662e 5f66 6f72 7761 7264 5f70 7265  elf._forward_pre
+00012650: 5f68 6f6f 6b73 3a0d 0a20 2020 2020 2020  _hooks:..       
+00012660: 2020 2020 2066 6f72 2068 6f6f 6b5f 6964       for hook_id
+00012670: 2c20 686f 6f6b 2069 6e20 280d 0a20 2020  , hook in (..   
+00012680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012690: 202a 5f67 6c6f 6261 6c5f 666f 7277 6172   *_global_forwar
+000126a0: 645f 7072 655f 686f 6f6b 732e 6974 656d  d_pre_hooks.item
+000126b0: 7328 292c 0d0a 2020 2020 2020 2020 2020  s(),..          
+000126c0: 2020 2020 2020 2020 2020 2a73 656c 662e            *self.
+000126d0: 5f66 6f72 7761 7264 5f70 7265 5f68 6f6f  _forward_pre_hoo
+000126e0: 6b73 2e69 7465 6d73 2829 2c0d 0a20 2020  ks.items(),..   
+000126f0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+00012700: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00012710: 686f 6f6b 5f69 6420 696e 2073 656c 662e  hook_id in self.
+00012720: 5f66 6f72 7761 7264 5f70 7265 5f68 6f6f  _forward_pre_hoo
+00012730: 6b73 5f77 6974 685f 6b77 6172 6773 3a0d  ks_with_kwargs:.
+00012740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012750: 2020 2020 2072 6573 756c 7420 3d20 686f       result = ho
+00012760: 6f6b 2873 656c 662c 2061 7267 732c 206b  ok(self, args, k
+00012770: 7761 7267 7329 2020 2320 7479 7065 3a20  wargs)  # type: 
+00012780: 6967 6e6f 7265 5b6d 6973 635d 0d0a 2020  ignore[misc]..  
+00012790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127a0: 2020 6966 2072 6573 756c 7420 6973 206e    if result is n
+000127b0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+000127c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000127e0: 7265 7375 6c74 2c20 7475 706c 6529 2061  result, tuple) a
+000127f0: 6e64 206c 656e 2872 6573 756c 7429 203d  nd len(result) =
+00012800: 3d20 323a 0d0a 2020 2020 2020 2020 2020  = 2:..          
+00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012820: 2020 6172 6773 2c20 6b77 6172 6773 203d    args, kwargs =
+00012830: 2072 6573 756c 740d 0a20 2020 2020 2020   result..       
+00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012850: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
 00012860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012870: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00012880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012890: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-000128a0: 7469 6d65 4572 726f 7228 0d0a 2020 2020  timeError(..    
-000128b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128c0: 2020 2020 2020 2020 2020 2020 2266 6f72              "for
-000128d0: 7761 7264 2070 7265 2d68 6f6f 6b20 6d75  ward pre-hook mu
-000128e0: 7374 2072 6574 7572 6e20 4e6f 6e65 206f  st return None o
-000128f0: 7220 6120 7475 706c 6520 220d 0a20 2020  r a tuple "..   
-00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012910: 2020 2020 2020 2020 2020 2020 2066 226f               f"o
-00012920: 6620 286e 6577 5f61 7267 732c 206e 6577  f (new_args, new
-00012930: 5f6b 7761 7267 7329 2c20 6275 7420 676f  _kwargs), but go
-00012940: 7420 7b72 6573 756c 747d 2e22 0d0a 2020  t {result}."..  
-00012950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012960: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00012970: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00012980: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00012990: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-000129a0: 2068 6f6f 6b28 7365 6c66 2c20 6172 6773   hook(self, args
-000129b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000129c0: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
-000129d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129f0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00012a00: 696e 7374 616e 6365 2872 6573 756c 742c  instance(result,
-00012a10: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
-00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a30: 2020 2020 2020 7265 7375 6c74 203d 2028        result = (
-00012a40: 7265 7375 6c74 2c29 0d0a 2020 2020 2020  result,)..      
-00012a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a60: 2020 6172 6773 203d 2072 6573 756c 740d    args = result.
-00012a70: 0a0d 0a20 2020 2020 2020 2023 2062 775f  ...        # bw_
-00012a80: 686f 6f6b 203d 204e 6f6e 650d 0a20 2020  hook = None..   
-00012a90: 2020 2020 2023 2069 6620 6675 6c6c 5f62       # if full_b
-00012aa0: 6163 6b77 6172 645f 686f 6f6b 733a 0d0a  ackward_hooks:..
-00012ab0: 2020 2020 2020 2020 2320 2020 2020 6277          #     bw
-00012ac0: 5f68 6f6f 6b20 3d20 686f 6f6b 732e 4261  _hook = hooks.Ba
-00012ad0: 636b 7761 7264 486f 6f6b 2873 656c 662c  ckwardHook(self,
-00012ae0: 2066 756c 6c5f 6261 636b 7761 7264 5f68   full_backward_h
-00012af0: 6f6f 6b73 290d 0a20 2020 2020 2020 2023  ooks)..        #
-00012b00: 2020 2020 2069 6e70 7574 203d 2066 756c       input = ful
-00012b10: 6c5f 6261 636b 7761 7264 5f68 6f6f 6b73  l_backward_hooks
-00012b20: 2869 6e70 7574 290d 0a0d 0a20 2020 2020  (input)....     
-00012b30: 2020 2023 2064 6f6e 2774 2075 7365 2072     # don't use r
-00012b40: 6573 756c 7420 3d20 7365 6c66 2e66 6f72  esult = self.for
-00012b50: 7761 7264 2869 2a6e 7075 742c 202a 2a6b  ward(i*nput, **k
-00012b60: 7761 7267 7329 2062 6563 6175 7365 2045  wargs) because E
-00012b70: 6167 6572 5465 6e73 6f72 2077 696c 6c20  agerTensor will 
-00012b80: 7370 6c69 7465 6420 6173 2061 2074 7570  splited as a tup
-00012b90: 6c65 2e2e 2e2e 0d0a 2020 2020 2020 2020  le......        
-00012ba0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00012bb0: 2020 7769 7468 2074 662e 6465 7669 6365    with tf.device
-00012bc0: 2867 6574 5f64 6576 6963 6528 2929 3a0d  (get_device()):.
-00012bd0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00012be0: 2020 2072 6573 756c 7420 3d20 666f 7277     result = forw
-00012bf0: 6172 645f 6361 6c6c 282a 6172 6773 2c20  ard_call(*args, 
-00012c00: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
-00012c10: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00012c20: 7420 3d20 756e 7061 636b 5f73 696e 676c  t = unpack_singl
-00012c30: 6574 6f6e 2872 6573 756c 7429 0d0a 0d0a  eton(result)....
-00012c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c50: 6966 2068 6173 6174 7472 2873 656c 662c  if hasattr(self,
-00012c60: 2027 6b65 6570 5f6f 7574 7075 7427 2920   'keep_output') 
-00012c70: 616e 6420 7365 6c66 2e6b 6565 705f 6f75  and self.keep_ou
-00012c80: 7470 7574 203d 3d20 5472 7565 3a0d 0a20  tput == True:.. 
+00012870: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+00012880: 6545 7272 6f72 280d 0a20 2020 2020 2020  eError(..       
+00012890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128a0: 2020 2020 2020 2020 2022 666f 7277 6172           "forwar
+000128b0: 6420 7072 652d 686f 6f6b 206d 7573 7420  d pre-hook must 
+000128c0: 7265 7475 726e 204e 6f6e 6520 6f72 2061  return None or a
+000128d0: 2074 7570 6c65 2022 0d0a 2020 2020 2020   tuple "..      
+000128e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128f0: 2020 2020 2020 2020 2020 6622 6f66 2028            f"of (
+00012900: 6e65 775f 6172 6773 2c20 6e65 775f 6b77  new_args, new_kw
+00012910: 6172 6773 292c 2062 7574 2067 6f74 207b  args), but got {
+00012920: 7265 7375 6c74 7d2e 220d 0a20 2020 2020  result}."..     
+00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012940: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00012950: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00012960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012970: 2020 2020 2072 6573 756c 7420 3d20 686f       result = ho
+00012980: 6f6b 2873 656c 662c 2061 7267 7329 0d0a  ok(self, args)..
+00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129a0: 2020 2020 6966 2072 6573 756c 7420 6973      if result is
+000129b0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+000129c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129d0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+000129e0: 7461 6e63 6528 7265 7375 6c74 2c20 7475  tance(result, tu
+000129f0: 706c 6529 3a0d 0a20 2020 2020 2020 2020  ple):..         
+00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a10: 2020 2072 6573 756c 7420 3d20 2872 6573     result = (res
+00012a20: 756c 742c 290d 0a20 2020 2020 2020 2020  ult,)..         
+00012a30: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00012a40: 7267 7320 3d20 7265 7375 6c74 0d0a 0d0a  rgs = result....
+00012a50: 2020 2020 2020 2020 2320 6277 5f68 6f6f          # bw_hoo
+00012a60: 6b20 3d20 4e6f 6e65 0d0a 2020 2020 2020  k = None..      
+00012a70: 2020 2320 6966 2066 756c 6c5f 6261 636b    # if full_back
+00012a80: 7761 7264 5f68 6f6f 6b73 3a0d 0a20 2020  ward_hooks:..   
+00012a90: 2020 2020 2023 2020 2020 2062 775f 686f       #     bw_ho
+00012aa0: 6f6b 203d 2068 6f6f 6b73 2e42 6163 6b77  ok = hooks.Backw
+00012ab0: 6172 6448 6f6f 6b28 7365 6c66 2c20 6675  ardHook(self, fu
+00012ac0: 6c6c 5f62 6163 6b77 6172 645f 686f 6f6b  ll_backward_hook
+00012ad0: 7329 0d0a 2020 2020 2020 2020 2320 2020  s)..        #   
+00012ae0: 2020 696e 7075 7420 3d20 6675 6c6c 5f62    input = full_b
+00012af0: 6163 6b77 6172 645f 686f 6f6b 7328 696e  ackward_hooks(in
+00012b00: 7075 7429 0d0a 0d0a 2020 2020 2020 2020  put)....        
+00012b10: 2320 646f 6e27 7420 7573 6520 7265 7375  # don't use resu
+00012b20: 6c74 203d 2073 656c 662e 666f 7277 6172  lt = self.forwar
+00012b30: 6428 692a 6e70 7574 2c20 2a2a 6b77 6172  d(i*nput, **kwar
+00012b40: 6773 2920 6265 6361 7573 6520 4561 6765  gs) because Eage
+00012b50: 7254 656e 736f 7220 7769 6c6c 2073 706c  rTensor will spl
+00012b60: 6974 6564 2061 7320 6120 7475 706c 652e  ited as a tuple.
+00012b70: 2e2e 2e0d 0a20 2020 2020 2020 2074 7279  .....        try
+00012b80: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
+00012b90: 6974 6820 7466 2e64 6576 6963 6528 6765  ith tf.device(ge
+00012ba0: 745f 6465 7669 6365 2829 293a 0d0a 0d0a  t_device()):....
+00012bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bc0: 7265 7375 6c74 203d 2066 6f72 7761 7264  result = forward
+00012bd0: 5f63 616c 6c28 2a61 7267 732c 202a 2a6b  _call(*args, **k
+00012be0: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
+00012bf0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00012c00: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+00012c10: 6e28 7265 7375 6c74 290d 0a0d 0a20 2020  n(result)....   
+00012c20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00012c30: 6861 7361 7474 7228 7365 6c66 2c20 276b  hasattr(self, 'k
+00012c40: 6565 705f 6f75 7470 7574 2729 2061 6e64  eep_output') and
+00012c50: 2073 656c 662e 6b65 6570 5f6f 7574 7075   self.keep_outpu
+00012c60: 7420 3d3d 2054 7275 653a 0d0a 2020 2020  t == True:..    
+00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c80: 2320 6d61 6b65 2061 206f 700d 0a20 2020  # make a op..   
 00012c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ca0: 2020 2023 206d 616b 6520 6120 6f70 0d0a     # make a op..
-00012cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cc0: 2020 2020 7365 6c66 2e5f 6f75 7470 7574      self._output
-00012cd0: 5f74 656e 736f 7220 3d20 7265 7375 6c74  _tensor = result
-00012ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012cf0: 2020 6966 2073 656c 662e 5f6f 7574 7075    if self._outpu
-00012d00: 745f 7368 6170 6520 6973 204e 6f6e 6520  t_shape is None 
-00012d10: 6f72 2069 735f 6275 696c 7420 3d3d 2046  or is_built == F
-00012d20: 616c 7365 3a0d 0a20 2020 2020 2020 2020  alse:..         
-00012d30: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00012d40: 7420 3d20 7265 7375 6c74 0d0a 2020 2020  t = result..    
-00012d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d60: 6966 2069 735f 7465 6e73 6f72 286f 7574  if is_tensor(out
-00012d70: 7075 7429 3a20 2023 206f 6e65 206f 7574  put):  # one out
-00012d80: 7075 740d 0a20 2020 2020 2020 2020 2020  put..           
-00012d90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012da0: 662e 5f6f 7574 7075 745f 7368 6170 6520  f._output_shape 
-00012db0: 3d20 7465 6e73 6f72 5f74 6f5f 7368 6170  = tensor_to_shap
-00012dc0: 6528 6f75 7470 7574 290d 0a20 2020 2020  e(output)..     
-00012dd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00012de0: 6c69 6620 6973 696e 7374 616e 6365 286f  lif isinstance(o
-00012df0: 7574 7075 742c 2028 6c69 7374 2c20 7475  utput, (list, tu
-00012e00: 706c 6529 293a 0d0a 2020 2020 2020 2020  ple)):..        
-00012e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e20: 6f75 7470 7574 5f73 6861 7065 203d 2074  output_shape = t
-00012e30: 7570 6c65 285b 7465 6e73 6f72 5f74 6f5f  uple([tensor_to_
-00012e40: 7368 6170 6528 6974 656d 2920 666f 7220  shape(item) for 
-00012e50: 6974 656d 2069 6e20 6f75 7470 7574 2069  item in output i
-00012e60: 660d 0a20 2020 2020 2020 2020 2020 2020  f..             
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e90: 2069 7465 6d20 6973 206e 6f74 204e 6f6e   item is not Non
-00012ea0: 6520 616e 6420 6e6f 7420 6973 696e 7374  e and not isinst
-00012eb0: 616e 6365 2869 7465 6d2c 2028 6c69 7374  ance(item, (list
-00012ec0: 2c20 7475 706c 6529 295d 290d 0a20 2020  , tuple))])..   
-00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ee0: 2020 2020 2023 2069 6620 6e6f 7420 6973       # if not is
-00012ef0: 696e 7374 616e 6365 2869 7465 6d2c 2028  instance(item, (
-00012f00: 6c69 7374 2c74 7570 6c65 2929 206c 7374  list,tuple)) lst
-00012f10: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
-00012f20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012f30: 5f6f 7574 7075 745f 7368 6170 6520 3d20  _output_shape = 
-00012f40: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
-00012f50: 286f 7574 7075 745f 7368 6170 6529 0d0a  (output_shape)..
-00012f60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012f70: 2020 6966 205f 676c 6f62 616c 5f66 6f72    if _global_for
-00012f80: 7761 7264 5f68 6f6f 6b73 206f 7220 7365  ward_hooks or se
-00012f90: 6c66 2e5f 666f 7277 6172 645f 686f 6f6b  lf._forward_hook
-00012fa0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00012fb0: 2020 2020 2020 2020 666f 7220 686f 6f6b          for hook
-00012fc0: 5f69 642c 2068 6f6f 6b20 696e 2028 0d0a  _id, hook in (..
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fe0: 2020 2020 2020 2020 2020 2020 2a5f 676c              *_gl
-00012ff0: 6f62 616c 5f66 6f72 7761 7264 5f68 6f6f  obal_forward_hoo
-00013000: 6b73 2e69 7465 6d73 2829 2c0d 0a20 2020  ks.items(),..   
-00013010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013020: 2020 2020 2020 2020 202a 7365 6c66 2e5f           *self._
-00013030: 666f 7277 6172 645f 686f 6f6b 732e 6974  forward_hooks.it
-00013040: 656d 7328 292c 0d0a 2020 2020 2020 2020  ems(),..        
-00013050: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
-00013060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013070: 2020 2020 2020 2020 6966 2068 6f6f 6b5f          if hook_
-00013080: 6964 2069 6e20 7365 6c66 2e5f 666f 7277  id in self._forw
-00013090: 6172 645f 686f 6f6b 735f 7769 7468 5f6b  ard_hooks_with_k
-000130a0: 7761 7267 733a 0d0a 2020 2020 2020 2020  wargs:..        
-000130b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130c0: 2020 2020 686f 6f6b 5f72 6573 756c 7420      hook_result 
-000130d0: 3d20 686f 6f6b 2873 656c 662c 2061 7267  = hook(self, arg
-000130e0: 732c 206b 7761 7267 732c 2072 6573 756c  s, kwargs, resul
-000130f0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00013100: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00013110: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00013120: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00013130: 6f6f 6b5f 7265 7375 6c74 203d 2068 6f6f  ook_result = hoo
-00013140: 6b28 7365 6c66 2c20 6172 6773 2c20 7265  k(self, args, re
-00013150: 7375 6c74 290d 0a0d 0a20 2020 2020 2020  sult)....       
-00013160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013170: 2069 6620 686f 6f6b 5f72 6573 756c 7420   if hook_result 
-00013180: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00013190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131a0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-000131b0: 203d 2068 6f6f 6b5f 7265 7375 6c74 0d0a   = hook_result..
-000131c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000131d0: 2020 2320 6966 2062 775f 686f 6f6b 3a0d    # if bw_hook:.
-000131e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000131f0: 2023 2020 2020 2072 6573 756c 7420 3d20   #     result = 
-00013200: 6277 5f68 6f6f 6b2e 7365 7475 705f 6f75  bw_hook.setup_ou
-00013210: 7470 7574 5f68 6f6f 6b28 7265 7375 6c74  tput_hook(result
-00013220: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00013230: 2069 6620 6973 5f61 6c6c 5f6e 756d 7079   if is_all_numpy
-00013240: 203d 3d20 5472 7565 2061 6e64 2073 656c   == True and sel
-00013250: 662e 7472 6169 6e69 6e67 203d 3d20 4661  f.training == Fa
-00013260: 6c73 6520 616e 6420 7365 6c66 2e69 735f  lse and self.is_
-00013270: 726f 6f74 203d 3d20 5472 7565 3a0d 0a20  root == True:.. 
-00013280: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013290: 6620 6973 5f74 656e 736f 7228 7265 7375  f is_tensor(resu
-000132a0: 6c74 293a 0d0a 2020 2020 2020 2020 2020  lt):..          
-000132b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000132c0: 2074 6f5f 6e75 6d70 7928 7265 7375 6c74   to_numpy(result
-000132d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000132e0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000132f0: 6365 2872 6573 756c 742c 2028 6c69 7374  ce(result, (list
-00013300: 2c20 7475 706c 6529 293a 0d0a 2020 2020  , tuple)):..    
-00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013320: 7265 7375 6c74 203d 206c 6973 7428 7265  result = list(re
-00013330: 7375 6c74 290d 0a20 2020 2020 2020 2020  sult)..         
-00013340: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013350: 6e20 7475 706c 6528 5b74 6f5f 6e75 6d70  n tuple([to_nump
-00013360: 7928 7265 7329 2069 6620 6973 5f74 656e  y(res) if is_ten
-00013370: 736f 7228 7265 7329 2065 6c73 6520 7265  sor(res) else re
-00013380: 7320 666f 7220 7265 7320 696e 2072 6573  s for res in res
-00013390: 756c 745d 290d 0a20 2020 2020 2020 2020  ult])..         
-000133a0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-000133b0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-000133c0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-000133d0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-000133e0: 696e 7428 277b 307d 2028 7b31 7d20 6361  int('{0} ({1} ca
-000133f0: 6c6c 2066 6169 6c65 642e 2927 2e66 6f72  ll failed.)'.for
-00013400: 6d61 7428 7365 6c66 2e6e 616d 652c 2073  mat(self.name, s
-00013410: 656c 662e 6465 6661 756c 745f 6e61 6d65  elf.default_name
-00013420: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00013430: 7072 696e 7428 6529 0d0a 2020 2020 2020  print(e)..      
-00013440: 2020 2020 2020 5072 696e 7445 7863 6570        PrintExcep
-00013450: 7469 6f6e 2829 0d0a 2020 2020 2020 2020  tion()..        
-00013460: 2020 2020 7261 6973 6520 650d 0a0d 0a20      raise e.... 
-00013470: 2020 205f 5f63 616c 6c5f 5f3a 2043 616c     __call__: Cal
-00013480: 6c61 626c 655b 2e2e 2e2c 2041 6e79 5d20  lable[..., Any] 
-00013490: 3d20 5f63 616c 6c5f 696d 706c 0d0a 0d0a  = _call_impl....
-000134a0: 2020 2020 6465 6620 5f5f 6765 7473 7461      def __getsta
-000134b0: 7465 5f5f 2873 656c 6629 3a0d 0a20 2020  te__(self):..   
-000134c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000134d0: 2e5f 5f64 6963 745f 5f0d 0a0d 0a20 2020  .__dict__....   
-000134e0: 2064 6566 205f 5f73 6574 7374 6174 655f   def __setstate_
-000134f0: 5f28 7365 6c66 2c20 7374 6174 6529 3a0d  _(self, state):.
-00013500: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
-00013510: 6469 6374 5f5f 2e75 7064 6174 6528 7374  dict__.update(st
-00013520: 6174 6529 0d0a 2020 2020 2020 2020 2320  ate)..        # 
-00013530: 5375 7070 6f72 7420 6c6f 6164 696e 6720  Support loading 
-00013540: 6f6c 6420 6368 6563 6b70 6f69 6e74 7320  old checkpoints 
-00013550: 7468 6174 2064 6f6e 2774 2068 6176 6520  that don't have 
-00013560: 7468 6520 666f 6c6c 6f77 696e 6720 6174  the following at
-00013570: 7472 733a 0d0a 2020 2020 2020 2020 6966  trs:..        if
-00013580: 2027 5f66 6f72 7761 7264 5f70 7265 5f68   '_forward_pre_h
-00013590: 6f6f 6b73 2720 6e6f 7420 696e 2073 656c  ooks' not in sel
-000135a0: 662e 5f5f 6469 6374 5f5f 3a0d 0a20 2020  f.__dict__:..   
-000135b0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-000135c0: 6f72 7761 7264 5f70 7265 5f68 6f6f 6b73  orward_pre_hooks
-000135d0: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
-000135e0: 0d0a 2020 2020 2020 2020 6966 2027 5f73  ..        if '_s
-000135f0: 7461 7465 5f64 6963 745f 686f 6f6b 7327  tate_dict_hooks'
-00013600: 206e 6f74 2069 6e20 7365 6c66 2e5f 5f64   not in self.__d
-00013610: 6963 745f 5f3a 0d0a 2020 2020 2020 2020  ict__:..        
-00013620: 2020 2020 7365 6c66 2e5f 7374 6174 655f      self._state_
-00013630: 6469 6374 5f68 6f6f 6b73 203d 204f 7264  dict_hooks = Ord
-00013640: 6572 6564 4469 6374 2829 0d0a 2020 2020  eredDict()..    
-00013650: 2020 2020 6966 2027 5f6c 6f61 645f 7374      if '_load_st
-00013660: 6174 655f 6469 6374 5f70 7265 5f68 6f6f  ate_dict_pre_hoo
-00013670: 6b73 2720 6e6f 7420 696e 2073 656c 662e  ks' not in self.
-00013680: 5f5f 6469 6374 5f5f 3a0d 0a20 2020 2020  __dict__:..     
-00013690: 2020 2020 2020 2073 656c 662e 5f6c 6f61         self._loa
-000136a0: 645f 7374 6174 655f 6469 6374 5f70 7265  d_state_dict_pre
-000136b0: 5f68 6f6f 6b73 203d 204f 7264 6572 6564  _hooks = Ordered
-000136c0: 4469 6374 2829 0d0a 0d0a 2020 2020 6465  Dict()....    de
-000136d0: 6620 5f5f 6765 7461 7474 725f 5f28 7365  f __getattr__(se
-000136e0: 6c66 2c20 6e61 6d65 293a 0d0a 2020 2020  lf, name):..    
-000136f0: 2020 2020 6966 2027 5f70 6172 616d 6574      if '_paramet
-00013700: 6572 7327 2069 6e20 7365 6c66 2e5f 5f64  ers' in self.__d
-00013710: 6963 745f 5f3a 0d0a 2020 2020 2020 2020  ict__:..        
-00013720: 2020 2020 5f70 6172 616d 6574 6572 7320      _parameters 
-00013730: 3d20 7365 6c66 2e5f 5f64 6963 745f 5f5b  = self.__dict__[
-00013740: 275f 7061 7261 6d65 7465 7273 275d 0d0a  '_parameters']..
-00013750: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00013760: 616d 6520 696e 205f 7061 7261 6d65 7465  ame in _paramete
-00013770: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
-00013780: 2020 2020 2072 6574 7572 6e20 5f70 6172       return _par
-00013790: 616d 6574 6572 735b 6e61 6d65 5d0d 0a20  ameters[name].. 
-000137a0: 2020 2020 2020 2069 6620 275f 6275 6666         if '_buff
-000137b0: 6572 7327 2069 6e20 7365 6c66 2e5f 5f64  ers' in self.__d
-000137c0: 6963 745f 5f3a 0d0a 2020 2020 2020 2020  ict__:..        
-000137d0: 2020 2020 5f62 7566 6665 7273 203d 2073      _buffers = s
-000137e0: 656c 662e 5f5f 6469 6374 5f5f 5b27 5f62  elf.__dict__['_b
-000137f0: 7566 6665 7273 275d 0d0a 2020 2020 2020  uffers']..      
-00013800: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
-00013810: 205f 6275 6666 6572 733a 0d0a 2020 2020   _buffers:..    
-00013820: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013830: 726e 205f 6275 6666 6572 735b 6e61 6d65  rn _buffers[name
-00013840: 5d0d 0a20 2020 2020 2020 2069 6620 275f  ]..        if '_
-00013850: 6d6f 6475 6c65 7327 2069 6e20 7365 6c66  modules' in self
-00013860: 2e5f 5f64 6963 745f 5f3a 0d0a 2020 2020  .__dict__:..    
-00013870: 2020 2020 2020 2020 6d6f 6475 6c65 7320          modules 
-00013880: 3d20 7365 6c66 2e5f 5f64 6963 745f 5f5b  = self.__dict__[
-00013890: 275f 6d6f 6475 6c65 7327 5d0d 0a20 2020  '_modules']..   
-000138a0: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
-000138b0: 2069 6e20 6d6f 6475 6c65 733a 0d0a 2020   in modules:..  
-000138c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000138d0: 7475 726e 206d 6f64 756c 6573 5b6e 616d  turn modules[nam
-000138e0: 655d 0d0a 2020 2020 2020 2020 6966 206e  e]..        if n
-000138f0: 616d 6520 696e 2073 656c 662e 5f5f 6469  ame in self.__di
-00013900: 6374 5f5f 3a0d 0a20 2020 2020 2020 2020  ct__:..         
-00013910: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00013920: 5f64 6963 745f 5f5b 6e61 6d65 5d0d 0a20  _dict__[name].. 
-00013930: 2020 2020 2020 2072 6169 7365 2041 7474         raise Att
-00013940: 7269 6275 7465 4572 726f 7228 2227 7b7d  ributeError("'{}
-00013950: 2720 6f62 6a65 6374 2068 6173 206e 6f20  ' object has no 
-00013960: 6174 7472 6962 7574 6520 277b 7d27 222e  attribute '{}'".
-00013970: 666f 726d 6174 2874 7970 6528 7365 6c66  format(type(self
-00013980: 292e 5f5f 6e61 6d65 5f5f 2c20 6e61 6d65  ).__name__, name
-00013990: 2929 0d0a 0d0a 2020 2020 6465 6620 5f5f  ))....    def __
-000139a0: 7365 7461 7474 725f 5f28 7365 6c66 2c20  setattr__(self, 
-000139b0: 6e61 6d65 3a20 7374 722c 2076 616c 7565  name: str, value
-000139c0: 3a20 556e 696f 6e5b 5465 6e73 6f72 2c20  : Union[Tensor, 
-000139d0: 274d 6f64 756c 6527 5d29 202d 3e20 4e6f  'Module']) -> No
-000139e0: 6e65 3a0d 0a20 2020 2020 2020 2064 6566  ne:..        def
-000139f0: 2072 656d 6f76 655f 6672 6f6d 282a 6469   remove_from(*di
-00013a00: 6374 735f 6f72 5f73 6574 7329 3a0d 0a20  cts_or_sets):.. 
-00013a10: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-00013a20: 2069 6e20 6469 6374 735f 6f72 5f73 6574   in dicts_or_set
-00013a30: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00013a40: 2020 2020 6966 206e 616d 6520 696e 2064      if name in d
-00013a50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00013a60: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00013a70: 616e 6365 2864 2c20 6469 6374 293a 0d0a  ance(d, dict):..
-00013a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a90: 2020 2020 2020 2020 6465 6c20 645b 6e61          del d[na
-00013aa0: 6d65 5d0d 0a20 2020 2020 2020 2020 2020  me]..           
-00013ab0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 2020 2020 2020 2020 642e 6469 7363 6172          d.discar
-00013ae0: 6428 6e61 6d65 290d 0a0d 0a20 2020 2020  d(name)....     
-00013af0: 2020 2070 6172 616d 7320 3d20 7365 6c66     params = self
-00013b00: 2e5f 5f64 6963 745f 5f2e 6765 7428 275f  .__dict__.get('_
-00013b10: 7061 7261 6d65 7465 7273 2729 0d0a 2020  parameters')..  
-00013b20: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00013b30: 6e63 6528 7661 6c75 652c 2074 662e 5661  nce(value, tf.Va
-00013b40: 7269 6162 6c65 293a 0d0a 2020 2020 2020  riable):..      
-00013b50: 2020 2020 2020 6966 2070 6172 616d 7320        if params 
-00013b60: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00013b70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00013b80: 4174 7472 6962 7574 6545 7272 6f72 280d  AttributeError(.
-00013b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ba0: 2020 2020 2022 6361 6e6e 6f74 2061 7373       "cannot ass
-00013bb0: 6967 6e20 7061 7261 6d65 7465 7273 2062  ign parameters b
-00013bc0: 6566 6f72 6520 4d6f 6475 6c65 2e5f 5f69  efore Module.__i
-00013bd0: 6e69 745f 5f28 2920 6361 6c6c 2229 0d0a  nit__() call")..
-00013be0: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
-00013bf0: 7665 5f66 726f 6d28 7365 6c66 2e5f 5f64  ve_from(self.__d
-00013c00: 6963 745f 5f2c 2073 656c 662e 5f62 7566  ict__, self._buf
-00013c10: 6665 7273 2c20 7365 6c66 2e5f 6d6f 6475  fers, self._modu
-00013c20: 6c65 732c 2073 656c 662e 5f6e 6f6e 5f70  les, self._non_p
-00013c30: 6572 7369 7374 656e 745f 6275 6666 6572  ersistent_buffer
-00013c40: 735f 7365 7429 0d0a 2020 2020 2020 2020  s_set)..        
-00013c50: 2020 2020 7365 6c66 2e72 6567 6973 7465      self.registe
-00013c60: 725f 7061 7261 6d65 7465 7228 6e61 6d65  r_parameter(name
-00013c70: 2c20 7661 6c75 6529 0d0a 2020 2020 2020  , value)..      
-00013c80: 2020 656c 6966 2070 6172 616d 7320 6973    elif params is
-00013c90: 206e 6f74 204e 6f6e 6520 616e 6420 6e61   not None and na
-00013ca0: 6d65 2069 6e20 7061 7261 6d73 3a0d 0a20  me in params:.. 
-00013cb0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
-00013cc0: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
-00013cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013ce0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00013cf0: 7228 2263 616e 6e6f 7420 6173 7369 676e  r("cannot assign
-00013d00: 2027 7b7d 2720 6173 2070 6172 616d 6574   '{}' as paramet
-00013d10: 6572 2027 7b7d 2720 220d 0a20 2020 2020  er '{}' "..     
-00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d30: 2020 2020 2020 2020 2020 2022 2874 6f72             "(tor
-00013d40: 6368 2e6e 6e2e 5061 7261 6d65 7465 7220  ch.nn.Parameter 
-00013d50: 6f72 204e 6f6e 6520 6578 7065 6374 6564  or None expected
-00013d60: 2922 0d0a 2020 2020 2020 2020 2020 2020  )"..            
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d80: 2020 2020 2e66 6f72 6d61 7428 7661 6c75      .format(valu
-00013d90: 652c 206e 616d 6529 290d 0a20 2020 2020  e, name))..     
-00013da0: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
-00013db0: 7374 6572 5f70 6172 616d 6574 6572 286e  ster_parameter(n
-00013dc0: 616d 652c 2076 616c 7565 290d 0a20 2020  ame, value)..   
-00013dd0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00013de0: 2020 2020 2020 2020 6d6f 6475 6c65 7320          modules 
-00013df0: 3d20 7365 6c66 2e5f 5f64 6963 745f 5f2e  = self.__dict__.
-00013e00: 6765 7428 275f 6d6f 6475 6c65 7327 290d  get('_modules').
-00013e10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013e20: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-00013e30: 2c20 7466 2e4d 6f64 756c 6529 3a0d 0a20  , tf.Module):.. 
-00013e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013e50: 6620 6d6f 6475 6c65 7320 6973 204e 6f6e  f modules is Non
-00013e60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00013e70: 2020 2020 2020 2020 7261 6973 6520 4174          raise At
-00013e80: 7472 6962 7574 6545 7272 6f72 280d 0a20  tributeError(.. 
-00013e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ea0: 2020 2020 2020 2022 6361 6e6e 6f74 2061         "cannot a
-00013eb0: 7373 6967 6e20 6d6f 6475 6c65 2062 6566  ssign module bef
-00013ec0: 6f72 6520 4d6f 6475 6c65 2e5f 5f69 6e69  ore Module.__ini
-00013ed0: 745f 5f28 2920 6361 6c6c 2229 0d0a 2020  t__() call")..  
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013ef0: 6d6f 7665 5f66 726f 6d28 7365 6c66 2e5f  move_from(self._
-00013f00: 5f64 6963 745f 5f2c 2073 656c 662e 5f70  _dict__, self._p
-00013f10: 6172 616d 6574 6572 732c 2073 656c 662e  arameters, self.
-00013f20: 5f62 7566 6665 7273 2c20 7365 6c66 2e5f  _buffers, self._
-00013f30: 6e6f 6e5f 7065 7273 6973 7465 6e74 5f62  non_persistent_b
-00013f40: 7566 6665 7273 5f73 6574 290d 0a20 2020  uffers_set)..   
-00013f50: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00013f60: 756c 6573 5b6e 616d 655d 203d 2076 616c  ules[name] = val
-00013f70: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00013f80: 656c 6966 206d 6f64 756c 6573 2069 7320  elif modules is 
-00013f90: 6e6f 7420 4e6f 6e65 2061 6e64 206e 616d  not None and nam
-00013fa0: 6520 696e 206d 6f64 756c 6573 3a0d 0a20  e in modules:.. 
-00013fb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013fc0: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
-00013fd0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00013fe0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00013ff0: 5479 7065 4572 726f 7228 2263 616e 6e6f  TypeError("canno
-00014000: 7420 6173 7369 676e 2027 7b7d 2720 6173  t assign '{}' as
-00014010: 2063 6869 6c64 206d 6f64 756c 6520 277b   child module '{
-00014020: 7d27 2022 0d0a 2020 2020 2020 2020 2020  }' "..          
-00014030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014040: 2020 2020 2020 2020 2020 2228 746f 7263            "(torc
-00014050: 682e 6e6e 2e4d 6f64 756c 6520 6f72 204e  h.nn.Module or N
-00014060: 6f6e 6520 6578 7065 6374 6564 2922 0d0a  one expected)"..
-00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 2020 2020 2e66 6f72 6d61 7428 7661 6c75      .format(valu
-000140a0: 652c 206e 616d 6529 290d 0a20 2020 2020  e, name))..     
-000140b0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-000140c0: 6573 5b6e 616d 655d 203d 2076 616c 7565  es[name] = value
-000140d0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000140e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000140f0: 2020 2020 2062 7566 6665 7273 203d 2073       buffers = s
-00014100: 656c 662e 5f5f 6469 6374 5f5f 2e67 6574  elf.__dict__.get
-00014110: 2827 5f62 7566 6665 7273 2729 0d0a 2020  ('_buffers')..  
-00014120: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014130: 2062 7566 6665 7273 2069 7320 6e6f 7420   buffers is not 
-00014140: 4e6f 6e65 2061 6e64 206e 616d 6520 696e  None and name in
-00014150: 2062 7566 6665 7273 3a0d 0a20 2020 2020   buffers:..     
-00014160: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014170: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
-00014180: 6f6e 6520 616e 6420 6e6f 7420 6973 696e  one and not isin
-00014190: 7374 616e 6365 2876 616c 7565 2c20 7466  stance(value, tf
-000141a0: 2e54 656e 736f 7229 3a0d 0a20 2020 2020  .Tensor):..     
-000141b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141c0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-000141d0: 6f72 2822 6361 6e6e 6f74 2061 7373 6967  or("cannot assig
-000141e0: 6e20 277b 7d27 2061 7320 6275 6666 6572  n '{}' as buffer
-000141f0: 2027 7b7d 2720 220d 0a20 2020 2020 2020   '{}' "..       
-00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014220: 2022 2874 6f72 6368 2e54 656e 736f 7220   "(torch.Tensor 
-00014230: 6f72 204e 6f6e 6520 6578 7065 6374 6564  or None expected
-00014240: 2922 0d0a 2020 2020 2020 2020 2020 2020  )"..            
-00014250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014260: 2020 2020 2020 2020 2020 2020 2e66 6f72              .for
-00014270: 6d61 7428 7661 6c75 652c 206e 616d 6529  mat(value, name)
-00014280: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00014290: 2020 2020 2020 2062 7566 6665 7273 5b6e         buffers[n
-000142a0: 616d 655d 203d 2076 616c 7565 0d0a 2020  ame] = value..  
-000142b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000142c0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000142d0: 2020 2020 2020 2020 206f 626a 6563 742e           object.
-000142e0: 5f5f 7365 7461 7474 725f 5f28 7365 6c66  __setattr__(self
-000142f0: 2c20 6e61 6d65 2c20 7661 6c75 6529 0d0a  , name, value)..
-00014300: 0d0a 2020 2020 6465 6620 5f5f 6465 6c61  ..    def __dela
-00014310: 7474 725f 5f28 7365 6c66 2c20 6e61 6d65  ttr__(self, name
-00014320: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
-00014330: 616d 6520 696e 2073 656c 662e 5f70 6172  ame in self._par
-00014340: 616d 6574 6572 733a 0d0a 2020 2020 2020  ameters:..      
-00014350: 2020 2020 2020 6465 6c20 7365 6c66 2e5f        del self._
-00014360: 7061 7261 6d65 7465 7273 5b6e 616d 655d  parameters[name]
-00014370: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
-00014380: 616d 6520 696e 2073 656c 662e 5f62 7566  ame in self._buf
-00014390: 6665 7273 3a0d 0a20 2020 2020 2020 2020  fers:..         
-000143a0: 2020 2064 656c 2073 656c 662e 5f62 7566     del self._buf
-000143b0: 6665 7273 5b6e 616d 655d 0d0a 2020 2020  fers[name]..    
-000143c0: 2020 2020 656c 6966 206e 616d 6520 696e      elif name in
-000143d0: 2073 656c 662e 5f6d 6f64 756c 6573 3a0d   self._modules:.
-000143e0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-000143f0: 2073 656c 662e 5f6d 6f64 756c 6573 5b6e   self._modules[n
-00014400: 616d 655d 0d0a 2020 2020 2020 2020 656c  ame]..        el
-00014410: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00014420: 206f 626a 6563 742e 5f5f 6465 6c61 7474   object.__delatt
-00014430: 725f 5f28 7365 6c66 2c20 6e61 6d65 290d  r__(self, name).
-00014440: 0a0d 0a20 2020 2064 6566 205f 6e61 6d65  ...    def _name
-00014450: 645f 6d65 6d62 6572 7328 7365 6c66 2c20  d_members(self, 
-00014460: 6765 745f 6d65 6d62 6572 735f 666e 2c20  get_members_fn, 
-00014470: 7072 6566 6978 3d27 272c 2072 6563 7572  prefix='', recur
-00014480: 7365 3d54 7275 6529 3a0d 0a20 2020 2020  se=True):..     
-00014490: 2020 2072 2222 2248 656c 7065 7220 6d65     r"""Helper me
-000144a0: 7468 6f64 2066 6f72 2079 6965 6c64 696e  thod for yieldin
-000144b0: 6720 7661 7269 6f75 7320 6e61 6d65 7320  g various names 
-000144c0: 2b20 6d65 6d62 6572 7320 6f66 206d 6f64  + members of mod
-000144d0: 756c 6573 2e22 2222 0d0a 2020 2020 2020  ules."""..      
-000144e0: 2020 6d65 6d6f 203d 2073 6574 2829 0d0a    memo = set()..
-000144f0: 2020 2020 2020 2020 6d6f 6475 6c65 7320          modules 
-00014500: 3d20 7365 6c66 2e6e 616d 6564 5f6d 6f64  = self.named_mod
-00014510: 756c 6573 2870 7265 6669 783d 7072 6566  ules(prefix=pref
-00014520: 6978 2920 6966 2072 6563 7572 7365 2065  ix) if recurse e
-00014530: 6c73 6520 5b28 7072 6566 6978 2c20 7365  lse [(prefix, se
-00014540: 6c66 295d 0d0a 2020 2020 2020 2020 666f  lf)]..        fo
-00014550: 7220 6d6f 6475 6c65 5f70 7265 6669 782c  r module_prefix,
-00014560: 206d 6f64 756c 6520 696e 206d 6f64 756c   module in modul
-00014570: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00014580: 206d 656d 6265 7273 203d 2067 6574 5f6d   members = get_m
-00014590: 656d 6265 7273 5f66 6e28 6d6f 6475 6c65  embers_fn(module
-000145a0: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-000145b0: 6f72 206b 2c20 7620 696e 206d 656d 6265  or k, v in membe
-000145c0: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
-000145d0: 2020 2020 2069 7374 656e 736f 7220 3d20       istensor = 
-000145e0: 6973 5f74 656e 736f 7228 7629 0d0a 2020  is_tensor(v)..  
-000145f0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00014600: 7920 3d20 762e 7265 6628 2920 6966 2069  y = v.ref() if i
-00014610: 7374 656e 736f 7220 656c 7365 2076 0d0a  stensor else v..
-00014620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014630: 6966 2076 2069 7320 4e6f 6e65 206f 7220  if v is None or 
-00014640: 6b65 7920 696e 206d 656d 6f3a 0d0a 2020  key in memo:..  
-00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014660: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
-00014670: 2020 2020 2020 2020 2020 2020 6d65 6d6f              memo
-00014680: 2e61 6464 286b 6579 290d 0a20 2020 2020  .add(key)..     
-00014690: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-000146a0: 3d20 6d6f 6475 6c65 5f70 7265 6669 7820  = module_prefix 
-000146b0: 2b20 2827 2e27 2069 6620 6d6f 6475 6c65  + ('.' if module
-000146c0: 5f70 7265 6669 7820 656c 7365 2027 2729  _prefix else '')
-000146d0: 202b 206b 0d0a 2020 2020 2020 2020 2020   + k..          
-000146e0: 2020 2020 2020 7969 656c 6420 6e61 6d65        yield name
-000146f0: 2c20 760d 0a0d 0a20 2020 2064 6566 2070  , v....    def p
-00014700: 6172 616d 6574 6572 7328 7365 6c66 2c20  arameters(self, 
-00014710: 7265 6375 7273 653d 5472 7565 293a 0d0a  recurse=True):..
-00014720: 2020 2020 2020 2020 7222 2222 5265 7475          r"""Retu
-00014730: 726e 7320 616e 2069 7465 7261 746f 7220  rns an iterator 
-00014740: 6f76 6572 206d 6f64 756c 6520 7061 7261  over module para
-00014750: 6d65 7465 7273 2e0d 0a0d 0a20 2020 2020  meters.....     
-00014760: 2020 2054 6869 7320 6973 2074 7970 6963     This is typic
-00014770: 616c 6c79 2070 6173 7365 6420 746f 2061  ally passed to a
-00014780: 6e20 6f70 7469 6d69 7a65 722e 0d0a 0d0a  n optimizer.....
-00014790: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
-000147a0: 2020 2020 2020 2020 2020 2072 6563 7572             recur
-000147b0: 7365 2028 626f 6f6c 293a 2069 6620 5472  se (bool): if Tr
-000147c0: 7565 2c20 7468 656e 2079 6965 6c64 7320  ue, then yields 
-000147d0: 7061 7261 6d65 7465 7273 206f 6620 7468  parameters of th
-000147e0: 6973 206d 6f64 756c 650d 0a20 2020 2020  is module..     
-000147f0: 2020 2020 2020 2020 2020 2061 6e64 2061             and a
-00014800: 6c6c 2073 7562 6d6f 6475 6c65 732e 204f  ll submodules. O
-00014810: 7468 6572 7769 7365 2c20 7969 656c 6473  therwise, yields
-00014820: 206f 6e6c 7920 7061 7261 6d65 7465 7273   only parameters
-00014830: 2074 6861 740d 0a20 2020 2020 2020 2020   that..         
-00014840: 2020 2020 2020 2061 7265 2064 6972 6563         are direc
-00014850: 7420 6d65 6d62 6572 7320 6f66 2074 6869  t members of thi
-00014860: 7320 6d6f 6475 6c65 2e0d 0a0d 0a20 2020  s module.....   
-00014870: 2020 2020 2059 6965 6c64 733a 0d0a 2020       Yields:..  
-00014880: 2020 2020 2020 2020 2020 5061 7261 6d65            Parame
-00014890: 7465 723a 206d 6f64 756c 6520 7061 7261  ter: module para
-000148a0: 6d65 7465 720d 0a0d 0a20 2020 2020 2020  meter....       
-000148b0: 2045 7861 6d70 6c65 733a 0d0a 0d0a 2020   Examples:....  
-000148c0: 2020 2020 2020 2020 2020 3e3e 3e20 666f            >>> fo
-000148d0: 7220 7061 7261 6d20 696e 206d 6f64 656c  r param in model
-000148e0: 2e70 6172 616d 6574 6572 7328 293a 0d0a  .parameters():..
-000148f0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-00014900: 2020 2020 7072 696e 7428 7479 7065 2870      print(type(p
-00014910: 6172 616d 2e64 6174 6129 2c20 7061 7261  aram.data), para
-00014920: 6d2e 7369 7a65 2829 290d 0a20 2020 2020  m.size())..     
-00014930: 2020 2020 2020 203c 636c 6173 7320 2774         <class 't
-00014940: 6f72 6368 2e46 6c6f 6174 5465 6e73 6f72  orch.FloatTensor
-00014950: 273e 2028 3230 4c2c 290d 0a20 2020 2020  '> (20L,)..     
-00014960: 2020 2020 2020 203c 636c 6173 7320 2774         <class 't
-00014970: 6f72 6368 2e46 6c6f 6174 5465 6e73 6f72  orch.FloatTensor
-00014980: 273e 2028 3230 4c2c 2031 4c2c 2035 4c2c  '> (20L, 1L, 5L,
-00014990: 2035 4c29 0d0a 0d0a 2020 2020 2020 2020   5L)....        
-000149a0: 2222 220d 0a20 2020 2020 2020 2066 6f72  """..        for
-000149b0: 206e 616d 652c 2070 6172 616d 2069 6e20   name, param in 
-000149c0: 7365 6c66 2e6e 616d 6564 5f70 6172 616d  self.named_param
-000149d0: 6574 6572 7328 7265 6375 7273 653d 7265  eters(recurse=re
-000149e0: 6375 7273 6529 3a0d 0a20 2020 2020 2020  curse):..       
-000149f0: 2020 2020 2079 6965 6c64 2070 6172 616d       yield param
-00014a00: 0d0a 0d0a 2020 2020 6465 6620 6e61 6d65  ....    def name
-00014a10: 645f 7061 7261 6d65 7465 7273 2873 656c  d_parameters(sel
-00014a20: 662c 2070 7265 6669 783a 2073 7472 203d  f, prefix: str =
-00014a30: 2027 272c 2072 6563 7572 7365 3a20 626f   '', recurse: bo
-00014a40: 6f6c 203d 2054 7275 6529 202d 3e20 4974  ol = True) -> It
-00014a50: 6572 6174 6f72 5b54 7570 6c65 5b73 7472  erator[Tuple[str
-00014a60: 2c20 5465 6e73 6f72 5d5d 3a0d 0a20 2020  , Tensor]]:..   
-00014a70: 2020 2020 2072 2222 2252 6574 7572 6e73       r"""Returns
-00014a80: 2061 6e20 6974 6572 6174 6f72 206f 7665   an iterator ove
-00014a90: 7220 6d6f 6475 6c65 2070 6172 616d 6574  r module paramet
-00014aa0: 6572 732c 2079 6965 6c64 696e 6720 626f  ers, yielding bo
-00014ab0: 7468 2074 6865 0d0a 2020 2020 2020 2020  th the..        
-00014ac0: 6e61 6d65 206f 6620 7468 6520 7061 7261  name of the para
-00014ad0: 6d65 7465 7220 6173 2077 656c 6c20 6173  meter as well as
-00014ae0: 2074 6865 2070 6172 616d 6574 6572 2069   the parameter i
-00014af0: 7473 656c 662e 0d0a 0d0a 2020 2020 2020  tself.....      
-00014b00: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-00014b10: 2020 2020 2070 7265 6669 7820 2873 7472       prefix (str
-00014b20: 293a 2070 7265 6669 7820 746f 2070 7265  ): prefix to pre
-00014b30: 7065 6e64 2074 6f20 616c 6c20 7061 7261  pend to all para
-00014b40: 6d65 7465 7220 6e61 6d65 732e 0d0a 2020  meter names...  
-00014b50: 2020 2020 2020 2020 2020 7265 6375 7273            recurs
-00014b60: 6520 2862 6f6f 6c29 3a20 6966 2054 7275  e (bool): if Tru
-00014b70: 652c 2074 6865 6e20 7969 656c 6473 2070  e, then yields p
-00014b80: 6172 616d 6574 6572 7320 6f66 2074 6869  arameters of thi
-00014b90: 7320 6d6f 6475 6c65 0d0a 2020 2020 2020  s module..      
-00014ba0: 2020 2020 2020 2020 2020 616e 6420 616c            and al
-00014bb0: 6c20 7375 626d 6f64 756c 6573 2e20 4f74  l submodules. Ot
-00014bc0: 6865 7277 6973 652c 2079 6965 6c64 7320  herwise, yields 
-00014bd0: 6f6e 6c79 2070 6172 616d 6574 6572 7320  only parameters 
-00014be0: 7468 6174 0d0a 2020 2020 2020 2020 2020  that..          
-00014bf0: 2020 2020 2020 6172 6520 6469 7265 6374        are direct
-00014c00: 206d 656d 6265 7273 206f 6620 7468 6973   members of this
-00014c10: 206d 6f64 756c 652e 0d0a 0d0a 2020 2020   module.....    
-00014c20: 2020 2020 5969 656c 6473 3a0d 0a20 2020      Yields:..   
-00014c30: 2020 2020 2020 2020 2028 7374 7269 6e67           (string
-00014c40: 2c20 5061 7261 6d65 7465 7229 3a20 5475  , Parameter): Tu
-00014c50: 706c 6520 636f 6e74 6169 6e69 6e67 2074  ple containing t
-00014c60: 6865 206e 616d 6520 616e 6420 7061 7261  he name and para
-00014c70: 6d65 7465 720d 0a0d 0a20 2020 2020 2020  meter....       
-00014c80: 2045 7861 6d70 6c65 3a3a 0d0a 0d0a 2020   Example::....  
-00014c90: 2020 2020 2020 2020 2020 3e3e 3e20 666f            >>> fo
-00014ca0: 7220 6e61 6d65 2c20 7061 7261 6d20 696e  r name, param in
-00014cb0: 2073 656c 662e 6e61 6d65 645f 7061 7261   self.named_para
-00014cc0: 6d65 7465 7273 2829 3a0d 0a20 2020 2020  meters():..     
-00014cd0: 2020 2020 2020 203e 3e3e 2020 2020 6966         >>>    if
-00014ce0: 206e 616d 6520 696e 205b 2762 6961 7327   name in ['bias'
-00014cf0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00014d00: 3e3e 3e20 2020 2020 2020 2070 7269 6e74  >>>        print
-00014d10: 2870 6172 616d 2e73 697a 6528 2929 0d0a  (param.size())..
-00014d20: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00014d30: 2020 2020 2020 2067 656e 203d 2073 656c         gen = sel
-00014d40: 662e 5f6e 616d 6564 5f6d 656d 6265 7273  f._named_members
-00014d50: 280d 0a20 2020 2020 2020 2020 2020 206c  (..            l
-00014d60: 616d 6264 6120 6d6f 6475 6c65 3a20 6d6f  ambda module: mo
-00014d70: 6475 6c65 2e5f 7061 7261 6d65 7465 7273  dule._parameters
-00014d80: 2e69 7465 6d73 2829 2c0d 0a20 2020 2020  .items(),..     
-00014d90: 2020 2020 2020 2070 7265 6669 783d 7072         prefix=pr
-00014da0: 6566 6978 2c20 7265 6375 7273 653d 7265  efix, recurse=re
-00014db0: 6375 7273 6529 0d0a 2020 2020 2020 2020  curse)..        
-00014dc0: 666f 7220 656c 656d 2069 6e20 6765 6e3a  for elem in gen:
-00014dd0: 0d0a 2020 2020 2020 2020 2020 2020 7969  ..            yi
-00014de0: 656c 6420 656c 656d 0d0a 0d0a 2020 2020  eld elem....    
-00014df0: 6465 6620 6275 6666 6572 7328 7365 6c66  def buffers(self
-00014e00: 2c20 7265 6375 7273 653d 5472 7565 293a  , recurse=True):
-00014e10: 0d0a 2020 2020 2020 2020 7222 2222 5265  ..        r"""Re
-00014e20: 7475 726e 7320 616e 2069 7465 7261 746f  turns an iterato
-00014e30: 7220 6f76 6572 206d 6f64 756c 6520 6275  r over module bu
-00014e40: 6666 6572 732e 0d0a 0d0a 2020 2020 2020  ffers.....      
-00014e50: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-00014e60: 2020 2020 2072 6563 7572 7365 2028 626f       recurse (bo
-00014e70: 6f6c 293a 2069 6620 5472 7565 2c20 7468  ol): if True, th
-00014e80: 656e 2079 6965 6c64 7320 6275 6666 6572  en yields buffer
-00014e90: 7320 6f66 2074 6869 7320 6d6f 6475 6c65  s of this module
-00014ea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014eb0: 2020 616e 6420 616c 6c20 7375 626d 6f64    and all submod
-00014ec0: 756c 6573 2e20 4f74 6865 7277 6973 652c  ules. Otherwise,
-00014ed0: 2079 6965 6c64 7320 6f6e 6c79 2062 7566   yields only buf
-00014ee0: 6665 7273 2074 6861 740d 0a20 2020 2020  fers that..     
-00014ef0: 2020 2020 2020 2020 2020 2061 7265 2064             are d
-00014f00: 6972 6563 7420 6d65 6d62 6572 7320 6f66  irect members of
-00014f10: 2074 6869 7320 6d6f 6475 6c65 2e0d 0a0d   this module....
-00014f20: 0a20 2020 2020 2020 2059 6965 6c64 733a  .        Yields:
-00014f30: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00014f40: 7263 682e 5465 6e73 6f72 3a20 6d6f 6475  rch.Tensor: modu
-00014f50: 6c65 2062 7566 6665 720d 0a0d 0a20 2020  le buffer....   
-00014f60: 2020 2020 2045 7861 6d70 6c65 733a 0d0a       Examples:..
-00014f70: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-00014f80: 3e20 666f 7220 6275 6620 696e 206d 6f64  > for buf in mod
-00014f90: 656c 2e62 7566 6665 7273 2829 3a0d 0a20  el.buffers():.. 
-00014fa0: 2020 2020 2020 2020 2020 203e 3e3e 2020             >>>  
-00014fb0: 2020 2070 7269 6e74 2874 7970 6528 6275     print(type(bu
-00014fc0: 662e 6461 7461 292c 2062 7566 2e73 697a  f.data), buf.siz
-00014fd0: 6528 2929 0d0a 2020 2020 2020 2020 2020  e())..          
-00014fe0: 2020 3c63 6c61 7373 2027 746f 7263 682e    <class 'torch.
-00014ff0: 466c 6f61 7454 656e 736f 7227 3e20 2832  FloatTensor'> (2
-00015000: 304c 2c29 0d0a 2020 2020 2020 2020 2020  0L,)..          
-00015010: 2020 3c63 6c61 7373 2027 746f 7263 682e    <class 'torch.
-00015020: 466c 6f61 7454 656e 736f 7227 3e20 2832  FloatTensor'> (2
-00015030: 304c 2c20 314c 2c20 354c 2c20 354c 290d  0L, 1L, 5L, 5L).
-00015040: 0a0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00015050: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-00015060: 2c20 6275 6620 696e 2073 656c 662e 6e61  , buf in self.na
-00015070: 6d65 645f 6275 6666 6572 7328 7265 6375  med_buffers(recu
-00015080: 7273 653d 7265 6375 7273 6529 3a0d 0a20  rse=recurse):.. 
-00015090: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-000150a0: 2062 7566 0d0a 0d0a 2020 2020 6465 6620   buf....    def 
-000150b0: 6e61 6d65 645f 6275 6666 6572 7328 7365  named_buffers(se
-000150c0: 6c66 2c20 7072 6566 6978 3d27 272c 2072  lf, prefix='', r
-000150d0: 6563 7572 7365 3d54 7275 6529 3a0d 0a20  ecurse=True):.. 
-000150e0: 2020 2020 2020 2072 2222 2252 6574 7572         r"""Retur
-000150f0: 6e73 2061 6e20 6974 6572 6174 6f72 206f  ns an iterator o
-00015100: 7665 7220 6d6f 6475 6c65 2062 7566 6665  ver module buffe
-00015110: 7273 2c20 7969 656c 6469 6e67 2062 6f74  rs, yielding bot
-00015120: 6820 7468 650d 0a20 2020 2020 2020 206e  h the..        n
-00015130: 616d 6520 6f66 2074 6865 2062 7566 6665  ame of the buffe
-00015140: 7220 6173 2077 656c 6c20 6173 2074 6865  r as well as the
-00015150: 2062 7566 6665 7220 6974 7365 6c66 2e0d   buffer itself..
-00015160: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00015170: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00015180: 6566 6978 2028 7374 7229 3a20 7072 6566  efix (str): pref
-00015190: 6978 2074 6f20 7072 6570 656e 6420 746f  ix to prepend to
-000151a0: 2061 6c6c 2062 7566 6665 7220 6e61 6d65   all buffer name
-000151b0: 732e 0d0a 2020 2020 2020 2020 2020 2020  s...            
-000151c0: 7265 6375 7273 6520 2862 6f6f 6c29 3a20  recurse (bool): 
-000151d0: 6966 2054 7275 652c 2074 6865 6e20 7969  if True, then yi
-000151e0: 656c 6473 2062 7566 6665 7273 206f 6620  elds buffers of 
-000151f0: 7468 6973 206d 6f64 756c 650d 0a20 2020  this module..   
-00015200: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00015210: 2061 6c6c 2073 7562 6d6f 6475 6c65 732e   all submodules.
-00015220: 204f 7468 6572 7769 7365 2c20 7969 656c   Otherwise, yiel
-00015230: 6473 206f 6e6c 7920 6275 6666 6572 7320  ds only buffers 
-00015240: 7468 6174 0d0a 2020 2020 2020 2020 2020  that..          
-00015250: 2020 2020 2020 6172 6520 6469 7265 6374        are direct
-00015260: 206d 656d 6265 7273 206f 6620 7468 6973   members of this
-00015270: 206d 6f64 756c 652e 0d0a 0d0a 2020 2020   module.....    
-00015280: 2020 2020 5969 656c 6473 3a0d 0a20 2020      Yields:..   
-00015290: 2020 2020 2020 2020 2028 7374 7269 6e67           (string
-000152a0: 2c20 746f 7263 682e 5465 6e73 6f72 293a  , torch.Tensor):
-000152b0: 2054 7570 6c65 2063 6f6e 7461 696e 696e   Tuple containin
-000152c0: 6720 7468 6520 6e61 6d65 2061 6e64 2062  g the name and b
-000152d0: 7566 6665 720d 0a0d 0a20 2020 2020 2020  uffer....       
-000152e0: 2045 7861 6d70 6c65 733a 0d0a 0d0a 2020   Examples:....  
-000152f0: 2020 2020 2020 2020 2020 3e3e 3e20 666f            >>> fo
-00015300: 7220 6e61 6d65 2c20 6275 6620 696e 2073  r name, buf in s
-00015310: 656c 662e 6e61 6d65 645f 6275 6666 6572  elf.named_buffer
-00015320: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-00015330: 2020 3e3e 3e20 2020 2069 6620 6e61 6d65    >>>    if name
-00015340: 2069 6e20 5b27 7275 6e6e 696e 675f 7661   in ['running_va
-00015350: 7227 5d3a 0d0a 2020 2020 2020 2020 2020  r']:..          
-00015360: 2020 3e3e 3e20 2020 2020 2020 2070 7269    >>>        pri
-00015370: 6e74 2862 7566 2e73 697a 6528 2929 0d0a  nt(buf.size())..
-00015380: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00015390: 2020 2020 2020 2067 656e 203d 2073 656c         gen = sel
-000153a0: 662e 5f6e 616d 6564 5f6d 656d 6265 7273  f._named_members
-000153b0: 286c 616d 6264 6120 6d6f 6475 6c65 3a20  (lambda module: 
-000153c0: 6d6f 6475 6c65 2e5f 6275 6666 6572 732e  module._buffers.
-000153d0: 6974 656d 7328 292c 2070 7265 6669 783d  items(), prefix=
-000153e0: 7072 6566 6978 2c20 7265 6375 7273 653d  prefix, recurse=
-000153f0: 7265 6375 7273 6529 0d0a 2020 2020 2020  recurse)..      
-00015400: 2020 666f 7220 656c 656d 2069 6e20 6765    for elem in ge
-00015410: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00015420: 7969 656c 6420 656c 656d 0d0a 0d0a 2020  yield elem....  
-00015430: 2020 6465 6620 6368 696c 6472 656e 2873    def children(s
-00015440: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-00015450: 2222 2252 6574 7572 6e73 2061 6e20 6974  """Returns an it
-00015460: 6572 6174 6f72 206f 7665 7220 696d 6d65  erator over imme
-00015470: 6469 6174 6520 6368 696c 6472 656e 206d  diate children m
-00015480: 6f64 756c 6573 2e0d 0a0d 0a20 2020 2020  odules.....     
-00015490: 2020 2059 6965 6c64 733a 0d0a 2020 2020     Yields:..    
-000154a0: 2020 2020 2020 2020 4d6f 6475 6c65 3a20          Module: 
-000154b0: 6120 6368 696c 6420 6d6f 6475 6c65 0d0a  a child module..
-000154c0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-000154d0: 2020 2020 2066 6f72 206e 616d 652c 206d       for name, m
-000154e0: 6f64 756c 6520 696e 2073 656c 662e 6e61  odule in self.na
-000154f0: 6d65 645f 6368 696c 6472 656e 2829 3a0d  med_children():.
-00015500: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
-00015510: 6c64 206d 6f64 756c 650d 0a0d 0a20 2020  ld module....   
-00015520: 2064 6566 206e 616d 6564 5f63 6869 6c64   def named_child
-00015530: 7265 6e28 7365 6c66 293a 0d0a 2020 2020  ren(self):..    
-00015540: 2020 2020 7222 2222 5265 7475 726e 7320      r"""Returns 
-00015550: 616e 2069 7465 7261 746f 7220 6f76 6572  an iterator over
-00015560: 2069 6d6d 6564 6961 7465 2063 6869 6c64   immediate child
-00015570: 7265 6e20 6d6f 6475 6c65 732c 2079 6965  ren modules, yie
-00015580: 6c64 696e 6720 626f 7468 0d0a 2020 2020  lding both..    
-00015590: 2020 2020 7468 6520 6e61 6d65 206f 6620      the name of 
-000155a0: 7468 6520 6d6f 6475 6c65 2061 7320 7765  the module as we
-000155b0: 6c6c 2061 7320 7468 6520 6d6f 6475 6c65  ll as the module
-000155c0: 2069 7473 656c 662e 0d0a 0d0a 2020 2020   itself.....    
-000155d0: 2020 2020 5969 656c 6473 3a0d 0a20 2020      Yields:..   
-000155e0: 2020 2020 2020 2020 2028 7374 7269 6e67           (string
-000155f0: 2c20 4d6f 6475 6c65 293a 2054 7570 6c65  , Module): Tuple
-00015600: 2063 6f6e 7461 696e 696e 6720 6120 6e61   containing a na
-00015610: 6d65 2061 6e64 2063 6869 6c64 206d 6f64  me and child mod
-00015620: 756c 650d 0a0d 0a20 2020 2020 2020 2045  ule....        E
-00015630: 7861 6d70 6c65 733a 0d0a 0d0a 2020 2020  xamples:....    
-00015640: 2020 2020 2020 2020 3e3e 3e20 666f 7220          >>> for 
-00015650: 6e61 6d65 2c20 6d6f 6475 6c65 2069 6e20  name, module in 
-00015660: 6d6f 6465 6c2e 6e61 6d65 645f 6368 696c  model.named_chil
-00015670: 6472 656e 2829 3a0d 0a20 2020 2020 2020  dren():..       
-00015680: 2020 2020 203e 3e3e 2020 2020 2069 6620       >>>     if 
-00015690: 6e61 6d65 2069 6e20 5b27 636f 6e76 3427  name in ['conv4'
-000156a0: 2c20 2763 6f6e 7635 275d 3a0d 0a20 2020  , 'conv5']:..   
-000156b0: 2020 2020 2020 2020 203e 3e3e 2020 2020           >>>    
-000156c0: 2020 2020 2070 7269 6e74 286d 6f64 756c       print(modul
-000156d0: 6529 0d0a 0d0a 2020 2020 2020 2020 2222  e)....        ""
-000156e0: 220d 0a20 2020 2020 2020 206d 656d 6f20  "..        memo 
-000156f0: 3d20 7365 7428 290d 0a20 2020 2020 2020  = set()..       
-00015700: 2066 6f72 206e 616d 652c 206d 6f64 756c   for name, modul
-00015710: 6520 696e 2073 656c 662e 5f6d 6f64 756c  e in self._modul
-00015720: 6573 2e69 7465 6d73 2829 3a0d 0a20 2020  es.items():..   
-00015730: 2020 2020 2020 2020 2069 6620 6d6f 6475           if modu
-00015740: 6c65 2069 7320 6e6f 7420 4e6f 6e65 2061  le is not None a
-00015750: 6e64 206d 6f64 756c 6520 6e6f 7420 696e  nd module not in
-00015760: 206d 656d 6f3a 0d0a 2020 2020 2020 2020   memo:..        
-00015770: 2020 2020 2020 2020 6d65 6d6f 2e61 6464          memo.add
-00015780: 286d 6f64 756c 6529 0d0a 2020 2020 2020  (module)..      
-00015790: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-000157a0: 6e61 6d65 2c20 6d6f 6475 6c65 0d0a 0d0a  name, module....
-000157b0: 2020 2020 6465 6620 6d6f 6475 6c65 7328      def modules(
-000157c0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000157d0: 7222 2222 5265 7475 726e 7320 616e 2069  r"""Returns an i
-000157e0: 7465 7261 746f 7220 6f76 6572 2061 6c6c  terator over all
-000157f0: 206d 6f64 756c 6573 2069 6e20 7468 6520   modules in the 
-00015800: 6e65 7477 6f72 6b2e 0d0a 0d0a 2020 2020  network.....    
-00015810: 2020 2020 5969 656c 6473 3a0d 0a20 2020      Yields:..   
-00015820: 2020 2020 2020 2020 204d 6f64 756c 653a           Module:
-00015830: 2061 206d 6f64 756c 6520 696e 2074 6865   a module in the
-00015840: 206e 6574 776f 726b 0d0a 0d0a 2020 2020   network....    
-00015850: 2020 2020 4e6f 7465 3a0d 0a20 2020 2020      Note:..     
-00015860: 2020 2020 2020 2044 7570 6c69 6361 7465         Duplicate
-00015870: 206d 6f64 756c 6573 2061 7265 2072 6574   modules are ret
-00015880: 7572 6e65 6420 6f6e 6c79 206f 6e63 652e  urned only once.
-00015890: 2049 6e20 7468 6520 666f 6c6c 6f77 696e   In the followin
-000158a0: 670d 0a20 2020 2020 2020 2020 2020 2065  g..            e
-000158b0: 7861 6d70 6c65 2c20 6060 6c60 6020 7769  xample, ``l`` wi
-000158c0: 6c6c 2062 6520 7265 7475 726e 6564 206f  ll be returned o
-000158d0: 6e6c 7920 6f6e 6365 2e0d 0a0d 0a20 2020  nly once.....   
-000158e0: 2020 2020 2045 7861 6d70 6c65 733a 0d0a       Examples:..
-000158f0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-00015900: 3e20 6c20 3d20 6e6e 2e4c 696e 6561 7228  > l = nn.Linear(
-00015910: 322c 2032 290d 0a20 2020 2020 2020 2020  2, 2)..         
-00015920: 2020 203e 3e3e 206e 6574 203d 206e 6e2e     >>> net = nn.
-00015930: 5365 7175 656e 7469 616c 286c 2c20 6c29  Sequential(l, l)
-00015940: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-00015950: 3e20 666f 7220 6964 782c 206d 2069 6e20  > for idx, m in 
-00015960: 656e 756d 6572 6174 6528 6e65 742e 6d6f  enumerate(net.mo
-00015970: 6475 6c65 7328 2929 3a0d 0a20 2020 2020  dules()):..     
-00015980: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00015990: 7269 6e74 2869 6478 2c20 272d 3e27 2c20  rint(idx, '->', 
-000159a0: 6d29 0d0a 0d0a 2020 2020 2020 2020 2020  m)....          
-000159b0: 2020 3020 2d3e 2053 6571 7565 6e74 6961    0 -> Sequentia
-000159c0: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
-000159d0: 2020 2830 293a 204c 696e 6561 7228 696e    (0): Linear(in
-000159e0: 5f66 6561 7475 7265 733d 322c 206f 7574  _features=2, out
-000159f0: 5f66 6561 7475 7265 733d 322c 2062 6961  _features=2, bia
-00015a00: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
-00015a10: 2020 2020 2020 2028 3129 3a20 4c69 6e65         (1): Line
-00015a20: 6172 2869 6e5f 6665 6174 7572 6573 3d32  ar(in_features=2
-00015a30: 2c20 6f75 745f 6665 6174 7572 6573 3d32  , out_features=2
-00015a40: 2c20 6269 6173 3d54 7275 6529 0d0a 2020  , bias=True)..  
-00015a50: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00015a60: 2020 2020 2020 2020 2031 202d 3e20 4c69           1 -> Li
-00015a70: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
-00015a80: 3d32 2c20 6f75 745f 6665 6174 7572 6573  =2, out_features
-00015a90: 3d32 2c20 6269 6173 3d54 7275 6529 0d0a  =2, bias=True)..
-00015aa0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00015ab0: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
-00015ac0: 206d 6f64 756c 6520 696e 2073 656c 662e   module in self.
-00015ad0: 6e61 6d65 645f 6d6f 6475 6c65 7328 293a  named_modules():
-00015ae0: 0d0a 2020 2020 2020 2020 2020 2020 7969  ..            yi
-00015af0: 656c 6420 6d6f 6475 6c65 0d0a 0d0a 2020  eld module....  
-00015b00: 2020 6465 6620 6e61 6d65 645f 6d6f 6475    def named_modu
-00015b10: 6c65 7328 7365 6c66 2c20 6d65 6d6f 3d4e  les(self, memo=N
-00015b20: 6f6e 652c 2070 7265 6669 783d 2727 293a  one, prefix=''):
-00015b30: 0d0a 2020 2020 2020 2020 7222 2222 5265  ..        r"""Re
-00015b40: 7475 726e 7320 616e 2069 7465 7261 746f  turns an iterato
-00015b50: 7220 6f76 6572 2061 6c6c 206d 6f64 756c  r over all modul
-00015b60: 6573 2069 6e20 7468 6520 6e65 7477 6f72  es in the networ
-00015b70: 6b2c 2079 6965 6c64 696e 670d 0a20 2020  k, yielding..   
-00015b80: 2020 2020 2062 6f74 6820 7468 6520 6e61       both the na
-00015b90: 6d65 206f 6620 7468 6520 6d6f 6475 6c65  me of the module
-00015ba0: 2061 7320 7765 6c6c 2061 7320 7468 6520   as well as the 
-00015bb0: 6d6f 6475 6c65 2069 7473 656c 662e 0d0a  module itself...
-00015bc0: 0d0a 2020 2020 2020 2020 5969 656c 6473  ..        Yields
-00015bd0: 3a0d 0a20 2020 2020 2020 2020 2020 2028  :..            (
-00015be0: 7374 7269 6e67 2c20 4d6f 6475 6c65 293a  string, Module):
-00015bf0: 2054 7570 6c65 206f 6620 6e61 6d65 2061   Tuple of name a
-00015c00: 6e64 206d 6f64 756c 650d 0a0d 0a20 2020  nd module....   
-00015c10: 2020 2020 204e 6f74 653a 0d0a 2020 2020       Note:..    
-00015c20: 2020 2020 2020 2020 4475 706c 6963 6174          Duplicat
-00015c30: 6520 6d6f 6475 6c65 7320 6172 6520 7265  e modules are re
-00015c40: 7475 726e 6564 206f 6e6c 7920 6f6e 6365  turned only once
-00015c50: 2e20 496e 2074 6865 2066 6f6c 6c6f 7769  . In the followi
-00015c60: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-00015c70: 6578 616d 706c 652c 2060 606c 6060 2077  example, ``l`` w
-00015c80: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
-00015c90: 6f6e 6c79 206f 6e63 652e 0d0a 0d0a 2020  only once.....  
-00015ca0: 2020 2020 2020 4578 616d 706c 6573 3a0d        Examples:.
-00015cb0: 0a0d 0a20 2020 2020 2020 2020 2020 203e  ...            >
-00015cc0: 3e3e 206c 203d 206e 6e2e 4c69 6e65 6172  >> l = nn.Linear
-00015cd0: 2832 2c20 3229 0d0a 2020 2020 2020 2020  (2, 2)..        
-00015ce0: 2020 2020 3e3e 3e20 6e65 7420 3d20 6e6e      >>> net = nn
-00015cf0: 2e53 6571 7565 6e74 6961 6c28 6c2c 206c  .Sequential(l, l
-00015d00: 290d 0a20 2020 2020 2020 2020 2020 203e  )..            >
-00015d10: 3e3e 2066 6f72 2069 6478 2c20 6d20 696e  >> for idx, m in
-00015d20: 2065 6e75 6d65 7261 7465 286e 6574 2e6e   enumerate(net.n
-00015d30: 616d 6564 5f6d 6f64 756c 6573 2829 293a  amed_modules()):
-00015d40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015d50: 2020 2020 2020 7072 696e 7428 6964 782c        print(idx,
-00015d60: 2027 2d3e 272c 206d 290d 0a0d 0a20 2020   '->', m)....   
-00015d70: 2020 2020 2020 2020 2030 202d 3e20 2827           0 -> ('
-00015d80: 272c 2053 6571 7565 6e74 6961 6c28 0d0a  ', Sequential(..
-00015d90: 2020 2020 2020 2020 2020 2020 2020 2830                (0
-00015da0: 293a 204c 696e 6561 7228 696e 5f66 6561  ): Linear(in_fea
-00015db0: 7475 7265 733d 322c 206f 7574 5f66 6561  tures=2, out_fea
-00015dc0: 7475 7265 733d 322c 2062 6961 733d 5472  tures=2, bias=Tr
-00015dd0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00015de0: 2020 2028 3129 3a20 4c69 6e65 6172 2869     (1): Linear(i
-00015df0: 6e5f 6665 6174 7572 6573 3d32 2c20 6f75  n_features=2, ou
-00015e00: 745f 6665 6174 7572 6573 3d32 2c20 6269  t_features=2, bi
-00015e10: 6173 3d54 7275 6529 0d0a 2020 2020 2020  as=True)..      
-00015e20: 2020 2020 2020 2929 0d0a 2020 2020 2020        ))..      
-00015e30: 2020 2020 2020 3120 2d3e 2028 2730 272c        1 -> ('0',
-00015e40: 204c 696e 6561 7228 696e 5f66 6561 7475   Linear(in_featu
-00015e50: 7265 733d 322c 206f 7574 5f66 6561 7475  res=2, out_featu
-00015e60: 7265 733d 322c 2062 6961 733d 5472 7565  res=2, bias=True
-00015e70: 2929 0d0a 0d0a 2020 2020 2020 2020 2222  ))....        ""
-00015e80: 220d 0a0d 0a20 2020 2020 2020 2069 6620  "....        if 
-00015e90: 6d65 6d6f 2069 7320 4e6f 6e65 3a0d 0a20  memo is None:.. 
-00015ea0: 2020 2020 2020 2020 2020 206d 656d 6f20             memo 
-00015eb0: 3d20 7365 7428 290d 0a20 2020 2020 2020  = set()..       
-00015ec0: 2069 6620 7365 6c66 206e 6f74 2069 6e20   if self not in 
-00015ed0: 6d65 6d6f 3a0d 0a20 2020 2020 2020 2020  memo:..         
-00015ee0: 2020 206d 656d 6f2e 6164 6428 7365 6c66     memo.add(self
-00015ef0: 290d 0a20 2020 2020 2020 2020 2020 2079  )..            y
-00015f00: 6965 6c64 2070 7265 6669 782c 2073 656c  ield prefix, sel
-00015f10: 660d 0a20 2020 2020 2020 2020 2020 2066  f..            f
-00015f20: 6f72 206e 616d 652c 206d 6f64 756c 6520  or name, module 
-00015f30: 696e 2073 656c 662e 5f6d 6f64 756c 6573  in self._modules
-00015f40: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-00015f50: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
-00015f60: 6475 6c65 2069 7320 4e6f 6e65 3a0d 0a20  dule is None:.. 
-00015f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f80: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
-00015f90: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00015fa0: 6d6f 6475 6c65 5f70 7265 6669 7820 3d20  module_prefix = 
-00015fb0: 7072 6566 6978 202b 2028 272e 2720 6966  prefix + ('.' if
-00015fc0: 2070 7265 6669 7820 656c 7365 2027 2729   prefix else '')
-00015fd0: 202b 206e 616d 650d 0a20 2020 2020 2020   + name..       
-00015fe0: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
-00015ff0: 6e20 6d6f 6475 6c65 2e6e 616d 6564 5f6d  n module.named_m
-00016000: 6f64 756c 6573 286d 656d 6f2c 2073 7562  odules(memo, sub
-00016010: 6d6f 6475 6c65 5f70 7265 6669 7829 3a0d  module_prefix):.
-00016020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016030: 2020 2020 2079 6965 6c64 206d 0d0a 0d0a       yield m....
-00016040: 2020 2020 6465 6620 7472 6169 6e28 7365      def train(se
-00016050: 6c66 3a20 542c 206d 6f64 653a 2062 6f6f  lf: T, mode: boo
-00016060: 6c20 3d20 5472 7565 2920 2d3e 2054 3a0d  l = True) -> T:.
-00016070: 0a20 2020 2020 2020 2072 2222 2253 6574  .        r"""Set
-00016080: 7320 7468 6520 6d6f 6475 6c65 2069 6e20  s the module in 
-00016090: 7472 6169 6e69 6e67 206d 6f64 652e 0d0a  training mode...
-000160a0: 0d0a 2020 2020 2020 2020 5468 6973 2068  ..        This h
-000160b0: 6173 2061 6e79 2065 6666 6563 7420 6f6e  as any effect on
-000160c0: 6c79 206f 6e20 6365 7274 6169 6e20 6d6f  ly on certain mo
-000160d0: 6475 6c65 732e 2053 6565 2064 6f63 756d  dules. See docum
-000160e0: 656e 7461 7469 6f6e 7320 6f66 0d0a 2020  entations of..  
-000160f0: 2020 2020 2020 7061 7274 6963 756c 6172        particular
-00016100: 206d 6f64 756c 6573 2066 6f72 2064 6574   modules for det
-00016110: 6169 6c73 206f 6620 7468 6569 7220 6265  ails of their be
-00016120: 6861 7669 6f72 7320 696e 2074 7261 696e  haviors in train
-00016130: 696e 672f 6576 616c 7561 7469 6f6e 0d0a  ing/evaluation..
-00016140: 2020 2020 2020 2020 6d6f 6465 2c20 6966          mode, if
-00016150: 2074 6865 7920 6172 6520 6166 6665 6374   they are affect
-00016160: 6564 2c20 652e 672e 203a 636c 6173 733a  ed, e.g. :class:
-00016170: 6044 726f 706f 7574 602c 203a 636c 6173  `Dropout`, :clas
-00016180: 733a 6042 6174 6368 4e6f 726d 602c 0d0a  s:`BatchNorm`,..
-00016190: 2020 2020 2020 2020 6574 632e 0d0a 0d0a          etc.....
-000161a0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
-000161b0: 2020 2020 2020 2020 2020 206d 6f64 6520             mode 
-000161c0: 2862 6f6f 6c29 3a20 7768 6574 6865 7220  (bool): whether 
-000161d0: 746f 2073 6574 2074 7261 696e 696e 6720  to set training 
-000161e0: 6d6f 6465 2028 6060 5472 7565 6060 2920  mode (``True``) 
-000161f0: 6f72 2065 7661 6c75 6174 696f 6e0d 0a20  or evaluation.. 
-00016200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016210: 2020 2020 2020 2020 6d6f 6465 2028 6060          mode (``
-00016220: 4661 6c73 6560 6029 2e20 4465 6661 756c  False``). Defaul
-00016230: 743a 2060 6054 7275 6560 602e 0d0a 0d0a  t: ``True``.....
-00016240: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00016250: 0d0a 2020 2020 2020 2020 2020 2020 4d6f  ..            Mo
-00016260: 6475 6c65 3a20 7365 6c66 0d0a 2020 2020  dule: self..    
-00016270: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00016280: 2073 656c 662e 7472 6169 6e69 6e67 203d   self.training =
-00016290: 206d 6f64 650d 0a20 2020 2020 2020 2066   mode..        f
-000162a0: 6f72 206d 6f64 756c 6520 696e 2073 656c  or module in sel
-000162b0: 662e 6368 696c 6472 656e 2829 3a0d 0a20  f.children():.. 
-000162c0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-000162d0: 652e 7472 6169 6e28 290d 0a20 2020 2020  e.train()..     
-000162e0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-000162f0: 0d0a 2020 2020 6465 6620 6576 616c 2873  ..    def eval(s
-00016300: 656c 663a 2054 2920 2d3e 2054 3a0d 0a20  elf: T) -> T:.. 
-00016310: 2020 2020 2020 2072 2222 2253 6574 7320         r"""Sets 
-00016320: 7468 6520 6d6f 6475 6c65 2069 6e20 6576  the module in ev
-00016330: 616c 7561 7469 6f6e 206d 6f64 652e 0d0a  aluation mode...
-00016340: 0d0a 2020 2020 2020 2020 5468 6973 2068  ..        This h
-00016350: 6173 2061 6e79 2065 6666 6563 7420 6f6e  as any effect on
-00016360: 6c79 206f 6e20 6365 7274 6169 6e20 6d6f  ly on certain mo
-00016370: 6475 6c65 732e 2053 6565 2064 6f63 756d  dules. See docum
-00016380: 656e 7461 7469 6f6e 7320 6f66 0d0a 2020  entations of..  
-00016390: 2020 2020 2020 7061 7274 6963 756c 6172        particular
-000163a0: 206d 6f64 756c 6573 2066 6f72 2064 6574   modules for det
-000163b0: 6169 6c73 206f 6620 7468 6569 7220 6265  ails of their be
-000163c0: 6861 7669 6f72 7320 696e 2074 7261 696e  haviors in train
-000163d0: 696e 672f 6576 616c 7561 7469 6f6e 0d0a  ing/evaluation..
-000163e0: 2020 2020 2020 2020 6d6f 6465 2c20 6966          mode, if
-000163f0: 2074 6865 7920 6172 6520 6166 6665 6374   they are affect
-00016400: 6564 2c20 652e 672e 203a 636c 6173 733a  ed, e.g. :class:
-00016410: 6044 726f 706f 7574 602c 203a 636c 6173  `Dropout`, :clas
-00016420: 733a 6042 6174 6368 4e6f 726d 602c 0d0a  s:`BatchNorm`,..
-00016430: 2020 2020 2020 2020 6574 632e 0d0a 0d0a          etc.....
-00016440: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-00016450: 6571 7569 7661 6c65 6e74 2077 6974 6820  equivalent with 
-00016460: 3a6d 6574 683a 6073 656c 662e 7472 6169  :meth:`self.trai
-00016470: 6e28 4661 6c73 6529 203c 746f 7263 682e  n(False) <torch.
-00016480: 6e6e 2e4d 6f64 756c 652e 7472 6169 6e3e  nn.Module.train>
-00016490: 602e 0d0a 0d0a 2020 2020 2020 2020 5265  `.....        Re
-000164a0: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-000164b0: 2020 2020 4d6f 6475 6c65 3a20 7365 6c66      Module: self
-000164c0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000164d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000164e0: 6c66 2e74 7261 696e 2846 616c 7365 290d  lf.train(False).
-000164f0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00016500: 0d0a 2020 2020 6465 6620 7472 6169 6e61  ..    def traina
-00016510: 626c 655f 7765 6967 6874 7328 7365 6c66  ble_weights(self
-00016520: 2920 2d3e 204c 6973 745b 7466 2e56 6172  ) -> List[tf.Var
-00016530: 6961 626c 655d 3a0d 0a20 2020 2020 2020  iable]:..       
-00016540: 2072 2222 2254 6865 206c 6973 7420 6f66   r"""The list of
-00016550: 2074 7261 696e 6162 6c65 2076 6172 6961   trainable varia
-00016560: 626c 6573 2028 7061 7261 6d65 7465 7273  bles (parameters
-00016570: 2920 6f66 2074 6865 206d 6f64 756c 652e  ) of the module.
-00016580: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00016590: 7465 7273 206f 6620 7468 6973 206d 6f64  ters of this mod
-000165a0: 756c 6520 616e 6420 616c 6c20 6974 7320  ule and all its 
-000165b0: 7375 626d 6f64 756c 6573 2061 7265 2069  submodules are i
-000165c0: 6e63 6c75 6465 642e 0d0a 0d0a 2020 2020  ncluded.....    
-000165d0: 2020 2020 2e2e 206e 6f74 653a 3a0d 0a20      .. note::.. 
-000165e0: 2020 2020 2020 2020 2020 2054 6865 206c             The l
-000165f0: 6973 7420 7265 7475 726e 6564 206d 6179  ist returned may
-00016600: 2063 6f6e 7461 696e 2064 7570 6c69 6361   contain duplica
-00016610: 7465 2070 6172 616d 6574 6572 7320 2865  te parameters (e
-00016620: 2e67 2e20 6f75 7470 7574 0d0a 2020 2020  .g. output..    
-00016630: 2020 2020 2020 2020 6c61 7965 7220 7368          layer sh
-00016640: 6172 6573 2070 6172 616d 6574 6572 7320  ares parameters 
-00016650: 7769 7468 2065 6d62 6564 6469 6e67 7329  with embeddings)
-00016660: 2e20 466f 7220 6d6f 7374 2075 7361 6765  . For most usage
-00016670: 732c 2069 7427 7320 6e6f 740d 0a20 2020  s, it's not..   
-00016680: 2020 2020 2020 2020 206e 6563 6573 7361           necessa
-00016690: 7279 2074 6f20 656e 7375 7265 2075 6e69  ry to ensure uni
-000166a0: 7175 656e 6573 732e 0d0a 0d0a 2020 2020  queness.....    
-000166b0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-000166c0: 2072 6574 7572 6e20 5b78 2066 6f72 2078   return [x for x
-000166d0: 2069 6e20 7365 6c66 2e70 6172 616d 6574   in self.paramet
-000166e0: 6572 7328 2920 6966 2078 2e74 7261 696e  ers() if x.train
-000166f0: 6162 6c65 5d0d 0a0d 0a20 2020 2040 7072  able]....    @pr
-00016700: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-00016710: 6e6f 6e5f 7472 6169 6e61 626c 655f 7765  non_trainable_we
-00016720: 6967 6874 7328 7365 6c66 2920 2d3e 204c  ights(self) -> L
-00016730: 6973 745b 7466 2e56 6172 6961 626c 655d  ist[tf.Variable]
-00016740: 3a0d 0a20 2020 2020 2020 2072 2222 2254  :..        r"""T
-00016750: 6865 206c 6973 7420 6f66 2074 7261 696e  he list of train
-00016760: 6162 6c65 2076 6172 6961 626c 6573 2028  able variables (
-00016770: 7061 7261 6d65 7465 7273 2920 6f66 2074  parameters) of t
-00016780: 6865 206d 6f64 756c 652e 0d0a 2020 2020  he module...    
-00016790: 2020 2020 5061 7261 6d65 7465 7273 206f      Parameters o
-000167a0: 6620 7468 6973 206d 6f64 756c 6520 616e  f this module an
-000167b0: 6420 616c 6c20 6974 7320 7375 626d 6f64  d all its submod
-000167c0: 756c 6573 2061 7265 2069 6e63 6c75 6465  ules are include
-000167d0: 642e 0d0a 2020 2020 2020 2020 2e2e 206e  d...        .. n
-000167e0: 6f74 653a 3a0d 0a20 2020 2020 2020 2020  ote::..         
-000167f0: 2020 2054 6865 206c 6973 7420 7265 7475     The list retu
-00016800: 726e 6564 206d 6179 2063 6f6e 7461 696e  rned may contain
-00016810: 2064 7570 6c69 6361 7465 2070 6172 616d   duplicate param
-00016820: 6574 6572 7320 2865 2e67 2e20 6f75 7470  eters (e.g. outp
-00016830: 7574 0d0a 2020 2020 2020 2020 2020 2020  ut..            
-00016840: 6c61 7965 7220 7368 6172 6573 2070 6172  layer shares par
-00016850: 616d 6574 6572 7320 7769 7468 2065 6d62  ameters with emb
-00016860: 6564 6469 6e67 7329 2e20 466f 7220 6d6f  eddings). For mo
-00016870: 7374 2075 7361 6765 732c 2069 7427 7320  st usages, it's 
-00016880: 6e6f 740d 0a20 2020 2020 2020 2020 2020  not..           
-00016890: 206e 6563 6573 7361 7279 2074 6f20 656e   necessary to en
-000168a0: 7375 7265 2075 6e69 7175 656e 6573 732e  sure uniqueness.
-000168b0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000168c0: 2020 2020 2020 2072 6574 7572 6e20 5b78         return [x
-000168d0: 2066 6f72 2078 2069 6e20 7365 6c66 2e70   for x in self.p
-000168e0: 6172 616d 6574 6572 7328 2920 6966 206e  arameters() if n
-000168f0: 6f74 2078 2e74 7261 696e 6162 6c65 5d0d  ot x.trainable].
-00016900: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00016910: 0d0a 2020 2020 6465 6620 7765 6967 6874  ..    def weight
-00016920: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-00016930: 2020 7265 7475 726e 206c 6973 7428 7365    return list(se
-00016940: 6c66 2e70 6172 616d 6574 6572 7328 2929  lf.parameters())
-00016950: 0d0a 0d0a 2020 2020 6465 6620 6765 745f  ....    def get_
-00016960: 7765 6967 6874 7328 7365 6c66 293a 0d0a  weights(self):..
-00016970: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00016980: 702e 6e75 6d70 7928 2920 666f 7220 7020  p.numpy() for p 
-00016990: 696e 206c 6973 7428 7365 6c66 2e70 6172  in list(self.par
-000169a0: 616d 6574 6572 7328 2929 5d0d 0a0d 0a20  ameters())].... 
-000169b0: 2020 2064 6566 2073 6574 5f77 6569 6768     def set_weigh
-000169c0: 7473 2873 656c 662c 2077 6569 6768 7473  ts(self, weights
-000169d0: 293a 0d0a 2020 2020 2020 2020 7061 7261  ):..        para
-000169e0: 6d73 203d 2073 656c 662e 7765 6967 6874  ms = self.weight
-000169f0: 730d 0a20 2020 2020 2020 2069 6620 6e6f  s..        if no
-00016a00: 7420 7061 7261 6d73 3a0d 0a20 2020 2020  t params:..     
-00016a10: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-00016a20: 2020 2020 2020 2077 6569 6768 745f 7661         weight_va
-00016a30: 6c75 655f 7475 706c 6573 203d 205b 5d0d  lue_tuples = [].
-00016a40: 0a20 2020 2020 2020 2070 6172 616d 5f76  .        param_v
-00016a50: 616c 7565 7320 3d20 5b77 2066 6f72 2077  alues = [w for w
-00016a60: 2069 6e20 7061 7261 6d73 5d0d 0a20 2020   in params]..   
-00016a70: 2020 2020 2066 6f72 2070 762c 2070 2c20       for pv, p, 
-00016a80: 7720 696e 207a 6970 2870 6172 616d 5f76  w in zip(param_v
-00016a90: 616c 7565 732c 2070 6172 616d 732c 2077  alues, params, w
-00016aa0: 6569 6768 7473 293a 0d0a 2020 2020 2020  eights):..      
-00016ab0: 2020 2020 2020 6966 2070 762e 7368 6170        if pv.shap
-00016ac0: 6520 213d 2077 2e73 6861 7065 3a0d 0a20  e != w.shape:.. 
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016ae0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00016af0: 274c 6179 6572 2077 6569 6768 7420 7368  'Layer weight sh
-00016b00: 6170 6520 2720 2b20 7374 7228 7076 2e73  ape ' + str(pv.s
-00016b10: 6861 7065 2920 2b20 2720 6e6f 7420 636f  hape) + ' not co
-00016b20: 6d70 6174 6962 6c65 2077 6974 6820 270d  mpatible with '.
-00016b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012ca0: 2073 656c 662e 5f6f 7574 7075 745f 7465   self._output_te
+00012cb0: 6e73 6f72 203d 2072 6573 756c 740d 0a20  nsor = result.. 
+00012cc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012cd0: 6620 7365 6c66 2e5f 6f75 7470 7574 5f73  f self._output_s
+00012ce0: 6861 7065 2069 7320 4e6f 6e65 206f 7220  hape is None or 
+00012cf0: 6973 5f62 7569 6c74 203d 3d20 4661 6c73  is_built == Fals
+00012d00: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00012d10: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
+00012d20: 2072 6573 756c 740d 0a20 2020 2020 2020   result..       
+00012d30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00012d40: 6973 5f74 656e 736f 7228 6f75 7470 7574  is_tensor(output
+00012d50: 293a 2020 2320 6f6e 6520 6f75 7470 7574  ):  # one output
+00012d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012d70: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00012d80: 6f75 7470 7574 5f73 6861 7065 203d 2074  output_shape = t
+00012d90: 656e 736f 725f 746f 5f73 6861 7065 286f  ensor_to_shape(o
+00012da0: 7574 7075 7429 0d0a 2020 2020 2020 2020  utput)..        
+00012db0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00012dc0: 2069 7369 6e73 7461 6e63 6528 6f75 7470   isinstance(outp
+00012dd0: 7574 2c20 286c 6973 742c 2074 7570 6c65  ut, (list, tuple
+00012de0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00012df0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00012e00: 7075 745f 7368 6170 6520 3d20 7475 706c  put_shape = tupl
+00012e10: 6528 5b74 656e 736f 725f 746f 5f73 6861  e([tensor_to_sha
+00012e20: 7065 2869 7465 6d29 2066 6f72 2069 7465  pe(item) for ite
+00012e30: 6d20 696e 206f 7574 7075 7420 6966 0d0a  m in output if..
+00012e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2020 2020 2020 2020 2020 2020 2020 6974                it
+00012e70: 656d 2069 7320 6e6f 7420 4e6f 6e65 2061  em is not None a
+00012e80: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
+00012e90: 6528 6974 656d 2c20 286c 6973 742c 2074  e(item, (list, t
+00012ea0: 7570 6c65 2929 5d29 0d0a 2020 2020 2020  uple))])..      
+00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ec0: 2020 2320 6966 206e 6f74 2069 7369 6e73    # if not isins
+00012ed0: 7461 6e63 6528 6974 656d 2c20 286c 6973  tance(item, (lis
+00012ee0: 742c 7475 706c 6529 2920 6c73 746d 0d0a  t,tuple)) lstm..
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f00: 2020 2020 2020 2020 7365 6c66 2e5f 6f75          self._ou
+00012f10: 7470 7574 5f73 6861 7065 203d 2075 6e70  tput_shape = unp
+00012f20: 6163 6b5f 7369 6e67 6c65 746f 6e28 6f75  ack_singleton(ou
+00012f30: 7470 7574 5f73 6861 7065 290d 0a0d 0a20  tput_shape).... 
+00012f40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012f50: 6620 5f67 6c6f 6261 6c5f 666f 7277 6172  f _global_forwar
+00012f60: 645f 686f 6f6b 7320 6f72 2073 656c 662e  d_hooks or self.
+00012f70: 5f66 6f72 7761 7264 5f68 6f6f 6b73 3a0d  _forward_hooks:.
+00012f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f90: 2020 2020 2066 6f72 2068 6f6f 6b5f 6964       for hook_id
+00012fa0: 2c20 686f 6f6b 2069 6e20 280d 0a20 2020  , hook in (..   
+00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fc0: 2020 2020 2020 2020 202a 5f67 6c6f 6261           *_globa
+00012fd0: 6c5f 666f 7277 6172 645f 686f 6f6b 732e  l_forward_hooks.
+00012fe0: 6974 656d 7328 292c 0d0a 2020 2020 2020  items(),..      
+00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013000: 2020 2020 2020 2a73 656c 662e 5f66 6f72        *self._for
+00013010: 7761 7264 5f68 6f6f 6b73 2e69 7465 6d73  ward_hooks.items
+00013020: 2829 2c0d 0a20 2020 2020 2020 2020 2020  (),..           
+00013030: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+00013040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013050: 2020 2020 2069 6620 686f 6f6b 5f69 6420       if hook_id 
+00013060: 696e 2073 656c 662e 5f66 6f72 7761 7264  in self._forward
+00013070: 5f68 6f6f 6b73 5f77 6974 685f 6b77 6172  _hooks_with_kwar
+00013080: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
+00013090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130a0: 2068 6f6f 6b5f 7265 7375 6c74 203d 2068   hook_result = h
+000130b0: 6f6f 6b28 7365 6c66 2c20 6172 6773 2c20  ook(self, args, 
+000130c0: 6b77 6172 6773 2c20 7265 7375 6c74 290d  kwargs, result).
+000130d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000130e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000130f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013100: 2020 2020 2020 2020 2020 2020 686f 6f6b              hook
+00013110: 5f72 6573 756c 7420 3d20 686f 6f6b 2873  _result = hook(s
+00013120: 656c 662c 2061 7267 732c 2072 6573 756c  elf, args, resul
+00013130: 7429 0d0a 0d0a 2020 2020 2020 2020 2020  t)....          
+00013140: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013150: 2068 6f6f 6b5f 7265 7375 6c74 2069 7320   hook_result is 
+00013160: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00013170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013180: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00013190: 686f 6f6b 5f72 6573 756c 740d 0a0d 0a20  hook_result.... 
+000131a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000131b0: 2069 6620 6277 5f68 6f6f 6b3a 0d0a 2020   if bw_hook:..  
+000131c0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000131d0: 2020 2020 7265 7375 6c74 203d 2062 775f      result = bw_
+000131e0: 686f 6f6b 2e73 6574 7570 5f6f 7574 7075  hook.setup_outpu
+000131f0: 745f 686f 6f6b 2872 6573 756c 7429 0d0a  t_hook(result)..
+00013200: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00013210: 2069 735f 616c 6c5f 6e75 6d70 7920 3d3d   is_all_numpy ==
+00013220: 2054 7275 6520 616e 6420 7365 6c66 2e74   True and self.t
+00013230: 7261 696e 696e 6720 3d3d 2046 616c 7365  raining == False
+00013240: 2061 6e64 2073 656c 662e 6973 5f72 6f6f   and self.is_roo
+00013250: 7420 3d3d 2054 7275 653a 0d0a 2020 2020  t == True:..    
+00013260: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00013270: 735f 7465 6e73 6f72 2872 6573 756c 7429  s_tensor(result)
+00013280: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00013290: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
+000132a0: 5f6e 756d 7079 2872 6573 756c 7429 0d0a  _numpy(result)..
+000132b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132c0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+000132d0: 7265 7375 6c74 2c20 286c 6973 742c 2074  result, (list, t
+000132e0: 7570 6c65 2929 3a0d 0a20 2020 2020 2020  uple)):..       
+000132f0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00013300: 756c 7420 3d20 6c69 7374 2872 6573 756c  ult = list(resul
+00013310: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00013320: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00013330: 7570 6c65 285b 746f 5f6e 756d 7079 2872  uple([to_numpy(r
+00013340: 6573 2920 6966 2069 735f 7465 6e73 6f72  es) if is_tensor
+00013350: 2872 6573 2920 656c 7365 2072 6573 2066  (res) else res f
+00013360: 6f72 2072 6573 2069 6e20 7265 7375 6c74  or res in result
+00013370: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00013380: 7265 7475 726e 2072 6573 756c 740d 0a20  return result.. 
+00013390: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000133a0: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
+000133b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000133c0: 2827 7b30 7d20 287b 317d 2063 616c 6c20  ('{0} ({1} call 
+000133d0: 6661 696c 6564 2e29 272e 666f 726d 6174  failed.)'.format
+000133e0: 2873 656c 662e 6e61 6d65 2c20 7365 6c66  (self.name, self
+000133f0: 2e64 6566 6175 6c74 5f6e 616d 6529 290d  .default_name)).
+00013400: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00013410: 6e74 2865 290d 0a20 2020 2020 2020 2020  nt(e)..         
+00013420: 2020 2050 7269 6e74 4578 6365 7074 696f     PrintExceptio
+00013430: 6e28 290d 0a20 2020 2020 2020 2020 2020  n()..           
+00013440: 2072 6169 7365 2065 0d0a 0d0a 2020 2020   raise e....    
+00013450: 5f5f 6361 6c6c 5f5f 3a20 4361 6c6c 6162  __call__: Callab
+00013460: 6c65 5b2e 2e2e 2c20 416e 795d 203d 205f  le[..., Any] = _
+00013470: 6361 6c6c 5f69 6d70 6c0d 0a0d 0a20 2020  call_impl....   
+00013480: 2064 6566 205f 5f67 6574 7374 6174 655f   def __getstate_
+00013490: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+000134a0: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+000134b0: 6469 6374 5f5f 0d0a 0d0a 2020 2020 6465  dict__....    de
+000134c0: 6620 5f5f 7365 7473 7461 7465 5f5f 2873  f __setstate__(s
+000134d0: 656c 662c 2073 7461 7465 293a 0d0a 2020  elf, state):..  
+000134e0: 2020 2020 2020 7365 6c66 2e5f 5f64 6963        self.__dic
+000134f0: 745f 5f2e 7570 6461 7465 2873 7461 7465  t__.update(state
+00013500: 290d 0a20 2020 2020 2020 2023 2053 7570  )..        # Sup
+00013510: 706f 7274 206c 6f61 6469 6e67 206f 6c64  port loading old
+00013520: 2063 6865 636b 706f 696e 7473 2074 6861   checkpoints tha
+00013530: 7420 646f 6e27 7420 6861 7665 2074 6865  t don't have the
+00013540: 2066 6f6c 6c6f 7769 6e67 2061 7474 7273   following attrs
+00013550: 3a0d 0a20 2020 2020 2020 2069 6620 275f  :..        if '_
+00013560: 666f 7277 6172 645f 7072 655f 686f 6f6b  forward_pre_hook
+00013570: 7327 206e 6f74 2069 6e20 7365 6c66 2e5f  s' not in self._
+00013580: 5f64 6963 745f 5f3a 0d0a 2020 2020 2020  _dict__:..      
+00013590: 2020 2020 2020 7365 6c66 2e5f 666f 7277        self._forw
+000135a0: 6172 645f 7072 655f 686f 6f6b 7320 3d20  ard_pre_hooks = 
+000135b0: 4f72 6465 7265 6444 6963 7428 290d 0a20  OrderedDict().. 
+000135c0: 2020 2020 2020 2069 6620 275f 7374 6174         if '_stat
+000135d0: 655f 6469 6374 5f68 6f6f 6b73 2720 6e6f  e_dict_hooks' no
+000135e0: 7420 696e 2073 656c 662e 5f5f 6469 6374  t in self.__dict
+000135f0: 5f5f 3a0d 0a20 2020 2020 2020 2020 2020  __:..           
+00013600: 2073 656c 662e 5f73 7461 7465 5f64 6963   self._state_dic
+00013610: 745f 686f 6f6b 7320 3d20 4f72 6465 7265  t_hooks = Ordere
+00013620: 6444 6963 7428 290d 0a20 2020 2020 2020  dDict()..       
+00013630: 2069 6620 275f 6c6f 6164 5f73 7461 7465   if '_load_state
+00013640: 5f64 6963 745f 7072 655f 686f 6f6b 7327  _dict_pre_hooks'
+00013650: 206e 6f74 2069 6e20 7365 6c66 2e5f 5f64   not in self.__d
+00013660: 6963 745f 5f3a 0d0a 2020 2020 2020 2020  ict__:..        
+00013670: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f73      self._load_s
+00013680: 7461 7465 5f64 6963 745f 7072 655f 686f  tate_dict_pre_ho
+00013690: 6f6b 7320 3d20 4f72 6465 7265 6444 6963  oks = OrderedDic
+000136a0: 7428 290d 0a0d 0a20 2020 2064 6566 205f  t()....    def _
+000136b0: 5f67 6574 6174 7472 5f5f 2873 656c 662c  _getattr__(self,
+000136c0: 206e 616d 6529 3a0d 0a20 2020 2020 2020   name):..       
+000136d0: 2069 6620 275f 7061 7261 6d65 7465 7273   if '_parameters
+000136e0: 2720 696e 2073 656c 662e 5f5f 6469 6374  ' in self.__dict
+000136f0: 5f5f 3a0d 0a20 2020 2020 2020 2020 2020  __:..           
+00013700: 205f 7061 7261 6d65 7465 7273 203d 2073   _parameters = s
+00013710: 656c 662e 5f5f 6469 6374 5f5f 5b27 5f70  elf.__dict__['_p
+00013720: 6172 616d 6574 6572 7327 5d0d 0a20 2020  arameters']..   
+00013730: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
+00013740: 2069 6e20 5f70 6172 616d 6574 6572 733a   in _parameters:
+00013750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013760: 2020 7265 7475 726e 205f 7061 7261 6d65    return _parame
+00013770: 7465 7273 5b6e 616d 655d 0d0a 2020 2020  ters[name]..    
+00013780: 2020 2020 6966 2027 5f62 7566 6665 7273      if '_buffers
+00013790: 2720 696e 2073 656c 662e 5f5f 6469 6374  ' in self.__dict
+000137a0: 5f5f 3a0d 0a20 2020 2020 2020 2020 2020  __:..           
+000137b0: 205f 6275 6666 6572 7320 3d20 7365 6c66   _buffers = self
+000137c0: 2e5f 5f64 6963 745f 5f5b 275f 6275 6666  .__dict__['_buff
+000137d0: 6572 7327 5d0d 0a20 2020 2020 2020 2020  ers']..         
+000137e0: 2020 2069 6620 6e61 6d65 2069 6e20 5f62     if name in _b
+000137f0: 7566 6665 7273 3a0d 0a20 2020 2020 2020  uffers:..       
+00013800: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013810: 5f62 7566 6665 7273 5b6e 616d 655d 0d0a  _buffers[name]..
+00013820: 2020 2020 2020 2020 6966 2027 5f6d 6f64          if '_mod
+00013830: 756c 6573 2720 696e 2073 656c 662e 5f5f  ules' in self.__
+00013840: 6469 6374 5f5f 3a0d 0a20 2020 2020 2020  dict__:..       
+00013850: 2020 2020 206d 6f64 756c 6573 203d 2073       modules = s
+00013860: 656c 662e 5f5f 6469 6374 5f5f 5b27 5f6d  elf.__dict__['_m
+00013870: 6f64 756c 6573 275d 0d0a 2020 2020 2020  odules']..      
+00013880: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+00013890: 206d 6f64 756c 6573 3a0d 0a20 2020 2020   modules:..     
+000138a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000138b0: 6e20 6d6f 6475 6c65 735b 6e61 6d65 5d0d  n modules[name].
+000138c0: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
+000138d0: 2069 6e20 7365 6c66 2e5f 5f64 6963 745f   in self.__dict_
+000138e0: 5f3a 0d0a 2020 2020 2020 2020 2020 2020  _:..            
+000138f0: 7265 7475 726e 2073 656c 662e 5f5f 6469  return self.__di
+00013900: 6374 5f5f 5b6e 616d 655d 0d0a 2020 2020  ct__[name]..    
+00013910: 2020 2020 7261 6973 6520 4174 7472 6962      raise Attrib
+00013920: 7574 6545 7272 6f72 2822 277b 7d27 206f  uteError("'{}' o
+00013930: 626a 6563 7420 6861 7320 6e6f 2061 7474  bject has no att
+00013940: 7269 6275 7465 2027 7b7d 2722 2e66 6f72  ribute '{}'".for
+00013950: 6d61 7428 7479 7065 2873 656c 6629 2e5f  mat(type(self)._
+00013960: 5f6e 616d 655f 5f2c 206e 616d 6529 290d  _name__, name)).
+00013970: 0a0d 0a20 2020 2064 6566 205f 5f73 6574  ...    def __set
+00013980: 6174 7472 5f5f 2873 656c 662c 206e 616d  attr__(self, nam
+00013990: 653a 2073 7472 2c20 7661 6c75 653a 2055  e: str, value: U
+000139a0: 6e69 6f6e 5b54 656e 736f 722c 2027 4d6f  nion[Tensor, 'Mo
+000139b0: 6475 6c65 275d 2920 2d3e 204e 6f6e 653a  dule']) -> None:
+000139c0: 0d0a 2020 2020 2020 2020 6465 6620 7265  ..        def re
+000139d0: 6d6f 7665 5f66 726f 6d28 2a64 6963 7473  move_from(*dicts
+000139e0: 5f6f 725f 7365 7473 293a 0d0a 2020 2020  _or_sets):..    
+000139f0: 2020 2020 2020 2020 666f 7220 6420 696e          for d in
+00013a00: 2064 6963 7473 5f6f 725f 7365 7473 3a0d   dicts_or_sets:.
+00013a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a20: 2069 6620 6e61 6d65 2069 6e20 643a 0d0a   if name in d:..
+00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a40: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00013a50: 6528 642c 2064 6963 7429 3a0d 0a20 2020  e(d, dict):..   
+00013a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a70: 2020 2020 2064 656c 2064 5b6e 616d 655d       del d[name]
+00013a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013a90: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ab0: 2020 2020 2064 2e64 6973 6361 7264 286e       d.discard(n
+00013ac0: 616d 6529 0d0a 0d0a 2020 2020 2020 2020  ame)....        
+00013ad0: 7061 7261 6d73 203d 2073 656c 662e 5f5f  params = self.__
+00013ae0: 6469 6374 5f5f 2e67 6574 2827 5f70 6172  dict__.get('_par
+00013af0: 616d 6574 6572 7327 290d 0a20 2020 2020  ameters')..     
+00013b00: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00013b10: 2876 616c 7565 2c20 7466 2e56 6172 6961  (value, tf.Varia
+00013b20: 626c 6529 3a0d 0a20 2020 2020 2020 2020  ble):..         
+00013b30: 2020 2069 6620 7061 7261 6d73 2069 7320     if params is 
+00013b40: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00013b50: 2020 2020 2020 2072 6169 7365 2041 7474         raise Att
+00013b60: 7269 6275 7465 4572 726f 7228 0d0a 2020  ributeError(..  
+00013b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b80: 2020 2263 616e 6e6f 7420 6173 7369 676e    "cannot assign
+00013b90: 2070 6172 616d 6574 6572 7320 6265 666f   parameters befo
+00013ba0: 7265 204d 6f64 756c 652e 5f5f 696e 6974  re Module.__init
+00013bb0: 5f5f 2829 2063 616c 6c22 290d 0a20 2020  __() call")..   
+00013bc0: 2020 2020 2020 2020 2072 656d 6f76 655f           remove_
+00013bd0: 6672 6f6d 2873 656c 662e 5f5f 6469 6374  from(self.__dict
+00013be0: 5f5f 2c20 7365 6c66 2e5f 6275 6666 6572  __, self._buffer
+00013bf0: 732c 2073 656c 662e 5f6d 6f64 756c 6573  s, self._modules
+00013c00: 2c20 7365 6c66 2e5f 6e6f 6e5f 7065 7273  , self._non_pers
+00013c10: 6973 7465 6e74 5f62 7566 6665 7273 5f73  istent_buffers_s
+00013c20: 6574 290d 0a20 2020 2020 2020 2020 2020  et)..           
+00013c30: 2073 656c 662e 7265 6769 7374 6572 5f70   self.register_p
+00013c40: 6172 616d 6574 6572 286e 616d 652c 2076  arameter(name, v
+00013c50: 616c 7565 290d 0a20 2020 2020 2020 2065  alue)..        e
+00013c60: 6c69 6620 7061 7261 6d73 2069 7320 6e6f  lif params is no
+00013c70: 7420 4e6f 6e65 2061 6e64 206e 616d 6520  t None and name 
+00013c80: 696e 2070 6172 616d 733a 0d0a 2020 2020  in params:..    
+00013c90: 2020 2020 2020 2020 6966 2076 616c 7565          if value
+00013ca0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00013cb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00013cc0: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+00013cd0: 6361 6e6e 6f74 2061 7373 6967 6e20 277b  cannot assign '{
+00013ce0: 7d27 2061 7320 7061 7261 6d65 7465 7220  }' as parameter 
+00013cf0: 277b 7d27 2022 0d0a 2020 2020 2020 2020  '{}' "..        
+00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d10: 2020 2020 2020 2020 2228 746f 7263 682e          "(torch.
+00013d20: 6e6e 2e50 6172 616d 6574 6572 206f 7220  nn.Parameter or 
+00013d30: 4e6f 6e65 2065 7870 6563 7465 6429 220d  None expected)".
+00013d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d60: 202e 666f 726d 6174 2876 616c 7565 2c20   .format(value, 
+00013d70: 6e61 6d65 2929 0d0a 2020 2020 2020 2020  name))..        
+00013d80: 2020 2020 7365 6c66 2e72 6567 6973 7465      self.registe
+00013d90: 725f 7061 7261 6d65 7465 7228 6e61 6d65  r_parameter(name
+00013da0: 2c20 7661 6c75 6529 0d0a 2020 2020 2020  , value)..      
+00013db0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00013dc0: 2020 2020 206d 6f64 756c 6573 203d 2073       modules = s
+00013dd0: 656c 662e 5f5f 6469 6374 5f5f 2e67 6574  elf.__dict__.get
+00013de0: 2827 5f6d 6f64 756c 6573 2729 0d0a 2020  ('_modules')..  
+00013df0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00013e00: 6e73 7461 6e63 6528 7661 6c75 652c 2074  nstance(value, t
+00013e10: 662e 4d6f 6475 6c65 293a 0d0a 2020 2020  f.Module):..    
+00013e20: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00013e30: 6f64 756c 6573 2069 7320 4e6f 6e65 3a0d  odules is None:.
+00013e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e50: 2020 2020 2072 6169 7365 2041 7474 7269       raise Attri
+00013e60: 6275 7465 4572 726f 7228 0d0a 2020 2020  buteError(..    
+00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e80: 2020 2020 2263 616e 6e6f 7420 6173 7369      "cannot assi
+00013e90: 676e 206d 6f64 756c 6520 6265 666f 7265  gn module before
+00013ea0: 204d 6f64 756c 652e 5f5f 696e 6974 5f5f   Module.__init__
+00013eb0: 2829 2063 616c 6c22 290d 0a20 2020 2020  () call")..     
+00013ec0: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00013ed0: 655f 6672 6f6d 2873 656c 662e 5f5f 6469  e_from(self.__di
+00013ee0: 6374 5f5f 2c20 7365 6c66 2e5f 7061 7261  ct__, self._para
+00013ef0: 6d65 7465 7273 2c20 7365 6c66 2e5f 6275  meters, self._bu
+00013f00: 6666 6572 732c 2073 656c 662e 5f6e 6f6e  ffers, self._non
+00013f10: 5f70 6572 7369 7374 656e 745f 6275 6666  _persistent_buff
+00013f20: 6572 735f 7365 7429 0d0a 2020 2020 2020  ers_set)..      
+00013f30: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+00013f40: 735b 6e61 6d65 5d20 3d20 7661 6c75 650d  s[name] = value.
+00013f50: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00013f60: 6620 6d6f 6475 6c65 7320 6973 206e 6f74  f modules is not
+00013f70: 204e 6f6e 6520 616e 6420 6e61 6d65 2069   None and name i
+00013f80: 6e20 6d6f 6475 6c65 733a 0d0a 2020 2020  n modules:..    
+00013f90: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+00013fa0: 616c 7565 2069 7320 6e6f 7420 4e6f 6e65  alue is not None
+00013fb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00013fc0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00013fd0: 6545 7272 6f72 2822 6361 6e6e 6f74 2061  eError("cannot a
+00013fe0: 7373 6967 6e20 277b 7d27 2061 7320 6368  ssign '{}' as ch
+00013ff0: 696c 6420 6d6f 6475 6c65 2027 7b7d 2720  ild module '{}' 
+00014000: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+00014010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014020: 2020 2020 2020 2022 2874 6f72 6368 2e6e         "(torch.n
+00014030: 6e2e 4d6f 6475 6c65 206f 7220 4e6f 6e65  n.Module or None
+00014040: 2065 7870 6563 7465 6429 220d 0a20 2020   expected)"..   
+00014050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014070: 202e 666f 726d 6174 2876 616c 7565 2c20   .format(value, 
+00014080: 6e61 6d65 2929 0d0a 2020 2020 2020 2020  name))..        
+00014090: 2020 2020 2020 2020 6d6f 6475 6c65 735b          modules[
+000140a0: 6e61 6d65 5d20 3d20 7661 6c75 650d 0a20  name] = value.. 
+000140b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000140c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000140d0: 2020 6275 6666 6572 7320 3d20 7365 6c66    buffers = self
+000140e0: 2e5f 5f64 6963 745f 5f2e 6765 7428 275f  .__dict__.get('_
+000140f0: 6275 6666 6572 7327 290d 0a20 2020 2020  buffers')..     
+00014100: 2020 2020 2020 2020 2020 2069 6620 6275             if bu
+00014110: 6666 6572 7320 6973 206e 6f74 204e 6f6e  ffers is not Non
+00014120: 6520 616e 6420 6e61 6d65 2069 6e20 6275  e and name in bu
+00014130: 6666 6572 733a 0d0a 2020 2020 2020 2020  ffers:..        
+00014140: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+00014150: 616c 7565 2069 7320 6e6f 7420 4e6f 6e65  alue is not None
+00014160: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
+00014170: 6e63 6528 7661 6c75 652c 2074 662e 5465  nce(value, tf.Te
+00014180: 6e73 6f72 293a 0d0a 2020 2020 2020 2020  nsor):..        
+00014190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141a0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+000141b0: 2263 616e 6e6f 7420 6173 7369 676e 2027  "cannot assign '
+000141c0: 7b7d 2720 6173 2062 7566 6665 7220 277b  {}' as buffer '{
+000141d0: 7d27 2022 0d0a 2020 2020 2020 2020 2020  }' "..          
+000141e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141f0: 2020 2020 2020 2020 2020 2020 2020 2228                "(
+00014200: 746f 7263 682e 5465 6e73 6f72 206f 7220  torch.Tensor or 
+00014210: 4e6f 6e65 2065 7870 6563 7465 6429 220d  None expected)".
+00014220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014240: 2020 2020 2020 2020 202e 666f 726d 6174           .format
+00014250: 2876 616c 7565 2c20 6e61 6d65 2929 0d0a  (value, name))..
+00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014270: 2020 2020 6275 6666 6572 735b 6e61 6d65      buffers[name
+00014280: 5d20 3d20 7661 6c75 650d 0a20 2020 2020  ] = value..     
+00014290: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000142a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000142b0: 2020 2020 2020 6f62 6a65 6374 2e5f 5f73        object.__s
+000142c0: 6574 6174 7472 5f5f 2873 656c 662c 206e  etattr__(self, n
+000142d0: 616d 652c 2076 616c 7565 290d 0a0d 0a20  ame, value).... 
+000142e0: 2020 2064 6566 205f 5f64 656c 6174 7472     def __delattr
+000142f0: 5f5f 2873 656c 662c 206e 616d 6529 3a0d  __(self, name):.
+00014300: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
+00014310: 2069 6e20 7365 6c66 2e5f 7061 7261 6d65   in self._parame
+00014320: 7465 7273 3a0d 0a20 2020 2020 2020 2020  ters:..         
+00014330: 2020 2064 656c 2073 656c 662e 5f70 6172     del self._par
+00014340: 616d 6574 6572 735b 6e61 6d65 5d0d 0a20  ameters[name].. 
+00014350: 2020 2020 2020 2065 6c69 6620 6e61 6d65         elif name
+00014360: 2069 6e20 7365 6c66 2e5f 6275 6666 6572   in self._buffer
+00014370: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00014380: 6465 6c20 7365 6c66 2e5f 6275 6666 6572  del self._buffer
+00014390: 735b 6e61 6d65 5d0d 0a20 2020 2020 2020  s[name]..       
+000143a0: 2065 6c69 6620 6e61 6d65 2069 6e20 7365   elif name in se
+000143b0: 6c66 2e5f 6d6f 6475 6c65 733a 0d0a 2020  lf._modules:..  
+000143c0: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
+000143d0: 6c66 2e5f 6d6f 6475 6c65 735b 6e61 6d65  lf._modules[name
+000143e0: 5d0d 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
+000143f0: 0d0a 2020 2020 2020 2020 2020 2020 6f62  ..            ob
+00014400: 6a65 6374 2e5f 5f64 656c 6174 7472 5f5f  ject.__delattr__
+00014410: 2873 656c 662c 206e 616d 6529 0d0a 0d0a  (self, name)....
+00014420: 2020 2020 6465 6620 5f6e 616d 6564 5f6d      def _named_m
+00014430: 656d 6265 7273 2873 656c 662c 2067 6574  embers(self, get
+00014440: 5f6d 656d 6265 7273 5f66 6e2c 2070 7265  _members_fn, pre
+00014450: 6669 783d 2727 2c20 7265 6375 7273 653d  fix='', recurse=
+00014460: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
+00014470: 7222 2222 4865 6c70 6572 206d 6574 686f  r"""Helper metho
+00014480: 6420 666f 7220 7969 656c 6469 6e67 2076  d for yielding v
+00014490: 6172 696f 7573 206e 616d 6573 202b 206d  arious names + m
+000144a0: 656d 6265 7273 206f 6620 6d6f 6475 6c65  embers of module
+000144b0: 732e 2222 220d 0a20 2020 2020 2020 206d  s."""..        m
+000144c0: 656d 6f20 3d20 7365 7428 290d 0a20 2020  emo = set()..   
+000144d0: 2020 2020 206d 6f64 756c 6573 203d 2073       modules = s
+000144e0: 656c 662e 6e61 6d65 645f 6d6f 6475 6c65  elf.named_module
+000144f0: 7328 7072 6566 6978 3d70 7265 6669 7829  s(prefix=prefix)
+00014500: 2069 6620 7265 6375 7273 6520 656c 7365   if recurse else
+00014510: 205b 2870 7265 6669 782c 2073 656c 6629   [(prefix, self)
+00014520: 5d0d 0a20 2020 2020 2020 2066 6f72 206d  ]..        for m
+00014530: 6f64 756c 655f 7072 6566 6978 2c20 6d6f  odule_prefix, mo
+00014540: 6475 6c65 2069 6e20 6d6f 6475 6c65 733a  dule in modules:
+00014550: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00014560: 6d62 6572 7320 3d20 6765 745f 6d65 6d62  mbers = get_memb
+00014570: 6572 735f 666e 286d 6f64 756c 6529 0d0a  ers_fn(module)..
+00014580: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00014590: 6b2c 2076 2069 6e20 6d65 6d62 6572 733a  k, v in members:
+000145a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000145b0: 2020 6973 7465 6e73 6f72 203d 2069 735f    istensor = is_
+000145c0: 7465 6e73 6f72 2876 290d 0a20 2020 2020  tensor(v)..     
+000145d0: 2020 2020 2020 2020 2020 206b 6579 203d             key =
+000145e0: 2076 2e72 6566 2829 2069 6620 6973 7465   v.ref() if iste
+000145f0: 6e73 6f72 2065 6c73 6520 760d 0a20 2020  nsor else v..   
+00014600: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014610: 7620 6973 204e 6f6e 6520 6f72 206b 6579  v is None or key
+00014620: 2069 6e20 6d65 6d6f 3a0d 0a20 2020 2020   in memo:..     
+00014630: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00014640: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
+00014650: 2020 2020 2020 2020 206d 656d 6f2e 6164           memo.ad
+00014660: 6428 6b65 7929 0d0a 2020 2020 2020 2020  d(key)..        
+00014670: 2020 2020 2020 2020 6e61 6d65 203d 206d          name = m
+00014680: 6f64 756c 655f 7072 6566 6978 202b 2028  odule_prefix + (
+00014690: 272e 2720 6966 206d 6f64 756c 655f 7072  '.' if module_pr
+000146a0: 6566 6978 2065 6c73 6520 2727 2920 2b20  efix else '') + 
+000146b0: 6b0d 0a20 2020 2020 2020 2020 2020 2020  k..             
+000146c0: 2020 2079 6965 6c64 206e 616d 652c 2076     yield name, v
+000146d0: 0d0a 0d0a 2020 2020 6465 6620 7061 7261  ....    def para
+000146e0: 6d65 7465 7273 2873 656c 662c 2072 6563  meters(self, rec
+000146f0: 7572 7365 3d54 7275 6529 3a0d 0a20 2020  urse=True):..   
+00014700: 2020 2020 2072 2222 2252 6574 7572 6e73       r"""Returns
+00014710: 2061 6e20 6974 6572 6174 6f72 206f 7665   an iterator ove
+00014720: 7220 6d6f 6475 6c65 2070 6172 616d 6574  r module paramet
+00014730: 6572 732e 0d0a 0d0a 2020 2020 2020 2020  ers.....        
+00014740: 5468 6973 2069 7320 7479 7069 6361 6c6c  This is typicall
+00014750: 7920 7061 7373 6564 2074 6f20 616e 206f  y passed to an o
+00014760: 7074 696d 697a 6572 2e0d 0a0d 0a20 2020  ptimizer.....   
+00014770: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
+00014780: 2020 2020 2020 2020 7265 6375 7273 6520          recurse 
+00014790: 2862 6f6f 6c29 3a20 6966 2054 7275 652c  (bool): if True,
+000147a0: 2074 6865 6e20 7969 656c 6473 2070 6172   then yields par
+000147b0: 616d 6574 6572 7320 6f66 2074 6869 7320  ameters of this 
+000147c0: 6d6f 6475 6c65 0d0a 2020 2020 2020 2020  module..        
+000147d0: 2020 2020 2020 2020 616e 6420 616c 6c20          and all 
+000147e0: 7375 626d 6f64 756c 6573 2e20 4f74 6865  submodules. Othe
+000147f0: 7277 6973 652c 2079 6965 6c64 7320 6f6e  rwise, yields on
+00014800: 6c79 2070 6172 616d 6574 6572 7320 7468  ly parameters th
+00014810: 6174 0d0a 2020 2020 2020 2020 2020 2020  at..            
+00014820: 2020 2020 6172 6520 6469 7265 6374 206d      are direct m
+00014830: 656d 6265 7273 206f 6620 7468 6973 206d  embers of this m
+00014840: 6f64 756c 652e 0d0a 0d0a 2020 2020 2020  odule.....      
+00014850: 2020 5969 656c 6473 3a0d 0a20 2020 2020    Yields:..     
+00014860: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00014870: 3a20 6d6f 6475 6c65 2070 6172 616d 6574  : module paramet
+00014880: 6572 0d0a 0d0a 2020 2020 2020 2020 4578  er....        Ex
+00014890: 616d 706c 6573 3a0d 0a0d 0a20 2020 2020  amples:....     
+000148a0: 2020 2020 2020 203e 3e3e 2066 6f72 2070         >>> for p
+000148b0: 6172 616d 2069 6e20 6d6f 6465 6c2e 7061  aram in model.pa
+000148c0: 7261 6d65 7465 7273 2829 3a0d 0a20 2020  rameters():..   
+000148d0: 2020 2020 2020 2020 203e 3e3e 2020 2020           >>>    
+000148e0: 2070 7269 6e74 2874 7970 6528 7061 7261   print(type(para
+000148f0: 6d2e 6461 7461 292c 2070 6172 616d 2e73  m.data), param.s
+00014900: 697a 6528 2929 0d0a 2020 2020 2020 2020  ize())..        
+00014910: 2020 2020 3c63 6c61 7373 2027 746f 7263      <class 'torc
+00014920: 682e 466c 6f61 7454 656e 736f 7227 3e20  h.FloatTensor'> 
+00014930: 2832 304c 2c29 0d0a 2020 2020 2020 2020  (20L,)..        
+00014940: 2020 2020 3c63 6c61 7373 2027 746f 7263      <class 'torc
+00014950: 682e 466c 6f61 7454 656e 736f 7227 3e20  h.FloatTensor'> 
+00014960: 2832 304c 2c20 314c 2c20 354c 2c20 354c  (20L, 1L, 5L, 5L
+00014970: 290d 0a0d 0a20 2020 2020 2020 2022 2222  )....        """
+00014980: 0d0a 2020 2020 2020 2020 666f 7220 6e61  ..        for na
+00014990: 6d65 2c20 7061 7261 6d20 696e 2073 656c  me, param in sel
+000149a0: 662e 6e61 6d65 645f 7061 7261 6d65 7465  f.named_paramete
+000149b0: 7273 2872 6563 7572 7365 3d72 6563 7572  rs(recurse=recur
+000149c0: 7365 293a 0d0a 2020 2020 2020 2020 2020  se):..          
+000149d0: 2020 7969 656c 6420 7061 7261 6d0d 0a0d    yield param...
+000149e0: 0a20 2020 2064 6566 206e 616d 6564 5f70  .    def named_p
+000149f0: 6172 616d 6574 6572 7328 7365 6c66 2c20  arameters(self, 
+00014a00: 7072 6566 6978 3a20 7374 7220 3d20 2727  prefix: str = ''
+00014a10: 2c20 7265 6375 7273 653a 2062 6f6f 6c20  , recurse: bool 
+00014a20: 3d20 5472 7565 2920 2d3e 2049 7465 7261  = True) -> Itera
+00014a30: 746f 725b 5475 706c 655b 7374 722c 2054  tor[Tuple[str, T
+00014a40: 656e 736f 725d 5d3a 0d0a 2020 2020 2020  ensor]]:..      
+00014a50: 2020 7222 2222 5265 7475 726e 7320 616e    r"""Returns an
+00014a60: 2069 7465 7261 746f 7220 6f76 6572 206d   iterator over m
+00014a70: 6f64 756c 6520 7061 7261 6d65 7465 7273  odule parameters
+00014a80: 2c20 7969 656c 6469 6e67 2062 6f74 6820  , yielding both 
+00014a90: 7468 650d 0a20 2020 2020 2020 206e 616d  the..        nam
+00014aa0: 6520 6f66 2074 6865 2070 6172 616d 6574  e of the paramet
+00014ab0: 6572 2061 7320 7765 6c6c 2061 7320 7468  er as well as th
+00014ac0: 6520 7061 7261 6d65 7465 7220 6974 7365  e parameter itse
+00014ad0: 6c66 2e0d 0a0d 0a20 2020 2020 2020 2041  lf.....        A
+00014ae0: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+00014af0: 2020 7072 6566 6978 2028 7374 7229 3a20    prefix (str): 
+00014b00: 7072 6566 6978 2074 6f20 7072 6570 656e  prefix to prepen
+00014b10: 6420 746f 2061 6c6c 2070 6172 616d 6574  d to all paramet
+00014b20: 6572 206e 616d 6573 2e0d 0a20 2020 2020  er names...     
+00014b30: 2020 2020 2020 2072 6563 7572 7365 2028         recurse (
+00014b40: 626f 6f6c 293a 2069 6620 5472 7565 2c20  bool): if True, 
+00014b50: 7468 656e 2079 6965 6c64 7320 7061 7261  then yields para
+00014b60: 6d65 7465 7273 206f 6620 7468 6973 206d  meters of this m
+00014b70: 6f64 756c 650d 0a20 2020 2020 2020 2020  odule..         
+00014b80: 2020 2020 2020 2061 6e64 2061 6c6c 2073         and all s
+00014b90: 7562 6d6f 6475 6c65 732e 204f 7468 6572  ubmodules. Other
+00014ba0: 7769 7365 2c20 7969 656c 6473 206f 6e6c  wise, yields onl
+00014bb0: 7920 7061 7261 6d65 7465 7273 2074 6861  y parameters tha
+00014bc0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00014bd0: 2020 2061 7265 2064 6972 6563 7420 6d65     are direct me
+00014be0: 6d62 6572 7320 6f66 2074 6869 7320 6d6f  mbers of this mo
+00014bf0: 6475 6c65 2e0d 0a0d 0a20 2020 2020 2020  dule.....       
+00014c00: 2059 6965 6c64 733a 0d0a 2020 2020 2020   Yields:..      
+00014c10: 2020 2020 2020 2873 7472 696e 672c 2050        (string, P
+00014c20: 6172 616d 6574 6572 293a 2054 7570 6c65  arameter): Tuple
+00014c30: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+00014c40: 6e61 6d65 2061 6e64 2070 6172 616d 6574  name and paramet
+00014c50: 6572 0d0a 0d0a 2020 2020 2020 2020 4578  er....        Ex
+00014c60: 616d 706c 653a 3a0d 0a0d 0a20 2020 2020  ample::....     
+00014c70: 2020 2020 2020 203e 3e3e 2066 6f72 206e         >>> for n
+00014c80: 616d 652c 2070 6172 616d 2069 6e20 7365  ame, param in se
+00014c90: 6c66 2e6e 616d 6564 5f70 6172 616d 6574  lf.named_paramet
+00014ca0: 6572 7328 293a 0d0a 2020 2020 2020 2020  ers():..        
+00014cb0: 2020 2020 3e3e 3e20 2020 2069 6620 6e61      >>>    if na
+00014cc0: 6d65 2069 6e20 5b27 6269 6173 275d 3a0d  me in ['bias']:.
+00014cd0: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+00014ce0: 2020 2020 2020 2020 7072 696e 7428 7061          print(pa
+00014cf0: 7261 6d2e 7369 7a65 2829 290d 0a0d 0a20  ram.size()).... 
+00014d00: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00014d10: 2020 2020 6765 6e20 3d20 7365 6c66 2e5f      gen = self._
+00014d20: 6e61 6d65 645f 6d65 6d62 6572 7328 0d0a  named_members(..
+00014d30: 2020 2020 2020 2020 2020 2020 6c61 6d62              lamb
+00014d40: 6461 206d 6f64 756c 653a 206d 6f64 756c  da module: modul
+00014d50: 652e 5f70 6172 616d 6574 6572 732e 6974  e._parameters.it
+00014d60: 656d 7328 292c 0d0a 2020 2020 2020 2020  ems(),..        
+00014d70: 2020 2020 7072 6566 6978 3d70 7265 6669      prefix=prefi
+00014d80: 782c 2072 6563 7572 7365 3d72 6563 7572  x, recurse=recur
+00014d90: 7365 290d 0a20 2020 2020 2020 2066 6f72  se)..        for
+00014da0: 2065 6c65 6d20 696e 2067 656e 3a0d 0a20   elem in gen:.. 
+00014db0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00014dc0: 2065 6c65 6d0d 0a0d 0a20 2020 2064 6566   elem....    def
+00014dd0: 2062 7566 6665 7273 2873 656c 662c 2072   buffers(self, r
+00014de0: 6563 7572 7365 3d54 7275 6529 3a0d 0a20  ecurse=True):.. 
+00014df0: 2020 2020 2020 2072 2222 2252 6574 7572         r"""Retur
+00014e00: 6e73 2061 6e20 6974 6572 6174 6f72 206f  ns an iterator o
+00014e10: 7665 7220 6d6f 6475 6c65 2062 7566 6665  ver module buffe
+00014e20: 7273 2e0d 0a0d 0a20 2020 2020 2020 2041  rs.....        A
+00014e30: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+00014e40: 2020 7265 6375 7273 6520 2862 6f6f 6c29    recurse (bool)
+00014e50: 3a20 6966 2054 7275 652c 2074 6865 6e20  : if True, then 
+00014e60: 7969 656c 6473 2062 7566 6665 7273 206f  yields buffers o
+00014e70: 6620 7468 6973 206d 6f64 756c 650d 0a20  f this module.. 
+00014e80: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00014e90: 6e64 2061 6c6c 2073 7562 6d6f 6475 6c65  nd all submodule
+00014ea0: 732e 204f 7468 6572 7769 7365 2c20 7969  s. Otherwise, yi
+00014eb0: 656c 6473 206f 6e6c 7920 6275 6666 6572  elds only buffer
+00014ec0: 7320 7468 6174 0d0a 2020 2020 2020 2020  s that..        
+00014ed0: 2020 2020 2020 2020 6172 6520 6469 7265          are dire
+00014ee0: 6374 206d 656d 6265 7273 206f 6620 7468  ct members of th
+00014ef0: 6973 206d 6f64 756c 652e 0d0a 0d0a 2020  is module.....  
+00014f00: 2020 2020 2020 5969 656c 6473 3a0d 0a20        Yields:.. 
+00014f10: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+00014f20: 2e54 656e 736f 723a 206d 6f64 756c 6520  .Tensor: module 
+00014f30: 6275 6666 6572 0d0a 0d0a 2020 2020 2020  buffer....      
+00014f40: 2020 4578 616d 706c 6573 3a0d 0a0d 0a20    Examples:.... 
+00014f50: 2020 2020 2020 2020 2020 203e 3e3e 2066             >>> f
+00014f60: 6f72 2062 7566 2069 6e20 6d6f 6465 6c2e  or buf in model.
+00014f70: 6275 6666 6572 7328 293a 0d0a 2020 2020  buffers():..    
+00014f80: 2020 2020 2020 2020 3e3e 3e20 2020 2020          >>>     
+00014f90: 7072 696e 7428 7479 7065 2862 7566 2e64  print(type(buf.d
+00014fa0: 6174 6129 2c20 6275 662e 7369 7a65 2829  ata), buf.size()
+00014fb0: 290d 0a20 2020 2020 2020 2020 2020 203c  )..            <
+00014fc0: 636c 6173 7320 2774 6f72 6368 2e46 6c6f  class 'torch.Flo
+00014fd0: 6174 5465 6e73 6f72 273e 2028 3230 4c2c  atTensor'> (20L,
+00014fe0: 290d 0a20 2020 2020 2020 2020 2020 203c  )..            <
+00014ff0: 636c 6173 7320 2774 6f72 6368 2e46 6c6f  class 'torch.Flo
+00015000: 6174 5465 6e73 6f72 273e 2028 3230 4c2c  atTensor'> (20L,
+00015010: 2031 4c2c 2035 4c2c 2035 4c29 0d0a 0d0a   1L, 5L, 5L)....
+00015020: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00015030: 2020 2020 2066 6f72 206e 616d 652c 2062       for name, b
+00015040: 7566 2069 6e20 7365 6c66 2e6e 616d 6564  uf in self.named
+00015050: 5f62 7566 6665 7273 2872 6563 7572 7365  _buffers(recurse
+00015060: 3d72 6563 7572 7365 293a 0d0a 2020 2020  =recurse):..    
+00015070: 2020 2020 2020 2020 7969 656c 6420 6275          yield bu
+00015080: 660d 0a0d 0a20 2020 2064 6566 206e 616d  f....    def nam
+00015090: 6564 5f62 7566 6665 7273 2873 656c 662c  ed_buffers(self,
+000150a0: 2070 7265 6669 783d 2727 2c20 7265 6375   prefix='', recu
+000150b0: 7273 653d 5472 7565 293a 0d0a 2020 2020  rse=True):..    
+000150c0: 2020 2020 7222 2222 5265 7475 726e 7320      r"""Returns 
+000150d0: 616e 2069 7465 7261 746f 7220 6f76 6572  an iterator over
+000150e0: 206d 6f64 756c 6520 6275 6666 6572 732c   module buffers,
+000150f0: 2079 6965 6c64 696e 6720 626f 7468 2074   yielding both t
+00015100: 6865 0d0a 2020 2020 2020 2020 6e61 6d65  he..        name
+00015110: 206f 6620 7468 6520 6275 6666 6572 2061   of the buffer a
+00015120: 7320 7765 6c6c 2061 7320 7468 6520 6275  s well as the bu
+00015130: 6666 6572 2069 7473 656c 662e 0d0a 0d0a  ffer itself.....
+00015140: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+00015150: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00015160: 7820 2873 7472 293a 2070 7265 6669 7820  x (str): prefix 
+00015170: 746f 2070 7265 7065 6e64 2074 6f20 616c  to prepend to al
+00015180: 6c20 6275 6666 6572 206e 616d 6573 2e0d  l buffer names..
+00015190: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
+000151a0: 7572 7365 2028 626f 6f6c 293a 2069 6620  urse (bool): if 
+000151b0: 5472 7565 2c20 7468 656e 2079 6965 6c64  True, then yield
+000151c0: 7320 6275 6666 6572 7320 6f66 2074 6869  s buffers of thi
+000151d0: 7320 6d6f 6475 6c65 0d0a 2020 2020 2020  s module..      
+000151e0: 2020 2020 2020 2020 2020 616e 6420 616c            and al
+000151f0: 6c20 7375 626d 6f64 756c 6573 2e20 4f74  l submodules. Ot
+00015200: 6865 7277 6973 652c 2079 6965 6c64 7320  herwise, yields 
+00015210: 6f6e 6c79 2062 7566 6665 7273 2074 6861  only buffers tha
+00015220: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00015230: 2020 2061 7265 2064 6972 6563 7420 6d65     are direct me
+00015240: 6d62 6572 7320 6f66 2074 6869 7320 6d6f  mbers of this mo
+00015250: 6475 6c65 2e0d 0a0d 0a20 2020 2020 2020  dule.....       
+00015260: 2059 6965 6c64 733a 0d0a 2020 2020 2020   Yields:..      
+00015270: 2020 2020 2020 2873 7472 696e 672c 2074        (string, t
+00015280: 6f72 6368 2e54 656e 736f 7229 3a20 5475  orch.Tensor): Tu
+00015290: 706c 6520 636f 6e74 6169 6e69 6e67 2074  ple containing t
+000152a0: 6865 206e 616d 6520 616e 6420 6275 6666  he name and buff
+000152b0: 6572 0d0a 0d0a 2020 2020 2020 2020 4578  er....        Ex
+000152c0: 616d 706c 6573 3a0d 0a0d 0a20 2020 2020  amples:....     
+000152d0: 2020 2020 2020 203e 3e3e 2066 6f72 206e         >>> for n
+000152e0: 616d 652c 2062 7566 2069 6e20 7365 6c66  ame, buf in self
+000152f0: 2e6e 616d 6564 5f62 7566 6665 7273 2829  .named_buffers()
+00015300: 3a0d 0a20 2020 2020 2020 2020 2020 203e  :..            >
+00015310: 3e3e 2020 2020 6966 206e 616d 6520 696e  >>    if name in
+00015320: 205b 2772 756e 6e69 6e67 5f76 6172 275d   ['running_var']
+00015330: 3a0d 0a20 2020 2020 2020 2020 2020 203e  :..            >
+00015340: 3e3e 2020 2020 2020 2020 7072 696e 7428  >>        print(
+00015350: 6275 662e 7369 7a65 2829 290d 0a0d 0a20  buf.size()).... 
+00015360: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00015370: 2020 2020 6765 6e20 3d20 7365 6c66 2e5f      gen = self._
+00015380: 6e61 6d65 645f 6d65 6d62 6572 7328 6c61  named_members(la
+00015390: 6d62 6461 206d 6f64 756c 653a 206d 6f64  mbda module: mod
+000153a0: 756c 652e 5f62 7566 6665 7273 2e69 7465  ule._buffers.ite
+000153b0: 6d73 2829 2c20 7072 6566 6978 3d70 7265  ms(), prefix=pre
+000153c0: 6669 782c 2072 6563 7572 7365 3d72 6563  fix, recurse=rec
+000153d0: 7572 7365 290d 0a20 2020 2020 2020 2066  urse)..        f
+000153e0: 6f72 2065 6c65 6d20 696e 2067 656e 3a0d  or elem in gen:.
+000153f0: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
+00015400: 6c64 2065 6c65 6d0d 0a0d 0a20 2020 2064  ld elem....    d
+00015410: 6566 2063 6869 6c64 7265 6e28 7365 6c66  ef children(self
+00015420: 293a 0d0a 2020 2020 2020 2020 7222 2222  ):..        r"""
+00015430: 5265 7475 726e 7320 616e 2069 7465 7261  Returns an itera
+00015440: 746f 7220 6f76 6572 2069 6d6d 6564 6961  tor over immedia
+00015450: 7465 2063 6869 6c64 7265 6e20 6d6f 6475  te children modu
+00015460: 6c65 732e 0d0a 0d0a 2020 2020 2020 2020  les.....        
+00015470: 5969 656c 6473 3a0d 0a20 2020 2020 2020  Yields:..       
+00015480: 2020 2020 204d 6f64 756c 653a 2061 2063       Module: a c
+00015490: 6869 6c64 206d 6f64 756c 650d 0a20 2020  hild module..   
+000154a0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+000154b0: 2020 666f 7220 6e61 6d65 2c20 6d6f 6475    for name, modu
+000154c0: 6c65 2069 6e20 7365 6c66 2e6e 616d 6564  le in self.named
+000154d0: 5f63 6869 6c64 7265 6e28 293a 0d0a 2020  _children():..  
+000154e0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+000154f0: 6d6f 6475 6c65 0d0a 0d0a 2020 2020 6465  module....    de
+00015500: 6620 6e61 6d65 645f 6368 696c 6472 656e  f named_children
+00015510: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00015520: 2072 2222 2252 6574 7572 6e73 2061 6e20   r"""Returns an 
+00015530: 6974 6572 6174 6f72 206f 7665 7220 696d  iterator over im
+00015540: 6d65 6469 6174 6520 6368 696c 6472 656e  mediate children
+00015550: 206d 6f64 756c 6573 2c20 7969 656c 6469   modules, yieldi
+00015560: 6e67 2062 6f74 680d 0a20 2020 2020 2020  ng both..       
+00015570: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+00015580: 206d 6f64 756c 6520 6173 2077 656c 6c20   module as well 
+00015590: 6173 2074 6865 206d 6f64 756c 6520 6974  as the module it
+000155a0: 7365 6c66 2e0d 0a0d 0a20 2020 2020 2020  self.....       
+000155b0: 2059 6965 6c64 733a 0d0a 2020 2020 2020   Yields:..      
+000155c0: 2020 2020 2020 2873 7472 696e 672c 204d        (string, M
+000155d0: 6f64 756c 6529 3a20 5475 706c 6520 636f  odule): Tuple co
+000155e0: 6e74 6169 6e69 6e67 2061 206e 616d 6520  ntaining a name 
+000155f0: 616e 6420 6368 696c 6420 6d6f 6475 6c65  and child module
+00015600: 0d0a 0d0a 2020 2020 2020 2020 4578 616d  ....        Exam
+00015610: 706c 6573 3a0d 0a0d 0a20 2020 2020 2020  ples:....       
+00015620: 2020 2020 203e 3e3e 2066 6f72 206e 616d       >>> for nam
+00015630: 652c 206d 6f64 756c 6520 696e 206d 6f64  e, module in mod
+00015640: 656c 2e6e 616d 6564 5f63 6869 6c64 7265  el.named_childre
+00015650: 6e28 293a 0d0a 2020 2020 2020 2020 2020  n():..          
+00015660: 2020 3e3e 3e20 2020 2020 6966 206e 616d    >>>     if nam
+00015670: 6520 696e 205b 2763 6f6e 7634 272c 2027  e in ['conv4', '
+00015680: 636f 6e76 3527 5d3a 0d0a 2020 2020 2020  conv5']:..      
+00015690: 2020 2020 2020 3e3e 3e20 2020 2020 2020        >>>       
+000156a0: 2020 7072 696e 7428 6d6f 6475 6c65 290d    print(module).
+000156b0: 0a0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+000156c0: 2020 2020 2020 2020 6d65 6d6f 203d 2073          memo = s
+000156d0: 6574 2829 0d0a 2020 2020 2020 2020 666f  et()..        fo
+000156e0: 7220 6e61 6d65 2c20 6d6f 6475 6c65 2069  r name, module i
+000156f0: 6e20 7365 6c66 2e5f 6d6f 6475 6c65 732e  n self._modules.
+00015700: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
+00015710: 2020 2020 2020 6966 206d 6f64 756c 6520        if module 
+00015720: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00015730: 6d6f 6475 6c65 206e 6f74 2069 6e20 6d65  module not in me
+00015740: 6d6f 3a0d 0a20 2020 2020 2020 2020 2020  mo:..           
+00015750: 2020 2020 206d 656d 6f2e 6164 6428 6d6f       memo.add(mo
+00015760: 6475 6c65 290d 0a20 2020 2020 2020 2020  dule)..         
+00015770: 2020 2020 2020 2079 6965 6c64 206e 616d         yield nam
+00015780: 652c 206d 6f64 756c 650d 0a0d 0a20 2020  e, module....   
+00015790: 2064 6566 206d 6f64 756c 6573 2873 656c   def modules(sel
+000157a0: 6629 3a0d 0a20 2020 2020 2020 2072 2222  f):..        r""
+000157b0: 2252 6574 7572 6e73 2061 6e20 6974 6572  "Returns an iter
+000157c0: 6174 6f72 206f 7665 7220 616c 6c20 6d6f  ator over all mo
+000157d0: 6475 6c65 7320 696e 2074 6865 206e 6574  dules in the net
+000157e0: 776f 726b 2e0d 0a0d 0a20 2020 2020 2020  work.....       
+000157f0: 2059 6965 6c64 733a 0d0a 2020 2020 2020   Yields:..      
+00015800: 2020 2020 2020 4d6f 6475 6c65 3a20 6120        Module: a 
+00015810: 6d6f 6475 6c65 2069 6e20 7468 6520 6e65  module in the ne
+00015820: 7477 6f72 6b0d 0a0d 0a20 2020 2020 2020  twork....       
+00015830: 204e 6f74 653a 0d0a 2020 2020 2020 2020   Note:..        
+00015840: 2020 2020 4475 706c 6963 6174 6520 6d6f      Duplicate mo
+00015850: 6475 6c65 7320 6172 6520 7265 7475 726e  dules are return
+00015860: 6564 206f 6e6c 7920 6f6e 6365 2e20 496e  ed only once. In
+00015870: 2074 6865 2066 6f6c 6c6f 7769 6e67 0d0a   the following..
+00015880: 2020 2020 2020 2020 2020 2020 6578 616d              exam
+00015890: 706c 652c 2060 606c 6060 2077 696c 6c20  ple, ``l`` will 
+000158a0: 6265 2072 6574 7572 6e65 6420 6f6e 6c79  be returned only
+000158b0: 206f 6e63 652e 0d0a 0d0a 2020 2020 2020   once.....      
+000158c0: 2020 4578 616d 706c 6573 3a0d 0a0d 0a20    Examples:.... 
+000158d0: 2020 2020 2020 2020 2020 203e 3e3e 206c             >>> l
+000158e0: 203d 206e 6e2e 4c69 6e65 6172 2832 2c20   = nn.Linear(2, 
+000158f0: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
+00015900: 3e3e 3e20 6e65 7420 3d20 6e6e 2e53 6571  >>> net = nn.Seq
+00015910: 7565 6e74 6961 6c28 6c2c 206c 290d 0a20  uential(l, l).. 
+00015920: 2020 2020 2020 2020 2020 203e 3e3e 2066             >>> f
+00015930: 6f72 2069 6478 2c20 6d20 696e 2065 6e75  or idx, m in enu
+00015940: 6d65 7261 7465 286e 6574 2e6d 6f64 756c  merate(net.modul
+00015950: 6573 2829 293a 0d0a 2020 2020 2020 2020  es()):..        
+00015960: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00015970: 7428 6964 782c 2027 2d3e 272c 206d 290d  t(idx, '->', m).
+00015980: 0a0d 0a20 2020 2020 2020 2020 2020 2030  ...            0
+00015990: 202d 3e20 5365 7175 656e 7469 616c 280d   -> Sequential(.
+000159a0: 0a20 2020 2020 2020 2020 2020 2020 2028  .              (
+000159b0: 3029 3a20 4c69 6e65 6172 2869 6e5f 6665  0): Linear(in_fe
+000159c0: 6174 7572 6573 3d32 2c20 6f75 745f 6665  atures=2, out_fe
+000159d0: 6174 7572 6573 3d32 2c20 6269 6173 3d54  atures=2, bias=T
+000159e0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+000159f0: 2020 2020 2831 293a 204c 696e 6561 7228      (1): Linear(
+00015a00: 696e 5f66 6561 7475 7265 733d 322c 206f  in_features=2, o
+00015a10: 7574 5f66 6561 7475 7265 733d 322c 2062  ut_features=2, b
+00015a20: 6961 733d 5472 7565 290d 0a20 2020 2020  ias=True)..     
+00015a30: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00015a40: 2020 2020 2020 3120 2d3e 204c 696e 6561        1 -> Linea
+00015a50: 7228 696e 5f66 6561 7475 7265 733d 322c  r(in_features=2,
+00015a60: 206f 7574 5f66 6561 7475 7265 733d 322c   out_features=2,
+00015a70: 2062 6961 733d 5472 7565 290d 0a0d 0a20   bias=True).... 
+00015a80: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00015a90: 2020 2020 666f 7220 6e61 6d65 2c20 6d6f      for name, mo
+00015aa0: 6475 6c65 2069 6e20 7365 6c66 2e6e 616d  dule in self.nam
+00015ab0: 6564 5f6d 6f64 756c 6573 2829 3a0d 0a20  ed_modules():.. 
+00015ac0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00015ad0: 206d 6f64 756c 650d 0a0d 0a20 2020 2064   module....    d
+00015ae0: 6566 206e 616d 6564 5f6d 6f64 756c 6573  ef named_modules
+00015af0: 2873 656c 662c 206d 656d 6f3d 4e6f 6e65  (self, memo=None
+00015b00: 2c20 7072 6566 6978 3d27 2729 3a0d 0a20  , prefix=''):.. 
+00015b10: 2020 2020 2020 2072 2222 2252 6574 7572         r"""Retur
+00015b20: 6e73 2061 6e20 6974 6572 6174 6f72 206f  ns an iterator o
+00015b30: 7665 7220 616c 6c20 6d6f 6475 6c65 7320  ver all modules 
+00015b40: 696e 2074 6865 206e 6574 776f 726b 2c20  in the network, 
+00015b50: 7969 656c 6469 6e67 0d0a 2020 2020 2020  yielding..      
+00015b60: 2020 626f 7468 2074 6865 206e 616d 6520    both the name 
+00015b70: 6f66 2074 6865 206d 6f64 756c 6520 6173  of the module as
+00015b80: 2077 656c 6c20 6173 2074 6865 206d 6f64   well as the mod
+00015b90: 756c 6520 6974 7365 6c66 2e0d 0a0d 0a20  ule itself..... 
+00015ba0: 2020 2020 2020 2059 6965 6c64 733a 0d0a         Yields:..
+00015bb0: 2020 2020 2020 2020 2020 2020 2873 7472              (str
+00015bc0: 696e 672c 204d 6f64 756c 6529 3a20 5475  ing, Module): Tu
+00015bd0: 706c 6520 6f66 206e 616d 6520 616e 6420  ple of name and 
+00015be0: 6d6f 6475 6c65 0d0a 0d0a 2020 2020 2020  module....      
+00015bf0: 2020 4e6f 7465 3a0d 0a20 2020 2020 2020    Note:..       
+00015c00: 2020 2020 2044 7570 6c69 6361 7465 206d       Duplicate m
+00015c10: 6f64 756c 6573 2061 7265 2072 6574 7572  odules are retur
+00015c20: 6e65 6420 6f6e 6c79 206f 6e63 652e 2049  ned only once. I
+00015c30: 6e20 7468 6520 666f 6c6c 6f77 696e 670d  n the following.
+00015c40: 0a20 2020 2020 2020 2020 2020 2065 7861  .            exa
+00015c50: 6d70 6c65 2c20 6060 6c60 6020 7769 6c6c  mple, ``l`` will
+00015c60: 2062 6520 7265 7475 726e 6564 206f 6e6c   be returned onl
+00015c70: 7920 6f6e 6365 2e0d 0a0d 0a20 2020 2020  y once.....     
+00015c80: 2020 2045 7861 6d70 6c65 733a 0d0a 0d0a     Examples:....
+00015c90: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+00015ca0: 6c20 3d20 6e6e 2e4c 696e 6561 7228 322c  l = nn.Linear(2,
+00015cb0: 2032 290d 0a20 2020 2020 2020 2020 2020   2)..           
+00015cc0: 203e 3e3e 206e 6574 203d 206e 6e2e 5365   >>> net = nn.Se
+00015cd0: 7175 656e 7469 616c 286c 2c20 6c29 0d0a  quential(l, l)..
+00015ce0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+00015cf0: 666f 7220 6964 782c 206d 2069 6e20 656e  for idx, m in en
+00015d00: 756d 6572 6174 6528 6e65 742e 6e61 6d65  umerate(net.name
+00015d10: 645f 6d6f 6475 6c65 7328 2929 3a0d 0a20  d_modules()):.. 
+00015d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d30: 2020 2070 7269 6e74 2869 6478 2c20 272d     print(idx, '-
+00015d40: 3e27 2c20 6d29 0d0a 0d0a 2020 2020 2020  >', m)....      
+00015d50: 2020 2020 2020 3020 2d3e 2028 2727 2c20        0 -> ('', 
+00015d60: 5365 7175 656e 7469 616c 280d 0a20 2020  Sequential(..   
+00015d70: 2020 2020 2020 2020 2020 2028 3029 3a20             (0): 
+00015d80: 4c69 6e65 6172 2869 6e5f 6665 6174 7572  Linear(in_featur
+00015d90: 6573 3d32 2c20 6f75 745f 6665 6174 7572  es=2, out_featur
+00015da0: 6573 3d32 2c20 6269 6173 3d54 7275 6529  es=2, bias=True)
+00015db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015dc0: 2831 293a 204c 696e 6561 7228 696e 5f66  (1): Linear(in_f
+00015dd0: 6561 7475 7265 733d 322c 206f 7574 5f66  eatures=2, out_f
+00015de0: 6561 7475 7265 733d 322c 2062 6961 733d  eatures=2, bias=
+00015df0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00015e00: 2020 2029 290d 0a20 2020 2020 2020 2020     ))..         
+00015e10: 2020 2031 202d 3e20 2827 3027 2c20 4c69     1 -> ('0', Li
+00015e20: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
+00015e30: 3d32 2c20 6f75 745f 6665 6174 7572 6573  =2, out_features
+00015e40: 3d32 2c20 6269 6173 3d54 7275 6529 290d  =2, bias=True)).
+00015e50: 0a0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+00015e60: 0d0a 2020 2020 2020 2020 6966 206d 656d  ..        if mem
+00015e70: 6f20 6973 204e 6f6e 653a 0d0a 2020 2020  o is None:..    
+00015e80: 2020 2020 2020 2020 6d65 6d6f 203d 2073          memo = s
+00015e90: 6574 2829 0d0a 2020 2020 2020 2020 6966  et()..        if
+00015ea0: 2073 656c 6620 6e6f 7420 696e 206d 656d   self not in mem
+00015eb0: 6f3a 0d0a 2020 2020 2020 2020 2020 2020  o:..            
+00015ec0: 6d65 6d6f 2e61 6464 2873 656c 6629 0d0a  memo.add(self)..
+00015ed0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+00015ee0: 6420 7072 6566 6978 2c20 7365 6c66 0d0a  d prefix, self..
+00015ef0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015f00: 6e61 6d65 2c20 6d6f 6475 6c65 2069 6e20  name, module in 
+00015f10: 7365 6c66 2e5f 6d6f 6475 6c65 732e 6974  self._modules.it
+00015f20: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
+00015f30: 2020 2020 2020 2020 6966 206d 6f64 756c          if modul
+00015f40: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
+00015f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f60: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
+00015f70: 2020 2020 2020 2020 2020 7375 626d 6f64            submod
+00015f80: 756c 655f 7072 6566 6978 203d 2070 7265  ule_prefix = pre
+00015f90: 6669 7820 2b20 2827 2e27 2069 6620 7072  fix + ('.' if pr
+00015fa0: 6566 6978 2065 6c73 6520 2727 2920 2b20  efix else '') + 
+00015fb0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00015fc0: 2020 2020 2020 666f 7220 6d20 696e 206d        for m in m
+00015fd0: 6f64 756c 652e 6e61 6d65 645f 6d6f 6475  odule.named_modu
+00015fe0: 6c65 7328 6d65 6d6f 2c20 7375 626d 6f64  les(memo, submod
+00015ff0: 756c 655f 7072 6566 6978 293a 0d0a 2020  ule_prefix):..  
+00016000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016010: 2020 7969 656c 6420 6d0d 0a0d 0a20 2020    yield m....   
+00016020: 2064 6566 2074 7261 696e 2873 656c 663a   def train(self:
+00016030: 2054 2c20 6d6f 6465 3a20 626f 6f6c 203d   T, mode: bool =
+00016040: 2054 7275 6529 202d 3e20 543a 0d0a 2020   True) -> T:..  
+00016050: 2020 2020 2020 7222 2222 5365 7473 2074        r"""Sets t
+00016060: 6865 206d 6f64 756c 6520 696e 2074 7261  he module in tra
+00016070: 696e 696e 6720 6d6f 6465 2e0d 0a0d 0a20  ining mode..... 
+00016080: 2020 2020 2020 2054 6869 7320 6861 7320         This has 
+00016090: 616e 7920 6566 6665 6374 206f 6e6c 7920  any effect only 
+000160a0: 6f6e 2063 6572 7461 696e 206d 6f64 756c  on certain modul
+000160b0: 6573 2e20 5365 6520 646f 6375 6d65 6e74  es. See document
+000160c0: 6174 696f 6e73 206f 660d 0a20 2020 2020  ations of..     
+000160d0: 2020 2070 6172 7469 6375 6c61 7220 6d6f     particular mo
+000160e0: 6475 6c65 7320 666f 7220 6465 7461 696c  dules for detail
+000160f0: 7320 6f66 2074 6865 6972 2062 6568 6176  s of their behav
+00016100: 696f 7273 2069 6e20 7472 6169 6e69 6e67  iors in training
+00016110: 2f65 7661 6c75 6174 696f 6e0d 0a20 2020  /evaluation..   
+00016120: 2020 2020 206d 6f64 652c 2069 6620 7468       mode, if th
+00016130: 6579 2061 7265 2061 6666 6563 7465 642c  ey are affected,
+00016140: 2065 2e67 2e20 3a63 6c61 7373 3a60 4472   e.g. :class:`Dr
+00016150: 6f70 6f75 7460 2c20 3a63 6c61 7373 3a60  opout`, :class:`
+00016160: 4261 7463 684e 6f72 6d60 2c0d 0a20 2020  BatchNorm`,..   
+00016170: 2020 2020 2065 7463 2e0d 0a0d 0a20 2020       etc.....   
+00016180: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
+00016190: 2020 2020 2020 2020 6d6f 6465 2028 626f          mode (bo
+000161a0: 6f6c 293a 2077 6865 7468 6572 2074 6f20  ol): whether to 
+000161b0: 7365 7420 7472 6169 6e69 6e67 206d 6f64  set training mod
+000161c0: 6520 2860 6054 7275 6560 6029 206f 7220  e (``True``) or 
+000161d0: 6576 616c 7561 7469 6f6e 0d0a 2020 2020  evaluation..    
+000161e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161f0: 2020 2020 206d 6f64 6520 2860 6046 616c       mode (``Fal
+00016200: 7365 6060 292e 2044 6566 6175 6c74 3a20  se``). Default: 
+00016210: 6060 5472 7565 6060 2e0d 0a0d 0a20 2020  ``True``.....   
+00016220: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+00016230: 2020 2020 2020 2020 2020 204d 6f64 756c             Modul
+00016240: 653a 2073 656c 660d 0a20 2020 2020 2020  e: self..       
+00016250: 2022 2222 0d0a 2020 2020 2020 2020 7365   """..        se
+00016260: 6c66 2e74 7261 696e 696e 6720 3d20 6d6f  lf.training = mo
+00016270: 6465 0d0a 2020 2020 2020 2020 666f 7220  de..        for 
+00016280: 6d6f 6475 6c65 2069 6e20 7365 6c66 2e63  module in self.c
+00016290: 6869 6c64 7265 6e28 293a 0d0a 2020 2020  hildren():..    
+000162a0: 2020 2020 2020 2020 6d6f 6475 6c65 2e74          module.t
+000162b0: 7261 696e 2829 0d0a 2020 2020 2020 2020  rain()..        
+000162c0: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
+000162d0: 2020 2064 6566 2065 7661 6c28 7365 6c66     def eval(self
+000162e0: 3a20 5429 202d 3e20 543a 0d0a 2020 2020  : T) -> T:..    
+000162f0: 2020 2020 7222 2222 5365 7473 2074 6865      r"""Sets the
+00016300: 206d 6f64 756c 6520 696e 2065 7661 6c75   module in evalu
+00016310: 6174 696f 6e20 6d6f 6465 2e0d 0a0d 0a20  ation mode..... 
+00016320: 2020 2020 2020 2054 6869 7320 6861 7320         This has 
+00016330: 616e 7920 6566 6665 6374 206f 6e6c 7920  any effect only 
+00016340: 6f6e 2063 6572 7461 696e 206d 6f64 756c  on certain modul
+00016350: 6573 2e20 5365 6520 646f 6375 6d65 6e74  es. See document
+00016360: 6174 696f 6e73 206f 660d 0a20 2020 2020  ations of..     
+00016370: 2020 2070 6172 7469 6375 6c61 7220 6d6f     particular mo
+00016380: 6475 6c65 7320 666f 7220 6465 7461 696c  dules for detail
+00016390: 7320 6f66 2074 6865 6972 2062 6568 6176  s of their behav
+000163a0: 696f 7273 2069 6e20 7472 6169 6e69 6e67  iors in training
+000163b0: 2f65 7661 6c75 6174 696f 6e0d 0a20 2020  /evaluation..   
+000163c0: 2020 2020 206d 6f64 652c 2069 6620 7468       mode, if th
+000163d0: 6579 2061 7265 2061 6666 6563 7465 642c  ey are affected,
+000163e0: 2065 2e67 2e20 3a63 6c61 7373 3a60 4472   e.g. :class:`Dr
+000163f0: 6f70 6f75 7460 2c20 3a63 6c61 7373 3a60  opout`, :class:`
+00016400: 4261 7463 684e 6f72 6d60 2c0d 0a20 2020  BatchNorm`,..   
+00016410: 2020 2020 2065 7463 2e0d 0a0d 0a20 2020       etc.....   
+00016420: 2020 2020 2054 6869 7320 6973 2065 7175       This is equ
+00016430: 6976 616c 656e 7420 7769 7468 203a 6d65  ivalent with :me
+00016440: 7468 3a60 7365 6c66 2e74 7261 696e 2846  th:`self.train(F
+00016450: 616c 7365 2920 3c74 6f72 6368 2e6e 6e2e  alse) <torch.nn.
+00016460: 4d6f 6475 6c65 2e74 7261 696e 3e60 2e0d  Module.train>`..
+00016470: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00016480: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+00016490: 204d 6f64 756c 653a 2073 656c 660d 0a20   Module: self.. 
+000164a0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000164b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000164c0: 7472 6169 6e28 4661 6c73 6529 0d0a 0d0a  train(False)....
+000164d0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+000164e0: 2020 2064 6566 2074 7261 696e 6162 6c65     def trainable
+000164f0: 5f77 6569 6768 7473 2873 656c 6629 202d  _weights(self) -
+00016500: 3e20 4c69 7374 5b74 662e 5661 7269 6162  > List[tf.Variab
+00016510: 6c65 5d3a 0d0a 2020 2020 2020 2020 7222  le]:..        r"
+00016520: 2222 5468 6520 6c69 7374 206f 6620 7472  ""The list of tr
+00016530: 6169 6e61 626c 6520 7661 7269 6162 6c65  ainable variable
+00016540: 7320 2870 6172 616d 6574 6572 7329 206f  s (parameters) o
+00016550: 6620 7468 6520 6d6f 6475 6c65 2e0d 0a20  f the module... 
+00016560: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00016570: 7320 6f66 2074 6869 7320 6d6f 6475 6c65  s of this module
+00016580: 2061 6e64 2061 6c6c 2069 7473 2073 7562   and all its sub
+00016590: 6d6f 6475 6c65 7320 6172 6520 696e 636c  modules are incl
+000165a0: 7564 6564 2e0d 0a0d 0a20 2020 2020 2020  uded.....       
+000165b0: 202e 2e20 6e6f 7465 3a3a 0d0a 2020 2020   .. note::..    
+000165c0: 2020 2020 2020 2020 5468 6520 6c69 7374          The list
+000165d0: 2072 6574 7572 6e65 6420 6d61 7920 636f   returned may co
+000165e0: 6e74 6169 6e20 6475 706c 6963 6174 6520  ntain duplicate 
+000165f0: 7061 7261 6d65 7465 7273 2028 652e 672e  parameters (e.g.
+00016600: 206f 7574 7075 740d 0a20 2020 2020 2020   output..       
+00016610: 2020 2020 206c 6179 6572 2073 6861 7265       layer share
+00016620: 7320 7061 7261 6d65 7465 7273 2077 6974  s parameters wit
+00016630: 6820 656d 6265 6464 696e 6773 292e 2046  h embeddings). F
+00016640: 6f72 206d 6f73 7420 7573 6167 6573 2c20  or most usages, 
+00016650: 6974 2773 206e 6f74 0d0a 2020 2020 2020  it's not..      
+00016660: 2020 2020 2020 6e65 6365 7373 6172 7920        necessary 
+00016670: 746f 2065 6e73 7572 6520 756e 6971 7565  to ensure unique
+00016680: 6e65 7373 2e0d 0a0d 0a20 2020 2020 2020  ness.....       
+00016690: 2022 2222 0d0a 2020 2020 2020 2020 7265   """..        re
+000166a0: 7475 726e 205b 7820 666f 7220 7820 696e  turn [x for x in
+000166b0: 2073 656c 662e 7061 7261 6d65 7465 7273   self.parameters
+000166c0: 2829 2069 6620 782e 7472 6169 6e61 626c  () if x.trainabl
+000166d0: 655d 0d0a 0d0a 2020 2020 4070 726f 7065  e]....    @prope
+000166e0: 7274 790d 0a20 2020 2064 6566 206e 6f6e  rty..    def non
+000166f0: 5f74 7261 696e 6162 6c65 5f77 6569 6768  _trainable_weigh
+00016700: 7473 2873 656c 6629 202d 3e20 4c69 7374  ts(self) -> List
+00016710: 5b74 662e 5661 7269 6162 6c65 5d3a 0d0a  [tf.Variable]:..
+00016720: 2020 2020 2020 2020 7222 2222 5468 6520          r"""The 
+00016730: 6c69 7374 206f 6620 7472 6169 6e61 626c  list of trainabl
+00016740: 6520 7661 7269 6162 6c65 7320 2870 6172  e variables (par
+00016750: 616d 6574 6572 7329 206f 6620 7468 6520  ameters) of the 
+00016760: 6d6f 6475 6c65 2e0d 0a20 2020 2020 2020  module...       
+00016770: 2050 6172 616d 6574 6572 7320 6f66 2074   Parameters of t
+00016780: 6869 7320 6d6f 6475 6c65 2061 6e64 2061  his module and a
+00016790: 6c6c 2069 7473 2073 7562 6d6f 6475 6c65  ll its submodule
+000167a0: 7320 6172 6520 696e 636c 7564 6564 2e0d  s are included..
+000167b0: 0a20 2020 2020 2020 202e 2e20 6e6f 7465  .        .. note
+000167c0: 3a3a 0d0a 2020 2020 2020 2020 2020 2020  ::..            
+000167d0: 5468 6520 6c69 7374 2072 6574 7572 6e65  The list returne
+000167e0: 6420 6d61 7920 636f 6e74 6169 6e20 6475  d may contain du
+000167f0: 706c 6963 6174 6520 7061 7261 6d65 7465  plicate paramete
+00016800: 7273 2028 652e 672e 206f 7574 7075 740d  rs (e.g. output.
+00016810: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00016820: 6572 2073 6861 7265 7320 7061 7261 6d65  er shares parame
+00016830: 7465 7273 2077 6974 6820 656d 6265 6464  ters with embedd
+00016840: 696e 6773 292e 2046 6f72 206d 6f73 7420  ings). For most 
+00016850: 7573 6167 6573 2c20 6974 2773 206e 6f74  usages, it's not
+00016860: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00016870: 6365 7373 6172 7920 746f 2065 6e73 7572  cessary to ensur
+00016880: 6520 756e 6971 7565 6e65 7373 2e0d 0a20  e uniqueness... 
+00016890: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000168a0: 2020 2020 7265 7475 726e 205b 7820 666f      return [x fo
+000168b0: 7220 7820 696e 2073 656c 662e 7061 7261  r x in self.para
+000168c0: 6d65 7465 7273 2829 2069 6620 6e6f 7420  meters() if not 
+000168d0: 782e 7472 6169 6e61 626c 655d 0d0a 0d0a  x.trainable]....
+000168e0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+000168f0: 2020 2064 6566 2077 6569 6768 7473 2873     def weights(s
+00016900: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
+00016910: 6574 7572 6e20 6c69 7374 2873 656c 662e  eturn list(self.
+00016920: 7061 7261 6d65 7465 7273 2829 290d 0a0d  parameters())...
+00016930: 0a20 2020 2064 6566 2067 6574 5f77 6569  .    def get_wei
+00016940: 6768 7473 2873 656c 6629 3a0d 0a20 2020  ghts(self):..   
+00016950: 2020 2020 2072 6574 7572 6e20 5b70 2e6e       return [p.n
+00016960: 756d 7079 2829 2066 6f72 2070 2069 6e20  umpy() for p in 
+00016970: 6c69 7374 2873 656c 662e 7061 7261 6d65  list(self.parame
+00016980: 7465 7273 2829 295d 0d0a 0d0a 2020 2020  ters())]....    
+00016990: 6465 6620 7365 745f 7765 6967 6874 7328  def set_weights(
+000169a0: 7365 6c66 2c20 7765 6967 6874 7329 3a0d  self, weights):.
+000169b0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+000169c0: 3d20 7365 6c66 2e77 6569 6768 7473 0d0a  = self.weights..
+000169d0: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+000169e0: 6172 616d 733a 0d0a 2020 2020 2020 2020  arams:..        
+000169f0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00016a00: 2020 2020 7765 6967 6874 5f76 616c 7565      weight_value
+00016a10: 5f74 7570 6c65 7320 3d20 5b5d 0d0a 2020  _tuples = []..  
+00016a20: 2020 2020 2020 7061 7261 6d5f 7661 6c75        param_valu
+00016a30: 6573 203d 205b 7720 666f 7220 7720 696e  es = [w for w in
+00016a40: 2070 6172 616d 735d 0d0a 2020 2020 2020   params]..      
+00016a50: 2020 666f 7220 7076 2c20 702c 2077 2069    for pv, p, w i
+00016a60: 6e20 7a69 7028 7061 7261 6d5f 7661 6c75  n zip(param_valu
+00016a70: 6573 2c20 7061 7261 6d73 2c20 7765 6967  es, params, weig
+00016a80: 6874 7329 3a0d 0a20 2020 2020 2020 2020  hts):..         
+00016a90: 2020 2069 6620 7076 2e73 6861 7065 2021     if pv.shape !
+00016aa0: 3d20 772e 7368 6170 653a 0d0a 2020 2020  = w.shape:..    
+00016ab0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00016ac0: 6520 5661 6c75 6545 7272 6f72 2827 4c61  e ValueError('La
+00016ad0: 7965 7220 7765 6967 6874 2073 6861 7065  yer weight shape
+00016ae0: 2027 202b 2073 7472 2870 762e 7368 6170   ' + str(pv.shap
+00016af0: 6529 202b 2027 206e 6f74 2063 6f6d 7061  e) + ' not compa
+00016b00: 7469 626c 6520 7769 7468 2027 0d0a 2020  tible with '..  
+00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b70: 2020 2020 2020 2020 2020 2770 726f 7669            'provi
-00016b80: 6465 6420 7765 6967 6874 2073 6861 7065  ded weight shape
-00016b90: 2027 202b 2073 7472 2877 2e73 6861 7065   ' + str(w.shape
-00016ba0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00016bb0: 7765 6967 6874 5f76 616c 7565 5f74 7570  weight_value_tup
-00016bc0: 6c65 732e 6170 7065 6e64 2828 702c 2077  les.append((p, w
-00016bd0: 2929 0d0a 2020 2020 2020 2020 666f 7220  ))..        for 
-00016be0: 702c 2077 2069 6e20 7765 6967 6874 5f76  p, w in weight_v
-00016bf0: 616c 7565 5f74 7570 6c65 733a 0d0a 2020  alue_tuples:..  
-00016c00: 2020 2020 2020 2020 2020 702e 6173 7369            p.assi
-00016c10: 676e 2877 2e76 616c 7565 2829 290d 0a0d  gn(w.value())...
-00016c20: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-00016c30: 2020 2020 6465 6620 7472 6169 6e61 626c      def trainabl
-00016c40: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-00016c50: 2020 2222 220d 0a0d 0a20 2020 2020 2020    """....       
-00016c60: 2052 6574 7572 6e73 3a20 4973 2074 6865   Returns: Is the
-00016c70: 206c 6179 6572 2074 7261 696e 6162 6c65   layer trainable
-00016c80: 3f0d 0a0d 0a20 2020 2020 2020 2022 2222  ?....        """
-00016c90: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00016ca0: 2873 656c 662e 7765 6967 6874 7329 203d  (self.weights) =
-00016cb0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00016cc0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00016cd0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-00016ce0: 2873 656c 662e 7765 6967 6874 7329 203e  (self.weights) >
-00016cf0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00016d00: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-00016d10: 662e 5f70 6172 616d 6574 6572 732e 6974  f._parameters.it
-00016d20: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00016d30: 2020 2020 2020 2020 6966 2076 2069 7320          if v is 
-00016d40: 6e6f 7420 4e6f 6e65 2061 6e64 2076 2e74  not None and v.t
-00016d50: 7261 696e 6162 6c65 203d 3d20 4661 6c73  rainable == Fals
-00016d60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00016d70: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00016d80: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-00016d90: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00016da0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016db0: 5472 7565 0d0a 0d0a 2020 2020 4074 7261  True....    @tra
-00016dc0: 696e 6162 6c65 2e73 6574 7465 720d 0a20  inable.setter.. 
-00016dd0: 2020 2064 6566 2074 7261 696e 6162 6c65     def trainable
-00016de0: 2873 656c 662c 2076 616c 7565 3a20 626f  (self, value: bo
-00016df0: 6f6c 293a 0d0a 2020 2020 2020 2020 2222  ol):..        ""
-00016e00: 220d 0a0d 0a20 2020 2020 2020 2041 7267  "....        Arg
-00016e10: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00016e20: 7661 6c75 6520 2862 6f6f 6c29 3a20 206e  value (bool):  n
-00016e30: 6577 2076 616c 7565 2066 6f72 2074 6865  ew value for the
-00016e40: 2070 726f 7065 7274 7920 2254 7273 6169   property "Trsai
-00016e50: 6e61 626c 6522 0d0a 0d0a 2020 2020 2020  nable"....      
-00016e60: 2020 2222 220d 0a20 2020 2020 2020 206e    """..        n
-00016e70: 203d 2030 0d0a 2020 2020 2020 2020 6e65   = 0..        ne
-00016e80: 6564 5f75 7064 6174 6520 3d20 4661 6c73  ed_update = Fals
-00016e90: 650d 0a20 2020 2020 2020 2066 6f72 206e  e..        for n
-00016ea0: 616d 652c 2070 6172 6120 696e 2073 656c  ame, para in sel
-00016eb0: 662e 6e61 6d65 645f 7061 7261 6d65 7465  f.named_paramete
-00016ec0: 7273 2829 3a0d 0a20 2020 2020 2020 2020  rs():..         
-00016ed0: 2020 2069 6620 7061 7261 2069 7320 6e6f     if para is no
-00016ee0: 7420 4e6f 6e65 2061 6e64 2070 6172 612e  t None and para.
-00016ef0: 7472 6169 6e61 626c 6520 213d 2076 616c  trainable != val
-00016f00: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
-00016f10: 2020 2020 2070 6172 612e 5f74 7261 696e       para._train
-00016f20: 6162 6c65 203d 2076 616c 7565 0d0a 0d0a  able = value....
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 6e20 2b3d 206e 702e 7072 6f64 2874 6f5f  n += np.prod(to_
-00016f50: 6e75 6d70 7928 696e 745f 7368 6170 6528  numpy(int_shape(
-00016f60: 7061 7261 2929 290d 0a20 2020 2020 2020  para)))..       
-00016f70: 2020 2020 2020 2020 206e 6565 645f 7570           need_up
-00016f80: 6461 7465 203d 2054 7275 650d 0a20 2020  date = True..   
-00016f90: 2020 2020 2069 6620 6e6f 7420 6e65 6564       if not need
-00016fa0: 5f75 7064 6174 653a 0d0a 2020 2020 2020  _update:..      
-00016fb0: 2020 2020 2020 7072 696e 7428 276e 6f20        print('no 
-00016fc0: 7061 7261 6d65 7465 7220 7472 6169 6e61  parameter traina
-00016fd0: 626c 6520 7374 6174 6520 6973 2063 6861  ble state is cha
-00016fe0: 6e67 6564 2729 0d0a 2020 2020 2020 2020  nged')..        
-00016ff0: 656c 6966 2076 616c 7565 3a0d 0a20 2020  elif value:..   
-00017000: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00017010: 7b30 7d20 7061 7261 6d65 7465 7273 2068  {0} parameters h
-00017020: 6176 6520 7365 7420 7472 6169 6e61 626c  ave set trainabl
-00017030: 6527 2e66 6f72 6d61 7428 6e29 290d 0a20  e'.format(n)).. 
-00017040: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00017050: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00017060: 277b 307d 2070 6172 616d 6574 6572 7320  '{0} parameters 
-00017070: 6861 7665 2073 6574 2075 6e74 7261 696e  have set untrain
-00017080: 6162 6c65 272e 666f 726d 6174 286e 2929  able'.format(n))
-00017090: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
-000170a0: 5f6e 616d 6528 7365 6c66 293a 0d0a 2020  _name(self):..  
-000170b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000170c0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-000170d0: 6d65 5f5f 0d0a 2020 2020 6465 6620 6578  me__..    def ex
-000170e0: 7472 615f 7265 7072 2873 656c 6629 202d  tra_repr(self) -
-000170f0: 3e20 7374 723a 0d0a 2020 2020 2020 2020  > str:..        
-00017100: 7222 2222 5365 7420 7468 6520 6578 7472  r"""Set the extr
-00017110: 6120 7265 7072 6573 656e 7461 7469 6f6e  a representation
-00017120: 206f 6620 7468 6520 6d6f 6475 6c65 0d0a   of the module..
-00017130: 0d0a 2020 2020 2020 2020 546f 2070 7269  ..        To pri
-00017140: 6e74 2063 7573 746f 6d69 7a65 6420 6578  nt customized ex
-00017150: 7472 6120 696e 666f 726d 6174 696f 6e2c  tra information,
-00017160: 2079 6f75 2073 686f 756c 6420 7265 2d69   you should re-i
-00017170: 6d70 6c65 6d65 6e74 0d0a 2020 2020 2020  mplement..      
-00017180: 2020 7468 6973 206d 6574 686f 6420 696e    this method in
-00017190: 2079 6f75 7220 6f77 6e20 6d6f 6475 6c65   your own module
-000171a0: 732e 2042 6f74 6820 7369 6e67 6c65 2d6c  s. Both single-l
-000171b0: 696e 6520 616e 6420 6d75 6c74 692d 6c69  ine and multi-li
-000171c0: 6e65 0d0a 2020 2020 2020 2020 7374 7269  ne..        stri
-000171d0: 6e67 7320 6172 6520 6163 6365 7074 6162  ngs are acceptab
-000171e0: 6c65 2e0d 0a20 2020 2020 2020 2022 2222  le...        """
-000171f0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00017200: 2027 270d 0a0d 0a20 2020 2064 6566 205f   ''....    def _
-00017210: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
-00017220: 2020 2020 2020 2020 2320 5765 2074 7265          # We tre
-00017230: 6174 2074 6865 2065 7874 7261 2072 6570  at the extra rep
-00017240: 7220 6c69 6b65 2074 6865 2073 7562 2d6d  r like the sub-m
-00017250: 6f64 756c 652c 206f 6e65 2069 7465 6d20  odule, one item 
-00017260: 7065 7220 6c69 6e65 0d0a 2020 2020 2020  per line..      
-00017270: 2020 6578 7472 615f 6c69 6e65 7320 3d20    extra_lines = 
-00017280: 5b5d 0d0a 2020 2020 2020 2020 6578 7472  []..        extr
-00017290: 615f 7265 7072 203d 2073 656c 662e 6578  a_repr = self.ex
-000172a0: 7472 615f 7265 7072 2829 0d0a 2020 2020  tra_repr()..    
-000172b0: 2020 2020 2320 656d 7074 7920 7374 7269      # empty stri
-000172c0: 6e67 2077 696c 6c20 6265 2073 706c 6974  ng will be split
-000172d0: 2069 6e74 6f20 6c69 7374 205b 2727 5d0d   into list [''].
-000172e0: 0a20 2020 2020 2020 2069 6620 6578 7472  .        if extr
-000172f0: 615f 7265 7072 3a0d 0a20 2020 2020 2020  a_repr:..       
-00017300: 2020 2020 2065 7874 7261 5f6c 696e 6573       extra_lines
-00017310: 203d 2065 7874 7261 5f72 6570 722e 7370   = extra_repr.sp
-00017320: 6c69 7428 275c 6e27 290d 0a20 2020 2020  lit('\n')..     
-00017330: 2020 2063 6869 6c64 5f6c 696e 6573 203d     child_lines =
-00017340: 205b 5d0d 0a20 2020 2020 2020 2066 6f72   []..        for
-00017350: 206b 6579 2c20 6d6f 6475 6c65 2069 6e20   key, module in 
-00017360: 7365 6c66 2e5f 6d6f 6475 6c65 732e 6974  self._modules.it
-00017370: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00017380: 2020 2020 6d6f 645f 7374 7220 3d20 7265      mod_str = re
-00017390: 7072 286d 6f64 756c 6529 0d0a 2020 2020  pr(module)..    
-000173a0: 2020 2020 2020 2020 6d6f 645f 7374 7220          mod_str 
-000173b0: 3d20 5f61 6464 696e 6465 6e74 286d 6f64  = _addindent(mod
-000173c0: 5f73 7472 2c20 3229 0d0a 2020 2020 2020  _str, 2)..      
-000173d0: 2020 2020 2020 6368 696c 645f 6c69 6e65        child_line
-000173e0: 732e 6170 7065 6e64 2827 2827 202b 206b  s.append('(' + k
-000173f0: 6579 202b 2027 293a 2027 202b 206d 6f64  ey + '): ' + mod
-00017400: 5f73 7472 290d 0a20 2020 2020 2020 206c  _str)..        l
-00017410: 696e 6573 203d 2065 7874 7261 5f6c 696e  ines = extra_lin
-00017420: 6573 202b 2063 6869 6c64 5f6c 696e 6573  es + child_lines
-00017430: 0d0a 0d0a 2020 2020 2020 2020 6d61 696e  ....        main
-00017440: 5f73 7472 203d 2073 656c 662e 5f67 6574  _str = self._get
-00017450: 5f6e 616d 6528 2920 2b20 2728 270d 0a20  _name() + '('.. 
-00017460: 2020 2020 2020 2069 6620 6c69 6e65 733a         if lines:
-00017470: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00017480: 7369 6d70 6c65 206f 6e65 2d6c 696e 6572  simple one-liner
-00017490: 2069 6e66 6f2c 2077 6869 6368 206d 6f73   info, which mos
-000174a0: 7420 6275 696c 7469 6e20 4d6f 6475 6c65  t builtin Module
-000174b0: 7320 7769 6c6c 2075 7365 0d0a 2020 2020  s will use..    
-000174c0: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
-000174d0: 7874 7261 5f6c 696e 6573 2920 3d3d 2031  xtra_lines) == 1
-000174e0: 2061 6e64 206e 6f74 2063 6869 6c64 5f6c   and not child_l
-000174f0: 696e 6573 3a0d 0a20 2020 2020 2020 2020  ines:..         
-00017500: 2020 2020 2020 206d 6169 6e5f 7374 7220         main_str 
-00017510: 2b3d 2065 7874 7261 5f6c 696e 6573 5b30  += extra_lines[0
-00017520: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-00017530: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00017540: 2020 2020 2020 6d61 696e 5f73 7472 202b        main_str +
-00017550: 3d20 275c 6e20 2027 202b 2027 5c6e 2020  = '\n  ' + '\n  
-00017560: 272e 6a6f 696e 286c 696e 6573 2920 2b20  '.join(lines) + 
-00017570: 275c 6e27 0d0a 0d0a 2020 2020 2020 2020  '\n'....        
-00017580: 6d61 696e 5f73 7472 202b 3d20 2729 270d  main_str += ')'.
-00017590: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000175a0: 6d61 696e 5f73 7472 0d0a 0d0a 2020 2020  main_str....    
-000175b0: 6465 6620 5f5f 6469 725f 5f28 7365 6c66  def __dir__(self
-000175c0: 293a 0d0a 2020 2020 2020 2020 6d6f 6475  ):..        modu
-000175d0: 6c65 5f61 7474 7273 203d 2064 6972 2873  le_attrs = dir(s
-000175e0: 656c 662e 5f5f 636c 6173 735f 5f29 0d0a  elf.__class__)..
-000175f0: 2020 2020 2020 2020 6174 7472 7320 3d20          attrs = 
-00017600: 6c69 7374 2873 656c 662e 5f5f 6469 6374  list(self.__dict
-00017610: 5f5f 2e6b 6579 7328 2929 0d0a 2020 2020  __.keys())..    
-00017620: 2020 2020 7061 7261 6d65 7465 7273 203d      parameters =
-00017630: 206c 6973 7428 7365 6c66 2e5f 7061 7261   list(self._para
-00017640: 6d65 7465 7273 2e6b 6579 7328 2929 0d0a  meters.keys())..
-00017650: 2020 2020 2020 2020 6d6f 6475 6c65 7320          modules 
-00017660: 3d20 6c69 7374 2873 656c 662e 5f6d 6f64  = list(self._mod
-00017670: 756c 6573 2e6b 6579 7328 2929 0d0a 2020  ules.keys())..  
-00017680: 2020 2020 2020 6275 6666 6572 7320 3d20        buffers = 
-00017690: 6c69 7374 2873 656c 662e 5f62 7566 6665  list(self._buffe
-000176a0: 7273 2e6b 6579 7328 2929 0d0a 2020 2020  rs.keys())..    
-000176b0: 2020 2020 6b65 7973 203d 206d 6f64 756c      keys = modul
-000176c0: 655f 6174 7472 7320 2b20 6174 7472 7320  e_attrs + attrs 
-000176d0: 2b20 7061 7261 6d65 7465 7273 202b 206d  + parameters + m
-000176e0: 6f64 756c 6573 202b 2062 7566 6665 7273  odules + buffers
-000176f0: 0d0a 0d0a 2020 2020 2020 2020 2320 456c  ....        # El
-00017700: 696d 696e 6174 6520 6174 7472 7320 7468  iminate attrs th
-00017710: 6174 2061 7265 206e 6f74 206c 6567 616c  at are not legal
-00017720: 2050 7974 686f 6e20 7661 7269 6162 6c65   Python variable
-00017730: 206e 616d 6573 0d0a 2020 2020 2020 2020   names..        
-00017740: 6b65 7973 203d 205b 6b65 7920 666f 7220  keys = [key for 
-00017750: 6b65 7920 696e 206b 6579 7320 6966 206e  key in keys if n
-00017760: 6f74 206b 6579 5b30 5d2e 6973 6469 6769  ot key[0].isdigi
-00017770: 7428 295d 0d0a 0d0a 2020 2020 2020 2020  t()]....        
-00017780: 7265 7475 726e 2073 6f72 7465 6428 6b65  return sorted(ke
-00017790: 7973 290d 0a0d 0a20 2020 2064 6566 205f  ys)....    def _
-000177a0: 7265 706c 6963 6174 655f 666f 725f 6461  replicate_for_da
-000177b0: 7461 5f70 6172 616c 6c65 6c28 7365 6c66  ta_parallel(self
-000177c0: 293a 0d0a 2020 2020 2020 2020 7265 706c  ):..        repl
-000177d0: 6963 6120 3d20 7365 6c66 2e5f 5f6e 6577  ica = self.__new
-000177e0: 5f5f 2874 7970 6528 7365 6c66 2929 0d0a  __(type(self))..
-000177f0: 2020 2020 2020 2020 7265 706c 6963 612e          replica.
-00017800: 5f5f 6469 6374 5f5f 203d 2073 656c 662e  __dict__ = self.
-00017810: 5f5f 6469 6374 5f5f 2e63 6f70 7928 290d  __dict__.copy().
-00017820: 0a0d 0a20 2020 2020 2020 2023 2072 6570  ...        # rep
-00017830: 6c69 6361 7320 646f 206e 6f74 2068 6176  licas do not hav
-00017840: 6520 7061 7261 6d65 7465 7273 2074 6865  e parameters the
-00017850: 6d73 656c 7665 732c 2074 6865 2072 6570  mselves, the rep
-00017860: 6c69 6361 7320 7265 6665 7265 6e63 6520  licas reference 
-00017870: 7468 6520 6f72 6967 696e 616c 0d0a 2020  the original..  
-00017880: 2020 2020 2020 2320 6d6f 6475 6c65 2e0d        # module..
-00017890: 0a20 2020 2020 2020 2072 6570 6c69 6361  .        replica
-000178a0: 2e5f 7061 7261 6d65 7465 7273 203d 204f  ._parameters = O
-000178b0: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
-000178c0: 2020 2020 2020 7265 706c 6963 612e 5f62        replica._b
-000178d0: 7566 6665 7273 203d 2072 6570 6c69 6361  uffers = replica
-000178e0: 2e5f 6275 6666 6572 732e 636f 7079 2829  ._buffers.copy()
-000178f0: 0d0a 2020 2020 2020 2020 7265 706c 6963  ..        replic
-00017900: 612e 5f6d 6f64 756c 6573 203d 2072 6570  a._modules = rep
-00017910: 6c69 6361 2e5f 6d6f 6475 6c65 732e 636f  lica._modules.co
-00017920: 7079 2829 0d0a 2020 2020 2020 2020 7265  py()..        re
-00017930: 706c 6963 612e 5f69 735f 7265 706c 6963  plica._is_replic
-00017940: 6120 3d20 5472 7565 0d0a 0d0a 2020 2020  a = True....    
-00017950: 2020 2020 7265 7475 726e 2072 6570 6c69      return repli
-00017960: 6361 0d0a 0d0a 0d0a 0d0a 0d0a 0d0a 636c  ca............cl
-00017970: 6173 7320 5365 7175 656e 7469 616c 284c  ass Sequential(L
-00017980: 6179 6572 293a 0d0a 2020 2020 7222 2222  ayer):..    r"""
-00017990: 4120 7365 7175 656e 7469 616c 2063 6f6e  A sequential con
-000179a0: 7461 696e 6572 2e0d 0a20 2020 204d 6f64  tainer...    Mod
-000179b0: 756c 6573 2077 696c 6c20 6265 2061 6464  ules will be add
-000179c0: 6564 2074 6f20 6974 2069 6e20 7468 6520  ed to it in the 
-000179d0: 6f72 6465 7220 7468 6579 2061 7265 2070  order they are p
-000179e0: 6173 7365 6420 696e 2074 6865 2063 6f6e  assed in the con
-000179f0: 7374 7275 6374 6f72 2e0d 0a20 2020 2041  structor...    A
-00017a00: 6c74 6572 6e61 7469 7665 6c79 2c20 616e  lternatively, an
-00017a10: 206f 7264 6572 6564 2064 6963 7420 6f66   ordered dict of
-00017a20: 206d 6f64 756c 6573 2063 616e 2061 6c73   modules can als
-00017a30: 6f20 6265 2070 6173 7365 6420 696e 2e0d  o be passed in..
-00017a40: 0a0d 0a20 2020 2054 6f20 6d61 6b65 2069  ...    To make i
-00017a50: 7420 6561 7369 6572 2074 6f20 756e 6465  t easier to unde
-00017a60: 7273 7461 6e64 2c20 6865 7265 2069 7320  rstand, here is 
-00017a70: 6120 736d 616c 6c20 6578 616d 706c 653a  a small example:
-00017a80: 3a0d 0a0d 0a20 2020 2020 2020 2023 2045  :....        # E
-00017a90: 7861 6d70 6c65 206f 6620 7573 696e 6720  xample of using 
-00017aa0: 5365 7175 656e 7469 616c 0d0a 2020 2020  Sequential..    
-00017ab0: 2020 2020 6d6f 6465 6c20 3d20 6e6e 2e53      model = nn.S
-00017ac0: 6571 7565 6e74 6961 6c28 0d0a 2020 2020  equential(..    
-00017ad0: 2020 2020 2020 2020 2020 2020 2020 6e6e                nn
-00017ae0: 2e43 6f6e 7632 6428 312c 3230 2c35 292c  .Conv2d(1,20,5),
-00017af0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017b00: 2020 2020 6e6e 2e52 654c 5528 292c 0d0a      nn.ReLU(),..
-00017b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b20: 2020 6e6e 2e43 6f6e 7632 6428 3230 2c36    nn.Conv2d(20,6
-00017b30: 342c 3529 2c0d 0a20 2020 2020 2020 2020  4,5),..         
-00017b40: 2020 2020 2020 2020 206e 6e2e 5265 4c55           nn.ReLU
-00017b50: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00017b60: 2020 2020 290d 0a0d 0a20 2020 2020 2020      )....       
-00017b70: 2023 2045 7861 6d70 6c65 206f 6620 7573   # Example of us
-00017b80: 696e 6720 5365 7175 656e 7469 616c 2077  ing Sequential w
-00017b90: 6974 6820 4f72 6465 7265 6444 6963 740d  ith OrderedDict.
-00017ba0: 0a20 2020 2020 2020 206d 6f64 656c 203d  .        model =
-00017bb0: 206e 6e2e 5365 7175 656e 7469 616c 284f   nn.Sequential(O
-00017bc0: 7264 6572 6564 4469 6374 285b 0d0a 2020  rderedDict([..  
-00017bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017be0: 2827 636f 6e76 3127 2c20 6e6e 2e43 6f6e  ('conv1', nn.Con
-00017bf0: 7632 6428 312c 3230 2c35 2929 2c0d 0a20  v2d(1,20,5)),.. 
-00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c10: 2028 2772 656c 7531 272c 206e 6e2e 5265   ('relu1', nn.Re
-00017c20: 4c55 2829 292c 0d0a 2020 2020 2020 2020  LU()),..        
-00017c30: 2020 2020 2020 2020 2020 2827 636f 6e76            ('conv
-00017c40: 3227 2c20 6e6e 2e43 6f6e 7632 6428 3230  2', nn.Conv2d(20
-00017c50: 2c36 342c 3529 292c 0d0a 2020 2020 2020  ,64,5)),..      
-00017c60: 2020 2020 2020 2020 2020 2020 2827 7265              ('re
-00017c70: 6c75 3227 2c20 6e6e 2e52 654c 5528 2929  lu2', nn.ReLU())
-00017c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017c90: 2020 5d29 290d 0a20 2020 2022 2222 0d0a    ]))..    """..
-00017ca0: 0d0a 2020 2020 5f6d 6f64 756c 6573 3a20  ..    _modules: 
-00017cb0: 4469 6374 5b73 7472 2c20 7466 2e4d 6f64  Dict[str, tf.Mod
-00017cc0: 756c 655d 2020 2320 7479 7065 3a20 6967  ule]  # type: ig
-00017cd0: 6e6f 7265 5b61 7373 6967 6e6d 656e 745d  nore[assignment]
-00017ce0: 0d0a 0d0a 2020 2020 406f 7665 726c 6f61  ....    @overloa
-00017cf0: 640d 0a20 2020 2064 6566 205f 5f69 6e69  d..    def __ini
-00017d00: 745f 5f28 7365 6c66 2c20 2a61 7267 733a  t__(self, *args:
-00017d10: 2074 662e 4d6f 6475 6c65 2920 2d3e 204e   tf.Module) -> N
-00017d20: 6f6e 653a 0d0a 2020 2020 2020 2020 2e2e  one:..        ..
-00017d30: 2e0d 0a0d 0a20 2020 2040 6f76 6572 6c6f  .....    @overlo
-00017d40: 6164 0d0a 2020 2020 6465 6620 5f5f 696e  ad..    def __in
-00017d50: 6974 5f5f 2873 656c 662c 2061 7267 3a20  it__(self, arg: 
-00017d60: 4469 6374 5b73 7472 2c20 7466 2e4d 6f64  Dict[str, tf.Mod
-00017d70: 756c 655d 2920 2d3e 204e 6f6e 653a 0d0a  ule]) -> None:..
-00017d80: 2020 2020 2020 2020 2e2e 2e0d 0a0d 0a20          ....... 
-00017d90: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00017da0: 7365 6c66 2c20 2a61 7267 732c 206e 616d  self, *args, nam
-00017db0: 653d 4e6f 6e65 2c20 6b65 6570 5f6f 7574  e=None, keep_out
-00017dc0: 7075 743d 4661 6c73 6529 3a0d 0a20 2020  put=False):..   
-00017dd0: 2020 2020 2073 7570 6572 2829 2e5f 5f73       super().__s
-00017de0: 6574 6174 7472 5f5f 2827 5f6d 6f64 756c  etattr__('_modul
-00017df0: 6573 272c 204f 7264 6572 6564 4469 6374  es', OrderedDict
-00017e00: 2829 290d 0a20 2020 2020 2020 2073 7570  ())..        sup
-00017e10: 6572 2853 6571 7565 6e74 6961 6c2c 2073  er(Sequential, s
-00017e20: 656c 6629 2e5f 5f69 6e69 745f 5f28 6e61  elf).__init__(na
-00017e30: 6d65 3d6e 616d 652c 6b65 6570 5f6f 7574  me=name,keep_out
-00017e40: 7075 743d 6b65 6570 5f6f 7574 7075 7429  put=keep_output)
-00017e50: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00017e60: 6275 696c 7420 3d20 4661 6c73 650d 0a20  built = False.. 
-00017e70: 2020 2020 2020 2061 7267 7320 3d20 756e         args = un
-00017e80: 7061 636b 5f73 696e 676c 6574 6f6e 2861  pack_singleton(a
-00017e90: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
-00017ea0: 2069 7369 6e73 7461 6e63 6528 6172 6773   isinstance(args
-00017eb0: 2c20 4f72 6465 7265 6444 6963 7429 3a0d  , OrderedDict):.
-00017ec0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00017ed0: 206b 6579 2c20 6d6f 6475 6c65 2069 6e20   key, module in 
-00017ee0: 6172 6773 2e69 7465 6d73 2829 3a0d 0a20  args.items():.. 
-00017ef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017f00: 656c 662e 6164 645f 6d6f 6475 6c65 286b  elf.add_module(k
-00017f10: 6579 2c20 6d6f 6475 6c65 290d 0a20 2020  ey, module)..   
-00017f20: 2020 2020 2065 6c69 6620 6c65 6e28 6172       elif len(ar
-00017f30: 6773 2920 3d3d 2031 2061 6e64 2069 7369  gs) == 1 and isi
-00017f40: 6e73 7461 6e63 6528 6172 6773 2c20 4f72  nstance(args, Or
-00017f50: 6465 7265 6444 6963 7429 3a0d 0a20 2020  deredDict):..   
-00017f60: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
-00017f70: 2c20 6d6f 6475 6c65 2069 6e20 6172 6773  , module in args
-00017f80: 5b30 5d2e 6974 656d 7328 293a 0d0a 2020  [0].items():..  
-00017f90: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00017fa0: 6c66 2e61 6464 5f6d 6f64 756c 6528 6b65  lf.add_module(ke
-00017fb0: 792c 206d 6f64 756c 6529 0d0a 2020 2020  y, module)..    
-00017fc0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00017fd0: 2020 2020 2020 2066 6f72 2069 6478 2c20         for idx, 
-00017fe0: 6d6f 6475 6c65 2069 6e20 656e 756d 6572  module in enumer
-00017ff0: 6174 6528 6172 6773 293a 0d0a 2020 2020  ate(args):..    
-00018000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018010: 2e61 6464 5f6d 6f64 756c 6528 7374 7228  .add_module(str(
-00018020: 6964 7829 2c20 6d6f 6475 6c65 290d 0a0d  idx), module)...
-00018030: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
-00018040: 746f 2873 656c 662e 6465 7669 6365 290d  to(self.device).
-00018050: 0a0d 0a20 2020 2023 2040 7072 6f70 6572  ...    # @proper
-00018060: 7479 0d0a 2020 2020 2320 6465 6620 6f75  ty..    # def ou
-00018070: 7470 7574 5f73 6861 7065 2873 656c 6629  tput_shape(self)
-00018080: 3a0d 0a20 2020 2023 2020 2020 2069 6620  :..    #     if 
-00018090: 6c65 6e28 7365 6c66 293e 303a 0d0a 2020  len(self)>0:..  
-000180a0: 2020 2320 2020 2020 2020 2020 7265 7475    #         retu
-000180b0: 726e 2073 656c 665b 2d31 5d2e 5f6f 7574  rn self[-1]._out
-000180c0: 7075 745f 7368 6170 650d 0a20 2020 2023  put_shape..    #
-000180d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000180e0: 2320 2020 2020 2020 2020 7265 7475 726e  #         return
-000180f0: 204e 6f6e 650d 0a20 2020 2023 0d0a 2020   None..    #..  
-00018100: 2020 2320 406f 7574 7075 745f 7368 6170    # @output_shap
-00018110: 652e 7365 7474 6572 0d0a 2020 2020 2320  e.setter..    # 
-00018120: 6465 6620 6f75 7470 7574 5f73 6861 7065  def output_shape
-00018130: 2873 656c 662c 2076 616c 7565 293a 0d0a  (self, value):..
-00018140: 2020 2020 2320 2020 2020 6966 206c 656e      #     if len
-00018150: 2873 656c 6629 203e 2030 3a0d 0a20 2020  (self) > 0:..   
-00018160: 2023 2020 2020 2020 2020 2069 6620 6973   #         if is
-00018170: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
-00018180: 7466 2e54 656e 736f 7253 6861 7065 293a  tf.TensorShape):
-00018190: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-000181a0: 2020 2020 7661 6c75 6520 3d20 746f 5f74      value = to_t
-000181b0: 656e 736f 7228 7661 6c75 652e 6173 5f6c  ensor(value.as_l
-000181c0: 6973 7428 2929 2e74 6f28 2769 6e74 2729  ist()).to('int')
-000181d0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-000181e0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-000181f0: 7661 6c75 652c 2028 6c69 7374 2c20 7475  value, (list, tu
-00018200: 706c 6529 2920 616e 6420 6c65 6e28 7661  ple)) and len(va
-00018210: 6c75 6529 203e 2030 3a0d 0a20 2020 2023  lue) > 0:..    #
-00018220: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00018230: 7565 203d 2074 7570 6c65 280d 0a20 2020  ue = tuple(..   
-00018240: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00018250: 2020 205b 746f 5f74 656e 736f 7228 7465     [to_tensor(te
-00018260: 6e73 6f72 5f73 6861 7065 2e61 735f 6c69  nsor_shape.as_li
-00018270: 7374 2829 292e 746f 2827 696e 7427 2920  st()).to('int') 
-00018280: 6966 2069 7369 6e73 7461 6e63 6528 7465  if isinstance(te
-00018290: 6e73 6f72 5f73 6861 7065 2c20 7466 2e54  nsor_shape, tf.T
-000182a0: 656e 736f 7253 6861 7065 2920 656c 7365  ensorShape) else
-000182b0: 2074 6f5f 7465 6e73 6f72 2874 656e 736f   to_tensor(tenso
-000182c0: 725f 7368 6170 6529 2e74 6f28 2769 6e74  r_shape).to('int
-000182d0: 2729 2066 6f72 2074 656e 736f 725f 7368  ') for tensor_sh
-000182e0: 6170 6520 696e 2076 616c 7565 5d29 0d0a  ape in value])..
-000182f0: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
-00018300: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00018310: 2320 2020 2020 2020 2020 2020 2020 7661  #             va
-00018320: 6c75 6520 3d20 746f 5f74 656e 736f 7228  lue = to_tensor(
-00018330: 7661 6c75 6529 2e74 6f28 2769 6e74 2729  value).to('int')
-00018340: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-00018350: 7365 6c66 5b2d 315d 2e5f 6f75 7470 7574  self[-1]._output
-00018360: 5f73 6861 7065 203d 2076 616c 7565 0d0a  _shape = value..
-00018370: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
-00018380: 6c66 2e5f 7369 676e 6174 7572 653d 4e6f  lf._signature=No
-00018390: 6e65 0d0a 0d0a 2020 2020 6465 6620 6275  ne....    def bu
-000183a0: 696c 6428 7365 6c66 2c20 696e 7075 745f  ild(self, input_
-000183b0: 7368 6170 653a 2054 656e 736f 7253 6861  shape: TensorSha
-000183c0: 7065 293a 0d0a 2020 2020 2020 2020 6966  pe):..        if
-000183d0: 2073 656c 662e 5f62 7569 6c74 203d 3d20   self._built == 
-000183e0: 4661 6c73 6520 616e 6420 6c65 6e28 7365  False and len(se
-000183f0: 6c66 2e5f 6d6f 6475 6c65 7329 203e 2030  lf._modules) > 0
-00018400: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00018410: 656c 662e 5f5f 6765 7469 7465 6d5f 5f28  elf.__getitem__(
-00018420: 3029 2e69 6e70 7574 5f73 6861 7065 203d  0).input_shape =
-00018430: 2069 6e70 7574 5f73 6861 7065 0d0a 2020   input_shape..  
-00018440: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00018450: 6275 696c 7420 3d20 5472 7565 0d0a 0d0a  built = True....
-00018460: 2020 2020 6465 6620 6164 645f 6d6f 6475      def add_modu
-00018470: 6c65 2873 656c 662c 206e 616d 652c 206d  le(self, name, m
-00018480: 6f64 756c 6529 3a0d 0a20 2020 2020 2020  odule):..       
-00018490: 2072 2222 2241 6464 7320 6120 6368 696c   r"""Adds a chil
-000184a0: 6420 6d6f 6475 6c65 2074 6f20 7468 6520  d module to the 
-000184b0: 6375 7272 656e 7420 6d6f 6475 6c65 2e0d  current module..
-000184c0: 0a0d 0a20 2020 2020 2020 2054 6865 206d  ...        The m
-000184d0: 6f64 756c 6520 6361 6e20 6265 2061 6363  odule can be acc
-000184e0: 6573 7365 6420 6173 2061 6e20 6174 7472  essed as an attr
-000184f0: 6962 7574 6520 7573 696e 6720 7468 6520  ibute using the 
-00018500: 6769 7665 6e20 6e61 6d65 2e0d 0a0d 0a20  given name..... 
-00018510: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-00018520: 2020 2020 2020 2020 2020 6e61 6d65 2028            name (
-00018530: 7374 7269 6e67 293a 206e 616d 6520 6f66  string): name of
-00018540: 2074 6865 2063 6869 6c64 206d 6f64 756c   the child modul
-00018550: 652e 2054 6865 2063 6869 6c64 206d 6f64  e. The child mod
-00018560: 756c 6520 6361 6e20 6265 0d0a 2020 2020  ule can be..    
-00018570: 2020 2020 2020 2020 2020 2020 6163 6365              acce
-00018580: 7373 6564 2066 726f 6d20 7468 6973 206d  ssed from this m
-00018590: 6f64 756c 6520 7573 696e 6720 7468 6520  odule using the 
-000185a0: 6769 7665 6e20 6e61 6d65 0d0a 2020 2020  given name..    
-000185b0: 2020 2020 2020 2020 6d6f 6475 6c65 2028          module (
-000185c0: 4d6f 6475 6c65 293a 2063 6869 6c64 206d  Module): child m
-000185d0: 6f64 756c 6520 746f 2062 6520 6164 6465  odule to be adde
-000185e0: 6420 746f 2074 6865 206d 6f64 756c 652e  d to the module.
-000185f0: 0d0a 2020 2020 2020 2020 2222 220d 0a0d  ..        """...
-00018600: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00018610: 7365 6c66 2e5f 6d6f 6475 6c65 7329 203e  self._modules) >
-00018620: 2030 2061 6e64 2073 656c 662e 5f69 6e70   0 and self._inp
-00018630: 7574 5f73 6861 7065 2069 7320 6e6f 7420  ut_shape is not 
-00018640: 4e6f 6e65 2061 6e64 2073 656c 665b 2d31  None and self[-1
-00018650: 5d2e 6275 696c 7420 616e 6420 7365 6c66  ].built and self
-00018660: 5b2d 315d 2e5f 6f75 7470 7574 5f73 6861  [-1]._output_sha
-00018670: 7065 2069 7320 6e6f 7420 4e6f 6e65 3a0d  pe is not None:.
-00018680: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-00018690: 745f 6f75 7470 7574 203d 2073 656c 665b  t_output = self[
-000186a0: 2d31 5d2e 5f6f 7574 7075 745f 7368 6170  -1]._output_shap
-000186b0: 650d 0a20 2020 2020 2020 2020 2020 2064  e..            d
-000186c0: 756d 6d61 795f 696e 7075 7420 3d20 746f  ummay_input = to
-000186d0: 5f74 656e 736f 7228 6c61 7374 5f6f 7574  _tensor(last_out
-000186e0: 7075 742e 6765 745f 6475 6d6d 795f 7465  put.get_dummy_te
-000186f0: 6e73 6f72 2829 292e 746f 2873 656c 662e  nsor()).to(self.
-00018700: 6465 7669 6365 290d 0a20 2020 2020 2020  device)..       
-00018710: 2020 2020 206f 7574 203d 206d 6f64 756c       out = modul
-00018720: 6528 6475 6d6d 6179 5f69 6e70 7574 290d  e(dummay_input).
-00018730: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00018740: 662e 5f6d 6f64 756c 6573 5b6e 616d 655d  f._modules[name]
-00018750: 203d 206d 6f64 756c 650d 0a20 2020 2020   = module..     
-00018760: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00018770: 616e 6365 286f 7574 2c20 4f72 6465 7265  ance(out, Ordere
-00018780: 6444 6963 7429 3a0d 0a20 2020 2020 2020  dDict):..       
-00018790: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
-000187a0: 7574 7075 745f 7368 6170 6520 3d20 7475  utput_shape = tu
-000187b0: 706c 6528 0d0a 2020 2020 2020 2020 2020  ple(..          
-000187c0: 2020 2020 2020 2020 2020 5b74 656e 736f            [tenso
-000187d0: 725f 746f 5f73 6861 7065 286f 2c20 6e65  r_to_shape(o, ne
-000187e0: 6564 5f65 7863 6c75 6465 5f62 6174 6368  ed_exclude_batch
-000187f0: 5f61 7869 733d 5472 7565 2c20 6973 5f73  _axis=True, is_s
-00018800: 696e 676c 6574 6f6e 3d46 616c 7365 2920  ingleton=False) 
-00018810: 666f 7220 6f20 696e 206f 7574 2e76 616c  for o in out.val
-00018820: 7565 5f6c 6973 745d 290d 0a20 2020 2020  ue_list])..     
-00018830: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018840: 6765 745f 726f 6f74 2829 2e73 6967 6e61  get_root().signa
-00018850: 7475 7265 2e6f 7574 7075 7473 203d 204f  ture.outputs = O
-00018860: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
-00018870: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00018880: 7220 6b2c 2076 2069 6e20 6f75 742e 6974  r k, v in out.it
-00018890: 656d 5f6c 6973 743a 0d0a 2020 2020 2020  em_list:..      
-000188a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000188b0: 6c66 2e67 6574 5f72 6f6f 7428 292e 7369  lf.get_root().si
-000188c0: 676e 6174 7572 652e 6f75 7470 7574 735b  gnature.outputs[
-000188d0: 6b5d 203d 2074 656e 736f 725f 746f 5f73  k] = tensor_to_s
-000188e0: 6861 7065 2876 2c20 6e65 6564 5f65 7863  hape(v, need_exc
-000188f0: 6c75 6465 5f62 6174 6368 5f61 7869 733d  lude_batch_axis=
-00018900: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
-00018910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018950: 2020 6973 5f73 696e 676c 6574 6f6e 3d46    is_singleton=F
-00018960: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00018970: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00018980: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
-00018990: 656e 666f 7263 655f 7369 6e67 6c65 746f  enforce_singleto
-000189a0: 6e28 6f75 7429 0d0a 2020 2020 2020 2020  n(out)..        
-000189b0: 2020 2020 2020 2020 7365 6c66 2e5f 6f75          self._ou
-000189c0: 7470 7574 5f73 6861 7065 203d 2074 656e  tput_shape = ten
-000189d0: 736f 725f 746f 5f73 6861 7065 286f 7574  sor_to_shape(out
-000189e0: 2c20 6e65 6564 5f65 7863 6c75 6465 5f62  , need_exclude_b
-000189f0: 6174 6368 5f61 7869 733d 5472 7565 2c20  atch_axis=True, 
-00018a00: 6973 5f73 696e 676c 6574 6f6e 3d46 616c  is_singleton=Fal
-00018a10: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-00018a20: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
-00018a30: 7475 7265 2e6f 7574 7075 7473 5b73 656c  ture.outputs[sel
-00018a40: 662e 5f73 6967 6e61 7475 7265 2e6f 7574  f._signature.out
-00018a50: 7075 7473 2e6b 6579 5f6c 6973 745b 305d  puts.key_list[0]
-00018a60: 5d2e 7368 6170 6520 3d20 7365 6c66 2e5f  ].shape = self._
-00018a70: 6f75 7470 7574 5f73 6861 7065 0d0a 2020  output_shape..  
-00018a80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00018a90: 6966 206c 656e 2873 656c 662e 6765 745f  if len(self.get_
-00018aa0: 726f 6f74 2829 2e73 6967 6e61 7475 7265  root().signature
-00018ab0: 2e6f 7574 7075 7473 2920 3e20 303a 0d0a  .outputs) > 0:..
-00018ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ad0: 2320 2020 2020 7365 6c66 2e67 6574 5f72  #     self.get_r
-00018ae0: 6f6f 7428 292e 7369 676e 6174 7572 653d  oot().signature=
-00018af0: 6765 745f 7369 676e 6174 7572 6528 7365  get_signature(se
-00018b00: 6c66 290d 0a20 2020 2020 2020 2020 2020  lf)..           
-00018b10: 2020 2020 2023 2065 6c73 653a 0d0a 2020       # else:..  
-00018b20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00018b30: 2020 2020 7365 6c66 2e67 6574 5f72 6f6f      self.get_roo
-00018b40: 7428 292e 7369 676e 6174 7572 652e 6f75  t().signature.ou
-00018b50: 7470 7574 735b 276f 7574 7075 7427 5d20  tputs['output'] 
-00018b60: 3d20 7365 6c66 2e5f 6f75 7470 7574 5f73  = self._output_s
-00018b70: 6861 7065 2e63 6f70 7928 290d 0a0d 0a20  hape.copy().... 
-00018b80: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00018b90: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00018ba0: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
-00018bb0: 2027 5f73 6967 6e61 7475 7265 2729 206f   '_signature') o
-00018bc0: 7220 6d6f 6475 6c65 2e5f 7369 676e 6174  r module._signat
-00018bd0: 7572 6520 6973 204e 6f6e 653a 0d0a 2020  ure is None:..  
-00018be0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00018bf0: 6475 6c65 2e5f 7369 676e 6174 7572 6520  dule._signature 
-00018c00: 3d20 6765 745f 7369 676e 6174 7572 6528  = get_signature(
-00018c10: 6d6f 6475 6c65 290d 0a20 2020 2020 2020  module)..       
-00018c20: 2020 2020 2073 6967 203d 2063 6f70 792e       sig = copy.
-00018c30: 6465 6570 636f 7079 286d 6f64 756c 652e  deepcopy(module.
-00018c40: 5f73 6967 6e61 7475 7265 290d 0a20 2020  _signature)..   
-00018c50: 2020 2020 2020 2020 2073 7570 6572 2853           super(S
-00018c60: 6571 7565 6e74 6961 6c2c 2073 656c 6629  equential, self)
-00018c70: 2e61 6464 5f6d 6f64 756c 6528 6e61 6d65  .add_module(name
-00018c80: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
-00018c90: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00018ca0: 6c66 2920 3d3d 2031 206f 7220 7365 6c66  lf) == 1 or self
-00018cb0: 2e5f 7369 676e 6174 7572 6520 6973 204e  ._signature is N
-00018cc0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00018cd0: 2020 2020 2020 7365 6c66 2e5f 7369 676e        self._sign
-00018ce0: 6174 7572 6520 3d20 7369 670d 0a20 2020  ature = sig..   
-00018cf0: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
-00018d00: 6e28 7365 6c66 2920 3e20 313a 0d0a 2020  n(self) > 1:..  
-00018d10: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00018d20: 6c66 2e5f 7369 676e 6174 7572 652e 6f75  lf._signature.ou
-00018d30: 7470 7574 7320 3d20 636f 7079 2e64 6565  tputs = copy.dee
-00018d40: 7063 6f70 7928 7369 672e 6f75 7470 7574  pcopy(sig.output
-00018d50: 7329 0d0a 0d0a 2020 2020 6465 6620 7265  s)....    def re
-00018d60: 6d6f 7665 5f61 7428 7365 6c66 2c20 6964  move_at(self, id
-00018d70: 7829 3a0d 0a20 2020 2020 2020 2073 656c  x):..        sel
-00018d80: 662e 5f5f 6465 6c69 7465 6d5f 5f28 6964  f.__delitem__(id
-00018d90: 7829 0d0a 2020 2020 2020 2020 6966 206c  x)..        if l
-00018da0: 656e 2873 656c 662e 5f6d 6f64 756c 6573  en(self._modules
-00018db0: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-00018dc0: 2020 2020 7365 6c66 2e5f 6f75 7470 7574      self._output
-00018dd0: 5f73 6861 7065 203d 2073 656c 665b 2d31  _shape = self[-1
-00018de0: 5d2e 5f6f 7574 7075 745f 7368 6170 650d  ]._output_shape.
-00018df0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00018e00: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-00018e10: 5f73 6967 6e61 7475 7265 2c20 5369 676e  _signature, Sign
-00018e20: 6174 7572 6529 3a0d 0a20 2020 2020 2020  ature):..       
-00018e30: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-00018e40: 6967 6e61 7475 7265 2e6f 7574 7075 7473  ignature.outputs
-00018e50: 5b73 656c 662e 5f73 6967 6e61 7475 7265  [self._signature
-00018e60: 2e6f 7574 7075 7473 2e6b 6579 5f6c 6973  .outputs.key_lis
-00018e70: 745b 305d 5d2e 7368 6170 6520 3d20 7365  t[0]].shape = se
-00018e80: 6c66 5b2d 315d 2e5f 6f75 7470 7574 5f73  lf[-1]._output_s
-00018e90: 6861 7065 0d0a 0d0a 2020 2020 6465 6620  hape....    def 
-00018ea0: 5f67 6574 5f69 7465 6d5f 6279 5f69 6478  _get_item_by_idx
-00018eb0: 2873 656c 662c 2069 7465 7261 746f 722c  (self, iterator,
-00018ec0: 2069 6478 293a 0d0a 2020 2020 2020 2020   idx):..        
-00018ed0: 2222 2247 6574 2074 6865 2069 6478 2d74  """Get the idx-t
-00018ee0: 6820 6974 656d 206f 6620 7468 6520 6974  h item of the it
-00018ef0: 6572 6174 6f72 2222 220d 0a20 2020 2020  erator"""..     
-00018f00: 2020 2073 697a 6520 3d20 6c65 6e28 7365     size = len(se
-00018f10: 6c66 290d 0a20 2020 2020 2020 2069 6478  lf)..        idx
-00018f20: 203d 2069 6478 2e5f 5f69 6e64 6578 5f5f   = idx.__index__
-00018f30: 2829 0d0a 2020 2020 2020 2020 6966 206e  ()..        if n
-00018f40: 6f74 202d 7369 7a65 203c 3d20 6964 7820  ot -size <= idx 
-00018f50: 3c20 7369 7a65 3a0d 0a20 2020 2020 2020  < size:..       
-00018f60: 2020 2020 2072 6169 7365 2049 6e64 6578       raise Index
-00018f70: 4572 726f 7228 2769 6e64 6578 207b 7d20  Error('index {} 
-00018f80: 6973 206f 7574 206f 6620 7261 6e67 6527  is out of range'
-00018f90: 2e66 6f72 6d61 7428 6964 7829 290d 0a20  .format(idx)).. 
-00018fa0: 2020 2020 2020 2069 6478 2025 3d20 7369         idx %= si
-00018fb0: 7a65 0d0a 2020 2020 2020 2020 7265 7475  ze..        retu
-00018fc0: 726e 206e 6578 7428 6973 6c69 6365 2869  rn next(islice(i
-00018fd0: 7465 7261 746f 722c 2069 6478 2c20 4e6f  terator, idx, No
-00018fe0: 6e65 2929 0d0a 0d0a 2020 2020 6465 6620  ne))....    def 
-00018ff0: 5f5f 6765 7469 7465 6d5f 5f28 7365 6c66  __getitem__(self
-00019000: 2c20 6964 7829 3a0d 0a20 2020 2020 2020  , idx):..       
-00019010: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
-00019020: 6478 2c20 736c 6963 6529 3a0d 0a20 2020  dx, slice):..   
-00019030: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019040: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 284f  self.__class__(O
-00019050: 7264 6572 6564 4469 6374 286c 6973 7428  rderedDict(list(
-00019060: 7365 6c66 2e5f 6d6f 6475 6c65 732e 6974  self._modules.it
-00019070: 656d 7328 2929 5b69 6478 5d29 290d 0a20  ems())[idx])).. 
-00019080: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00019090: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000190a0: 2073 656c 662e 5f67 6574 5f69 7465 6d5f   self._get_item_
-000190b0: 6279 5f69 6478 2873 656c 662e 5f6d 6f64  by_idx(self._mod
-000190c0: 756c 6573 2e76 616c 7565 7328 292c 2069  ules.values(), i
-000190d0: 6478 290d 0a0d 0a0d 0a20 2020 2064 6566  dx)......    def
-000190e0: 205f 5f73 6574 6974 656d 5f5f 2873 656c   __setitem__(sel
-000190f0: 662c 2069 6478 2c20 6d6f 6475 6c65 293a  f, idx, module):
-00019100: 0d0a 2020 2020 2020 2020 6b65 793a 2073  ..        key: s
-00019110: 7472 203d 2073 656c 662e 5f67 6574 5f69  tr = self._get_i
-00019120: 7465 6d5f 6279 5f69 6478 2873 656c 662e  tem_by_idx(self.
-00019130: 5f6d 6f64 756c 6573 2e6b 6579 7328 292c  _modules.keys(),
-00019140: 2069 6478 290d 0a20 2020 2020 2020 2072   idx)..        r
-00019150: 6574 7572 6e20 7365 7461 7474 7228 7365  eturn setattr(se
-00019160: 6c66 2c20 6b65 792c 206d 6f64 756c 6529  lf, key, module)
-00019170: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6465  ....    def __de
-00019180: 6c69 7465 6d5f 5f28 7365 6c66 2c20 6964  litem__(self, id
-00019190: 7829 3a0d 0a20 2020 2020 2020 2069 6620  x):..        if 
-000191a0: 6973 696e 7374 616e 6365 2869 6478 2c20  isinstance(idx, 
-000191b0: 736c 6963 6529 3a0d 0a20 2020 2020 2020  slice):..       
-000191c0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-000191d0: 6c69 7374 2873 656c 662e 5f6d 6f64 756c  list(self._modul
-000191e0: 6573 2e6b 6579 7328 2929 5b69 6478 5d3a  es.keys())[idx]:
-000191f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019200: 2020 6465 6c61 7474 7228 7365 6c66 2c20    delattr(self, 
-00019210: 6b65 7929 0d0a 2020 2020 2020 2020 656c  key)..        el
-00019220: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00019230: 206b 6579 203d 2073 656c 662e 5f67 6574   key = self._get
-00019240: 5f69 7465 6d5f 6279 5f69 6478 2873 656c  _item_by_idx(sel
-00019250: 662e 5f6d 6f64 756c 6573 2e6b 6579 7328  f._modules.keys(
-00019260: 292c 2069 6478 290d 0a20 2020 2020 2020  ), idx)..       
-00019270: 2020 2020 2064 656c 6174 7472 2873 656c       delattr(sel
-00019280: 662c 206b 6579 290d 0a0d 0a20 2020 2020  f, key)....     
-00019290: 2020 2023 2054 6f20 7072 6573 6572 7665     # To preserve
-000192a0: 206e 756d 6265 7269 6e67 0d0a 2020 2020   numbering..    
-000192b0: 2020 2020 7374 725f 696e 6469 6365 7320      str_indices 
-000192c0: 3d20 5b73 7472 2869 2920 666f 7220 6920  = [str(i) for i 
-000192d0: 696e 2072 616e 6765 286c 656e 2873 656c  in range(len(sel
-000192e0: 662e 5f6d 6f64 756c 6573 2929 5d0d 0a20  f._modules))].. 
-000192f0: 2020 2020 2020 2073 656c 662e 5f6d 6f64         self._mod
-00019300: 756c 6573 203d 204f 7264 6572 6564 4469  ules = OrderedDi
-00019310: 6374 286c 6973 7428 7a69 7028 7374 725f  ct(list(zip(str_
-00019320: 696e 6469 6365 732c 2073 656c 662e 5f6d  indices, self._m
-00019330: 6f64 756c 6573 2e76 616c 7565 7328 2929  odules.values())
-00019340: 2929 0d0a 0d0a 2020 2020 405f 636f 7079  ))....    @_copy
-00019350: 5f74 6f5f 7363 7269 7074 5f77 7261 7070  _to_script_wrapp
-00019360: 6572 0d0a 2020 2020 6465 6620 5f5f 6c65  er..    def __le
-00019370: 6e5f 5f28 7365 6c66 2920 2d3e 2069 6e74  n__(self) -> int
-00019380: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00019390: 6e20 6c65 6e28 7365 6c66 2e5f 6d6f 6475  n len(self._modu
-000193a0: 6c65 7329 0d0a 0d0a 0d0a 2020 2020 6465  les)......    de
-000193b0: 6620 5f5f 6164 645f 5f28 7365 6c66 2c20  f __add__(self, 
-000193c0: 6f74 6865 7229 202d 3e20 2753 6571 7565  other) -> 'Seque
-000193d0: 6e74 6961 6c27 3a0d 0a20 2020 2020 2020  ntial':..       
-000193e0: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-000193f0: 7468 6572 2c20 5365 7175 656e 7469 616c  ther, Sequential
-00019400: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00019410: 7265 7420 3d20 5365 7175 656e 7469 616c  ret = Sequential
-00019420: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00019430: 666f 7220 6c61 7965 7220 696e 2073 656c  for layer in sel
-00019440: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-00019450: 2020 2020 7265 742e 6170 7065 6e64 286c      ret.append(l
-00019460: 6179 6572 290d 0a20 2020 2020 2020 2020  ayer)..         
-00019470: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
-00019480: 6f74 6865 723a 0d0a 2020 2020 2020 2020  other:..        
-00019490: 2020 2020 2020 2020 7265 742e 6170 7065          ret.appe
-000194a0: 6e64 286c 6179 6572 290d 0a20 2020 2020  nd(layer)..     
-000194b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000194c0: 740d 0a20 2020 2020 2020 2065 6c73 653a  t..        else:
-000194d0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-000194e0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-000194f0: 6164 6420 6f70 6572 6174 6f72 2073 7570  add operator sup
-00019500: 706f 7274 7320 6f6e 6c79 206f 626a 6563  ports only objec
-00019510: 7473 2027 0d0a 2020 2020 2020 2020 2020  ts '..          
-00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019530: 2020 2027 6f66 2053 6571 7565 6e74 6961     'of Sequentia
-00019540: 6c20 636c 6173 732c 2062 7574 207b 7d20  l class, but {} 
-00019550: 6973 2067 6976 656e 2e27 2e66 6f72 6d61  is given.'.forma
-00019560: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019580: 2020 2020 2073 7472 2874 7970 6528 6f74       str(type(ot
-00019590: 6865 7229 2929 290d 0a0d 0a20 2020 2064  her))))....    d
-000195a0: 6566 2070 6f70 2873 656c 662c 206b 6579  ef pop(self, key
-000195b0: 3a20 556e 696f 6e5b 696e 742c 2073 6c69  : Union[int, sli
-000195c0: 6365 5d29 202d 3e20 6e6e 2e4d 6f64 756c  ce]) -> nn.Modul
-000195d0: 653a 0d0a 2020 2020 2020 2020 7620 3d20  e:..        v = 
-000195e0: 7365 6c66 5b6b 6579 5d0d 0a20 2020 2020  self[key]..     
-000195f0: 2020 2064 656c 2073 656c 665b 6b65 795d     del self[key]
-00019600: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00019610: 2076 0d0a 0d0a 2020 2020 6465 6620 5f5f   v....    def __
-00019620: 6961 6464 5f5f 2873 656c 662c 206f 7468  iadd__(self, oth
-00019630: 6572 2920 2d3e 2027 5365 7175 656e 7469  er) -> 'Sequenti
-00019640: 616c 273a 0d0a 2020 2020 2020 2020 6966  al':..        if
-00019650: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-00019660: 722c 2053 6571 7565 6e74 6961 6c29 3a0d  r, Sequential):.
-00019670: 0a20 2020 2020 2020 2020 2020 206f 6666  .            off
-00019680: 7365 7420 3d20 6c65 6e28 7365 6c66 290d  set = len(self).
-00019690: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000196a0: 2069 2c20 6d6f 6475 6c65 2069 6e20 656e   i, module in en
-000196b0: 756d 6572 6174 6528 6f74 6865 7229 3a0d  umerate(other):.
-000196c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000196d0: 2073 656c 662e 6164 645f 6d6f 6475 6c65   self.add_module
-000196e0: 2873 7472 2869 202b 206f 6666 7365 7429  (str(i + offset)
-000196f0: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
-00019700: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00019710: 6c66 0d0a 2020 2020 2020 2020 656c 7365  lf..        else
-00019720: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00019730: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00019740: 2761 6464 206f 7065 7261 746f 7220 7375  'add operator su
-00019750: 7070 6f72 7473 206f 6e6c 7920 6f62 6a65  pports only obje
-00019760: 6374 7320 270d 0a20 2020 2020 2020 2020  cts '..         
-00019770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019780: 2020 2020 276f 6620 5365 7175 656e 7469      'of Sequenti
-00019790: 616c 2063 6c61 7373 2c20 6275 7420 7b7d  al class, but {}
-000197a0: 2069 7320 6769 7665 6e2e 272e 666f 726d   is given.'.form
-000197b0: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
-000197c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197d0: 2020 2020 2020 7374 7228 7479 7065 286f        str(type(o
-000197e0: 7468 6572 2929 2929 0d0a 0d0a 2020 2020  ther))))....    
-000197f0: 6465 6620 5f5f 6d75 6c5f 5f28 7365 6c66  def __mul__(self
-00019800: 2c20 6f74 6865 723a 2069 6e74 2920 2d3e  , other: int) ->
-00019810: 2027 5365 7175 656e 7469 616c 273a 0d0a   'Sequential':..
-00019820: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00019830: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
-00019840: 2069 6e74 293a 0d0a 2020 2020 2020 2020   int):..        
-00019850: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00019860: 726f 7228 6622 756e 7375 7070 6f72 7465  ror(f"unsupporte
-00019870: 6420 6f70 6572 616e 6420 7479 7065 2873  d operand type(s
-00019880: 2920 666f 7220 2a3a 207b 7479 7065 2873  ) for *: {type(s
-00019890: 656c 6629 7d20 616e 6420 7b74 7970 6528  elf)} and {type(
-000198a0: 6f74 6865 7229 7d22 290d 0a20 2020 2020  other)}")..     
-000198b0: 2020 2065 6c69 6620 286f 7468 6572 203c     elif (other <
-000198c0: 3d20 3029 3a0d 0a20 2020 2020 2020 2020  = 0):..         
-000198d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000198e0: 726f 7228 6622 4e6f 6e2d 706f 7369 7469  ror(f"Non-positi
-000198f0: 7665 206d 756c 7469 706c 6963 6174 696f  ve multiplicatio
-00019900: 6e20 6661 6374 6f72 207b 6f74 6865 727d  n factor {other}
-00019910: 2066 6f72 207b 7479 7065 2873 656c 6629   for {type(self)
-00019920: 7d22 290d 0a20 2020 2020 2020 2065 6c73  }")..        els
-00019930: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00019940: 636f 6d62 696e 6564 203d 2053 6571 7565  combined = Seque
-00019950: 6e74 6961 6c28 290d 0a20 2020 2020 2020  ntial()..       
-00019960: 2020 2020 206f 6666 7365 7420 3d20 300d       offset = 0.
-00019970: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00019980: 205f 2069 6e20 7261 6e67 6528 6f74 6865   _ in range(othe
-00019990: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-000199a0: 2020 2020 2066 6f72 206d 6f64 756c 6520       for module 
-000199b0: 696e 2073 656c 663a 0d0a 2020 2020 2020  in self:..      
-000199c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000199d0: 6d62 696e 6564 2e61 6464 5f6d 6f64 756c  mbined.add_modul
-000199e0: 6528 7374 7228 6f66 6673 6574 292c 206d  e(str(offset), m
-000199f0: 6f64 756c 6529 0d0a 2020 2020 2020 2020  odule)..        
-00019a00: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
-00019a10: 6574 202b 3d20 310d 0a20 2020 2020 2020  et += 1..       
-00019a20: 2020 2020 2072 6574 7572 6e20 636f 6d62       return comb
-00019a30: 696e 6564 0d0a 0d0a 2020 2020 6465 6620  ined....    def 
-00019a40: 5f5f 726d 756c 5f5f 2873 656c 662c 206f  __rmul__(self, o
-00019a50: 7468 6572 3a20 696e 7429 202d 3e20 2753  ther: int) -> 'S
-00019a60: 6571 7565 6e74 6961 6c27 3a0d 0a20 2020  equential':..   
-00019a70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00019a80: 2e5f 5f6d 756c 5f5f 286f 7468 6572 290d  .__mul__(other).
-00019a90: 0a0d 0a20 2020 2064 6566 205f 5f69 6d75  ...    def __imu
-00019aa0: 6c5f 5f28 7365 6c66 2c20 6f74 6865 723a  l__(self, other:
-00019ab0: 2069 6e74 2920 2d3e 2027 5365 7175 656e   int) -> 'Sequen
-00019ac0: 7469 616c 273a 0d0a 2020 2020 2020 2020  tial':..        
-00019ad0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00019ae0: 6528 6f74 6865 722c 2069 6e74 293a 0d0a  e(other, int):..
-00019af0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00019b00: 6520 5479 7065 4572 726f 7228 6622 756e  e TypeError(f"un
-00019b10: 7375 7070 6f72 7465 6420 6f70 6572 616e  supported operan
-00019b20: 6420 7479 7065 2873 2920 666f 7220 2a3a  d type(s) for *:
-00019b30: 207b 7479 7065 2873 656c 6629 7d20 616e   {type(self)} an
-00019b40: 6420 7b74 7970 6528 6f74 6865 7229 7d22  d {type(other)}"
-00019b50: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00019b60: 286f 7468 6572 203c 3d20 3029 3a0d 0a20  (other <= 0):.. 
-00019b70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00019b80: 2056 616c 7565 4572 726f 7228 6622 4e6f   ValueError(f"No
-00019b90: 6e2d 706f 7369 7469 7665 206d 756c 7469  n-positive multi
-00019ba0: 706c 6963 6174 696f 6e20 6661 6374 6f72  plication factor
-00019bb0: 207b 6f74 6865 727d 2066 6f72 207b 7479   {other} for {ty
-00019bc0: 7065 2873 656c 6629 7d22 290d 0a20 2020  pe(self)}")..   
-00019bd0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00019be0: 2020 2020 2020 2020 6c65 6e5f 6f72 6967          len_orig
-00019bf0: 696e 616c 203d 206c 656e 2873 656c 6629  inal = len(self)
-00019c00: 0d0a 2020 2020 2020 2020 2020 2020 6f66  ..            of
-00019c10: 6673 6574 203d 206c 656e 2873 656c 6629  fset = len(self)
-00019c20: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00019c30: 7220 5f20 696e 2072 616e 6765 286f 7468  r _ in range(oth
-00019c40: 6572 202d 2031 293a 0d0a 2020 2020 2020  er - 1):..      
-00019c50: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00019c60: 696e 2072 616e 6765 286c 656e 5f6f 7269  in range(len_ori
-00019c70: 6769 6e61 6c29 3a0d 0a20 2020 2020 2020  ginal):..       
-00019c80: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00019c90: 662e 6164 645f 6d6f 6475 6c65 2873 7472  f.add_module(str
-00019ca0: 2869 202b 206f 6666 7365 7429 2c20 7365  (i + offset), se
-00019cb0: 6c66 2e5f 6d6f 6475 6c65 735b 7374 7228  lf._modules[str(
-00019cc0: 6929 5d29 0d0a 2020 2020 2020 2020 2020  i)])..          
-00019cd0: 2020 2020 2020 6f66 6673 6574 202b 3d20        offset += 
-00019ce0: 6c65 6e5f 6f72 6967 696e 616c 0d0a 2020  len_original..  
-00019cf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019d00: 2073 656c 660d 0a0d 0a20 2020 2040 5f63   self....    @_c
-00019d10: 6f70 795f 746f 5f73 6372 6970 745f 7772  opy_to_script_wr
-00019d20: 6170 7065 720d 0a20 2020 2064 6566 205f  apper..    def _
-00019d30: 5f64 6972 5f5f 2873 656c 6629 3a0d 0a20  _dir__(self):.. 
-00019d40: 2020 2020 2020 206b 6579 7320 3d20 7375         keys = su
-00019d50: 7065 7228 5365 7175 656e 7469 616c 2c20  per(Sequential, 
-00019d60: 7365 6c66 292e 5f5f 6469 725f 5f28 290d  self).__dir__().
-00019d70: 0a20 2020 2020 2020 206b 6579 7320 3d20  .        keys = 
-00019d80: 5b6b 6579 2066 6f72 206b 6579 2069 6e20  [key for key in 
-00019d90: 6b65 7973 2069 6620 6e6f 7420 6b65 792e  keys if not key.
-00019da0: 6973 6469 6769 7428 295d 0d0a 2020 2020  isdigit()]..    
-00019db0: 2020 2020 7265 7475 726e 206b 6579 730d      return keys.
-00019dc0: 0a0d 0a0d 0a0d 0a0d 0a20 2020 2040 5f63  .........    @_c
-00019dd0: 6f70 795f 746f 5f73 6372 6970 745f 7772  opy_to_script_wr
-00019de0: 6170 7065 720d 0a20 2020 2064 6566 205f  apper..    def _
-00019df0: 5f69 7465 725f 5f28 7365 6c66 2920 2d3e  _iter__(self) ->
-00019e00: 2049 7465 7261 746f 725b 6e6e 2e4d 6f64   Iterator[nn.Mod
-00019e10: 756c 655d 3a0d 0a20 2020 2020 2020 2072  ule]:..        r
-00019e20: 6574 7572 6e20 6974 6572 2873 656c 662e  eturn iter(self.
-00019e30: 5f6d 6f64 756c 6573 2e76 616c 7565 7328  _modules.values(
-00019e40: 2929 0d0a 0d0a 0d0a 2020 2020 2320 4e42  ))......    # NB
-00019e50: 3a20 5765 2063 616e 2774 2072 6561 6c6c  : We can't reall
-00019e60: 7920 7479 7065 2063 6865 636b 2074 6869  y type check thi
-00019e70: 7320 6675 6e63 7469 6f6e 2061 7320 7468  s function as th
-00019e80: 6520 7479 7065 206f 6620 696e 7075 740d  e type of input.
-00019e90: 0a20 2020 2023 206d 6179 2063 6861 6e67  .    # may chang
-00019ea0: 6520 6479 6e61 6d69 6361 6c6c 7920 2861  e dynamically (a
-00019eb0: 7320 6973 2074 6573 7465 6420 696e 0d0a  s is tested in..
-00019ec0: 2020 2020 2320 5465 7374 5363 7269 7074      # TestScript
-00019ed0: 2e74 6573 745f 7365 7175 656e 7469 616c  .test_sequential
-00019ee0: 5f69 6e74 6572 6d65 6469 6172 795f 7479  _intermediary_ty
-00019ef0: 7065 7329 2e20 2043 616e 6e6f 7420 616e  pes).  Cannot an
-00019f00: 6e6f 7461 7465 0d0a 2020 2020 2320 7769  notate..    # wi
-00019f10: 7468 2041 6e79 2061 7320 546f 7263 6853  th Any as TorchS
-00019f20: 6372 6970 7420 6578 7065 6374 7320 6120  cript expects a 
-00019f30: 6d6f 7265 2070 7265 6369 7365 2074 7970  more precise typ
-00019f40: 650d 0a20 2020 2023 2064 6566 2066 6f72  e..    # def for
-00019f50: 7761 7264 2873 656c 662c 2069 6e70 7574  ward(self, input
-00019f60: 293a 0d0a 2020 2020 2320 2020 2020 666f  ):..    #     fo
-00019f70: 7220 6d6f 6475 6c65 2069 6e20 7365 6c66  r module in self
-00019f80: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-00019f90: 2069 6e70 7574 203d 206d 6f64 756c 6528   input = module(
-00019fa0: 696e 7075 7429 0d0a 2020 2020 2320 2020  input)..    #   
-00019fb0: 2020 7265 7475 726e 2069 6e70 7574 0d0a    return input..
-00019fc0: 0d0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-00019fd0: 6428 7365 6c66 2c20 2a78 2c20 2a2a 6b77  d(self, *x, **kw
-00019fe0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00019ff0: 7820 3d20 756e 7061 636b 5f73 696e 676c  x = unpack_singl
-0001a000: 6574 6f6e 2878 290d 0a20 2020 2020 2020  eton(x)..       
-0001a010: 2066 6f72 206d 6f64 756c 6520 696e 2073   for module in s
-0001a020: 656c 662e 5f6d 6f64 756c 6573 2e76 616c  elf._modules.val
-0001a030: 7565 7328 293a 0d0a 2020 2020 2020 2020  ues():..        
-0001a040: 2020 2020 2320 7820 3d20 656e 666f 7263      # x = enforc
-0001a050: 655f 7369 6e67 6c65 746f 6e28 7829 0d0a  e_singleton(x)..
-0001a060: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0001a070: 7369 6e73 7461 6e63 6528 782c 2074 7570  sinstance(x, tup
-0001a080: 6c65 293a 0d0a 2020 2020 2020 2020 2020  le):..          
-0001a090: 2020 2020 2020 6966 206c 656e 286d 6f64        if len(mod
-0001a0a0: 756c 652e 7369 676e 6174 7572 652e 696e  ule.signature.in
-0001a0b0: 7075 7473 2920 3d3d 206c 656e 2878 293a  puts) == len(x):
-0001a0c0: 2020 2320 7365 6c66 2c78 0d0a 2020 2020    # self,x..    
-0001a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0e0: 7820 3d20 6d6f 6475 6c65 282a 782c 202a  x = module(*x, *
-0001a0f0: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-0001a100: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0001a110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a120: 2020 2020 2078 203d 2065 6e66 6f72 6365       x = enforce
-0001a130: 5f73 696e 676c 6574 6f6e 2878 290d 0a20  _singleton(x).. 
-0001a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a150: 2020 2078 203d 206d 6f64 756c 6528 782c     x = module(x,
-0001a160: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
-0001a170: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001a180: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0001a190: 203d 206d 6f64 756c 6528 782c 202a 2a6b   = module(x, **k
-0001a1a0: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
-0001a1b0: 2020 2020 2320 636c 6173 735f 6e61 6d65      # class_name
-0001a1c0: 3d6d 6f64 756c 652e 5f5f 636c 6173 735f  =module.__class_
-0001a1d0: 5f2e 5f5f 6e61 6d65 5f5f 2e6c 6f77 6572  _.__name__.lower
-0001a1e0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0001a1f0: 2320 6966 2027 6c73 746d 2720 696e 2063  # if 'lstm' in c
-0001a200: 6c61 7373 5f6e 616d 6520 6f72 2027 6772  lass_name or 'gr
-0001a210: 7527 2069 6e20 636c 6173 735f 6e61 6d65  u' in class_name
-0001a220: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0001a230: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0001a240: 6365 2878 2c74 7570 6c65 293a 0d0a 2020  ce(x,tuple):..  
-0001a250: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001a260: 2020 2020 782c 6878 3d78 0d0a 2020 2020      x,hx=x..    
-0001a270: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0001a280: 2020 6b77 6172 6773 5b27 6878 275d 3d68    kwargs['hx']=h
-0001a290: 780d 0a0d 0a20 2020 2020 2020 2072 6574  x....        ret
-0001a2a0: 7572 6e20 780d 0a0d 0a0d 0a20 2020 2064  urn x......    d
-0001a2b0: 6566 2061 7070 656e 6428 7365 6c66 2c20  ef append(self, 
-0001a2c0: 6d6f 6475 6c65 3a20 6e6e 2e4d 6f64 756c  module: nn.Modul
-0001a2d0: 6529 202d 3e20 2753 6571 7565 6e74 6961  e) -> 'Sequentia
-0001a2e0: 6c27 3a0d 0a20 2020 2020 2020 2072 2222  l':..        r""
-0001a2f0: 2241 7070 656e 6473 2061 2067 6976 656e  "Appends a given
-0001a300: 206d 6f64 756c 6520 746f 2074 6865 2065   module to the e
-0001a310: 6e64 2e0d 0a0d 0a20 2020 2020 2020 2041  nd.....        A
-0001a320: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
-0001a330: 2020 6d6f 6475 6c65 2028 6e6e 2e4d 6f64    module (nn.Mod
-0001a340: 756c 6529 3a20 6d6f 6475 6c65 2074 6f20  ule): module to 
-0001a350: 6170 7065 6e64 0d0a 2020 2020 2020 2020  append..        
-0001a360: 2222 220d 0a20 2020 2020 2020 2073 656c  """..        sel
-0001a370: 662e 6164 645f 6d6f 6475 6c65 2873 7472  f.add_module(str
-0001a380: 286c 656e 2873 656c 6629 292c 206d 6f64  (len(self)), mod
-0001a390: 756c 6529 0d0a 2020 2020 2020 2020 7265  ule)..        re
-0001a3a0: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
-0001a3b0: 2064 6566 2069 6e73 6572 7428 7365 6c66   def insert(self
-0001a3c0: 2c20 696e 6465 783a 2069 6e74 2c20 6d6f  , index: int, mo
-0001a3d0: 6475 6c65 3a20 6e6e 2e4d 6f64 756c 6529  dule: nn.Module)
-0001a3e0: 202d 3e20 2753 6571 7565 6e74 6961 6c27   -> 'Sequential'
-0001a3f0: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
-0001a400: 7420 6973 696e 7374 616e 6365 286d 6f64  t isinstance(mod
-0001a410: 756c 652c 204d 6f64 756c 6529 3a0d 0a20  ule, Module):.. 
-0001a420: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001a430: 2041 7373 6572 7469 6f6e 4572 726f 7228   AssertionError(
-0001a440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a450: 2020 276d 6f64 756c 6520 7368 6f75 6c64    'module should
-0001a460: 2062 6520 6f66 2074 7970 653a 207b 7d27   be of type: {}'
-0001a470: 2e66 6f72 6d61 7428 4d6f 6475 6c65 2929  .format(Module))
-0001a480: 0d0a 2020 2020 2020 2020 6e20 3d20 6c65  ..        n = le
-0001a490: 6e28 7365 6c66 2e5f 6d6f 6475 6c65 7329  n(self._modules)
-0001a4a0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0001a4b0: 2028 2d6e 203c 3d20 696e 6465 7820 3c3d   (-n <= index <=
-0001a4c0: 206e 293a 0d0a 2020 2020 2020 2020 2020   n):..          
-0001a4d0: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
-0001a4e0: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
-0001a4f0: 2020 2020 2027 496e 6465 7820 6f75 7420       'Index out 
-0001a500: 6f66 2072 616e 6765 3a20 7b7d 272e 666f  of range: {}'.fo
-0001a510: 726d 6174 2869 6e64 6578 2929 0d0a 2020  rmat(index))..  
-0001a520: 2020 2020 2020 6966 2069 6e64 6578 203c        if index <
-0001a530: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0001a540: 2069 6e64 6578 202b 3d20 6e0d 0a20 2020   index += n..   
-0001a550: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0001a560: 6e67 6528 6e2c 2069 6e64 6578 2c20 2d31  nge(n, index, -1
-0001a570: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001a580: 7365 6c66 2e5f 6d6f 6475 6c65 735b 7374  self._modules[st
-0001a590: 7228 6929 5d20 3d20 7365 6c66 2e5f 6d6f  r(i)] = self._mo
-0001a5a0: 6475 6c65 735b 7374 7228 6920 2d20 3129  dules[str(i - 1)
-0001a5b0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-0001a5c0: 5f6d 6f64 756c 6573 5b73 7472 2869 6e64  _modules[str(ind
-0001a5d0: 6578 295d 203d 206d 6f64 756c 650d 0a20  ex)] = module.. 
-0001a5e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001a5f0: 6c66 0d0a 0d0a 2020 2020 6465 6620 6578  lf....    def ex
-0001a600: 7465 6e64 2873 656c 662c 2073 6571 7565  tend(self, seque
-0001a610: 6e74 6961 6c29 202d 3e20 2753 6571 7565  ntial) -> 'Seque
-0001a620: 6e74 6961 6c27 3a0d 0a20 2020 2020 2020  ntial':..       
-0001a630: 2066 6f72 206c 6179 6572 2069 6e20 7365   for layer in se
-0001a640: 7175 656e 7469 616c 3a0d 0a20 2020 2020  quential:..     
-0001a650: 2020 2020 2020 2073 656c 662e 6170 7065         self.appe
-0001a660: 6e64 286c 6179 6572 290d 0a20 2020 2020  nd(layer)..     
-0001a670: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-0001a680: 0d0a 0d0a 0d0a 0d0a 0d0a 636c 6173 7320  ..........class 
-0001a690: 4d6f 6475 6c65 4c69 7374 284c 6179 6572  ModuleList(Layer
-0001a6a0: 293a 0d0a 2020 2020 2222 2248 6f6c 6473  ):..    """Holds
-0001a6b0: 2073 7562 6d6f 6475 6c65 7320 696e 2061   submodules in a
-0001a6c0: 206c 6973 742e 0d0a 0d0a 2020 2020 3a63   list.....    :c
-0001a6d0: 6c61 7373 3a60 7e74 7269 6465 6e74 2e62  lass:`~trident.b
-0001a6e0: 6163 6b65 6e64 2e74 656e 736f 7266 6c6f  ackend.tensorflo
-0001a6f0: 775f 6261 636b 656e 642e 4d6f 6475 6c65  w_backend.Module
-0001a700: 4c69 7374 6020 6361 6e20 6265 2069 6e64  List` can be ind
-0001a710: 6578 6564 206c 696b 6520 6120 7265 6775  exed like a regu
-0001a720: 6c61 7220 5079 7468 6f6e 206c 6973 742c  lar Python list,
-0001a730: 2062 7574 0d0a 2020 2020 6d6f 6475 6c65   but..    module
-0001a740: 7320 6974 2063 6f6e 7461 696e 7320 6172  s it contains ar
-0001a750: 6520 7072 6f70 6572 6c79 2072 6567 6973  e properly regis
-0001a760: 7465 7265 642c 2061 6e64 2077 696c 6c20  tered, and will 
-0001a770: 6265 2076 6973 6962 6c65 2062 7920 616c  be visible by al
-0001a780: 6c0d 0a20 2020 203a 636c 6173 733a 607e  l..    :class:`~
-0001a790: 7472 6964 656e 742e 6261 636b 656e 642e  trident.backend.
-0001a7a0: 7465 6e73 6f72 666c 6f77 5f62 6163 6b65  tensorflow_backe
-0001a7b0: 6e64 2e2e 4c61 7965 7260 206d 6574 686f  nd..Layer` metho
-0001a7c0: 6473 2e0d 0a0d 0a20 2020 2041 7267 756d  ds.....    Argum
-0001a7d0: 656e 7473 3a0d 0a20 2020 2020 2020 206d  ents:..        m
-0001a7e0: 6f64 756c 6573 2028 6974 6572 6162 6c65  odules (iterable
-0001a7f0: 2c20 6f70 7469 6f6e 616c 293a 2061 6e20  , optional): an 
-0001a800: 6974 6572 6162 6c65 206f 6620 6d6f 6475  iterable of modu
-0001a810: 6c65 7320 746f 2061 6464 0d0a 0d0a 2020  les to add....  
-0001a820: 2020 2222 220d 0a0d 0a20 2020 2064 6566    """....    def
-0001a830: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0001a840: 6d6f 6475 6c65 733a 204f 7074 696f 6e61  modules: Optiona
-0001a850: 6c5b 4974 6572 6162 6c65 5b4c 6179 6572  l[Iterable[Layer
-0001a860: 5d5d 203d 204e 6f6e 652c 206e 616d 653d  ]] = None, name=
-0001a870: 4e6f 6e65 2c20 6b65 6570 5f6f 7574 7075  None, keep_outpu
-0001a880: 743d 4661 6c73 652c 202a 2a6b 7761 7267  t=False, **kwarg
-0001a890: 7329 202d 3e20 4e6f 6e65 3a0d 0a20 2020  s) -> None:..   
-0001a8a0: 2020 2020 2073 7570 6572 284d 6f64 756c       super(Modul
-0001a8b0: 654c 6973 742c 2073 656c 6629 2e5f 5f69  eList, self).__i
-0001a8c0: 6e69 745f 5f28 6e61 6d65 3d4e 6f6e 652c  nit__(name=None,
-0001a8d0: 206b 6565 705f 6f75 7470 7574 3d46 616c   keep_output=Fal
-0001a8e0: 7365 2c20 2a2a 6b77 6172 6773 290d 0a20  se, **kwargs).. 
-0001a8f0: 2020 2020 2020 206e 616d 6520 3d20 7365         name = se
-0001a900: 6c66 2e5f 6e61 6d65 0d0a 0d0a 2020 2020  lf._name....    
-0001a910: 2020 2020 7374 6172 745f 6964 7820 3d20      start_idx = 
-0001a920: 6c65 6e28 7365 6c66 2e5f 6d6f 6475 6c65  len(self._module
-0001a930: 7329 0d0a 2020 2020 2020 2020 666f 7220  s)..        for 
-0001a940: 6d6f 6475 6c65 2069 6e20 6d6f 6475 6c65  module in module
-0001a950: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0001a960: 6d6f 6475 6c65 2e69 735f 726f 6f74 203d  module.is_root =
-0001a970: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0001a980: 2020 2020 6966 206d 6f64 756c 652e 7575      if module.uu
-0001a990: 6964 2021 3d20 7365 6c66 2e75 7569 643a  id != self.uuid:
-0001a9a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a9b0: 2020 7365 6c66 2e61 6464 5f6d 6f64 756c    self.add_modul
-0001a9c0: 6528 7374 7228 7374 6172 745f 6964 7829  e(str(start_idx)
-0001a9d0: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
-0001a9e0: 2020 2020 2020 2020 2020 2072 6573 6574             reset
-0001a9f0: 5f6e 616d 6528 6d6f 6475 6c65 2c20 7365  _name(module, se
-0001aa00: 6c66 2e5f 7569 645f 7072 6566 6978 7329  lf._uid_prefixs)
-0001aa10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001aa20: 2020 6d6f 6475 6c65 2e72 656c 6174 6976    module.relativ
-0001aa30: 655f 6e61 6d65 203d 206e 616d 6520 6966  e_name = name if
-0001aa40: 206e 6f74 2068 6173 6174 7472 286d 6f64   not hasattr(mod
-0001aa50: 756c 652c 0d0a 2020 2020 2020 2020 2020  ule,..          
-0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa90: 2027 7265 6c61 7469 7665 5f6e 616d 6527   'relative_name'
-0001aaa0: 2920 6f72 206d 6f64 756c 652e 7265 6c61  ) or module.rela
-0001aab0: 7469 7665 5f6e 616d 6520 3d3d 2027 2720  tive_name == '' 
-0001aac0: 656c 7365 206e 616d 6520 2b20 272e 2720  else name + '.' 
-0001aad0: 2b20 6d6f 6475 6c65 2e72 656c 6174 6976  + module.relativ
-0001aae0: 655f 6e61 6d65 0d0a 0d0a 2020 2020 6465  e_name....    de
-0001aaf0: 6620 5f67 6574 5f61 6273 5f73 7472 696e  f _get_abs_strin
-0001ab00: 675f 696e 6465 7828 7365 6c66 2c20 6964  g_index(self, id
-0001ab10: 7829 3a0d 0a20 2020 2020 2020 2022 2222  x):..        """
-0001ab20: 4765 7420 7468 6520 6162 736f 6c75 7465  Get the absolute
-0001ab30: 2069 6e64 6578 2066 6f72 2074 6865 206c   index for the l
-0001ab40: 6973 7420 6f66 206d 6f64 756c 6573 2222  ist of modules""
-0001ab50: 220d 0a20 2020 2020 2020 2069 6478 203d  "..        idx =
-0001ab60: 206f 7065 7261 746f 722e 696e 6465 7828   operator.index(
-0001ab70: 6964 7829 0d0a 2020 2020 2020 2020 6966  idx)..        if
-0001ab80: 206e 6f74 2028 2d6c 656e 2873 656c 6629   not (-len(self)
-0001ab90: 203c 3d20 6964 7820 3c20 6c65 6e28 7365   <= idx < len(se
-0001aba0: 6c66 2929 3a0d 0a20 2020 2020 2020 2020  lf)):..         
-0001abb0: 2020 2072 6169 7365 2049 6e64 6578 4572     raise IndexEr
-0001abc0: 726f 7228 2769 6e64 6578 207b 7d20 6973  ror('index {} is
-0001abd0: 206f 7574 206f 6620 7261 6e67 6527 2e66   out of range'.f
-0001abe0: 6f72 6d61 7428 6964 7829 290d 0a20 2020  ormat(idx))..   
-0001abf0: 2020 2020 2069 6620 6964 7820 3c20 303a       if idx < 0:
-0001ac00: 0d0a 2020 2020 2020 2020 2020 2020 6964  ..            id
-0001ac10: 7820 2b3d 206c 656e 2873 656c 6629 0d0a  x += len(self)..
-0001ac20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001ac30: 7472 2869 6478 290d 0a0d 0a20 2020 2023  tr(idx)....    #
-0001ac40: 2040 5f63 6f70 795f 746f 5f73 6372 6970   @_copy_to_scrip
-0001ac50: 745f 7772 6170 7065 720d 0a20 2020 2064  t_wrapper..    d
-0001ac60: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-0001ac70: 656c 662c 2069 6478 3a20 696e 7429 202d  elf, idx: int) -
-0001ac80: 3e20 4c61 7965 723a 0d0a 2020 2020 2020  > Layer:..      
-0001ac90: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0001aca0: 6964 782c 2073 6c69 6365 293a 0d0a 2020  idx, slice):..  
-0001acb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001acc0: 2073 656c 662e 5f5f 636c 6173 735f 5f28   self.__class__(
-0001acd0: 6c69 7374 2873 656c 662e 5f6d 6f64 756c  list(self._modul
-0001ace0: 6573 2e76 616c 7565 7328 2929 5b69 6478  es.values())[idx
-0001acf0: 5d29 0d0a 2020 2020 2020 2020 656c 7365  ])..        else
-0001ad00: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0001ad10: 6574 7572 6e20 7365 6c66 2e5f 6d6f 6475  eturn self._modu
-0001ad20: 6c65 735b 7365 6c66 2e5f 6765 745f 6162  les[self._get_ab
-0001ad30: 735f 7374 7269 6e67 5f69 6e64 6578 2869  s_string_index(i
-0001ad40: 6478 295d 0d0a 0d0a 2020 2020 6465 6620  dx)]....    def 
-0001ad50: 5f5f 7365 7469 7465 6d5f 5f28 7365 6c66  __setitem__(self
-0001ad60: 2c20 6964 783a 2069 6e74 2c20 6d6f 6475  , idx: int, modu
-0001ad70: 6c65 3a20 4c61 7965 7229 202d 3e20 4e6f  le: Layer) -> No
-0001ad80: 6e65 3a0d 0a20 2020 2020 2020 2069 6478  ne:..        idx
-0001ad90: 203d 2073 656c 662e 5f67 6574 5f61 6273   = self._get_abs
-0001ada0: 5f73 7472 696e 675f 696e 6465 7828 6964  _string_index(id
-0001adb0: 7829 0d0a 2020 2020 2020 2020 7265 7475  x)..        retu
-0001adc0: 726e 2073 6574 6174 7472 2873 656c 662c  rn setattr(self,
-0001add0: 2073 7472 2869 6478 292c 206d 6f64 756c   str(idx), modul
-0001ade0: 6529 0d0a 0d0a 2020 2020 6465 6620 5f5f  e)....    def __
-0001adf0: 6465 6c69 7465 6d5f 5f28 7365 6c66 2c20  delitem__(self, 
-0001ae00: 6964 783a 2055 6e69 6f6e 5b69 6e74 2c20  idx: Union[int, 
-0001ae10: 736c 6963 655d 2920 2d3e 204e 6f6e 653a  slice]) -> None:
-0001ae20: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0001ae30: 6e73 7461 6e63 6528 6964 782c 2073 6c69  nstance(idx, sli
-0001ae40: 6365 293a 0d0a 2020 2020 2020 2020 2020  ce):..          
-0001ae50: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-0001ae60: 286c 656e 2873 656c 662e 5f6d 6f64 756c  (len(self._modul
-0001ae70: 6573 2929 5b69 6478 5d3a 0d0a 2020 2020  es))[idx]:..    
-0001ae80: 2020 2020 2020 2020 2020 2020 6465 6c61              dela
-0001ae90: 7474 7228 7365 6c66 2c20 7374 7228 6b29  ttr(self, str(k)
-0001aea0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0001aeb0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-0001aec0: 6c61 7474 7228 7365 6c66 2c20 7365 6c66  lattr(self, self
-0001aed0: 2e5f 6765 745f 6162 735f 7374 7269 6e67  ._get_abs_string
-0001aee0: 5f69 6e64 6578 2869 6478 2929 0d0a 2020  _index(idx))..  
-0001aef0: 2020 2020 2020 2320 546f 2070 7265 7365        # To prese
-0001af00: 7276 6520 6e75 6d62 6572 696e 672c 2073  rve numbering, s
-0001af10: 656c 662e 5f6d 6f64 756c 6573 2069 7320  elf._modules is 
-0001af20: 6265 696e 6720 7265 636f 6e73 7472 7563  being reconstruc
-0001af30: 7465 6420 7769 7468 206d 6f64 756c 6573  ted with modules
-0001af40: 2061 6674 6572 2064 656c 6574 696f 6e0d   after deletion.
-0001af50: 0a20 2020 2020 2020 2073 7472 5f69 6e64  .        str_ind
-0001af60: 6963 6573 203d 205b 7374 7228 6929 2066  ices = [str(i) f
-0001af70: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
-0001af80: 6e28 7365 6c66 2e5f 6d6f 6475 6c65 7329  n(self._modules)
-0001af90: 295d 0d0a 2020 2020 2020 2020 7365 6c66  )]..        self
-0001afa0: 2e5f 6d6f 6475 6c65 7320 3d20 4f72 6465  ._modules = Orde
-0001afb0: 7265 6444 6963 7428 6c69 7374 287a 6970  redDict(list(zip
-0001afc0: 2873 7472 5f69 6e64 6963 6573 2c20 7365  (str_indices, se
-0001afd0: 6c66 2e5f 6d6f 6475 6c65 732e 7661 6c75  lf._modules.valu
-0001afe0: 6573 2829 2929 290d 0a0d 0a20 2020 2023  es())))....    #
-0001aff0: 2040 5f63 6f70 795f 746f 5f73 6372 6970   @_copy_to_scrip
-0001b000: 745f 7772 6170 7065 720d 0a20 2020 2064  t_wrapper..    d
-0001b010: 6566 205f 5f6c 656e 5f5f 2873 656c 6629  ef __len__(self)
-0001b020: 202d 3e20 696e 743a 0d0a 2020 2020 2020   -> int:..      
-0001b030: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
-0001b040: 662e 5f6d 6f64 756c 6573 290d 0a0d 0a20  f._modules).... 
-0001b050: 2020 2023 2040 5f63 6f70 795f 746f 5f73     # @_copy_to_s
-0001b060: 6372 6970 745f 7772 6170 7065 720d 0a20  cript_wrapper.. 
-0001b070: 2020 2064 6566 205f 5f69 7465 725f 5f28     def __iter__(
-0001b080: 7365 6c66 2920 2d3e 2074 7970 696e 672e  self) -> typing.
-0001b090: 4974 6572 6174 6f72 5b4c 6179 6572 5d3a  Iterator[Layer]:
-0001b0a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001b0b0: 2069 7465 7228 7365 6c66 2e5f 6d6f 6475   iter(self._modu
-0001b0c0: 6c65 732e 7661 6c75 6573 2829 290d 0a0d  les.values())...
-0001b0d0: 0a20 2020 2064 6566 205f 5f69 6164 645f  .    def __iadd_
-0001b0e0: 5f28 7365 6c66 3a20 542c 206d 6f64 756c  _(self: T, modul
-0001b0f0: 6573 3a20 4974 6572 6162 6c65 5b4c 6179  es: Iterable[Lay
-0001b100: 6572 5d29 202d 3e20 543a 0d0a 2020 2020  er]) -> T:..    
-0001b110: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001b120: 6578 7465 6e64 286d 6f64 756c 6573 290d  extend(modules).
-0001b130: 0a0d 0a20 2020 2023 2040 5f63 6f70 795f  ...    # @_copy_
-0001b140: 746f 5f73 6372 6970 745f 7772 6170 7065  to_script_wrappe
-0001b150: 720d 0a20 2020 2064 6566 205f 5f64 6972  r..    def __dir
-0001b160: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-0001b170: 2020 206b 6579 7320 3d20 7375 7065 7228     keys = super(
-0001b180: 4d6f 6475 6c65 4c69 7374 2c20 7365 6c66  ModuleList, self
-0001b190: 292e 5f5f 6469 725f 5f28 290d 0a20 2020  ).__dir__()..   
-0001b1a0: 2020 2020 206b 6579 7320 3d20 5b6b 6579       keys = [key
-0001b1b0: 2066 6f72 206b 6579 2069 6e20 6b65 7973   for key in keys
-0001b1c0: 2069 6620 6e6f 7420 6b65 792e 6973 6469   if not key.isdi
-0001b1d0: 6769 7428 295d 0d0a 2020 2020 2020 2020  git()]..        
-0001b1e0: 7265 7475 726e 206b 6579 730d 0a0d 0a20  return keys.... 
-0001b1f0: 2020 2064 6566 2069 6e73 6572 7428 7365     def insert(se
-0001b200: 6c66 2c20 696e 6465 783a 2069 6e74 2c20  lf, index: int, 
-0001b210: 6d6f 6475 6c65 3a20 4c61 7965 7229 202d  module: Layer) -
-0001b220: 3e20 4e6f 6e65 3a0d 0a20 2020 2020 2020  > None:..       
-0001b230: 2072 2222 2249 6e73 6572 7420 6120 6769   r"""Insert a gi
-0001b240: 7665 6e20 6d6f 6475 6c65 2062 6566 6f72  ven module befor
-0001b250: 6520 6120 6769 7665 6e20 696e 6465 7820  e a given index 
-0001b260: 696e 2074 6865 206c 6973 742e 0d0a 0d0a  in the list.....
-0001b270: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-0001b280: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0001b290: 696e 6465 7820 2869 6e74 293a 2069 6e64  index (int): ind
-0001b2a0: 6578 2074 6f20 696e 7365 7274 2e0d 0a20  ex to insert... 
-0001b2b0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-0001b2c0: 6520 286e 6e2e 4d6f 6475 6c65 293a 206d  e (nn.Module): m
-0001b2d0: 6f64 756c 6520 746f 2069 6e73 6572 740d  odule to insert.
-0001b2e0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0001b2f0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0001b300: 616e 6765 286c 656e 2873 656c 662e 5f6d  ange(len(self._m
-0001b310: 6f64 756c 6573 292c 2069 6e64 6578 2c20  odules), index, 
-0001b320: 2d31 293a 0d0a 2020 2020 2020 2020 2020  -1):..          
-0001b330: 2020 7365 6c66 2e5f 6d6f 6475 6c65 735b    self._modules[
-0001b340: 7374 7228 6929 5d20 3d20 7365 6c66 2e5f  str(i)] = self._
-0001b350: 6d6f 6475 6c65 735b 7374 7228 6920 2d20  modules[str(i - 
-0001b360: 3129 5d0d 0a20 2020 2020 2020 2073 656c  1)]..        sel
-0001b370: 662e 5f6d 6f64 756c 6573 5b73 7472 2869  f._modules[str(i
-0001b380: 6e64 6578 295d 203d 206d 6f64 756c 650d  ndex)] = module.
-0001b390: 0a0d 0a20 2020 2064 6566 2061 7070 656e  ...    def appen
-0001b3a0: 6428 7365 6c66 3a20 542c 206d 6f64 756c  d(self: T, modul
-0001b3b0: 653a 204c 6179 6572 2920 2d3e 2054 3a0d  e: Layer) -> T:.
-0001b3c0: 0a20 2020 2020 2020 2072 2222 2241 7070  .        r"""App
-0001b3d0: 656e 6473 2061 2067 6976 656e 206d 6f64  ends a given mod
-0001b3e0: 756c 6520 746f 2074 6865 2065 6e64 206f  ule to the end o
-0001b3f0: 6620 7468 6520 6c69 7374 2e0d 0a0d 0a20  f the list..... 
-0001b400: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
-0001b410: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-0001b420: 6f64 756c 6520 286e 6e2e 4d6f 6475 6c65  odule (nn.Module
-0001b430: 293a 206d 6f64 756c 6520 746f 2061 7070  ): module to app
-0001b440: 656e 640d 0a20 2020 2020 2020 2022 2222  end..        """
-0001b450: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-0001b460: 6464 5f6d 6f64 756c 6528 7374 7228 6c65  dd_module(str(le
-0001b470: 6e28 7365 6c66 2929 2c20 6d6f 6475 6c65  n(self)), module
-0001b480: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0001b490: 6e20 7365 6c66 0d0a 0d0a 2020 2020 6465  n self....    de
-0001b4a0: 6620 6578 7465 6e64 2873 656c 663a 2054  f extend(self: T
-0001b4b0: 2c20 6d6f 6475 6c65 733a 2049 7465 7261  , modules: Itera
-0001b4c0: 626c 655b 4c61 7965 725d 2920 2d3e 2054  ble[Layer]) -> T
-0001b4d0: 3a0d 0a20 2020 2020 2020 2072 2222 2241  :..        r"""A
-0001b4e0: 7070 656e 6473 206d 6f64 756c 6573 2066  ppends modules f
-0001b4f0: 726f 6d20 6120 5079 7468 6f6e 2069 7465  rom a Python ite
-0001b500: 7261 626c 6520 746f 2074 6865 2065 6e64  rable to the end
-0001b510: 206f 6620 7468 6520 6c69 7374 2e0d 0a0d   of the list....
-0001b520: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
-0001b530: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-0001b540: 206d 6f64 756c 6573 2028 6974 6572 6162   modules (iterab
-0001b550: 6c65 293a 2069 7465 7261 626c 6520 6f66  le): iterable of
-0001b560: 206d 6f64 756c 6573 2074 6f20 6170 7065   modules to appe
-0001b570: 6e64 0d0a 2020 2020 2020 2020 2222 220d  nd..        """.
-0001b580: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001b590: 6973 696e 7374 616e 6365 286d 6f64 756c  isinstance(modul
-0001b5a0: 6573 2c20 6162 632e 4974 6572 6162 6c65  es, abc.Iterable
-0001b5b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001b5c0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0001b5d0: 224d 6f64 756c 654c 6973 742e 6578 7465  "ModuleList.exte
-0001b5e0: 6e64 2073 686f 756c 6420 6265 2063 616c  nd should be cal
-0001b5f0: 6c65 6420 7769 7468 2061 6e20 220d 0a20  led with an ".. 
-0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b610: 2020 2020 2020 2020 2020 2022 6974 6572             "iter
-0001b620: 6162 6c65 2c20 6275 7420 676f 7420 2220  able, but got " 
-0001b630: 2b20 7479 7065 286d 6f64 756c 6573 292e  + type(modules).
-0001b640: 5f5f 6e61 6d65 5f5f 290d 0a20 2020 2020  __name__)..     
-0001b650: 2020 206f 6666 7365 7420 3d20 6c65 6e28     offset = len(
-0001b660: 7365 6c66 290d 0a20 2020 2020 2020 2066  self)..        f
-0001b670: 6f72 2069 2c20 6d6f 6475 6c65 2069 6e20  or i, module in 
-0001b680: 656e 756d 6572 6174 6528 6d6f 6475 6c65  enumerate(module
-0001b690: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-0001b6a0: 2073 656c 662e 6164 645f 6d6f 6475 6c65   self.add_module
-0001b6b0: 2873 7472 286f 6666 7365 7420 2b20 6929  (str(offset + i)
-0001b6c0: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
-0001b6d0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-0001b6e0: 0d0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-0001b6f0: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
-0001b700: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0001b710: 6d65 6e74 6564 4572 726f 7228 290d 0a0d  mentedError()...
-0001b720: 0a0d 0a63 6c61 7373 204d 6f64 756c 6544  ...class ModuleD
-0001b730: 6963 7428 4c61 7965 7229 3a0d 0a20 2020  ict(Layer):..   
-0001b740: 2072 2222 2248 6f6c 6473 2073 7562 6d6f   r"""Holds submo
-0001b750: 6475 6c65 7320 696e 2061 2064 6963 7469  dules in a dicti
-0001b760: 6f6e 6172 792e 0d0a 0d0a 2020 2020 3a63  onary.....    :c
-0001b770: 6c61 7373 3a60 7e74 6f72 6368 2e6e 6e2e  lass:`~torch.nn.
-0001b780: 4d6f 6475 6c65 4469 6374 6020 6361 6e20  ModuleDict` can 
-0001b790: 6265 2069 6e64 6578 6564 206c 696b 6520  be indexed like 
-0001b7a0: 6120 7265 6775 6c61 7220 5079 7468 6f6e  a regular Python
-0001b7b0: 2064 6963 7469 6f6e 6172 792c 0d0a 2020   dictionary,..  
-0001b7c0: 2020 6275 7420 6d6f 6475 6c65 7320 6974    but modules it
-0001b7d0: 2063 6f6e 7461 696e 7320 6172 6520 7072   contains are pr
-0001b7e0: 6f70 6572 6c79 2072 6567 6973 7465 7265  operly registere
-0001b7f0: 642c 2061 6e64 2077 696c 6c20 6265 2076  d, and will be v
-0001b800: 6973 6962 6c65 2062 7920 616c 6c0d 0a20  isible by all.. 
-0001b810: 2020 203a 636c 6173 733a 607e 746f 7263     :class:`~torc
-0001b820: 682e 6e6e 2e4d 6f64 756c 6560 206d 6574  h.nn.Module` met
-0001b830: 686f 6473 2e0d 0a0d 0a20 2020 203a 636c  hods.....    :cl
-0001b840: 6173 733a 607e 746f 7263 682e 6e6e 2e4d  ass:`~torch.nn.M
-0001b850: 6f64 756c 6544 6963 7460 2069 7320 616e  oduleDict` is an
-0001b860: 202a 2a6f 7264 6572 6564 2a2a 2064 6963   **ordered** dic
-0001b870: 7469 6f6e 6172 7920 7468 6174 2072 6573  tionary that res
-0001b880: 7065 6374 730d 0a0d 0a20 2020 202a 2074  pects....    * t
-0001b890: 6865 206f 7264 6572 206f 6620 696e 7365  he order of inse
-0001b8a0: 7274 696f 6e2c 2061 6e64 0d0a 0d0a 2020  rtion, and....  
-0001b8b0: 2020 2a20 696e 203a 6d65 7468 3a60 7e74    * in :meth:`~t
-0001b8c0: 6f72 6368 2e6e 6e2e 4d6f 6475 6c65 4469  orch.nn.ModuleDi
-0001b8d0: 6374 2e75 7064 6174 6560 2c20 7468 6520  ct.update`, the 
-0001b8e0: 6f72 6465 7220 6f66 2074 6865 206d 6572  order of the mer
-0001b8f0: 6765 6420 6060 4f72 6465 7265 6444 6963  ged ``OrderedDic
-0001b900: 7460 600d 0a20 2020 2020 206f 7220 616e  t``..      or an
-0001b910: 6f74 6865 7220 3a63 6c61 7373 3a60 7e74  other :class:`~t
-0001b920: 6f72 6368 2e6e 6e2e 4d6f 6475 6c65 4469  orch.nn.ModuleDi
-0001b930: 6374 6020 2874 6865 2061 7267 756d 656e  ct` (the argumen
-0001b940: 7420 746f 203a 6d65 7468 3a60 7e74 6f72  t to :meth:`~tor
-0001b950: 6368 2e6e 6e2e 4d6f 6475 6c65 4469 6374  ch.nn.ModuleDict
-0001b960: 2e75 7064 6174 6560 292e 0d0a 0d0a 2020  .update`).....  
-0001b970: 2020 4e6f 7465 2074 6861 7420 3a6d 6574    Note that :met
-0001b980: 683a 607e 746f 7263 682e 6e6e 2e4d 6f64  h:`~torch.nn.Mod
-0001b990: 756c 6544 6963 742e 7570 6461 7465 6020  uleDict.update` 
-0001b9a0: 7769 7468 206f 7468 6572 2075 6e6f 7264  with other unord
-0001b9b0: 6572 6564 206d 6170 7069 6e67 0d0a 2020  ered mapping..  
-0001b9c0: 2020 7479 7065 7320 2865 2e67 2e2c 2050    types (e.g., P
-0001b9d0: 7974 686f 6e27 7320 706c 6169 6e20 6060  ython's plain ``
-0001b9e0: 6469 6374 6060 2920 646f 6573 206e 6f74  dict``) does not
-0001b9f0: 2070 7265 7365 7276 6520 7468 6520 6f72   preserve the or
-0001ba00: 6465 7220 6f66 2074 6865 0d0a 2020 2020  der of the..    
-0001ba10: 6d65 7267 6564 206d 6170 7069 6e67 2e0d  merged mapping..
-0001ba20: 0a0d 0a20 2020 2041 7267 756d 656e 7473  ...    Arguments
-0001ba30: 3a0d 0a20 2020 2020 2020 206d 6f64 756c  :..        modul
-0001ba40: 6573 2028 6974 6572 6162 6c65 2c20 6f70  es (iterable, op
-0001ba50: 7469 6f6e 616c 293a 2061 206d 6170 7069  tional): a mappi
-0001ba60: 6e67 2028 6469 6374 696f 6e61 7279 2920  ng (dictionary) 
-0001ba70: 6f66 2028 7374 7269 6e67 3a20 6d6f 6475  of (string: modu
-0001ba80: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
-0001ba90: 206f 7220 616e 2069 7465 7261 626c 6520   or an iterable 
-0001baa0: 6f66 206b 6579 2d76 616c 7565 2070 6169  of key-value pai
-0001bab0: 7273 206f 6620 7479 7065 2028 7374 7269  rs of type (stri
-0001bac0: 6e67 2c20 6d6f 6475 6c65 290d 0a0d 0a20  ng, module).... 
-0001bad0: 2020 2045 7861 6d70 6c65 3a3a 0d0a 0d0a     Example::....
-0001bae0: 2020 2020 2020 2020 636c 6173 7320 4d79          class My
-0001baf0: 4d6f 6475 6c65 286e 6e2e 4d6f 6475 6c65  Module(nn.Module
-0001bb00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001bb10: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0001bb20: 6629 3a0d 0a20 2020 2020 2020 2020 2020  f):..           
-0001bb30: 2020 2020 2073 7570 6572 284d 794d 6f64       super(MyMod
-0001bb40: 756c 652c 2073 656c 6629 2e5f 5f69 6e69  ule, self).__ini
-0001bb50: 745f 5f28 290d 0a20 2020 2020 2020 2020  t__()..         
-0001bb60: 2020 2020 2020 2073 656c 662e 6368 6f69         self.choi
-0001bb70: 6365 7320 3d20 6e6e 2e4d 6f64 756c 6544  ces = nn.ModuleD
-0001bb80: 6963 7428 7b0d 0a20 2020 2020 2020 2020  ict({..         
-0001bb90: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001bba0: 636f 6e76 273a 206e 6e2e 436f 6e76 3264  conv': nn.Conv2d
-0001bbb0: 2831 302c 2031 302c 2033 292c 0d0a 2020  (10, 10, 3),..  
-0001bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbd0: 2020 2020 2020 2770 6f6f 6c27 3a20 6e6e        'pool': nn
-0001bbe0: 2e4d 6178 506f 6f6c 3264 2833 290d 0a20  .MaxPool2d(3).. 
-0001bbf0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0001bc00: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001bc10: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
-0001bc20: 6f6e 7320 3d20 6e6e 2e4d 6f64 756c 6544  ons = nn.ModuleD
-0001bc30: 6963 7428 5b0d 0a20 2020 2020 2020 2020  ict([..         
-0001bc40: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0001bc50: 276c 7265 6c75 272c 206e 6e2e 4c65 616b  'lrelu', nn.Leak
-0001bc60: 7952 654c 5528 295d 2c0d 0a20 2020 2020  yReLU()],..     
-0001bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc80: 2020 205b 2770 7265 6c75 272c 206e 6e2e     ['prelu', nn.
-0001bc90: 5052 654c 5528 295d 0d0a 2020 2020 2020  PReLU()]..      
-0001bca0: 2020 2020 2020 2020 2020 5d29 0d0a 0d0a            ])....
-0001bcb0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-0001bcc0: 666f 7277 6172 6428 7365 6c66 2c20 782c  forward(self, x,
-0001bcd0: 2063 686f 6963 652c 2061 6374 293a 0d0a   choice, act):..
-0001bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bcf0: 7820 3d20 7365 6c66 2e63 686f 6963 6573  x = self.choices
-0001bd00: 5b63 686f 6963 655d 2878 290d 0a20 2020  [choice](x)..   
-0001bd10: 2020 2020 2020 2020 2020 2020 2078 203d               x =
-0001bd20: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
-0001bd30: 735b 6163 745d 2878 290d 0a20 2020 2020  s[act](x)..     
-0001bd40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001bd50: 6e20 780d 0a20 2020 2022 2222 0d0a 0d0a  n x..    """....
-0001bd60: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0001bd70: 2873 656c 662c 206d 6f64 756c 6573 3a20  (self, modules: 
-0001bd80: 4f70 7469 6f6e 616c 5b4d 6170 7069 6e67  Optional[Mapping
-0001bd90: 5b73 7472 2c20 4c61 7965 725d 5d20 3d20  [str, Layer]] = 
-0001bda0: 4e6f 6e65 2c20 6e61 6d65 3d4e 6f6e 652c  None, name=None,
-0001bdb0: 206b 6565 705f 6f75 7470 7574 3d46 616c   keep_output=Fal
-0001bdc0: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
-0001bdd0: 2020 2020 2020 6973 5f6d 756c 7469 6361        is_multica
-0001bde0: 7374 696e 673d 4661 6c73 652c 202a 2a6b  sting=False, **k
-0001bdf0: 7761 7267 7329 202d 3e20 4e6f 6e65 3a0d  wargs) -> None:.
-0001be00: 0a20 2020 2020 2020 2073 7570 6572 284d  .        super(M
-0001be10: 6f64 756c 6544 6963 742c 2073 656c 6629  oduleDict, self)
-0001be20: 2e5f 5f69 6e69 745f 5f28 6e61 6d65 3d4e  .__init__(name=N
-0001be30: 6f6e 652c 206b 6565 705f 6f75 7470 7574  one, keep_output
-0001be40: 3d46 616c 7365 2c20 2a2a 6b77 6172 6773  =False, **kwargs
-0001be50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001be60: 6973 5f6d 756c 7469 6361 7374 696e 6720  is_multicasting 
-0001be70: 3d20 6973 5f6d 756c 7469 6361 7374 696e  = is_multicastin
-0001be80: 670d 0a20 2020 2020 2020 2069 6620 6d6f  g..        if mo
-0001be90: 6475 6c65 7320 6973 206e 6f74 204e 6f6e  dules is not Non
-0001bea0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001beb0: 6966 206c 656e 286d 6f64 756c 6573 2920  if len(modules) 
-0001bec0: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-0001bed0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-0001bee0: 6528 6d6f 6475 6c65 7329 0d0a 0d0a 2020  e(modules)....  
-0001bef0: 2020 2320 405f 636f 7079 5f74 6f5f 7363    # @_copy_to_sc
-0001bf00: 7269 7074 5f77 7261 7070 6572 0d0a 2020  ript_wrapper..  
-0001bf10: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
-0001bf20: 5f28 7365 6c66 2c20 6b65 793a 2073 7472  _(self, key: str
-0001bf30: 2920 2d3e 204c 6179 6572 3a0d 0a20 2020  ) -> Layer:..   
-0001bf40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001bf50: 2e5f 6d6f 6475 6c65 735b 6b65 795d 0d0a  ._modules[key]..
-0001bf60: 0d0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
-0001bf70: 7465 6d5f 5f28 7365 6c66 2c20 6b65 793a  tem__(self, key:
-0001bf80: 2073 7472 2c20 6d6f 6475 6c65 3a20 4c61   str, module: La
-0001bf90: 7965 7229 202d 3e20 4e6f 6e65 3a0d 0a20  yer) -> None:.. 
-0001bfa0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0001bfb0: 6d6f 6475 6c65 286b 6579 2c20 6d6f 6475  module(key, modu
-0001bfc0: 6c65 290d 0a20 2020 2020 2020 2069 6620  le)..        if 
-0001bfd0: 7365 6c66 2e5f 696e 7075 745f 7368 6170  self._input_shap
-0001bfe0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-0001bff0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-0001c000: 6c65 2e69 6e70 7574 5f73 6861 7065 203d  le.input_shape =
-0001c010: 2073 656c 662e 696e 7075 745f 7368 6170   self.input_shap
-0001c020: 650d 0a0d 0a20 2020 2064 6566 205f 5f64  e....    def __d
-0001c030: 656c 6974 656d 5f5f 2873 656c 662c 206b  elitem__(self, k
-0001c040: 6579 3a20 7374 7229 202d 3e20 4e6f 6e65  ey: str) -> None
-0001c050: 3a0d 0a20 2020 2020 2020 2064 656c 2073  :..        del s
-0001c060: 656c 662e 5f6d 6f64 756c 6573 5b6b 6579  elf._modules[key
-0001c070: 5d0d 0a0d 0a20 2020 2023 2040 5f63 6f70  ]....    # @_cop
-0001c080: 795f 746f 5f73 6372 6970 745f 7772 6170  y_to_script_wrap
-0001c090: 7065 720d 0a20 2020 2064 6566 205f 5f6c  per..    def __l
-0001c0a0: 656e 5f5f 2873 656c 6629 202d 3e20 696e  en__(self) -> in
-0001c0b0: 743a 0d0a 2020 2020 2020 2020 7265 7475  t:..        retu
-0001c0c0: 726e 206c 656e 2873 656c 662e 5f6d 6f64  rn len(self._mod
-0001c0d0: 756c 6573 290d 0a0d 0a20 2020 2023 2040  ules)....    # @
-0001c0e0: 5f63 6f70 795f 746f 5f73 6372 6970 745f  _copy_to_script_
-0001c0f0: 7772 6170 7065 720d 0a20 2020 2064 6566  wrapper..    def
-0001c100: 205f 5f69 7465 725f 5f28 7365 6c66 293a   __iter__(self):
-0001c110: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001c120: 2069 7465 7228 7365 6c66 2e5f 6d6f 6475   iter(self._modu
-0001c130: 6c65 7329 0d0a 0d0a 2020 2020 2320 405f  les)....    # @_
-0001c140: 636f 7079 5f74 6f5f 7363 7269 7074 5f77  copy_to_script_w
-0001c150: 7261 7070 6572 0d0a 2020 2020 6465 6620  rapper..    def 
-0001c160: 5f5f 636f 6e74 6169 6e73 5f5f 2873 656c  __contains__(sel
-0001c170: 662c 206b 6579 3a20 7374 7229 202d 3e20  f, key: str) -> 
-0001c180: 626f 6f6c 3a0d 0a20 2020 2020 2020 2072  bool:..        r
-0001c190: 6574 7572 6e20 6b65 7920 696e 2073 656c  eturn key in sel
-0001c1a0: 662e 5f6d 6f64 756c 6573 0d0a 0d0a 2020  f._modules....  
-0001c1b0: 2020 6465 6620 636c 6561 7228 7365 6c66    def clear(self
-0001c1c0: 2920 2d3e 204e 6f6e 653a 0d0a 2020 2020  ) -> None:..    
-0001c1d0: 2020 2020 2222 2252 656d 6f76 6520 616c      """Remove al
-0001c1e0: 6c20 6974 656d 7320 6672 6f6d 2074 6865  l items from the
-0001c1f0: 204d 6f64 756c 6544 6963 742e 0d0a 2020   ModuleDict...  
-0001c200: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0001c210: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
-0001c220: 2e63 6c65 6172 2829 0d0a 0d0a 2020 2020  .clear()....    
-0001c230: 6465 6620 706f 7028 7365 6c66 2c20 6b65  def pop(self, ke
-0001c240: 793a 2073 7472 2920 2d3e 204c 6179 6572  y: str) -> Layer
-0001c250: 3a0d 0a20 2020 2020 2020 2072 2222 2252  :..        r"""R
-0001c260: 656d 6f76 6520 6b65 7920 6672 6f6d 2074  emove key from t
-0001c270: 6865 204d 6f64 756c 6544 6963 7420 616e  he ModuleDict an
-0001c280: 6420 7265 7475 726e 2069 7473 206d 6f64  d return its mod
-0001c290: 756c 652e 0d0a 0d0a 2020 2020 2020 2020  ule.....        
-0001c2a0: 4172 6775 6d65 6e74 733a 0d0a 2020 2020  Arguments:..    
-0001c2b0: 2020 2020 2020 2020 6b65 7920 2873 7472          key (str
-0001c2c0: 696e 6729 3a20 6b65 7920 746f 2070 6f70  ing): key to pop
-0001c2d0: 2066 726f 6d20 7468 6520 4d6f 6475 6c65   from the Module
-0001c2e0: 4469 6374 0d0a 2020 2020 2020 2020 2222  Dict..        ""
-0001c2f0: 220d 0a20 2020 2020 2020 2076 203d 2073  "..        v = s
-0001c300: 656c 665b 6b65 795d 0d0a 2020 2020 2020  elf[key]..      
-0001c310: 2020 6465 6c20 7365 6c66 5b6b 6579 5d0d    del self[key].
-0001c320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c330: 760d 0a0d 0a20 2020 2023 2040 5f63 6f70  v....    # @_cop
-0001c340: 795f 746f 5f73 6372 6970 745f 7772 6170  y_to_script_wrap
-0001c350: 7065 720d 0a20 2020 2064 6566 206b 6579  per..    def key
-0001c360: 7328 7365 6c66 2920 2d3e 2049 7465 7261  s(self) -> Itera
-0001c370: 626c 655b 7374 725d 3a0d 0a20 2020 2020  ble[str]:..     
-0001c380: 2020 2072 2222 2252 6574 7572 6e20 616e     r"""Return an
-0001c390: 2069 7465 7261 626c 6520 6f66 2074 6865   iterable of the
-0001c3a0: 204d 6f64 756c 6544 6963 7420 6b65 7973   ModuleDict keys
-0001c3b0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-0001c3c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001c3d0: 656c 662e 5f6d 6f64 756c 6573 2e6b 6579  elf._modules.key
-0001c3e0: 7328 290d 0a0d 0a20 2020 2023 2040 5f63  s()....    # @_c
-0001c3f0: 6f70 795f 746f 5f73 6372 6970 745f 7772  opy_to_script_wr
-0001c400: 6170 7065 720d 0a20 2020 2064 6566 2069  apper..    def i
-0001c410: 7465 6d73 2873 656c 6629 202d 3e20 4974  tems(self) -> It
-0001c420: 6572 6162 6c65 5b54 7570 6c65 5b73 7472  erable[Tuple[str
-0001c430: 2c20 4c61 7965 725d 5d3a 0d0a 2020 2020  , Layer]]:..    
-0001c440: 2020 2020 7222 2222 5265 7475 726e 2061      r"""Return a
-0001c450: 6e20 6974 6572 6162 6c65 206f 6620 7468  n iterable of th
-0001c460: 6520 4d6f 6475 6c65 4469 6374 206b 6579  e ModuleDict key
-0001c470: 2f76 616c 7565 2070 6169 7273 2e0d 0a20  /value pairs... 
-0001c480: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0001c490: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001c4a0: 5f6d 6f64 756c 6573 2e69 7465 6d73 2829  _modules.items()
-0001c4b0: 0d0a 0d0a 2020 2020 2320 405f 636f 7079  ....    # @_copy
-0001c4c0: 5f74 6f5f 7363 7269 7074 5f77 7261 7070  _to_script_wrapp
-0001c4d0: 6572 0d0a 2020 2020 6465 6620 7661 6c75  er..    def valu
-0001c4e0: 6573 2873 656c 6629 202d 3e20 4974 6572  es(self) -> Iter
-0001c4f0: 6162 6c65 5b4c 6179 6572 5d3a 0d0a 2020  able[Layer]:..  
-0001c500: 2020 2020 2020 7222 2222 5265 7475 726e        r"""Return
-0001c510: 2061 6e20 6974 6572 6162 6c65 206f 6620   an iterable of 
-0001c520: 7468 6520 4d6f 6475 6c65 4469 6374 2076  the ModuleDict v
-0001c530: 616c 7565 732e 0d0a 2020 2020 2020 2020  alues...        
-0001c540: 2222 220d 0a20 2020 2020 2020 2072 6574  """..        ret
-0001c550: 7572 6e20 7365 6c66 2e5f 6d6f 6475 6c65  urn self._module
-0001c560: 732e 7661 6c75 6573 2829 0d0a 0d0a 2020  s.values()....  
-0001c570: 2020 6465 6620 7570 6461 7465 2873 656c    def update(sel
-0001c580: 662c 206d 6f64 756c 6573 3a20 4d61 7070  f, modules: Mapp
-0001c590: 696e 675b 7374 722c 204c 6179 6572 5d29  ing[str, Layer])
-0001c5a0: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
-0001c5b0: 2020 2072 2222 2255 7064 6174 6520 7468     r"""Update th
-0001c5c0: 6520 3a63 6c61 7373 3a60 7e74 6f72 6368  e :class:`~torch
-0001c5d0: 2e6e 6e2e 4d6f 6475 6c65 4469 6374 6020  .nn.ModuleDict` 
-0001c5e0: 7769 7468 2074 6865 206b 6579 2d76 616c  with the key-val
-0001c5f0: 7565 2070 6169 7273 2066 726f 6d20 610d  ue pairs from a.
-0001c600: 0a20 2020 2020 2020 206d 6170 7069 6e67  .        mapping
-0001c610: 206f 7220 616e 2069 7465 7261 626c 652c   or an iterable,
-0001c620: 206f 7665 7277 7269 7469 6e67 2065 7869   overwriting exi
-0001c630: 7374 696e 6720 6b65 7973 2e0d 0a0d 0a20  sting keys..... 
-0001c640: 2020 2020 2020 202e 2e20 6e6f 7465 3a3a         .. note::
-0001c650: 0d0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-0001c660: 203a 6174 7472 3a60 6d6f 6475 6c65 7360   :attr:`modules`
-0001c670: 2069 7320 616e 2060 604f 7264 6572 6564   is an ``Ordered
-0001c680: 4469 6374 6060 2c20 6120 3a63 6c61 7373  Dict``, a :class
-0001c690: 3a60 7e74 6f72 6368 2e6e 6e2e 4d6f 6475  :`~torch.nn.Modu
-0001c6a0: 6c65 4469 6374 602c 206f 720d 0a20 2020  leDict`, or..   
-0001c6b0: 2020 2020 2020 2020 2061 6e20 6974 6572           an iter
-0001c6c0: 6162 6c65 206f 6620 6b65 792d 7661 6c75  able of key-valu
-0001c6d0: 6520 7061 6972 732c 2074 6865 206f 7264  e pairs, the ord
-0001c6e0: 6572 206f 6620 6e65 7720 656c 656d 656e  er of new elemen
-0001c6f0: 7473 2069 6e20 6974 2069 7320 7072 6573  ts in it is pres
-0001c700: 6572 7665 642e 0d0a 0d0a 2020 2020 2020  erved.....      
-0001c710: 2020 4172 6775 6d65 6e74 733a 0d0a 2020    Arguments:..  
-0001c720: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-0001c730: 7320 2869 7465 7261 626c 6529 3a20 6120  s (iterable): a 
-0001c740: 6d61 7070 696e 6720 2864 6963 7469 6f6e  mapping (diction
-0001c750: 6172 7929 2066 726f 6d20 7374 7269 6e67  ary) from string
-0001c760: 2074 6f20 3a63 6c61 7373 3a60 7e74 6f72   to :class:`~tor
-0001c770: 6368 2e6e 6e2e 4d6f 6475 6c65 602c 0d0a  ch.nn.Module`,..
-0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c790: 6f72 2061 6e20 6974 6572 6162 6c65 206f  or an iterable o
-0001c7a0: 6620 6b65 792d 7661 6c75 6520 7061 6972  f key-value pair
-0001c7b0: 7320 6f66 2074 7970 6520 2873 7472 696e  s of type (strin
-0001c7c0: 672c 203a 636c 6173 733a 607e 746f 7263  g, :class:`~torc
-0001c7d0: 682e 6e6e 2e4d 6f64 756c 6560 290d 0a20  h.nn.Module`).. 
-0001c7e0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0001c7f0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-0001c800: 7461 6e63 6528 6d6f 6475 6c65 732c 2061  tance(modules, a
-0001c810: 6263 2e49 7465 7261 626c 6529 3a0d 0a20  bc.Iterable):.. 
-0001c820: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001c830: 2054 7970 6545 7272 6f72 2822 4d6f 6475   TypeError("Modu
-0001c840: 6c65 4469 6374 2e75 7064 6174 6520 7368  leDict.update sh
-0001c850: 6f75 6c64 2062 6520 6361 6c6c 6564 2077  ould be called w
-0001c860: 6974 6820 616e 2022 0d0a 2020 2020 2020  ith an "..      
-0001c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c880: 2020 2020 2020 2269 7465 7261 626c 6520        "iterable 
-0001c890: 6f66 206b 6579 2f76 616c 7565 2070 6169  of key/value pai
-0001c8a0: 7273 2c20 6275 7420 676f 7420 2220 2b0d  rs, but got " +.
-0001c8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c8c0: 2020 2020 2020 2020 2020 2020 2074 7970               typ
-0001c8d0: 6528 6d6f 6475 6c65 7329 2e5f 5f6e 616d  e(modules).__nam
-0001c8e0: 655f 5f29 0d0a 0d0a 2020 2020 2020 2020  e__)....        
-0001c8f0: 6966 2069 7369 6e73 7461 6e63 6528 6d6f  if isinstance(mo
-0001c900: 6475 6c65 732c 2028 4f72 6465 7265 6444  dules, (OrderedD
-0001c910: 6963 742c 204d 6f64 756c 6544 6963 7429  ict, ModuleDict)
-0001c920: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001c930: 666f 7220 6b65 792c 206d 6f64 756c 6520  for key, module 
-0001c940: 696e 206d 6f64 756c 6573 2e69 7465 6d73  in modules.items
-0001c950: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0001c960: 2020 2020 2073 656c 665b 6b65 795d 203d       self[key] =
-0001c970: 206d 6f64 756c 650d 0a20 2020 2020 2020   module..       
-0001c980: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0001c990: 286d 6f64 756c 6573 2c20 6162 632e 4d61  (modules, abc.Ma
-0001c9a0: 7070 696e 6729 3a0d 0a20 2020 2020 2020  pping):..       
-0001c9b0: 2020 2020 2066 6f72 206b 6579 2c20 6d6f       for key, mo
-0001c9c0: 6475 6c65 2069 6e20 736f 7274 6564 286d  dule in sorted(m
-0001c9d0: 6f64 756c 6573 2e69 7465 6d73 2829 293a  odules.items()):
-0001c9e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001c9f0: 2020 7365 6c66 5b6b 6579 5d20 3d20 6d6f    self[key] = mo
-0001ca00: 6475 6c65 0d0a 2020 2020 2020 2020 656c  dule..        el
-0001ca10: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0001ca20: 2066 6f72 206a 2c20 6d20 696e 2065 6e75   for j, m in enu
-0001ca30: 6d65 7261 7465 286d 6f64 756c 6573 293a  merate(modules):
-0001ca40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ca50: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001ca60: 6e63 6528 6d2c 2061 6263 2e49 7465 7261  nce(m, abc.Itera
-0001ca70: 626c 6529 3a0d 0a20 2020 2020 2020 2020  ble):..         
-0001ca80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001ca90: 2054 7970 6545 7272 6f72 2822 4d6f 6475   TypeError("Modu
-0001caa0: 6c65 4469 6374 2075 7064 6174 6520 7365  leDict update se
-0001cab0: 7175 656e 6365 2065 6c65 6d65 6e74 2022  quence element "
-0001cac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cae0: 2020 2020 2020 2223 2220 2b20 7374 7228        "#" + str(
-0001caf0: 6a29 202b 2022 2073 686f 756c 6420 6265  j) + " should be
-0001cb00: 2049 7465 7261 626c 653b 2069 7322 202b   Iterable; is" +
-0001cb10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb30: 2020 2020 2020 7479 7065 286d 292e 5f5f        type(m).__
-0001cb40: 6e61 6d65 5f5f 290d 0a20 2020 2020 2020  name__)..       
-0001cb50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001cb60: 6c65 6e28 6d29 203d 3d20 323a 0d0a 2020  len(m) == 2:..  
-0001cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb80: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001cb90: 6f72 2822 4d6f 6475 6c65 4469 6374 2075  or("ModuleDict u
-0001cba0: 7064 6174 6520 7365 7175 656e 6365 2065  pdate sequence e
-0001cbb0: 6c65 6d65 6e74 2022 0d0a 2020 2020 2020  lement "..      
-0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001cbe0: 2322 202b 2073 7472 286a 2920 2b20 2220  #" + str(j) + " 
-0001cbf0: 6861 7320 6c65 6e67 7468 2022 202b 2073  has length " + s
-0001cc00: 7472 286c 656e 286d 2929 202b 0d0a 2020  tr(len(m)) +..  
-0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc30: 2020 2022 3b20 3220 6973 2072 6571 7569     "; 2 is requi
-0001cc40: 7265 6422 290d 0a20 2020 2020 2020 2020  red")..         
-0001cc50: 2020 2020 2020 2073 656c 665b 6d5b 305d         self[m[0]
-0001cc60: 5d20 3d20 6d5b 315d 0d0a 0d0a 2020 2020  ] = m[1]....    
-0001cc70: 6465 6620 6275 696c 6428 7365 6c66 2c20  def build(self, 
-0001cc80: 696e 7075 745f 7368 6170 653a 2054 656e  input_shape: Ten
-0001cc90: 736f 7253 6861 7065 293a 0d0a 2020 2020  sorShape):..    
-0001cca0: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
-0001ccb0: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-0001ccc0: 2020 2020 2020 696e 7075 745f 7368 6170        input_shap
-0001ccd0: 6520 2874 6f72 6368 2e53 697a 652c 2074  e (torch.Size, t
-0001cce0: 656e 736f 722c 206c 6973 7428 696e 7429  ensor, list(int)
-0001ccf0: 2c20 7475 706c 6528 696e 7429 293a 2054  , tuple(int)): T
-0001cd00: 6865 2069 6e70 7574 5f73 6861 7065 2069  he input_shape i
-0001cd10: 6e66 6f72 6d61 7469 6f6e 2c20 6e6f 7420  nformation, not 
-0001cd20: 696e 636c 7564 696e 6720 6261 7463 6820  including batch 
-0001cd30: 6178 6973 2e0d 0a0d 0a20 2020 2020 2020  axis.....       
-0001cd40: 2052 6574 7572 6e73 3a0d 0a0d 0a20 2020   Returns:....   
-0001cd50: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0001cd60: 2020 6966 2073 656c 662e 5f62 7569 6c74    if self._built
-0001cd70: 203d 3d20 4661 6c73 6520 616e 6420 6c65   == False and le
-0001cd80: 6e28 7365 6c66 2e5f 6d6f 6475 6c65 7329  n(self._modules)
-0001cd90: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-0001cda0: 2020 2073 656c 662e 5f69 6e70 7574 5f73     self._input_s
-0001cdb0: 6861 7065 203d 2054 656e 736f 7253 6861  hape = TensorSha
-0001cdc0: 7065 2869 6e70 7574 5f73 6861 7065 290d  pe(input_shape).
-0001cdd0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-0001cde0: 7574 5f73 6861 7065 203d 2074 7570 6c65  ut_shape = tuple
-0001cdf0: 2874 6f5f 6e75 6d70 7928 696e 7075 745f  (to_numpy(input_
-0001ce00: 7368 6170 6529 290d 0a20 2020 2020 2020  shape))..       
-0001ce10: 2020 2020 2064 756d 6d61 795f 696e 7075       dummay_inpu
-0001ce20: 7420 3d20 746f 5f74 656e 736f 7228 7365  t = to_tensor(se
-0001ce30: 6c66 2e5f 696e 7075 745f 7368 6170 652e  lf._input_shape.
-0001ce40: 6765 745f 6475 6d6d 795f 7465 6e73 6f72  get_dummy_tensor
-0001ce50: 2829 292e 746f 2873 656c 662e 6465 7669  ()).to(self.devi
-0001ce60: 6365 290d 0a0d 0a20 2020 2020 2020 2020  ce)....         
-0001ce70: 2020 2066 6f72 206e 616d 652c 206d 6f64     for name, mod
-0001ce80: 756c 6520 696e 2073 656c 662e 6974 656d  ule in self.item
-0001ce90: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-0001cea0: 2020 2020 2020 6f75 7420 3d20 6d6f 6475        out = modu
-0001ceb0: 6c65 2864 756d 6d61 795f 696e 7075 7429  le(dummay_input)
-0001cec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ced0: 2020 6d6f 6475 6c65 2e69 6e70 7574 5f73    module.input_s
-0001cee0: 6861 7065 203d 2069 6e70 7574 5f73 6861  hape = input_sha
-0001cef0: 7065 0d0a 2020 2020 2020 2020 2020 2020  pe..            
-0001cf00: 2020 2020 6d6f 6475 6c65 2e6f 7574 7075      module.outpu
-0001cf10: 745f 7368 6170 6520 3d20 7465 6e73 6f72  t_shape = tensor
-0001cf20: 5f74 6f5f 7368 6170 6528 6f75 7429 0d0a  _to_shape(out)..
-0001cf30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001cf40: 2e5f 6275 696c 7420 3d20 5472 7565 0d0a  ._built = True..
-0001cf50: 0d0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-0001cf60: 6428 7365 6c66 2c20 782c 202a 2a6b 7761  d(self, x, **kwa
-0001cf70: 7267 7329 3a0d 0a20 2020 2020 2020 2069  rgs):..        i
-0001cf80: 6620 7365 6c66 2e69 735f 6d75 6c74 6963  f self.is_multic
-0001cf90: 6173 7469 6e67 3a0d 0a0d 0a20 2020 2020  asting:....     
-0001cfa0: 2020 2020 2020 2023 2078 203d 2065 6e66         # x = enf
-0001cfb0: 6f72 6365 5f73 696e 676c 6574 6f6e 2878  orce_singleton(x
-0001cfc0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-0001cfd0: 6573 756c 7473 203d 204f 7264 6572 6564  esults = Ordered
-0001cfe0: 4469 6374 2829 0d0a 2020 2020 2020 2020  Dict()..        
-0001cff0: 2020 2020 666f 7220 6e61 6d65 2c20 6d6f      for name, mo
-0001d000: 6475 6c65 2069 6e20 7365 6c66 2e69 7465  dule in self.ite
-0001d010: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
-0001d020: 2020 2020 2020 206f 7574 203d 206d 6f64         out = mod
-0001d030: 756c 6528 782c 202a 2a6b 7761 7267 7329  ule(x, **kwargs)
-0001d040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d050: 2020 7265 7375 6c74 735b 6e61 6d65 5d20    results[name] 
-0001d060: 3d20 6f75 740d 0a20 2020 2020 2020 2020  = out..         
-0001d070: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0001d080: 730d 0a20 2020 2020 2020 2065 6c73 653a  s..        else:
-0001d090: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-0001d0a0: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
-0001d0b0: 6564 4572 726f 7228 290d 0a0d 0a0d 0a63  edError()......c
-0001d0c0: 6c61 7373 2043 6f6d 6269 6e65 284c 6179  lass Combine(Lay
-0001d0d0: 6572 293a 0d0a 2020 2020 7222 2222 4120  er):..    r"""A 
-0001d0e0: 7365 7175 656e 7469 616c 2063 6f6e 7461  sequential conta
-0001d0f0: 696e 6572 2e0d 0a20 2020 204d 6f64 756c  iner...    Modul
-0001d100: 6573 2077 696c 6c20 6265 2061 6464 6564  es will be added
-0001d110: 2074 6f20 6974 2069 6e20 7468 6520 6f72   to it in the or
-0001d120: 6465 7220 7468 6579 2061 7265 2070 6173  der they are pas
-0001d130: 7365 6420 696e 2074 6865 2063 6f6e 7374  sed in the const
-0001d140: 7275 6374 6f72 2e0d 0a20 2020 2041 6c74  ructor...    Alt
-0001d150: 6572 6e61 7469 7665 6c79 2c20 616e 206f  ernatively, an o
-0001d160: 7264 6572 6564 2064 6963 7420 6f66 206d  rdered dict of m
-0001d170: 6f64 756c 6573 2063 616e 2061 6c73 6f20  odules can also 
-0001d180: 6265 2070 6173 7365 6420 696e 2e0d 0a0d  be passed in....
-0001d190: 0a20 2020 2054 6f20 6d61 6b65 2069 7420  .    To make it 
-0001d1a0: 6561 7369 6572 2074 6f20 756e 6465 7273  easier to unders
-0001d1b0: 7461 6e64 2c20 6865 7265 2069 7320 6120  tand, here is a 
-0001d1c0: 736d 616c 6c20 6578 616d 706c 653a 3a0d  small example::.
-0001d1d0: 0a0d 0a20 2020 2020 2020 2023 2045 7861  ...        # Exa
-0001d1e0: 6d70 6c65 206f 6620 7573 696e 6720 5365  mple of using Se
-0001d1f0: 7175 656e 7469 616c 0d0a 2020 2020 2020  quential..      
-0001d200: 2020 6d6f 6465 6c20 3d20 6e6e 2e53 6571    model = nn.Seq
-0001d210: 7565 6e74 6961 6c28 0d0a 2020 2020 2020  uential(..      
-0001d220: 2020 2020 2020 2020 2020 2020 6e6e 2e43              nn.C
-0001d230: 6f6e 7632 6428 312c 3230 2c35 292c 0d0a  onv2d(1,20,5),..
-0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 6e6e 2e52 654c 5528 292c 0d0a 2020    nn.ReLU(),..  
-0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d270: 6e6e 2e43 6f6e 7632 6428 3230 2c36 342c  nn.Conv2d(20,64,
-0001d280: 3529 2c0d 0a20 2020 2020 2020 2020 2020  5),..           
-0001d290: 2020 2020 2020 206e 6e2e 5265 4c55 2829         nn.ReLU()
-0001d2a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d2b0: 2020 290d 0a0d 0a20 2020 2020 2020 2023    )....        #
-0001d2c0: 2045 7861 6d70 6c65 206f 6620 7573 696e   Example of usin
-0001d2d0: 6720 5365 7175 656e 7469 616c 2077 6974  g Sequential wit
-0001d2e0: 6820 4f72 6465 7265 6444 6963 740d 0a20  h OrderedDict.. 
-0001d2f0: 2020 2020 2020 206d 6f64 656c 203d 206e         model = n
-0001d300: 6e2e 5365 7175 656e 7469 616c 284f 7264  n.Sequential(Ord
-0001d310: 6572 6564 4469 6374 285b 0d0a 2020 2020  eredDict([..    
-0001d320: 2020 2020 2020 2020 2020 2020 2020 2827                ('
-0001d330: 636f 6e76 3127 2c20 6e6e 2e43 6f6e 7632  conv1', nn.Conv2
-0001d340: 6428 312c 3230 2c35 2929 2c0d 0a20 2020  d(1,20,5)),..   
-0001d350: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001d360: 2772 656c 7531 272c 206e 6e2e 5265 4c55  'relu1', nn.ReLU
-0001d370: 2829 292c 0d0a 2020 2020 2020 2020 2020  ()),..          
-0001d380: 2020 2020 2020 2020 2827 636f 6e76 3227          ('conv2'
-0001d390: 2c20 6e6e 2e43 6f6e 7632 6428 3230 2c36  , nn.Conv2d(20,6
-0001d3a0: 342c 3529 292c 0d0a 2020 2020 2020 2020  4,5)),..        
-0001d3b0: 2020 2020 2020 2020 2020 2827 7265 6c75            ('relu
-0001d3c0: 3227 2c20 6e6e 2e52 654c 5528 2929 0d0a  2', nn.ReLU())..
-0001d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3e0: 5d29 290d 0a20 2020 2022 2222 0d0a 0d0a  ]))..    """....
-0001d3f0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0001d400: 2873 656c 662c 202a 6172 6773 2c20 6e61  (self, *args, na
-0001d410: 6d65 3d4e 6f6e 6529 3a0d 0a20 2020 2020  me=None):..     
-0001d420: 2020 2073 7570 6572 2843 6f6d 6269 6e65     super(Combine
-0001d430: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-0001d440: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0001d450: 2e5f 6e61 6d65 203d 206e 616d 650d 0a20  ._name = name.. 
-0001d460: 2020 2020 2020 2073 656c 662e 5f62 7569         self._bui
-0001d470: 6c74 203d 2046 616c 7365 0d0a 0d0a 2020  lt = False....  
-0001d480: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
-0001d490: 7329 203d 3d20 3120 616e 6420 6973 696e  s) == 1 and isin
-0001d4a0: 7374 616e 6365 2861 7267 735b 305d 2c20  stance(args[0], 
-0001d4b0: 4f72 6465 7265 6444 6963 7429 3a0d 0a20  OrderedDict):.. 
-0001d4c0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-0001d4d0: 6579 2c20 6d6f 6475 6c65 2069 6e20 6172  ey, module in ar
-0001d4e0: 6773 5b30 5d2e 6974 656d 7328 293a 0d0a  gs[0].items():..
-0001d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d500: 7365 6c66 2e61 6464 5f6d 6f64 756c 6528  self.add_module(
-0001d510: 6b65 792c 206d 6f64 756c 6529 0d0a 2020  key, module)..  
-0001d520: 2020 2020 2020 656c 6966 206c 656e 2861        elif len(a
-0001d530: 7267 7329 203d 3d20 3120 616e 6420 6973  rgs) == 1 and is
-0001d540: 696e 7374 616e 6365 2861 7267 735b 305d  instance(args[0]
-0001d550: 2c20 286c 6973 7429 293a 0d0a 2020 2020  , (list)):..    
-0001d560: 2020 2020 2020 2020 666f 7220 6964 782c          for idx,
-0001d570: 206d 6f64 756c 6520 696e 2065 6e75 6d65   module in enume
-0001d580: 7261 7465 2861 7267 735b 305d 293a 0d0a  rate(args[0]):..
-0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5a0: 7365 6c66 2e61 6464 5f6d 6f64 756c 6528  self.add_module(
-0001d5b0: 7374 7228 6964 7829 2c20 6d6f 6475 6c65  str(idx), module
-0001d5c0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0001d5d0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0001d5e0: 7220 6964 782c 206d 6f64 756c 6520 696e  r idx, module in
-0001d5f0: 2065 6e75 6d65 7261 7465 2861 7267 7329   enumerate(args)
-0001d600: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001d610: 2020 2073 656c 662e 6164 645f 6d6f 6475     self.add_modu
-0001d620: 6c65 2873 7472 2869 6478 292c 206d 6f64  le(str(idx), mod
-0001d630: 756c 6529 0d0a 2020 2020 2020 2020 7365  ule)..        se
-0001d640: 6c66 2e74 6f28 7365 6c66 2e64 6576 6963  lf.to(self.devic
-0001d650: 6529 0d0a 0d0a 2020 2020 6465 6620 5f67  e)....    def _g
-0001d660: 6574 5f69 7465 6d5f 6279 5f69 6478 2873  et_item_by_idx(s
-0001d670: 656c 662c 2069 7465 7261 746f 722c 2069  elf, iterator, i
-0001d680: 6478 293a 0d0a 2020 2020 2020 2020 2222  dx):..        ""
-0001d690: 2247 6574 2074 6865 2069 6478 2d74 6820  "Get the idx-th 
-0001d6a0: 6974 656d 206f 6620 7468 6520 6974 6572  item of the iter
-0001d6b0: 6174 6f72 2222 220d 0a20 2020 2020 2020  ator"""..       
-0001d6c0: 2073 697a 6520 3d20 6c65 6e28 7365 6c66   size = len(self
-0001d6d0: 290d 0a20 2020 2020 2020 2069 6478 203d  )..        idx =
-0001d6e0: 2069 6478 2e5f 5f69 6e64 6578 5f5f 2829   idx.__index__()
-0001d6f0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0001d700: 202d 7369 7a65 203c 3d20 6964 7820 3c20   -size <= idx < 
-0001d710: 7369 7a65 3a0d 0a20 2020 2020 2020 2020  size:..         
-0001d720: 2020 2072 6169 7365 2049 6e64 6578 4572     raise IndexEr
-0001d730: 726f 7228 2769 6e64 6578 207b 7d20 6973  ror('index {} is
-0001d740: 206f 7574 206f 6620 7261 6e67 6527 2e66   out of range'.f
-0001d750: 6f72 6d61 7428 6964 7829 290d 0a20 2020  ormat(idx))..   
-0001d760: 2020 2020 2069 6478 2025 3d20 7369 7a65       idx %= size
-0001d770: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001d780: 206e 6578 7428 6973 6c69 6365 2869 7465   next(islice(ite
-0001d790: 7261 746f 722c 2069 6478 2c20 4e6f 6e65  rator, idx, None
-0001d7a0: 2929 0d0a 0d0a 2020 2020 6465 6620 5f5f  ))....    def __
-0001d7b0: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
-0001d7c0: 6964 7829 3a0d 0a20 2020 2020 2020 2069  idx):..        i
-0001d7d0: 6620 6973 696e 7374 616e 6365 2869 6478  f isinstance(idx
-0001d7e0: 2c20 736c 6963 6529 3a0d 0a20 2020 2020  , slice):..     
-0001d7f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001d800: 6c66 2e5f 5f63 6c61 7373 5f5f 284f 7264  lf.__class__(Ord
-0001d810: 6572 6564 4469 6374 286c 6973 7428 7365  eredDict(list(se
-0001d820: 6c66 2e5f 6d6f 6475 6c65 732e 6974 656d  lf._modules.item
-0001d830: 7328 2929 5b69 6478 5d29 290d 0a20 2020  s())[idx]))..   
-0001d840: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0001d850: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001d860: 656c 662e 5f67 6574 5f69 7465 6d5f 6279  elf._get_item_by
-0001d870: 5f69 6478 2873 656c 662e 5f6d 6f64 756c  _idx(self._modul
-0001d880: 6573 2e76 616c 7565 7328 292c 2069 6478  es.values(), idx
-0001d890: 290d 0a0d 0a20 2020 2064 6566 205f 5f73  )....    def __s
-0001d8a0: 6574 6974 656d 5f5f 2873 656c 662c 2069  etitem__(self, i
-0001d8b0: 6478 2c20 6d6f 6475 6c65 293a 0d0a 2020  dx, module):..  
-0001d8c0: 2020 2020 2020 6b65 7920 3d20 7365 6c66        key = self
-0001d8d0: 2e5f 6765 745f 6974 656d 5f62 795f 6964  ._get_item_by_id
-0001d8e0: 7828 7365 6c66 2e5f 6d6f 6475 6c65 732e  x(self._modules.
-0001d8f0: 6b65 7973 2829 2c20 6964 7829 0d0a 2020  keys(), idx)..  
-0001d900: 2020 2020 2020 7265 7475 726e 2073 6574        return set
-0001d910: 6174 7472 2873 656c 662c 206b 6579 2c20  attr(self, key, 
-0001d920: 6d6f 6475 6c65 290d 0a0d 0a20 2020 2064  module)....    d
-0001d930: 6566 205f 5f64 656c 6974 656d 5f5f 2873  ef __delitem__(s
-0001d940: 656c 662c 2069 6478 293a 0d0a 2020 2020  elf, idx):..    
-0001d950: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001d960: 6528 6964 782c 2073 6c69 6365 293a 0d0a  e(idx, slice):..
-0001d970: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001d980: 6b65 7920 696e 206c 6973 7428 7365 6c66  key in list(self
-0001d990: 2e5f 6d6f 6475 6c65 732e 6b65 7973 2829  ._modules.keys()
-0001d9a0: 295b 6964 785d 3a0d 0a20 2020 2020 2020  )[idx]:..       
-0001d9b0: 2020 2020 2020 2020 2064 656c 6174 7472           delattr
-0001d9c0: 2873 656c 662c 206b 6579 290d 0a20 2020  (self, key)..   
-0001d9d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0001d9e0: 2020 2020 2020 2020 6b65 7920 3d20 7365          key = se
-0001d9f0: 6c66 2e5f 6765 745f 6974 656d 5f62 795f  lf._get_item_by_
-0001da00: 6964 7828 7365 6c66 2e5f 6d6f 6475 6c65  idx(self._module
-0001da10: 732e 6b65 7973 2829 2c20 6964 7829 0d0a  s.keys(), idx)..
-0001da20: 2020 2020 2020 2020 2020 2020 6465 6c61              dela
-0001da30: 7474 7228 7365 6c66 2c20 6b65 7929 0d0a  ttr(self, key)..
-0001da40: 0d0a 2020 2020 6465 6620 5f5f 6c65 6e5f  ..    def __len_
-0001da50: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
-0001da60: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
-0001da70: 662e 5f6d 6f64 756c 6573 290d 0a0d 0a20  f._modules).... 
-0001da80: 2020 2064 6566 205f 5f64 6972 5f5f 2873     def __dir__(s
-0001da90: 656c 6629 3a0d 0a20 2020 2020 2020 206b  elf):..        k
-0001daa0: 6579 7320 3d20 7375 7065 7228 436f 6d62  eys = super(Comb
-0001dab0: 696e 652c 2073 656c 6629 2e5f 5f64 6972  ine, self).__dir
-0001dac0: 5f5f 2829 0d0a 2020 2020 2020 2020 6b65  __()..        ke
-0001dad0: 7973 203d 205b 6b65 7920 666f 7220 6b65  ys = [key for ke
-0001dae0: 7920 696e 206b 6579 7320 6966 206e 6f74  y in keys if not
-0001daf0: 206b 6579 2e69 7364 6967 6974 2829 5d0d   key.isdigit()].
-0001db00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001db10: 6b65 7973 0d0a 0d0a 2020 2020 6465 6620  keys....    def 
-0001db20: 666f 7277 6172 6428 7365 6c66 2c20 2a78  forward(self, *x
-0001db30: 293a 0d0a 2020 2020 2020 2020 6f75 7470  ):..        outp
-0001db40: 7574 7320 3d20 5b5d 0d0a 2020 2020 2020  uts = []..      
-0001db50: 2020 666f 7220 6d6f 6475 6c65 2069 6e20    for module in 
-0001db60: 7365 6c66 2e5f 6d6f 6475 6c65 732e 7661  self._modules.va
-0001db70: 6c75 6573 2829 3a0d 0a20 2020 2020 2020  lues():..       
-0001db80: 2020 2020 206f 7574 7075 7473 2e61 7070       outputs.app
-0001db90: 656e 6428 6d6f 6475 6c65 282a 7829 290d  end(module(*x)).
-0001dba0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001dbb0: 7475 706c 6528 6f75 7470 7574 7329 0d0a  tuple(outputs)..
-0001dbc0: 0d0a 0d0a 6465 6620 636f 756e 745f 7061  ....def count_pa
-0001dbd0: 7261 6d73 2877 6569 6768 7473 293a 0d0a  rams(weights):..
-0001dbe0: 2020 2020 2222 2243 6f75 6e74 2074 6865      """Count the
-0001dbf0: 2074 6f74 616c 206e 756d 6265 7220 6f66   total number of
-0001dc00: 2073 6361 6c61 7273 2063 6f6d 706f 7369   scalars composi
-0001dc10: 6e67 2074 6865 2077 6569 6768 7473 2e0d  ng the weights..
-0001dc20: 0a0d 0a20 2020 2041 7267 733a 0d0a 2020  ...    Args:..  
-0001dc30: 2020 2020 2020 7765 6967 6874 733a 2041        weights: A
-0001dc40: 6e20 6974 6572 6162 6c65 2063 6f6e 7461  n iterable conta
-0001dc50: 696e 696e 6720 7468 6520 7765 6967 6874  ining the weight
-0001dc60: 7320 6f6e 2077 6869 6368 2074 6f20 636f  s on which to co
-0001dc70: 6d70 7574 6520 7061 7261 6d73 0d0a 0d0a  mpute params....
-0001dc80: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-0001dc90: 2020 2020 2020 5468 6520 746f 7461 6c20        The total 
-0001dca0: 6e75 6d62 6572 206f 6620 7363 616c 6172  number of scalar
-0001dcb0: 7320 636f 6d70 6f73 696e 6720 7468 6520  s composing the 
-0001dcc0: 7765 6967 6874 730d 0a20 2020 2022 2222  weights..    """
-0001dcd0: 0d0a 2020 2020 7265 7475 726e 2069 6e74  ..    return int
-0001dce0: 2873 756d 286e 702e 7072 6f64 2870 2e73  (sum(np.prod(p.s
-0001dcf0: 6861 7065 2e61 735f 6c69 7374 2829 2920  hape.as_list()) 
-0001dd00: 666f 7220 7020 696e 206f 626a 6563 745f  for p in object_
-0001dd10: 6964 656e 7469 7479 2e4f 626a 6563 7449  identity.ObjectI
-0001dd20: 6465 6e74 6974 7953 6574 2877 6569 6768  dentitySet(weigh
-0001dd30: 7473 2929 290d 0a0d 0a0d 0a64 6566 2063  ts)))......def c
-0001dd40: 616c 6375 6c61 7465 5f66 6c6f 7073 2867  alculate_flops(g
-0001dd50: 656e 3a20 4c61 7965 7229 3a0d 0a20 2020  en: Layer):..   
-0001dd60: 2022 2222 0d0a 2020 2020 4361 6c63 756c   """..    Calcul
-0001dd70: 6174 6520 7468 6520 666c 6f70 7320 6769  ate the flops gi
-0001dd80: 7665 6e20 6120 6765 6e65 7261 746f 7220  ven a generator 
-0001dd90: 6f66 2070 7974 6f72 6368 206d 6f64 656c  of pytorch model
-0001dda0: 2e0d 0a20 2020 2049 7420 6f6e 6c79 2063  ...    It only c
-0001ddb0: 6f6d 7075 7465 2074 6865 2066 6c6f 7073  ompute the flops
-0001ddc0: 206f 6620 666f 7277 6172 6420 7061 7373   of forward pass
-0001ddd0: 2e0d 0a0d 0a0d 0a20 2020 2022 2222 0d0a  .......    """..
-0001dde0: 2020 2020 666c 6f70 7320 3d20 300d 0a20      flops = 0.. 
-0001ddf0: 2020 206d 6f64 7320 3d20 6765 6e2e 6e61     mods = gen.na
-0001de00: 6d65 645f 6d6f 6475 6c65 7328 290d 0a20  med_modules().. 
-0001de10: 2020 206d 6f64 7320 3d20 6c69 7374 286d     mods = list(m
-0001de20: 6f64 7329 5b31 3a5d 0d0a 2020 2020 7061  ods)[1:]..    pa
-0001de30: 7261 6d5f 6e75 6d73 203d 205b 5d0d 0a20  ram_nums = [].. 
-0001de40: 2020 2070 6172 616d 5f73 697a 6573 203d     param_sizes =
-0001de50: 205b 5d0d 0a20 2020 2066 6f72 206d 6f64   []..    for mod
-0001de60: 5f6e 616d 652c 206d 6f64 2069 6e20 6d6f  _name, mod in mo
-0001de70: 6473 3a0d 0a20 2020 2020 2020 2070 203d  ds:..        p =
-0001de80: 206c 6973 7428 6d6f 642e 7061 7261 6d65   list(mod.parame
-0001de90: 7465 7273 2829 290d 0a20 2020 2020 2020  ters())..       
-0001dea0: 206d 6f64 737a 203d 205b 5d0d 0a20 2020   modsz = []..   
-0001deb0: 2020 2020 2061 6c6c 5f70 6172 616d 7320       all_params 
-0001dec0: 3d20 300d 0a20 2020 2020 2020 2066 6f72  = 0..        for
-0001ded0: 206a 2069 6e20 7261 6e67 6528 6c65 6e28   j in range(len(
-0001dee0: 7029 293a 0d0a 2020 2020 2020 2020 2020  p)):..          
-0001def0: 2020 6d6f 6473 7a2e 6170 7065 6e64 286e    modsz.append(n
-0001df00: 702e 6172 7261 7928 705b 6a5d 2e73 697a  p.array(p[j].siz
-0001df10: 6528 2929 290d 0a20 2020 2020 2020 2020  e()))..         
-0001df20: 2020 2061 6c6c 5f70 6172 616d 7320 2b3d     all_params +=
-0001df30: 206e 702e 7072 6f64 2870 5b6a 5d2e 7369   np.prod(p[j].si
-0001df40: 7a65 2829 290d 0a0d 0a20 2020 2020 2020  ze())....       
-0001df50: 2070 6172 616d 5f6e 756d 732e 6170 7065   param_nums.appe
-0001df60: 6e64 2861 6c6c 5f70 6172 616d 7329 0d0a  nd(all_params)..
-0001df70: 2020 2020 2020 2020 7061 7261 6d5f 7369          param_si
-0001df80: 7a65 732e 6170 7065 6e64 286d 6f64 737a  zes.append(modsz
-0001df90: 290d 0a0d 0a20 2020 2072 6574 7572 6e20  )....    return 
-0001dfa0: 6e70 2e61 7272 6179 2870 6172 616d 5f6e  np.array(param_n
-0001dfb0: 756d 7329 2e73 756d 2829 0d0a 0d0a 0d0a  ums).sum()......
-0001dfc0: 6465 6620 7375 6d6d 6172 7928 6d6f 6465  def summary(mode
-0001dfd0: 6c2c 2069 6e70 7574 5f73 7065 6373 2c20  l, input_specs, 
-0001dfe0: 6261 7463 685f 7369 7a65 3d31 2c20 696e  batch_size=1, in
-0001dff0: 7075 7473 3d4e 6f6e 652c 2064 6576 6963  puts=None, devic
-0001e000: 653d 2263 7564 6122 293a 0d0a 2020 2020  e="cuda"):..    
-0001e010: 6465 6620 7265 6769 7374 6572 5f68 6f6f  def register_hoo
-0001e020: 6b28 6d6f 6475 6c65 293a 0d0a 2020 2020  k(module):..    
-0001e030: 2020 2020 6465 6620 686f 6f6b 286d 6f64      def hook(mod
-0001e040: 756c 652c 2069 6e70 7574 2c20 6f75 7470  ule, input, outp
-0001e050: 7574 293a 0d0a 2020 2020 2020 2020 2020  ut):..          
-0001e060: 2020 2320 636c 6173 735f 6e61 6d65 203d    # class_name =
-0001e070: 6d6f 6475 6c65 2e72 6520 2020 206d 6f64  module.re    mod
-0001e080: 756c 652e 6e61 6d65 2020 2023 2073 7472  ule.name   # str
-0001e090: 286d 6f64 756c 652e 5f5f 636c 6173 735f  (module.__class_
-0001e0a0: 5f29 2e73 706c 6974 2822 2e22 295b 2d31  _).split(".")[-1
-0001e0b0: 5d2e 7370 6c69 7428 2227 2229 5b30 5d0d  ].split("'")[0].
-0001e0c0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-0001e0d0: 756c 655f 6964 7820 3d20 6c65 6e28 7375  ule_idx = len(su
-0001e0e0: 6d6d 6172 7929 0d0a 0d0a 2020 2020 2020  mmary)....      
-0001e0f0: 2020 2020 2020 6d5f 6b65 7920 3d20 6d6f        m_key = mo
-0001e100: 6475 6c65 2e72 656c 6174 6976 655f 6e61  dule.relative_na
-0001e110: 6d65 2069 6620 6861 7361 7474 7228 6d6f  me if hasattr(mo
-0001e120: 6475 6c65 2c20 2772 656c 6174 6976 655f  dule, 'relative_
-0001e130: 6e61 6d65 2729 2065 6c73 6520 6d6f 6475  name') else modu
-0001e140: 6c65 2e6e 616d 650d 0a20 2020 2020 2020  le.name..       
-0001e150: 2020 2020 2073 756d 6d61 7279 5b6d 5f6b       summary[m_k
-0001e160: 6579 5d20 3d20 4f72 6465 7265 6444 6963  ey] = OrderedDic
-0001e170: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-0001e180: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
-0001e190: 2263 6c61 7373 5f6e 616d 6522 5d20 3d20  "class_name"] = 
-0001e1a0: 6d6f 6475 6c65 2e5f 5f63 6c61 7373 5f5f  module.__class__
-0001e1b0: 2e5f 5f6e 616d 655f 5f0d 0a20 2020 2020  .__name__..     
-0001e1c0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0001e1d0: 7228 6d6f 6475 6c65 2c20 276b 6565 705f  r(module, 'keep_
-0001e1e0: 6f75 7470 7574 2729 3a0d 0a20 2020 2020  output'):..     
-0001e1f0: 2020 2020 2020 2020 2020 2073 756d 6d61             summa
-0001e200: 7279 5b6d 5f6b 6579 5d5b 226b 6565 705f  ry[m_key]["keep_
-0001e210: 6f75 7470 7574 225d 203d 206d 6f64 756c  output"] = modul
-0001e220: 652e 6b65 6570 5f6f 7574 7075 740d 0a20  e.keep_output.. 
-0001e230: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001e240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e250: 2020 7375 6d6d 6172 795b 6d5f 6b65 795d    summary[m_key]
-0001e260: 5b22 6b65 6570 5f6f 7574 7075 7422 5d20  ["keep_output"] 
-0001e270: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0001e280: 2020 2020 2069 6e70 7574 203d 2069 7465       input = ite
-0001e290: 7261 7469 6f6e 5f74 6f6f 6c73 2e66 6c61  ration_tools.fla
-0001e2a0: 7474 656e 285b 696e 7075 745d 2c20 6974  tten([input], it
-0001e2b0: 6572 6162 6c65 5f74 7970 6573 3d28 6c69  erable_types=(li
-0001e2c0: 7374 2c20 7475 706c 6529 290d 0a20 2020  st, tuple))..   
-0001e2d0: 2020 2020 2020 2020 2069 6e70 7574 203d           input =
-0001e2e0: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
-0001e2f0: 6e28 5b69 7465 6d20 666f 7220 6974 656d  n([item for item
-0001e300: 2069 6e20 696e 7075 7420 6966 2069 7465   in input if ite
-0001e310: 6d20 6973 206e 6f74 204e 6f6e 655d 290d  m is not None]).
-0001e320: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001e330: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
-0001e340: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-0001e350: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001e360: 2020 2073 756d 6d61 7279 5b6d 5f6b 6579     summary[m_key
-0001e370: 5d5b 2269 6e70 7574 5f73 6861 7065 225d  ]["input_shape"]
-0001e380: 203d 206c 6973 7428 696e 745f 7368 6170   = list(int_shap
-0001e390: 6528 696e 7075 745b 305d 2929 0d0a 2020  e(input[0]))..  
-0001e3a0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-0001e3b0: 735f 7465 6e73 6f72 2869 6e70 7574 293a  s_tensor(input):
-0001e3c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e3d0: 2020 7375 6d6d 6172 795b 6d5f 6b65 795d    summary[m_key]
-0001e3e0: 5b22 696e 7075 745f 7368 6170 6522 5d20  ["input_shape"] 
-0001e3f0: 3d20 6c69 7374 2869 6e74 5f73 6861 7065  = list(int_shape
-0001e400: 2869 6e70 7574 2929 0d0a 2020 2020 2020  (input))..      
-0001e410: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001e420: 6b65 795d 5b22 696e 7075 745f 7368 6170  key]["input_shap
-0001e430: 6522 5d5b 305d 203d 2062 6174 6368 5f73  e"][0] = batch_s
-0001e440: 697a 650d 0a0d 0a20 2020 2020 2020 2020  ize....         
-0001e450: 2020 206f 7574 7075 7420 3d20 6974 6572     output = iter
-0001e460: 6174 696f 6e5f 746f 6f6c 732e 666c 6174  ation_tools.flat
-0001e470: 7465 6e28 5b6f 7574 7075 745d 2c20 6974  ten([output], it
-0001e480: 6572 6162 6c65 5f74 7970 6573 3d28 6c69  erable_types=(li
-0001e490: 7374 2c20 7475 706c 6529 290d 0a20 2020  st, tuple))..   
-0001e4a0: 2020 2020 2020 2020 206f 7574 7075 7420           output 
-0001e4b0: 3d20 756e 7061 636b 5f73 696e 676c 6574  = unpack_singlet
-0001e4c0: 6f6e 285b 6974 656d 2066 6f72 2069 7465  on([item for ite
-0001e4d0: 6d20 696e 206f 7574 7075 7420 6966 2069  m in output if i
-0001e4e0: 7465 6d20 6973 206e 6f74 204e 6f6e 655d  tem is not None]
-0001e4f0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0001e500: 6620 6973 696e 7374 616e 6365 286f 7574  f isinstance(out
-0001e510: 7075 742c 2028 6c69 7374 2c20 7475 706c  put, (list, tupl
-0001e520: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-0001e530: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001e540: 6b65 795d 5b22 6f75 7470 7574 5f73 6861  key]["output_sha
-0001e550: 7065 225d 203d 206c 6973 7428 696e 745f  pe"] = list(int_
-0001e560: 7368 6170 6528 6f75 7470 7574 5b30 5d29  shape(output[0])
-0001e570: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0001e580: 6c69 6620 6973 5f74 656e 736f 7228 6f75  lif is_tensor(ou
-0001e590: 7470 7574 293a 0d0a 2020 2020 2020 2020  tput):..        
-0001e5a0: 2020 2020 2020 2020 7375 6d6d 6172 795b          summary[
-0001e5b0: 6d5f 6b65 795d 5b22 6f75 7470 7574 5f73  m_key]["output_s
-0001e5c0: 6861 7065 225d 203d 206c 6973 7428 696e  hape"] = list(in
-0001e5d0: 745f 7368 6170 6528 6f75 7470 7574 2929  t_shape(output))
-0001e5e0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
-0001e5f0: 6d6d 6172 795b 6d5f 6b65 795d 5b22 6f75  mmary[m_key]["ou
-0001e600: 7470 7574 5f73 6861 7065 225d 5b30 5d20  tput_shape"][0] 
-0001e610: 3d20 6261 7463 685f 7369 7a65 0d0a 0d0a  = batch_size....
-0001e620: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0001e630: 6d73 203d 2030 0d0a 2020 2020 2020 2020  ms = 0..        
-0001e640: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
-0001e650: 795d 5b22 666c 6f70 7322 5d20 3d20 6e70  y]["flops"] = np
-0001e660: 2e61 7272 6179 285b 305d 2c20 6474 7970  .array([0], dtyp
-0001e670: 653d 6e70 2e66 6c6f 6174 3634 290d 0a20  e=np.float64).. 
-0001e680: 2020 2020 2020 2020 2020 2073 756d 6d61             summa
-0001e690: 7279 5b6d 5f6b 6579 5d5b 226d 6163 6322  ry[m_key]["macc"
-0001e6a0: 5d20 3d20 6e70 2e61 7272 6179 285b 305d  ] = np.array([0]
-0001e6b0: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-0001e6c0: 3634 290d 0a20 2020 2020 2020 2020 2020  64)..           
-0001e6d0: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
-0001e6e0: 2274 7261 696e 6162 6c65 225d 203d 206e  "trainable"] = n
-0001e6f0: 702e 6172 7261 7928 5b30 5d2c 2064 7479  p.array([0], dty
-0001e700: 7065 3d6e 702e 666c 6f61 7436 3429 0d0a  pe=np.float64)..
-0001e710: 2020 2020 2020 2020 2020 2020 7375 6d6d              summ
-0001e720: 6172 795b 6d5f 6b65 795d 5b22 7765 6967  ary[m_key]["weig
-0001e730: 6874 225d 203d 204f 7264 6572 6564 4469  ht"] = OrderedDi
-0001e740: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
-0001e750: 2020 7375 6d6d 6172 795b 6d5f 6b65 795d    summary[m_key]
-0001e760: 5b22 6269 6173 225d 203d 204f 7264 6572  ["bias"] = Order
-0001e770: 6564 4469 6374 2829 0d0a 2020 2020 2020  edDict()..      
-0001e780: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
-0001e790: 7061 7261 2069 6e20 6d6f 6475 6c65 2e5f  para in module._
-0001e7a0: 7061 7261 6d65 7465 7273 2e69 7465 6d73  parameters.items
-0001e7b0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0001e7c0: 2020 2020 2069 6620 7061 7261 2069 7320       if para is 
-0001e7d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0001e7e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001e7f0: 6172 615f 7479 7065 203d 2022 7765 6967  ara_type = "weig
-0001e800: 6874 220d 0a20 2020 2020 2020 2020 2020  ht"..           
-0001e810: 2020 2020 2020 2020 2069 6620 2762 6961           if 'bia
-0001e820: 7327 2069 6e20 6e61 6d65 206f 7220 2762  s' in name or 'b
-0001e830: 6574 6127 2069 6e20 6e61 6d65 3a0d 0a20  eta' in name:.. 
+00016b50: 2020 2020 2020 2027 7072 6f76 6964 6564         'provided
+00016b60: 2077 6569 6768 7420 7368 6170 6520 2720   weight shape ' 
+00016b70: 2b20 7374 7228 772e 7368 6170 6529 290d  + str(w.shape)).
+00016b80: 0a20 2020 2020 2020 2020 2020 2077 6569  .            wei
+00016b90: 6768 745f 7661 6c75 655f 7475 706c 6573  ght_value_tuples
+00016ba0: 2e61 7070 656e 6428 2870 2c20 7729 290d  .append((p, w)).
+00016bb0: 0a20 2020 2020 2020 2066 6f72 2070 2c20  .        for p, 
+00016bc0: 7720 696e 2077 6569 6768 745f 7661 6c75  w in weight_valu
+00016bd0: 655f 7475 706c 6573 3a0d 0a20 2020 2020  e_tuples:..     
+00016be0: 2020 2020 2020 2070 2e61 7373 6967 6e28         p.assign(
+00016bf0: 772e 7661 6c75 6528 2929 0d0a 0d0a 2020  w.value())....  
+00016c00: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00016c10: 2064 6566 2074 7261 696e 6162 6c65 2873   def trainable(s
+00016c20: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+00016c30: 2222 0d0a 0d0a 2020 2020 2020 2020 5265  ""....        Re
+00016c40: 7475 726e 733a 2049 7320 7468 6520 6c61  turns: Is the la
+00016c50: 7965 7220 7472 6169 6e61 626c 653f 0d0a  yer trainable?..
+00016c60: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00016c70: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+00016c80: 6c66 2e77 6569 6768 7473 2920 3d3d 2030  lf.weights) == 0
+00016c90: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00016ca0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00016cb0: 2020 2020 2065 6c69 6620 6c65 6e28 7365       elif len(se
+00016cc0: 6c66 2e77 6569 6768 7473 2920 3e20 303a  lf.weights) > 0:
+00016cd0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00016ce0: 7220 6b2c 2076 2069 6e20 7365 6c66 2e5f  r k, v in self._
+00016cf0: 7061 7261 6d65 7465 7273 2e69 7465 6d73  parameters.items
+00016d00: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00016d10: 2020 2020 2069 6620 7620 6973 206e 6f74       if v is not
+00016d20: 204e 6f6e 6520 616e 6420 762e 7472 6169   None and v.trai
+00016d30: 6e61 626c 6520 3d3d 2046 616c 7365 3a0d  nable == False:.
+00016d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016d50: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00016d60: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+00016d70: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00016d80: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00016d90: 650d 0a0d 0a20 2020 2040 7472 6169 6e61  e....    @traina
+00016da0: 626c 652e 7365 7474 6572 0d0a 2020 2020  ble.setter..    
+00016db0: 6465 6620 7472 6169 6e61 626c 6528 7365  def trainable(se
+00016dc0: 6c66 2c20 7661 6c75 653a 2062 6f6f 6c29  lf, value: bool)
+00016dd0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00016de0: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
+00016df0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00016e00: 7565 2028 626f 6f6c 293a 2020 6e65 7720  ue (bool):  new 
+00016e10: 7661 6c75 6520 666f 7220 7468 6520 7072  value for the pr
+00016e20: 6f70 6572 7479 2022 5472 7361 696e 6162  operty "Trsainab
+00016e30: 6c65 220d 0a0d 0a20 2020 2020 2020 2022  le"....        "
+00016e40: 2222 0d0a 2020 2020 2020 2020 6e20 3d20  ""..        n = 
+00016e50: 300d 0a20 2020 2020 2020 206e 6565 645f  0..        need_
+00016e60: 7570 6461 7465 203d 2046 616c 7365 0d0a  update = False..
+00016e70: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+00016e80: 2c20 7061 7261 2069 6e20 7365 6c66 2e6e  , para in self.n
+00016e90: 616d 6564 5f70 6172 616d 6574 6572 7328  amed_parameters(
+00016ea0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00016eb0: 6966 2070 6172 6120 6973 206e 6f74 204e  if para is not N
+00016ec0: 6f6e 6520 616e 6420 7061 7261 2e74 7261  one and para.tra
+00016ed0: 696e 6162 6c65 2021 3d20 7661 6c75 653a  inable != value:
+00016ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016ef0: 2020 7061 7261 2e5f 7472 6169 6e61 626c    para._trainabl
+00016f00: 6520 3d20 7661 6c75 650d 0a20 2020 2020  e = value..     
+00016f10: 2020 2020 2020 2020 2020 206e 202b 3d20             n += 
+00016f20: 6e70 2e70 726f 6428 746f 5f6e 756d 7079  np.prod(to_numpy
+00016f30: 2869 6e74 5f73 6861 7065 2870 6172 6129  (int_shape(para)
+00016f40: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00016f50: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
+00016f60: 2020 2069 6620 7661 6c75 653a 0d0a 2020     if value:..  
+00016f70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00016f80: 696e 7428 277b 307d 2070 6172 616d 6574  int('{0} paramet
+00016f90: 6572 7320 6861 7665 2073 6574 2074 7261  ers have set tra
+00016fa0: 696e 6162 6c65 272e 666f 726d 6174 286e  inable'.format(n
+00016fb0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00016fc0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00016fd0: 2020 2020 2020 2070 7269 6e74 2827 7b30         print('{0
+00016fe0: 7d20 7061 7261 6d65 7465 7273 2068 6176  } parameters hav
+00016ff0: 6520 7365 7420 756e 7472 6169 6e61 626c  e set untrainabl
+00017000: 6527 2e66 6f72 6d61 7428 6e29 290d 0a0d  e'.format(n))...
+00017010: 0a20 2020 2064 6566 205f 6765 745f 6e61  .    def _get_na
+00017020: 6d65 2873 656c 6629 3a0d 0a20 2020 2020  me(self):..     
+00017030: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00017040: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00017050: 5f0d 0a20 2020 2064 6566 2065 7874 7261  _..    def extra
+00017060: 5f72 6570 7228 7365 6c66 2920 2d3e 2073  _repr(self) -> s
+00017070: 7472 3a0d 0a20 2020 2020 2020 2072 2222  tr:..        r""
+00017080: 2253 6574 2074 6865 2065 7874 7261 2072  "Set the extra r
+00017090: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
+000170a0: 2074 6865 206d 6f64 756c 650d 0a0d 0a20   the module.... 
+000170b0: 2020 2020 2020 2054 6f20 7072 696e 7420         To print 
+000170c0: 6375 7374 6f6d 697a 6564 2065 7874 7261  customized extra
+000170d0: 2069 6e66 6f72 6d61 7469 6f6e 2c20 796f   information, yo
+000170e0: 7520 7368 6f75 6c64 2072 652d 696d 706c  u should re-impl
+000170f0: 656d 656e 740d 0a20 2020 2020 2020 2074  ement..        t
+00017100: 6869 7320 6d65 7468 6f64 2069 6e20 796f  his method in yo
+00017110: 7572 206f 776e 206d 6f64 756c 6573 2e20  ur own modules. 
+00017120: 426f 7468 2073 696e 676c 652d 6c69 6e65  Both single-line
+00017130: 2061 6e64 206d 756c 7469 2d6c 696e 650d   and multi-line.
+00017140: 0a20 2020 2020 2020 2073 7472 696e 6773  .        strings
+00017150: 2061 7265 2061 6363 6570 7461 626c 652e   are acceptable.
+00017160: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00017170: 2020 2020 2020 2072 6574 7572 6e20 2727         return ''
+00017180: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7265  ....    def __re
+00017190: 7072 5f5f 2873 656c 6629 3a0d 0a20 2020  pr__(self):..   
+000171a0: 2020 2020 2023 2057 6520 7472 6561 7420       # We treat 
+000171b0: 7468 6520 6578 7472 6120 7265 7072 206c  the extra repr l
+000171c0: 696b 6520 7468 6520 7375 622d 6d6f 6475  ike the sub-modu
+000171d0: 6c65 2c20 6f6e 6520 6974 656d 2070 6572  le, one item per
+000171e0: 206c 696e 650d 0a20 2020 2020 2020 2065   line..        e
+000171f0: 7874 7261 5f6c 696e 6573 203d 205b 5d0d  xtra_lines = [].
+00017200: 0a20 2020 2020 2020 2065 7874 7261 5f72  .        extra_r
+00017210: 6570 7220 3d20 7365 6c66 2e65 7874 7261  epr = self.extra
+00017220: 5f72 6570 7228 290d 0a20 2020 2020 2020  _repr()..       
+00017230: 2023 2065 6d70 7479 2073 7472 696e 6720   # empty string 
+00017240: 7769 6c6c 2062 6520 7370 6c69 7420 696e  will be split in
+00017250: 746f 206c 6973 7420 5b27 275d 0d0a 2020  to list ['']..  
+00017260: 2020 2020 2020 6966 2065 7874 7261 5f72        if extra_r
+00017270: 6570 723a 0d0a 2020 2020 2020 2020 2020  epr:..          
+00017280: 2020 6578 7472 615f 6c69 6e65 7320 3d20    extra_lines = 
+00017290: 6578 7472 615f 7265 7072 2e73 706c 6974  extra_repr.split
+000172a0: 2827 5c6e 2729 0d0a 2020 2020 2020 2020  ('\n')..        
+000172b0: 6368 696c 645f 6c69 6e65 7320 3d20 5b5d  child_lines = []
+000172c0: 0d0a 2020 2020 2020 2020 666f 7220 6b65  ..        for ke
+000172d0: 792c 206d 6f64 756c 6520 696e 2073 656c  y, module in sel
+000172e0: 662e 5f6d 6f64 756c 6573 2e69 7465 6d73  f._modules.items
+000172f0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00017300: 206d 6f64 5f73 7472 203d 2072 6570 7228   mod_str = repr(
+00017310: 6d6f 6475 6c65 290d 0a20 2020 2020 2020  module)..       
+00017320: 2020 2020 206d 6f64 5f73 7472 203d 205f       mod_str = _
+00017330: 6164 6469 6e64 656e 7428 6d6f 645f 7374  addindent(mod_st
+00017340: 722c 2032 290d 0a20 2020 2020 2020 2020  r, 2)..         
+00017350: 2020 2063 6869 6c64 5f6c 696e 6573 2e61     child_lines.a
+00017360: 7070 656e 6428 2728 2720 2b20 6b65 7920  ppend('(' + key 
+00017370: 2b20 2729 3a20 2720 2b20 6d6f 645f 7374  + '): ' + mod_st
+00017380: 7229 0d0a 2020 2020 2020 2020 6c69 6e65  r)..        line
+00017390: 7320 3d20 6578 7472 615f 6c69 6e65 7320  s = extra_lines 
+000173a0: 2b20 6368 696c 645f 6c69 6e65 730d 0a0d  + child_lines...
+000173b0: 0a20 2020 2020 2020 206d 6169 6e5f 7374  .        main_st
+000173c0: 7220 3d20 7365 6c66 2e5f 6765 745f 6e61  r = self._get_na
+000173d0: 6d65 2829 202b 2027 2827 0d0a 2020 2020  me() + '('..    
+000173e0: 2020 2020 6966 206c 696e 6573 3a0d 0a20      if lines:.. 
+000173f0: 2020 2020 2020 2020 2020 2023 2073 696d             # sim
+00017400: 706c 6520 6f6e 652d 6c69 6e65 7220 696e  ple one-liner in
+00017410: 666f 2c20 7768 6963 6820 6d6f 7374 2062  fo, which most b
+00017420: 7569 6c74 696e 204d 6f64 756c 6573 2077  uiltin Modules w
+00017430: 696c 6c20 7573 650d 0a20 2020 2020 2020  ill use..       
+00017440: 2020 2020 2069 6620 6c65 6e28 6578 7472       if len(extr
+00017450: 615f 6c69 6e65 7329 203d 3d20 3120 616e  a_lines) == 1 an
+00017460: 6420 6e6f 7420 6368 696c 645f 6c69 6e65  d not child_line
+00017470: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00017480: 2020 2020 6d61 696e 5f73 7472 202b 3d20      main_str += 
+00017490: 6578 7472 615f 6c69 6e65 735b 305d 0d0a  extra_lines[0]..
+000174a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000174b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000174c0: 2020 206d 6169 6e5f 7374 7220 2b3d 2027     main_str += '
+000174d0: 5c6e 2020 2720 2b20 275c 6e20 2027 2e6a  \n  ' + '\n  '.j
+000174e0: 6f69 6e28 6c69 6e65 7329 202b 2027 5c6e  oin(lines) + '\n
+000174f0: 270d 0a0d 0a20 2020 2020 2020 206d 6169  '....        mai
+00017500: 6e5f 7374 7220 2b3d 2027 2927 0d0a 2020  n_str += ')'..  
+00017510: 2020 2020 2020 7265 7475 726e 206d 6169        return mai
+00017520: 6e5f 7374 720d 0a0d 0a20 2020 2064 6566  n_str....    def
+00017530: 205f 5f64 6972 5f5f 2873 656c 6629 3a0d   __dir__(self):.
+00017540: 0a20 2020 2020 2020 206d 6f64 756c 655f  .        module_
+00017550: 6174 7472 7320 3d20 6469 7228 7365 6c66  attrs = dir(self
+00017560: 2e5f 5f63 6c61 7373 5f5f 290d 0a20 2020  .__class__)..   
+00017570: 2020 2020 2061 7474 7273 203d 206c 6973       attrs = lis
+00017580: 7428 7365 6c66 2e5f 5f64 6963 745f 5f2e  t(self.__dict__.
+00017590: 6b65 7973 2829 290d 0a20 2020 2020 2020  keys())..       
+000175a0: 2070 6172 616d 6574 6572 7320 3d20 6c69   parameters = li
+000175b0: 7374 2873 656c 662e 5f70 6172 616d 6574  st(self._paramet
+000175c0: 6572 732e 6b65 7973 2829 290d 0a20 2020  ers.keys())..   
+000175d0: 2020 2020 206d 6f64 756c 6573 203d 206c       modules = l
+000175e0: 6973 7428 7365 6c66 2e5f 6d6f 6475 6c65  ist(self._module
+000175f0: 732e 6b65 7973 2829 290d 0a20 2020 2020  s.keys())..     
+00017600: 2020 2062 7566 6665 7273 203d 206c 6973     buffers = lis
+00017610: 7428 7365 6c66 2e5f 6275 6666 6572 732e  t(self._buffers.
+00017620: 6b65 7973 2829 290d 0a20 2020 2020 2020  keys())..       
+00017630: 206b 6579 7320 3d20 6d6f 6475 6c65 5f61   keys = module_a
+00017640: 7474 7273 202b 2061 7474 7273 202b 2070  ttrs + attrs + p
+00017650: 6172 616d 6574 6572 7320 2b20 6d6f 6475  arameters + modu
+00017660: 6c65 7320 2b20 6275 6666 6572 730d 0a0d  les + buffers...
+00017670: 0a20 2020 2020 2020 2023 2045 6c69 6d69  .        # Elimi
+00017680: 6e61 7465 2061 7474 7273 2074 6861 7420  nate attrs that 
+00017690: 6172 6520 6e6f 7420 6c65 6761 6c20 5079  are not legal Py
+000176a0: 7468 6f6e 2076 6172 6961 626c 6520 6e61  thon variable na
+000176b0: 6d65 730d 0a20 2020 2020 2020 206b 6579  mes..        key
+000176c0: 7320 3d20 5b6b 6579 2066 6f72 206b 6579  s = [key for key
+000176d0: 2069 6e20 6b65 7973 2069 6620 6e6f 7420   in keys if not 
+000176e0: 6b65 795b 305d 2e69 7364 6967 6974 2829  key[0].isdigit()
+000176f0: 5d0d 0a0d 0a20 2020 2020 2020 2072 6574  ]....        ret
+00017700: 7572 6e20 736f 7274 6564 286b 6579 7329  urn sorted(keys)
+00017710: 0d0a 0d0a 2020 2020 6465 6620 5f72 6570  ....    def _rep
+00017720: 6c69 6361 7465 5f66 6f72 5f64 6174 615f  licate_for_data_
+00017730: 7061 7261 6c6c 656c 2873 656c 6629 3a0d  parallel(self):.
+00017740: 0a20 2020 2020 2020 2072 6570 6c69 6361  .        replica
+00017750: 203d 2073 656c 662e 5f5f 6e65 775f 5f28   = self.__new__(
+00017760: 7479 7065 2873 656c 6629 290d 0a20 2020  type(self))..   
+00017770: 2020 2020 2072 6570 6c69 6361 2e5f 5f64       replica.__d
+00017780: 6963 745f 5f20 3d20 7365 6c66 2e5f 5f64  ict__ = self.__d
+00017790: 6963 745f 5f2e 636f 7079 2829 0d0a 0d0a  ict__.copy()....
+000177a0: 2020 2020 2020 2020 2320 7265 706c 6963          # replic
+000177b0: 6173 2064 6f20 6e6f 7420 6861 7665 2070  as do not have p
+000177c0: 6172 616d 6574 6572 7320 7468 656d 7365  arameters themse
+000177d0: 6c76 6573 2c20 7468 6520 7265 706c 6963  lves, the replic
+000177e0: 6173 2072 6566 6572 656e 6365 2074 6865  as reference the
+000177f0: 206f 7269 6769 6e61 6c0d 0a20 2020 2020   original..     
+00017800: 2020 2023 206d 6f64 756c 652e 0d0a 2020     # module...  
+00017810: 2020 2020 2020 7265 706c 6963 612e 5f70        replica._p
+00017820: 6172 616d 6574 6572 7320 3d20 4f72 6465  arameters = Orde
+00017830: 7265 6444 6963 7428 290d 0a20 2020 2020  redDict()..     
+00017840: 2020 2072 6570 6c69 6361 2e5f 6275 6666     replica._buff
+00017850: 6572 7320 3d20 7265 706c 6963 612e 5f62  ers = replica._b
+00017860: 7566 6665 7273 2e63 6f70 7928 290d 0a20  uffers.copy().. 
+00017870: 2020 2020 2020 2072 6570 6c69 6361 2e5f         replica._
+00017880: 6d6f 6475 6c65 7320 3d20 7265 706c 6963  modules = replic
+00017890: 612e 5f6d 6f64 756c 6573 2e63 6f70 7928  a._modules.copy(
+000178a0: 290d 0a20 2020 2020 2020 2072 6570 6c69  )..        repli
+000178b0: 6361 2e5f 6973 5f72 6570 6c69 6361 203d  ca._is_replica =
+000178c0: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
+000178d0: 2072 6574 7572 6e20 7265 706c 6963 610d   return replica.
+000178e0: 0a0d 0a0d 0a0d 0a0d 0a0d 0a63 6c61 7373  ...........class
+000178f0: 2053 6571 7565 6e74 6961 6c28 4c61 7965   Sequential(Laye
+00017900: 7229 3a0d 0a20 2020 2072 2222 2241 2073  r):..    r"""A s
+00017910: 6571 7565 6e74 6961 6c20 636f 6e74 6169  equential contai
+00017920: 6e65 722e 0d0a 2020 2020 4d6f 6475 6c65  ner...    Module
+00017930: 7320 7769 6c6c 2062 6520 6164 6465 6420  s will be added 
+00017940: 746f 2069 7420 696e 2074 6865 206f 7264  to it in the ord
+00017950: 6572 2074 6865 7920 6172 6520 7061 7373  er they are pass
+00017960: 6564 2069 6e20 7468 6520 636f 6e73 7472  ed in the constr
+00017970: 7563 746f 722e 0d0a 2020 2020 416c 7465  uctor...    Alte
+00017980: 726e 6174 6976 656c 792c 2061 6e20 6f72  rnatively, an or
+00017990: 6465 7265 6420 6469 6374 206f 6620 6d6f  dered dict of mo
+000179a0: 6475 6c65 7320 6361 6e20 616c 736f 2062  dules can also b
+000179b0: 6520 7061 7373 6564 2069 6e2e 0d0a 0d0a  e passed in.....
+000179c0: 2020 2020 546f 206d 616b 6520 6974 2065      To make it e
+000179d0: 6173 6965 7220 746f 2075 6e64 6572 7374  asier to underst
+000179e0: 616e 642c 2068 6572 6520 6973 2061 2073  and, here is a s
+000179f0: 6d61 6c6c 2065 7861 6d70 6c65 3a3a 0d0a  mall example::..
+00017a00: 0d0a 2020 2020 2020 2020 2320 4578 616d  ..        # Exam
+00017a10: 706c 6520 6f66 2075 7369 6e67 2053 6571  ple of using Seq
+00017a20: 7565 6e74 6961 6c0d 0a20 2020 2020 2020  uential..       
+00017a30: 206d 6f64 656c 203d 206e 6e2e 5365 7175   model = nn.Sequ
+00017a40: 656e 7469 616c 280d 0a20 2020 2020 2020  ential(..       
+00017a50: 2020 2020 2020 2020 2020 206e 6e2e 436f             nn.Co
+00017a60: 6e76 3264 2831 2c32 302c 3529 2c0d 0a20  nv2d(1,20,5),.. 
+00017a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a80: 206e 6e2e 5265 4c55 2829 2c0d 0a20 2020   nn.ReLU(),..   
+00017a90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017aa0: 6e2e 436f 6e76 3264 2832 302c 3634 2c35  n.Conv2d(20,64,5
+00017ab0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00017ac0: 2020 2020 2020 6e6e 2e52 654c 5528 290d        nn.ReLU().
+00017ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017ae0: 2029 0d0a 0d0a 2020 2020 2020 2020 2320   )....        # 
+00017af0: 4578 616d 706c 6520 6f66 2075 7369 6e67  Example of using
+00017b00: 2053 6571 7565 6e74 6961 6c20 7769 7468   Sequential with
+00017b10: 204f 7264 6572 6564 4469 6374 0d0a 2020   OrderedDict..  
+00017b20: 2020 2020 2020 6d6f 6465 6c20 3d20 6e6e        model = nn
+00017b30: 2e53 6571 7565 6e74 6961 6c28 4f72 6465  .Sequential(Orde
+00017b40: 7265 6444 6963 7428 5b0d 0a20 2020 2020  redDict([..     
+00017b50: 2020 2020 2020 2020 2020 2020 2028 2763               ('c
+00017b60: 6f6e 7631 272c 206e 6e2e 436f 6e76 3264  onv1', nn.Conv2d
+00017b70: 2831 2c32 302c 3529 292c 0d0a 2020 2020  (1,20,5)),..    
+00017b80: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+00017b90: 7265 6c75 3127 2c20 6e6e 2e52 654c 5528  relu1', nn.ReLU(
+00017ba0: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
+00017bb0: 2020 2020 2020 2028 2763 6f6e 7632 272c         ('conv2',
+00017bc0: 206e 6e2e 436f 6e76 3264 2832 302c 3634   nn.Conv2d(20,64
+00017bd0: 2c35 2929 2c0d 0a20 2020 2020 2020 2020  ,5)),..         
+00017be0: 2020 2020 2020 2020 2028 2772 656c 7532           ('relu2
+00017bf0: 272c 206e 6e2e 5265 4c55 2829 290d 0a20  ', nn.ReLU()).. 
+00017c00: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00017c10: 2929 0d0a 2020 2020 2222 220d 0a0d 0a20  ))..    """.... 
+00017c20: 2020 205f 6d6f 6475 6c65 733a 2044 6963     _modules: Dic
+00017c30: 745b 7374 722c 2074 662e 4d6f 6475 6c65  t[str, tf.Module
+00017c40: 5d20 2023 2074 7970 653a 2069 676e 6f72  ]  # type: ignor
+00017c50: 655b 6173 7369 676e 6d65 6e74 5d0d 0a0d  e[assignment]...
+00017c60: 0a20 2020 2040 6f76 6572 6c6f 6164 0d0a  .    @overload..
+00017c70: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00017c80: 2873 656c 662c 202a 6172 6773 3a20 7466  (self, *args: tf
+00017c90: 2e4d 6f64 756c 6529 202d 3e20 4e6f 6e65  .Module) -> None
+00017ca0: 3a0d 0a20 2020 2020 2020 202e 2e2e 0d0a  :..        .....
+00017cb0: 0d0a 2020 2020 406f 7665 726c 6f61 640d  ..    @overload.
+00017cc0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00017cd0: 5f28 7365 6c66 2c20 6172 673a 2044 6963  _(self, arg: Dic
+00017ce0: 745b 7374 722c 2074 662e 4d6f 6475 6c65  t[str, tf.Module
+00017cf0: 5d29 202d 3e20 4e6f 6e65 3a0d 0a20 2020  ]) -> None:..   
+00017d00: 2020 2020 202e 2e2e 0d0a 0d0a 2020 2020       .......    
+00017d10: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00017d20: 662c 202a 6172 6773 2c20 6e61 6d65 3d4e  f, *args, name=N
+00017d30: 6f6e 652c 206b 6565 705f 6f75 7470 7574  one, keep_output
+00017d40: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+00017d50: 2020 7375 7065 7228 292e 5f5f 7365 7461    super().__seta
+00017d60: 7474 725f 5f28 275f 6d6f 6475 6c65 7327  ttr__('_modules'
+00017d70: 2c20 4f72 6465 7265 6444 6963 7428 2929  , OrderedDict())
+00017d80: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
+00017d90: 5365 7175 656e 7469 616c 2c20 7365 6c66  Sequential, self
+00017da0: 292e 5f5f 696e 6974 5f5f 286e 616d 653d  ).__init__(name=
+00017db0: 6e61 6d65 2c6b 6565 705f 6f75 7470 7574  name,keep_output
+00017dc0: 3d6b 6565 705f 6f75 7470 7574 290d 0a20  =keep_output).. 
+00017dd0: 2020 2020 2020 2073 656c 662e 5f62 7569         self._bui
+00017de0: 6c74 203d 2046 616c 7365 0d0a 2020 2020  lt = False..    
+00017df0: 2020 2020 6172 6773 203d 2075 6e70 6163      args = unpac
+00017e00: 6b5f 7369 6e67 6c65 746f 6e28 6172 6773  k_singleton(args
+00017e10: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+00017e20: 696e 7374 616e 6365 2861 7267 732c 204f  instance(args, O
+00017e30: 7264 6572 6564 4469 6374 293a 0d0a 2020  rderedDict):..  
+00017e40: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+00017e50: 792c 206d 6f64 756c 6520 696e 2061 7267  y, module in arg
+00017e60: 732e 6974 656d 7328 293a 0d0a 2020 2020  s.items():..    
+00017e70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00017e80: 2e61 6464 5f6d 6f64 756c 6528 6b65 792c  .add_module(key,
+00017e90: 206d 6f64 756c 6529 0d0a 2020 2020 2020   module)..      
+00017ea0: 2020 656c 6966 206c 656e 2861 7267 7329    elif len(args)
+00017eb0: 203d 3d20 3120 616e 6420 6973 696e 7374   == 1 and isinst
+00017ec0: 616e 6365 2861 7267 732c 204f 7264 6572  ance(args, Order
+00017ed0: 6564 4469 6374 293a 0d0a 2020 2020 2020  edDict):..      
+00017ee0: 2020 2020 2020 666f 7220 6b65 792c 206d        for key, m
+00017ef0: 6f64 756c 6520 696e 2061 7267 735b 305d  odule in args[0]
+00017f00: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
+00017f10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00017f20: 6164 645f 6d6f 6475 6c65 286b 6579 2c20  add_module(key, 
+00017f30: 6d6f 6475 6c65 290d 0a20 2020 2020 2020  module)..       
+00017f40: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00017f50: 2020 2020 666f 7220 6964 782c 206d 6f64      for idx, mod
+00017f60: 756c 6520 696e 2065 6e75 6d65 7261 7465  ule in enumerate
+00017f70: 2861 7267 7329 3a0d 0a20 2020 2020 2020  (args):..       
+00017f80: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00017f90: 645f 6d6f 6475 6c65 2873 7472 2869 6478  d_module(str(idx
+00017fa0: 292c 206d 6f64 756c 6529 0d0a 0d0a 2020  ), module)....  
+00017fb0: 2020 2020 2020 2320 7365 6c66 2e74 6f28        # self.to(
+00017fc0: 7365 6c66 2e64 6576 6963 6529 0d0a 0d0a  self.device)....
+00017fd0: 2020 2020 2320 4070 726f 7065 7274 790d      # @property.
+00017fe0: 0a20 2020 2023 2064 6566 206f 7574 7075  .    # def outpu
+00017ff0: 745f 7368 6170 6528 7365 6c66 293a 0d0a  t_shape(self):..
+00018000: 2020 2020 2320 2020 2020 6966 206c 656e      #     if len
+00018010: 2873 656c 6629 3e30 3a0d 0a20 2020 2023  (self)>0:..    #
+00018020: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018030: 7365 6c66 5b2d 315d 2e5f 6f75 7470 7574  self[-1]._output
+00018040: 5f73 6861 7065 0d0a 2020 2020 2320 2020  _shape..    #   
+00018050: 2020 656c 7365 3a0d 0a20 2020 2023 2020    else:..    #  
+00018060: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00018070: 6e65 0d0a 2020 2020 230d 0a20 2020 2023  ne..    #..    #
+00018080: 2040 6f75 7470 7574 5f73 6861 7065 2e73   @output_shape.s
+00018090: 6574 7465 720d 0a20 2020 2023 2064 6566  etter..    # def
+000180a0: 206f 7574 7075 745f 7368 6170 6528 7365   output_shape(se
+000180b0: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
+000180c0: 2023 2020 2020 2069 6620 6c65 6e28 7365   #     if len(se
+000180d0: 6c66 2920 3e20 303a 0d0a 2020 2020 2320  lf) > 0:..    # 
+000180e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000180f0: 7461 6e63 6528 7661 6c75 652c 2074 662e  tance(value, tf.
+00018100: 5465 6e73 6f72 5368 6170 6529 3a0d 0a20  TensorShape):.. 
+00018110: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00018120: 2076 616c 7565 203d 2074 6f5f 7465 6e73   value = to_tens
+00018130: 6f72 2876 616c 7565 2e61 735f 6c69 7374  or(value.as_list
+00018140: 2829 292e 746f 2827 696e 7427 290d 0a20  ()).to('int').. 
+00018150: 2020 2023 2020 2020 2020 2020 2065 6c69     #         eli
+00018160: 6620 6973 696e 7374 616e 6365 2876 616c  f isinstance(val
+00018170: 7565 2c20 286c 6973 742c 2074 7570 6c65  ue, (list, tuple
+00018180: 2929 2061 6e64 206c 656e 2876 616c 7565  )) and len(value
+00018190: 2920 3e20 303a 0d0a 2020 2020 2320 2020  ) > 0:..    #   
+000181a0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+000181b0: 3d20 7475 706c 6528 0d0a 2020 2020 2320  = tuple(..    # 
+000181c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181d0: 5b74 6f5f 7465 6e73 6f72 2874 656e 736f  [to_tensor(tenso
+000181e0: 725f 7368 6170 652e 6173 5f6c 6973 7428  r_shape.as_list(
+000181f0: 2929 2e74 6f28 2769 6e74 2729 2069 6620  )).to('int') if 
+00018200: 6973 696e 7374 616e 6365 2874 656e 736f  isinstance(tenso
+00018210: 725f 7368 6170 652c 2074 662e 5465 6e73  r_shape, tf.Tens
+00018220: 6f72 5368 6170 6529 2065 6c73 6520 746f  orShape) else to
+00018230: 5f74 656e 736f 7228 7465 6e73 6f72 5f73  _tensor(tensor_s
+00018240: 6861 7065 292e 746f 2827 696e 7427 2920  hape).to('int') 
+00018250: 666f 7220 7465 6e73 6f72 5f73 6861 7065  for tensor_shape
+00018260: 2069 6e20 7661 6c75 655d 290d 0a20 2020   in value])..   
+00018270: 2023 0d0a 2020 2020 2320 2020 2020 2020   #..    #       
+00018280: 2020 656c 7365 3a0d 0a20 2020 2023 2020    else:..    #  
+00018290: 2020 2020 2020 2020 2020 2076 616c 7565             value
+000182a0: 203d 2074 6f5f 7465 6e73 6f72 2876 616c   = to_tensor(val
+000182b0: 7565 292e 746f 2827 696e 7427 290d 0a20  ue).to('int').. 
+000182c0: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
+000182d0: 665b 2d31 5d2e 5f6f 7574 7075 745f 7368  f[-1]._output_sh
+000182e0: 6170 6520 3d20 7661 6c75 650d 0a20 2020  ape = value..   
+000182f0: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+00018300: 5f73 6967 6e61 7475 7265 3d4e 6f6e 650d  _signature=None.
+00018310: 0a0d 0a20 2020 2064 6566 2062 7569 6c64  ...    def build
+00018320: 2873 656c 662c 2069 6e70 7574 5f73 6861  (self, input_sha
+00018330: 7065 3a20 5465 6e73 6f72 5368 6170 6529  pe: TensorShape)
+00018340: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+00018350: 6c66 2e5f 6275 696c 7420 3d3d 2046 616c  lf._built == Fal
+00018360: 7365 2061 6e64 206c 656e 2873 656c 662e  se and len(self.
+00018370: 5f6d 6f64 756c 6573 2920 3e20 303a 0d0a  _modules) > 0:..
+00018380: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018390: 2e5f 5f67 6574 6974 656d 5f5f 2830 292e  .__getitem__(0).
+000183a0: 696e 7075 745f 7368 6170 6520 3d20 696e  input_shape = in
+000183b0: 7075 745f 7368 6170 650d 0a20 2020 2020  put_shape..     
+000183c0: 2020 2020 2020 2073 656c 662e 5f62 7569         self._bui
+000183d0: 6c74 203d 2054 7275 650d 0a0d 0a20 2020  lt = True....   
+000183e0: 2064 6566 2061 6464 5f6d 6f64 756c 6528   def add_module(
+000183f0: 7365 6c66 2c20 6e61 6d65 2c20 6d6f 6475  self, name, modu
+00018400: 6c65 293a 0d0a 2020 2020 2020 2020 7222  le):..        r"
+00018410: 2222 4164 6473 2061 2063 6869 6c64 206d  ""Adds a child m
+00018420: 6f64 756c 6520 746f 2074 6865 2063 7572  odule to the cur
+00018430: 7265 6e74 206d 6f64 756c 652e 0d0a 0d0a  rent module.....
+00018440: 2020 2020 2020 2020 5468 6520 6d6f 6475          The modu
+00018450: 6c65 2063 616e 2062 6520 6163 6365 7373  le can be access
+00018460: 6564 2061 7320 616e 2061 7474 7269 6275  ed as an attribu
+00018470: 7465 2075 7369 6e67 2074 6865 2067 6976  te using the giv
+00018480: 656e 206e 616d 652e 0d0a 0d0a 2020 2020  en name.....    
+00018490: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+000184a0: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
+000184b0: 696e 6729 3a20 6e61 6d65 206f 6620 7468  ing): name of th
+000184c0: 6520 6368 696c 6420 6d6f 6475 6c65 2e20  e child module. 
+000184d0: 5468 6520 6368 696c 6420 6d6f 6475 6c65  The child module
+000184e0: 2063 616e 2062 650d 0a20 2020 2020 2020   can be..       
+000184f0: 2020 2020 2020 2020 2061 6363 6573 7365           accesse
+00018500: 6420 6672 6f6d 2074 6869 7320 6d6f 6475  d from this modu
+00018510: 6c65 2075 7369 6e67 2074 6865 2067 6976  le using the giv
+00018520: 656e 206e 616d 650d 0a20 2020 2020 2020  en name..       
+00018530: 2020 2020 206d 6f64 756c 6520 284d 6f64       module (Mod
+00018540: 756c 6529 3a20 6368 696c 6420 6d6f 6475  ule): child modu
+00018550: 6c65 2074 6f20 6265 2061 6464 6564 2074  le to be added t
+00018560: 6f20 7468 6520 6d6f 6475 6c65 2e0d 0a20  o the module... 
+00018570: 2020 2020 2020 2022 2222 0d0a 0d0a 2020         """....  
+00018580: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00018590: 662e 5f6d 6f64 756c 6573 2920 3e20 3020  f._modules) > 0 
+000185a0: 616e 6420 7365 6c66 2e5f 696e 7075 745f  and self._input_
+000185b0: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
+000185c0: 6520 616e 6420 7365 6c66 5b2d 315d 2e62  e and self[-1].b
+000185d0: 7569 6c74 2061 6e64 2073 656c 665b 2d31  uilt and self[-1
+000185e0: 5d2e 5f6f 7574 7075 745f 7368 6170 6520  ]._output_shape 
+000185f0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00018600: 2020 2020 2020 2020 2020 6c61 7374 5f6f            last_o
+00018610: 7574 7075 7420 3d20 7365 6c66 5b2d 315d  utput = self[-1]
+00018620: 2e5f 6f75 7470 7574 5f73 6861 7065 0d0a  ._output_shape..
+00018630: 2020 2020 2020 2020 2020 2020 6475 6d6d              dumm
+00018640: 6179 5f69 6e70 7574 203d 2074 6f5f 7465  ay_input = to_te
+00018650: 6e73 6f72 286c 6173 745f 6f75 7470 7574  nsor(last_output
+00018660: 2e67 6574 5f64 756d 6d79 5f74 656e 736f  .get_dummy_tenso
+00018670: 7228 2929 2e74 6f28 7365 6c66 2e64 6576  r()).to(self.dev
+00018680: 6963 6529 0d0a 2020 2020 2020 2020 2020  ice)..          
+00018690: 2020 6f75 7420 3d20 6d6f 6475 6c65 2864    out = module(d
+000186a0: 756d 6d61 795f 696e 7075 7429 0d0a 2020  ummay_input)..  
+000186b0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000186c0: 6d6f 6475 6c65 735b 6e61 6d65 5d20 3d20  modules[name] = 
+000186d0: 6d6f 6475 6c65 0d0a 2020 2020 2020 2020  module..        
+000186e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000186f0: 6528 6f75 742c 204f 7264 6572 6564 4469  e(out, OrderedDi
+00018700: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
+00018710: 2020 2020 2020 7365 6c66 2e5f 6f75 7470        self._outp
+00018720: 7574 5f73 6861 7065 203d 2074 7570 6c65  ut_shape = tuple
+00018730: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00018740: 2020 2020 2020 205b 7465 6e73 6f72 5f74         [tensor_t
+00018750: 6f5f 7368 6170 6528 6f2c 206e 6565 645f  o_shape(o, need_
+00018760: 6578 636c 7564 655f 6261 7463 685f 6178  exclude_batch_ax
+00018770: 6973 3d54 7275 652c 2069 735f 7369 6e67  is=True, is_sing
+00018780: 6c65 746f 6e3d 4661 6c73 6529 2066 6f72  leton=False) for
+00018790: 206f 2069 6e20 6f75 742e 7661 6c75 655f   o in out.value_
+000187a0: 6c69 7374 5d29 0d0a 2020 2020 2020 2020  list])..        
+000187b0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+000187c0: 5f72 6f6f 7428 292e 7369 676e 6174 7572  _root().signatur
+000187d0: 652e 6f75 7470 7574 7320 3d20 4f72 6465  e.outputs = Orde
+000187e0: 7265 6444 6963 7428 290d 0a20 2020 2020  redDict()..     
+000187f0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00018800: 2c20 7620 696e 206f 7574 2e69 7465 6d5f  , v in out.item_
+00018810: 6c69 7374 3a0d 0a20 2020 2020 2020 2020  list:..         
+00018820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018830: 6765 745f 726f 6f74 2829 2e73 6967 6e61  get_root().signa
+00018840: 7475 7265 2e6f 7574 7075 7473 5b6b 5d20  ture.outputs[k] 
+00018850: 3d20 7465 6e73 6f72 5f74 6f5f 7368 6170  = tensor_to_shap
+00018860: 6528 762c 206e 6565 645f 6578 636c 7564  e(v, need_exclud
+00018870: 655f 6261 7463 685f 6178 6973 3d54 7275  e_batch_axis=Tru
+00018880: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00018890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000188d0: 735f 7369 6e67 6c65 746f 6e3d 4661 6c73  s_singleton=Fals
+000188e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000188f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00018900: 2020 2020 2020 206f 7574 203d 2065 6e66         out = enf
+00018910: 6f72 6365 5f73 696e 676c 6574 6f6e 286f  orce_singleton(o
+00018920: 7574 290d 0a20 2020 2020 2020 2020 2020  ut)..           
+00018930: 2020 2020 2073 656c 662e 5f6f 7574 7075       self._outpu
+00018940: 745f 7368 6170 6520 3d20 7465 6e73 6f72  t_shape = tensor
+00018950: 5f74 6f5f 7368 6170 6528 6f75 742c 206e  _to_shape(out, n
+00018960: 6565 645f 6578 636c 7564 655f 6261 7463  eed_exclude_batc
+00018970: 685f 6178 6973 3d54 7275 652c 2069 735f  h_axis=True, is_
+00018980: 7369 6e67 6c65 746f 6e3d 4661 6c73 6529  singleton=False)
+00018990: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000189a0: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
+000189b0: 652e 6f75 7470 7574 735b 7365 6c66 2e5f  e.outputs[self._
+000189c0: 7369 676e 6174 7572 652e 6f75 7470 7574  signature.output
+000189d0: 732e 6b65 795f 6c69 7374 5b30 5d5d 2e73  s.key_list[0]].s
+000189e0: 6861 7065 203d 2073 656c 662e 5f6f 7574  hape = self._out
+000189f0: 7075 745f 7368 6170 650d 0a20 2020 2020  put_shape..     
+00018a00: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00018a10: 6c65 6e28 7365 6c66 2e67 6574 5f72 6f6f  len(self.get_roo
+00018a20: 7428 292e 7369 676e 6174 7572 652e 6f75  t().signature.ou
+00018a30: 7470 7574 7329 203e 2030 3a0d 0a20 2020  tputs) > 0:..   
+00018a40: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00018a50: 2020 2073 656c 662e 6765 745f 726f 6f74     self.get_root
+00018a60: 2829 2e73 6967 6e61 7475 7265 3d67 6574  ().signature=get
+00018a70: 5f73 6967 6e61 7475 7265 2873 656c 6629  _signature(self)
+00018a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018a90: 2020 2320 656c 7365 3a0d 0a20 2020 2020    # else:..     
+00018aa0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00018ab0: 2073 656c 662e 6765 745f 726f 6f74 2829   self.get_root()
+00018ac0: 2e73 6967 6e61 7475 7265 2e6f 7574 7075  .signature.outpu
+00018ad0: 7473 5b27 6f75 7470 7574 275d 203d 2073  ts['output'] = s
+00018ae0: 656c 662e 5f6f 7574 7075 745f 7368 6170  elf._output_shap
+00018af0: 652e 636f 7079 2829 0d0a 0d0a 2020 2020  e.copy()....    
+00018b00: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00018b10: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+00018b20: 7361 7474 7228 6d6f 6475 6c65 2c20 275f  sattr(module, '_
+00018b30: 7369 676e 6174 7572 6527 2920 6f72 206d  signature') or m
+00018b40: 6f64 756c 652e 5f73 6967 6e61 7475 7265  odule._signature
+00018b50: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00018b60: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+00018b70: 652e 5f73 6967 6e61 7475 7265 203d 2067  e._signature = g
+00018b80: 6574 5f73 6967 6e61 7475 7265 286d 6f64  et_signature(mod
+00018b90: 756c 6529 0d0a 2020 2020 2020 2020 2020  ule)..          
+00018ba0: 2020 7369 6720 3d67 6574 5f73 6967 6e61    sig =get_signa
+00018bb0: 7475 7265 286d 6f64 756c 6529 0d0a 2020  ture(module)..  
+00018bc0: 2020 2020 2020 2020 2020 7375 7065 7228            super(
+00018bd0: 5365 7175 656e 7469 616c 2c20 7365 6c66  Sequential, self
+00018be0: 292e 6164 645f 6d6f 6475 6c65 286e 616d  ).add_module(nam
+00018bf0: 652c 206d 6f64 756c 6529 0d0a 2020 2020  e, module)..    
+00018c00: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00018c10: 656c 6629 203d 3d20 3120 6f72 2073 656c  elf) == 1 or sel
+00018c20: 662e 5f73 6967 6e61 7475 7265 2069 7320  f._signature is 
+00018c30: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00018c40: 2020 2020 2020 2073 656c 662e 5f73 6967         self._sig
+00018c50: 6e61 7475 7265 203d 2073 6967 0d0a 2020  nature = sig..  
+00018c60: 2020 2020 2020 2020 2020 656c 6966 206c            elif l
+00018c70: 656e 2873 656c 6629 203e 2031 3a0d 0a20  en(self) > 1:.. 
+00018c80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018c90: 656c 662e 5f73 6967 6e61 7475 7265 2e6f  elf._signature.o
+00018ca0: 7574 7075 7473 203d 2064 6565 7063 6f70  utputs = deepcop
+00018cb0: 7928 7369 672e 6f75 7470 7574 7329 0d0a  y(sig.outputs)..
+00018cc0: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+00018cd0: 5f61 7428 7365 6c66 2c20 6964 7829 3a0d  _at(self, idx):.
+00018ce0: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
+00018cf0: 6465 6c69 7465 6d5f 5f28 6964 7829 0d0a  delitem__(idx)..
+00018d00: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00018d10: 656c 662e 5f6d 6f64 756c 6573 2920 3e20  elf._modules) > 
+00018d20: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00018d30: 7365 6c66 2e5f 6f75 7470 7574 5f73 6861  self._output_sha
+00018d40: 7065 203d 2073 656c 665b 2d31 5d2e 5f6f  pe = self[-1]._o
+00018d50: 7574 7075 745f 7368 6170 650d 0a20 2020  utput_shape..   
+00018d60: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00018d70: 7374 616e 6365 2873 656c 662e 5f73 6967  stance(self._sig
+00018d80: 6e61 7475 7265 2c20 5369 676e 6174 7572  nature, Signatur
+00018d90: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+00018da0: 2020 2020 2073 656c 662e 5f73 6967 6e61       self._signa
+00018db0: 7475 7265 2e6f 7574 7075 7473 5b73 656c  ture.outputs[sel
+00018dc0: 662e 5f73 6967 6e61 7475 7265 2e6f 7574  f._signature.out
+00018dd0: 7075 7473 2e6b 6579 5f6c 6973 745b 305d  puts.key_list[0]
+00018de0: 5d2e 7368 6170 6520 3d20 7365 6c66 5b2d  ].shape = self[-
+00018df0: 315d 2e5f 6f75 7470 7574 5f73 6861 7065  1]._output_shape
+00018e00: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
+00018e10: 5f69 7465 6d5f 6279 5f69 6478 2873 656c  _item_by_idx(sel
+00018e20: 662c 2069 7465 7261 746f 722c 2069 6478  f, iterator, idx
+00018e30: 293a 0d0a 2020 2020 2020 2020 2222 2247  ):..        """G
+00018e40: 6574 2074 6865 2069 6478 2d74 6820 6974  et the idx-th it
+00018e50: 656d 206f 6620 7468 6520 6974 6572 6174  em of the iterat
+00018e60: 6f72 2222 220d 0a20 2020 2020 2020 2073  or"""..        s
+00018e70: 697a 6520 3d20 6c65 6e28 7365 6c66 290d  ize = len(self).
+00018e80: 0a20 2020 2020 2020 2069 6478 203d 2069  .        idx = i
+00018e90: 6478 2e5f 5f69 6e64 6578 5f5f 2829 0d0a  dx.__index__()..
+00018ea0: 2020 2020 2020 2020 6966 206e 6f74 202d          if not -
+00018eb0: 7369 7a65 203c 3d20 6964 7820 3c20 7369  size <= idx < si
+00018ec0: 7a65 3a0d 0a20 2020 2020 2020 2020 2020  ze:..           
+00018ed0: 2072 6169 7365 2049 6e64 6578 4572 726f   raise IndexErro
+00018ee0: 7228 2769 6e64 6578 207b 7d20 6973 206f  r('index {} is o
+00018ef0: 7574 206f 6620 7261 6e67 6527 2e66 6f72  ut of range'.for
+00018f00: 6d61 7428 6964 7829 290d 0a20 2020 2020  mat(idx))..     
+00018f10: 2020 2069 6478 2025 3d20 7369 7a65 0d0a     idx %= size..
+00018f20: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+00018f30: 6578 7428 6973 6c69 6365 2869 7465 7261  ext(islice(itera
+00018f40: 746f 722c 2069 6478 2c20 4e6f 6e65 2929  tor, idx, None))
+00018f50: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6765  ....    def __ge
+00018f60: 7469 7465 6d5f 5f28 7365 6c66 2c20 6964  titem__(self, id
+00018f70: 7829 3a0d 0a20 2020 2020 2020 2069 6620  x):..        if 
+00018f80: 6973 696e 7374 616e 6365 2869 6478 2c20  isinstance(idx, 
+00018f90: 736c 6963 6529 3a0d 0a20 2020 2020 2020  slice):..       
+00018fa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00018fb0: 2e5f 5f63 6c61 7373 5f5f 284f 7264 6572  .__class__(Order
+00018fc0: 6564 4469 6374 286c 6973 7428 7365 6c66  edDict(list(self
+00018fd0: 2e5f 6d6f 6475 6c65 732e 6974 656d 7328  ._modules.items(
+00018fe0: 2929 5b69 6478 5d29 290d 0a20 2020 2020  ))[idx]))..     
+00018ff0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00019000: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00019010: 662e 5f67 6574 5f69 7465 6d5f 6279 5f69  f._get_item_by_i
+00019020: 6478 2873 656c 662e 5f6d 6f64 756c 6573  dx(self._modules
+00019030: 2e76 616c 7565 7328 292c 2069 6478 290d  .values(), idx).
+00019040: 0a0d 0a0d 0a20 2020 2064 6566 205f 5f73  .....    def __s
+00019050: 6574 6974 656d 5f5f 2873 656c 662c 2069  etitem__(self, i
+00019060: 6478 2c20 6d6f 6475 6c65 293a 0d0a 2020  dx, module):..  
+00019070: 2020 2020 2020 6b65 793a 2073 7472 203d        key: str =
+00019080: 2073 656c 662e 5f67 6574 5f69 7465 6d5f   self._get_item_
+00019090: 6279 5f69 6478 2873 656c 662e 5f6d 6f64  by_idx(self._mod
+000190a0: 756c 6573 2e6b 6579 7328 292c 2069 6478  ules.keys(), idx
+000190b0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000190c0: 6e20 7365 7461 7474 7228 7365 6c66 2c20  n setattr(self, 
+000190d0: 6b65 792c 206d 6f64 756c 6529 0d0a 0d0a  key, module)....
+000190e0: 2020 2020 6465 6620 5f5f 6465 6c69 7465      def __delite
+000190f0: 6d5f 5f28 7365 6c66 2c20 6964 7829 3a0d  m__(self, idx):.
+00019100: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00019110: 7374 616e 6365 2869 6478 2c20 736c 6963  stance(idx, slic
+00019120: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+00019130: 2066 6f72 206b 6579 2069 6e20 6c69 7374   for key in list
+00019140: 2873 656c 662e 5f6d 6f64 756c 6573 2e6b  (self._modules.k
+00019150: 6579 7328 2929 5b69 6478 5d3a 0d0a 2020  eys())[idx]:..  
+00019160: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00019170: 6c61 7474 7228 7365 6c66 2c20 6b65 7929  lattr(self, key)
+00019180: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00019190: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
+000191a0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
+000191b0: 6d5f 6279 5f69 6478 2873 656c 662e 5f6d  m_by_idx(self._m
+000191c0: 6f64 756c 6573 2e6b 6579 7328 292c 2069  odules.keys(), i
+000191d0: 6478 290d 0a20 2020 2020 2020 2020 2020  dx)..           
+000191e0: 2064 656c 6174 7472 2873 656c 662c 206b   delattr(self, k
+000191f0: 6579 290d 0a0d 0a20 2020 2020 2020 2023  ey)....        #
+00019200: 2054 6f20 7072 6573 6572 7665 206e 756d   To preserve num
+00019210: 6265 7269 6e67 0d0a 2020 2020 2020 2020  bering..        
+00019220: 7374 725f 696e 6469 6365 7320 3d20 5b73  str_indices = [s
+00019230: 7472 2869 2920 666f 7220 6920 696e 2072  tr(i) for i in r
+00019240: 616e 6765 286c 656e 2873 656c 662e 5f6d  ange(len(self._m
+00019250: 6f64 756c 6573 2929 5d0d 0a20 2020 2020  odules))]..     
+00019260: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
+00019270: 203d 204f 7264 6572 6564 4469 6374 286c   = OrderedDict(l
+00019280: 6973 7428 7a69 7028 7374 725f 696e 6469  ist(zip(str_indi
+00019290: 6365 732c 2073 656c 662e 5f6d 6f64 756c  ces, self._modul
+000192a0: 6573 2e76 616c 7565 7328 2929 2929 0d0a  es.values())))..
+000192b0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6c65  ....    def __le
+000192c0: 6e5f 5f28 7365 6c66 2920 2d3e 2069 6e74  n__(self) -> int
+000192d0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+000192e0: 6e20 6c65 6e28 7365 6c66 2e5f 6d6f 6475  n len(self._modu
+000192f0: 6c65 7329 0d0a 0d0a 0d0a 2020 2020 6465  les)......    de
+00019300: 6620 5f5f 6164 645f 5f28 7365 6c66 2c20  f __add__(self, 
+00019310: 6f74 6865 7229 202d 3e20 2753 6571 7565  other) -> 'Seque
+00019320: 6e74 6961 6c27 3a0d 0a20 2020 2020 2020  ntial':..       
+00019330: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+00019340: 7468 6572 2c20 5365 7175 656e 7469 616c  ther, Sequential
+00019350: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00019360: 7265 7420 3d20 5365 7175 656e 7469 616c  ret = Sequential
+00019370: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00019380: 666f 7220 6c61 7965 7220 696e 2073 656c  for layer in sel
+00019390: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+000193a0: 2020 2020 7265 742e 6170 7065 6e64 286c      ret.append(l
+000193b0: 6179 6572 290d 0a20 2020 2020 2020 2020  ayer)..         
+000193c0: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
+000193d0: 6f74 6865 723a 0d0a 2020 2020 2020 2020  other:..        
+000193e0: 2020 2020 2020 2020 7265 742e 6170 7065          ret.appe
+000193f0: 6e64 286c 6179 6572 290d 0a20 2020 2020  nd(layer)..     
+00019400: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00019410: 740d 0a20 2020 2020 2020 2065 6c73 653a  t..        else:
+00019420: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00019430: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+00019440: 6164 6420 6f70 6572 6174 6f72 2073 7570  add operator sup
+00019450: 706f 7274 7320 6f6e 6c79 206f 626a 6563  ports only objec
+00019460: 7473 2027 0d0a 2020 2020 2020 2020 2020  ts '..          
+00019470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019480: 2020 2027 6f66 2053 6571 7565 6e74 6961     'of Sequentia
+00019490: 6c20 636c 6173 732c 2062 7574 207b 7d20  l class, but {} 
+000194a0: 6973 2067 6976 656e 2e27 2e66 6f72 6d61  is given.'.forma
+000194b0: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 2020 2020 2073 7472 2874 7970 6528 6f74       str(type(ot
+000194e0: 6865 7229 2929 290d 0a0d 0a20 2020 2064  her))))....    d
+000194f0: 6566 2070 6f70 2873 656c 662c 206b 6579  ef pop(self, key
+00019500: 3a20 556e 696f 6e5b 696e 742c 2073 6c69  : Union[int, sli
+00019510: 6365 5d29 202d 3e20 7466 2e4d 6f64 756c  ce]) -> tf.Modul
+00019520: 653a 0d0a 2020 2020 2020 2020 7620 3d20  e:..        v = 
+00019530: 7365 6c66 5b6b 6579 5d0d 0a20 2020 2020  self[key]..     
+00019540: 2020 2064 656c 2073 656c 665b 6b65 795d     del self[key]
+00019550: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00019560: 2076 0d0a 0d0a 2020 2020 6465 6620 5f5f   v....    def __
+00019570: 6961 6464 5f5f 2873 656c 662c 206f 7468  iadd__(self, oth
+00019580: 6572 2920 2d3e 2027 5365 7175 656e 7469  er) -> 'Sequenti
+00019590: 616c 273a 0d0a 2020 2020 2020 2020 6966  al':..        if
+000195a0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+000195b0: 722c 2053 6571 7565 6e74 6961 6c29 3a0d  r, Sequential):.
+000195c0: 0a20 2020 2020 2020 2020 2020 206f 6666  .            off
+000195d0: 7365 7420 3d20 6c65 6e28 7365 6c66 290d  set = len(self).
+000195e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000195f0: 2069 2c20 6d6f 6475 6c65 2069 6e20 656e   i, module in en
+00019600: 756d 6572 6174 6528 6f74 6865 7229 3a0d  umerate(other):.
+00019610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019620: 2073 656c 662e 6164 645f 6d6f 6475 6c65   self.add_module
+00019630: 2873 7472 2869 202b 206f 6666 7365 7429  (str(i + offset)
+00019640: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
+00019650: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00019660: 6c66 0d0a 2020 2020 2020 2020 656c 7365  lf..        else
+00019670: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00019680: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00019690: 2761 6464 206f 7065 7261 746f 7220 7375  'add operator su
+000196a0: 7070 6f72 7473 206f 6e6c 7920 6f62 6a65  pports only obje
+000196b0: 6374 7320 270d 0a20 2020 2020 2020 2020  cts '..         
+000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196d0: 2020 2020 276f 6620 5365 7175 656e 7469      'of Sequenti
+000196e0: 616c 2063 6c61 7373 2c20 6275 7420 7b7d  al class, but {}
+000196f0: 2069 7320 6769 7665 6e2e 272e 666f 726d   is given.'.form
+00019700: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+00019710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019720: 2020 2020 2020 7374 7228 7479 7065 286f        str(type(o
+00019730: 7468 6572 2929 2929 0d0a 0d0a 2020 2020  ther))))....    
+00019740: 6465 6620 5f5f 6d75 6c5f 5f28 7365 6c66  def __mul__(self
+00019750: 2c20 6f74 6865 723a 2069 6e74 2920 2d3e  , other: int) ->
+00019760: 2027 5365 7175 656e 7469 616c 273a 0d0a   'Sequential':..
+00019770: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00019780: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
+00019790: 2069 6e74 293a 0d0a 2020 2020 2020 2020   int):..        
+000197a0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+000197b0: 726f 7228 6622 756e 7375 7070 6f72 7465  ror(f"unsupporte
+000197c0: 6420 6f70 6572 616e 6420 7479 7065 2873  d operand type(s
+000197d0: 2920 666f 7220 2a3a 207b 7479 7065 2873  ) for *: {type(s
+000197e0: 656c 6629 7d20 616e 6420 7b74 7970 6528  elf)} and {type(
+000197f0: 6f74 6865 7229 7d22 290d 0a20 2020 2020  other)}")..     
+00019800: 2020 2065 6c69 6620 286f 7468 6572 203c     elif (other <
+00019810: 3d20 3029 3a0d 0a20 2020 2020 2020 2020  = 0):..         
+00019820: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00019830: 726f 7228 6622 4e6f 6e2d 706f 7369 7469  ror(f"Non-positi
+00019840: 7665 206d 756c 7469 706c 6963 6174 696f  ve multiplicatio
+00019850: 6e20 6661 6374 6f72 207b 6f74 6865 727d  n factor {other}
+00019860: 2066 6f72 207b 7479 7065 2873 656c 6629   for {type(self)
+00019870: 7d22 290d 0a20 2020 2020 2020 2065 6c73  }")..        els
+00019880: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00019890: 636f 6d62 696e 6564 203d 2053 6571 7565  combined = Seque
+000198a0: 6e74 6961 6c28 290d 0a20 2020 2020 2020  ntial()..       
+000198b0: 2020 2020 206f 6666 7365 7420 3d20 300d       offset = 0.
+000198c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000198d0: 205f 2069 6e20 7261 6e67 6528 6f74 6865   _ in range(othe
+000198e0: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+000198f0: 2020 2020 2066 6f72 206d 6f64 756c 6520       for module 
+00019900: 696e 2073 656c 663a 0d0a 2020 2020 2020  in self:..      
+00019910: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00019920: 6d62 696e 6564 2e61 6464 5f6d 6f64 756c  mbined.add_modul
+00019930: 6528 7374 7228 6f66 6673 6574 292c 206d  e(str(offset), m
+00019940: 6f64 756c 6529 0d0a 2020 2020 2020 2020  odule)..        
+00019950: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
+00019960: 6574 202b 3d20 310d 0a20 2020 2020 2020  et += 1..       
+00019970: 2020 2020 2072 6574 7572 6e20 636f 6d62       return comb
+00019980: 696e 6564 0d0a 0d0a 2020 2020 6465 6620  ined....    def 
+00019990: 5f5f 726d 756c 5f5f 2873 656c 662c 206f  __rmul__(self, o
+000199a0: 7468 6572 3a20 696e 7429 202d 3e20 2753  ther: int) -> 'S
+000199b0: 6571 7565 6e74 6961 6c27 3a0d 0a20 2020  equential':..   
+000199c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000199d0: 2e5f 5f6d 756c 5f5f 286f 7468 6572 290d  .__mul__(other).
+000199e0: 0a0d 0a20 2020 2064 6566 205f 5f69 6d75  ...    def __imu
+000199f0: 6c5f 5f28 7365 6c66 2c20 6f74 6865 723a  l__(self, other:
+00019a00: 2069 6e74 2920 2d3e 2027 5365 7175 656e   int) -> 'Sequen
+00019a10: 7469 616c 273a 0d0a 2020 2020 2020 2020  tial':..        
+00019a20: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00019a30: 6528 6f74 6865 722c 2069 6e74 293a 0d0a  e(other, int):..
+00019a40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00019a50: 6520 5479 7065 4572 726f 7228 6622 756e  e TypeError(f"un
+00019a60: 7375 7070 6f72 7465 6420 6f70 6572 616e  supported operan
+00019a70: 6420 7479 7065 2873 2920 666f 7220 2a3a  d type(s) for *:
+00019a80: 207b 7479 7065 2873 656c 6629 7d20 616e   {type(self)} an
+00019a90: 6420 7b74 7970 6528 6f74 6865 7229 7d22  d {type(other)}"
+00019aa0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+00019ab0: 286f 7468 6572 203c 3d20 3029 3a0d 0a20  (other <= 0):.. 
+00019ac0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00019ad0: 2056 616c 7565 4572 726f 7228 6622 4e6f   ValueError(f"No
+00019ae0: 6e2d 706f 7369 7469 7665 206d 756c 7469  n-positive multi
+00019af0: 706c 6963 6174 696f 6e20 6661 6374 6f72  plication factor
+00019b00: 207b 6f74 6865 727d 2066 6f72 207b 7479   {other} for {ty
+00019b10: 7065 2873 656c 6629 7d22 290d 0a20 2020  pe(self)}")..   
+00019b20: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00019b30: 2020 2020 2020 2020 6c65 6e5f 6f72 6967          len_orig
+00019b40: 696e 616c 203d 206c 656e 2873 656c 6629  inal = len(self)
+00019b50: 0d0a 2020 2020 2020 2020 2020 2020 6f66  ..            of
+00019b60: 6673 6574 203d 206c 656e 2873 656c 6629  fset = len(self)
+00019b70: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00019b80: 7220 5f20 696e 2072 616e 6765 286f 7468  r _ in range(oth
+00019b90: 6572 202d 2031 293a 0d0a 2020 2020 2020  er - 1):..      
+00019ba0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00019bb0: 696e 2072 616e 6765 286c 656e 5f6f 7269  in range(len_ori
+00019bc0: 6769 6e61 6c29 3a0d 0a20 2020 2020 2020  ginal):..       
+00019bd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00019be0: 662e 6164 645f 6d6f 6475 6c65 2873 7472  f.add_module(str
+00019bf0: 2869 202b 206f 6666 7365 7429 2c20 7365  (i + offset), se
+00019c00: 6c66 2e5f 6d6f 6475 6c65 735b 7374 7228  lf._modules[str(
+00019c10: 6929 5d29 0d0a 2020 2020 2020 2020 2020  i)])..          
+00019c20: 2020 2020 2020 6f66 6673 6574 202b 3d20        offset += 
+00019c30: 6c65 6e5f 6f72 6967 696e 616c 0d0a 2020  len_original..  
+00019c40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00019c50: 2073 656c 660d 0a0d 0a0d 0a20 2020 2064   self......    d
+00019c60: 6566 205f 5f64 6972 5f5f 2873 656c 6629  ef __dir__(self)
+00019c70: 3a0d 0a20 2020 2020 2020 206b 6579 7320  :..        keys 
+00019c80: 3d20 7375 7065 7228 5365 7175 656e 7469  = super(Sequenti
+00019c90: 616c 2c20 7365 6c66 292e 5f5f 6469 725f  al, self).__dir_
+00019ca0: 5f28 290d 0a20 2020 2020 2020 206b 6579  _()..        key
+00019cb0: 7320 3d20 5b6b 6579 2066 6f72 206b 6579  s = [key for key
+00019cc0: 2069 6e20 6b65 7973 2069 6620 6e6f 7420   in keys if not 
+00019cd0: 6b65 792e 6973 6469 6769 7428 295d 0d0a  key.isdigit()]..
+00019ce0: 2020 2020 2020 2020 7265 7475 726e 206b          return k
+00019cf0: 6579 730d 0a0d 0a0d 0a0d 0a0d 0a0d 0a20  eys............ 
+00019d00: 2020 2064 6566 205f 5f69 7465 725f 5f28     def __iter__(
+00019d10: 7365 6c66 2920 2d3e 2049 7465 7261 746f  self) -> Iterato
+00019d20: 725b 7466 2e4d 6f64 756c 655d 3a0d 0a20  r[tf.Module]:.. 
+00019d30: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
+00019d40: 6572 2873 656c 662e 5f6d 6f64 756c 6573  er(self._modules
+00019d50: 2e76 616c 7565 7328 2929 0d0a 0d0a 0d0a  .values())......
+00019d60: 2020 2020 2320 4e42 3a20 5765 2063 616e      # NB: We can
+00019d70: 2774 2072 6561 6c6c 7920 7479 7065 2063  't really type c
+00019d80: 6865 636b 2074 6869 7320 6675 6e63 7469  heck this functi
+00019d90: 6f6e 2061 7320 7468 6520 7479 7065 206f  on as the type o
+00019da0: 6620 696e 7075 740d 0a20 2020 2023 206d  f input..    # m
+00019db0: 6179 2063 6861 6e67 6520 6479 6e61 6d69  ay change dynami
+00019dc0: 6361 6c6c 7920 2861 7320 6973 2074 6573  cally (as is tes
+00019dd0: 7465 6420 696e 0d0a 2020 2020 2320 5465  ted in..    # Te
+00019de0: 7374 5363 7269 7074 2e74 6573 745f 7365  stScript.test_se
+00019df0: 7175 656e 7469 616c 5f69 6e74 6572 6d65  quential_interme
+00019e00: 6469 6172 795f 7479 7065 7329 2e20 2043  diary_types).  C
+00019e10: 616e 6e6f 7420 616e 6e6f 7461 7465 0d0a  annot annotate..
+00019e20: 2020 2020 2320 7769 7468 2041 6e79 2061      # with Any a
+00019e30: 7320 546f 7263 6853 6372 6970 7420 6578  s TorchScript ex
+00019e40: 7065 6374 7320 6120 6d6f 7265 2070 7265  pects a more pre
+00019e50: 6369 7365 2074 7970 650d 0a20 2020 2023  cise type..    #
+00019e60: 2064 6566 2066 6f72 7761 7264 2873 656c   def forward(sel
+00019e70: 662c 2069 6e70 7574 293a 0d0a 2020 2020  f, input):..    
+00019e80: 2320 2020 2020 666f 7220 6d6f 6475 6c65  #     for module
+00019e90: 2069 6e20 7365 6c66 3a0d 0a20 2020 2023   in self:..    #
+00019ea0: 2020 2020 2020 2020 2069 6e70 7574 203d           input =
+00019eb0: 206d 6f64 756c 6528 696e 7075 7429 0d0a   module(input)..
+00019ec0: 2020 2020 2320 2020 2020 7265 7475 726e      #     return
+00019ed0: 2069 6e70 7574 0d0a 0d0a 2020 2020 6465   input....    de
+00019ee0: 6620 666f 7277 6172 6428 7365 6c66 2c20  f forward(self, 
+00019ef0: 2a78 2c20 2a2a 6b77 6172 6773 293a 0d0a  *x, **kwargs):..
+00019f00: 2020 2020 2020 2020 7820 3d20 756e 7061          x = unpa
+00019f10: 636b 5f73 696e 676c 6574 6f6e 2878 290d  ck_singleton(x).
+00019f20: 0a20 2020 2020 2020 2066 6f72 206d 6f64  .        for mod
+00019f30: 756c 6520 696e 2073 656c 662e 5f6d 6f64  ule in self._mod
+00019f40: 756c 6573 2e76 616c 7565 7328 293a 0d0a  ules.values():..
+00019f50: 2020 2020 2020 2020 2020 2020 2320 7820              # x 
+00019f60: 3d20 656e 666f 7263 655f 7369 6e67 6c65  = enforce_single
+00019f70: 746f 6e28 7829 0d0a 2020 2020 2020 2020  ton(x)..        
+00019f80: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00019f90: 6528 782c 2074 7570 6c65 293a 0d0a 2020  e(x, tuple):..  
+00019fa0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00019fb0: 206c 656e 286d 6f64 756c 652e 7369 676e   len(module.sign
+00019fc0: 6174 7572 652e 696e 7075 7473 2920 3d3d  ature.inputs) ==
+00019fd0: 206c 656e 2878 293a 2020 2320 7365 6c66   len(x):  # self
+00019fe0: 2c78 0d0a 2020 2020 2020 2020 2020 2020  ,x..            
+00019ff0: 2020 2020 2020 2020 7820 3d20 6d6f 6475          x = modu
+0001a000: 6c65 282a 782c 202a 2a6b 7761 7267 7329  le(*x, **kwargs)
+0001a010: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a020: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0001a030: 2020 2020 2020 2020 2020 2020 2078 203d               x =
+0001a040: 2065 6e66 6f72 6365 5f73 696e 676c 6574   enforce_singlet
+0001a050: 6f6e 2878 290d 0a20 2020 2020 2020 2020  on(x)..         
+0001a060: 2020 2020 2020 2020 2020 2078 203d 206d             x = m
+0001a070: 6f64 756c 6528 782c 202a 2a6b 7761 7267  odule(x, **kwarg
+0001a080: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0001a090: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0001a0a0: 2020 2020 2020 2078 203d 206d 6f64 756c         x = modul
+0001a0b0: 6528 782c 202a 2a6b 7761 7267 7329 0d0a  e(x, **kwargs)..
+0001a0c0: 2020 2020 2020 2020 2020 2020 2320 636c              # cl
+0001a0d0: 6173 735f 6e61 6d65 3d6d 6f64 756c 652e  ass_name=module.
+0001a0e0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001a0f0: 5f5f 2e6c 6f77 6572 2829 0d0a 2020 2020  __.lower()..    
+0001a100: 2020 2020 2020 2020 2320 6966 2027 6c73          # if 'ls
+0001a110: 746d 2720 696e 2063 6c61 7373 5f6e 616d  tm' in class_nam
+0001a120: 6520 6f72 2027 6772 7527 2069 6e20 636c  e or 'gru' in cl
+0001a130: 6173 735f 6e61 6d65 3a0d 0a20 2020 2020  ass_name:..     
+0001a140: 2020 2020 2020 2023 2020 2020 2069 6620         #     if 
+0001a150: 6973 696e 7374 616e 6365 2878 2c74 7570  isinstance(x,tup
+0001a160: 6c65 293a 0d0a 2020 2020 2020 2020 2020  le):..          
+0001a170: 2020 2320 2020 2020 2020 2020 782c 6878    #         x,hx
+0001a180: 3d78 0d0a 2020 2020 2020 2020 2020 2020  =x..            
+0001a190: 2320 2020 2020 2020 2020 6b77 6172 6773  #         kwargs
+0001a1a0: 5b27 6878 275d 3d68 780d 0a0d 0a20 2020  ['hx']=hx....   
+0001a1b0: 2020 2020 2072 6574 7572 6e20 780d 0a0d       return x...
+0001a1c0: 0a0d 0a20 2020 2064 6566 2061 7070 656e  ...    def appen
+0001a1d0: 6428 7365 6c66 2c20 6d6f 6475 6c65 3a20  d(self, module: 
+0001a1e0: 7466 2e4d 6f64 756c 6529 202d 3e20 2753  tf.Module) -> 'S
+0001a1f0: 6571 7565 6e74 6961 6c27 3a0d 0a20 2020  equential':..   
+0001a200: 2020 2020 2072 2222 2241 7070 656e 6473       r"""Appends
+0001a210: 2061 2067 6976 656e 206d 6f64 756c 6520   a given module 
+0001a220: 746f 2074 6865 2065 6e64 2e0d 0a0d 0a20  to the end..... 
+0001a230: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
+0001a240: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+0001a250: 2028 7466 2e4d 6f64 756c 6529 3a20 6d6f   (tf.Module): mo
+0001a260: 6475 6c65 2074 6f20 6170 7065 6e64 0d0a  dule to append..
+0001a270: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0001a280: 2020 2020 2073 656c 662e 6164 645f 6d6f       self.add_mo
+0001a290: 6475 6c65 2873 7472 286c 656e 2873 656c  dule(str(len(sel
+0001a2a0: 6629 292c 206d 6f64 756c 6529 0d0a 2020  f)), module)..  
+0001a2b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001a2c0: 660d 0a0d 0a20 2020 2064 6566 2069 6e73  f....    def ins
+0001a2d0: 6572 7428 7365 6c66 2c20 696e 6465 783a  ert(self, index:
+0001a2e0: 2069 6e74 2c20 6d6f 6475 6c65 3a20 7466   int, module: tf
+0001a2f0: 2e4d 6f64 756c 6529 202d 3e20 2753 6571  .Module) -> 'Seq
+0001a300: 7565 6e74 6961 6c27 3a0d 0a20 2020 2020  uential':..     
+0001a310: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0001a320: 616e 6365 286d 6f64 756c 652c 204d 6f64  ance(module, Mod
+0001a330: 756c 6529 3a0d 0a20 2020 2020 2020 2020  ule):..         
+0001a340: 2020 2072 6169 7365 2041 7373 6572 7469     raise Asserti
+0001a350: 6f6e 4572 726f 7228 0d0a 2020 2020 2020  onError(..      
+0001a360: 2020 2020 2020 2020 2020 276d 6f64 756c            'modul
+0001a370: 6520 7368 6f75 6c64 2062 6520 6f66 2074  e should be of t
+0001a380: 7970 653a 207b 7d27 2e66 6f72 6d61 7428  ype: {}'.format(
+0001a390: 4d6f 6475 6c65 2929 0d0a 2020 2020 2020  Module))..      
+0001a3a0: 2020 6e20 3d20 6c65 6e28 7365 6c66 2e5f    n = len(self._
+0001a3b0: 6d6f 6475 6c65 7329 0d0a 2020 2020 2020  modules)..      
+0001a3c0: 2020 6966 206e 6f74 2028 2d6e 203c 3d20    if not (-n <= 
+0001a3d0: 696e 6465 7820 3c3d 206e 293a 0d0a 2020  index <= n):..  
+0001a3e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001a3f0: 496e 6465 7845 7272 6f72 280d 0a20 2020  IndexError(..   
+0001a400: 2020 2020 2020 2020 2020 2020 2027 496e               'In
+0001a410: 6465 7820 6f75 7420 6f66 2072 616e 6765  dex out of range
+0001a420: 3a20 7b7d 272e 666f 726d 6174 2869 6e64  : {}'.format(ind
+0001a430: 6578 2929 0d0a 2020 2020 2020 2020 6966  ex))..        if
+0001a440: 2069 6e64 6578 203c 2030 3a0d 0a20 2020   index < 0:..   
+0001a450: 2020 2020 2020 2020 2069 6e64 6578 202b           index +
+0001a460: 3d20 6e0d 0a20 2020 2020 2020 2066 6f72  = n..        for
+0001a470: 2069 2069 6e20 7261 6e67 6528 6e2c 2069   i in range(n, i
+0001a480: 6e64 6578 2c20 2d31 293a 0d0a 2020 2020  ndex, -1):..    
+0001a490: 2020 2020 2020 2020 7365 6c66 2e5f 6d6f          self._mo
+0001a4a0: 6475 6c65 735b 7374 7228 6929 5d20 3d20  dules[str(i)] = 
+0001a4b0: 7365 6c66 2e5f 6d6f 6475 6c65 735b 7374  self._modules[st
+0001a4c0: 7228 6920 2d20 3129 5d0d 0a20 2020 2020  r(i - 1)]..     
+0001a4d0: 2020 2073 656c 662e 5f6d 6f64 756c 6573     self._modules
+0001a4e0: 5b73 7472 2869 6e64 6578 295d 203d 206d  [str(index)] = m
+0001a4f0: 6f64 756c 650d 0a20 2020 2020 2020 2072  odule..        r
+0001a500: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
+0001a510: 2020 6465 6620 6578 7465 6e64 2873 656c    def extend(sel
+0001a520: 662c 2073 6571 7565 6e74 6961 6c29 202d  f, sequential) -
+0001a530: 3e20 2753 6571 7565 6e74 6961 6c27 3a0d  > 'Sequential':.
+0001a540: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
+0001a550: 6572 2069 6e20 7365 7175 656e 7469 616c  er in sequential
+0001a560: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0001a570: 656c 662e 6170 7065 6e64 286c 6179 6572  elf.append(layer
+0001a580: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0001a590: 6e20 7365 6c66 0d0a 0d0a 0d0a 0d0a 0d0a  n self..........
+0001a5a0: 0d0a 636c 6173 7320 4d6f 6475 6c65 4c69  ..class ModuleLi
+0001a5b0: 7374 284c 6179 6572 293a 0d0a 2020 2020  st(Layer):..    
+0001a5c0: 2222 2248 6f6c 6473 2073 7562 6d6f 6475  """Holds submodu
+0001a5d0: 6c65 7320 696e 2061 206c 6973 742e 0d0a  les in a list...
+0001a5e0: 0d0a 2020 2020 3a63 6c61 7373 3a60 7e74  ..    :class:`~t
+0001a5f0: 7269 6465 6e74 2e62 6163 6b65 6e64 2e74  rident.backend.t
+0001a600: 656e 736f 7266 6c6f 775f 6261 636b 656e  ensorflow_backen
+0001a610: 642e 4d6f 6475 6c65 4c69 7374 6020 6361  d.ModuleList` ca
+0001a620: 6e20 6265 2069 6e64 6578 6564 206c 696b  n be indexed lik
+0001a630: 6520 6120 7265 6775 6c61 7220 5079 7468  e a regular Pyth
+0001a640: 6f6e 206c 6973 742c 2062 7574 0d0a 2020  on list, but..  
+0001a650: 2020 6d6f 6475 6c65 7320 6974 2063 6f6e    modules it con
+0001a660: 7461 696e 7320 6172 6520 7072 6f70 6572  tains are proper
+0001a670: 6c79 2072 6567 6973 7465 7265 642c 2061  ly registered, a
+0001a680: 6e64 2077 696c 6c20 6265 2076 6973 6962  nd will be visib
+0001a690: 6c65 2062 7920 616c 6c0d 0a20 2020 203a  le by all..    :
+0001a6a0: 636c 6173 733a 607e 7472 6964 656e 742e  class:`~trident.
+0001a6b0: 6261 636b 656e 642e 7465 6e73 6f72 666c  backend.tensorfl
+0001a6c0: 6f77 5f62 6163 6b65 6e64 2e2e 4c61 7965  ow_backend..Laye
+0001a6d0: 7260 206d 6574 686f 6473 2e0d 0a0d 0a20  r` methods..... 
+0001a6e0: 2020 2041 7267 756d 656e 7473 3a0d 0a20     Arguments:.. 
+0001a6f0: 2020 2020 2020 206d 6f64 756c 6573 2028         modules (
+0001a700: 6974 6572 6162 6c65 2c20 6f70 7469 6f6e  iterable, option
+0001a710: 616c 293a 2061 6e20 6974 6572 6162 6c65  al): an iterable
+0001a720: 206f 6620 6d6f 6475 6c65 7320 746f 2061   of modules to a
+0001a730: 6464 0d0a 0d0a 2020 2020 2222 220d 0a0d  dd....    """...
+0001a740: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+0001a750: 5f28 7365 6c66 2c20 6d6f 6475 6c65 733a  _(self, modules:
+0001a760: 204f 7074 696f 6e61 6c5b 4974 6572 6162   Optional[Iterab
+0001a770: 6c65 5b4c 6179 6572 5d5d 203d 204e 6f6e  le[Layer]] = Non
+0001a780: 652c 206e 616d 653d 4e6f 6e65 2c20 6b65  e, name=None, ke
+0001a790: 6570 5f6f 7574 7075 743d 4661 6c73 652c  ep_output=False,
+0001a7a0: 202a 2a6b 7761 7267 7329 202d 3e20 4e6f   **kwargs) -> No
+0001a7b0: 6e65 3a0d 0a20 2020 2020 2020 2073 7570  ne:..        sup
+0001a7c0: 6572 284d 6f64 756c 654c 6973 742c 2073  er(ModuleList, s
+0001a7d0: 656c 6629 2e5f 5f69 6e69 745f 5f28 6e61  elf).__init__(na
+0001a7e0: 6d65 3d4e 6f6e 652c 206b 6565 705f 6f75  me=None, keep_ou
+0001a7f0: 7470 7574 3d46 616c 7365 2c20 2a2a 6b77  tput=False, **kw
+0001a800: 6172 6773 290d 0a20 2020 2020 2020 206e  args)..        n
+0001a810: 616d 6520 3d20 7365 6c66 2e5f 6e61 6d65  ame = self._name
+0001a820: 0d0a 0d0a 2020 2020 2020 2020 7374 6172  ....        star
+0001a830: 745f 6964 7820 3d20 6c65 6e28 7365 6c66  t_idx = len(self
+0001a840: 2e5f 6d6f 6475 6c65 7329 0d0a 2020 2020  ._modules)..    
+0001a850: 2020 2020 666f 7220 6d6f 6475 6c65 2069      for module i
+0001a860: 6e20 6d6f 6475 6c65 733a 0d0a 2020 2020  n modules:..    
+0001a870: 2020 2020 2020 2020 6d6f 6475 6c65 2e69          module.i
+0001a880: 735f 726f 6f74 203d 2046 616c 7365 0d0a  s_root = False..
+0001a890: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+0001a8a0: 6f64 756c 652e 7575 6964 2021 3d20 7365  odule.uuid != se
+0001a8b0: 6c66 2e75 7569 643a 0d0a 2020 2020 2020  lf.uuid:..      
+0001a8c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0001a8d0: 6464 5f6d 6f64 756c 6528 7374 7228 7374  dd_module(str(st
+0001a8e0: 6172 745f 6964 7829 2c20 6d6f 6475 6c65  art_idx), module
+0001a8f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001a900: 2020 2072 6573 6574 5f6e 616d 6528 6d6f     reset_name(mo
+0001a910: 6475 6c65 2c20 7365 6c66 2e5f 7569 645f  dule, self._uid_
+0001a920: 7072 6566 6978 7329 0d0a 2020 2020 2020  prefixs)..      
+0001a930: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+0001a940: 2e72 656c 6174 6976 655f 6e61 6d65 203d  .relative_name =
+0001a950: 206e 616d 6520 6966 206e 6f74 2068 6173   name if not has
+0001a960: 6174 7472 286d 6f64 756c 652c 0d0a 2020  attr(module,..  
+0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9a0: 2020 2020 2020 2020 2027 7265 6c61 7469           'relati
+0001a9b0: 7665 5f6e 616d 6527 2920 6f72 206d 6f64  ve_name') or mod
+0001a9c0: 756c 652e 7265 6c61 7469 7665 5f6e 616d  ule.relative_nam
+0001a9d0: 6520 3d3d 2027 2720 656c 7365 206e 616d  e == '' else nam
+0001a9e0: 6520 2b20 272e 2720 2b20 6d6f 6475 6c65  e + '.' + module
+0001a9f0: 2e72 656c 6174 6976 655f 6e61 6d65 0d0a  .relative_name..
+0001aa00: 0d0a 2020 2020 6465 6620 5f67 6574 5f61  ..    def _get_a
+0001aa10: 6273 5f73 7472 696e 675f 696e 6465 7828  bs_string_index(
+0001aa20: 7365 6c66 2c20 6964 7829 3a0d 0a20 2020  self, idx):..   
+0001aa30: 2020 2020 2022 2222 4765 7420 7468 6520       """Get the 
+0001aa40: 6162 736f 6c75 7465 2069 6e64 6578 2066  absolute index f
+0001aa50: 6f72 2074 6865 206c 6973 7420 6f66 206d  or the list of m
+0001aa60: 6f64 756c 6573 2222 220d 0a20 2020 2020  odules"""..     
+0001aa70: 2020 2069 6478 203d 206f 7065 7261 746f     idx = operato
+0001aa80: 722e 696e 6465 7828 6964 7829 0d0a 2020  r.index(idx)..  
+0001aa90: 2020 2020 2020 6966 206e 6f74 2028 2d6c        if not (-l
+0001aaa0: 656e 2873 656c 6629 203c 3d20 6964 7820  en(self) <= idx 
+0001aab0: 3c20 6c65 6e28 7365 6c66 2929 3a0d 0a20  < len(self)):.. 
+0001aac0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001aad0: 2049 6e64 6578 4572 726f 7228 2769 6e64   IndexError('ind
+0001aae0: 6578 207b 7d20 6973 206f 7574 206f 6620  ex {} is out of 
+0001aaf0: 7261 6e67 6527 2e66 6f72 6d61 7428 6964  range'.format(id
+0001ab00: 7829 290d 0a20 2020 2020 2020 2069 6620  x))..        if 
+0001ab10: 6964 7820 3c20 303a 0d0a 2020 2020 2020  idx < 0:..      
+0001ab20: 2020 2020 2020 6964 7820 2b3d 206c 656e        idx += len
+0001ab30: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+0001ab40: 7265 7475 726e 2073 7472 2869 6478 290d  return str(idx).
+0001ab50: 0a0d 0a0d 0a20 2020 2064 6566 205f 5f67  .....    def __g
+0001ab60: 6574 6974 656d 5f5f 2873 656c 662c 2069  etitem__(self, i
+0001ab70: 6478 3a20 696e 7429 202d 3e20 4c61 7965  dx: int) -> Laye
+0001ab80: 723a 0d0a 2020 2020 2020 2020 6966 2069  r:..        if i
+0001ab90: 7369 6e73 7461 6e63 6528 6964 782c 2073  sinstance(idx, s
+0001aba0: 6c69 6365 293a 0d0a 2020 2020 2020 2020  lice):..        
+0001abb0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001abc0: 5f5f 636c 6173 735f 5f28 6c69 7374 2873  __class__(list(s
+0001abd0: 656c 662e 5f6d 6f64 756c 6573 2e76 616c  elf._modules.val
+0001abe0: 7565 7328 2929 5b69 6478 5d29 0d0a 2020  ues())[idx])..  
+0001abf0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0001ac00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ac10: 7365 6c66 2e5f 6d6f 6475 6c65 735b 7365  self._modules[se
+0001ac20: 6c66 2e5f 6765 745f 6162 735f 7374 7269  lf._get_abs_stri
+0001ac30: 6e67 5f69 6e64 6578 2869 6478 295d 0d0a  ng_index(idx)]..
+0001ac40: 0d0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
+0001ac50: 7465 6d5f 5f28 7365 6c66 2c20 6964 783a  tem__(self, idx:
+0001ac60: 2069 6e74 2c20 6d6f 6475 6c65 3a20 4c61   int, module: La
+0001ac70: 7965 7229 202d 3e20 4e6f 6e65 3a0d 0a20  yer) -> None:.. 
+0001ac80: 2020 2020 2020 2069 6478 203d 2073 656c         idx = sel
+0001ac90: 662e 5f67 6574 5f61 6273 5f73 7472 696e  f._get_abs_strin
+0001aca0: 675f 696e 6465 7828 6964 7829 0d0a 2020  g_index(idx)..  
+0001acb0: 2020 2020 2020 7265 7475 726e 2073 6574        return set
+0001acc0: 6174 7472 2873 656c 662c 2073 7472 2869  attr(self, str(i
+0001acd0: 6478 292c 206d 6f64 756c 6529 0d0a 0d0a  dx), module)....
+0001ace0: 2020 2020 6465 6620 5f5f 6465 6c69 7465      def __delite
+0001acf0: 6d5f 5f28 7365 6c66 2c20 6964 783a 2055  m__(self, idx: U
+0001ad00: 6e69 6f6e 5b69 6e74 2c20 736c 6963 655d  nion[int, slice]
+0001ad10: 2920 2d3e 204e 6f6e 653a 0d0a 2020 2020  ) -> None:..    
+0001ad20: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001ad30: 6528 6964 782c 2073 6c69 6365 293a 0d0a  e(idx, slice):..
+0001ad40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001ad50: 6b20 696e 2072 616e 6765 286c 656e 2873  k in range(len(s
+0001ad60: 656c 662e 5f6d 6f64 756c 6573 2929 5b69  elf._modules))[i
+0001ad70: 6478 5d3a 0d0a 2020 2020 2020 2020 2020  dx]:..          
+0001ad80: 2020 2020 2020 6465 6c61 7474 7228 7365        delattr(se
+0001ad90: 6c66 2c20 7374 7228 6b29 290d 0a20 2020  lf, str(k))..   
+0001ada0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0001adb0: 2020 2020 2020 2020 6465 6c61 7474 7228          delattr(
+0001adc0: 7365 6c66 2c20 7365 6c66 2e5f 6765 745f  self, self._get_
+0001add0: 6162 735f 7374 7269 6e67 5f69 6e64 6578  abs_string_index
+0001ade0: 2869 6478 2929 0d0a 2020 2020 2020 2020  (idx))..        
+0001adf0: 2320 546f 2070 7265 7365 7276 6520 6e75  # To preserve nu
+0001ae00: 6d62 6572 696e 672c 2073 656c 662e 5f6d  mbering, self._m
+0001ae10: 6f64 756c 6573 2069 7320 6265 696e 6720  odules is being 
+0001ae20: 7265 636f 6e73 7472 7563 7465 6420 7769  reconstructed wi
+0001ae30: 7468 206d 6f64 756c 6573 2061 6674 6572  th modules after
+0001ae40: 2064 656c 6574 696f 6e0d 0a20 2020 2020   deletion..     
+0001ae50: 2020 2073 7472 5f69 6e64 6963 6573 203d     str_indices =
+0001ae60: 205b 7374 7228 6929 2066 6f72 2069 2069   [str(i) for i i
+0001ae70: 6e20 7261 6e67 6528 6c65 6e28 7365 6c66  n range(len(self
+0001ae80: 2e5f 6d6f 6475 6c65 7329 295d 0d0a 2020  ._modules))]..  
+0001ae90: 2020 2020 2020 7365 6c66 2e5f 6d6f 6475        self._modu
+0001aea0: 6c65 7320 3d20 4f72 6465 7265 6444 6963  les = OrderedDic
+0001aeb0: 7428 6c69 7374 287a 6970 2873 7472 5f69  t(list(zip(str_i
+0001aec0: 6e64 6963 6573 2c20 7365 6c66 2e5f 6d6f  ndices, self._mo
+0001aed0: 6475 6c65 732e 7661 6c75 6573 2829 2929  dules.values()))
+0001aee0: 290d 0a0d 0a0d 0a20 2020 2064 6566 205f  )......    def _
+0001aef0: 5f6c 656e 5f5f 2873 656c 6629 202d 3e20  _len__(self) -> 
+0001af00: 696e 743a 0d0a 2020 2020 2020 2020 7265  int:..        re
+0001af10: 7475 726e 206c 656e 2873 656c 662e 5f6d  turn len(self._m
+0001af20: 6f64 756c 6573 290d 0a0d 0a0d 0a20 2020  odules)......   
+0001af30: 2064 6566 205f 5f69 7465 725f 5f28 7365   def __iter__(se
+0001af40: 6c66 2920 2d3e 2074 7970 696e 672e 4974  lf) -> typing.It
+0001af50: 6572 6174 6f72 5b4c 6179 6572 5d3a 0d0a  erator[Layer]:..
+0001af60: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+0001af70: 7465 7228 7365 6c66 2e5f 6d6f 6475 6c65  ter(self._module
+0001af80: 732e 7661 6c75 6573 2829 290d 0a0d 0a20  s.values()).... 
+0001af90: 2020 2064 6566 205f 5f69 6164 645f 5f28     def __iadd__(
+0001afa0: 7365 6c66 3a20 542c 206d 6f64 756c 6573  self: T, modules
+0001afb0: 3a20 4974 6572 6162 6c65 5b4c 6179 6572  : Iterable[Layer
+0001afc0: 5d29 202d 3e20 543a 0d0a 2020 2020 2020  ]) -> T:..      
+0001afd0: 2020 7265 7475 726e 2073 656c 662e 6578    return self.ex
+0001afe0: 7465 6e64 286d 6f64 756c 6573 290d 0a0d  tend(modules)...
+0001aff0: 0a0d 0a20 2020 2064 6566 205f 5f64 6972  ...    def __dir
+0001b000: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+0001b010: 2020 206b 6579 7320 3d20 7375 7065 7228     keys = super(
+0001b020: 4d6f 6475 6c65 4c69 7374 2c20 7365 6c66  ModuleList, self
+0001b030: 292e 5f5f 6469 725f 5f28 290d 0a20 2020  ).__dir__()..   
+0001b040: 2020 2020 206b 6579 7320 3d20 5b6b 6579       keys = [key
+0001b050: 2066 6f72 206b 6579 2069 6e20 6b65 7973   for key in keys
+0001b060: 2069 6620 6e6f 7420 6b65 792e 6973 6469   if not key.isdi
+0001b070: 6769 7428 295d 0d0a 2020 2020 2020 2020  git()]..        
+0001b080: 7265 7475 726e 206b 6579 730d 0a0d 0a20  return keys.... 
+0001b090: 2020 2064 6566 2069 6e73 6572 7428 7365     def insert(se
+0001b0a0: 6c66 2c20 696e 6465 783a 2069 6e74 2c20  lf, index: int, 
+0001b0b0: 6d6f 6475 6c65 3a20 4c61 7965 7229 202d  module: Layer) -
+0001b0c0: 3e20 4e6f 6e65 3a0d 0a20 2020 2020 2020  > None:..       
+0001b0d0: 2072 2222 2249 6e73 6572 7420 6120 6769   r"""Insert a gi
+0001b0e0: 7665 6e20 6d6f 6475 6c65 2062 6566 6f72  ven module befor
+0001b0f0: 6520 6120 6769 7665 6e20 696e 6465 7820  e a given index 
+0001b100: 696e 2074 6865 206c 6973 742e 0d0a 0d0a  in the list.....
+0001b110: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+0001b120: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0001b130: 696e 6465 7820 2869 6e74 293a 2069 6e64  index (int): ind
+0001b140: 6578 2074 6f20 696e 7365 7274 2e0d 0a20  ex to insert... 
+0001b150: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+0001b160: 6520 2874 662e 4d6f 6475 6c65 293a 206d  e (tf.Module): m
+0001b170: 6f64 756c 6520 746f 2069 6e73 6572 740d  odule to insert.
+0001b180: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0001b190: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+0001b1a0: 616e 6765 286c 656e 2873 656c 662e 5f6d  ange(len(self._m
+0001b1b0: 6f64 756c 6573 292c 2069 6e64 6578 2c20  odules), index, 
+0001b1c0: 2d31 293a 0d0a 2020 2020 2020 2020 2020  -1):..          
+0001b1d0: 2020 7365 6c66 2e5f 6d6f 6475 6c65 735b    self._modules[
+0001b1e0: 7374 7228 6929 5d20 3d20 7365 6c66 2e5f  str(i)] = self._
+0001b1f0: 6d6f 6475 6c65 735b 7374 7228 6920 2d20  modules[str(i - 
+0001b200: 3129 5d0d 0a20 2020 2020 2020 2073 656c  1)]..        sel
+0001b210: 662e 5f6d 6f64 756c 6573 5b73 7472 2869  f._modules[str(i
+0001b220: 6e64 6578 295d 203d 206d 6f64 756c 650d  ndex)] = module.
+0001b230: 0a0d 0a20 2020 2064 6566 2061 7070 656e  ...    def appen
+0001b240: 6428 7365 6c66 3a20 542c 206d 6f64 756c  d(self: T, modul
+0001b250: 653a 204c 6179 6572 2920 2d3e 2054 3a0d  e: Layer) -> T:.
+0001b260: 0a20 2020 2020 2020 2072 2222 2241 7070  .        r"""App
+0001b270: 656e 6473 2061 2067 6976 656e 206d 6f64  ends a given mod
+0001b280: 756c 6520 746f 2074 6865 2065 6e64 206f  ule to the end o
+0001b290: 6620 7468 6520 6c69 7374 2e0d 0a0d 0a20  f the list..... 
+0001b2a0: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
+0001b2b0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+0001b2c0: 6f64 756c 6520 2874 662e 4d6f 6475 6c65  odule (tf.Module
+0001b2d0: 293a 206d 6f64 756c 6520 746f 2061 7070  ): module to app
+0001b2e0: 656e 640d 0a20 2020 2020 2020 2022 2222  end..        """
+0001b2f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+0001b300: 6464 5f6d 6f64 756c 6528 7374 7228 6c65  dd_module(str(le
+0001b310: 6e28 7365 6c66 2929 2c20 6d6f 6475 6c65  n(self)), module
+0001b320: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0001b330: 6e20 7365 6c66 0d0a 0d0a 2020 2020 6465  n self....    de
+0001b340: 6620 6578 7465 6e64 2873 656c 663a 2054  f extend(self: T
+0001b350: 2c20 6d6f 6475 6c65 733a 2049 7465 7261  , modules: Itera
+0001b360: 626c 655b 4c61 7965 725d 2920 2d3e 2054  ble[Layer]) -> T
+0001b370: 3a0d 0a20 2020 2020 2020 2072 2222 2241  :..        r"""A
+0001b380: 7070 656e 6473 206d 6f64 756c 6573 2066  ppends modules f
+0001b390: 726f 6d20 6120 5079 7468 6f6e 2069 7465  rom a Python ite
+0001b3a0: 7261 626c 6520 746f 2074 6865 2065 6e64  rable to the end
+0001b3b0: 206f 6620 7468 6520 6c69 7374 2e0d 0a0d   of the list....
+0001b3c0: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
+0001b3d0: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+0001b3e0: 206d 6f64 756c 6573 2028 6974 6572 6162   modules (iterab
+0001b3f0: 6c65 293a 2069 7465 7261 626c 6520 6f66  le): iterable of
+0001b400: 206d 6f64 756c 6573 2074 6f20 6170 7065   modules to appe
+0001b410: 6e64 0d0a 2020 2020 2020 2020 2222 220d  nd..        """.
+0001b420: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001b430: 6973 696e 7374 616e 6365 286d 6f64 756c  isinstance(modul
+0001b440: 6573 2c20 6162 632e 4974 6572 6162 6c65  es, abc.Iterable
+0001b450: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001b460: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+0001b470: 224d 6f64 756c 654c 6973 742e 6578 7465  "ModuleList.exte
+0001b480: 6e64 2073 686f 756c 6420 6265 2063 616c  nd should be cal
+0001b490: 6c65 6420 7769 7468 2061 6e20 220d 0a20  led with an ".. 
+0001b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4b0: 2020 2020 2020 2020 2020 2022 6974 6572             "iter
+0001b4c0: 6162 6c65 2c20 6275 7420 676f 7420 2220  able, but got " 
+0001b4d0: 2b20 7479 7065 286d 6f64 756c 6573 292e  + type(modules).
+0001b4e0: 5f5f 6e61 6d65 5f5f 290d 0a20 2020 2020  __name__)..     
+0001b4f0: 2020 206f 6666 7365 7420 3d20 6c65 6e28     offset = len(
+0001b500: 7365 6c66 290d 0a20 2020 2020 2020 2066  self)..        f
+0001b510: 6f72 2069 2c20 6d6f 6475 6c65 2069 6e20  or i, module in 
+0001b520: 656e 756d 6572 6174 6528 6d6f 6475 6c65  enumerate(module
+0001b530: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+0001b540: 2073 656c 662e 6164 645f 6d6f 6475 6c65   self.add_module
+0001b550: 2873 7472 286f 6666 7365 7420 2b20 6929  (str(offset + i)
+0001b560: 2c20 6d6f 6475 6c65 290d 0a20 2020 2020  , module)..     
+0001b570: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+0001b580: 0d0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+0001b590: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
+0001b5a0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+0001b5b0: 6d65 6e74 6564 4572 726f 7228 290d 0a0d  mentedError()...
+0001b5c0: 0a0d 0a63 6c61 7373 204d 6f64 756c 6544  ...class ModuleD
+0001b5d0: 6963 7428 4c61 7965 7229 3a0d 0a20 2020  ict(Layer):..   
+0001b5e0: 2072 2222 2248 6f6c 6473 2073 7562 6d6f   r"""Holds submo
+0001b5f0: 6475 6c65 7320 696e 2061 2064 6963 7469  dules in a dicti
+0001b600: 6f6e 6172 792e 0d0a 0d0a 2020 2020 3a63  onary.....    :c
+0001b610: 6c61 7373 3a60 7e74 6f72 6368 2e74 662e  lass:`~torch.tf.
+0001b620: 4d6f 6475 6c65 4469 6374 6020 6361 6e20  ModuleDict` can 
+0001b630: 6265 2069 6e64 6578 6564 206c 696b 6520  be indexed like 
+0001b640: 6120 7265 6775 6c61 7220 5079 7468 6f6e  a regular Python
+0001b650: 2064 6963 7469 6f6e 6172 792c 0d0a 2020   dictionary,..  
+0001b660: 2020 6275 7420 6d6f 6475 6c65 7320 6974    but modules it
+0001b670: 2063 6f6e 7461 696e 7320 6172 6520 7072   contains are pr
+0001b680: 6f70 6572 6c79 2072 6567 6973 7465 7265  operly registere
+0001b690: 642c 2061 6e64 2077 696c 6c20 6265 2076  d, and will be v
+0001b6a0: 6973 6962 6c65 2062 7920 616c 6c0d 0a20  isible by all.. 
+0001b6b0: 2020 203a 636c 6173 733a 607e 746f 7263     :class:`~torc
+0001b6c0: 682e 7466 2e4d 6f64 756c 6560 206d 6574  h.tf.Module` met
+0001b6d0: 686f 6473 2e0d 0a0d 0a20 2020 203a 636c  hods.....    :cl
+0001b6e0: 6173 733a 607e 746f 7263 682e 7466 2e4d  ass:`~torch.tf.M
+0001b6f0: 6f64 756c 6544 6963 7460 2069 7320 616e  oduleDict` is an
+0001b700: 202a 2a6f 7264 6572 6564 2a2a 2064 6963   **ordered** dic
+0001b710: 7469 6f6e 6172 7920 7468 6174 2072 6573  tionary that res
+0001b720: 7065 6374 730d 0a0d 0a20 2020 202a 2074  pects....    * t
+0001b730: 6865 206f 7264 6572 206f 6620 696e 7365  he order of inse
+0001b740: 7274 696f 6e2c 2061 6e64 0d0a 0d0a 2020  rtion, and....  
+0001b750: 2020 2a20 696e 203a 6d65 7468 3a60 7e74    * in :meth:`~t
+0001b760: 6f72 6368 2e74 662e 4d6f 6475 6c65 4469  orch.tf.ModuleDi
+0001b770: 6374 2e75 7064 6174 6560 2c20 7468 6520  ct.update`, the 
+0001b780: 6f72 6465 7220 6f66 2074 6865 206d 6572  order of the mer
+0001b790: 6765 6420 6060 4f72 6465 7265 6444 6963  ged ``OrderedDic
+0001b7a0: 7460 600d 0a20 2020 2020 206f 7220 616e  t``..      or an
+0001b7b0: 6f74 6865 7220 3a63 6c61 7373 3a60 7e74  other :class:`~t
+0001b7c0: 6f72 6368 2e74 662e 4d6f 6475 6c65 4469  orch.tf.ModuleDi
+0001b7d0: 6374 6020 2874 6865 2061 7267 756d 656e  ct` (the argumen
+0001b7e0: 7420 746f 203a 6d65 7468 3a60 7e74 6f72  t to :meth:`~tor
+0001b7f0: 6368 2e74 662e 4d6f 6475 6c65 4469 6374  ch.tf.ModuleDict
+0001b800: 2e75 7064 6174 6560 292e 0d0a 0d0a 2020  .update`).....  
+0001b810: 2020 4e6f 7465 2074 6861 7420 3a6d 6574    Note that :met
+0001b820: 683a 607e 746f 7263 682e 7466 2e4d 6f64  h:`~torch.tf.Mod
+0001b830: 756c 6544 6963 742e 7570 6461 7465 6020  uleDict.update` 
+0001b840: 7769 7468 206f 7468 6572 2075 6e6f 7264  with other unord
+0001b850: 6572 6564 206d 6170 7069 6e67 0d0a 2020  ered mapping..  
+0001b860: 2020 7479 7065 7320 2865 2e67 2e2c 2050    types (e.g., P
+0001b870: 7974 686f 6e27 7320 706c 6169 6e20 6060  ython's plain ``
+0001b880: 6469 6374 6060 2920 646f 6573 206e 6f74  dict``) does not
+0001b890: 2070 7265 7365 7276 6520 7468 6520 6f72   preserve the or
+0001b8a0: 6465 7220 6f66 2074 6865 0d0a 2020 2020  der of the..    
+0001b8b0: 6d65 7267 6564 206d 6170 7069 6e67 2e0d  merged mapping..
+0001b8c0: 0a0d 0a20 2020 2041 7267 756d 656e 7473  ...    Arguments
+0001b8d0: 3a0d 0a20 2020 2020 2020 206d 6f64 756c  :..        modul
+0001b8e0: 6573 2028 6974 6572 6162 6c65 2c20 6f70  es (iterable, op
+0001b8f0: 7469 6f6e 616c 293a 2061 206d 6170 7069  tional): a mappi
+0001b900: 6e67 2028 6469 6374 696f 6e61 7279 2920  ng (dictionary) 
+0001b910: 6f66 2028 7374 7269 6e67 3a20 6d6f 6475  of (string: modu
+0001b920: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+0001b930: 206f 7220 616e 2069 7465 7261 626c 6520   or an iterable 
+0001b940: 6f66 206b 6579 2d76 616c 7565 2070 6169  of key-value pai
+0001b950: 7273 206f 6620 7479 7065 2028 7374 7269  rs of type (stri
+0001b960: 6e67 2c20 6d6f 6475 6c65 290d 0a0d 0a20  ng, module).... 
+0001b970: 2020 2045 7861 6d70 6c65 3a3a 0d0a 0d0a     Example::....
+0001b980: 2020 2020 2020 2020 636c 6173 7320 4d79          class My
+0001b990: 4d6f 6475 6c65 2874 662e 4d6f 6475 6c65  Module(tf.Module
+0001b9a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001b9b0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001b9c0: 6629 3a0d 0a20 2020 2020 2020 2020 2020  f):..           
+0001b9d0: 2020 2020 2073 7570 6572 284d 794d 6f64       super(MyMod
+0001b9e0: 756c 652c 2073 656c 6629 2e5f 5f69 6e69  ule, self).__ini
+0001b9f0: 745f 5f28 290d 0a20 2020 2020 2020 2020  t__()..         
+0001ba00: 2020 2020 2020 2073 656c 662e 6368 6f69         self.choi
+0001ba10: 6365 7320 3d20 7466 2e4d 6f64 756c 6544  ces = tf.ModuleD
+0001ba20: 6963 7428 7b0d 0a20 2020 2020 2020 2020  ict({..         
+0001ba30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001ba40: 636f 6e76 273a 206e 6e2e 436f 6e76 3264  conv': nn.Conv2d
+0001ba50: 2831 302c 2031 302c 2033 292c 0d0a 2020  (10, 10, 3),..  
+0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba70: 2020 2020 2020 2770 6f6f 6c27 3a20 6e6e        'pool': nn
+0001ba80: 2e4d 6178 506f 6f6c 3264 2833 290d 0a20  .MaxPool2d(3).. 
+0001ba90: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0001baa0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001bab0: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
+0001bac0: 6f6e 7320 3d20 7466 2e4d 6f64 756c 6544  ons = tf.ModuleD
+0001bad0: 6963 7428 5b0d 0a20 2020 2020 2020 2020  ict([..         
+0001bae0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0001baf0: 276c 7265 6c75 272c 206e 6e2e 4c65 616b  'lrelu', nn.Leak
+0001bb00: 7952 654c 5528 295d 2c0d 0a20 2020 2020  yReLU()],..     
+0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb20: 2020 205b 2770 7265 6c75 272c 206e 6e2e     ['prelu', nn.
+0001bb30: 5052 654c 5528 295d 0d0a 2020 2020 2020  PReLU()]..      
+0001bb40: 2020 2020 2020 2020 2020 5d29 0d0a 0d0a            ])....
+0001bb50: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0001bb60: 666f 7277 6172 6428 7365 6c66 2c20 782c  forward(self, x,
+0001bb70: 2063 686f 6963 652c 2061 6374 293a 0d0a   choice, act):..
+0001bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb90: 7820 3d20 7365 6c66 2e63 686f 6963 6573  x = self.choices
+0001bba0: 5b63 686f 6963 655d 2878 290d 0a20 2020  [choice](x)..   
+0001bbb0: 2020 2020 2020 2020 2020 2020 2078 203d               x =
+0001bbc0: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
+0001bbd0: 735b 6163 745d 2878 290d 0a20 2020 2020  s[act](x)..     
+0001bbe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001bbf0: 6e20 780d 0a20 2020 2022 2222 0d0a 0d0a  n x..    """....
+0001bc00: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0001bc10: 2873 656c 662c 206d 6f64 756c 6573 3a20  (self, modules: 
+0001bc20: 4f70 7469 6f6e 616c 5b4d 6170 7069 6e67  Optional[Mapping
+0001bc30: 5b73 7472 2c20 4c61 7965 725d 5d20 3d20  [str, Layer]] = 
+0001bc40: 4e6f 6e65 2c20 6e61 6d65 3d4e 6f6e 652c  None, name=None,
+0001bc50: 206b 6565 705f 6f75 7470 7574 3d46 616c   keep_output=Fal
+0001bc60: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+0001bc70: 2020 2020 2020 6973 5f6d 756c 7469 6361        is_multica
+0001bc80: 7374 696e 673d 4661 6c73 652c 202a 2a6b  sting=False, **k
+0001bc90: 7761 7267 7329 202d 3e20 4e6f 6e65 3a0d  wargs) -> None:.
+0001bca0: 0a20 2020 2020 2020 2073 7570 6572 284d  .        super(M
+0001bcb0: 6f64 756c 6544 6963 742c 2073 656c 6629  oduleDict, self)
+0001bcc0: 2e5f 5f69 6e69 745f 5f28 6e61 6d65 3d4e  .__init__(name=N
+0001bcd0: 6f6e 652c 206b 6565 705f 6f75 7470 7574  one, keep_output
+0001bce0: 3d46 616c 7365 2c20 2a2a 6b77 6172 6773  =False, **kwargs
+0001bcf0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001bd00: 6973 5f6d 756c 7469 6361 7374 696e 6720  is_multicasting 
+0001bd10: 3d20 6973 5f6d 756c 7469 6361 7374 696e  = is_multicastin
+0001bd20: 670d 0a20 2020 2020 2020 2069 6620 6d6f  g..        if mo
+0001bd30: 6475 6c65 7320 6973 206e 6f74 204e 6f6e  dules is not Non
+0001bd40: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0001bd50: 6966 206c 656e 286d 6f64 756c 6573 2920  if len(modules) 
+0001bd60: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+0001bd70: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+0001bd80: 6528 6d6f 6475 6c65 7329 0d0a 0d0a 0d0a  e(modules)......
+0001bd90: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+0001bda0: 6d5f 5f28 7365 6c66 2c20 6b65 793a 2073  m__(self, key: s
+0001bdb0: 7472 2920 2d3e 204c 6179 6572 3a0d 0a20  tr) -> Layer:.. 
+0001bdc0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001bdd0: 6c66 2e5f 6d6f 6475 6c65 735b 6b65 795d  lf._modules[key]
+0001bde0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7365  ....    def __se
+0001bdf0: 7469 7465 6d5f 5f28 7365 6c66 2c20 6b65  titem__(self, ke
+0001be00: 793a 2073 7472 2c20 6d6f 6475 6c65 3a20  y: str, module: 
+0001be10: 4c61 7965 7229 202d 3e20 4e6f 6e65 3a0d  Layer) -> None:.
+0001be20: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+0001be30: 645f 6d6f 6475 6c65 286b 6579 2c20 6d6f  d_module(key, mo
+0001be40: 6475 6c65 290d 0a20 2020 2020 2020 2069  dule)..        i
+0001be50: 6620 7365 6c66 2e5f 696e 7075 745f 7368  f self._input_sh
+0001be60: 6170 6520 6973 206e 6f74 204e 6f6e 653a  ape is not None:
+0001be70: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+0001be80: 6475 6c65 2e69 6e70 7574 5f73 6861 7065  dule.input_shape
+0001be90: 203d 2073 656c 662e 696e 7075 745f 7368   = self.input_sh
+0001bea0: 6170 650d 0a0d 0a20 2020 2064 6566 205f  ape....    def _
+0001beb0: 5f64 656c 6974 656d 5f5f 2873 656c 662c  _delitem__(self,
+0001bec0: 206b 6579 3a20 7374 7229 202d 3e20 4e6f   key: str) -> No
+0001bed0: 6e65 3a0d 0a20 2020 2020 2020 2064 656c  ne:..        del
+0001bee0: 2073 656c 662e 5f6d 6f64 756c 6573 5b6b   self._modules[k
+0001bef0: 6579 5d0d 0a0d 0a0d 0a20 2020 2064 6566  ey]......    def
+0001bf00: 205f 5f6c 656e 5f5f 2873 656c 6629 202d   __len__(self) -
+0001bf10: 3e20 696e 743a 0d0a 2020 2020 2020 2020  > int:..        
+0001bf20: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
+0001bf30: 5f6d 6f64 756c 6573 290d 0a0d 0a0d 0a20  _modules)...... 
+0001bf40: 2020 2064 6566 205f 5f69 7465 725f 5f28     def __iter__(
+0001bf50: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0001bf60: 7265 7475 726e 2069 7465 7228 7365 6c66  return iter(self
+0001bf70: 2e5f 6d6f 6475 6c65 7329 0d0a 0d0a 0d0a  ._modules)......
+0001bf80: 2020 2020 6465 6620 5f5f 636f 6e74 6169      def __contai
+0001bf90: 6e73 5f5f 2873 656c 662c 206b 6579 3a20  ns__(self, key: 
+0001bfa0: 7374 7229 202d 3e20 626f 6f6c 3a0d 0a20  str) -> bool:.. 
+0001bfb0: 2020 2020 2020 2072 6574 7572 6e20 6b65         return ke
+0001bfc0: 7920 696e 2073 656c 662e 5f6d 6f64 756c  y in self._modul
+0001bfd0: 6573 0d0a 0d0a 2020 2020 6465 6620 636c  es....    def cl
+0001bfe0: 6561 7228 7365 6c66 2920 2d3e 204e 6f6e  ear(self) -> Non
+0001bff0: 653a 0d0a 2020 2020 2020 2020 2222 2252  e:..        """R
+0001c000: 656d 6f76 6520 616c 6c20 6974 656d 7320  emove all items 
+0001c010: 6672 6f6d 2074 6865 204d 6f64 756c 6544  from the ModuleD
+0001c020: 6963 742e 0d0a 2020 2020 2020 2020 2222  ict...        ""
+0001c030: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+0001c040: 5f6d 6f64 756c 6573 2e63 6c65 6172 2829  _modules.clear()
+0001c050: 0d0a 0d0a 2020 2020 6465 6620 706f 7028  ....    def pop(
+0001c060: 7365 6c66 2c20 6b65 793a 2073 7472 2920  self, key: str) 
+0001c070: 2d3e 204c 6179 6572 3a0d 0a20 2020 2020  -> Layer:..     
+0001c080: 2020 2072 2222 2252 656d 6f76 6520 6b65     r"""Remove ke
+0001c090: 7920 6672 6f6d 2074 6865 204d 6f64 756c  y from the Modul
+0001c0a0: 6544 6963 7420 616e 6420 7265 7475 726e  eDict and return
+0001c0b0: 2069 7473 206d 6f64 756c 652e 0d0a 0d0a   its module.....
+0001c0c0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+0001c0d0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0001c0e0: 6b65 7920 2873 7472 696e 6729 3a20 6b65  key (string): ke
+0001c0f0: 7920 746f 2070 6f70 2066 726f 6d20 7468  y to pop from th
+0001c100: 6520 4d6f 6475 6c65 4469 6374 0d0a 2020  e ModuleDict..  
+0001c110: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0001c120: 2020 2076 203d 2073 656c 665b 6b65 795d     v = self[key]
+0001c130: 0d0a 2020 2020 2020 2020 6465 6c20 7365  ..        del se
+0001c140: 6c66 5b6b 6579 5d0d 0a20 2020 2020 2020  lf[key]..       
+0001c150: 2072 6574 7572 6e20 760d 0a0d 0a0d 0a20   return v...... 
+0001c160: 2020 2064 6566 206b 6579 7328 7365 6c66     def keys(self
+0001c170: 2920 2d3e 2049 7465 7261 626c 655b 7374  ) -> Iterable[st
+0001c180: 725d 3a0d 0a20 2020 2020 2020 2072 2222  r]:..        r""
+0001c190: 2252 6574 7572 6e20 616e 2069 7465 7261  "Return an itera
+0001c1a0: 626c 6520 6f66 2074 6865 204d 6f64 756c  ble of the Modul
+0001c1b0: 6544 6963 7420 6b65 7973 2e0d 0a20 2020  eDict keys...   
+0001c1c0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0001c1d0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001c1e0: 6f64 756c 6573 2e6b 6579 7328 290d 0a0d  odules.keys()...
+0001c1f0: 0a0d 0a20 2020 2064 6566 2069 7465 6d73  ...    def items
+0001c200: 2873 656c 6629 202d 3e20 4974 6572 6162  (self) -> Iterab
+0001c210: 6c65 5b54 7570 6c65 5b73 7472 2c20 4c61  le[Tuple[str, La
+0001c220: 7965 725d 5d3a 0d0a 2020 2020 2020 2020  yer]]:..        
+0001c230: 7222 2222 5265 7475 726e 2061 6e20 6974  r"""Return an it
+0001c240: 6572 6162 6c65 206f 6620 7468 6520 4d6f  erable of the Mo
+0001c250: 6475 6c65 4469 6374 206b 6579 2f76 616c  duleDict key/val
+0001c260: 7565 2070 6169 7273 2e0d 0a20 2020 2020  ue pairs...     
+0001c270: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0001c280: 7265 7475 726e 2073 656c 662e 5f6d 6f64  return self._mod
+0001c290: 756c 6573 2e69 7465 6d73 2829 0d0a 0d0a  ules.items()....
+0001c2a0: 0d0a 2020 2020 6465 6620 7661 6c75 6573  ..    def values
+0001c2b0: 2873 656c 6629 202d 3e20 4974 6572 6162  (self) -> Iterab
+0001c2c0: 6c65 5b4c 6179 6572 5d3a 0d0a 2020 2020  le[Layer]:..    
+0001c2d0: 2020 2020 7222 2222 5265 7475 726e 2061      r"""Return a
+0001c2e0: 6e20 6974 6572 6162 6c65 206f 6620 7468  n iterable of th
+0001c2f0: 6520 4d6f 6475 6c65 4469 6374 2076 616c  e ModuleDict val
+0001c300: 7565 732e 0d0a 2020 2020 2020 2020 2222  ues...        ""
+0001c310: 220d 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+0001c320: 6e20 7365 6c66 2e5f 6d6f 6475 6c65 732e  n self._modules.
+0001c330: 7661 6c75 6573 2829 0d0a 0d0a 2020 2020  values()....    
+0001c340: 6465 6620 7570 6461 7465 2873 656c 662c  def update(self,
+0001c350: 206d 6f64 756c 6573 3a20 4d61 7070 696e   modules: Mappin
+0001c360: 675b 7374 722c 204c 6179 6572 5d29 202d  g[str, Layer]) -
+0001c370: 3e20 4e6f 6e65 3a0d 0a20 2020 2020 2020  > None:..       
+0001c380: 2072 2222 2255 7064 6174 6520 7468 6520   r"""Update the 
+0001c390: 3a63 6c61 7373 3a60 7e74 6f72 6368 2e74  :class:`~torch.t
+0001c3a0: 662e 4d6f 6475 6c65 4469 6374 6020 7769  f.ModuleDict` wi
+0001c3b0: 7468 2074 6865 206b 6579 2d76 616c 7565  th the key-value
+0001c3c0: 2070 6169 7273 2066 726f 6d20 610d 0a20   pairs from a.. 
+0001c3d0: 2020 2020 2020 206d 6170 7069 6e67 206f         mapping o
+0001c3e0: 7220 616e 2069 7465 7261 626c 652c 206f  r an iterable, o
+0001c3f0: 7665 7277 7269 7469 6e67 2065 7869 7374  verwriting exist
+0001c400: 696e 6720 6b65 7973 2e0d 0a0d 0a20 2020  ing keys.....   
+0001c410: 2020 2020 202e 2e20 6e6f 7465 3a3a 0d0a       .. note::..
+0001c420: 2020 2020 2020 2020 2020 2020 4966 203a              If :
+0001c430: 6174 7472 3a60 6d6f 6475 6c65 7360 2069  attr:`modules` i
+0001c440: 7320 616e 2060 604f 7264 6572 6564 4469  s an ``OrderedDi
+0001c450: 6374 6060 2c20 6120 3a63 6c61 7373 3a60  ct``, a :class:`
+0001c460: 7e74 6f72 6368 2e74 662e 4d6f 6475 6c65  ~torch.tf.Module
+0001c470: 4469 6374 602c 206f 720d 0a20 2020 2020  Dict`, or..     
+0001c480: 2020 2020 2020 2061 6e20 6974 6572 6162         an iterab
+0001c490: 6c65 206f 6620 6b65 792d 7661 6c75 6520  le of key-value 
+0001c4a0: 7061 6972 732c 2074 6865 206f 7264 6572  pairs, the order
+0001c4b0: 206f 6620 6e65 7720 656c 656d 656e 7473   of new elements
+0001c4c0: 2069 6e20 6974 2069 7320 7072 6573 6572   in it is preser
+0001c4d0: 7665 642e 0d0a 0d0a 2020 2020 2020 2020  ved.....        
+0001c4e0: 4172 6775 6d65 6e74 733a 0d0a 2020 2020  Arguments:..    
+0001c4f0: 2020 2020 2020 2020 6d6f 6475 6c65 7320          modules 
+0001c500: 2869 7465 7261 626c 6529 3a20 6120 6d61  (iterable): a ma
+0001c510: 7070 696e 6720 2864 6963 7469 6f6e 6172  pping (dictionar
+0001c520: 7929 2066 726f 6d20 7374 7269 6e67 2074  y) from string t
+0001c530: 6f20 3a63 6c61 7373 3a60 7e74 6f72 6368  o :class:`~torch
+0001c540: 2e74 662e 4d6f 6475 6c65 602c 0d0a 2020  .tf.Module`,..  
+0001c550: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0001c560: 2061 6e20 6974 6572 6162 6c65 206f 6620   an iterable of 
+0001c570: 6b65 792d 7661 6c75 6520 7061 6972 7320  key-value pairs 
+0001c580: 6f66 2074 7970 6520 2873 7472 696e 672c  of type (string,
+0001c590: 203a 636c 6173 733a 607e 746f 7263 682e   :class:`~torch.
+0001c5a0: 7466 2e4d 6f64 756c 6560 290d 0a20 2020  tf.Module`)..   
+0001c5b0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0001c5c0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0001c5d0: 6e63 6528 6d6f 6475 6c65 732c 2061 6263  nce(modules, abc
+0001c5e0: 2e49 7465 7261 626c 6529 3a0d 0a20 2020  .Iterable):..   
+0001c5f0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0001c600: 7970 6545 7272 6f72 2822 4d6f 6475 6c65  ypeError("Module
+0001c610: 4469 6374 2e75 7064 6174 6520 7368 6f75  Dict.update shou
+0001c620: 6c64 2062 6520 6361 6c6c 6564 2077 6974  ld be called wit
+0001c630: 6820 616e 2022 0d0a 2020 2020 2020 2020  h an "..        
+0001c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c650: 2020 2020 2269 7465 7261 626c 6520 6f66      "iterable of
+0001c660: 206b 6579 2f76 616c 7565 2070 6169 7273   key/value pairs
+0001c670: 2c20 6275 7420 676f 7420 2220 2b0d 0a20  , but got " +.. 
+0001c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c690: 2020 2020 2020 2020 2020 2074 7970 6528             type(
+0001c6a0: 6d6f 6475 6c65 7329 2e5f 5f6e 616d 655f  modules).__name_
+0001c6b0: 5f29 0d0a 0d0a 2020 2020 2020 2020 6966  _)....        if
+0001c6c0: 2069 7369 6e73 7461 6e63 6528 6d6f 6475   isinstance(modu
+0001c6d0: 6c65 732c 2028 4f72 6465 7265 6444 6963  les, (OrderedDic
+0001c6e0: 742c 204d 6f64 756c 6544 6963 7429 293a  t, ModuleDict)):
+0001c6f0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0001c700: 7220 6b65 792c 206d 6f64 756c 6520 696e  r key, module in
+0001c710: 206d 6f64 756c 6573 2e69 7465 6d73 2829   modules.items()
+0001c720: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001c730: 2020 2073 656c 665b 6b65 795d 203d 206d     self[key] = m
+0001c740: 6f64 756c 650d 0a20 2020 2020 2020 2065  odule..        e
+0001c750: 6c69 6620 6973 696e 7374 616e 6365 286d  lif isinstance(m
+0001c760: 6f64 756c 6573 2c20 6162 632e 4d61 7070  odules, abc.Mapp
+0001c770: 696e 6729 3a0d 0a20 2020 2020 2020 2020  ing):..         
+0001c780: 2020 2066 6f72 206b 6579 2c20 6d6f 6475     for key, modu
+0001c790: 6c65 2069 6e20 736f 7274 6564 286d 6f64  le in sorted(mod
+0001c7a0: 756c 6573 2e69 7465 6d73 2829 293a 0d0a  ules.items()):..
+0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7c0: 7365 6c66 5b6b 6579 5d20 3d20 6d6f 6475  self[key] = modu
+0001c7d0: 6c65 0d0a 2020 2020 2020 2020 656c 7365  le..        else
+0001c7e0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+0001c7f0: 6f72 206a 2c20 6d20 696e 2065 6e75 6d65  or j, m in enume
+0001c800: 7261 7465 286d 6f64 756c 6573 293a 0d0a  rate(modules):..
+0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c820: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+0001c830: 6528 6d2c 2061 6263 2e49 7465 7261 626c  e(m, abc.Iterabl
+0001c840: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+0001c850: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0001c860: 7970 6545 7272 6f72 2822 4d6f 6475 6c65  ypeError("Module
+0001c870: 4469 6374 2075 7064 6174 6520 7365 7175  Dict update sequ
+0001c880: 656e 6365 2065 6c65 6d65 6e74 2022 0d0a  ence element "..
+0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2020 2020 2223 2220 2b20 7374 7228 6a29      "#" + str(j)
+0001c8c0: 202b 2022 2073 686f 756c 6420 6265 2049   + " should be I
+0001c8d0: 7465 7261 626c 653b 2069 7322 202b 0d0a  terable; is" +..
+0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c900: 2020 2020 7479 7065 286d 292e 5f5f 6e61      type(m).__na
+0001c910: 6d65 5f5f 290d 0a20 2020 2020 2020 2020  me__)..         
+0001c920: 2020 2020 2020 2069 6620 6e6f 7420 6c65         if not le
+0001c930: 6e28 6d29 203d 3d20 323a 0d0a 2020 2020  n(m) == 2:..    
+0001c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c950: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0001c960: 2822 4d6f 6475 6c65 4469 6374 2075 7064  ("ModuleDict upd
+0001c970: 6174 6520 7365 7175 656e 6365 2065 6c65  ate sequence ele
+0001c980: 6d65 6e74 2022 0d0a 2020 2020 2020 2020  ment "..        
+0001c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9a0: 2020 2020 2020 2020 2020 2020 2022 2322               "#"
+0001c9b0: 202b 2073 7472 286a 2920 2b20 2220 6861   + str(j) + " ha
+0001c9c0: 7320 6c65 6e67 7468 2022 202b 2073 7472  s length " + str
+0001c9d0: 286c 656e 286d 2929 202b 0d0a 2020 2020  (len(m)) +..    
+0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca00: 2022 3b20 3220 6973 2072 6571 7569 7265   "; 2 is require
+0001ca10: 6422 290d 0a20 2020 2020 2020 2020 2020  d")..           
+0001ca20: 2020 2020 2073 656c 665b 6d5b 305d 5d20       self[m[0]] 
+0001ca30: 3d20 6d5b 315d 0d0a 0d0a 2020 2020 6465  = m[1]....    de
+0001ca40: 6620 6275 696c 6428 7365 6c66 2c20 696e  f build(self, in
+0001ca50: 7075 745f 7368 6170 653a 2054 656e 736f  put_shape: Tenso
+0001ca60: 7253 6861 7065 293a 0d0a 2020 2020 2020  rShape):..      
+0001ca70: 2020 2222 220d 0a0d 0a20 2020 2020 2020    """....       
+0001ca80: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
+0001ca90: 2020 2020 696e 7075 745f 7368 6170 6520      input_shape 
+0001caa0: 2874 6f72 6368 2e53 697a 652c 2074 656e  (torch.Size, ten
+0001cab0: 736f 722c 206c 6973 7428 696e 7429 2c20  sor, list(int), 
+0001cac0: 7475 706c 6528 696e 7429 293a 2054 6865  tuple(int)): The
+0001cad0: 2069 6e70 7574 5f73 6861 7065 2069 6e66   input_shape inf
+0001cae0: 6f72 6d61 7469 6f6e 2c20 6e6f 7420 696e  ormation, not in
+0001caf0: 636c 7564 696e 6720 6261 7463 6820 6178  cluding batch ax
+0001cb00: 6973 2e0d 0a0d 0a20 2020 2020 2020 2052  is.....        R
+0001cb10: 6574 7572 6e73 3a0d 0a0d 0a20 2020 2020  eturns:....     
+0001cb20: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0001cb30: 6966 2073 656c 662e 5f62 7569 6c74 203d  if self._built =
+0001cb40: 3d20 4661 6c73 6520 616e 6420 6c65 6e28  = False and len(
+0001cb50: 7365 6c66 2e5f 6d6f 6475 6c65 7329 203e  self._modules) >
+0001cb60: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0001cb70: 2073 656c 662e 5f69 6e70 7574 5f73 6861   self._input_sha
+0001cb80: 7065 203d 2054 656e 736f 7253 6861 7065  pe = TensorShape
+0001cb90: 2869 6e70 7574 5f73 6861 7065 290d 0a20  (input_shape).. 
+0001cba0: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+0001cbb0: 5f73 6861 7065 203d 2074 7570 6c65 2874  _shape = tuple(t
+0001cbc0: 6f5f 6e75 6d70 7928 696e 7075 745f 7368  o_numpy(input_sh
+0001cbd0: 6170 6529 290d 0a20 2020 2020 2020 2020  ape))..         
+0001cbe0: 2020 2064 756d 6d61 795f 696e 7075 7420     dummay_input 
+0001cbf0: 3d20 746f 5f74 656e 736f 7228 7365 6c66  = to_tensor(self
+0001cc00: 2e5f 696e 7075 745f 7368 6170 652e 6765  ._input_shape.ge
+0001cc10: 745f 6475 6d6d 795f 7465 6e73 6f72 2829  t_dummy_tensor()
+0001cc20: 292e 746f 2873 656c 662e 6465 7669 6365  ).to(self.device
+0001cc30: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0001cc40: 2066 6f72 206e 616d 652c 206d 6f64 756c   for name, modul
+0001cc50: 6520 696e 2073 656c 662e 6974 656d 7328  e in self.items(
+0001cc60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001cc70: 2020 2020 6f75 7420 3d20 6d6f 6475 6c65      out = module
+0001cc80: 2864 756d 6d61 795f 696e 7075 7429 0d0a  (dummay_input)..
+0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cca0: 6d6f 6475 6c65 2e69 6e70 7574 5f73 6861  module.input_sha
+0001ccb0: 7065 203d 2069 6e70 7574 5f73 6861 7065  pe = input_shape
+0001ccc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ccd0: 2020 6d6f 6475 6c65 2e6f 7574 7075 745f    module.output_
+0001cce0: 7368 6170 6520 3d20 7465 6e73 6f72 5f74  shape = tensor_t
+0001ccf0: 6f5f 7368 6170 6528 6f75 7429 0d0a 2020  o_shape(out)..  
+0001cd00: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001cd10: 6275 696c 7420 3d20 5472 7565 0d0a 0d0a  built = True....
+0001cd20: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
+0001cd30: 7365 6c66 2c20 782c 202a 2a6b 7761 7267  self, x, **kwarg
+0001cd40: 7329 3a0d 0a20 2020 2020 2020 2069 6620  s):..        if 
+0001cd50: 7365 6c66 2e69 735f 6d75 6c74 6963 6173  self.is_multicas
+0001cd60: 7469 6e67 3a0d 0a0d 0a20 2020 2020 2020  ting:....       
+0001cd70: 2020 2020 2023 2078 203d 2065 6e66 6f72       # x = enfor
+0001cd80: 6365 5f73 696e 676c 6574 6f6e 2878 290d  ce_singleton(x).
+0001cd90: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0001cda0: 756c 7473 203d 204f 7264 6572 6564 4469  ults = OrderedDi
+0001cdb0: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
+0001cdc0: 2020 666f 7220 6e61 6d65 2c20 6d6f 6475    for name, modu
+0001cdd0: 6c65 2069 6e20 7365 6c66 2e69 7465 6d73  le in self.items
+0001cde0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0001cdf0: 2020 2020 206f 7574 203d 206d 6f64 756c       out = modul
+0001ce00: 6528 782c 202a 2a6b 7761 7267 7329 0d0a  e(x, **kwargs)..
+0001ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce20: 7265 7375 6c74 735b 6e61 6d65 5d20 3d20  results[name] = 
+0001ce30: 6f75 740d 0a20 2020 2020 2020 2020 2020  out..           
+0001ce40: 2072 6574 7572 6e20 7265 7375 6c74 730d   return results.
+0001ce50: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0001ce60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001ce70: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+0001ce80: 4572 726f 7228 290d 0a0d 0a0d 0a63 6c61  Error()......cla
+0001ce90: 7373 2043 6f6d 6269 6e65 284c 6179 6572  ss Combine(Layer
+0001cea0: 293a 0d0a 2020 2020 7222 2222 4120 7365  ):..    r"""A se
+0001ceb0: 7175 656e 7469 616c 2063 6f6e 7461 696e  quential contain
+0001cec0: 6572 2e0d 0a20 2020 204d 6f64 756c 6573  er...    Modules
+0001ced0: 2077 696c 6c20 6265 2061 6464 6564 2074   will be added t
+0001cee0: 6f20 6974 2069 6e20 7468 6520 6f72 6465  o it in the orde
+0001cef0: 7220 7468 6579 2061 7265 2070 6173 7365  r they are passe
+0001cf00: 6420 696e 2074 6865 2063 6f6e 7374 7275  d in the constru
+0001cf10: 6374 6f72 2e0d 0a20 2020 2041 6c74 6572  ctor...    Alter
+0001cf20: 6e61 7469 7665 6c79 2c20 616e 206f 7264  natively, an ord
+0001cf30: 6572 6564 2064 6963 7420 6f66 206d 6f64  ered dict of mod
+0001cf40: 756c 6573 2063 616e 2061 6c73 6f20 6265  ules can also be
+0001cf50: 2070 6173 7365 6420 696e 2e0d 0a0d 0a20   passed in..... 
+0001cf60: 2020 2054 6f20 6d61 6b65 2069 7420 6561     To make it ea
+0001cf70: 7369 6572 2074 6f20 756e 6465 7273 7461  sier to understa
+0001cf80: 6e64 2c20 6865 7265 2069 7320 6120 736d  nd, here is a sm
+0001cf90: 616c 6c20 6578 616d 706c 653a 3a0d 0a0d  all example::...
+0001cfa0: 0a20 2020 2020 2020 2023 2045 7861 6d70  .        # Examp
+0001cfb0: 6c65 206f 6620 7573 696e 6720 5365 7175  le of using Sequ
+0001cfc0: 656e 7469 616c 0d0a 2020 2020 2020 2020  ential..        
+0001cfd0: 6d6f 6465 6c20 3d20 6e6e 2e53 6571 7565  model = nn.Seque
+0001cfe0: 6e74 6961 6c28 0d0a 2020 2020 2020 2020  ntial(..        
+0001cff0: 2020 2020 2020 2020 2020 6e6e 2e43 6f6e            nn.Con
+0001d000: 7632 6428 312c 3230 2c35 292c 0d0a 2020  v2d(1,20,5),..  
+0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d020: 6e6e 2e52 654c 5528 292c 0d0a 2020 2020  nn.ReLU(),..    
+0001d030: 2020 2020 2020 2020 2020 2020 2020 6e6e                nn
+0001d040: 2e43 6f6e 7632 6428 3230 2c36 342c 3529  .Conv2d(20,64,5)
+0001d050: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001d060: 2020 2020 206e 6e2e 5265 4c55 2829 0d0a       nn.ReLU()..
+0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d080: 290d 0a0d 0a20 2020 2020 2020 2023 2045  )....        # E
+0001d090: 7861 6d70 6c65 206f 6620 7573 696e 6720  xample of using 
+0001d0a0: 5365 7175 656e 7469 616c 2077 6974 6820  Sequential with 
+0001d0b0: 4f72 6465 7265 6444 6963 740d 0a20 2020  OrderedDict..   
+0001d0c0: 2020 2020 206d 6f64 656c 203d 206e 6e2e       model = nn.
+0001d0d0: 5365 7175 656e 7469 616c 284f 7264 6572  Sequential(Order
+0001d0e0: 6564 4469 6374 285b 0d0a 2020 2020 2020  edDict([..      
+0001d0f0: 2020 2020 2020 2020 2020 2020 2827 636f              ('co
+0001d100: 6e76 3127 2c20 6e6e 2e43 6f6e 7632 6428  nv1', nn.Conv2d(
+0001d110: 312c 3230 2c35 2929 2c0d 0a20 2020 2020  1,20,5)),..     
+0001d120: 2020 2020 2020 2020 2020 2020 2028 2772               ('r
+0001d130: 656c 7531 272c 206e 6e2e 5265 4c55 2829  elu1', nn.ReLU()
+0001d140: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0001d150: 2020 2020 2020 2827 636f 6e76 3227 2c20        ('conv2', 
+0001d160: 6e6e 2e43 6f6e 7632 6428 3230 2c36 342c  nn.Conv2d(20,64,
+0001d170: 3529 292c 0d0a 2020 2020 2020 2020 2020  5)),..          
+0001d180: 2020 2020 2020 2020 2827 7265 6c75 3227          ('relu2'
+0001d190: 2c20 6e6e 2e52 654c 5528 2929 0d0a 2020  , nn.ReLU())..  
+0001d1a0: 2020 2020 2020 2020 2020 2020 2020 5d29                ])
+0001d1b0: 290d 0a20 2020 2022 2222 0d0a 0d0a 2020  )..    """....  
+0001d1c0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+0001d1d0: 656c 662c 202a 6172 6773 2c20 6e61 6d65  elf, *args, name
+0001d1e0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
+0001d1f0: 2073 7570 6572 2843 6f6d 6269 6e65 2c20   super(Combine, 
+0001d200: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
+0001d210: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0001d220: 6e61 6d65 203d 206e 616d 650d 0a20 2020  name = name..   
+0001d230: 2020 2020 2073 656c 662e 5f62 7569 6c74       self._built
+0001d240: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
+0001d250: 2020 2020 6966 206c 656e 2861 7267 7329      if len(args)
+0001d260: 203d 3d20 3120 616e 6420 6973 696e 7374   == 1 and isinst
+0001d270: 616e 6365 2861 7267 735b 305d 2c20 4f72  ance(args[0], Or
+0001d280: 6465 7265 6444 6963 7429 3a0d 0a20 2020  deredDict):..   
+0001d290: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+0001d2a0: 2c20 6d6f 6475 6c65 2069 6e20 6172 6773  , module in args
+0001d2b0: 5b30 5d2e 6974 656d 7328 293a 0d0a 2020  [0].items():..  
+0001d2c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001d2d0: 6c66 2e61 6464 5f6d 6f64 756c 6528 6b65  lf.add_module(ke
+0001d2e0: 792c 206d 6f64 756c 6529 0d0a 2020 2020  y, module)..    
+0001d2f0: 2020 2020 656c 6966 206c 656e 2861 7267      elif len(arg
+0001d300: 7329 203d 3d20 3120 616e 6420 6973 696e  s) == 1 and isin
+0001d310: 7374 616e 6365 2861 7267 735b 305d 2c20  stance(args[0], 
+0001d320: 286c 6973 7429 293a 0d0a 2020 2020 2020  (list)):..      
+0001d330: 2020 2020 2020 666f 7220 6964 782c 206d        for idx, m
+0001d340: 6f64 756c 6520 696e 2065 6e75 6d65 7261  odule in enumera
+0001d350: 7465 2861 7267 735b 305d 293a 0d0a 2020  te(args[0]):..  
+0001d360: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001d370: 6c66 2e61 6464 5f6d 6f64 756c 6528 7374  lf.add_module(st
+0001d380: 7228 6964 7829 2c20 6d6f 6475 6c65 290d  r(idx), module).
+0001d390: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0001d3a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001d3b0: 6964 782c 206d 6f64 756c 6520 696e 2065  idx, module in e
+0001d3c0: 6e75 6d65 7261 7465 2861 7267 7329 3a0d  numerate(args):.
+0001d3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d3e0: 2073 656c 662e 6164 645f 6d6f 6475 6c65   self.add_module
+0001d3f0: 2873 7472 2869 6478 292c 206d 6f64 756c  (str(idx), modul
+0001d400: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+0001d410: 2e74 6f28 7365 6c66 2e64 6576 6963 6529  .to(self.device)
+0001d420: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
+0001d430: 5f69 7465 6d5f 6279 5f69 6478 2873 656c  _item_by_idx(sel
+0001d440: 662c 2069 7465 7261 746f 722c 2069 6478  f, iterator, idx
+0001d450: 293a 0d0a 2020 2020 2020 2020 2222 2247  ):..        """G
+0001d460: 6574 2074 6865 2069 6478 2d74 6820 6974  et the idx-th it
+0001d470: 656d 206f 6620 7468 6520 6974 6572 6174  em of the iterat
+0001d480: 6f72 2222 220d 0a20 2020 2020 2020 2073  or"""..        s
+0001d490: 697a 6520 3d20 6c65 6e28 7365 6c66 290d  ize = len(self).
+0001d4a0: 0a20 2020 2020 2020 2069 6478 203d 2069  .        idx = i
+0001d4b0: 6478 2e5f 5f69 6e64 6578 5f5f 2829 0d0a  dx.__index__()..
+0001d4c0: 2020 2020 2020 2020 6966 206e 6f74 202d          if not -
+0001d4d0: 7369 7a65 203c 3d20 6964 7820 3c20 7369  size <= idx < si
+0001d4e0: 7a65 3a0d 0a20 2020 2020 2020 2020 2020  ze:..           
+0001d4f0: 2072 6169 7365 2049 6e64 6578 4572 726f   raise IndexErro
+0001d500: 7228 2769 6e64 6578 207b 7d20 6973 206f  r('index {} is o
+0001d510: 7574 206f 6620 7261 6e67 6527 2e66 6f72  ut of range'.for
+0001d520: 6d61 7428 6964 7829 290d 0a20 2020 2020  mat(idx))..     
+0001d530: 2020 2069 6478 2025 3d20 7369 7a65 0d0a     idx %= size..
+0001d540: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+0001d550: 6578 7428 6973 6c69 6365 2869 7465 7261  ext(islice(itera
+0001d560: 746f 722c 2069 6478 2c20 4e6f 6e65 2929  tor, idx, None))
+0001d570: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6765  ....    def __ge
+0001d580: 7469 7465 6d5f 5f28 7365 6c66 2c20 6964  titem__(self, id
+0001d590: 7829 3a0d 0a20 2020 2020 2020 2069 6620  x):..        if 
+0001d5a0: 6973 696e 7374 616e 6365 2869 6478 2c20  isinstance(idx, 
+0001d5b0: 736c 6963 6529 3a0d 0a20 2020 2020 2020  slice):..       
+0001d5c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001d5d0: 2e5f 5f63 6c61 7373 5f5f 284f 7264 6572  .__class__(Order
+0001d5e0: 6564 4469 6374 286c 6973 7428 7365 6c66  edDict(list(self
+0001d5f0: 2e5f 6d6f 6475 6c65 732e 6974 656d 7328  ._modules.items(
+0001d600: 2929 5b69 6478 5d29 290d 0a20 2020 2020  ))[idx]))..     
+0001d610: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001d620: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001d630: 662e 5f67 6574 5f69 7465 6d5f 6279 5f69  f._get_item_by_i
+0001d640: 6478 2873 656c 662e 5f6d 6f64 756c 6573  dx(self._modules
+0001d650: 2e76 616c 7565 7328 292c 2069 6478 290d  .values(), idx).
+0001d660: 0a0d 0a20 2020 2064 6566 205f 5f73 6574  ...    def __set
+0001d670: 6974 656d 5f5f 2873 656c 662c 2069 6478  item__(self, idx
+0001d680: 2c20 6d6f 6475 6c65 293a 0d0a 2020 2020  , module):..    
+0001d690: 2020 2020 6b65 7920 3d20 7365 6c66 2e5f      key = self._
+0001d6a0: 6765 745f 6974 656d 5f62 795f 6964 7828  get_item_by_idx(
+0001d6b0: 7365 6c66 2e5f 6d6f 6475 6c65 732e 6b65  self._modules.ke
+0001d6c0: 7973 2829 2c20 6964 7829 0d0a 2020 2020  ys(), idx)..    
+0001d6d0: 2020 2020 7265 7475 726e 2073 6574 6174      return setat
+0001d6e0: 7472 2873 656c 662c 206b 6579 2c20 6d6f  tr(self, key, mo
+0001d6f0: 6475 6c65 290d 0a0d 0a20 2020 2064 6566  dule)....    def
+0001d700: 205f 5f64 656c 6974 656d 5f5f 2873 656c   __delitem__(sel
+0001d710: 662c 2069 6478 293a 0d0a 2020 2020 2020  f, idx):..      
+0001d720: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001d730: 6964 782c 2073 6c69 6365 293a 0d0a 2020  idx, slice):..  
+0001d740: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+0001d750: 7920 696e 206c 6973 7428 7365 6c66 2e5f  y in list(self._
+0001d760: 6d6f 6475 6c65 732e 6b65 7973 2829 295b  modules.keys())[
+0001d770: 6964 785d 3a0d 0a20 2020 2020 2020 2020  idx]:..         
+0001d780: 2020 2020 2020 2064 656c 6174 7472 2873         delattr(s
+0001d790: 656c 662c 206b 6579 290d 0a20 2020 2020  elf, key)..     
+0001d7a0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001d7b0: 2020 2020 2020 6b65 7920 3d20 7365 6c66        key = self
+0001d7c0: 2e5f 6765 745f 6974 656d 5f62 795f 6964  ._get_item_by_id
+0001d7d0: 7828 7365 6c66 2e5f 6d6f 6475 6c65 732e  x(self._modules.
+0001d7e0: 6b65 7973 2829 2c20 6964 7829 0d0a 2020  keys(), idx)..  
+0001d7f0: 2020 2020 2020 2020 2020 6465 6c61 7474            delatt
+0001d800: 7228 7365 6c66 2c20 6b65 7929 0d0a 0d0a  r(self, key)....
+0001d810: 2020 2020 6465 6620 5f5f 6c65 6e5f 5f28      def __len__(
+0001d820: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0001d830: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
+0001d840: 5f6d 6f64 756c 6573 290d 0a0d 0a20 2020  _modules)....   
+0001d850: 2064 6566 205f 5f64 6972 5f5f 2873 656c   def __dir__(sel
+0001d860: 6629 3a0d 0a20 2020 2020 2020 206b 6579  f):..        key
+0001d870: 7320 3d20 7375 7065 7228 436f 6d62 696e  s = super(Combin
+0001d880: 652c 2073 656c 6629 2e5f 5f64 6972 5f5f  e, self).__dir__
+0001d890: 2829 0d0a 2020 2020 2020 2020 6b65 7973  ()..        keys
+0001d8a0: 203d 205b 6b65 7920 666f 7220 6b65 7920   = [key for key 
+0001d8b0: 696e 206b 6579 7320 6966 206e 6f74 206b  in keys if not k
+0001d8c0: 6579 2e69 7364 6967 6974 2829 5d0d 0a20  ey.isdigit()].. 
+0001d8d0: 2020 2020 2020 2072 6574 7572 6e20 6b65         return ke
+0001d8e0: 7973 0d0a 0d0a 2020 2020 6465 6620 666f  ys....    def fo
+0001d8f0: 7277 6172 6428 7365 6c66 2c20 2a78 293a  rward(self, *x):
+0001d900: 0d0a 2020 2020 2020 2020 6f75 7470 7574  ..        output
+0001d910: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+0001d920: 666f 7220 6d6f 6475 6c65 2069 6e20 7365  for module in se
+0001d930: 6c66 2e5f 6d6f 6475 6c65 732e 7661 6c75  lf._modules.valu
+0001d940: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
+0001d950: 2020 206f 7574 7075 7473 2e61 7070 656e     outputs.appen
+0001d960: 6428 6d6f 6475 6c65 282a 7829 290d 0a20  d(module(*x)).. 
+0001d970: 2020 2020 2020 2072 6574 7572 6e20 7475         return tu
+0001d980: 706c 6528 6f75 7470 7574 7329 0d0a 0d0a  ple(outputs)....
+0001d990: 0d0a 6465 6620 636f 756e 745f 7061 7261  ..def count_para
+0001d9a0: 6d73 2877 6569 6768 7473 293a 0d0a 2020  ms(weights):..  
+0001d9b0: 2020 2222 2243 6f75 6e74 2074 6865 2074    """Count the t
+0001d9c0: 6f74 616c 206e 756d 6265 7220 6f66 2073  otal number of s
+0001d9d0: 6361 6c61 7273 2063 6f6d 706f 7369 6e67  calars composing
+0001d9e0: 2074 6865 2077 6569 6768 7473 2e0d 0a0d   the weights....
+0001d9f0: 0a20 2020 2041 7267 733a 0d0a 2020 2020  .    Args:..    
+0001da00: 2020 2020 7765 6967 6874 733a 2041 6e20      weights: An 
+0001da10: 6974 6572 6162 6c65 2063 6f6e 7461 696e  iterable contain
+0001da20: 696e 6720 7468 6520 7765 6967 6874 7320  ing the weights 
+0001da30: 6f6e 2077 6869 6368 2074 6f20 636f 6d70  on which to comp
+0001da40: 7574 6520 7061 7261 6d73 0d0a 0d0a 2020  ute params....  
+0001da50: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+0001da60: 2020 2020 5468 6520 746f 7461 6c20 6e75      The total nu
+0001da70: 6d62 6572 206f 6620 7363 616c 6172 7320  mber of scalars 
+0001da80: 636f 6d70 6f73 696e 6720 7468 6520 7765  composing the we
+0001da90: 6967 6874 730d 0a20 2020 2022 2222 0d0a  ights..    """..
+0001daa0: 2020 2020 7265 7475 726e 2069 6e74 2873      return int(s
+0001dab0: 756d 286e 702e 7072 6f64 2870 2e73 6861  um(np.prod(p.sha
+0001dac0: 7065 2e61 735f 6c69 7374 2829 2920 666f  pe.as_list()) fo
+0001dad0: 7220 7020 696e 206f 626a 6563 745f 6964  r p in object_id
+0001dae0: 656e 7469 7479 2e4f 626a 6563 7449 6465  entity.ObjectIde
+0001daf0: 6e74 6974 7953 6574 2877 6569 6768 7473  ntitySet(weights
+0001db00: 2929 290d 0a0d 0a0d 0a64 6566 2063 616c  )))......def cal
+0001db10: 6375 6c61 7465 5f66 6c6f 7073 2867 656e  culate_flops(gen
+0001db20: 3a20 4c61 7965 7229 3a0d 0a20 2020 2022  : Layer):..    "
+0001db30: 2222 0d0a 2020 2020 4361 6c63 756c 6174  ""..    Calculat
+0001db40: 6520 7468 6520 666c 6f70 7320 6769 7665  e the flops give
+0001db50: 6e20 6120 6765 6e65 7261 746f 7220 6f66  n a generator of
+0001db60: 2070 7974 6f72 6368 206d 6f64 656c 2e0d   pytorch model..
+0001db70: 0a20 2020 2049 7420 6f6e 6c79 2063 6f6d  .    It only com
+0001db80: 7075 7465 2074 6865 2066 6c6f 7073 206f  pute the flops o
+0001db90: 6620 666f 7277 6172 6420 7061 7373 2e0d  f forward pass..
+0001dba0: 0a0d 0a0d 0a20 2020 2022 2222 0d0a 2020  .....    """..  
+0001dbb0: 2020 666c 6f70 7320 3d20 300d 0a20 2020    flops = 0..   
+0001dbc0: 206d 6f64 7320 3d20 6765 6e2e 6e61 6d65   mods = gen.name
+0001dbd0: 645f 6d6f 6475 6c65 7328 290d 0a20 2020  d_modules()..   
+0001dbe0: 206d 6f64 7320 3d20 6c69 7374 286d 6f64   mods = list(mod
+0001dbf0: 7329 5b31 3a5d 0d0a 2020 2020 7061 7261  s)[1:]..    para
+0001dc00: 6d5f 6e75 6d73 203d 205b 5d0d 0a20 2020  m_nums = []..   
+0001dc10: 2070 6172 616d 5f73 697a 6573 203d 205b   param_sizes = [
+0001dc20: 5d0d 0a20 2020 2066 6f72 206d 6f64 5f6e  ]..    for mod_n
+0001dc30: 616d 652c 206d 6f64 2069 6e20 6d6f 6473  ame, mod in mods
+0001dc40: 3a0d 0a20 2020 2020 2020 2070 203d 206c  :..        p = l
+0001dc50: 6973 7428 6d6f 642e 7061 7261 6d65 7465  ist(mod.paramete
+0001dc60: 7273 2829 290d 0a20 2020 2020 2020 206d  rs())..        m
+0001dc70: 6f64 737a 203d 205b 5d0d 0a20 2020 2020  odsz = []..     
+0001dc80: 2020 2061 6c6c 5f70 6172 616d 7320 3d20     all_params = 
+0001dc90: 300d 0a20 2020 2020 2020 2066 6f72 206a  0..        for j
+0001dca0: 2069 6e20 7261 6e67 6528 6c65 6e28 7029   in range(len(p)
+0001dcb0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001dcc0: 6d6f 6473 7a2e 6170 7065 6e64 286e 702e  modsz.append(np.
+0001dcd0: 6172 7261 7928 705b 6a5d 2e73 697a 6528  array(p[j].size(
+0001dce0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+0001dcf0: 2061 6c6c 5f70 6172 616d 7320 2b3d 206e   all_params += n
+0001dd00: 702e 7072 6f64 2870 5b6a 5d2e 7369 7a65  p.prod(p[j].size
+0001dd10: 2829 290d 0a0d 0a20 2020 2020 2020 2070  ())....        p
+0001dd20: 6172 616d 5f6e 756d 732e 6170 7065 6e64  aram_nums.append
+0001dd30: 2861 6c6c 5f70 6172 616d 7329 0d0a 2020  (all_params)..  
+0001dd40: 2020 2020 2020 7061 7261 6d5f 7369 7a65        param_size
+0001dd50: 732e 6170 7065 6e64 286d 6f64 737a 290d  s.append(modsz).
+0001dd60: 0a0d 0a20 2020 2072 6574 7572 6e20 6e70  ...    return np
+0001dd70: 2e61 7272 6179 2870 6172 616d 5f6e 756d  .array(param_num
+0001dd80: 7329 2e73 756d 2829 0d0a 0d0a 0d0a 6465  s).sum()......de
+0001dd90: 6620 7375 6d6d 6172 7928 6d6f 6465 6c2c  f summary(model,
+0001dda0: 2069 6e70 7574 5f73 7065 6373 2c20 6261   input_specs, ba
+0001ddb0: 7463 685f 7369 7a65 3d31 2c20 696e 7075  tch_size=1, inpu
+0001ddc0: 7473 3d4e 6f6e 652c 2064 6576 6963 653d  ts=None, device=
+0001ddd0: 2263 7564 6122 293a 0d0a 2020 2020 6465  "cuda"):..    de
+0001dde0: 6620 7265 6769 7374 6572 5f68 6f6f 6b28  f register_hook(
+0001ddf0: 6d6f 6475 6c65 293a 0d0a 2020 2020 2020  module):..      
+0001de00: 2020 6465 6620 686f 6f6b 286d 6f64 756c    def hook(modul
+0001de10: 652c 2069 6e70 7574 2c20 6f75 7470 7574  e, input, output
+0001de20: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001de30: 2320 636c 6173 735f 6e61 6d65 203d 6d6f  # class_name =mo
+0001de40: 6475 6c65 2e72 6520 2020 206d 6f64 756c  dule.re    modul
+0001de50: 652e 6e61 6d65 2020 2023 2073 7472 286d  e.name   # str(m
+0001de60: 6f64 756c 652e 5f5f 636c 6173 735f 5f29  odule.__class__)
+0001de70: 2e73 706c 6974 2822 2e22 295b 2d31 5d2e  .split(".")[-1].
+0001de80: 7370 6c69 7428 2227 2229 5b30 5d0d 0a20  split("'")[0].. 
+0001de90: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+0001dea0: 655f 6964 7820 3d20 6c65 6e28 7375 6d6d  e_idx = len(summ
+0001deb0: 6172 7929 0d0a 0d0a 2020 2020 2020 2020  ary)....        
+0001dec0: 2020 2020 6d5f 6b65 7920 3d20 6d6f 6475      m_key = modu
+0001ded0: 6c65 2e72 656c 6174 6976 655f 6e61 6d65  le.relative_name
+0001dee0: 2069 6620 6861 7361 7474 7228 6d6f 6475   if hasattr(modu
+0001def0: 6c65 2c20 2772 656c 6174 6976 655f 6e61  le, 'relative_na
+0001df00: 6d65 2729 2065 6c73 6520 6d6f 6475 6c65  me') else module
+0001df10: 2e6e 616d 650d 0a20 2020 2020 2020 2020  .name..         
+0001df20: 2020 2073 756d 6d61 7279 5b6d 5f6b 6579     summary[m_key
+0001df30: 5d20 3d20 4f72 6465 7265 6444 6963 7428  ] = OrderedDict(
+0001df40: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0001df50: 756d 6d61 7279 5b6d 5f6b 6579 5d5b 2263  ummary[m_key]["c
+0001df60: 6c61 7373 5f6e 616d 6522 5d20 3d20 6d6f  lass_name"] = mo
+0001df70: 6475 6c65 2e5f 5f63 6c61 7373 5f5f 2e5f  dule.__class__._
+0001df80: 5f6e 616d 655f 5f0d 0a20 2020 2020 2020  _name__..       
+0001df90: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+0001dfa0: 6d6f 6475 6c65 2c20 276b 6565 705f 6f75  module, 'keep_ou
+0001dfb0: 7470 7574 2729 3a0d 0a20 2020 2020 2020  tput'):..       
+0001dfc0: 2020 2020 2020 2020 2073 756d 6d61 7279           summary
+0001dfd0: 5b6d 5f6b 6579 5d5b 226b 6565 705f 6f75  [m_key]["keep_ou
+0001dfe0: 7470 7574 225d 203d 206d 6f64 756c 652e  tput"] = module.
+0001dff0: 6b65 6570 5f6f 7574 7075 740d 0a20 2020  keep_output..   
+0001e000: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0001e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e020: 7375 6d6d 6172 795b 6d5f 6b65 795d 5b22  summary[m_key]["
+0001e030: 6b65 6570 5f6f 7574 7075 7422 5d20 3d20  keep_output"] = 
+0001e040: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0001e050: 2020 2069 6e70 7574 203d 2069 7465 7261     input = itera
+0001e060: 7469 6f6e 5f74 6f6f 6c73 2e66 6c61 7474  tion_tools.flatt
+0001e070: 656e 285b 696e 7075 745d 2c20 6974 6572  en([input], iter
+0001e080: 6162 6c65 5f74 7970 6573 3d28 6c69 7374  able_types=(list
+0001e090: 2c20 7475 706c 6529 290d 0a20 2020 2020  , tuple))..     
+0001e0a0: 2020 2020 2020 2069 6e70 7574 203d 2075         input = u
+0001e0b0: 6e70 6163 6b5f 7369 6e67 6c65 746f 6e28  npack_singleton(
+0001e0c0: 5b69 7465 6d20 666f 7220 6974 656d 2069  [item for item i
+0001e0d0: 6e20 696e 7075 7420 6966 2069 7465 6d20  n input if item 
+0001e0e0: 6973 206e 6f74 204e 6f6e 655d 290d 0a20  is not None]).. 
+0001e0f0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0001e100: 696e 7374 616e 6365 2869 6e70 7574 2c20  instance(input, 
+0001e110: 286c 6973 742c 2074 7570 6c65 2929 3a0d  (list, tuple)):.
+0001e120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e130: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
+0001e140: 2269 6e70 7574 5f73 6861 7065 225d 203d  "input_shape"] =
+0001e150: 206c 6973 7428 696e 745f 7368 6170 6528   list(int_shape(
+0001e160: 696e 7075 745b 305d 2929 0d0a 2020 2020  input[0]))..    
+0001e170: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+0001e180: 7465 6e73 6f72 2869 6e70 7574 293a 0d0a  tensor(input):..
+0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1a0: 7375 6d6d 6172 795b 6d5f 6b65 795d 5b22  summary[m_key]["
+0001e1b0: 696e 7075 745f 7368 6170 6522 5d20 3d20  input_shape"] = 
+0001e1c0: 6c69 7374 2869 6e74 5f73 6861 7065 2869  list(int_shape(i
+0001e1d0: 6e70 7574 2929 0d0a 2020 2020 2020 2020  nput))..        
+0001e1e0: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
+0001e1f0: 795d 5b22 696e 7075 745f 7368 6170 6522  y]["input_shape"
+0001e200: 5d5b 305d 203d 2062 6174 6368 5f73 697a  ][0] = batch_siz
+0001e210: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+0001e220: 206f 7574 7075 7420 3d20 6974 6572 6174   output = iterat
+0001e230: 696f 6e5f 746f 6f6c 732e 666c 6174 7465  ion_tools.flatte
+0001e240: 6e28 5b6f 7574 7075 745d 2c20 6974 6572  n([output], iter
+0001e250: 6162 6c65 5f74 7970 6573 3d28 6c69 7374  able_types=(list
+0001e260: 2c20 7475 706c 6529 290d 0a20 2020 2020  , tuple))..     
+0001e270: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+0001e280: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
+0001e290: 285b 6974 656d 2066 6f72 2069 7465 6d20  ([item for item 
+0001e2a0: 696e 206f 7574 7075 7420 6966 2069 7465  in output if ite
+0001e2b0: 6d20 6973 206e 6f74 204e 6f6e 655d 290d  m is not None]).
+0001e2c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001e2d0: 6973 696e 7374 616e 6365 286f 7574 7075  isinstance(outpu
+0001e2e0: 742c 2028 6c69 7374 2c20 7475 706c 6529  t, (list, tuple)
+0001e2f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0001e300: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
+0001e310: 795d 5b22 6f75 7470 7574 5f73 6861 7065  y]["output_shape
+0001e320: 225d 203d 206c 6973 7428 696e 745f 7368  "] = list(int_sh
+0001e330: 6170 6528 6f75 7470 7574 5b30 5d29 290d  ape(output[0])).
+0001e340: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0001e350: 6620 6973 5f74 656e 736f 7228 6f75 7470  f is_tensor(outp
+0001e360: 7574 293a 0d0a 2020 2020 2020 2020 2020  ut):..          
+0001e370: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
+0001e380: 6b65 795d 5b22 6f75 7470 7574 5f73 6861  key]["output_sha
+0001e390: 7065 225d 203d 206c 6973 7428 696e 745f  pe"] = list(int_
+0001e3a0: 7368 6170 6528 6f75 7470 7574 2929 0d0a  shape(output))..
+0001e3b0: 2020 2020 2020 2020 2020 2020 7375 6d6d              summ
+0001e3c0: 6172 795b 6d5f 6b65 795d 5b22 6f75 7470  ary[m_key]["outp
+0001e3d0: 7574 5f73 6861 7065 225d 5b30 5d20 3d20  ut_shape"][0] = 
+0001e3e0: 6261 7463 685f 7369 7a65 0d0a 0d0a 2020  batch_size....  
+0001e3f0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+0001e400: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+0001e410: 2020 7375 6d6d 6172 795b 6d5f 6b65 795d    summary[m_key]
+0001e420: 5b22 666c 6f70 7322 5d20 3d20 6e70 2e61  ["flops"] = np.a
+0001e430: 7272 6179 285b 305d 2c20 6474 7970 653d  rray([0], dtype=
+0001e440: 6e70 2e66 6c6f 6174 3634 290d 0a20 2020  np.float64)..   
+0001e450: 2020 2020 2020 2020 2073 756d 6d61 7279           summary
+0001e460: 5b6d 5f6b 6579 5d5b 226d 6163 6322 5d20  [m_key]["macc"] 
+0001e470: 3d20 6e70 2e61 7272 6179 285b 305d 2c20  = np.array([0], 
+0001e480: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+0001e490: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0001e4a0: 756d 6d61 7279 5b6d 5f6b 6579 5d5b 2274  ummary[m_key]["t
+0001e4b0: 7261 696e 6162 6c65 225d 203d 206e 702e  rainable"] = np.
+0001e4c0: 6172 7261 7928 5b30 5d2c 2064 7479 7065  array([0], dtype
+0001e4d0: 3d6e 702e 666c 6f61 7436 3429 0d0a 2020  =np.float64)..  
+0001e4e0: 2020 2020 2020 2020 2020 7375 6d6d 6172            summar
+0001e4f0: 795b 6d5f 6b65 795d 5b22 7765 6967 6874  y[m_key]["weight
+0001e500: 225d 203d 204f 7264 6572 6564 4469 6374  "] = OrderedDict
+0001e510: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0001e520: 7375 6d6d 6172 795b 6d5f 6b65 795d 5b22  summary[m_key]["
+0001e530: 6269 6173 225d 203d 204f 7264 6572 6564  bias"] = Ordered
+0001e540: 4469 6374 2829 0d0a 2020 2020 2020 2020  Dict()..        
+0001e550: 2020 2020 666f 7220 6e61 6d65 2c20 7061      for name, pa
+0001e560: 7261 2069 6e20 6d6f 6475 6c65 2e5f 7061  ra in module._pa
+0001e570: 7261 6d65 7465 7273 2e69 7465 6d73 2829  rameters.items()
+0001e580: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001e590: 2020 2069 6620 7061 7261 2069 7320 6e6f     if para is no
+0001e5a0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0001e5b0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0001e5c0: 615f 7479 7065 203d 2022 7765 6967 6874  a_type = "weight
+0001e5d0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0001e5e0: 2020 2020 2020 2069 6620 2762 6961 7327         if 'bias'
+0001e5f0: 2069 6e20 6e61 6d65 206f 7220 2762 6574   in name or 'bet
+0001e600: 6127 2069 6e20 6e61 6d65 3a0d 0a20 2020  a' in name:..   
+0001e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e620: 2020 2020 2070 6172 615f 7479 7065 203d       para_type =
+0001e630: 2022 6269 6173 220d 0a0d 0a20 2020 2020   "bias"....     
+0001e640: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001e650: 756d 6d61 7279 5b6d 5f6b 6579 5d5b 7061  ummary[m_key][pa
+0001e660: 7261 5f74 7970 655d 5b6e 616d 655d 203d  ra_type][name] =
+0001e670: 206c 6973 7428 696e 745f 7368 6170 6528   list(int_shape(
+0001e680: 7061 7261 2929 0d0a 2020 2020 2020 2020  para))..        
+0001e690: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0001e6a0: 7061 7261 6d73 203d 206e 702e 7072 6f64  params = np.prod
+0001e6b0: 286e 702e 6172 7261 7928 6c69 7374 2869  (np.array(list(i
+0001e6c0: 6e74 5f73 6861 7065 2870 6172 6129 292c  nt_shape(para)),
+0001e6d0: 2064 7479 7065 3d6e 702e 666c 6f61 7436   dtype=np.float6
+0001e6e0: 3429 290d 0a20 2020 2020 2020 2020 2020  4))..           
+0001e6f0: 2020 2020 2020 2020 2073 7061 7469 616c           spatial
+0001e700: 5f64 696d 7320 3d20 6e70 2e70 726f 6428  _dims = np.prod(
+0001e710: 6e70 2e61 7272 6179 2873 756d 6d61 7279  np.array(summary
+0001e720: 5b6d 5f6b 6579 5d5b 226f 7574 7075 745f  [m_key]["output_
+0001e730: 7368 6170 6522 5d5b 323a 5d29 2e61 7374  shape"][2:]).ast
+0001e740: 7970 6528 6e70 2e66 6c6f 6174 3634 2929  ype(np.float64))
+0001e750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001e760: 2020 2020 2020 7061 7261 6d73 202b 3d20        params += 
+0001e770: 6e75 6d5f 7061 7261 6d73 0d0a 2020 2020  num_params..    
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 6966 2070 6172 612e 7472 6169 6e61 626c  if para.trainabl
+0001e7a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0001e7b0: 2020 2020 2020 2020 2020 2020 7375 6d6d              summ
+0001e7c0: 6172 795b 6d5f 6b65 795d 5b22 7472 6169  ary[m_key]["trai
+0001e7d0: 6e61 626c 6522 5d20 2b3d 206e 756d 5f70  nable"] += num_p
+0001e7e0: 6172 616d 730d 0a0d 0a20 2020 2020 2020  arams....       
+0001e7f0: 2020 2020 2020 2020 2020 2020 2073 756d               sum
+0001e800: 6d61 7279 5b6d 5f6b 6579 5d5b 2266 6c6f  mary[m_key]["flo
+0001e810: 7073 225d 202b 3d20 2832 202a 206e 756d  ps"] += (2 * num
+0001e820: 5f70 6172 616d 7320 2d20 3129 202a 2073  _params - 1) * s
+0001e830: 7061 7469 616c 5f64 696d 730d 0a20 2020  patial_dims..   
 0001e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e850: 2020 2020 2020 2070 6172 615f 7479 7065         para_type
-0001e860: 203d 2022 6269 6173 220d 0a0d 0a20 2020   = "bias"....   
-0001e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e880: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
-0001e890: 7061 7261 5f74 7970 655d 5b6e 616d 655d  para_type][name]
-0001e8a0: 203d 206c 6973 7428 696e 745f 7368 6170   = list(int_shap
-0001e8b0: 6528 7061 7261 2929 0d0a 2020 2020 2020  e(para))..      
-0001e8c0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-0001e8d0: 6d5f 7061 7261 6d73 203d 206e 702e 7072  m_params = np.pr
-0001e8e0: 6f64 286e 702e 6172 7261 7928 6c69 7374  od(np.array(list
-0001e8f0: 2869 6e74 5f73 6861 7065 2870 6172 6129  (int_shape(para)
-0001e900: 292c 2064 7479 7065 3d6e 702e 666c 6f61  ), dtype=np.floa
-0001e910: 7436 3429 290d 0a20 2020 2020 2020 2020  t64))..         
-0001e920: 2020 2020 2020 2020 2020 2073 7061 7469             spati
-0001e930: 616c 5f64 696d 7320 3d20 6e70 2e70 726f  al_dims = np.pro
-0001e940: 6428 6e70 2e61 7272 6179 2873 756d 6d61  d(np.array(summa
-0001e950: 7279 5b6d 5f6b 6579 5d5b 226f 7574 7075  ry[m_key]["outpu
-0001e960: 745f 7368 6170 6522 5d5b 323a 5d29 2e61  t_shape"][2:]).a
-0001e970: 7374 7970 6528 6e70 2e66 6c6f 6174 3634  stype(np.float64
-0001e980: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0001e990: 2020 2020 2020 2020 7061 7261 6d73 202b          params +
-0001e9a0: 3d20 6e75 6d5f 7061 7261 6d73 0d0a 2020  = num_params..  
-0001e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9c0: 2020 6966 2070 6172 612e 7472 6169 6e61    if para.traina
-0001e9d0: 626c 653a 0d0a 2020 2020 2020 2020 2020  ble:..          
-0001e9e0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0001e9f0: 6d6d 6172 795b 6d5f 6b65 795d 5b22 7472  mmary[m_key]["tr
-0001ea00: 6169 6e61 626c 6522 5d20 2b3d 206e 756d  ainable"] += num
-0001ea10: 5f70 6172 616d 730d 0a0d 0a20 2020 2020  _params....     
-0001ea20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001ea30: 756d 6d61 7279 5b6d 5f6b 6579 5d5b 2266  ummary[m_key]["f
-0001ea40: 6c6f 7073 225d 202b 3d20 2832 202a 206e  lops"] += (2 * n
-0001ea50: 756d 5f70 6172 616d 7320 2d20 3129 202a  um_params - 1) *
-0001ea60: 2073 7061 7469 616c 5f64 696d 730d 0a20   spatial_dims.. 
-0001ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea80: 2020 2073 756d 6d61 7279 5b6d 5f6b 6579     summary[m_key
-0001ea90: 5d5b 226d 6163 6322 5d20 2b3d 206e 756d  ]["macc"] += num
-0001eaa0: 5f70 6172 616d 7320 2a20 7370 6174 6961  _params * spatia
-0001eab0: 6c5f 6469 6d73 0d0a 0d0a 2020 2020 2020  l_dims....      
-0001eac0: 2020 2020 2020 7375 6d6d 6172 795b 6d5f        summary[m_
-0001ead0: 6b65 795d 5b22 6e62 5f70 6172 616d 7322  key]["nb_params"
-0001eae0: 5d20 3d20 7061 7261 6d73 0d0a 0d0a 2020  ] = params....  
-0001eaf0: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
-0001eb00: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
-0001eb10: 6973 696e 7374 616e 6365 286d 6f64 756c  isinstance(modul
-0001eb20: 652c 2028 5365 7175 656e 7469 616c 2c20  e, (Sequential, 
-0001eb30: 4d6f 6475 6c65 4c69 7374 2c20 4d6f 6475  ModuleList, Modu
-0001eb40: 6c65 4469 6374 2929 0d0a 2020 2020 2020  leDict))..      
-0001eb50: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-0001eb60: 7420 286d 6f64 756c 6520 3d3d 206d 6f64  t (module == mod
-0001eb70: 656c 2061 6e64 206c 656e 286d 6f64 756c  el and len(modul
-0001eb80: 652e 5f70 6172 616d 6574 6572 7329 203d  e._parameters) =
-0001eb90: 3d20 3029 0d0a 2020 2020 2020 2020 293a  = 0)..        ):
-0001eba0: 0d0a 2020 2020 2020 2020 2020 2020 686f  ..            ho
-0001ebb0: 6f6b 732e 6170 7065 6e64 286d 6f64 756c  oks.append(modul
-0001ebc0: 652e 7265 6769 7374 6572 5f66 6f72 7761  e.register_forwa
-0001ebd0: 7264 5f68 6f6f 6b28 686f 6f6b 2929 0d0a  rd_hook(hook))..
-0001ebe0: 0d0a 2020 2020 6465 7669 6365 203d 2064  ..    device = d
-0001ebf0: 6576 6963 652e 6c6f 7765 7228 290d 0a20  evice.lower().. 
-0001ec00: 2020 2061 7373 6572 7420 6465 7669 6365     assert device
-0001ec10: 2069 6e20 5b0d 0a20 2020 2020 2020 2022   in [..        "
-0001ec20: 6375 6461 222c 0d0a 2020 2020 2020 2020  cuda",..        
-0001ec30: 2263 7075 222c 0d0a 2020 2020 5d2c 2022  "cpu",..    ], "
-0001ec40: 496e 7075 7420 6465 7669 6365 2069 7320  Input device is 
-0001ec50: 6e6f 7420 7661 6c69 642c 2070 6c65 6173  not valid, pleas
-0001ec60: 6520 7370 6563 6966 7920 2763 7564 6127  e specify 'cuda'
-0001ec70: 206f 7220 2763 7075 2722 0d0a 0d0a 2020   or 'cpu'"....  
-0001ec80: 2020 666f 7220 6e61 6d65 2c20 6d6f 6475    for name, modu
-0001ec90: 6c65 2069 6e20 6d6f 6465 6c2e 6e61 6d65  le in model.name
-0001eca0: 645f 6d6f 6475 6c65 7328 293a 0d0a 2020  d_modules():..  
-0001ecb0: 2020 2020 2020 6d6f 6475 6c65 2e72 656c        module.rel
-0001ecc0: 6174 6976 655f 6e61 6d65 203d 206e 616d  ative_name = nam
-0001ecd0: 650d 0a20 2020 2023 206d 756c 7469 706c  e..    # multipl
-0001ece0: 6520 696e 7075 7473 2074 6f20 7468 6520  e inputs to the 
-0001ecf0: 6e65 7477 6f72 6b0d 0a0d 0a20 2020 2023  network....    #
-0001ed00: 2070 7265 7665 6e74 2070 7974 6f72 6368   prevent pytorch
-0001ed10: 2027 5661 6c75 6545 7272 6f72 3a20 4578   'ValueError: Ex
-0001ed20: 7065 6374 6564 206d 6f72 6520 7468 616e  pected more than
-0001ed30: 2031 2076 616c 7565 2070 6572 2063 6861   1 value per cha
-0001ed40: 6e6e 656c 2077 6865 6e20 7472 6169 6e69  nnel when traini
-0001ed50: 6e67 2c20 676f 7420 696e 7075 7420 7369  ng, got input si
-0001ed60: 7a65 202e 2e2e 2e0d 0a20 2020 206d 6f64  ze ......    mod
-0001ed70: 656c 2e74 6f28 6765 745f 6465 7669 6365  el.to(get_device
-0001ed80: 2829 290d 0a20 2020 206d 6f64 656c 2e65  ())..    model.e
-0001ed90: 7661 6c28 290d 0a0d 0a20 2020 2069 6e70  val()....    inp
-0001eda0: 7320 3d20 4f72 6465 7265 6444 6963 7428  s = OrderedDict(
-0001edb0: 290d 0a20 2020 2066 6f72 2076 2069 6e20  )..    for v in 
-0001edc0: 696e 7075 745f 7370 6563 733a 0d0a 2020  input_specs:..  
-0001edd0: 2020 2020 2020 6b20 3d20 762e 6e61 6d65        k = v.name
-0001ede0: 0d0a 2020 2020 2020 2020 6966 2076 2e73  ..        if v.s
-0001edf0: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
-0001ee00: 2061 6e64 2076 2e73 6861 7065 2e5f 6469   and v.shape._di
-0001ee10: 6d73 2021 3d20 5b4e 6f6e 655d 3a0d 0a20  ms != [None]:.. 
-0001ee20: 2020 2020 2020 2020 2020 2069 6e70 735b             inps[
-0001ee30: 6b5d 203d 2074 6f5f 7465 6e73 6f72 2876  k] = to_tensor(v
-0001ee40: 2e67 6574 5f64 756d 6d79 5f74 656e 736f  .get_dummy_tenso
-0001ee50: 7228 292c 2064 6576 6963 653d 6765 745f  r(), device=get_
-0001ee60: 6465 7669 6365 2829 290d 0a20 2020 2020  device())..     
-0001ee70: 2020 2065 6c69 6620 762e 6f70 7469 6f6e     elif v.option
-0001ee80: 616c 3a0d 0a20 2020 2020 2020 2020 2020  al:..           
-0001ee90: 2069 6e70 735b 6b5d 203d 2076 2e64 6566   inps[k] = v.def
-0001eea0: 6175 6c74 0d0a 2020 2020 2020 2020 656c  ault..        el
-0001eeb0: 6966 2076 2e73 6861 7065 2069 7320 4e6f  if v.shape is No
-0001eec0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0001eed0: 2069 6e70 735b 6b5d 203d 204e 6f6e 650d   inps[k] = None.
-0001eee0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0001eef0: 2020 2020 2020 2020 2020 2020 696e 7073              inps
-0001ef00: 5b6b 5d20 3d20 4e6f 6e65 0d0a 2020 2020  [k] = None..    
-0001ef10: 2320 7020 2020 2072 696e 7428 7479 7065  # p    rint(type
-0001ef20: 2878 5b30 5d29 290d 0a0d 0a20 2020 2023  (x[0]))....    #
-0001ef30: 2063 7265 6174 6520 7072 6f70 6572 7469   create properti
-0001ef40: 6573 0d0a 2020 2020 7375 6d6d 6172 7920  es..    summary 
-0001ef50: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
-0001ef60: 0a20 2020 2068 6f6f 6b73 203d 205b 5d0d  .    hooks = [].
-0001ef70: 0a20 2020 2074 7279 3a0d 0a20 2020 2020  .    try:..     
-0001ef80: 2020 2023 2072 6567 6973 7465 7220 686f     # register ho
-0001ef90: 6f6b 0d0a 2020 2020 2020 2020 6d6f 6465  ok..        mode
-0001efa0: 6c2e 6170 706c 7928 7265 6769 7374 6572  l.apply(register
-0001efb0: 5f68 6f6f 6b29 0d0a 0d0a 2020 2020 2020  _hook)....      
-0001efc0: 2020 2320 6d61 6b65 2061 2066 6f72 7761    # make a forwa
-0001efd0: 7264 2070 6173 730d 0a20 2020 2020 2020  rd pass..       
-0001efe0: 2023 2070 7269 6e74 2878 2e73 6861 7065   # print(x.shape
-0001eff0: 290d 0a20 2020 2020 2020 2069 6620 696e  )..        if in
-0001f000: 7075 7473 2069 7320 6e6f 7420 4e6f 6e65  puts is not None
-0001f010: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0001f020: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
-0001f030: 7574 732c 204f 7264 6572 6564 4469 6374  uts, OrderedDict
-0001f040: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001f050: 2020 2020 6d6f 6465 6c28 2a6c 6973 7428      model(*list(
-0001f060: 696e 7073 2e76 616c 7565 7328 2929 290d  inps.values())).
-0001f070: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0001f080: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
-0001f090: 7574 732c 2028 5465 6e73 6f72 2c20 6e70  uts, (Tensor, np
-0001f0a0: 2e6e 6461 7272 6179 2929 3a0d 0a20 2020  .ndarray)):..   
-0001f0b0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0001f0c0: 656c 2869 6e70 7574 7329 0d0a 2020 2020  el(inputs)..    
-0001f0d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001f0e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001f0f0: 6f64 656c 282a 696e 7075 7473 290d 0a20  odel(*inputs).. 
-0001f100: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0001f110: 2020 2020 2020 2020 2020 6d6f 6465 6c28            model(
-0001f120: 2a69 6e70 732e 7661 6c75 655f 6c69 7374  *inps.value_list
-0001f130: 290d 0a0d 0a20 2020 2020 2020 2023 2072  )....        # r
-0001f140: 656d 6f76 6520 7468 6573 6520 686f 6f6b  emove these hook
-0001f150: 730d 0a20 2020 2020 2020 2066 6f72 2068  s..        for h
-0001f160: 2069 6e20 686f 6f6b 733a 0d0a 2020 2020   in hooks:..    
-0001f170: 2020 2020 2020 2020 682e 7265 6d6f 7665          h.remove
-0001f180: 2829 0d0a 2020 2020 2020 2020 6d61 785f  ()..        max_
-0001f190: 6e61 6d65 5f6c 656e 203d 2030 0d0a 2020  name_len = 0..  
-0001f1a0: 2020 2020 2020 6d61 785f 7765 6967 6874        max_weight
-0001f1b0: 5f6c 656e 203d 2030 0d0a 2020 2020 2020  _len = 0..      
-0001f1c0: 2020 666f 7220 6c61 7965 7220 696e 2073    for layer in s
-0001f1d0: 756d 6d61 7279 3a0d 0a20 2020 2020 2020  ummary:..       
-0001f1e0: 2020 2020 206d 6178 5f6e 616d 655f 6c65       max_name_le
-0001f1f0: 6e20 3d20 6275 696c 7469 6e73 2e6d 6178  n = builtins.max
-0001f200: 286d 6178 5f6e 616d 655f 6c65 6e2c 206c  (max_name_len, l
-0001f210: 656e 286c 6179 6572 202b 2022 2020 5b22  en(layer + "  ["
-0001f220: 202b 2073 756d 6d61 7279 5b6c 6179 6572   + summary[layer
-0001f230: 5d5b 2263 6c61 7373 5f6e 616d 6522 5d20  ]["class_name"] 
-0001f240: 2b20 225d 2229 202b 2035 290d 0a20 2020  + "]") + 5)..   
-0001f250: 2020 2020 2020 2020 206d 6178 5f77 6569           max_wei
-0001f260: 6768 745f 6c65 6e20 3d20 6275 696c 7469  ght_len = builti
-0001f270: 6e73 2e6d 6178 286d 6178 5f77 6569 6768  ns.max(max_weigh
-0001f280: 745f 6c65 6e2c 2062 7569 6c74 696e 732e  t_len, builtins.
-0001f290: 6d61 7828 0d0a 2020 2020 2020 2020 2020  max(..          
-0001f2a0: 2020 2020 2020 5b6c 656e 2873 7472 2869        [len(str(i
-0001f2b0: 7465 6d29 2e72 6570 6c61 6365 2827 2827  tem).replace('('
-0001f2c0: 2c20 2727 292e 7265 706c 6163 6528 2729  , '').replace(')
-0001f2d0: 272c 2027 2729 2920 666f 7220 6974 656d  ', '')) for item
-0001f2e0: 2069 6e0d 0a20 2020 2020 2020 2020 2020   in..           
-0001f2f0: 2020 2020 2020 7375 6d6d 6172 795b 6c61        summary[la
-0001f300: 7965 725d 5b22 7765 6967 6874 225d 2e69  yer]["weight"].i
-0001f310: 7465 6d73 2829 5d29 202b 2035 2069 6620  tems()]) + 5 if 
-0001f320: 6c65 6e28 0d0a 2020 2020 2020 2020 2020  len(..          
-0001f330: 2020 2020 2020 7375 6d6d 6172 795b 6c61        summary[la
-0001f340: 7965 725d 5b22 7765 6967 6874 225d 2920  yer]["weight"]) 
-0001f350: 3e20 3020 656c 7365 2035 290d 0a0d 0a20  > 0 else 5).... 
-0001f360: 2020 2020 2020 2070 7269 6e74 280d 0a20         print(.. 
-0001f370: 2020 2020 2020 2020 2020 2022 2d2d 2d2d             "----
-0001f380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f390: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f3a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f3b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f3c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f3d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f3e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f3f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2229 0d0a  ------------")..
-0001f400: 2020 2020 2020 2020 6c69 6e65 5f6e 6577          line_new
-0001f410: 203d 2022 7b30 3a5e 3530 737d 207b 313a   = "{0:^50s} {1:
-0001f420: 3c32 3573 7d20 207b 323a 3c33 3573 7d20  <25s}  {2:<35s} 
-0001f430: 7b33 3a3c 3873 7d20 207b 343a 3c38 737d  {3:<8s}  {4:<8s}
-0001f440: 2020 7b35 3a3c 3235 737d 222e 7265 706c    {5:<25s}".repl
-0001f450: 6163 6528 2735 3073 272c 0d0a 2020 2020  ace('50s',..    
-0001f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4b0: 7374 7228 6d61 785f 6e61 6d65 5f6c 656e  str(max_name_len
-0001f4c0: 2920 2b20 2773 2729 2e72 6570 6c61 6365  ) + 's').replace
-0001f4d0: 280d 0a20 2020 2020 2020 2020 2020 2027  (..            '
-0001f4e0: 3335 7327 2c20 7374 7228 6d61 785f 7765  35s', str(max_we
-0001f4f0: 6967 6874 5f6c 656e 2920 2b20 2773 2729  ight_len) + 's')
-0001f500: 2e66 6f72 6d61 7428 224c 6179 6572 2028  .format("Layer (
-0001f510: 7479 7065 2922 2c0d 0a20 2020 2020 2020  type)",..       
-0001f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f540: 2020 2020 2020 2020 2020 2020 2020 224f                "O
-0001f550: 7574 7075 7420 5368 6170 6522 2c0d 0a20  utput Shape",.. 
-0001f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f590: 2020 2020 2257 6569 6768 7420 222c 2022      "Weight ", "
-0001f5a0: 4269 6173 222c 0d0a 2020 2020 2020 2020  Bias",..        
-0001f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5d0: 2020 2020 2020 2020 2020 2020 2022 5061               "Pa
-0001f5e0: 7261 6d20 2322 2c0d 0a20 2020 2020 2020  ram #",..       
-0001f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f610: 2020 2020 2020 2020 2020 2020 2020 2246                "F
-0001f620: 4c4f 5053 2023 2229 0d0a 0d0a 2020 2020  LOPS #")....    
-0001f630: 2020 2020 7072 696e 7428 6c69 6e65 5f6e      print(line_n
-0001f640: 6577 290d 0a20 2020 2020 2020 2070 7269  ew)..        pri
-0001f650: 6e74 2822 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  nt("============
-0001f660: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f670: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f680: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f690: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f6a0: 3d3d 2229 0d0a 2020 2020 2020 2020 746f  ==")..        to
-0001f6b0: 7461 6c5f 7061 7261 6d73 203d 206e 702e  tal_params = np.
-0001f6c0: 6172 7261 7928 5b30 5d2c 2064 7479 7065  array([0], dtype
-0001f6d0: 3d6e 702e 666c 6f61 7436 3429 0d0a 2020  =np.float64)..  
-0001f6e0: 2020 2020 2020 746f 7461 6c5f 6f75 7470        total_outp
-0001f6f0: 7574 203d 2030 0d0a 2020 2020 2020 2020  ut = 0..        
-0001f700: 7472 6169 6e61 626c 655f 7061 7261 6d73  trainable_params
-0001f710: 203d 206e 702e 6172 7261 7928 5b30 5d2c   = np.array([0],
-0001f720: 2064 7479 7065 3d6e 702e 666c 6f61 7436   dtype=np.float6
-0001f730: 3429 0d0a 2020 2020 2020 2020 666c 6f70  4)..        flop
-0001f740: 7320 3d20 6e70 2e61 7272 6179 285b 305d  s = np.array([0]
-0001f750: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-0001f760: 3634 290d 0a20 2020 2020 2020 206d 6163  64)..        mac
-0001f770: 6320 3d20 6e70 2e61 7272 6179 285b 305d  c = np.array([0]
-0001f780: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-0001f790: 3634 290d 0a20 2020 2020 2020 2066 6f72  64)..        for
-0001f7a0: 206c 6179 6572 2069 6e20 7375 6d6d 6172   layer in summar
-0001f7b0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0001f7c0: 2320 696e 7075 745f 7368 6170 652c 206f  # input_shape, o
-0001f7d0: 7574 7075 745f 7368 6170 652c 2074 7261  utput_shape, tra
-0001f7e0: 696e 6162 6c65 2c20 6e62 5f70 6172 616d  inable, nb_param
-0001f7f0: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
-0001f800: 735f 6b65 6570 203d 2027 e298 8527 2069  s_keep = '...' i
-0001f810: 6620 7375 6d6d 6172 795b 6c61 7965 725d  f summary[layer]
-0001f820: 5b22 6b65 6570 5f6f 7574 7075 7422 5d20  ["keep_output"] 
-0001f830: 656c 7365 2027 270d 0a20 2020 2020 2020  else ''..       
-0001f840: 2020 2020 2063 6c61 7373 5f6e 616d 6520       class_name 
-0001f850: 3d20 7375 6d6d 6172 795b 6c61 7965 725d  = summary[layer]
-0001f860: 5b22 636c 6173 735f 6e61 6d65 225d 0d0a  ["class_name"]..
-0001f870: 2020 2020 2020 2020 2020 2020 2320 6c69              # li
-0001f880: 6e65 5f6e 6577 203d 2022 7b30 3a3c 3530  ne_new = "{0:<50
-0001f890: 737d 207b 313a 3c32 3073 7d20 207b 323a  s} {1:<20s}  {2:
-0001f8a0: 3c32 3073 7d20 7b33 3a3c 3873 7d20 207b  <20s} {3:<8s}  {
-0001f8b0: 343a 3c38 7d20 207b 353a 3c31 327d 222e  4:<8}  {5:<12}".
-0001f8c0: 666f 726d 6174 280d 0a20 2020 2020 2020  format(..       
-0001f8d0: 2020 2020 2023 2020 2020 206c 6179 6572       #     layer
-0001f8e0: 2b22 2020 222b 636c 6173 735f 6e61 6d65  +"  "+class_name
-0001f8f0: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
-0001f900: 2020 2020 2069 735f 6b65 6570 202b 2073       is_keep + s
-0001f910: 7472 2873 756d 6d61 7279 5b6c 6179 6572  tr(summary[layer
-0001f920: 5d5b 226f 7574 7075 745f 7368 6170 6522  ]["output_shape"
-0001f930: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
-0001f940: 2023 2020 2020 2073 7472 2873 756d 6d61   #     str(summa
-0001f950: 7279 5b6c 6179 6572 5d5b 2277 6569 6768  ry[layer]["weigh
-0001f960: 7422 5d20 6966 2027 7765 6967 6874 2720  t"] if 'weight' 
-0001f970: 696e 2073 756d 6d61 7279 5b6c 6179 6572  in summary[layer
-0001f980: 5d20 656c 7365 2027 2729 2c0d 0a20 2020  ] else ''),..   
-0001f990: 2020 2020 2020 2020 2023 2020 2020 2073           #     s
-0001f9a0: 7472 2873 756d 6d61 7279 5b6c 6179 6572  tr(summary[layer
-0001f9b0: 5d5b 2262 6961 7322 5d20 6966 2027 6269  ]["bias"] if 'bi
-0001f9c0: 6173 2720 696e 2073 756d 6d61 7279 5b6c  as' in summary[l
-0001f9d0: 6179 6572 5d20 656c 7365 2027 2729 2c0d  ayer] else ''),.
-0001f9e0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-0001f9f0: 2020 2073 756d 6d61 7279 5b6c 6179 6572     summary[layer
-0001fa00: 5d5b 226e 625f 7061 7261 6d73 225d 2c0d  ]["nb_params"],.
-0001fa10: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-0001fa20: 2020 2073 756d 6d61 7279 5b6c 6179 6572     summary[layer
-0001fa30: 5d5b 2266 6c6f 7073 225d 5b30 5d0d 0a20  ]["flops"][0].. 
-0001fa40: 2020 2020 2020 2020 2020 2023 2029 0d0a             # )..
-0001fa50: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
-0001fa60: 6e65 5f6e 6577 203d 2022 7b30 3a3c 3530  ne_new = "{0:<50
-0001fa70: 737d 207b 313a 3c32 3573 7d20 207b 323a  s} {1:<25s}  {2:
-0001fa80: 3c33 3573 7d20 7b33 3a3c 3873 7d20 207b  <35s} {3:<8s}  {
-0001fa90: 343a 2c2e 3066 7d20 207b 353a 2c2e 3066  4:,.0f}  {5:,.0f
-0001faa0: 7d20 2022 2e72 6570 6c61 6365 2827 3530  }  ".replace('50
-0001fab0: 7327 2c0d 0a20 2020 2020 2020 2020 2020  s',..           
-0001fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb10: 7374 7228 6d61 785f 6e61 6d65 5f6c 656e  str(max_name_len
-0001fb20: 2920 2b20 2773 2729 2e72 6570 6c61 6365  ) + 's').replace
-0001fb30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0001fb40: 2020 2027 3335 7327 2c20 7374 7228 6d61     '35s', str(ma
-0001fb50: 785f 7765 6967 6874 5f6c 656e 2920 2b20  x_weight_len) + 
-0001fb60: 2773 2729 2e66 6f72 6d61 7428 0d0a 2020  's').format(..  
-0001fb70: 2020 2020 2020 2020 2020 2020 2020 286c                (l
-0001fb80: 6179 6572 202b 2022 2020 5b22 202b 2063  ayer + "  [" + c
-0001fb90: 6c61 7373 5f6e 616d 6520 2b20 225d 2229  lass_name + "]")
-0001fba0: 2e6c 6a75 7374 286d 6178 5f6e 616d 655f  .ljust(max_name_
-0001fbb0: 6c65 6e2c 2027 2027 292c 0d0a 2020 2020  len, ' '),..    
-0001fbc0: 2020 2020 2020 2020 2020 2020 2869 735f              (is_
-0001fbd0: 6b65 6570 202b 2073 7472 285b 4e6f 6e65  keep + str([None
-0001fbe0: 5d20 2b20 7375 6d6d 6172 795b 6c61 7965  ] + summary[laye
-0001fbf0: 725d 5b22 6f75 7470 7574 5f73 6861 7065  r]["output_shape
-0001fc00: 225d 5b31 3a5d 2929 2e6c 6a75 7374 2832  "][1:])).ljust(2
-0001fc10: 352c 2027 2027 292c 0d0a 2020 2020 2020  5, ' '),..      
-0001fc20: 2020 2020 2020 2020 2020 7374 7228 7375            str(su
-0001fc30: 6d6d 6172 795b 6c61 7965 725d 5b22 7765  mmary[layer]["we
-0001fc40: 6967 6874 225d 2e69 7465 6d5f 6c69 7374  ight"].item_list
-0001fc50: 5b30 5d20 6966 2027 7765 6967 6874 2720  [0] if 'weight' 
-0001fc60: 696e 2073 756d 6d61 7279 5b6c 6179 6572  in summary[layer
-0001fc70: 5d20 616e 6420 6c65 6e28 0d0a 2020 2020  ] and len(..    
-0001fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc90: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
-0001fca0: 7765 6967 6874 225d 2920 3e20 3020 656c  weight"]) > 0 el
-0001fcb0: 7365 2027 2027 292e 7265 706c 6163 6528  se ' ').replace(
-0001fcc0: 2728 272c 2027 2729 2e72 6570 6c61 6365  '(', '').replace
-0001fcd0: 2827 2927 2c20 2727 292e 6c6a 7573 7428  (')', '').ljust(
-0001fce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001fcf0: 2020 2020 2020 6d61 785f 7765 6967 6874        max_weight
-0001fd00: 5f6c 656e 2c20 2720 2729 2c0d 0a20 2020  _len, ' '),..   
-0001fd10: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0001fd20: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
-0001fd30: 2262 6961 7322 5d2e 6974 656d 5f6c 6973  "bias"].item_lis
-0001fd40: 745b 305d 2069 6620 2762 6961 7327 2069  t[0] if 'bias' i
-0001fd50: 6e20 7375 6d6d 6172 795b 6c61 7965 725d  n summary[layer]
-0001fd60: 2061 6e64 206c 656e 280d 0a20 2020 2020   and len(..     
-0001fd70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001fd80: 756d 6d61 7279 5b6c 6179 6572 5d5b 2262  ummary[layer]["b
-0001fd90: 6961 7322 5d29 203e 2030 2065 6c73 6520  ias"]) > 0 else 
-0001fda0: 2720 2729 2e72 6570 6c61 6365 2827 2827  ' ').replace('('
-0001fdb0: 2c20 2727 292e 7265 706c 6163 6528 2729  , '').replace(')
-0001fdc0: 272c 2027 2729 2e6c 6a75 7374 2838 2c20  ', '').ljust(8, 
-0001fdd0: 2720 2729 2c0d 0a20 2020 2020 2020 2020  ' '),..         
-0001fde0: 2020 2020 2020 2073 756d 6d61 7279 5b6c         summary[l
-0001fdf0: 6179 6572 5d5b 226e 625f 7061 7261 6d73  ayer]["nb_params
-0001fe00: 225d 2c0d 0a20 2020 2020 2020 2020 2020  "],..           
-0001fe10: 2020 2020 2073 756d 6d61 7279 5b6c 6179       summary[lay
-0001fe20: 6572 5d5b 2266 6c6f 7073 225d 2e73 756d  er]["flops"].sum
-0001fe30: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0001fe40: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0001fe50: 6620 6c65 6e28 7375 6d6d 6172 795b 6c61  f len(summary[la
-0001fe60: 7965 725d 5b22 7765 6967 6874 225d 2920  yer]["weight"]) 
-0001fe70: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
-0001fe80: 2020 2020 2020 666f 7220 6e20 696e 2072        for n in r
-0001fe90: 616e 6765 2831 2c20 6c65 6e28 7375 6d6d  ange(1, len(summ
-0001fea0: 6172 795b 6c61 7965 725d 5b22 7765 6967  ary[layer]["weig
-0001feb0: 6874 225d 2929 3a0d 0a20 2020 2020 2020  ht"])):..       
-0001fec0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-0001fed0: 655f 6e65 775f 6164 6420 3d20 227b 303a  e_new_add = "{0:
-0001fee0: 3c35 3073 7d20 7b31 3a3c 3235 737d 2020  <50s} {1:<25s}  
-0001fef0: 7b32 3a3c 3335 737d 207b 333a 3c38 737d  {2:<35s} {3:<8s}
-0001ff00: 2020 7b34 7d20 207b 357d 2020 222e 7265    {4}  {5}  ".re
-0001ff10: 706c 6163 6528 2735 3073 272c 0d0a 2020  place('50s',..  
-0001ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e850: 2073 756d 6d61 7279 5b6d 5f6b 6579 5d5b   summary[m_key][
+0001e860: 226d 6163 6322 5d20 2b3d 206e 756d 5f70  "macc"] += num_p
+0001e870: 6172 616d 7320 2a20 7370 6174 6961 6c5f  arams * spatial_
+0001e880: 6469 6d73 0d0a 0d0a 2020 2020 2020 2020  dims....        
+0001e890: 2020 2020 7375 6d6d 6172 795b 6d5f 6b65      summary[m_ke
+0001e8a0: 795d 5b22 6e62 5f70 6172 616d 7322 5d20  y]["nb_params"] 
+0001e8b0: 3d20 7061 7261 6d73 0d0a 0d0a 2020 2020  = params....    
+0001e8c0: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
+0001e8d0: 2020 2020 2020 2020 2020 6e6f 7420 6973            not is
+0001e8e0: 696e 7374 616e 6365 286d 6f64 756c 652c  instance(module,
+0001e8f0: 2028 5365 7175 656e 7469 616c 2c20 4d6f   (Sequential, Mo
+0001e900: 6475 6c65 4c69 7374 2c20 4d6f 6475 6c65  duleList, Module
+0001e910: 4469 6374 2929 0d0a 2020 2020 2020 2020  Dict))..        
+0001e920: 2020 2020 2020 2020 616e 6420 6e6f 7420          and not 
+0001e930: 286d 6f64 756c 6520 3d3d 206d 6f64 656c  (module == model
+0001e940: 2061 6e64 206c 656e 286d 6f64 756c 652e   and len(module.
+0001e950: 5f70 6172 616d 6574 6572 7329 203d 3d20  _parameters) == 
+0001e960: 3029 0d0a 2020 2020 2020 2020 293a 0d0a  0)..        ):..
+0001e970: 2020 2020 2020 2020 2020 2020 686f 6f6b              hook
+0001e980: 732e 6170 7065 6e64 286d 6f64 756c 652e  s.append(module.
+0001e990: 7265 6769 7374 6572 5f66 6f72 7761 7264  register_forward
+0001e9a0: 5f68 6f6f 6b28 686f 6f6b 2929 0d0a 0d0a  _hook(hook))....
+0001e9b0: 2020 2020 6465 7669 6365 203d 2064 6576      device = dev
+0001e9c0: 6963 652e 6c6f 7765 7228 290d 0a20 2020  ice.lower()..   
+0001e9d0: 2061 7373 6572 7420 6465 7669 6365 2069   assert device i
+0001e9e0: 6e20 5b0d 0a20 2020 2020 2020 2022 6375  n [..        "cu
+0001e9f0: 6461 222c 0d0a 2020 2020 2020 2020 2263  da",..        "c
+0001ea00: 7075 222c 0d0a 2020 2020 5d2c 2022 496e  pu",..    ], "In
+0001ea10: 7075 7420 6465 7669 6365 2069 7320 6e6f  put device is no
+0001ea20: 7420 7661 6c69 642c 2070 6c65 6173 6520  t valid, please 
+0001ea30: 7370 6563 6966 7920 2763 7564 6127 206f  specify 'cuda' o
+0001ea40: 7220 2763 7075 2722 0d0a 0d0a 2020 2020  r 'cpu'"....    
+0001ea50: 666f 7220 6e61 6d65 2c20 6d6f 6475 6c65  for name, module
+0001ea60: 2069 6e20 6d6f 6465 6c2e 6e61 6d65 645f   in model.named_
+0001ea70: 6d6f 6475 6c65 7328 293a 0d0a 2020 2020  modules():..    
+0001ea80: 2020 2020 6d6f 6475 6c65 2e72 656c 6174      module.relat
+0001ea90: 6976 655f 6e61 6d65 203d 206e 616d 650d  ive_name = name.
+0001eaa0: 0a20 2020 2023 206d 756c 7469 706c 6520  .    # multiple 
+0001eab0: 696e 7075 7473 2074 6f20 7468 6520 6e65  inputs to the ne
+0001eac0: 7477 6f72 6b0d 0a0d 0a20 2020 2023 2070  twork....    # p
+0001ead0: 7265 7665 6e74 2070 7974 6f72 6368 2027  revent pytorch '
+0001eae0: 5661 6c75 6545 7272 6f72 3a20 4578 7065  ValueError: Expe
+0001eaf0: 6374 6564 206d 6f72 6520 7468 616e 2031  cted more than 1
+0001eb00: 2076 616c 7565 2070 6572 2063 6861 6e6e   value per chann
+0001eb10: 656c 2077 6865 6e20 7472 6169 6e69 6e67  el when training
+0001eb20: 2c20 676f 7420 696e 7075 7420 7369 7a65  , got input size
+0001eb30: 202e 2e2e 2e0d 0a20 2020 206d 6f64 656c   ......    model
+0001eb40: 2e74 6f28 6765 745f 6465 7669 6365 2829  .to(get_device()
+0001eb50: 290d 0a20 2020 206d 6f64 656c 2e65 7661  )..    model.eva
+0001eb60: 6c28 290d 0a0d 0a20 2020 2069 6e70 7320  l()....    inps 
+0001eb70: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
+0001eb80: 0a20 2020 2066 6f72 2076 2069 6e20 696e  .    for v in in
+0001eb90: 7075 745f 7370 6563 733a 0d0a 2020 2020  put_specs:..    
+0001eba0: 2020 2020 6b20 3d20 762e 6e61 6d65 0d0a      k = v.name..
+0001ebb0: 2020 2020 2020 2020 6966 2076 2e73 6861          if v.sha
+0001ebc0: 7065 2069 7320 6e6f 7420 4e6f 6e65 2061  pe is not None a
+0001ebd0: 6e64 2076 2e73 6861 7065 2e5f 6469 6d73  nd v.shape._dims
+0001ebe0: 2021 3d20 5b4e 6f6e 655d 3a0d 0a20 2020   != [None]:..   
+0001ebf0: 2020 2020 2020 2020 2069 6e70 735b 6b5d           inps[k]
+0001ec00: 203d 2074 6f5f 7465 6e73 6f72 2876 2e67   = to_tensor(v.g
+0001ec10: 6574 5f64 756d 6d79 5f74 656e 736f 7228  et_dummy_tensor(
+0001ec20: 292c 2064 6576 6963 653d 6765 745f 6465  ), device=get_de
+0001ec30: 7669 6365 2829 290d 0a20 2020 2020 2020  vice())..       
+0001ec40: 2065 6c69 6620 762e 6f70 7469 6f6e 616c   elif v.optional
+0001ec50: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0001ec60: 6e70 735b 6b5d 203d 2076 2e64 6566 6175  nps[k] = v.defau
+0001ec70: 6c74 0d0a 2020 2020 2020 2020 656c 6966  lt..        elif
+0001ec80: 2076 2e73 6861 7065 2069 7320 4e6f 6e65   v.shape is None
+0001ec90: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0001eca0: 6e70 735b 6b5d 203d 204e 6f6e 650d 0a20  nps[k] = None.. 
+0001ecb0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0001ecc0: 2020 2020 2020 2020 2020 696e 7073 5b6b            inps[k
+0001ecd0: 5d20 3d20 4e6f 6e65 0d0a 2020 2020 2320  ] = None..    # 
+0001ece0: 7020 2020 2072 696e 7428 7479 7065 2878  p    rint(type(x
+0001ecf0: 5b30 5d29 290d 0a0d 0a20 2020 2023 2063  [0]))....    # c
+0001ed00: 7265 6174 6520 7072 6f70 6572 7469 6573  reate properties
+0001ed10: 0d0a 2020 2020 7375 6d6d 6172 7920 3d20  ..    summary = 
+0001ed20: 4f72 6465 7265 6444 6963 7428 290d 0a20  OrderedDict().. 
+0001ed30: 2020 2068 6f6f 6b73 203d 205b 5d0d 0a20     hooks = [].. 
+0001ed40: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0001ed50: 2023 2072 6567 6973 7465 7220 686f 6f6b   # register hook
+0001ed60: 0d0a 2020 2020 2020 2020 6d6f 6465 6c2e  ..        model.
+0001ed70: 6170 706c 7928 7265 6769 7374 6572 5f68  apply(register_h
+0001ed80: 6f6f 6b29 0d0a 0d0a 2020 2020 2020 2020  ook)....        
+0001ed90: 2320 6d61 6b65 2061 2066 6f72 7761 7264  # make a forward
+0001eda0: 2070 6173 730d 0a20 2020 2020 2020 2023   pass..        #
+0001edb0: 2070 7269 6e74 2878 2e73 6861 7065 290d   print(x.shape).
+0001edc0: 0a20 2020 2020 2020 2069 6620 696e 7075  .        if inpu
+0001edd0: 7473 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ts is not None:.
+0001ede0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001edf0: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
+0001ee00: 732c 204f 7264 6572 6564 4469 6374 293a  s, OrderedDict):
+0001ee10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ee20: 2020 6d6f 6465 6c28 2a6c 6973 7428 696e    model(*list(in
+0001ee30: 7073 2e76 616c 7565 7328 2929 290d 0a20  ps.values())).. 
+0001ee40: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001ee50: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
+0001ee60: 732c 2028 5465 6e73 6f72 2c20 6e70 2e6e  s, (Tensor, np.n
+0001ee70: 6461 7272 6179 2929 3a0d 0a20 2020 2020  darray)):..     
+0001ee80: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001ee90: 2869 6e70 7574 7329 0d0a 2020 2020 2020  (inputs)..      
+0001eea0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0001eeb0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0001eec0: 656c 282a 696e 7075 7473 290d 0a20 2020  el(*inputs)..   
+0001eed0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0001eee0: 2020 2020 2020 2020 6d6f 6465 6c28 2a69          model(*i
+0001eef0: 6e70 732e 7661 6c75 655f 6c69 7374 290d  nps.value_list).
+0001ef00: 0a0d 0a20 2020 2020 2020 2023 2072 656d  ...        # rem
+0001ef10: 6f76 6520 7468 6573 6520 686f 6f6b 730d  ove these hooks.
+0001ef20: 0a20 2020 2020 2020 2066 6f72 2068 2069  .        for h i
+0001ef30: 6e20 686f 6f6b 733a 0d0a 2020 2020 2020  n hooks:..      
+0001ef40: 2020 2020 2020 682e 7265 6d6f 7665 2829        h.remove()
+0001ef50: 0d0a 2020 2020 2020 2020 6d61 785f 6e61  ..        max_na
+0001ef60: 6d65 5f6c 656e 203d 2030 0d0a 2020 2020  me_len = 0..    
+0001ef70: 2020 2020 6d61 785f 7765 6967 6874 5f6c      max_weight_l
+0001ef80: 656e 203d 2030 0d0a 2020 2020 2020 2020  en = 0..        
+0001ef90: 666f 7220 6c61 7965 7220 696e 2073 756d  for layer in sum
+0001efa0: 6d61 7279 3a0d 0a20 2020 2020 2020 2020  mary:..         
+0001efb0: 2020 206d 6178 5f6e 616d 655f 6c65 6e20     max_name_len 
+0001efc0: 3d20 6275 696c 7469 6e73 2e6d 6178 286d  = builtins.max(m
+0001efd0: 6178 5f6e 616d 655f 6c65 6e2c 206c 656e  ax_name_len, len
+0001efe0: 286c 6179 6572 202b 2022 2020 5b22 202b  (layer + "  [" +
+0001eff0: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+0001f000: 2263 6c61 7373 5f6e 616d 6522 5d20 2b20  "class_name"] + 
+0001f010: 225d 2229 202b 2035 290d 0a20 2020 2020  "]") + 5)..     
+0001f020: 2020 2020 2020 206d 6178 5f77 6569 6768         max_weigh
+0001f030: 745f 6c65 6e20 3d20 6275 696c 7469 6e73  t_len = builtins
+0001f040: 2e6d 6178 286d 6178 5f77 6569 6768 745f  .max(max_weight_
+0001f050: 6c65 6e2c 2062 7569 6c74 696e 732e 6d61  len, builtins.ma
+0001f060: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+0001f070: 2020 2020 5b6c 656e 2873 7472 2869 7465      [len(str(ite
+0001f080: 6d29 2e72 6570 6c61 6365 2827 2827 2c20  m).replace('(', 
+0001f090: 2727 292e 7265 706c 6163 6528 2729 272c  '').replace(')',
+0001f0a0: 2027 2729 2920 666f 7220 6974 656d 2069   '')) for item i
+0001f0b0: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+0001f0c0: 2020 2020 7375 6d6d 6172 795b 6c61 7965      summary[laye
+0001f0d0: 725d 5b22 7765 6967 6874 225d 2e69 7465  r]["weight"].ite
+0001f0e0: 6d73 2829 5d29 202b 2035 2069 6620 6c65  ms()]) + 5 if le
+0001f0f0: 6e28 0d0a 2020 2020 2020 2020 2020 2020  n(..            
+0001f100: 2020 2020 7375 6d6d 6172 795b 6c61 7965      summary[laye
+0001f110: 725d 5b22 7765 6967 6874 225d 2920 3e20  r]["weight"]) > 
+0001f120: 3020 656c 7365 2035 290d 0a0d 0a20 2020  0 else 5)....   
+0001f130: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
+0001f140: 2020 2020 2020 2020 2022 2d2d 2d2d 2d2d           "------
+0001f150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f1a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f1b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f1c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2229 0d0a 2020  ----------")..  
+0001f1d0: 2020 2020 2020 6c69 6e65 5f6e 6577 203d        line_new =
+0001f1e0: 2022 7b30 3a5e 3530 737d 207b 313a 3c32   "{0:^50s} {1:<2
+0001f1f0: 3573 7d20 207b 323a 3c33 3573 7d20 7b33  5s}  {2:<35s} {3
+0001f200: 3a3c 3873 7d20 207b 343a 3c38 737d 2020  :<8s}  {4:<8s}  
+0001f210: 7b35 3a3c 3235 737d 222e 7265 706c 6163  {5:<25s}".replac
+0001f220: 6528 2735 3073 272c 0d0a 2020 2020 2020  e('50s',..      
+0001f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0001f280: 7228 6d61 785f 6e61 6d65 5f6c 656e 2920  r(max_name_len) 
+0001f290: 2b20 2773 2729 2e72 6570 6c61 6365 280d  + 's').replace(.
+0001f2a0: 0a20 2020 2020 2020 2020 2020 2027 3335  .            '35
+0001f2b0: 7327 2c20 7374 7228 6d61 785f 7765 6967  s', str(max_weig
+0001f2c0: 6874 5f6c 656e 2920 2b20 2773 2729 2e66  ht_len) + 's').f
+0001f2d0: 6f72 6d61 7428 224c 6179 6572 2028 7479  ormat("Layer (ty
+0001f2e0: 7065 2922 2c0d 0a20 2020 2020 2020 2020  pe)",..         
+0001f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f310: 2020 2020 2020 2020 2020 2020 224f 7574              "Out
+0001f320: 7075 7420 5368 6170 6522 2c0d 0a20 2020  put Shape",..   
+0001f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f360: 2020 2257 6569 6768 7420 222c 2022 4269    "Weight ", "Bi
+0001f370: 6173 222c 0d0a 2020 2020 2020 2020 2020  as",..          
+0001f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3a0: 2020 2020 2020 2020 2020 2022 5061 7261             "Para
+0001f3b0: 6d20 2322 2c0d 0a20 2020 2020 2020 2020  m #",..         
+0001f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3e0: 2020 2020 2020 2020 2020 2020 2246 4c4f              "FLO
+0001f3f0: 5053 2023 2229 0d0a 0d0a 2020 2020 2020  PS #")....      
+0001f400: 2020 7072 696e 7428 6c69 6e65 5f6e 6577    print(line_new
+0001f410: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+0001f420: 2822 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ("==============
+0001f430: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001f440: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001f450: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001f460: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001f470: 2229 0d0a 2020 2020 2020 2020 746f 7461  ")..        tota
+0001f480: 6c5f 7061 7261 6d73 203d 206e 702e 6172  l_params = np.ar
+0001f490: 7261 7928 5b30 5d2c 2064 7479 7065 3d6e  ray([0], dtype=n
+0001f4a0: 702e 666c 6f61 7436 3429 0d0a 2020 2020  p.float64)..    
+0001f4b0: 2020 2020 746f 7461 6c5f 6f75 7470 7574      total_output
+0001f4c0: 203d 2030 0d0a 2020 2020 2020 2020 7472   = 0..        tr
+0001f4d0: 6169 6e61 626c 655f 7061 7261 6d73 203d  ainable_params =
+0001f4e0: 206e 702e 6172 7261 7928 5b30 5d2c 2064   np.array([0], d
+0001f4f0: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
+0001f500: 0d0a 2020 2020 2020 2020 666c 6f70 7320  ..        flops 
+0001f510: 3d20 6e70 2e61 7272 6179 285b 305d 2c20  = np.array([0], 
+0001f520: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+0001f530: 290d 0a20 2020 2020 2020 206d 6163 6320  )..        macc 
+0001f540: 3d20 6e70 2e61 7272 6179 285b 305d 2c20  = np.array([0], 
+0001f550: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+0001f560: 290d 0a20 2020 2020 2020 2066 6f72 206c  )..        for l
+0001f570: 6179 6572 2069 6e20 7375 6d6d 6172 793a  ayer in summary:
+0001f580: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0001f590: 696e 7075 745f 7368 6170 652c 206f 7574  input_shape, out
+0001f5a0: 7075 745f 7368 6170 652c 2074 7261 696e  put_shape, train
+0001f5b0: 6162 6c65 2c20 6e62 5f70 6172 616d 730d  able, nb_params.
+0001f5c0: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+0001f5d0: 6b65 6570 203d 2027 e298 8527 2069 6620  keep = '...' if 
+0001f5e0: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+0001f5f0: 6b65 6570 5f6f 7574 7075 7422 5d20 656c  keep_output"] el
+0001f600: 7365 2027 270d 0a20 2020 2020 2020 2020  se ''..         
+0001f610: 2020 2063 6c61 7373 5f6e 616d 6520 3d20     class_name = 
+0001f620: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
+0001f630: 636c 6173 735f 6e61 6d65 225d 0d0a 2020  class_name"]..  
+0001f640: 2020 2020 2020 2020 2020 2320 6c69 6e65            # line
+0001f650: 5f6e 6577 203d 2022 7b30 3a3c 3530 737d  _new = "{0:<50s}
+0001f660: 207b 313a 3c32 3073 7d20 207b 323a 3c32   {1:<20s}  {2:<2
+0001f670: 3073 7d20 7b33 3a3c 3873 7d20 207b 343a  0s} {3:<8s}  {4:
+0001f680: 3c38 7d20 207b 353a 3c31 327d 222e 666f  <8}  {5:<12}".fo
+0001f690: 726d 6174 280d 0a20 2020 2020 2020 2020  rmat(..         
+0001f6a0: 2020 2023 2020 2020 206c 6179 6572 2b22     #     layer+"
+0001f6b0: 2020 222b 636c 6173 735f 6e61 6d65 2c0d    "+class_name,.
+0001f6c0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0001f6d0: 2020 2069 735f 6b65 6570 202b 2073 7472     is_keep + str
+0001f6e0: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
+0001f6f0: 226f 7574 7075 745f 7368 6170 6522 5d29  "output_shape"])
+0001f700: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
+0001f710: 2020 2020 2073 7472 2873 756d 6d61 7279       str(summary
+0001f720: 5b6c 6179 6572 5d5b 2277 6569 6768 7422  [layer]["weight"
+0001f730: 5d20 6966 2027 7765 6967 6874 2720 696e  ] if 'weight' in
+0001f740: 2073 756d 6d61 7279 5b6c 6179 6572 5d20   summary[layer] 
+0001f750: 656c 7365 2027 2729 2c0d 0a20 2020 2020  else ''),..     
+0001f760: 2020 2020 2020 2023 2020 2020 2073 7472         #     str
+0001f770: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
+0001f780: 2262 6961 7322 5d20 6966 2027 6269 6173  "bias"] if 'bias
+0001f790: 2720 696e 2073 756d 6d61 7279 5b6c 6179  ' in summary[lay
+0001f7a0: 6572 5d20 656c 7365 2027 2729 2c0d 0a20  er] else ''),.. 
+0001f7b0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0001f7c0: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+0001f7d0: 226e 625f 7061 7261 6d73 225d 2c0d 0a20  "nb_params"],.. 
+0001f7e0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0001f7f0: 2073 756d 6d61 7279 5b6c 6179 6572 5d5b   summary[layer][
+0001f800: 2266 6c6f 7073 225d 5b30 5d0d 0a20 2020  "flops"][0]..   
+0001f810: 2020 2020 2020 2020 2023 2029 0d0a 0d0a           # )....
+0001f820: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0001f830: 5f6e 6577 203d 2022 7b30 3a3c 3530 737d  _new = "{0:<50s}
+0001f840: 207b 313a 3c32 3573 7d20 207b 323a 3c33   {1:<25s}  {2:<3
+0001f850: 3573 7d20 7b33 3a3c 3873 7d20 207b 343a  5s} {3:<8s}  {4:
+0001f860: 2c2e 3066 7d20 207b 353a 2c2e 3066 7d20  ,.0f}  {5:,.0f} 
+0001f870: 2022 2e72 6570 6c61 6365 2827 3530 7327   ".replace('50s'
+0001f880: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8d0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0001f8e0: 7228 6d61 785f 6e61 6d65 5f6c 656e 2920  r(max_name_len) 
+0001f8f0: 2b20 2773 2729 2e72 6570 6c61 6365 280d  + 's').replace(.
+0001f900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f910: 2027 3335 7327 2c20 7374 7228 6d61 785f   '35s', str(max_
+0001f920: 7765 6967 6874 5f6c 656e 2920 2b20 2773  weight_len) + 's
+0001f930: 2729 2e66 6f72 6d61 7428 0d0a 2020 2020  ').format(..    
+0001f940: 2020 2020 2020 2020 2020 2020 286c 6179              (lay
+0001f950: 6572 202b 2022 2020 5b22 202b 2063 6c61  er + "  [" + cla
+0001f960: 7373 5f6e 616d 6520 2b20 225d 2229 2e6c  ss_name + "]").l
+0001f970: 6a75 7374 286d 6178 5f6e 616d 655f 6c65  just(max_name_le
+0001f980: 6e2c 2027 2027 292c 0d0a 2020 2020 2020  n, ' '),..      
+0001f990: 2020 2020 2020 2020 2020 2869 735f 6b65            (is_ke
+0001f9a0: 6570 202b 2073 7472 285b 4e6f 6e65 5d20  ep + str([None] 
+0001f9b0: 2b20 7375 6d6d 6172 795b 6c61 7965 725d  + summary[layer]
+0001f9c0: 5b22 6f75 7470 7574 5f73 6861 7065 225d  ["output_shape"]
+0001f9d0: 5b31 3a5d 2929 2e6c 6a75 7374 2832 352c  [1:])).ljust(25,
+0001f9e0: 2027 2027 292c 0d0a 2020 2020 2020 2020   ' '),..        
+0001f9f0: 2020 2020 2020 2020 7374 7228 7375 6d6d          str(summ
+0001fa00: 6172 795b 6c61 7965 725d 5b22 7765 6967  ary[layer]["weig
+0001fa10: 6874 225d 2e69 7465 6d5f 6c69 7374 5b30  ht"].item_list[0
+0001fa20: 5d20 6966 2027 7765 6967 6874 2720 696e  ] if 'weight' in
+0001fa30: 2073 756d 6d61 7279 5b6c 6179 6572 5d20   summary[layer] 
+0001fa40: 616e 6420 6c65 6e28 0d0a 2020 2020 2020  and len(..      
+0001fa50: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0001fa60: 6d6d 6172 795b 6c61 7965 725d 5b22 7765  mmary[layer]["we
+0001fa70: 6967 6874 225d 2920 3e20 3020 656c 7365  ight"]) > 0 else
+0001fa80: 2027 2027 292e 7265 706c 6163 6528 2728   ' ').replace('(
+0001fa90: 272c 2027 2729 2e72 6570 6c61 6365 2827  ', '').replace('
+0001faa0: 2927 2c20 2727 292e 6c6a 7573 7428 0d0a  )', '').ljust(..
+0001fab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fac0: 2020 2020 6d61 785f 7765 6967 6874 5f6c      max_weight_l
+0001fad0: 656e 2c20 2720 2729 2c0d 0a20 2020 2020  en, ' '),..     
+0001fae0: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
+0001faf0: 756d 6d61 7279 5b6c 6179 6572 5d5b 2262  ummary[layer]["b
+0001fb00: 6961 7322 5d2e 6974 656d 5f6c 6973 745b  ias"].item_list[
+0001fb10: 305d 2069 6620 2762 6961 7327 2069 6e20  0] if 'bias' in 
+0001fb20: 7375 6d6d 6172 795b 6c61 7965 725d 2061  summary[layer] a
+0001fb30: 6e64 206c 656e 280d 0a20 2020 2020 2020  nd len(..       
+0001fb40: 2020 2020 2020 2020 2020 2020 2073 756d               sum
+0001fb50: 6d61 7279 5b6c 6179 6572 5d5b 2262 6961  mary[layer]["bia
+0001fb60: 7322 5d29 203e 2030 2065 6c73 6520 2720  s"]) > 0 else ' 
+0001fb70: 2729 2e72 6570 6c61 6365 2827 2827 2c20  ').replace('(', 
+0001fb80: 2727 292e 7265 706c 6163 6528 2729 272c  '').replace(')',
+0001fb90: 2027 2729 2e6c 6a75 7374 2838 2c20 2720   '').ljust(8, ' 
+0001fba0: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
+0001fbb0: 2020 2020 2073 756d 6d61 7279 5b6c 6179       summary[lay
+0001fbc0: 6572 5d5b 226e 625f 7061 7261 6d73 225d  er]["nb_params"]
+0001fbd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001fbe0: 2020 2073 756d 6d61 7279 5b6c 6179 6572     summary[layer
+0001fbf0: 5d5b 2266 6c6f 7073 225d 2e73 756d 2829  ]["flops"].sum()
+0001fc00: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+0001fc10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001fc20: 6c65 6e28 7375 6d6d 6172 795b 6c61 7965  len(summary[laye
+0001fc30: 725d 5b22 7765 6967 6874 225d 2920 3e20  r]["weight"]) > 
+0001fc40: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+0001fc50: 2020 2020 666f 7220 6e20 696e 2072 616e      for n in ran
+0001fc60: 6765 2831 2c20 6c65 6e28 7375 6d6d 6172  ge(1, len(summar
+0001fc70: 795b 6c61 7965 725d 5b22 7765 6967 6874  y[layer]["weight
+0001fc80: 225d 2929 3a0d 0a20 2020 2020 2020 2020  "])):..         
+0001fc90: 2020 2020 2020 2020 2020 206c 696e 655f             line_
+0001fca0: 6e65 775f 6164 6420 3d20 227b 303a 3c35  new_add = "{0:<5
+0001fcb0: 3073 7d20 7b31 3a3c 3235 737d 2020 7b32  0s} {1:<25s}  {2
+0001fcc0: 3a3c 3335 737d 207b 333a 3c38 737d 2020  :<35s} {3:<8s}  
+0001fcd0: 7b34 7d20 207b 357d 2020 222e 7265 706c  {4}  {5}  ".repl
+0001fce0: 6163 6528 2735 3073 272c 0d0a 2020 2020  ace('50s',..    
+0001fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd40: 2020 2020 2020 2020 2073 7472 286d 6178           str(max
+0001fd50: 5f6e 616d 655f 6c65 6e29 202b 2027 7327  _name_len) + 's'
+0001fd60: 292e 7265 706c 6163 6528 0d0a 2020 2020  ).replace(..    
+0001fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd80: 2020 2020 2733 3573 272c 2073 7472 286d      '35s', str(m
+0001fd90: 6178 5f77 6569 6768 745f 6c65 6e29 202b  ax_weight_len) +
+0001fda0: 2027 7327 292e 666f 726d 6174 280d 0a20   's').format(.. 
+0001fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdc0: 2020 2020 2020 2022 2022 2e6c 6a75 7374         " ".ljust
+0001fdd0: 286d 6178 5f6e 616d 655f 6c65 6e20 2b20  (max_name_len + 
+0001fde0: 6c65 6e28 6c61 7965 7220 2b20 2220 205b  len(layer + "  [
+0001fdf0: 2220 2b20 636c 6173 735f 6e61 6d65 202b  " + class_name +
+0001fe00: 2022 5d22 2920 2f2f 2032 2c20 2220 2229   "]") // 2, " ")
+0001fe10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001fe20: 2020 2020 2020 2020 2020 2022 2022 2e6c             " ".l
+0001fe30: 6a75 7374 2832 3520 2b20 6c65 6e28 6973  just(25 + len(is
+0001fe40: 5f6b 6565 7020 2b20 7374 7228 5b4e 6f6e  _keep + str([Non
+0001fe50: 655d 202b 2073 756d 6d61 7279 5b6c 6179  e] + summary[lay
+0001fe60: 6572 5d5b 226f 7574 7075 745f 7368 6170  er]["output_shap
+0001fe70: 6522 5d5b 313a 5d29 2920 2f2f 2032 2c20  e"][1:])) // 2, 
+0001fe80: 2220 2229 2c0d 0a20 2020 2020 2020 2020  " "),..         
+0001fe90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001fea0: 7472 2873 756d 6d61 7279 5b6c 6179 6572  tr(summary[layer
+0001feb0: 5d5b 2277 6569 6768 7422 5d2e 6974 656d  ]["weight"].item
+0001fec0: 5f6c 6973 745b 6e5d 2069 6620 6e20 3c20  _list[n] if n < 
+0001fed0: 6c65 6e28 0d0a 2020 2020 2020 2020 2020  len(..          
+0001fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fef0: 2020 7375 6d6d 6172 795b 6c61 7965 725d    summary[layer]
+0001ff00: 5b22 7765 6967 6874 225d 2920 656c 7365  ["weight"]) else
+0001ff10: 2027 2027 292e 7265 706c 6163 6528 2728   ' ').replace('(
+0001ff20: 272c 2027 2729 2e72 6570 6c61 6365 2827  ', '').replace('
+0001ff30: 2927 2c20 2727 292e 6c6a 7573 7428 6d61  )', '').ljust(ma
+0001ff40: 785f 7765 6967 6874 5f6c 656e 2c0d 0a20  x_weight_len,.. 
 0001ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff70: 2020 2020 2020 2020 2020 2073 7472 286d             str(m
-0001ff80: 6178 5f6e 616d 655f 6c65 6e29 202b 2027  ax_name_len) + '
-0001ff90: 7327 292e 7265 706c 6163 6528 0d0a 2020  s').replace(..  
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ffb0: 2020 2020 2020 2733 3573 272c 2073 7472        '35s', str
-0001ffc0: 286d 6178 5f77 6569 6768 745f 6c65 6e29  (max_weight_len)
-0001ffd0: 202b 2027 7327 292e 666f 726d 6174 280d   + 's').format(.
-0001ffe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fff0: 2020 2020 2020 2020 2022 2022 2e6c 6a75           " ".lju
-00020000: 7374 286d 6178 5f6e 616d 655f 6c65 6e20  st(max_name_len 
-00020010: 2b20 6c65 6e28 6c61 7965 7220 2b20 2220  + len(layer + " 
-00020020: 205b 2220 2b20 636c 6173 735f 6e61 6d65   [" + class_name
-00020030: 202b 2022 5d22 2920 2f2f 2032 2c20 2220   + "]") // 2, " 
-00020040: 2229 2c0d 0a20 2020 2020 2020 2020 2020  "),..           
-00020050: 2020 2020 2020 2020 2020 2020 2022 2022               " "
-00020060: 2e6c 6a75 7374 2832 3520 2b20 6c65 6e28  .ljust(25 + len(
-00020070: 6973 5f6b 6565 7020 2b20 7374 7228 5b4e  is_keep + str([N
-00020080: 6f6e 655d 202b 2073 756d 6d61 7279 5b6c  one] + summary[l
-00020090: 6179 6572 5d5b 226f 7574 7075 745f 7368  ayer]["output_sh
-000200a0: 6170 6522 5d5b 313a 5d29 2920 2f2f 2032  ape"][1:])) // 2
-000200b0: 2c20 2220 2229 2c0d 0a20 2020 2020 2020  , " "),..       
-000200c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200d0: 2073 7472 2873 756d 6d61 7279 5b6c 6179   str(summary[lay
-000200e0: 6572 5d5b 2277 6569 6768 7422 5d2e 6974  er]["weight"].it
-000200f0: 656d 5f6c 6973 745b 6e5d 2069 6620 6e20  em_list[n] if n 
-00020100: 3c20 6c65 6e28 0d0a 2020 2020 2020 2020  < len(..        
-00020110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020120: 2020 2020 7375 6d6d 6172 795b 6c61 7965      summary[laye
-00020130: 725d 5b22 7765 6967 6874 225d 2920 656c  r]["weight"]) el
-00020140: 7365 2027 2027 292e 7265 706c 6163 6528  se ' ').replace(
-00020150: 2728 272c 2027 2729 2e72 6570 6c61 6365  '(', '').replace
-00020160: 2827 2927 2c20 2727 292e 6c6a 7573 7428  (')', '').ljust(
-00020170: 6d61 785f 7765 6967 6874 5f6c 656e 2c0d  max_weight_len,.
-00020180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201e0: 2020 2020 2020 2020 2022 2022 292c 0d0a           " "),..
-000201f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020200: 2020 2020 2020 2020 7374 7228 7375 6d6d          str(summ
-00020210: 6172 795b 6c61 7965 725d 5b22 6269 6173  ary[layer]["bias
-00020220: 225d 2e69 7465 6d5f 6c69 7374 5b6e 5d20  "].item_list[n] 
-00020230: 6966 206e 203c 206c 656e 2873 756d 6d61  if n < len(summa
-00020240: 7279 5b6c 6179 6572 5d5b 2262 6961 7322  ry[layer]["bias"
-00020250: 5d29 2065 6c73 6520 2720 2729 2e72 6570  ]) else ' ').rep
-00020260: 6c61 6365 280d 0a20 2020 2020 2020 2020  lace(..         
-00020270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020280: 2020 2027 2827 2c20 2727 292e 7265 706c     '(', '').repl
-00020290: 6163 6528 2729 272c 2027 2729 2e6c 6a75  ace(')', '').lju
-000202a0: 7374 2838 2c20 2220 2229 2c20 2220 222c  st(8, " "), " ",
-000202b0: 2022 2022 290d 0a20 2020 2020 2020 2020   " ")..         
-000202c0: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-000202d0: 6e65 7720 3d20 6c69 6e65 5f6e 6577 202b  new = line_new +
-000202e0: 2027 5c6e 2720 2b20 6c69 6e65 5f6e 6577   '\n' + line_new
-000202f0: 5f61 6464 0d0a 0d0a 2020 2020 2020 2020  _add....        
-00020300: 2020 2020 746f 7461 6c5f 7061 7261 6d73      total_params
-00020310: 202b 3d20 7375 6d6d 6172 795b 6c61 7965   += summary[laye
-00020320: 725d 5b22 6e62 5f70 6172 616d 7322 5d0d  r]["nb_params"].
-00020330: 0a20 2020 2020 2020 2020 2020 2066 6c6f  .            flo
-00020340: 7073 202b 3d20 666c 6f61 7428 7375 6d6d  ps += float(summ
-00020350: 6172 795b 6c61 7965 725d 5b22 666c 6f70  ary[layer]["flop
-00020360: 7322 5d29 0d0a 2020 2020 2020 2020 2020  s"])..          
-00020370: 2020 6d61 6363 202b 3d20 666c 6f61 7428    macc += float(
-00020380: 7375 6d6d 6172 795b 6c61 7965 725d 5b22  summary[layer]["
-00020390: 6d61 6363 225d 2e73 756d 2829 290d 0a20  macc"].sum()).. 
-000203a0: 2020 2020 2020 2020 2020 2074 6f74 616c             total
-000203b0: 5f6f 7574 7075 7420 2b3d 206e 702e 7072  _output += np.pr
-000203c0: 6f64 2873 756d 6d61 7279 5b6c 6179 6572  od(summary[layer
-000203d0: 5d5b 226f 7574 7075 745f 7368 6170 6522  ]["output_shape"
-000203e0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000203f0: 6966 2022 7472 6169 6e61 626c 6522 2069  if "trainable" i
-00020400: 6e20 7375 6d6d 6172 795b 6c61 7965 725d  n summary[layer]
-00020410: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00020420: 2020 2074 7261 696e 6162 6c65 5f70 6172     trainable_par
-00020430: 616d 7320 2b3d 2073 756d 6d61 7279 5b6c  ams += summary[l
-00020440: 6179 6572 5d5b 2274 7261 696e 6162 6c65  ayer]["trainable
-00020450: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-00020460: 7072 696e 7428 6c69 6e65 5f6e 6577 290d  print(line_new).
-00020470: 0a0d 0a20 2020 2020 2020 2023 2061 7373  ...        # ass
-00020480: 756d 6520 3420 6279 7465 732f 6e75 6d62  ume 4 bytes/numb
-00020490: 6572 2028 666c 6f61 7420 6f6e 2063 7564  er (float on cud
-000204a0: 6129 2e0d 0a20 2020 2020 2020 2074 6f74  a)...        tot
-000204b0: 616c 5f69 6e70 7574 5f73 697a 6520 3d20  al_input_size = 
-000204c0: 6e70 2e61 7361 7272 6179 280d 0a20 2020  np.asarray(..   
-000204d0: 2020 2020 2020 2020 205b 6e70 2e61 6273           [np.abs
-000204e0: 286e 702e 7072 6f64 2874 6f5f 6e75 6d70  (np.prod(to_nump
-000204f0: 7928 7370 6563 2e73 6861 7065 2e64 696d  y(spec.shape.dim
-00020500: 735b 313a 5d29 2920 2a20 6261 7463 685f  s[1:])) * batch_
-00020510: 7369 7a65 202a 2034 2e20 2f20 2831 3032  size * 4. / (102
-00020520: 3420 2a2a 2032 2e29 2920 666f 7220 7370  4 ** 2.)) for sp
-00020530: 6563 2069 6e20 696e 7075 745f 7370 6563  ec in input_spec
-00020540: 7320 6966 0d0a 2020 2020 2020 2020 2020  s if..          
-00020550: 2020 2073 7065 632e 6f70 7469 6f6e 616c     spec.optional
-00020560: 203d 3d20 4661 6c73 6520 616e 6420 7370   == False and sp
-00020570: 6563 2e73 6861 7065 2069 7320 6e6f 7420  ec.shape is not 
-00020580: 4e6f 6e65 5d29 2e73 756d 2829 0d0a 2020  None]).sum()..  
-00020590: 2020 2020 2020 746f 7461 6c5f 6f75 7470        total_outp
-000205a0: 7574 5f73 697a 6520 3d20 6e70 2e61 6273  ut_size = np.abs
-000205b0: 2832 2e20 2a20 746f 7461 6c5f 6f75 7470  (2. * total_outp
-000205c0: 7574 202a 2034 2e20 2f20 2831 3032 3420  ut * 4. / (1024 
-000205d0: 2a2a 2032 2e29 2920 2023 2078 3220 666f  ** 2.))  # x2 fo
-000205e0: 7220 6772 6164 6965 6e74 730d 0a20 2020  r gradients..   
-000205f0: 2020 2020 2074 6f74 616c 5f70 6172 616d       total_param
-00020600: 735f 7369 7a65 203d 206e 702e 6162 7328  s_size = np.abs(
-00020610: 746f 7461 6c5f 7061 7261 6d73 202a 2034  total_params * 4
-00020620: 2e20 2f20 2831 3032 3420 2a2a 2032 2e29  . / (1024 ** 2.)
-00020630: 290d 0a20 2020 2020 2020 2074 6f74 616c  )..        total
-00020640: 5f73 697a 6520 3d20 746f 7461 6c5f 7061  _size = total_pa
-00020650: 7261 6d73 5f73 697a 6520 2b20 746f 7461  rams_size + tota
-00020660: 6c5f 6f75 7470 7574 5f73 697a 6520 2b20  l_output_size + 
-00020670: 746f 7461 6c5f 696e 7075 745f 7369 7a65  total_input_size
-00020680: 0d0a 0d0a 2020 2020 2020 2020 7072 696e  ....        prin
-00020690: 7428 223d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  t("=============
-000206a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000206b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000206c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000206d0: 3d3d 3d22 290d 0a20 2020 2020 2020 2070  ===")..        p
-000206e0: 7269 6e74 2822 546f 7461 6c20 7061 7261  rint("Total para
-000206f0: 6d73 3a20 7b30 3a2c 2e30 667d 222e 666f  ms: {0:,.0f}".fo
-00020700: 726d 6174 2874 6f74 616c 5f70 6172 616d  rmat(total_param
-00020710: 735b 305d 2929 0d0a 2020 2020 2020 2020  s[0]))..        
-00020720: 7072 696e 7428 2254 7261 696e 6162 6c65  print("Trainable
-00020730: 2070 6172 616d 733a 207b 303a 2c2e 3066   params: {0:,.0f
-00020740: 7d22 2e66 6f72 6d61 7428 7472 6169 6e61  }".format(traina
-00020750: 626c 655f 7061 7261 6d73 5b30 5d29 290d  ble_params[0])).
-00020760: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00020770: 4e6f 6e2d 7472 6169 6e61 626c 6520 7061  Non-trainable pa
-00020780: 7261 6d73 3a20 7b30 3a2c 2e30 667d 222e  rams: {0:,.0f}".
-00020790: 666f 726d 6174 2874 6f74 616c 5f70 6172  format(total_par
-000207a0: 616d 735b 305d 202d 2074 7261 696e 6162  ams[0] - trainab
-000207b0: 6c65 5f70 6172 616d 735b 305d 2929 0d0a  le_params[0]))..
-000207c0: 2020 2020 2020 2020 7072 696e 7428 2254          print("T
-000207d0: 6f74 616c 204d 4143 433a 207b 303a 2c2e  otal MACC: {0:,.
-000207e0: 3066 7d22 2e66 6f72 6d61 7428 6d61 6363  0f}".format(macc
-000207f0: 5b30 5d29 290d 0a20 2020 2020 2020 2070  [0]))..        p
-00020800: 7269 6e74 2822 546f 7461 6c20 464c 4f50  rint("Total FLOP
-00020810: 733a 207b 303a 2e35 667d 2047 464c 4f50  s: {0:.5f} GFLOP
-00020820: 7322 2e66 6f72 6d61 7428 6e70 2e72 6f75  s".format(np.rou
-00020830: 6e64 2866 6c6f 7073 202f 2031 302e 202a  nd(flops / 10. *
-00020840: 2a20 392c 2035 295b 305d 2929 0d0a 2020  * 9, 5)[0]))..  
-00020850: 2020 2020 2020 7072 696e 7428 222d 2d2d        print("---
-00020860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020890: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d22 290d  -------------").
-000208a0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-000208b0: 496e 7075 7420 7369 7a65 2028 4d42 293a  Input size (MB):
-000208c0: 2025 302e 3266 2220 2520 746f 7461 6c5f   %0.2f" % total_
-000208d0: 696e 7075 745f 7369 7a65 290d 0a20 2020  input_size)..   
-000208e0: 2020 2020 2070 7269 6e74 2822 466f 7277       print("Forw
-000208f0: 6172 642f 6261 636b 7761 7264 2070 6173  ard/backward pas
-00020900: 7320 7369 7a65 2028 4d42 293a 2025 302e  s size (MB): %0.
-00020910: 3266 2220 2520 746f 7461 6c5f 6f75 7470  2f" % total_outp
-00020920: 7574 5f73 697a 6529 0d0a 2020 2020 2020  ut_size)..      
-00020930: 2020 7072 696e 7428 2250 6172 616d 7320    print("Params 
-00020940: 7369 7a65 2028 4d42 293a 2025 302e 3266  size (MB): %0.2f
-00020950: 2220 2520 746f 7461 6c5f 7061 7261 6d73  " % total_params
-00020960: 5f73 697a 6529 0d0a 2020 2020 2020 2020  _size)..        
-00020970: 7072 696e 7428 2245 7374 696d 6174 6564  print("Estimated
-00020980: 2054 6f74 616c 2053 697a 6520 284d 4229   Total Size (MB)
-00020990: 3a20 2530 2e32 6622 2025 2074 6f74 616c  : %0.2f" % total
-000209a0: 5f73 697a 6529 0d0a 2020 2020 2020 2020  _size)..        
-000209b0: 7072 696e 7428 222d 2d2d 2d2d 2d2d 2d2d  print("---------
-000209c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000209d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000209e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000209f0: 2d2d 2d2d 2d2d 2d22 290d 0a20 2020 2020  -------")..     
-00020a00: 2020 2023 2072 6574 7572 6e20 7375 6d6d     # return summ
-00020a10: 6172 790d 0a20 2020 2020 2020 2064 656c  ary..        del
-00020a20: 2068 6f6f 6b73 0d0a 2020 2020 6578 6365   hooks..    exce
-00020a30: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00020a40: 653a 0d0a 2020 2020 2020 2020 6465 6c20  e:..        del 
-00020a50: 686f 6f6b 730d 0a20 2020 2020 2020 2070  hooks..        p
-00020a60: 7269 6e74 2865 290d 0a20 2020 2020 2020  rint(e)..       
-00020a70: 2050 7269 6e74 4578 6365 7074 696f 6e28   PrintException(
-00020a80: 290d 0a0d 0a0d 0a64 6566 206e 6f72 6d61  )......def norma
-00020a90: 6c69 7a65 5f70 6164 6469 6e67 2870 6164  lize_padding(pad
-00020aa0: 6469 6e67 2c20 7261 6e6b 293a 0d0a 2020  ding, rank):..  
-00020ab0: 2020 2222 220d 0a20 2020 206e 6f72 6d61    """..    norma
-00020ac0: 6c69 7a65 2064 6966 6665 7265 6e74 2070  lize different p
-00020ad0: 6164 6469 6e67 2066 6f72 6d61 7420 746f  adding format to
-00020ae0: 206d 6f73 7420 636f 6d6c 6574 6520 7265   most comlete re
-00020af0: 7072 6573 656e 7461 696f 6e2e 0d0a 2020  presentaion...  
-00020b00: 2020 5465 6e73 6f72 666c 6f77 2061 6e64    Tensorflow and
-00020b10: 2050 7974 6f72 6368 2068 6176 6520 746f   Pytorch have to
-00020b20: 7461 6c6c 7920 6469 6666 6572 656e 7420  tally different 
-00020b30: 7061 6464 696e 6720 7265 7072 6573 656e  padding represen
-00020b40: 7461 7469 6f6e 2066 6f72 6d61 7420 616e  tation format an
-00020b50: 6420 7061 6464 696e 6720 7374 7261 7465  d padding strate
-00020b60: 6779 2e0d 0a20 2020 2049 6e20 5079 746f  gy...    In Pyto
-00020b70: 7263 6820 7468 6520 636f 6d70 6c65 7465  rch the complete
-00020b80: 2066 6f72 6d61 7420 6973 2032 2a20 7261   format is 2* ra
-00020b90: 6e6b 2065 782e 3a20 636f 6e76 3264 2072  nk ex.: conv2d r
-00020ba0: 616e 6b3d 3220 4e43 4857 202c 2077 6520  ank=2 NCHW , we 
-00020bb0: 6f6e 6c79 206e 6565 6420 746f 2070 6164  only need to pad
-00020bc0: 2074 6865 206c 6173 7420 3220 6469 6d65   the last 2 dime
-00020bd0: 6e74 696f 6e73 0d0a 2020 2020 616e 6420  ntions..    and 
-00020be0: 7468 6520 6d6f 7374 2074 6572 7269 626c  the most terribl
-00020bf0: 6520 2069 7320 2070 6164 6469 6e67 2069  e  is  padding i
-00020c00: 6e20 7261 6e6b 2066 6f72 6d61 7420 616e  n rank format an
-00020c10: 6420 322a 7261 6e6b 2066 6f72 6d61 7420  d 2*rank format 
-00020c20: 6172 6520 7065 7266 6563 746c 7920 2252  are perfectly "R
-00020c30: 4556 4552 5345 2221 210d 0a20 2020 2043  EVERSE"!!..    C
-00020c40: 6f6e 7632 6428 2833 2c33 292c 2033 322c  onv2d((3,3), 32,
-00020c50: 2073 7472 6964 6573 3d31 2920 2020 7061   strides=1)   pa
-00020c60: 6464 696e 673d 2831 2c20 3129 203d 3d3e  dding=(1, 1) ==>
-00020c70: 2868 6569 6768 7420 2c20 7769 6474 6829  (height , width)
-00020c80: 0d0a 2020 2020 436f 6e76 3264 2828 332c  ..    Conv2d((3,
-00020c90: 3329 2c20 3332 2c20 7374 7269 6465 733d  3), 32, strides=
-00020ca0: 3129 2020 2066 756c 6c20 7061 6464 696e  1)   full paddin
-00020cb0: 673d 2831 2c20 312c 2031 2c20 3129 203d  g=(1, 1, 1, 1) =
-00020cc0: 3d3e 286c 6566 7420 7269 6768 7420 2c20  =>(left right , 
-00020cd0: 746f 7020 2c20 646f 776e 290d 0a0d 0a20  top , down).... 
-00020ce0: 2020 2049 6e20 7465 6e73 6f72 666c 6f77     In tensorflow
-00020cf0: 2074 6865 2063 6f6d 706c 6574 6520 666f   the complete fo
-00020d00: 726d 6174 2069 7320 322a 2028 7261 6e6b  rmat is 2* (rank
-00020d10: 2b32 2920 6578 2e3a 2063 6f6e 7632 6420  +2) ex.: conv2d 
-00020d20: 7261 6e6b 3d32 204e 4857 4320 2c20 7765  rank=2 NHWC , we
-00020d30: 206f 6e6c 7920 6e65 6564 2074 6f20 7061   only need to pa
-00020d40: 6420 7468 6520 6d69 6464 6c65 2032 2064  d the middle 2 d
-00020d50: 696d 656e 7469 6f6e 7320 616e 6420 656d  imentions and em
-00020d60: 7074 7920 6865 6164 2061 6e64 2074 6169  pty head and tai
-00020d70: 6c20 6469 6d65 6e74 696f 6e73 0d0a 2020  l dimentions..  
-00020d80: 2020 436f 6e76 3264 2828 332c 3329 2c20    Conv2d((3,3), 
-00020d90: 3332 2c20 7374 7269 6465 733d 3129 2020  32, strides=1)  
-00020da0: 2070 6164 6469 6e67 3d28 312c 2031 2920   padding=(1, 1) 
-00020db0: 3d3d 3e28 6865 6967 6874 202c 2077 6964  ==>(height , wid
-00020dc0: 7468 290d 0a20 2020 2043 6f6e 7632 6428  th)..    Conv2d(
-00020dd0: 2833 2c33 292c 2033 322c 2073 7472 6964  (3,3), 32, strid
-00020de0: 6573 3d31 2920 2020 6675 6c6c 2070 6164  es=1)   full pad
-00020df0: 6469 6e67 3d28 2830 2c20 3029 2c20 2831  ding=((0, 0), (1
-00020e00: 2c20 3129 2c20 2831 2c20 3129 2c20 2830  , 1), (1, 1), (0
-00020e10: 2c20 3029 2920 3d3d 3e28 2862 6174 6368  , 0)) ==>((batch
-00020e20: 292c 2028 6865 6967 6874 292c 2028 7769  ), (height), (wi
-00020e30: 6474 6829 2c20 2863 6861 6e6e 656c 290d  dth), (channel).
-00020e40: 0a0d 0a20 2020 2066 6f72 2063 6c65 6172  ...    for clear
-00020e50: 2061 6e64 206e 6f2d 636f 6e66 7573 6564   and no-confused
-00020e60: 2064 6566 696e 6974 696f 6e2c 2074 7269   definition, tri
-00020e70: 6465 6e74 2077 696c 6c20 616c 7761 7973  dent will always
-00020e80: 2064 6566 696e 6520 7061 6464 696e 6720   define padding 
-00020e90: 6279 2074 6865 206e 6174 7572 6520 6f72  by the nature or
-00020ea0: 6469 6e61 6c20 6f66 2074 6865 2064 696d  dinal of the dim
-00020eb0: 656e 7469 6f6e 2e0d 0a20 2020 2065 782e  ention...    ex.
-00020ec0: 2043 6f6e 7632 6428 2833 2c33 292c 2033   Conv2d((3,3), 3
-00020ed0: 322c 2073 7472 6964 6573 3d31 290d 0a20  2, strides=1).. 
-00020ee0: 2020 204e 6f20 6d61 7474 6572 2069 6e20     No matter in 
-00020ef0: 7079 746f 7263 6820 6f72 2074 656e 736f  pytorch or tenso
-00020f00: 7266 6c6f 7720 6261 636b 656e 640d 0a20  rflow backend.. 
-00020f10: 2020 2070 6164 6469 6e67 3d28 312c 2031     padding=(1, 1
-00020f20: 2920 3d3d 3e28 6865 6967 6874 202c 2077  ) ==>(height , w
-00020f30: 6964 7468 290d 0a20 2020 2070 6164 6469  idth)..    paddi
-00020f40: 6e67 3d28 2831 2c20 3129 2c28 312c 3129  ng=((1, 1),(1,1)
-00020f50: 2920 3d3d 3e28 6865 6967 6874 202c 2077  ) ==>(height , w
-00020f60: 6964 7468 290d 0a0d 0a20 2020 2041 7267  idth)....    Arg
-00020f70: 733a 0d0a 2020 2020 2020 2020 7061 6464  s:..        padd
-00020f80: 696e 6720 284e 6f6e 652c 2069 6e74 2c20  ing (None, int, 
-00020f90: 7475 706c 6529 3a0d 0a20 2020 2020 2020  tuple):..       
-00020fa0: 2072 616e 6b20 2869 6e74 293a 0d0a 0d0a   rank (int):....
-00020fb0: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-00020fc0: 2020 2020 2020 7468 6520 6e6f 726d 616c        the normal
-00020fd0: 697a 6564 2066 6f72 6d61 7420 6f66 2070  ized format of p
-00020fe0: 6164 6469 6e67 0d0a 2020 2020 4578 616d  adding..    Exam
-00020ff0: 706c 6573 0d0a 2020 2020 3e3e 3e20 6e6f  ples..    >>> no
-00021000: 726d 616c 697a 655f 7061 6464 696e 6728  rmalize_padding(
-00021010: 2828 312c 3029 2c28 312c 3029 292c 3229  ((1,0),(1,0)),2)
-00021020: 0d0a 2020 2020 2828 312c 2030 292c 2028  ..    ((1, 0), (
-00021030: 312c 2030 2929 0d0a 2020 2020 3e3e 3e20  1, 0))..    >>> 
-00021040: 6e6f 726d 616c 697a 655f 7061 6464 696e  normalize_paddin
-00021050: 6728 2831 2c30 292c 3229 0d0a 2020 2020  g((1,0),2)..    
-00021060: 2828 312c 2031 292c 2028 302c 2030 2929  ((1, 1), (0, 0))
-00021070: 0d0a 2020 2020 3e3e 3e20 6e6f 726d 616c  ..    >>> normal
-00021080: 697a 655f 7061 6464 696e 6728 312c 3229  ize_padding(1,2)
-00021090: 0d0a 2020 2020 2828 312c 2031 292c 2028  ..    ((1, 1), (
-000210a0: 312c 2031 2929 0d0a 2020 2020 3e3e 3e20  1, 1))..    >>> 
-000210b0: 6e6f 726d 616c 697a 655f 7061 6464 696e  normalize_paddin
-000210c0: 6728 2831 292c 3229 0d0a 2020 2020 2828  g((1),2)..    ((
-000210d0: 312c 2031 292c 2028 312c 2031 2929 0d0a  1, 1), (1, 1))..
-000210e0: 2020 2020 3e3e 3e20 6e6f 726d 616c 697a      >>> normaliz
-000210f0: 655f 7061 6464 696e 6728 2831 2c30 292c  e_padding((1,0),
-00021100: 3229 0d0a 2020 2020 2828 312c 2031 292c  2)..    ((1, 1),
-00021110: 2028 302c 2030 2929 0d0a 2020 203e 3e3e   (0, 0))..   >>>
-00021120: 206e 6f72 6d61 6c69 7a65 5f70 6164 6469   normalize_paddi
-00021130: 6e67 2828 302c 3120 2c30 2c20 3129 2c32  ng((0,1 ,0, 1),2
-00021140: 290d 0a20 2020 2828 302c 2031 292c 2028  )..   ((0, 1), (
-00021150: 302c 2031 2929 0d0a 0d0a 2020 2020 2222  0, 1))....    ""
-00021160: 220d 0a20 2020 2069 6620 7061 6464 696e  "..    if paddin
-00021170: 6720 6973 204e 6f6e 653a 0d0a 2020 2020  g is None:..    
-00021180: 2020 2020 2320 4e6f 6e65 3d3e 2828 302c      # None=>((0,
-00021190: 3029 2c28 302c 3029 290d 0a20 2020 2020  0),(0,0))..     
-000211a0: 2020 2070 6164 6469 6e67 203d 2028 2830     padding = ((0
-000211b0: 2c20 3029 2c29 202a 2072 616e 6b0d 0a20  , 0),) * rank.. 
-000211c0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000211d0: 6365 2870 6164 6469 6e67 2c20 696e 7429  ce(padding, int)
-000211e0: 3a0d 0a20 2020 2020 2020 2023 2031 3d3e  :..        # 1=>
-000211f0: 2828 312c 3129 2c28 312c 3129 290d 0a20  ((1,1),(1,1)).. 
-00021200: 2020 2020 2020 2070 6164 6469 6e67 203d         padding =
-00021210: 2028 2870 6164 6469 6e67 2c20 7061 6464   ((padding, padd
-00021220: 696e 6729 2c29 202a 2072 616e 6b0d 0a20  ing),) * rank.. 
-00021230: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00021240: 6365 2870 6164 6469 6e67 2c20 286c 6973  ce(padding, (lis
-00021250: 742c 2074 7570 6c65 2929 2061 6e64 206c  t, tuple)) and l
-00021260: 656e 2870 6164 6469 6e67 2920 3d3d 2031  en(padding) == 1
-00021270: 2061 6e64 2070 6164 6469 6e67 5b30 5d20   and padding[0] 
-00021280: 3d3d 2069 6e74 3a0d 0a20 2020 2020 2020  == int:..       
-00021290: 2023 2028 3129 3d3e 2828 312c 3129 2c28   # (1)=>((1,1),(
-000212a0: 312c 3129 290d 0a20 2020 2020 2020 2070  1,1))..        p
-000212b0: 6164 6469 6e67 203d 2028 2870 6164 6469  adding = ((paddi
-000212c0: 6e67 5b30 5d2c 2070 6164 6469 6e67 5b30  ng[0], padding[0
-000212d0: 5d29 2c29 202a 2072 616e 6b0d 0a20 2020  ]),) * rank..   
-000212e0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-000212f0: 2870 6164 6469 6e67 2c20 286c 6973 742c  (padding, (list,
-00021300: 2074 7570 6c65 2929 2061 6e64 206c 656e   tuple)) and len
-00021310: 2870 6164 6469 6e67 2920 3d3d 2072 616e  (padding) == ran
-00021320: 6b20 616e 6420 6973 696e 7374 616e 6365  k and isinstance
-00021330: 2870 6164 6469 6e67 5b30 5d2c 2069 6e74  (padding[0], int
-00021340: 293a 0d0a 2020 2020 2020 2020 2320 7261  ):..        # ra
-00021350: 6e6b 3d32 2028 312c 3129 3d3e 2828 312c  nk=2 (1,1)=>((1,
-00021360: 312c 292c 2028 312c 3129 2920 2020 2831  1,), (1,1))   (1
-00021370: 2c30 293d 3e28 2831 2c31 292c 2830 2c30  ,0)=>((1,1),(0,0
-00021380: 2929 0d0a 2020 2020 2020 2020 7061 6464  ))..        padd
-00021390: 696e 6720 3d20 6c69 7374 2870 6164 6469  ing = list(paddi
-000213a0: 6e67 290d 0a20 2020 2020 2020 2072 6574  ng)..        ret
-000213b0: 7572 6e5f 7061 6464 696e 6720 3d20 5b5d  urn_padding = []
-000213c0: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
-000213d0: 696e 2072 616e 6765 2872 616e 6b29 3a0d  in range(rank):.
-000213e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000213f0: 7572 6e5f 7061 6464 696e 672e 6170 7065  urn_padding.appe
-00021400: 6e64 2828 7061 6464 696e 675b 695d 2c20  nd((padding[i], 
-00021410: 7061 6464 696e 675b 695d 2929 0d0a 2020  padding[i]))..  
-00021420: 2020 2020 2020 7061 6464 696e 6720 3d20        padding = 
-00021430: 7475 706c 6528 7265 7475 726e 5f70 6164  tuple(return_pad
-00021440: 6469 6e67 290d 0a20 2020 2065 6c69 6620  ding)..    elif 
-00021450: 6973 696e 7374 616e 6365 2870 6164 6469  isinstance(paddi
-00021460: 6e67 2c20 286c 6973 742c 2074 7570 6c65  ng, (list, tuple
-00021470: 2929 2061 6e64 206c 656e 2870 6164 6469  )) and len(paddi
-00021480: 6e67 2920 3d3d 2072 616e 6b20 616e 6420  ng) == rank and 
-00021490: 6973 696e 7374 616e 6365 2870 6164 6469  isinstance(paddi
-000214a0: 6e67 5b30 5d2c 2028 6c69 7374 2c20 7475  ng[0], (list, tu
-000214b0: 706c 6529 293a 0d0a 2020 2020 2020 2020  ple)):..        
-000214c0: 2320 7261 6e6b 3d32 2020 2828 312c 3029  # rank=2  ((1,0)
-000214d0: 2c28 312c 3029 3d3e 2831 2c30 2c31 2c30  ,(1,0)=>(1,0,1,0
-000214e0: 290d 0a20 2020 2020 2020 2070 6173 7320  )..        pass 
-000214f0: 2023 2070 6164 6469 6e67 3d20 7475 706c   # padding= tupl
-00021500: 6528 6c69 7374 2869 7465 7274 6f6f 6c73  e(list(itertools
-00021510: 2e63 6861 696e 282a 6c69 7374 2870 6164  .chain(*list(pad
-00021520: 6469 6e67 2929 2929 0d0a 2020 2020 656c  ding))))..    el
-00021530: 6966 2069 7369 6e73 7461 6e63 6528 7061  if isinstance(pa
-00021540: 6464 696e 672c 2028 6c69 7374 2c20 7475  dding, (list, tu
-00021550: 706c 6529 2920 616e 6420 6c65 6e28 7061  ple)) and len(pa
-00021560: 6464 696e 6729 203d 3d20 3220 2a20 7261  dding) == 2 * ra
-00021570: 6e6b 2061 6e64 2069 7369 6e73 7461 6e63  nk and isinstanc
-00021580: 6528 7061 6464 696e 675b 305d 2c20 696e  e(padding[0], in
-00021590: 7429 3a0d 0a20 2020 2020 2020 2070 6164  t):..        pad
-000215a0: 6469 6e67 203d 2028 2870 6164 6469 6e67  ding = ((padding
-000215b0: 5b30 5d2c 2070 6164 6469 6e67 5b31 5d29  [0], padding[1])
-000215c0: 2c20 2870 6164 6469 6e67 5b32 5d2c 2070  , (padding[2], p
-000215d0: 6164 6469 6e67 5b33 5d29 290d 0a20 2020  adding[3]))..   
-000215e0: 2072 6574 7572 6e20 7061 6464 696e 670d   return padding.
-000215f0: 0a0d 0a0d 0a64 6566 2074 7279 5f6d 6170  .....def try_map
-00021600: 5f61 7267 735f 616e 645f 6361 6c6c 2866  _args_and_call(f
-00021610: 6e2c 2064 6174 613a 204f 7264 6572 6564  n, data: Ordered
-00021620: 4469 6374 2c20 6461 7461 5f66 6565 643a  Dict, data_feed:
-00021630: 204f 7264 6572 6564 4469 6374 203d 204e   OrderedDict = N
-00021640: 6f6e 652c 2069 735f 6175 746f 6361 7374  one, is_autocast
-00021650: 5f65 6e61 626c 6564 3d46 616c 7365 293a  _enabled=False):
-00021660: 0d0a 2020 2020 2222 2254 6869 7320 6675  ..    """This fu
-00021670: 6e63 7469 6f6e 2069 7320 7468 6520 636f  nction is the co
-00021680: 7265 2066 756e 6374 696f 6e20 666f 7220  re function for 
-00021690: 6d61 7070 696e 6720 6361 6c6c 6162 6c65  mapping callable
-000216a0: 2061 6e64 2061 7267 6d65 6e74 730d 0a0d   and argments...
-000216b0: 0a20 2020 2041 7267 733a 0d0a 2020 2020  .    Args:..    
-000216c0: 2020 2020 666e 2028 6361 6c6c 6162 6c65      fn (callable
-000216d0: 293a 2074 6865 2063 616c 6c61 626c 652c  ): the callable,
-000216e0: 206d 6179 6265 2066 756e 6374 696f 6e73   maybe functions
-000216f0: 206f 7220 6c61 7965 7273 0d0a 2020 2020   or layers..    
-00021700: 2020 2020 6461 7461 2028 4f72 6465 7265      data (Ordere
-00021710: 6444 6963 7429 3a20 5468 6520 6b65 792d  dDict): The key-
-00021720: 7661 6c75 6520 7061 6972 2066 6f72 2061  value pair for a
-00021730: 7661 696c 6162 6c65 2064 6174 612e 0d0a  vailable data...
-00021740: 2020 2020 2020 2020 6461 7461 5f66 6565          data_fee
-00021750: 6420 284f 7264 6572 6564 4469 6374 293a  d (OrderedDict):
-00021760: 2054 6865 2072 656c 6174 696f 6e20 6265   The relation be
-00021770: 7477 6565 6e20 6361 6c6c 6162 6c65 2061  tween callable a
-00021780: 7267 6d65 6e74 7320 286b 6579 2920 616e  rgments (key) an
-00021790: 6420 6461 7461 2028 7661 6c75 6529 0d0a  d data (value)..
-000217a0: 2020 2020 2020 2020 6973 5f61 7574 6f63          is_autoc
-000217b0: 6173 745f 656e 6162 6c65 640d 0a0d 0a0d  ast_enabled.....
-000217c0: 0a20 2020 2052 6574 7572 6e73 3a0d 0a20  .    Returns:.. 
-000217d0: 2020 2020 2020 2054 6865 2072 6573 756c         The resul
-000217e0: 7420 6f66 2074 6865 2063 616c 6c61 626c  t of the callabl
-000217f0: 6520 6261 7365 206f 6e20 6461 7461 5f66  e base on data_f
-00021800: 6565 640d 0a0d 0a20 2020 2022 2222 0d0a  eed....    """..
-00021810: 0d0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
-00021820: 6e63 6528 666e 2c20 7466 2e54 656e 736f  nce(fn, tf.Tenso
-00021830: 7229 206f 7220 2745 6167 6572 5465 6e73  r) or 'EagerTens
-00021840: 6f72 2720 696e 2066 6e2e 5f5f 636c 6173  or' in fn.__clas
-00021850: 735f 5f2e 5f5f 6e61 6d65 5f5f 3a0d 0a20  s__.__name__:.. 
-00021860: 2020 2020 2020 2072 6574 7572 6e20 666e         return fn
-00021870: 0d0a 2020 2020 656c 7365 3a0d 0a0d 0a20  ..    else:.... 
-00021880: 2020 2020 2020 2061 7267 5f6d 6170 203d         arg_map =
-00021890: 204f 7264 6572 6564 4469 6374 2829 0d0a   OrderedDict()..
-000218a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000218b0: 7461 6e63 6528 666e 2c20 4c61 7965 7229  tance(fn, Layer)
-000218c0: 3a0d 0a20 2020 2020 2020 2020 2020 205f  :..            _
-000218d0: 6465 7669 6365 203d 2066 6e2e 6765 745f  device = fn.get_
-000218e0: 726f 6f74 2829 2e64 6576 6963 650d 0a20  root().device.. 
-000218f0: 2020 2020 2020 2020 2020 205f 7369 676e             _sign
-00021900: 6174 7572 6520 3d20 666e 2e5f 7369 676e  ature = fn._sign
-00021910: 6174 7572 650d 0a20 2020 2020 2020 2020  ature..         
-00021920: 2020 2069 6620 4e6f 6e65 2069 6e20 666e     if None in fn
-00021930: 2e5f 7369 676e 6174 7572 652e 696e 7075  ._signature.inpu
-00021940: 7473 2e76 616c 7565 5f6c 6973 743a 0d0a  ts.value_list:..
-00021950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021960: 5f73 6967 6e61 7475 7265 203d 2067 6574  _signature = get
-00021970: 5f73 6967 6e61 7475 7265 2866 6e29 0d0a  _signature(fn)..
-00021980: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00021990: 6172 6720 696e 2066 6e2e 7369 676e 6174  arg in fn.signat
-000219a0: 7572 652e 696e 7075 7473 2e6b 6579 5f6c  ure.inputs.key_l
-000219b0: 6973 743a 0d0a 2020 2020 2020 2020 2020  ist:..          
-000219c0: 2020 2020 2020 6973 5f6f 7074 696f 6e61        is_optiona
-000219d0: 6c20 3d20 666e 2e73 6967 6e61 7475 7265  l = fn.signature
-000219e0: 2e69 6e70 7574 735b 6172 675d 2e6f 7074  .inputs[arg].opt
-000219f0: 696f 6e61 6c20 6966 2069 7369 6e73 7461  ional if isinsta
-00021a00: 6e63 6528 666e 2e73 6967 6e61 7475 7265  nce(fn.signature
-00021a10: 2e69 6e70 7574 735b 6172 675d 2c0d 0a20  .inputs[arg],.. 
-00021a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a60: 2020 2020 2020 2020 2020 2020 2054 656e               Ten
-00021a70: 736f 7253 7065 6329 2065 6c73 6520 4661  sorSpec) else Fa
-00021a80: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00021a90: 2020 2020 2064 6566 6175 6c74 203d 2066       default = f
-00021aa0: 6e2e 7369 676e 6174 7572 652e 696e 7075  n.signature.inpu
-00021ab0: 7473 5b61 7267 5d2e 6465 6661 756c 7420  ts[arg].default 
-00021ac0: 6966 2069 7369 6e73 7461 6e63 6528 666e  if isinstance(fn
-00021ad0: 2e73 6967 6e61 7475 7265 2e69 6e70 7574  .signature.input
-00021ae0: 735b 6172 675d 2c20 5465 6e73 6f72 5370  s[arg], TensorSp
-00021af0: 6563 2920 656c 7365 204e 6f6e 650d 0a20  ec) else None.. 
-00021b00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021b10: 735f 696e 7075 7420 3d20 6172 672e 6c6f  s_input = arg.lo
-00021b20: 7765 7228 2920 696e 205b 2778 272c 2027  wer() in ['x', '
-00021b30: 696e 7075 7427 5d0d 0a20 2020 2020 2020  input']..       
-00021b40: 2020 2020 2020 2020 2069 735f 6f75 7470           is_outp
-00021b50: 7574 203d 2061 7267 2e6c 6f77 6572 2829  ut = arg.lower()
-00021b60: 2069 6e20 5b27 7927 2c20 276f 7574 7075   in ['y', 'outpu
-00021b70: 7427 2c20 2779 5f70 7265 6427 5d0d 0a20  t', 'y_pred'].. 
-00021b80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021b90: 6620 6172 6720 696e 2064 6174 615f 6665  f arg in data_fe
-00021ba0: 6564 2061 6e64 2064 6174 615f 6665 6564  ed and data_feed
-00021bb0: 5b61 7267 5d20 696e 2064 6174 613a 0d0a  [arg] in data:..
-00021bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021bd0: 2020 2020 6172 675f 6d61 705b 6172 675d      arg_map[arg]
-00021be0: 203d 2074 6f5f 7465 6e73 6f72 2864 6174   = to_tensor(dat
-00021bf0: 615b 6461 7461 5f66 6565 645b 6172 675d  a[data_feed[arg]
-00021c00: 5d2c 2064 6576 6963 653d 5f64 6576 6963  ], device=_devic
-00021c10: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00021c20: 2020 2020 656c 6966 2061 7267 2069 6e20      elif arg in 
-00021c30: 6461 7461 3a0d 0a20 2020 2020 2020 2020  data:..         
-00021c40: 2020 2020 2020 2020 2020 2061 7267 5f6d             arg_m
-00021c50: 6170 5b61 7267 5d20 3d20 746f 5f74 656e  ap[arg] = to_ten
-00021c60: 736f 7228 6461 7461 5b61 7267 5d2c 2064  sor(data[arg], d
-00021c70: 6576 6963 653d 5f64 6576 6963 6529 0d0a  evice=_device)..
-00021c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c90: 656c 6966 2069 735f 696e 7075 7420 616e  elif is_input an
-00021ca0: 6420 2769 6e70 7574 2720 696e 2064 6174  d 'input' in dat
-00021cb0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
-00021cc0: 2020 2020 2020 2020 6172 675f 6d61 705b          arg_map[
-00021cd0: 6172 675d 203d 2074 6f5f 7465 6e73 6f72  arg] = to_tensor
-00021ce0: 2864 6174 615b 2769 6e70 7574 275d 2c20  (data['input'], 
-00021cf0: 6465 7669 6365 3d5f 6465 7669 6365 290d  device=_device).
-00021d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021d10: 2065 6c69 6620 6973 5f6f 7574 7075 7420   elif is_output 
-00021d20: 616e 6420 276f 7574 7075 7427 2069 6e20  and 'output' in 
-00021d30: 6461 7461 3a0d 0a20 2020 2020 2020 2020  data:..         
-00021d40: 2020 2020 2020 2020 2020 2061 7267 5f6d             arg_m
-00021d50: 6170 5b61 7267 5d20 3d20 746f 5f74 656e  ap[arg] = to_ten
-00021d60: 736f 7228 6461 7461 5b27 6f75 7470 7574  sor(data['output
-00021d70: 275d 2c20 6465 7669 6365 3d5f 6465 7669  '], device=_devi
-00021d80: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
-00021d90: 2020 2020 2065 6c69 6620 6973 5f6f 7074       elif is_opt
-00021da0: 696f 6e61 6c3a 0d0a 2020 2020 2020 2020  ional:..        
-00021db0: 2020 2020 2020 2020 2020 2020 6172 675f              arg_
-00021dc0: 6d61 705b 6172 675d 203d 2064 6566 6175  map[arg] = defau
-00021dd0: 6c74 0d0a 2020 2020 2020 2020 2020 2020  lt..            
-00021de0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00021df0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021e00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00021e10: 2761 7267 203a 7b30 7d20 6361 6e6e 6f74  'arg :{0} cannot
-00021e20: 206d 6170 7069 6e67 2063 6f72 7265 6374   mapping correct
-00021e30: 6c79 2127 2e66 6f72 6d61 7428 6172 6729  ly!'.format(arg)
-00021e40: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00021e50: 6620 6374 782e 616d 705f 6176 6169 6c61  f ctx.amp_availa
-00021e60: 626c 6520 3d3d 2054 7275 6520 616e 6420  ble == True and 
-00021e70: 6973 5f61 7574 6f63 6173 745f 656e 6162  is_autocast_enab
-00021e80: 6c65 6420 3d3d 2054 7275 6520 616e 6420  led == True and 
-00021e90: 6765 745f 6465 7669 6365 2829 203d 3d20  get_device() == 
-00021ea0: 2763 7564 6127 3a0d 0a20 2020 2020 2020  'cuda':..       
-00021eb0: 2020 2020 2020 2020 2023 206e 6f74 2073           # not s
-00021ec0: 7570 706f 7274 2079 6574 0d0a 2020 2020  upport yet..    
-00021ed0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-00021ee0: 3d20 666e 282a 6172 675f 6d61 702e 7661  = fn(*arg_map.va
-00021ef0: 6c75 655f 6c69 7374 290d 0a20 2020 2020  lue_list)..     
-00021f00: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00021f10: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00021f20: 7420 3d20 666e 282a 6172 675f 6d61 702e  t = fn(*arg_map.
-00021f30: 7661 6c75 655f 6c69 7374 290d 0a20 2020  value_list)..   
-00021f40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00021f50: 6f75 740d 0a0d 0a20 2020 2020 2020 2065  out....        e
-00021f60: 6c69 6620 2868 6173 6174 7472 2866 6e2c  lif (hasattr(fn,
-00021f70: 2027 7369 676e 6174 7572 6527 2920 6f72   'signature') or
-00021f80: 2068 6173 6174 7472 2866 6e2c 2027 5f73   hasattr(fn, '_s
-00021f90: 6967 6e61 7475 7265 2729 2920 616e 6420  ignature')) and 
-00021fa0: 6361 6c6c 6162 6c65 2866 6e29 3a0d 0a20  callable(fn):.. 
-00021fb0: 2020 2020 2020 2020 2020 2073 6967 203d             sig =
-00021fc0: 2066 6e2e 5f73 6967 6e61 7475 7265 2069   fn._signature i
-00021fd0: 6620 6861 7361 7474 7228 666e 2c20 275f  f hasattr(fn, '_
-00021fe0: 7369 676e 6174 7572 6527 2920 656c 7365  signature') else
-00021ff0: 2066 6e2e 7369 676e 6174 7572 650d 0a20   fn.signature.. 
-00022000: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
-00022010: 7267 2069 6e20 7369 672e 696e 7075 7473  rg in sig.inputs
-00022020: 2e6b 6579 5f6c 6973 743a 0d0a 2020 2020  .key_list:..    
-00022030: 2020 2020 2020 2020 2020 2020 6973 5f6f              is_o
-00022040: 7074 696f 6e61 6c20 3d20 7369 672e 696e  ptional = sig.in
-00022050: 7075 7473 5b61 7267 5d2e 6f70 7469 6f6e  puts[arg].option
-00022060: 616c 2069 6620 6973 696e 7374 616e 6365  al if isinstance
-00022070: 2873 6967 2e69 6e70 7574 735b 6172 675d  (sig.inputs[arg]
-00022080: 2c20 5465 6e73 6f72 5370 6563 2920 656c  , TensorSpec) el
-00022090: 7365 2046 616c 7365 0d0a 2020 2020 2020  se False..      
-000220a0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000220b0: 7420 3d20 7369 672e 696e 7075 7473 5b61  t = sig.inputs[a
-000220c0: 7267 5d2e 6465 6661 756c 7420 6966 2069  rg].default if i
-000220d0: 7369 6e73 7461 6e63 6528 7369 672e 696e  sinstance(sig.in
-000220e0: 7075 7473 5b61 7267 5d2c 2054 656e 736f  puts[arg], Tenso
-000220f0: 7253 7065 6329 2065 6c73 6520 4e6f 6e65  rSpec) else None
-00022100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022110: 2020 6973 5f69 6e70 7574 203d 2061 7267    is_input = arg
-00022120: 2e6c 6f77 6572 2829 2069 6e20 5b27 7827  .lower() in ['x'
-00022130: 2c20 2769 6e70 7574 275d 0d0a 2020 2020  , 'input']..    
-00022140: 2020 2020 2020 2020 2020 2020 6973 5f6f              is_o
-00022150: 7574 7075 7420 3d20 6172 672e 6c6f 7765  utput = arg.lowe
-00022160: 7228 2920 696e 205b 2779 272c 2027 6f75  r() in ['y', 'ou
-00022170: 7470 7574 272c 2027 795f 7072 6564 275d  tput', 'y_pred']
-00022180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022190: 2020 6966 2061 7267 2069 6e20 6461 7461    if arg in data
-000221a0: 5f66 6565 6420 616e 6420 6461 7461 5f66  _feed and data_f
-000221b0: 6565 645b 6172 675d 2069 6e20 6461 7461  eed[arg] in data
-000221c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000221d0: 2020 2020 2020 2061 7267 5f6d 6170 5b61         arg_map[a
-000221e0: 7267 5d20 3d20 746f 5f74 656e 736f 7228  rg] = to_tensor(
-000221f0: 6461 7461 5b64 6174 615f 6665 6564 5b61  data[data_feed[a
-00022200: 7267 5d5d 2c20 6465 7669 6365 3d67 6574  rg]], device=get
-00022210: 5f64 6576 6963 6528 2929 0d0a 2020 2020  _device())..    
-00022220: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00022230: 2061 7267 2069 6e20 6461 7461 3a0d 0a20   arg in data:.. 
-00022240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022250: 2020 2061 7267 5f6d 6170 5b61 7267 5d20     arg_map[arg] 
-00022260: 3d20 746f 5f74 656e 736f 7228 6461 7461  = to_tensor(data
-00022270: 5b61 7267 5d2c 2064 6576 6963 653d 6765  [arg], device=ge
-00022280: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
-00022290: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000222a0: 6620 6973 5f69 6e70 7574 2061 6e64 2027  f is_input and '
-000222b0: 696e 7075 7427 2069 6e20 6461 7461 5f66  input' in data_f
-000222c0: 6565 6420 616e 6420 6461 7461 5f66 6565  eed and data_fee
-000222d0: 645b 2769 6e70 7574 275d 2069 6e20 6461  d['input'] in da
-000222e0: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
-000222f0: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
-00022300: 5b61 7267 5d20 3d20 746f 5f74 656e 736f  [arg] = to_tenso
-00022310: 7228 6461 7461 5b64 6174 615f 6665 6564  r(data[data_feed
-00022320: 5b27 696e 7075 7427 5d5d 2c20 6465 7669  ['input']], devi
-00022330: 6365 3d67 6574 5f64 6576 6963 6528 2929  ce=get_device())
-00022340: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022350: 2020 656c 6966 2069 735f 6f75 7470 7574    elif is_output
-00022360: 2061 6e64 2027 6f75 7470 7574 2720 696e   and 'output' in
-00022370: 2064 6174 615f 6665 6564 2061 6e64 2064   data_feed and d
-00022380: 6174 615f 6665 6564 5b27 6f75 7470 7574  ata_feed['output
-00022390: 275d 2069 6e20 6461 7461 3a0d 0a20 2020  '] in data:..   
-000223a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000223b0: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
-000223c0: 746f 5f74 656e 736f 7228 6461 7461 5b64  to_tensor(data[d
-000223d0: 6174 615f 6665 6564 5b27 6f75 7470 7574  ata_feed['output
-000223e0: 275d 5d2c 2064 6576 6963 653d 6765 745f  ']], device=get_
-000223f0: 6465 7669 6365 2829 290d 0a20 2020 2020  device())..     
-00022400: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00022410: 6973 696e 7374 616e 6365 2866 6e2c 2066  isinstance(fn, f
-00022420: 756e 6374 6f6f 6c73 2e70 6172 7469 616c  unctools.partial
-00022430: 2920 616e 6420 6172 6720 696e 2066 6e2e  ) and arg in fn.
-00022440: 6b65 7977 6f72 6473 3a0d 0a20 2020 2020  keywords:..     
-00022450: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00022460: 7267 5f6d 6170 5b61 7267 5d20 3d20 666e  rg_map[arg] = fn
-00022470: 2e6b 6579 776f 7264 735b 6172 675d 0d0a  .keywords[arg]..
-00022480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022490: 656c 6966 2069 735f 6f70 7469 6f6e 616c  elif is_optional
-000224a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000224b0: 2020 2020 2020 2061 7267 5f6d 6170 5b61         arg_map[a
-000224c0: 7267 5d20 3d20 6465 6661 756c 740d 0a20  rg] = default.. 
-000224d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000224e0: 6c69 6620 6172 6720 3d3d 2027 795f 7072  lif arg == 'y_pr
-000224f0: 6564 2720 616e 6420 276f 7574 7075 7427  ed' and 'output'
-00022500: 2069 6e20 6461 7461 3a0d 0a20 2020 2020   in data:..     
-00022510: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00022520: 7267 5f6d 6170 5b61 7267 5d20 3d20 6461  rg_map[arg] = da
-00022530: 7461 5b27 6f75 7470 7574 275d 0d0a 2020  ta['output']..  
-00022540: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00022550: 6966 2061 7267 203d 3d20 2779 5f74 7275  if arg == 'y_tru
-00022560: 6527 2061 6e64 2027 7461 7267 6574 2720  e' and 'target' 
-00022570: 696e 2064 6174 613a 0d0a 2020 2020 2020  in data:..      
-00022580: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00022590: 675f 6d61 705b 6172 675d 203d 2064 6174  g_map[arg] = dat
-000225a0: 615b 2774 6172 6765 7427 5d0d 0a20 2020  a['target']..   
-000225b0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000225c0: 6620 6172 6720 3d3d 2027 795f 7472 7565  f arg == 'y_true
-000225d0: 2720 616e 6420 276c 6162 656c 2720 696e  ' and 'label' in
-000225e0: 2064 6174 613a 0d0a 2020 2020 2020 2020   data:..        
-000225f0: 2020 2020 2020 2020 2020 2020 6172 675f              arg_
-00022600: 6d61 705b 6172 675d 203d 2064 6174 615b  map[arg] = data[
-00022610: 276c 6162 656c 275d 0d0a 2020 2020 2020  'label']..      
-00022620: 2020 2020 2020 2020 2020 656c 6966 2061            elif a
-00022630: 7267 203d 3d20 276c 6162 656c 2720 616e  rg == 'label' an
-00022640: 6420 2774 6172 6765 7427 2069 6e20 6461  d 'target' in da
-00022650: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
-00022660: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
-00022670: 5b61 7267 5d20 3d20 6461 7461 5b27 7461  [arg] = data['ta
-00022680: 7267 6574 275d 0d0a 2020 2020 2020 2020  rget']..        
-00022690: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000226a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226b0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000226c0: 726f 7228 2761 7267 203a 7b30 7d20 6361  ror('arg :{0} ca
-000226d0: 6e6e 6f74 206d 6170 7069 6e67 2063 6f72  nnot mapping cor
-000226e0: 7265 6374 6c79 2127 2e66 6f72 6d61 7428  rectly!'.format(
-000226f0: 6172 6729 290d 0a0d 0a20 2020 2020 2020  arg))....       
-00022700: 2020 2020 2069 6620 6374 782e 616d 705f       if ctx.amp_
-00022710: 6176 6169 6c61 626c 6520 3d3d 2054 7275  available == Tru
-00022720: 6520 616e 6420 6973 5f61 7574 6f63 6173  e and is_autocas
-00022730: 745f 656e 6162 6c65 6420 3d3d 2054 7275  t_enabled == Tru
-00022740: 6520 616e 6420 6765 745f 6465 7669 6365  e and get_device
-00022750: 2829 203d 3d20 2763 7564 6127 3a0d 0a20  () == 'cuda':.. 
-00022760: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00022770: 206e 6f74 2073 7570 706f 7274 2079 6574   not support yet
-00022780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022790: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000227a0: 666e 2c20 7061 7274 6961 6c29 3a0d 0a20  fn, partial):.. 
-000227b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227c0: 2020 206f 7574 203d 2066 6e2e 6675 6e63     out = fn.func
-000227d0: 282a 6172 675f 6d61 702e 7661 6c75 655f  (*arg_map.value_
-000227e0: 6c69 7374 290d 0a20 2020 2020 2020 2020  list)..         
-000227f0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0001ffb0: 2020 2020 2020 2022 2022 292c 0d0a 2020         " "),..  
+0001ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffd0: 2020 2020 2020 7374 7228 7375 6d6d 6172        str(summar
+0001ffe0: 795b 6c61 7965 725d 5b22 6269 6173 225d  y[layer]["bias"]
+0001fff0: 2e69 7465 6d5f 6c69 7374 5b6e 5d20 6966  .item_list[n] if
+00020000: 206e 203c 206c 656e 2873 756d 6d61 7279   n < len(summary
+00020010: 5b6c 6179 6572 5d5b 2262 6961 7322 5d29  [layer]["bias"])
+00020020: 2065 6c73 6520 2720 2729 2e72 6570 6c61   else ' ').repla
+00020030: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00020040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020050: 2027 2827 2c20 2727 292e 7265 706c 6163   '(', '').replac
+00020060: 6528 2729 272c 2027 2729 2e6c 6a75 7374  e(')', '').ljust
+00020070: 2838 2c20 2220 2229 2c20 2220 222c 2022  (8, " "), " ", "
+00020080: 2022 290d 0a20 2020 2020 2020 2020 2020   ")..           
+00020090: 2020 2020 2020 2020 206c 696e 655f 6e65           line_ne
+000200a0: 7720 3d20 6c69 6e65 5f6e 6577 202b 2027  w = line_new + '
+000200b0: 5c6e 2720 2b20 6c69 6e65 5f6e 6577 5f61  \n' + line_new_a
+000200c0: 6464 0d0a 0d0a 2020 2020 2020 2020 2020  dd....          
+000200d0: 2020 746f 7461 6c5f 7061 7261 6d73 202b    total_params +
+000200e0: 3d20 7375 6d6d 6172 795b 6c61 7965 725d  = summary[layer]
+000200f0: 5b22 6e62 5f70 6172 616d 7322 5d0d 0a20  ["nb_params"].. 
+00020100: 2020 2020 2020 2020 2020 2066 6c6f 7073             flops
+00020110: 202b 3d20 666c 6f61 7428 7375 6d6d 6172   += float(summar
+00020120: 795b 6c61 7965 725d 5b22 666c 6f70 7322  y[layer]["flops"
+00020130: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00020140: 6d61 6363 202b 3d20 666c 6f61 7428 7375  macc += float(su
+00020150: 6d6d 6172 795b 6c61 7965 725d 5b22 6d61  mmary[layer]["ma
+00020160: 6363 225d 2e73 756d 2829 290d 0a20 2020  cc"].sum())..   
+00020170: 2020 2020 2020 2020 2074 6f74 616c 5f6f           total_o
+00020180: 7574 7075 7420 2b3d 206e 702e 7072 6f64  utput += np.prod
+00020190: 2873 756d 6d61 7279 5b6c 6179 6572 5d5b  (summary[layer][
+000201a0: 226f 7574 7075 745f 7368 6170 6522 5d29  "output_shape"])
+000201b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000201c0: 2022 7472 6169 6e61 626c 6522 2069 6e20   "trainable" in 
+000201d0: 7375 6d6d 6172 795b 6c61 7965 725d 3a0d  summary[layer]:.
+000201e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000201f0: 2074 7261 696e 6162 6c65 5f70 6172 616d   trainable_param
+00020200: 7320 2b3d 2073 756d 6d61 7279 5b6c 6179  s += summary[lay
+00020210: 6572 5d5b 2274 7261 696e 6162 6c65 225d  er]["trainable"]
+00020220: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00020230: 696e 7428 6c69 6e65 5f6e 6577 290d 0a0d  int(line_new)...
+00020240: 0a20 2020 2020 2020 2023 2061 7373 756d  .        # assum
+00020250: 6520 3420 6279 7465 732f 6e75 6d62 6572  e 4 bytes/number
+00020260: 2028 666c 6f61 7420 6f6e 2063 7564 6129   (float on cuda)
+00020270: 2e0d 0a20 2020 2020 2020 2074 6f74 616c  ...        total
+00020280: 5f69 6e70 7574 5f73 697a 6520 3d20 6e70  _input_size = np
+00020290: 2e61 7361 7272 6179 280d 0a20 2020 2020  .asarray(..     
+000202a0: 2020 2020 2020 205b 6e70 2e61 6273 286e         [np.abs(n
+000202b0: 702e 7072 6f64 2874 6f5f 6e75 6d70 7928  p.prod(to_numpy(
+000202c0: 7370 6563 2e73 6861 7065 2e64 696d 735b  spec.shape.dims[
+000202d0: 313a 5d29 2920 2a20 6261 7463 685f 7369  1:])) * batch_si
+000202e0: 7a65 202a 2034 2e20 2f20 2831 3032 3420  ze * 4. / (1024 
+000202f0: 2a2a 2032 2e29 2920 666f 7220 7370 6563  ** 2.)) for spec
+00020300: 2069 6e20 696e 7075 745f 7370 6563 7320   in input_specs 
+00020310: 6966 0d0a 2020 2020 2020 2020 2020 2020  if..            
+00020320: 2073 7065 632e 6f70 7469 6f6e 616c 203d   spec.optional =
+00020330: 3d20 4661 6c73 6520 616e 6420 7370 6563  = False and spec
+00020340: 2e73 6861 7065 2069 7320 6e6f 7420 4e6f  .shape is not No
+00020350: 6e65 5d29 2e73 756d 2829 0d0a 2020 2020  ne]).sum()..    
+00020360: 2020 2020 746f 7461 6c5f 6f75 7470 7574      total_output
+00020370: 5f73 697a 6520 3d20 6e70 2e61 6273 2832  _size = np.abs(2
+00020380: 2e20 2a20 746f 7461 6c5f 6f75 7470 7574  . * total_output
+00020390: 202a 2034 2e20 2f20 2831 3032 3420 2a2a   * 4. / (1024 **
+000203a0: 2032 2e29 2920 2023 2078 3220 666f 7220   2.))  # x2 for 
+000203b0: 6772 6164 6965 6e74 730d 0a20 2020 2020  gradients..     
+000203c0: 2020 2074 6f74 616c 5f70 6172 616d 735f     total_params_
+000203d0: 7369 7a65 203d 206e 702e 6162 7328 746f  size = np.abs(to
+000203e0: 7461 6c5f 7061 7261 6d73 202a 2034 2e20  tal_params * 4. 
+000203f0: 2f20 2831 3032 3420 2a2a 2032 2e29 290d  / (1024 ** 2.)).
+00020400: 0a20 2020 2020 2020 2074 6f74 616c 5f73  .        total_s
+00020410: 697a 6520 3d20 746f 7461 6c5f 7061 7261  ize = total_para
+00020420: 6d73 5f73 697a 6520 2b20 746f 7461 6c5f  ms_size + total_
+00020430: 6f75 7470 7574 5f73 697a 6520 2b20 746f  output_size + to
+00020440: 7461 6c5f 696e 7075 745f 7369 7a65 0d0a  tal_input_size..
+00020450: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00020460: 223d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  "===============
+00020470: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00020480: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00020490: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000204a0: 3d22 290d 0a20 2020 2020 2020 2070 7269  =")..        pri
+000204b0: 6e74 2822 546f 7461 6c20 7061 7261 6d73  nt("Total params
+000204c0: 3a20 7b30 3a2c 2e30 667d 222e 666f 726d  : {0:,.0f}".form
+000204d0: 6174 2874 6f74 616c 5f70 6172 616d 735b  at(total_params[
+000204e0: 305d 2929 0d0a 2020 2020 2020 2020 7072  0]))..        pr
+000204f0: 696e 7428 2254 7261 696e 6162 6c65 2070  int("Trainable p
+00020500: 6172 616d 733a 207b 303a 2c2e 3066 7d22  arams: {0:,.0f}"
+00020510: 2e66 6f72 6d61 7428 7472 6169 6e61 626c  .format(trainabl
+00020520: 655f 7061 7261 6d73 5b30 5d29 290d 0a20  e_params[0])).. 
+00020530: 2020 2020 2020 2070 7269 6e74 2822 4e6f         print("No
+00020540: 6e2d 7472 6169 6e61 626c 6520 7061 7261  n-trainable para
+00020550: 6d73 3a20 7b30 3a2c 2e30 667d 222e 666f  ms: {0:,.0f}".fo
+00020560: 726d 6174 2874 6f74 616c 5f70 6172 616d  rmat(total_param
+00020570: 735b 305d 202d 2074 7261 696e 6162 6c65  s[0] - trainable
+00020580: 5f70 6172 616d 735b 305d 2929 0d0a 2020  _params[0]))..  
+00020590: 2020 2020 2020 7072 696e 7428 2254 6f74        print("Tot
+000205a0: 616c 204d 4143 433a 207b 303a 2c2e 3066  al MACC: {0:,.0f
+000205b0: 7d22 2e66 6f72 6d61 7428 6d61 6363 5b30  }".format(macc[0
+000205c0: 5d29 290d 0a20 2020 2020 2020 2070 7269  ]))..        pri
+000205d0: 6e74 2822 546f 7461 6c20 464c 4f50 733a  nt("Total FLOPs:
+000205e0: 207b 303a 2e35 667d 2047 464c 4f50 7322   {0:.5f} GFLOPs"
+000205f0: 2e66 6f72 6d61 7428 6e70 2e72 6f75 6e64  .format(np.round
+00020600: 2866 6c6f 7073 202f 2031 302e 202a 2a20  (flops / 10. ** 
+00020610: 392c 2035 295b 305d 2929 0d0a 2020 2020  9, 5)[0]))..    
+00020620: 2020 2020 7072 696e 7428 222d 2d2d 2d2d      print("-----
+00020630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00020640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00020650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00020660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d22 290d 0a20  -----------").. 
+00020670: 2020 2020 2020 2070 7269 6e74 2822 496e         print("In
+00020680: 7075 7420 7369 7a65 2028 4d42 293a 2025  put size (MB): %
+00020690: 302e 3266 2220 2520 746f 7461 6c5f 696e  0.2f" % total_in
+000206a0: 7075 745f 7369 7a65 290d 0a20 2020 2020  put_size)..     
+000206b0: 2020 2070 7269 6e74 2822 466f 7277 6172     print("Forwar
+000206c0: 642f 6261 636b 7761 7264 2070 6173 7320  d/backward pass 
+000206d0: 7369 7a65 2028 4d42 293a 2025 302e 3266  size (MB): %0.2f
+000206e0: 2220 2520 746f 7461 6c5f 6f75 7470 7574  " % total_output
+000206f0: 5f73 697a 6529 0d0a 2020 2020 2020 2020  _size)..        
+00020700: 7072 696e 7428 2250 6172 616d 7320 7369  print("Params si
+00020710: 7a65 2028 4d42 293a 2025 302e 3266 2220  ze (MB): %0.2f" 
+00020720: 2520 746f 7461 6c5f 7061 7261 6d73 5f73  % total_params_s
+00020730: 697a 6529 0d0a 2020 2020 2020 2020 7072  ize)..        pr
+00020740: 696e 7428 2245 7374 696d 6174 6564 2054  int("Estimated T
+00020750: 6f74 616c 2053 697a 6520 284d 4229 3a20  otal Size (MB): 
+00020760: 2530 2e32 6622 2025 2074 6f74 616c 5f73  %0.2f" % total_s
+00020770: 697a 6529 0d0a 2020 2020 2020 2020 7072  ize)..        pr
+00020780: 696e 7428 222d 2d2d 2d2d 2d2d 2d2d 2d2d  int("-----------
+00020790: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000207a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000207b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000207c0: 2d2d 2d2d 2d22 290d 0a20 2020 2020 2020  -----")..       
+000207d0: 2023 2072 6574 7572 6e20 7375 6d6d 6172   # return summar
+000207e0: 790d 0a20 2020 2020 2020 2064 656c 2068  y..        del h
+000207f0: 6f6f 6b73 0d0a 2020 2020 6578 6365 7074  ooks..    except
+00020800: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00020810: 0d0a 2020 2020 2020 2020 6465 6c20 686f  ..        del ho
+00020820: 6f6b 730d 0a20 2020 2020 2020 2070 7269  oks..        pri
+00020830: 6e74 2865 290d 0a20 2020 2020 2020 2050  nt(e)..        P
+00020840: 7269 6e74 4578 6365 7074 696f 6e28 290d  rintException().
+00020850: 0a0d 0a0d 0a64 6566 206e 6f72 6d61 6c69  .....def normali
+00020860: 7a65 5f70 6164 6469 6e67 2870 6164 6469  ze_padding(paddi
+00020870: 6e67 2c20 7261 6e6b 293a 0d0a 2020 2020  ng, rank):..    
+00020880: 2222 220d 0a20 2020 206e 6f72 6d61 6c69  """..    normali
+00020890: 7a65 2064 6966 6665 7265 6e74 2070 6164  ze different pad
+000208a0: 6469 6e67 2066 6f72 6d61 7420 746f 206d  ding format to m
+000208b0: 6f73 7420 636f 6d6c 6574 6520 7265 7072  ost comlete repr
+000208c0: 6573 656e 7461 696f 6e2e 0d0a 2020 2020  esentaion...    
+000208d0: 5465 6e73 6f72 666c 6f77 2061 6e64 2050  Tensorflow and P
+000208e0: 7974 6f72 6368 2068 6176 6520 746f 7461  ytorch have tota
+000208f0: 6c6c 7920 6469 6666 6572 656e 7420 7061  lly different pa
+00020900: 6464 696e 6720 7265 7072 6573 656e 7461  dding representa
+00020910: 7469 6f6e 2066 6f72 6d61 7420 616e 6420  tion format and 
+00020920: 7061 6464 696e 6720 7374 7261 7465 6779  padding strategy
+00020930: 2e0d 0a20 2020 2049 6e20 5079 746f 7263  ...    In Pytorc
+00020940: 6820 7468 6520 636f 6d70 6c65 7465 2066  h the complete f
+00020950: 6f72 6d61 7420 6973 2032 2a20 7261 6e6b  ormat is 2* rank
+00020960: 2065 782e 3a20 636f 6e76 3264 2072 616e   ex.: conv2d ran
+00020970: 6b3d 3220 4e43 4857 202c 2077 6520 6f6e  k=2 NCHW , we on
+00020980: 6c79 206e 6565 6420 746f 2070 6164 2074  ly need to pad t
+00020990: 6865 206c 6173 7420 3220 6469 6d65 6e74  he last 2 diment
+000209a0: 696f 6e73 0d0a 2020 2020 616e 6420 7468  ions..    and th
+000209b0: 6520 6d6f 7374 2074 6572 7269 626c 6520  e most terrible 
+000209c0: 2069 7320 2070 6164 6469 6e67 2069 6e20   is  padding in 
+000209d0: 7261 6e6b 2066 6f72 6d61 7420 616e 6420  rank format and 
+000209e0: 322a 7261 6e6b 2066 6f72 6d61 7420 6172  2*rank format ar
+000209f0: 6520 7065 7266 6563 746c 7920 2252 4556  e perfectly "REV
+00020a00: 4552 5345 2221 210d 0a20 2020 2043 6f6e  ERSE"!!..    Con
+00020a10: 7632 6428 2833 2c33 292c 2033 322c 2073  v2d((3,3), 32, s
+00020a20: 7472 6964 6573 3d31 2920 2020 7061 6464  trides=1)   padd
+00020a30: 696e 673d 2831 2c20 3129 203d 3d3e 2868  ing=(1, 1) ==>(h
+00020a40: 6569 6768 7420 2c20 7769 6474 6829 0d0a  eight , width)..
+00020a50: 2020 2020 436f 6e76 3264 2828 332c 3329      Conv2d((3,3)
+00020a60: 2c20 3332 2c20 7374 7269 6465 733d 3129  , 32, strides=1)
+00020a70: 2020 2066 756c 6c20 7061 6464 696e 673d     full padding=
+00020a80: 2831 2c20 312c 2031 2c20 3129 203d 3d3e  (1, 1, 1, 1) ==>
+00020a90: 286c 6566 7420 7269 6768 7420 2c20 746f  (left right , to
+00020aa0: 7020 2c20 646f 776e 290d 0a0d 0a20 2020  p , down)....   
+00020ab0: 2049 6e20 7465 6e73 6f72 666c 6f77 2074   In tensorflow t
+00020ac0: 6865 2063 6f6d 706c 6574 6520 666f 726d  he complete form
+00020ad0: 6174 2069 7320 322a 2028 7261 6e6b 2b32  at is 2* (rank+2
+00020ae0: 2920 6578 2e3a 2063 6f6e 7632 6420 7261  ) ex.: conv2d ra
+00020af0: 6e6b 3d32 204e 4857 4320 2c20 7765 206f  nk=2 NHWC , we o
+00020b00: 6e6c 7920 6e65 6564 2074 6f20 7061 6420  nly need to pad 
+00020b10: 7468 6520 6d69 6464 6c65 2032 2064 696d  the middle 2 dim
+00020b20: 656e 7469 6f6e 7320 616e 6420 656d 7074  entions and empt
+00020b30: 7920 6865 6164 2061 6e64 2074 6169 6c20  y head and tail 
+00020b40: 6469 6d65 6e74 696f 6e73 0d0a 2020 2020  dimentions..    
+00020b50: 436f 6e76 3264 2828 332c 3329 2c20 3332  Conv2d((3,3), 32
+00020b60: 2c20 7374 7269 6465 733d 3129 2020 2070  , strides=1)   p
+00020b70: 6164 6469 6e67 3d28 312c 2031 2920 3d3d  adding=(1, 1) ==
+00020b80: 3e28 6865 6967 6874 202c 2077 6964 7468  >(height , width
+00020b90: 290d 0a20 2020 2043 6f6e 7632 6428 2833  )..    Conv2d((3
+00020ba0: 2c33 292c 2033 322c 2073 7472 6964 6573  ,3), 32, strides
+00020bb0: 3d31 2920 2020 6675 6c6c 2070 6164 6469  =1)   full paddi
+00020bc0: 6e67 3d28 2830 2c20 3029 2c20 2831 2c20  ng=((0, 0), (1, 
+00020bd0: 3129 2c20 2831 2c20 3129 2c20 2830 2c20  1), (1, 1), (0, 
+00020be0: 3029 2920 3d3d 3e28 2862 6174 6368 292c  0)) ==>((batch),
+00020bf0: 2028 6865 6967 6874 292c 2028 7769 6474   (height), (widt
+00020c00: 6829 2c20 2863 6861 6e6e 656c 290d 0a0d  h), (channel)...
+00020c10: 0a20 2020 2066 6f72 2063 6c65 6172 2061  .    for clear a
+00020c20: 6e64 206e 6f2d 636f 6e66 7573 6564 2064  nd no-confused d
+00020c30: 6566 696e 6974 696f 6e2c 2074 7269 6465  efinition, tride
+00020c40: 6e74 2077 696c 6c20 616c 7761 7973 2064  nt will always d
+00020c50: 6566 696e 6520 7061 6464 696e 6720 6279  efine padding by
+00020c60: 2074 6865 206e 6174 7572 6520 6f72 6469   the nature ordi
+00020c70: 6e61 6c20 6f66 2074 6865 2064 696d 656e  nal of the dimen
+00020c80: 7469 6f6e 2e0d 0a20 2020 2065 782e 2043  tion...    ex. C
+00020c90: 6f6e 7632 6428 2833 2c33 292c 2033 322c  onv2d((3,3), 32,
+00020ca0: 2073 7472 6964 6573 3d31 290d 0a20 2020   strides=1)..   
+00020cb0: 204e 6f20 6d61 7474 6572 2069 6e20 7079   No matter in py
+00020cc0: 746f 7263 6820 6f72 2074 656e 736f 7266  torch or tensorf
+00020cd0: 6c6f 7720 6261 636b 656e 640d 0a20 2020  low backend..   
+00020ce0: 2070 6164 6469 6e67 3d28 312c 2031 2920   padding=(1, 1) 
+00020cf0: 3d3d 3e28 6865 6967 6874 202c 2077 6964  ==>(height , wid
+00020d00: 7468 290d 0a20 2020 2070 6164 6469 6e67  th)..    padding
+00020d10: 3d28 2831 2c20 3129 2c28 312c 3129 2920  =((1, 1),(1,1)) 
+00020d20: 3d3d 3e28 6865 6967 6874 202c 2077 6964  ==>(height , wid
+00020d30: 7468 290d 0a0d 0a20 2020 2041 7267 733a  th)....    Args:
+00020d40: 0d0a 2020 2020 2020 2020 7061 6464 696e  ..        paddin
+00020d50: 6720 284e 6f6e 652c 2069 6e74 2c20 7475  g (None, int, tu
+00020d60: 706c 6529 3a0d 0a20 2020 2020 2020 2072  ple):..        r
+00020d70: 616e 6b20 2869 6e74 293a 0d0a 0d0a 2020  ank (int):....  
+00020d80: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+00020d90: 2020 2020 7468 6520 6e6f 726d 616c 697a      the normaliz
+00020da0: 6564 2066 6f72 6d61 7420 6f66 2070 6164  ed format of pad
+00020db0: 6469 6e67 0d0a 2020 2020 4578 616d 706c  ding..    Exampl
+00020dc0: 6573 0d0a 2020 2020 3e3e 3e20 6e6f 726d  es..    >>> norm
+00020dd0: 616c 697a 655f 7061 6464 696e 6728 2828  alize_padding(((
+00020de0: 312c 3029 2c28 312c 3029 292c 3229 0d0a  1,0),(1,0)),2)..
+00020df0: 2020 2020 2828 312c 2030 292c 2028 312c      ((1, 0), (1,
+00020e00: 2030 2929 0d0a 2020 2020 3e3e 3e20 6e6f   0))..    >>> no
+00020e10: 726d 616c 697a 655f 7061 6464 696e 6728  rmalize_padding(
+00020e20: 2831 2c30 292c 3229 0d0a 2020 2020 2828  (1,0),2)..    ((
+00020e30: 312c 2031 292c 2028 302c 2030 2929 0d0a  1, 1), (0, 0))..
+00020e40: 2020 2020 3e3e 3e20 6e6f 726d 616c 697a      >>> normaliz
+00020e50: 655f 7061 6464 696e 6728 312c 3229 0d0a  e_padding(1,2)..
+00020e60: 2020 2020 2828 312c 2031 292c 2028 312c      ((1, 1), (1,
+00020e70: 2031 2929 0d0a 2020 2020 3e3e 3e20 6e6f   1))..    >>> no
+00020e80: 726d 616c 697a 655f 7061 6464 696e 6728  rmalize_padding(
+00020e90: 2831 292c 3229 0d0a 2020 2020 2828 312c  (1),2)..    ((1,
+00020ea0: 2031 292c 2028 312c 2031 2929 0d0a 2020   1), (1, 1))..  
+00020eb0: 2020 3e3e 3e20 6e6f 726d 616c 697a 655f    >>> normalize_
+00020ec0: 7061 6464 696e 6728 2831 2c30 292c 3229  padding((1,0),2)
+00020ed0: 0d0a 2020 2020 2828 312c 2031 292c 2028  ..    ((1, 1), (
+00020ee0: 302c 2030 2929 0d0a 2020 203e 3e3e 206e  0, 0))..   >>> n
+00020ef0: 6f72 6d61 6c69 7a65 5f70 6164 6469 6e67  ormalize_padding
+00020f00: 2828 302c 3120 2c30 2c20 3129 2c32 290d  ((0,1 ,0, 1),2).
+00020f10: 0a20 2020 2828 302c 2031 292c 2028 302c  .   ((0, 1), (0,
+00020f20: 2031 2929 0d0a 0d0a 2020 2020 2222 220d   1))....    """.
+00020f30: 0a20 2020 2069 6620 7061 6464 696e 6720  .    if padding 
+00020f40: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00020f50: 2020 2320 4e6f 6e65 3d3e 2828 302c 3029    # None=>((0,0)
+00020f60: 2c28 302c 3029 290d 0a20 2020 2020 2020  ,(0,0))..       
+00020f70: 2070 6164 6469 6e67 203d 2028 2830 2c20   padding = ((0, 
+00020f80: 3029 2c29 202a 2072 616e 6b0d 0a20 2020  0),) * rank..   
+00020f90: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00020fa0: 2870 6164 6469 6e67 2c20 696e 7429 3a0d  (padding, int):.
+00020fb0: 0a20 2020 2020 2020 2023 2031 3d3e 2828  .        # 1=>((
+00020fc0: 312c 3129 2c28 312c 3129 290d 0a20 2020  1,1),(1,1))..   
+00020fd0: 2020 2020 2070 6164 6469 6e67 203d 2028       padding = (
+00020fe0: 2870 6164 6469 6e67 2c20 7061 6464 696e  (padding, paddin
+00020ff0: 6729 2c29 202a 2072 616e 6b0d 0a20 2020  g),) * rank..   
+00021000: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00021010: 2870 6164 6469 6e67 2c20 286c 6973 742c  (padding, (list,
+00021020: 2074 7570 6c65 2929 2061 6e64 206c 656e   tuple)) and len
+00021030: 2870 6164 6469 6e67 2920 3d3d 2031 2061  (padding) == 1 a
+00021040: 6e64 2070 6164 6469 6e67 5b30 5d20 3d3d  nd padding[0] ==
+00021050: 2069 6e74 3a0d 0a20 2020 2020 2020 2023   int:..        #
+00021060: 2028 3129 3d3e 2828 312c 3129 2c28 312c   (1)=>((1,1),(1,
+00021070: 3129 290d 0a20 2020 2020 2020 2070 6164  1))..        pad
+00021080: 6469 6e67 203d 2028 2870 6164 6469 6e67  ding = ((padding
+00021090: 5b30 5d2c 2070 6164 6469 6e67 5b30 5d29  [0], padding[0])
+000210a0: 2c29 202a 2072 616e 6b0d 0a20 2020 2065  ,) * rank..    e
+000210b0: 6c69 6620 6973 696e 7374 616e 6365 2870  lif isinstance(p
+000210c0: 6164 6469 6e67 2c20 286c 6973 742c 2074  adding, (list, t
+000210d0: 7570 6c65 2929 2061 6e64 206c 656e 2870  uple)) and len(p
+000210e0: 6164 6469 6e67 2920 3d3d 2072 616e 6b20  adding) == rank 
+000210f0: 616e 6420 6973 696e 7374 616e 6365 2870  and isinstance(p
+00021100: 6164 6469 6e67 5b30 5d2c 2069 6e74 293a  adding[0], int):
+00021110: 0d0a 2020 2020 2020 2020 2320 7261 6e6b  ..        # rank
+00021120: 3d32 2028 312c 3129 3d3e 2828 312c 312c  =2 (1,1)=>((1,1,
+00021130: 292c 2028 312c 3129 2920 2020 2831 2c30  ), (1,1))   (1,0
+00021140: 293d 3e28 2831 2c31 292c 2830 2c30 2929  )=>((1,1),(0,0))
+00021150: 0d0a 2020 2020 2020 2020 7061 6464 696e  ..        paddin
+00021160: 6720 3d20 6c69 7374 2870 6164 6469 6e67  g = list(padding
+00021170: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00021180: 6e5f 7061 6464 696e 6720 3d20 5b5d 0d0a  n_padding = []..
+00021190: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000211a0: 2072 616e 6765 2872 616e 6b29 3a0d 0a20   range(rank):.. 
+000211b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000211c0: 6e5f 7061 6464 696e 672e 6170 7065 6e64  n_padding.append
+000211d0: 2828 7061 6464 696e 675b 695d 2c20 7061  ((padding[i], pa
+000211e0: 6464 696e 675b 695d 2929 0d0a 2020 2020  dding[i]))..    
+000211f0: 2020 2020 7061 6464 696e 6720 3d20 7475      padding = tu
+00021200: 706c 6528 7265 7475 726e 5f70 6164 6469  ple(return_paddi
+00021210: 6e67 290d 0a20 2020 2065 6c69 6620 6973  ng)..    elif is
+00021220: 696e 7374 616e 6365 2870 6164 6469 6e67  instance(padding
+00021230: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+00021240: 2061 6e64 206c 656e 2870 6164 6469 6e67   and len(padding
+00021250: 2920 3d3d 2072 616e 6b20 616e 6420 6973  ) == rank and is
+00021260: 696e 7374 616e 6365 2870 6164 6469 6e67  instance(padding
+00021270: 5b30 5d2c 2028 6c69 7374 2c20 7475 706c  [0], (list, tupl
+00021280: 6529 293a 0d0a 2020 2020 2020 2020 2320  e)):..        # 
+00021290: 7261 6e6b 3d32 2020 2828 312c 3029 2c28  rank=2  ((1,0),(
+000212a0: 312c 3029 3d3e 2831 2c30 2c31 2c30 290d  1,0)=>(1,0,1,0).
+000212b0: 0a20 2020 2020 2020 2070 6173 7320 2023  .        pass  #
+000212c0: 2070 6164 6469 6e67 3d20 7475 706c 6528   padding= tuple(
+000212d0: 6c69 7374 2869 7465 7274 6f6f 6c73 2e63  list(itertools.c
+000212e0: 6861 696e 282a 6c69 7374 2870 6164 6469  hain(*list(paddi
+000212f0: 6e67 2929 2929 0d0a 2020 2020 656c 6966  ng))))..    elif
+00021300: 2069 7369 6e73 7461 6e63 6528 7061 6464   isinstance(padd
+00021310: 696e 672c 2028 6c69 7374 2c20 7475 706c  ing, (list, tupl
+00021320: 6529 2920 616e 6420 6c65 6e28 7061 6464  e)) and len(padd
+00021330: 696e 6729 203d 3d20 3220 2a20 7261 6e6b  ing) == 2 * rank
+00021340: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00021350: 7061 6464 696e 675b 305d 2c20 696e 7429  padding[0], int)
+00021360: 3a0d 0a20 2020 2020 2020 2070 6164 6469  :..        paddi
+00021370: 6e67 203d 2028 2870 6164 6469 6e67 5b30  ng = ((padding[0
+00021380: 5d2c 2070 6164 6469 6e67 5b31 5d29 2c20  ], padding[1]), 
+00021390: 2870 6164 6469 6e67 5b32 5d2c 2070 6164  (padding[2], pad
+000213a0: 6469 6e67 5b33 5d29 290d 0a20 2020 2072  ding[3]))..    r
+000213b0: 6574 7572 6e20 7061 6464 696e 670d 0a0d  eturn padding...
+000213c0: 0a0d 0a64 6566 2074 7279 5f6d 6170 5f61  ...def try_map_a
+000213d0: 7267 735f 616e 645f 6361 6c6c 2866 6e2c  rgs_and_call(fn,
+000213e0: 2064 6174 613a 204f 7264 6572 6564 4469   data: OrderedDi
+000213f0: 6374 2c20 6461 7461 5f66 6565 643a 204f  ct, data_feed: O
+00021400: 7264 6572 6564 4469 6374 203d 204e 6f6e  rderedDict = Non
+00021410: 652c 2069 735f 6175 746f 6361 7374 5f65  e, is_autocast_e
+00021420: 6e61 626c 6564 3d46 616c 7365 293a 0d0a  nabled=False):..
+00021430: 2020 2020 2222 2254 6869 7320 6675 6e63      """This func
+00021440: 7469 6f6e 2069 7320 7468 6520 636f 7265  tion is the core
+00021450: 2066 756e 6374 696f 6e20 666f 7220 6d61   function for ma
+00021460: 7070 696e 6720 6361 6c6c 6162 6c65 2061  pping callable a
+00021470: 6e64 2061 7267 6d65 6e74 730d 0a0d 0a20  nd argments.... 
+00021480: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+00021490: 2020 666e 2028 6361 6c6c 6162 6c65 293a    fn (callable):
+000214a0: 2074 6865 2063 616c 6c61 626c 652c 206d   the callable, m
+000214b0: 6179 6265 2066 756e 6374 696f 6e73 206f  aybe functions o
+000214c0: 7220 6c61 7965 7273 0d0a 2020 2020 2020  r layers..      
+000214d0: 2020 6461 7461 2028 4f72 6465 7265 6444    data (OrderedD
+000214e0: 6963 7429 3a20 5468 6520 6b65 792d 7661  ict): The key-va
+000214f0: 6c75 6520 7061 6972 2066 6f72 2061 7661  lue pair for ava
+00021500: 696c 6162 6c65 2064 6174 612e 0d0a 2020  ilable data...  
+00021510: 2020 2020 2020 6461 7461 5f66 6565 6420        data_feed 
+00021520: 284f 7264 6572 6564 4469 6374 293a 2054  (OrderedDict): T
+00021530: 6865 2072 656c 6174 696f 6e20 6265 7477  he relation betw
+00021540: 6565 6e20 6361 6c6c 6162 6c65 2061 7267  een callable arg
+00021550: 6d65 6e74 7320 286b 6579 2920 616e 6420  ments (key) and 
+00021560: 6461 7461 2028 7661 6c75 6529 0d0a 2020  data (value)..  
+00021570: 2020 2020 2020 6973 5f61 7574 6f63 6173        is_autocas
+00021580: 745f 656e 6162 6c65 640d 0a0d 0a0d 0a20  t_enabled...... 
+00021590: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
+000215a0: 2020 2020 2054 6865 2072 6573 756c 7420       The result 
+000215b0: 6f66 2074 6865 2063 616c 6c61 626c 6520  of the callable 
+000215c0: 6261 7365 206f 6e20 6461 7461 5f66 6565  base on data_fee
+000215d0: 640d 0a0d 0a20 2020 2022 2222 0d0a 0d0a  d....    """....
+000215e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000215f0: 6528 666e 2c20 7466 2e54 656e 736f 7229  e(fn, tf.Tensor)
+00021600: 206f 7220 2745 6167 6572 5465 6e73 6f72   or 'EagerTensor
+00021610: 2720 696e 2066 6e2e 5f5f 636c 6173 735f  ' in fn.__class_
+00021620: 5f2e 5f5f 6e61 6d65 5f5f 3a0d 0a20 2020  _.__name__:..   
+00021630: 2020 2020 2072 6574 7572 6e20 666e 0d0a       return fn..
+00021640: 2020 2020 656c 7365 3a0d 0a0d 0a20 2020      else:....   
+00021650: 2020 2020 2061 7267 5f6d 6170 203d 204f       arg_map = O
+00021660: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
+00021670: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00021680: 6e63 6528 666e 2c20 4c61 7965 7229 3a0d  nce(fn, Layer):.
+00021690: 0a20 2020 2020 2020 2020 2020 205f 6465  .            _de
+000216a0: 7669 6365 203d 2066 6e2e 6765 745f 726f  vice = fn.get_ro
+000216b0: 6f74 2829 2e64 6576 6963 650d 0a20 2020  ot().device..   
+000216c0: 2020 2020 2020 2020 205f 7369 676e 6174           _signat
+000216d0: 7572 6520 3d20 666e 2e5f 7369 676e 6174  ure = fn._signat
+000216e0: 7572 650d 0a20 2020 2020 2020 2020 2020  ure..           
+000216f0: 2069 6620 4e6f 6e65 2069 6e20 666e 2e5f   if None in fn._
+00021700: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
+00021710: 2e76 616c 7565 5f6c 6973 743a 0d0a 2020  .value_list:..  
+00021720: 2020 2020 2020 2020 2020 2020 2020 5f73                _s
+00021730: 6967 6e61 7475 7265 203d 2067 6574 5f73  ignature = get_s
+00021740: 6967 6e61 7475 7265 2866 6e29 0d0a 2020  ignature(fn)..  
+00021750: 2020 2020 2020 2020 2020 666f 7220 6172            for ar
+00021760: 6720 696e 2066 6e2e 7369 676e 6174 7572  g in fn.signatur
+00021770: 652e 696e 7075 7473 2e6b 6579 5f6c 6973  e.inputs.key_lis
+00021780: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00021790: 2020 2020 6973 5f6f 7074 696f 6e61 6c20      is_optional 
+000217a0: 3d20 666e 2e73 6967 6e61 7475 7265 2e69  = fn.signature.i
+000217b0: 6e70 7574 735b 6172 675d 2e6f 7074 696f  nputs[arg].optio
+000217c0: 6e61 6c20 6966 2069 7369 6e73 7461 6e63  nal if isinstanc
+000217d0: 6528 666e 2e73 6967 6e61 7475 7265 2e69  e(fn.signature.i
+000217e0: 6e70 7574 735b 6172 675d 2c0d 0a20 2020  nputs[arg],..   
+000217f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021830: 2020 2020 2020 2020 2020 2054 656e 736f             Tenso
+00021840: 7253 7065 6329 2065 6c73 6520 4661 6c73  rSpec) else Fals
+00021850: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00021860: 2020 2064 6566 6175 6c74 203d 2066 6e2e     default = fn.
+00021870: 7369 676e 6174 7572 652e 696e 7075 7473  signature.inputs
+00021880: 5b61 7267 5d2e 6465 6661 756c 7420 6966  [arg].default if
+00021890: 2069 7369 6e73 7461 6e63 6528 666e 2e73   isinstance(fn.s
+000218a0: 6967 6e61 7475 7265 2e69 6e70 7574 735b  ignature.inputs[
+000218b0: 6172 675d 2c20 5465 6e73 6f72 5370 6563  arg], TensorSpec
+000218c0: 2920 656c 7365 204e 6f6e 650d 0a20 2020  ) else None..   
+000218d0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+000218e0: 696e 7075 7420 3d20 6172 672e 6c6f 7765  input = arg.lowe
+000218f0: 7228 2920 696e 205b 2778 272c 2027 696e  r() in ['x', 'in
+00021900: 7075 7427 5d0d 0a20 2020 2020 2020 2020  put']..         
+00021910: 2020 2020 2020 2069 735f 6f75 7470 7574         is_output
+00021920: 203d 2061 7267 2e6c 6f77 6572 2829 2069   = arg.lower() i
+00021930: 6e20 5b27 7927 2c20 276f 7574 7075 7427  n ['y', 'output'
+00021940: 2c20 2779 5f70 7265 6427 5d0d 0a20 2020  , 'y_pred']..   
+00021950: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00021960: 6172 6720 696e 2064 6174 615f 6665 6564  arg in data_feed
+00021970: 2061 6e64 2064 6174 615f 6665 6564 5b61   and data_feed[a
+00021980: 7267 5d20 696e 2064 6174 613a 0d0a 2020  rg] in data:..  
+00021990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219a0: 2020 6172 675f 6d61 705b 6172 675d 203d    arg_map[arg] =
+000219b0: 2074 6f5f 7465 6e73 6f72 2864 6174 615b   to_tensor(data[
+000219c0: 6461 7461 5f66 6565 645b 6172 675d 5d2c  data_feed[arg]],
+000219d0: 2064 6576 6963 653d 5f64 6576 6963 6529   device=_device)
+000219e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000219f0: 2020 656c 6966 2061 7267 2069 6e20 6461    elif arg in da
+00021a00: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
+00021a10: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
+00021a20: 5b61 7267 5d20 3d20 746f 5f74 656e 736f  [arg] = to_tenso
+00021a30: 7228 6461 7461 5b61 7267 5d2c 2064 6576  r(data[arg], dev
+00021a40: 6963 653d 5f64 6576 6963 6529 0d0a 2020  ice=_device)..  
+00021a50: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00021a60: 6966 2069 735f 696e 7075 7420 616e 6420  if is_input and 
+00021a70: 2769 6e70 7574 2720 696e 2064 6174 613a  'input' in data:
+00021a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021a90: 2020 2020 2020 6172 675f 6d61 705b 6172        arg_map[ar
+00021aa0: 675d 203d 2074 6f5f 7465 6e73 6f72 2864  g] = to_tensor(d
+00021ab0: 6174 615b 2769 6e70 7574 275d 2c20 6465  ata['input'], de
+00021ac0: 7669 6365 3d5f 6465 7669 6365 290d 0a20  vice=_device).. 
+00021ad0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00021ae0: 6c69 6620 6973 5f6f 7574 7075 7420 616e  lif is_output an
+00021af0: 6420 276f 7574 7075 7427 2069 6e20 6461  d 'output' in da
+00021b00: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
+00021b10: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
+00021b20: 5b61 7267 5d20 3d20 746f 5f74 656e 736f  [arg] = to_tenso
+00021b30: 7228 6461 7461 5b27 6f75 7470 7574 275d  r(data['output']
+00021b40: 2c20 6465 7669 6365 3d5f 6465 7669 6365  , device=_device
+00021b50: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00021b60: 2020 2065 6c69 6620 6973 5f6f 7074 696f     elif is_optio
+00021b70: 6e61 6c3a 0d0a 2020 2020 2020 2020 2020  nal:..          
+00021b80: 2020 2020 2020 2020 2020 6172 675f 6d61            arg_ma
+00021b90: 705b 6172 675d 203d 2064 6566 6175 6c74  p[arg] = default
+00021ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021bb0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00021bc0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00021bd0: 7365 2056 616c 7565 4572 726f 7228 2761  se ValueError('a
+00021be0: 7267 203a 7b30 7d20 6361 6e6e 6f74 206d  rg :{0} cannot m
+00021bf0: 6170 7069 6e67 2063 6f72 7265 6374 6c79  apping correctly
+00021c00: 2127 2e66 6f72 6d61 7428 6172 6729 290d  !'.format(arg)).
+00021c10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00021c20: 6374 782e 616d 705f 6176 6169 6c61 626c  ctx.amp_availabl
+00021c30: 6520 3d3d 2054 7275 6520 616e 6420 6973  e == True and is
+00021c40: 5f61 7574 6f63 6173 745f 656e 6162 6c65  _autocast_enable
+00021c50: 6420 3d3d 2054 7275 6520 616e 6420 6765  d == True and ge
+00021c60: 745f 6465 7669 6365 2829 203d 3d20 2763  t_device() == 'c
+00021c70: 7564 6127 3a0d 0a20 2020 2020 2020 2020  uda':..         
+00021c80: 2020 2020 2020 2023 206e 6f74 2073 7570         # not sup
+00021c90: 706f 7274 2079 6574 0d0a 2020 2020 2020  port yet..      
+00021ca0: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
+00021cb0: 666e 282a 6172 675f 6d61 702e 7661 6c75  fn(*arg_map.valu
+00021cc0: 655f 6c69 7374 290d 0a20 2020 2020 2020  e_list)..       
+00021cd0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00021ce0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
+00021cf0: 3d20 666e 282a 6172 675f 6d61 702e 7661  = fn(*arg_map.va
+00021d00: 6c75 655f 6c69 7374 290d 0a20 2020 2020  lue_list)..     
+00021d10: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+00021d20: 740d 0a0d 0a20 2020 2020 2020 2065 6c69  t....        eli
+00021d30: 6620 2868 6173 6174 7472 2866 6e2c 2027  f (hasattr(fn, '
+00021d40: 7369 676e 6174 7572 6527 2920 6f72 2068  signature') or h
+00021d50: 6173 6174 7472 2866 6e2c 2027 5f73 6967  asattr(fn, '_sig
+00021d60: 6e61 7475 7265 2729 2920 616e 6420 6361  nature')) and ca
+00021d70: 6c6c 6162 6c65 2866 6e29 3a0d 0a20 2020  llable(fn):..   
+00021d80: 2020 2020 2020 2020 2073 6967 203d 2066           sig = f
+00021d90: 6e2e 5f73 6967 6e61 7475 7265 2069 6620  n._signature if 
+00021da0: 6861 7361 7474 7228 666e 2c20 275f 7369  hasattr(fn, '_si
+00021db0: 676e 6174 7572 6527 2920 656c 7365 2066  gnature') else f
+00021dc0: 6e2e 7369 676e 6174 7572 650d 0a20 2020  n.signature..   
+00021dd0: 2020 2020 2020 2020 2066 6f72 2061 7267           for arg
+00021de0: 2069 6e20 7369 672e 696e 7075 7473 2e6b   in sig.inputs.k
+00021df0: 6579 5f6c 6973 743a 0d0a 2020 2020 2020  ey_list:..      
+00021e00: 2020 2020 2020 2020 2020 6973 5f6f 7074            is_opt
+00021e10: 696f 6e61 6c20 3d20 7369 672e 696e 7075  ional = sig.inpu
+00021e20: 7473 5b61 7267 5d2e 6f70 7469 6f6e 616c  ts[arg].optional
+00021e30: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+00021e40: 6967 2e69 6e70 7574 735b 6172 675d 2c20  ig.inputs[arg], 
+00021e50: 5465 6e73 6f72 5370 6563 2920 656c 7365  TensorSpec) else
+00021e60: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00021e70: 2020 2020 2020 2020 6465 6661 756c 7420          default 
+00021e80: 3d20 7369 672e 696e 7075 7473 5b61 7267  = sig.inputs[arg
+00021e90: 5d2e 6465 6661 756c 7420 6966 2069 7369  ].default if isi
+00021ea0: 6e73 7461 6e63 6528 7369 672e 696e 7075  nstance(sig.inpu
+00021eb0: 7473 5b61 7267 5d2c 2054 656e 736f 7253  ts[arg], TensorS
+00021ec0: 7065 6329 2065 6c73 6520 4e6f 6e65 0d0a  pec) else None..
+00021ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ee0: 6973 5f69 6e70 7574 203d 2061 7267 2e6c  is_input = arg.l
+00021ef0: 6f77 6572 2829 2069 6e20 5b27 7827 2c20  ower() in ['x', 
+00021f00: 2769 6e70 7574 275d 0d0a 2020 2020 2020  'input']..      
+00021f10: 2020 2020 2020 2020 2020 6973 5f6f 7574            is_out
+00021f20: 7075 7420 3d20 6172 672e 6c6f 7765 7228  put = arg.lower(
+00021f30: 2920 696e 205b 2779 272c 2027 6f75 7470  ) in ['y', 'outp
+00021f40: 7574 272c 2027 795f 7072 6564 275d 0d0a  ut', 'y_pred']..
+00021f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f60: 6966 2061 7267 2069 6e20 6461 7461 5f66  if arg in data_f
+00021f70: 6565 6420 616e 6420 6461 7461 5f66 6565  eed and data_fee
+00021f80: 645b 6172 675d 2069 6e20 6461 7461 3a0d  d[arg] in data:.
+00021f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021fa0: 2020 2020 2061 7267 5f6d 6170 5b61 7267       arg_map[arg
+00021fb0: 5d20 3d20 746f 5f74 656e 736f 7228 6461  ] = to_tensor(da
+00021fc0: 7461 5b64 6174 615f 6665 6564 5b61 7267  ta[data_feed[arg
+00021fd0: 5d5d 2c20 6465 7669 6365 3d67 6574 5f64  ]], device=get_d
+00021fe0: 6576 6963 6528 2929 0d0a 2020 2020 2020  evice())..      
+00021ff0: 2020 2020 2020 2020 2020 656c 6966 2061            elif a
+00022000: 7267 2069 6e20 6461 7461 3a0d 0a20 2020  rg in data:..   
+00022010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022020: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
+00022030: 746f 5f74 656e 736f 7228 6461 7461 5b61  to_tensor(data[a
+00022040: 7267 5d2c 2064 6576 6963 653d 6765 745f  rg], device=get_
+00022050: 6465 7669 6365 2829 290d 0a20 2020 2020  device())..     
+00022060: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00022070: 6973 5f69 6e70 7574 2061 6e64 2027 696e  is_input and 'in
+00022080: 7075 7427 2069 6e20 6461 7461 5f66 6565  put' in data_fee
+00022090: 6420 616e 6420 6461 7461 5f66 6565 645b  d and data_feed[
+000220a0: 2769 6e70 7574 275d 2069 6e20 6461 7461  'input'] in data
+000220b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000220c0: 2020 2020 2020 2061 7267 5f6d 6170 5b61         arg_map[a
+000220d0: 7267 5d20 3d20 746f 5f74 656e 736f 7228  rg] = to_tensor(
+000220e0: 6461 7461 5b64 6174 615f 6665 6564 5b27  data[data_feed['
+000220f0: 696e 7075 7427 5d5d 2c20 6465 7669 6365  input']], device
+00022100: 3d67 6574 5f64 6576 6963 6528 2929 0d0a  =get_device())..
+00022110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022120: 656c 6966 2069 735f 6f75 7470 7574 2061  elif is_output a
+00022130: 6e64 2027 6f75 7470 7574 2720 696e 2064  nd 'output' in d
+00022140: 6174 615f 6665 6564 2061 6e64 2064 6174  ata_feed and dat
+00022150: 615f 6665 6564 5b27 6f75 7470 7574 275d  a_feed['output']
+00022160: 2069 6e20 6461 7461 3a0d 0a20 2020 2020   in data:..     
+00022170: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00022180: 7267 5f6d 6170 5b61 7267 5d20 3d20 746f  rg_map[arg] = to
+00022190: 5f74 656e 736f 7228 6461 7461 5b64 6174  _tensor(data[dat
+000221a0: 615f 6665 6564 5b27 6f75 7470 7574 275d  a_feed['output']
+000221b0: 5d2c 2064 6576 6963 653d 6765 745f 6465  ], device=get_de
+000221c0: 7669 6365 2829 290d 0a20 2020 2020 2020  vice())..       
+000221d0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+000221e0: 696e 7374 616e 6365 2866 6e2c 2066 756e  instance(fn, fun
+000221f0: 6374 6f6f 6c73 2e70 6172 7469 616c 2920  ctools.partial) 
+00022200: 616e 6420 6172 6720 696e 2066 6e2e 6b65  and arg in fn.ke
+00022210: 7977 6f72 6473 3a0d 0a20 2020 2020 2020  ywords:..       
+00022220: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+00022230: 5f6d 6170 5b61 7267 5d20 3d20 666e 2e6b  _map[arg] = fn.k
+00022240: 6579 776f 7264 735b 6172 675d 0d0a 2020  eywords[arg]..  
+00022250: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00022260: 6966 2069 735f 6f70 7469 6f6e 616c 3a0d  if is_optional:.
+00022270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022280: 2020 2020 2061 7267 5f6d 6170 5b61 7267       arg_map[arg
+00022290: 5d20 3d20 6465 6661 756c 740d 0a20 2020  ] = default..   
+000222a0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+000222b0: 6620 6172 6720 3d3d 2027 795f 7072 6564  f arg == 'y_pred
+000222c0: 2720 616e 6420 276f 7574 7075 7427 2069  ' and 'output' i
+000222d0: 6e20 6461 7461 3a0d 0a20 2020 2020 2020  n data:..       
+000222e0: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+000222f0: 5f6d 6170 5b61 7267 5d20 3d20 6461 7461  _map[arg] = data
+00022300: 5b27 6f75 7470 7574 275d 0d0a 2020 2020  ['output']..    
+00022310: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00022320: 2061 7267 203d 3d20 2779 5f74 7275 6527   arg == 'y_true'
+00022330: 2061 6e64 2027 7461 7267 6574 2720 696e   and 'target' in
+00022340: 2064 6174 613a 0d0a 2020 2020 2020 2020   data:..        
+00022350: 2020 2020 2020 2020 2020 2020 6172 675f              arg_
+00022360: 6d61 705b 6172 675d 203d 2064 6174 615b  map[arg] = data[
+00022370: 2774 6172 6765 7427 5d0d 0a20 2020 2020  'target']..     
+00022380: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00022390: 6172 6720 3d3d 2027 795f 7472 7565 2720  arg == 'y_true' 
+000223a0: 616e 6420 276c 6162 656c 2720 696e 2064  and 'label' in d
+000223b0: 6174 613a 0d0a 2020 2020 2020 2020 2020  ata:..          
+000223c0: 2020 2020 2020 2020 2020 6172 675f 6d61            arg_ma
+000223d0: 705b 6172 675d 203d 2064 6174 615b 276c  p[arg] = data['l
+000223e0: 6162 656c 275d 0d0a 2020 2020 2020 2020  abel']..        
+000223f0: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
+00022400: 203d 3d20 276c 6162 656c 2720 616e 6420   == 'label' and 
+00022410: 2774 6172 6765 7427 2069 6e20 6461 7461  'target' in data
+00022420: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00022430: 2020 2020 2020 2061 7267 5f6d 6170 5b61         arg_map[a
+00022440: 7267 5d20 3d20 6461 7461 5b27 7461 7267  rg] = data['targ
+00022450: 6574 275d 0d0a 2020 2020 2020 2020 2020  et']..          
+00022460: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00022470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022480: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00022490: 7228 2761 7267 203a 7b30 7d20 6361 6e6e  r('arg :{0} cann
+000224a0: 6f74 206d 6170 7069 6e67 2063 6f72 7265  ot mapping corre
+000224b0: 6374 6c79 2127 2e66 6f72 6d61 7428 6172  ctly!'.format(ar
+000224c0: 6729 290d 0a0d 0a20 2020 2020 2020 2020  g))....         
+000224d0: 2020 2069 6620 6374 782e 616d 705f 6176     if ctx.amp_av
+000224e0: 6169 6c61 626c 6520 3d3d 2054 7275 6520  ailable == True 
+000224f0: 616e 6420 6973 5f61 7574 6f63 6173 745f  and is_autocast_
+00022500: 656e 6162 6c65 6420 3d3d 2054 7275 6520  enabled == True 
+00022510: 616e 6420 6765 745f 6465 7669 6365 2829  and get_device()
+00022520: 203d 3d20 2763 7564 6127 3a0d 0a20 2020   == 'cuda':..   
+00022530: 2020 2020 2020 2020 2020 2020 2023 206e               # n
+00022540: 6f74 2073 7570 706f 7274 2079 6574 0d0a  ot support yet..
+00022550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022560: 6966 2069 7369 6e73 7461 6e63 6528 666e  if isinstance(fn
+00022570: 2c20 7061 7274 6961 6c29 3a0d 0a20 2020  , partial):..   
+00022580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022590: 206f 7574 203d 2066 6e2e 6675 6e63 282a   out = fn.func(*
+000225a0: 6172 675f 6d61 702e 7661 6c75 655f 6c69  arg_map.value_li
+000225b0: 7374 290d 0a20 2020 2020 2020 2020 2020  st)..           
+000225c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000225d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225e0: 6f75 7420 3d20 666e 282a 6172 675f 6d61  out = fn(*arg_ma
+000225f0: 702e 7661 6c75 655f 6c69 7374 290d 0a20  p.value_list).. 
+00022600: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00022610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022620: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00022630: 666e 2c20 7061 7274 6961 6c29 3a0d 0a20  fn, partial):.. 
+00022640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022650: 2020 206f 7574 203d 2066 6e2e 6675 6e63     out = fn.func
+00022660: 282a 6172 675f 6d61 702e 7661 6c75 655f  (*arg_map.value_
+00022670: 6c69 7374 290d 0a20 2020 2020 2020 2020  list)..         
+00022680: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00022690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226a0: 2020 6f75 7420 3d20 666e 282a 6172 675f    out = fn(*arg_
+000226b0: 6d61 702e 7661 6c75 655f 6c69 7374 290d  map.value_list).
+000226c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000226d0: 7572 6e20 6f75 740d 0a20 2020 2020 2020  urn out..       
+000226e0: 2065 6c69 6620 6361 6c6c 6162 6c65 2866   elif callable(f
+000226f0: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
+00022700: 2066 6e2e 7369 676e 6174 7572 6520 3d20   fn.signature = 
+00022710: 6765 745f 7369 676e 6174 7572 6528 666e  get_signature(fn
+00022720: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
+00022730: 7267 7320 3d20 6765 745f 7369 676e 6174  rgs = get_signat
+00022740: 7572 6528 666e 292e 696e 7075 7473 2e6b  ure(fn).inputs.k
+00022750: 6579 5f6c 6973 740d 0a20 2020 2020 2020  ey_list..       
+00022760: 2020 2020 2066 6f72 2061 7267 2069 6e20       for arg in 
+00022770: 6172 6773 3a0d 0a20 2020 2020 2020 2020  args:..         
+00022780: 2020 2020 2020 2069 735f 6f70 7469 6f6e         is_option
+00022790: 616c 203d 2066 6e2e 7369 676e 6174 7572  al = fn.signatur
+000227a0: 652e 696e 7075 7473 5b61 7267 5d2e 6f70  e.inputs[arg].op
+000227b0: 7469 6f6e 616c 2069 6620 6973 696e 7374  tional if isinst
+000227c0: 616e 6365 2866 6e2e 7369 676e 6174 7572  ance(fn.signatur
+000227d0: 652e 696e 7075 7473 5b61 7267 5d2c 0d0a  e.inputs[arg],..
+000227e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000227f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00022800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022810: 2020 6f75 7420 3d20 666e 282a 6172 675f    out = fn(*arg_
-00022820: 6d61 702e 7661 6c75 655f 6c69 7374 290d  map.value_list).
-00022830: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00022840: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00022850: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00022860: 6528 666e 2c20 7061 7274 6961 6c29 3a0d  e(fn, partial):.
-00022870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022880: 2020 2020 206f 7574 203d 2066 6e2e 6675       out = fn.fu
-00022890: 6e63 282a 6172 675f 6d61 702e 7661 6c75  nc(*arg_map.valu
-000228a0: 655f 6c69 7374 290d 0a20 2020 2020 2020  e_list)..       
-000228b0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00022810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022820: 2020 2020 2020 2020 2020 2020 2020 5465                Te
+00022830: 6e73 6f72 5370 6563 2920 656c 7365 2046  nsorSpec) else F
+00022840: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00022850: 2020 2020 2020 6465 6661 756c 7420 3d20        default = 
+00022860: 666e 2e73 6967 6e61 7475 7265 2e69 6e70  fn.signature.inp
+00022870: 7574 735b 6172 675d 2e64 6566 6175 6c74  uts[arg].default
+00022880: 2069 6620 6973 696e 7374 616e 6365 2866   if isinstance(f
+00022890: 6e2e 7369 676e 6174 7572 652e 696e 7075  n.signature.inpu
+000228a0: 7473 5b61 7267 5d2c 2054 656e 736f 7253  ts[arg], TensorS
+000228b0: 7065 6329 2065 6c73 6520 4e6f 6e65 0d0a  pec) else None..
 000228c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228d0: 2020 2020 6f75 7420 3d20 666e 282a 6172      out = fn(*ar
-000228e0: 675f 6d61 702e 7661 6c75 655f 6c69 7374  g_map.value_list
-000228f0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00022900: 6574 7572 6e20 6f75 740d 0a20 2020 2020  eturn out..     
-00022910: 2020 2065 6c69 6620 6361 6c6c 6162 6c65     elif callable
-00022920: 2866 6e29 3a0d 0a20 2020 2020 2020 2020  (fn):..         
-00022930: 2020 2066 6e2e 7369 676e 6174 7572 6520     fn.signature 
-00022940: 3d20 6765 745f 7369 676e 6174 7572 6528  = get_signature(
-00022950: 666e 290d 0a20 2020 2020 2020 2020 2020  fn)..           
-00022960: 2061 7267 7320 3d20 6765 745f 7369 676e   args = get_sign
-00022970: 6174 7572 6528 666e 292e 696e 7075 7473  ature(fn).inputs
-00022980: 2e6b 6579 5f6c 6973 740d 0a20 2020 2020  .key_list..     
-00022990: 2020 2020 2020 2066 6f72 2061 7267 2069         for arg i
-000229a0: 6e20 6172 6773 3a0d 0a20 2020 2020 2020  n args:..       
-000229b0: 2020 2020 2020 2020 2069 735f 6f70 7469           is_opti
-000229c0: 6f6e 616c 203d 2066 6e2e 7369 676e 6174  onal = fn.signat
-000229d0: 7572 652e 696e 7075 7473 5b61 7267 5d2e  ure.inputs[arg].
-000229e0: 6f70 7469 6f6e 616c 2069 6620 6973 696e  optional if isin
-000229f0: 7374 616e 6365 2866 6e2e 7369 676e 6174  stance(fn.signat
-00022a00: 7572 652e 696e 7075 7473 5b61 7267 5d2c  ure.inputs[arg],
-00022a10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a60: 5465 6e73 6f72 5370 6563 2920 656c 7365  TensorSpec) else
-00022a70: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00022a80: 2020 2020 2020 2020 6465 6661 756c 7420          default 
-00022a90: 3d20 666e 2e73 6967 6e61 7475 7265 2e69  = fn.signature.i
-00022aa0: 6e70 7574 735b 6172 675d 2e64 6566 6175  nputs[arg].defau
-00022ab0: 6c74 2069 6620 6973 696e 7374 616e 6365  lt if isinstance
-00022ac0: 2866 6e2e 7369 676e 6174 7572 652e 696e  (fn.signature.in
-00022ad0: 7075 7473 5b61 7267 5d2c 2054 656e 736f  puts[arg], Tenso
-00022ae0: 7253 7065 6329 2065 6c73 6520 4e6f 6e65  rSpec) else None
-00022af0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022b00: 2020 6973 5f69 6e70 7574 203d 2061 7267    is_input = arg
-00022b10: 2e6c 6f77 6572 2829 2069 6e20 5b27 7827  .lower() in ['x'
-00022b20: 2c20 2769 6e70 7574 275d 0d0a 2020 2020  , 'input']..    
-00022b30: 2020 2020 2020 2020 2020 2020 6973 5f6f              is_o
-00022b40: 7574 7075 7420 3d20 6172 672e 6c6f 7765  utput = arg.lowe
-00022b50: 7228 2920 696e 205b 2779 272c 2027 6f75  r() in ['y', 'ou
-00022b60: 7470 7574 272c 2027 795f 7072 6564 275d  tput', 'y_pred']
-00022b70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022b80: 2020 6966 2061 7267 2069 6e20 6461 7461    if arg in data
-00022b90: 5f66 6565 6420 616e 6420 6461 7461 5f66  _feed and data_f
-00022ba0: 6565 645b 6172 675d 2069 6e20 6461 7461  eed[arg] in data
-00022bb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00022bc0: 2020 2020 2020 2061 7267 5f6d 6170 5b61         arg_map[a
-00022bd0: 7267 5d20 3d20 746f 5f74 656e 736f 7228  rg] = to_tensor(
-00022be0: 6461 7461 5b64 6174 615f 6665 6564 5b61  data[data_feed[a
-00022bf0: 7267 5d5d 2c20 6465 7669 6365 3d67 6574  rg]], device=get
-00022c00: 5f64 6576 6963 6528 2929 0d0a 2020 2020  _device())..    
-00022c10: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00022c20: 2061 7267 2069 6e20 6461 7461 3a0d 0a20   arg in data:.. 
-00022c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c40: 2020 2061 7267 5f6d 6170 5b61 7267 5d20     arg_map[arg] 
-00022c50: 3d20 746f 5f74 656e 736f 7228 6461 7461  = to_tensor(data
-00022c60: 5b61 7267 5d2c 2064 6576 6963 653d 6765  [arg], device=ge
-00022c70: 745f 6465 7669 6365 2829 290d 0a20 2020  t_device())..   
-00022c80: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00022c90: 6620 6973 5f69 6e70 7574 2061 6e64 2027  f is_input and '
-00022ca0: 696e 7075 7427 2069 6e20 6461 7461 5f66  input' in data_f
-00022cb0: 6565 6420 616e 6420 6461 7461 5f66 6565  eed and data_fee
-00022cc0: 645b 2769 6e70 7574 275d 2069 6e20 6461  d['input'] in da
-00022cd0: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
-00022ce0: 2020 2020 2020 2020 2061 7267 5f6d 6170           arg_map
-00022cf0: 5b61 7267 5d20 3d20 746f 5f74 656e 736f  [arg] = to_tenso
-00022d00: 7228 6461 7461 5b64 6174 615f 6665 6564  r(data[data_feed
-00022d10: 5b27 696e 7075 7427 5d5d 2c20 6465 7669  ['input']], devi
-00022d20: 6365 3d67 6574 5f64 6576 6963 6528 2929  ce=get_device())
-00022d30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022d40: 2020 656c 6966 2069 735f 6f75 7470 7574    elif is_output
-00022d50: 2061 6e64 2027 6f75 7470 7574 2720 696e   and 'output' in
-00022d60: 2064 6174 615f 6665 6564 2061 6e64 2064   data_feed and d
-00022d70: 6174 615f 6665 6564 5b27 6f75 7470 7574  ata_feed['output
-00022d80: 275d 2069 6e20 6461 7461 3a0d 0a20 2020  '] in data:..   
-00022d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022da0: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
-00022db0: 746f 5f74 656e 736f 7228 6461 7461 5b64  to_tensor(data[d
-00022dc0: 6174 615f 6665 6564 5b27 6f75 7470 7574  ata_feed['output
-00022dd0: 275d 5d2c 2064 6576 6963 653d 6765 745f  ']], device=get_
-00022de0: 6465 7669 6365 2829 290d 0a20 2020 2020  device())..     
-00022df0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00022e00: 6973 5f6f 7074 696f 6e61 6c3a 0d0a 2020  is_optional:..  
-00022e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e20: 2020 6172 675f 6d61 705b 6172 675d 203d    arg_map[arg] =
-00022e30: 2064 6566 6175 6c74 0d0a 0d0a 2020 2020   default....    
-00022e40: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00022e50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00022e60: 2020 2020 2020 2061 7267 5f6d 6170 2e70         arg_map.p
-00022e70: 6f70 2861 7267 290d 0a20 2020 2020 2020  op(arg)..       
-00022e80: 2020 2020 2069 6620 6374 782e 616d 705f       if ctx.amp_
-00022e90: 6176 6169 6c61 626c 6520 3d3d 2054 7275  available == Tru
-00022ea0: 6520 616e 6420 6973 5f61 7574 6f63 6173  e and is_autocas
-00022eb0: 745f 656e 6162 6c65 6420 3d3d 2054 7275  t_enabled == Tru
-00022ec0: 6520 616e 6420 6765 745f 6465 7669 6365  e and get_device
-00022ed0: 2829 203d 3d20 2763 7564 6127 3a0d 0a20  () == 'cuda':.. 
-00022ee0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00022ef0: 206e 6f74 2073 7570 706f 7274 2079 6574   not support yet
-00022f00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022f10: 2020 6f75 7420 3d20 666e 282a 6172 675f    out = fn(*arg_
-00022f20: 6d61 702e 7661 6c75 655f 6c69 7374 290d  map.value_list).
-00022f30: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00022f40: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00022f50: 2020 2020 6f75 7420 3d20 666e 282a 6172      out = fn(*ar
-00022f60: 675f 6d61 702e 7661 6c75 655f 6c69 7374  g_map.value_list
-00022f70: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00022f80: 6574 7572 6e20 6f75 740d 0a20 2020 2020  eturn out..     
-00022f90: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00022fa0: 2020 2020 2020 7072 696e 7428 2775 6e63        print('unc
-00022fb0: 6f6d 706c 6574 6520 6172 675f 6d61 7027  omplete arg_map'
-00022fc0: 2c20 6172 675f 6d61 702e 6b65 795f 6c69  , arg_map.key_li
-00022fd0: 7374 290d 0a0d 0a0d 0a64 6566 2066 6f72  st)......def for
-00022fe0: 6365 5f64 6574 6572 6d69 6e69 7374 6963  ce_deterministic
-00022ff0: 2873 6565 6429 3a0d 0a20 2020 2022 2222  (seed):..    """
-00023000: 2046 6f72 6365 206d 6f73 7420 6f66 2074   Force most of t
-00023010: 6865 2063 6f6d 7075 7461 7469 6f6e 206e  he computation n
-00023020: 6f64 6573 2074 6f20 7275 6e20 6465 7465  odes to run dete
-00023030: 726d 696e 6973 7469 6361 6c6c 792e 0d0a  rministically...
-00023040: 0d0a 2020 2020 4172 6773 3a0d 0a20 2020  ..    Args:..   
-00023050: 2020 2020 2073 6565 6420 2869 6e74 293a       seed (int):
-00023060: 2073 6574 2074 6865 2072 616e 646f 6d20   set the random 
-00023070: 7365 6564 2066 6f72 2061 6c6c 2072 616e  seed for all ran
-00023080: 646f 6d20 6f70 7320 696e 2074 6865 2067  dom ops in the g
-00023090: 7261 7068 2061 6e64 2072 6561 6465 7273  raph and readers
-000230a0: 2e0d 0a0d 0a20 2020 2022 2222 0d0a 0d0a  .....    """....
-000230b0: 2020 2020 7365 745f 7365 6564 2873 6565      set_seed(see
-000230c0: 6429 0d0a 2020 2020 6f73 2e65 6e76 6972  d)..    os.envir
-000230d0: 6f6e 5b27 5446 5f43 5544 4e4e 5f44 4554  on['TF_CUDNN_DET
-000230e0: 4552 4d49 4e49 5354 4943 275d 203d 2054  ERMINISTIC'] = T
-000230f0: 7275 650d 0a20 2020 206f 732e 656e 7669  rue..    os.envi
-00023100: 726f 6e5b 2754 465f 4355 444e 4e5f 5553  ron['TF_CUDNN_US
-00023110: 455f 4155 544f 5455 4e45 275d 203d 2046  E_AUTOTUNE'] = F
-00023120: 616c 7365 0d0a 2020 2020 7466 2e63 6f6e  alse..    tf.con
-00023130: 6669 672e 7468 7265 6164 696e 672e 7365  fig.threading.se
-00023140: 745f 696e 7472 615f 6f70 5f70 6172 616c  t_intra_op_paral
-00023150: 6c65 6c69 736d 5f74 6872 6561 6473 2831  lelism_threads(1
-00023160: 290d 0a20 2020 2074 662e 636f 6e66 6967  )..    tf.config
-00023170: 2e74 6872 6561 6469 6e67 2e73 6574 5f69  .threading.set_i
-00023180: 6e74 6572 5f6f 705f 7061 7261 6c6c 656c  nter_op_parallel
-00023190: 6973 6d5f 7468 7265 6164 7328 3129 0d0a  ism_threads(1)..
-000231a0: 0d0a 0d0a 6465 6620 6669 785f 6c61 7965  ....def fix_laye
-000231b0: 7228 6c61 7965 723a 204c 6179 6572 293a  r(layer: Layer):
-000231c0: 0d0a 2020 2020 2222 2266 6978 2065 7869  ..    """fix exi
-000231d0: 7374 696e 6720 6f75 742d 6f66 2d64 6174  sting out-of-dat
-000231e0: 6520 6d6f 6465 6c20 636f 6d70 6174 6962  e model compatib
-000231f0: 696c 6974 790d 0a0d 0a20 2020 2041 7267  ility....    Arg
-00023200: 733a 0d0a 2020 2020 2020 2020 6c61 7965  s:..        laye
-00023210: 7220 2874 7269 6465 6e74 204c 6179 6572  r (trident Layer
-00023220: 293a 0d0a 0d0a 2020 2020 5265 7475 726e  ):....    Return
-00023230: 733a 2066 6978 6564 206c 6179 6572 0d0a  s: fixed layer..
-00023240: 0d0a 2020 2020 2222 220d 0a20 2020 2069  ..    """..    i
-00023250: 6620 6e6f 7420 6861 7361 7474 7228 6c61  f not hasattr(la
-00023260: 7965 722c 2027 6973 5f72 6f6f 7427 293a  yer, 'is_root'):
-00023270: 0d0a 2020 2020 2020 2020 6c61 7965 722e  ..        layer.
-00023280: 6973 5f72 6f6f 7420 3d20 5472 7565 0d0a  is_root = True..
-00023290: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-000232a0: 7472 286c 6179 6572 2c20 275f 6465 7669  tr(layer, '_devi
-000232b0: 6365 2729 3a0d 0a20 2020 2020 2020 206c  ce'):..        l
-000232c0: 6179 6572 2e5f 6465 7669 6365 203d 2067  ayer._device = g
-000232d0: 6574 5f64 6576 6963 6528 290d 0a0d 0a20  et_device().... 
-000232e0: 2020 2064 6566 2067 6574 5f72 6f6f 7428     def get_root(
-000232f0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00023300: 6966 206e 6f74 2068 6173 6174 7472 2873  if not hasattr(s
-00023310: 656c 662c 2027 5f6e 6f64 6573 2729 206f  elf, '_nodes') o
-00023320: 7220 7365 6c66 2e5f 6e6f 6465 7320 6973  r self._nodes is
-00023330: 204e 6f6e 6520 6f72 206c 656e 2873 656c   None or len(sel
-00023340: 662e 5f6e 6f64 6573 2920 3c20 323a 0d0a  f._nodes) < 2:..
-00023350: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00023360: 726e 2073 656c 660d 0a20 2020 2020 2020  rn self..       
-00023370: 2069 6620 6861 7361 7474 7228 6c69 7374   if hasattr(list
-00023380: 2873 656c 662e 5f6e 6f64 6573 2e76 616c  (self._nodes.val
-00023390: 7565 7328 2929 5b30 5d2c 2027 6973 5f72  ues())[0], 'is_r
-000233a0: 6f6f 7427 2920 616e 6420 6c69 7374 2873  oot') and list(s
-000233b0: 656c 662e 5f6e 6f64 6573 2e76 616c 7565  elf._nodes.value
-000233c0: 7328 2929 5b30 5d2e 6973 5f72 6f6f 7420  s())[0].is_root 
-000233d0: 3d3d 2054 7275 653a 0d0a 2020 2020 2020  == True:..      
-000233e0: 2020 2020 2020 7265 7475 726e 206c 6973        return lis
-000233f0: 7428 7365 6c66 2e5f 6e6f 6465 732e 7661  t(self._nodes.va
-00023400: 6c75 6573 2829 295b 305d 0d0a 2020 2020  lues())[0]..    
-00023410: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00023420: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
-00023430: 206e 6f64 6520 696e 2073 656c 662e 5f6e   node in self._n
-00023440: 6f64 6573 2e69 7465 6d73 2829 3a0d 0a20  odes.items():.. 
-00023450: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023460: 6620 6861 7361 7474 7228 6e6f 6465 2c20  f hasattr(node, 
-00023470: 2764 6566 6175 6c74 5f6e 616d 6527 2920  'default_name') 
-00023480: 616e 6420 6e6f 6465 2e64 6566 6175 6c74  and node.default
-00023490: 5f6e 616d 6520 3d3d 2022 7365 7175 656e  _name == "sequen
-000234a0: 7469 616c 5f31 223a 0d0a 2020 2020 2020  tial_1":..      
-000234b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000234c0: 7475 726e 206e 6f64 650d 0a20 2020 2020  turn node..     
-000234d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000234e0: 6c66 0d0a 0d0a 2020 2020 6c61 7965 722e  lf....    layer.
-000234f0: 746f 2867 6574 5f64 6576 6963 6528 2929  to(get_device())
-00023500: 0d0a 2020 2020 6966 206e 6f74 2068 6173  ..    if not has
-00023510: 6174 7472 286c 6179 6572 2c20 275f 6e6f  attr(layer, '_no
-00023520: 6465 7327 293a 0d0a 2020 2020 2020 2020  des'):..        
-00023530: 6c61 7965 722e 5f6e 6f64 6573 203d 204f  layer._nodes = O
-00023540: 7264 6572 6564 4469 6374 2829 0d0a 0d0a  rderedDict()....
-00023550: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-00023560: 7472 286c 6179 6572 2c20 275f 7569 645f  tr(layer, '_uid_
-00023570: 7072 6566 6978 7327 293a 0d0a 2020 2020  prefixs'):..    
-00023580: 2020 2020 6c61 7965 722e 5f75 6964 5f70      layer._uid_p
-00023590: 7265 6669 7873 203d 207b 7d0d 0a20 2020  refixs = {}..   
-000235a0: 2072 6573 6574 5f6e 616d 6528 6c61 7965   reset_name(laye
-000235b0: 722c 206c 6179 6572 2e5f 7569 645f 7072  r, layer._uid_pr
-000235c0: 6566 6978 7329 0d0a 0d0a 2020 2020 6966  efixs)....    if
-000235d0: 2027 7373 6427 2069 6e20 6c61 7965 722e   'ssd' in layer.
-000235e0: 5f5f 636c 6173 735f 5f2e 5f5f 6261 7365  __class__.__base
-000235f0: 5f5f 2e5f 5f6e 616d 655f 5f2e 6c6f 7765  __.__name__.lowe
-00023600: 7228 2920 6f72 2027 796f 6c6f 2720 696e  r() or 'yolo' in
-00023610: 206c 6179 6572 2e5f 5f63 6c61 7373 5f5f   layer.__class__
-00023620: 2e5f 5f62 6173 655f 5f2e 5f5f 6e61 6d65  .__base__.__name
-00023630: 5f5f 2e6c 6f77 6572 2829 3a0d 0a20 2020  __.lower():..   
-00023640: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00023650: 6c61 7965 722c 2027 6e6d 735f 7468 7265  layer, 'nms_thre
-00023660: 7368 6f6c 6427 293a 0d0a 2020 2020 2020  shold'):..      
-00023670: 2020 2020 2020 6465 6c61 7474 7228 6c61        delattr(la
-00023680: 7965 722c 2027 6e6d 735f 7468 7265 7368  yer, 'nms_thresh
-00023690: 6f6c 6427 290d 0a20 2020 2020 2020 2069  old')..        i
-000236a0: 6620 6861 7361 7474 7228 6c61 7965 722c  f hasattr(layer,
-000236b0: 2027 6465 7465 6374 696f 6e5f 7468 7265   'detection_thre
-000236c0: 7368 6f6c 6427 293a 0d0a 2020 2020 2020  shold'):..      
-000236d0: 2020 2020 2020 6465 6c61 7474 7228 6c61        delattr(la
-000236e0: 7965 722c 2027 6465 7465 6374 696f 6e5f  yer, 'detection_
-000236f0: 7468 7265 7368 6f6c 6427 290d 0a0d 0a20  threshold').... 
-00023700: 2020 2069 6620 6c61 7965 722e 5f69 6e70     if layer._inp
-00023710: 7574 5f73 6861 7065 2069 7320 6e6f 7420  ut_shape is not 
-00023720: 4e6f 6e65 2061 6e64 2069 7369 6e73 7461  None and isinsta
-00023730: 6e63 6528 6c61 7965 722e 5f69 6e70 7574  nce(layer._input
-00023740: 5f73 6861 7065 2c20 7475 706c 6529 2061  _shape, tuple) a
-00023750: 6e64 2061 6c6c 280d 0a20 2020 2020 2020  nd all(..       
-00023760: 2020 2020 205b 6973 696e 7374 616e 6365       [isinstance
-00023770: 2864 2c20 6e75 6d62 6572 732e 496e 7465  (d, numbers.Inte
-00023780: 6772 616c 2920 666f 7220 6420 696e 206c  gral) for d in l
-00023790: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
-000237a0: 655d 293a 0d0a 2020 2020 2020 2020 6469  e]):..        di
-000237b0: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
-000237c0: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
-000237d0: 6170 655d 0d0a 2020 2020 2020 2020 6469  ape]..        di
-000237e0: 6d73 2e69 6e73 6572 7428 302c 204e 6f6e  ms.insert(0, Non
-000237f0: 6529 0d0a 2020 2020 2020 2020 6c61 7965  e)..        laye
-00023800: 722e 5f69 6e70 7574 5f73 6861 7065 203d  r._input_shape =
-00023810: 2054 656e 736f 7253 6861 7065 2864 696d   TensorShape(dim
-00023820: 7329 0d0a 2020 2020 656c 6966 206c 6179  s)..    elif lay
-00023830: 6572 2e5f 696e 7075 745f 7368 6170 6520  er._input_shape 
-00023840: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00023850: 6973 696e 7374 616e 6365 286c 6179 6572  isinstance(layer
-00023860: 2e5f 696e 7075 745f 7368 6170 652c 2074  ._input_shape, t
-00023870: 7570 6c65 293a 0d0a 2020 2020 2020 2020  uple):..        
-00023880: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
-00023890: 7065 203d 2074 7570 6c65 285b 5465 6e73  pe = tuple([Tens
-000238a0: 6f72 5368 6170 6528 746f 5f6e 756d 7079  orShape(to_numpy
-000238b0: 2869 7465 6d29 2920 666f 7220 6974 656d  (item)) for item
-000238c0: 2069 6e20 5465 6e73 6f72 5368 6170 6528   in TensorShape(
-000238d0: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
-000238e0: 7065 295d 290d 0a20 2020 2065 6c69 6620  pe)])..    elif 
-000238f0: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
-00023900: 7065 2069 7320 6e6f 7420 4e6f 6e65 2061  pe is not None a
-00023910: 6e64 2069 735f 7465 6e73 6f72 286c 6179  nd is_tensor(lay
-00023920: 6572 2e5f 696e 7075 745f 7368 6170 6529  er._input_shape)
-00023930: 3a0d 0a20 2020 2020 2020 2064 696d 7320  :..        dims 
-00023940: 3d20 5b64 2e69 7465 6d28 2920 666f 7220  = [d.item() for 
-00023950: 6420 696e 206c 6179 6572 2e5f 696e 7075  d in layer._inpu
-00023960: 745f 7368 6170 655d 0d0a 2020 2020 2020  t_shape]..      
-00023970: 2020 6469 6d73 2e69 6e73 6572 7428 302c    dims.insert(0,
-00023980: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
-00023990: 6275 6666 6572 7320 3d20 6c61 7965 722e  buffers = layer.
-000239a0: 5f5f 6469 6374 5f5f 2e67 6574 2827 5f62  __dict__.get('_b
-000239b0: 7566 6665 7273 2729 0d0a 2020 2020 2020  uffers')..      
-000239c0: 2020 6966 2027 5f69 6e70 7574 5f73 6861    if '_input_sha
-000239d0: 7065 2720 696e 2062 7566 6665 7273 3a0d  pe' in buffers:.
-000239e0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-000239f0: 2062 7566 6665 7273 5b27 5f69 6e70 7574   buffers['_input
-00023a00: 5f73 6861 7065 275d 0d0a 2020 2020 2020  _shape']..      
-00023a10: 2020 6f62 6a65 6374 2e5f 5f73 6574 6174    object.__setat
-00023a20: 7472 5f5f 286c 6179 6572 2c20 275f 696e  tr__(layer, '_in
-00023a30: 7075 745f 7368 6170 6527 2c20 5465 6e73  put_shape', Tens
-00023a40: 6f72 5368 6170 6528 6469 6d73 2929 0d0a  orShape(dims))..
-00023a50: 2020 2020 656c 6966 206c 6179 6572 2e5f      elif layer._
-00023a60: 696e 7075 745f 7368 6170 6520 6973 206e  input_shape is n
-00023a70: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
-00023a80: 6973 696e 7374 616e 6365 286c 6179 6572  isinstance(layer
-00023a90: 2e5f 696e 7075 745f 7368 6170 652c 2054  ._input_shape, T
-00023aa0: 656e 736f 7253 6861 7065 293a 0d0a 2020  ensorShape):..  
-00023ab0: 2020 2020 2020 6c61 7965 722e 5f69 6e70        layer._inp
-00023ac0: 7574 5f73 6861 7065 203d 2054 656e 736f  ut_shape = Tenso
-00023ad0: 7253 6861 7065 2874 6f5f 6e75 6d70 7928  rShape(to_numpy(
-00023ae0: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
-00023af0: 7065 2929 0d0a 2020 2020 656c 6966 206c  pe))..    elif l
-00023b00: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
-00023b10: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
-00023b20: 6420 6973 696e 7374 616e 6365 286c 6179  d isinstance(lay
-00023b30: 6572 2e5f 696e 7075 745f 7368 6170 652c  er._input_shape,
-00023b40: 2054 656e 736f 7253 6861 7065 2920 616e   TensorShape) an
-00023b50: 6420 6973 5f74 656e 736f 7228 0d0a 2020  d is_tensor(..  
-00023b60: 2020 2020 2020 2020 2020 6c61 7965 722e            layer.
-00023b70: 5f69 6e70 7574 5f73 6861 7065 2e64 696d  _input_shape.dim
-00023b80: 735b 305d 293a 0d0a 2020 2020 2020 2020  s[0]):..        
-00023b90: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
-00023ba0: 7065 203d 2054 656e 736f 7253 6861 7065  pe = TensorShape
-00023bb0: 285b 642e 6974 656d 2829 2066 6f72 2064  ([d.item() for d
-00023bc0: 2069 6e20 6c61 7965 722e 5f69 6e70 7574   in layer._input
-00023bd0: 5f73 6861 7065 2e64 696d 735d 290d 0a0d  _shape.dims])...
-00023be0: 0a20 2020 2069 6620 6c61 7965 722e 5f6f  .    if layer._o
-00023bf0: 7574 7075 745f 7368 6170 6520 6973 206e  utput_shape is n
-00023c00: 6f74 204e 6f6e 6520 616e 6420 6973 696e  ot None and isin
-00023c10: 7374 616e 6365 286c 6179 6572 2e5f 6f75  stance(layer._ou
-00023c20: 7470 7574 5f73 6861 7065 2c20 7475 706c  tput_shape, tupl
-00023c30: 6529 2061 6e64 2061 6c6c 280d 0a20 2020  e) and all(..   
-00023c40: 2020 2020 2020 2020 205b 6973 696e 7374           [isinst
-00023c50: 616e 6365 2864 2c20 6e75 6d62 6572 732e  ance(d, numbers.
-00023c60: 496e 7465 6772 616c 2920 666f 7220 6420  Integral) for d 
-00023c70: 696e 206c 6179 6572 2e5f 6f75 7470 7574  in layer._output
-00023c80: 5f73 6861 7065 5d29 3a0d 0a20 2020 2020  _shape]):..     
-00023c90: 2020 2064 696d 7320 3d20 5b64 2066 6f72     dims = [d for
-00023ca0: 2064 2069 6e20 6c61 7965 722e 5f69 6e70   d in layer._inp
-00023cb0: 7574 5f73 6861 7065 5d0d 0a20 2020 2020  ut_shape]..     
-00023cc0: 2020 2064 696d 732e 696e 7365 7274 2830     dims.insert(0
-00023cd0: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
-00023ce0: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
-00023cf0: 6170 6520 3d20 5465 6e73 6f72 5368 6170  ape = TensorShap
-00023d00: 6528 6469 6d73 290d 0a20 2020 2065 6c69  e(dims)..    eli
-00023d10: 6620 6c61 7965 722e 5f6f 7574 7075 745f  f layer._output_
-00023d20: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
-00023d30: 6520 616e 6420 6973 696e 7374 616e 6365  e and isinstance
-00023d40: 286c 6179 6572 2e5f 6f75 7470 7574 5f73  (layer._output_s
-00023d50: 6861 7065 2c20 7475 706c 6529 3a0d 0a20  hape, tuple):.. 
-00023d60: 2020 2020 2020 206c 6179 6572 2e5f 6f75         layer._ou
-00023d70: 7470 7574 5f73 6861 7065 203d 2074 7570  tput_shape = tup
-00023d80: 6c65 285b 5465 6e73 6f72 5368 6170 6528  le([TensorShape(
-00023d90: 746f 5f6e 756d 7079 2869 7465 6d29 2920  to_numpy(item)) 
-00023da0: 666f 7220 6974 656d 2069 6e20 5465 6e73  for item in Tens
-00023db0: 6f72 5368 6170 6528 6c61 7965 722e 5f6f  orShape(layer._o
-00023dc0: 7574 7075 745f 7368 6170 6529 5d29 0d0a  utput_shape)])..
-00023dd0: 2020 2020 656c 6966 206c 6179 6572 2e5f      elif layer._
-00023de0: 6f75 7470 7574 5f73 6861 7065 2069 7320  output_shape is 
-00023df0: 6e6f 7420 4e6f 6e65 2061 6e64 2069 735f  not None and is_
-00023e00: 7465 6e73 6f72 286c 6179 6572 2e5f 6f75  tensor(layer._ou
-00023e10: 7470 7574 5f73 6861 7065 293a 0d0a 2020  tput_shape):..  
-00023e20: 2020 2020 2020 6469 6d73 203d 205b 642e        dims = [d.
-00023e30: 6974 656d 2829 2066 6f72 2064 2069 6e20  item() for d in 
-00023e40: 6c61 7965 722e 5f6f 7574 7075 745f 7368  layer._output_sh
-00023e50: 6170 655d 0d0a 2020 2020 2020 2020 6469  ape]..        di
-00023e60: 6d73 2e69 6e73 6572 7428 302c 204e 6f6e  ms.insert(0, Non
-00023e70: 6529 0d0a 2020 2020 2020 2020 6275 6666  e)..        buff
-00023e80: 6572 7320 3d20 6c61 7965 722e 5f5f 6469  ers = layer.__di
-00023e90: 6374 5f5f 2e67 6574 2827 5f62 7566 6665  ct__.get('_buffe
-00023ea0: 7273 2729 0d0a 2020 2020 2020 2020 6966  rs')..        if
-00023eb0: 2027 5f69 6e70 7574 5f73 6861 7065 2720   '_input_shape' 
-00023ec0: 696e 2062 7566 6665 7273 3a0d 0a20 2020  in buffers:..   
-00023ed0: 2020 2020 2020 2020 2064 656c 2062 7566           del buf
-00023ee0: 6665 7273 5b27 5f6f 7574 7075 745f 7368  fers['_output_sh
-00023ef0: 6170 6527 5d0d 0a20 2020 2020 2020 206f  ape']..        o
-00023f00: 626a 6563 742e 5f5f 7365 7461 7474 725f  bject.__setattr_
-00023f10: 5f28 6c61 7965 722c 2027 5f6f 7574 7075  _(layer, '_outpu
-00023f20: 745f 7368 6170 6527 2c20 5465 6e73 6f72  t_shape', Tensor
-00023f30: 5368 6170 6528 6469 6d73 2929 0d0a 2020  Shape(dims))..  
-00023f40: 2020 656c 6966 206c 6179 6572 2e5f 6f75    elif layer._ou
-00023f50: 7470 7574 5f73 6861 7065 2069 7320 6e6f  tput_shape is no
-00023f60: 7420 4e6f 6e65 2061 6e64 206e 6f74 2069  t None and not i
-00023f70: 7369 6e73 7461 6e63 6528 6c61 7965 722e  sinstance(layer.
-00023f80: 5f6f 7574 7075 745f 7368 6170 652c 2054  _output_shape, T
-00023f90: 656e 736f 7253 6861 7065 293a 0d0a 2020  ensorShape):..  
-00023fa0: 2020 2020 2020 6c61 7965 722e 5f6f 7574        layer._out
-00023fb0: 7075 745f 7368 6170 6520 3d20 5465 6e73  put_shape = Tens
-00023fc0: 6f72 5368 6170 6528 6c61 7965 722e 5f6f  orShape(layer._o
-00023fd0: 7574 7075 745f 7368 6170 6529 0d0a 2020  utput_shape)..  
-00023fe0: 2020 656c 6966 206c 6179 6572 2e5f 6f75    elif layer._ou
-00023ff0: 7470 7574 5f73 6861 7065 2069 7320 6e6f  tput_shape is no
-00024000: 7420 4e6f 6e65 2061 6e64 2069 7369 6e73  t None and isins
-00024010: 7461 6e63 6528 6c61 7965 722e 5f6f 7574  tance(layer._out
-00024020: 7075 745f 7368 6170 652c 2054 656e 736f  put_shape, Tenso
-00024030: 7253 6861 7065 2920 616e 6420 6973 696e  rShape) and isin
-00024040: 7374 616e 6365 280d 0a20 2020 2020 2020  stance(..       
-00024050: 2020 2020 206c 6179 6572 2e5f 6f75 7470       layer._outp
-00024060: 7574 5f73 6861 7065 2e64 696d 735b 305d  ut_shape.dims[0]
-00024070: 2c20 7466 2e54 656e 736f 7253 6861 7065  , tf.TensorShape
-00024080: 2920 616e 6420 6c65 6e28 6c61 7965 722e  ) and len(layer.
-00024090: 5f6f 7574 7075 745f 7368 6170 652e 6469  _output_shape.di
-000240a0: 6d73 5b30 5d29 203d 3d20 313a 0d0a 2020  ms[0]) == 1:..  
-000240b0: 2020 2020 2020 6c61 7965 722e 5f6f 7574        layer._out
-000240c0: 7075 745f 7368 6170 6520 3d20 5465 6e73  put_shape = Tens
-000240d0: 6f72 5368 6170 6528 5b4e 6f6e 6520 6966  orShape([None if
-000240e0: 2064 2069 7320 4e6f 6e65 2065 6c73 6520   d is None else 
-000240f0: 645b 305d 2066 6f72 2064 2069 6e20 6c61  d[0] for d in la
-00024100: 7965 722e 5f6f 7574 7075 745f 7368 6170  yer._output_shap
-00024110: 652e 6469 6d73 5d29 0d0a 2020 2020 656c  e.dims])..    el
-00024120: 6966 206c 6179 6572 2e5f 6f75 7470 7574  if layer._output
-00024130: 5f73 6861 7065 2069 7320 6e6f 7420 4e6f  _shape is not No
-00024140: 6e65 2061 6e64 2069 7369 6e73 7461 6e63  ne and isinstanc
-00024150: 6528 6c61 7965 722e 5f6f 7574 7075 745f  e(layer._output_
-00024160: 7368 6170 652c 2054 656e 736f 7253 6861  shape, TensorSha
-00024170: 7065 2920 616e 6420 6973 696e 7374 616e  pe) and isinstan
-00024180: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
-00024190: 206c 6179 6572 2e5f 6f75 7470 7574 5f73   layer._output_s
-000241a0: 6861 7065 2e64 696d 735b 305d 2c20 7466  hape.dims[0], tf
-000241b0: 2e54 656e 736f 7253 6861 7065 293a 0d0a  .TensorShape):..
-000241c0: 2020 2020 2020 2020 6c61 7965 722e 5f6f          layer._o
-000241d0: 7574 7075 745f 7368 6170 6520 3d20 7475  utput_shape = tu
-000241e0: 706c 6528 5b54 656e 736f 7253 6861 7065  ple([TensorShape
-000241f0: 2874 6f5f 6e75 6d70 7928 6429 2920 666f  (to_numpy(d)) fo
-00024200: 7220 6420 696e 206c 6179 6572 2e5f 6f75  r d in layer._ou
-00024210: 7470 7574 5f73 6861 7065 2e64 696d 735d  tput_shape.dims]
-00024220: 290d 0a0d 0a20 2020 2069 6620 6e6f 7420  )....    if not 
-00024230: 6861 7361 7474 7228 6c61 7965 722c 2027  hasattr(layer, '
-00024240: 6765 745f 726f 6f74 2729 3a0d 0a20 2020  get_root'):..   
-00024250: 2020 2020 2073 6574 6174 7472 286c 6179       setattr(lay
-00024260: 6572 2c20 2767 6574 5f72 6f6f 7427 2c20  er, 'get_root', 
-00024270: 4d65 7468 6f64 5479 7065 2867 6574 5f72  MethodType(get_r
-00024280: 6f6f 742c 206c 6179 6572 2929 0d0a 0d0a  oot, layer))....
-00024290: 2020 2020 666f 7220 6d6f 6475 6c65 2069      for module i
-000242a0: 6e20 6c61 7965 722e 6d6f 6475 6c65 7328  n layer.modules(
-000242b0: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
-000242c0: 6f74 2068 6173 6174 7472 286d 6f64 756c  ot hasattr(modul
-000242d0: 652c 2027 5f5f 7369 676e 6174 7572 655f  e, '__signature_
-000242e0: 5f27 293a 0d0a 2020 2020 2020 2020 2020  _'):..          
-000242f0: 2020 6d6f 6475 6c65 2e5f 5f73 6967 6e61    module.__signa
-00024300: 7475 7265 5f5f 203d 2069 6e73 7065 6374  ture__ = inspect
-00024310: 2e73 6967 6e61 7475 7265 286d 6f64 756c  .signature(modul
-00024320: 652e 666f 7277 6172 6429 0d0a 2020 2020  e.forward)..    
-00024330: 2020 2020 636c 6173 735f 6e61 6d65 203d      class_name =
-00024340: 206d 6f64 756c 652e 5f5f 636c 6173 735f   module.__class_
-00024350: 5f2e 5f5f 6e61 6d65 5f5f 0d0a 2020 2020  _.__name__..    
-00024360: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-00024370: 7472 286c 6179 6572 2c20 2767 6574 5f72  tr(layer, 'get_r
-00024380: 6f6f 7427 293a 0d0a 2020 2020 2020 2020  oot'):..        
-00024390: 2020 2020 7365 7461 7474 7228 6c61 7965      setattr(laye
-000243a0: 722c 2027 6765 745f 726f 6f74 272c 204d  r, 'get_root', M
-000243b0: 6574 686f 6454 7970 6528 6765 745f 726f  ethodType(get_ro
-000243c0: 6f74 2c20 6c61 7965 7229 290d 0a0d 0a20  ot, layer)).... 
-000243d0: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-000243e0: 7361 7474 7228 6d6f 6475 6c65 2c20 275f  sattr(module, '_
-000243f0: 7374 6174 655f 6469 6374 5f70 7265 5f68  state_dict_pre_h
-00024400: 6f6f 6b73 2729 3a0d 0a20 2020 2020 2020  ooks'):..       
-00024410: 2020 2020 206f 626a 6563 742e 5f5f 7365       object.__se
-00024420: 7461 7474 725f 5f28 6d6f 6475 6c65 2c20  tattr__(module, 
-00024430: 275f 666f 7277 6172 645f 686f 6f6b 735f  '_forward_hooks_
-00024440: 7769 7468 5f6b 7761 7267 7327 2c20 4f72  with_kwargs', Or
-00024450: 6465 7265 6444 6963 7428 2929 0d0a 2020  deredDict())..  
-00024460: 2020 2020 2020 2020 2020 6f62 6a65 6374            object
-00024470: 2e5f 5f73 6574 6174 7472 5f5f 286d 6f64  .__setattr__(mod
-00024480: 756c 652c 2027 5f66 6f72 7761 7264 5f70  ule, '_forward_p
-00024490: 7265 5f68 6f6f 6b73 5f77 6974 685f 6b77  re_hooks_with_kw
-000244a0: 6172 6773 272c 204f 7264 6572 6564 4469  args', OrderedDi
-000244b0: 6374 2829 290d 0a20 2020 2020 2020 2020  ct())..         
-000244c0: 2020 206f 626a 6563 742e 5f5f 7365 7461     object.__seta
-000244d0: 7474 725f 5f28 6d6f 6475 6c65 2c20 275f  ttr__(module, '_
-000244e0: 7374 6174 655f 6469 6374 5f70 7265 5f68  state_dict_pre_h
-000244f0: 6f6f 6b73 272c 204f 7264 6572 6564 4469  ooks', OrderedDi
-00024500: 6374 2829 290d 0a0d 0a20 2020 2020 2020  ct())....       
-00024510: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00024520: 6d6f 6475 6c65 2c20 2775 7569 6427 293a  module, 'uuid'):
-00024530: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-00024540: 6475 6c65 2e75 7569 6420 3d20 7575 6964  dule.uuid = uuid
-00024550: 2e75 7569 6434 2829 2e6e 6f64 650d 0a20  .uuid4().node.. 
-00024560: 2020 2020 2020 2023 2063 6865 636b 2066         # check f
-00024570: 6f72 2072 6f6f 740d 0a20 2020 2020 2020  or root..       
-00024580: 2069 6620 6d6f 6475 6c65 2e75 7569 6420   if module.uuid 
-00024590: 3d3d 206c 6179 6572 2e75 7569 643a 0d0a  == layer.uuid:..
-000245a0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-000245b0: 6c65 2e69 735f 726f 6f74 203d 2054 7275  le.is_root = Tru
-000245c0: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
-000245d0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-000245e0: 6475 6c65 2e69 735f 726f 6f74 203d 2046  dule.is_root = F
-000245f0: 616c 7365 0d0a 2020 2020 2020 2020 6966  alse..        if
-00024600: 206e 6f74 2068 6173 6174 7472 286d 6f64   not hasattr(mod
-00024610: 756c 652c 2027 7265 6c61 7469 7665 5f6e  ule, 'relative_n
-00024620: 616d 6527 293a 0d0a 2020 2020 2020 2020  ame'):..        
-00024630: 2020 2020 6d6f 6475 6c65 2e72 656c 6174      module.relat
-00024640: 6976 655f 6e61 6d65 203d 2027 270d 0a20  ive_name = ''.. 
-00024650: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-00024660: 7361 7474 7228 6d6f 6475 6c65 2c20 275f  sattr(module, '_
-00024670: 7569 645f 7072 6566 6978 7327 293a 0d0a  uid_prefixs'):..
-00024680: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-00024690: 6c65 2e5f 7569 645f 7072 6566 6978 7320  le._uid_prefixs 
-000246a0: 3d20 6c61 7965 722e 6765 745f 726f 6f74  = layer.get_root
-000246b0: 2829 2e5f 7569 645f 7072 6566 6978 730d  ()._uid_prefixs.
-000246c0: 0a0d 0a20 2020 2020 2020 2069 6620 6e6f  ...        if no
-000246d0: 7420 6861 7361 7474 7228 6d6f 6475 6c65  t hasattr(module
-000246e0: 2c20 2764 6566 6175 6c74 5f6e 616d 6527  , 'default_name'
-000246f0: 2920 6f72 2028 6d6f 6475 6c65 2e64 6566  ) or (module.def
-00024700: 6175 6c74 5f6e 616d 6520 6973 204e 6f6e  ault_name is Non
-00024710: 6520 6f72 206c 656e 286d 6f64 756c 652e  e or len(module.
-00024720: 6465 6661 756c 745f 6e61 6d65 2920 3d3d  default_name) ==
-00024730: 2030 293a 0d0a 2020 2020 2020 2020 2020   0):..          
-00024740: 2020 6d6f 6475 6c65 5f70 7265 6669 7820    module_prefix 
-00024750: 3d20 6d6f 6475 6c65 2e5f 5f63 6c61 7373  = module.__class
-00024760: 5f5f 2e5f 5f6e 616d 655f 5f0d 0a20 2020  __.__name__..   
-00024770: 2020 2020 2020 2020 206d 6f64 756c 652e           module.
-00024780: 6465 6661 756c 745f 6e61 6d65 203d 2063  default_name = c
-00024790: 616d 656c 3273 6e61 6b65 286d 6f64 756c  amel2snake(modul
-000247a0: 655f 7072 6566 6978 2920 2b20 275f 2720  e_prefix) + '_' 
-000247b0: 2b20 7374 7228 6765 745f 676c 6f62 616c  + str(get_global
-000247c0: 5f75 6964 2863 616d 656c 3273 6e61 6b65  _uid(camel2snake
-000247d0: 286d 6f64 756c 655f 7072 6566 6978 2929  (module_prefix))
-000247e0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-000247f0: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
-00024800: 6c65 2c20 275f 6e61 6d65 2729 3a0d 0a20  le, '_name'):.. 
-00024810: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-00024820: 652e 5f6e 616d 6520 3d20 4e6f 6e65 0d0a  e._name = None..
-00024830: 2020 2020 2020 2020 7265 7365 745f 6e61          reset_na
-00024840: 6d65 286d 6f64 756c 652c 206c 6179 6572  me(module, layer
-00024850: 2e67 6574 5f72 6f6f 7428 292e 5f75 6964  .get_root()._uid
-00024860: 5f70 7265 6669 7873 290d 0a0d 0a20 2020  _prefixs)....   
-00024870: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
-00024880: 7474 7228 6d6f 6475 6c65 2c20 276e 616d  ttr(module, 'nam
-00024890: 6527 293a 0d0a 2020 2020 2020 2020 2020  e'):..          
-000248a0: 2020 6d6f 6475 6c65 2e6e 616d 6520 3d20    module.name = 
-000248b0: 6d6f 6475 6c65 2e5f 6e61 6d65 2069 6620  module._name if 
-000248c0: 6d6f 6475 6c65 2e5f 6e61 6d65 2069 7320  module._name is 
-000248d0: 6e6f 7420 4e6f 6e65 2061 6e64 206c 656e  not None and len
-000248e0: 286d 6f64 756c 652e 5f6e 616d 6529 203e  (module._name) >
-000248f0: 2030 2065 6c73 6520 6d6f 6475 6c65 2e72   0 else module.r
-00024900: 656c 6174 6976 655f 6e61 6d65 0d0a 0d0a  elative_name....
-00024910: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
-00024920: 6173 6174 7472 286d 6f64 756c 652c 2027  asattr(module, '
-00024930: 5f62 7569 6c74 2729 3a0d 0a20 2020 2020  _built'):..     
-00024940: 2020 2020 2020 2073 6574 6174 7472 286d         setattr(m
-00024950: 6f64 756c 652c 2027 6275 696c 7427 2c20  odule, 'built', 
-00024960: 5472 7565 290d 0a0d 0a20 2020 2020 2020  True)....       
-00024970: 2069 6620 6861 7361 7474 7228 6d6f 6475   if hasattr(modu
-00024980: 6c65 2c20 276b 6565 7064 696d 2729 3a0d  le, 'keepdim'):.
-00024990: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-000249a0: 7565 203d 2067 6574 6174 7472 286d 6f64  ue = getattr(mod
-000249b0: 756c 652c 2027 6b65 6570 6469 6d27 290d  ule, 'keepdim').
-000249c0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-000249d0: 6174 7472 286d 6f64 756c 652c 2027 6b65  attr(module, 'ke
-000249e0: 6570 6469 6d27 290d 0a20 2020 2020 2020  epdim')..       
-000249f0: 2020 2020 2073 6574 6174 7472 286d 6f64       setattr(mod
-00024a00: 756c 652c 2027 6b65 6570 6469 6d73 272c  ule, 'keepdims',
-00024a10: 2076 616c 7565 290d 0a0d 0a20 2020 2020   value)....     
-00024a20: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-00024a30: 7228 6d6f 6475 6c65 2c20 275f 6e6f 6e5f  r(module, '_non_
-00024a40: 7065 7273 6973 7465 6e74 5f62 7566 6665  persistent_buffe
-00024a50: 7273 5f73 6574 2729 3a0d 0a20 2020 2020  rs_set'):..     
-00024a60: 2020 2020 2020 206d 6f64 756c 652e 5f6e         module._n
-00024a70: 6f6e 5f70 6572 7369 7374 656e 745f 6275  on_persistent_bu
-00024a80: 6666 6572 735f 7365 7420 3d20 7365 7428  ffers_set = set(
-00024a90: 290d 0a0d 0a20 2020 2020 2020 2023 2066  )....        # f
-00024aa0: 6978 2066 6f72 2073 6861 7065 2064 6566  ix for shape def
-00024ab0: 696e 6974 696f 6e0d 0a20 2020 2020 2020  inition..       
-00024ac0: 2023 2069 6620 6e6f 7420 6973 696e 7374   # if not isinst
-00024ad0: 616e 6365 286d 6f64 756c 652e 5f69 6e70  ance(module._inp
-00024ae0: 7574 5f73 6861 7065 2c20 5465 6e73 6f72  ut_shape, Tensor
-00024af0: 5368 6170 6529 3a0d 0a20 2020 2020 2020  Shape):..       
-00024b00: 2023 2020 2020 206d 6f64 756c 652e 5f69   #     module._i
-00024b10: 6e70 7574 5f73 6861 7065 203d 2054 656e  nput_shape = Ten
-00024b20: 736f 7253 6861 7065 2874 6f5f 6e75 6d70  sorShape(to_nump
-00024b30: 7928 6d6f 6475 6c65 2e5f 696e 7075 745f  y(module._input_
-00024b40: 7368 6170 6529 290d 0a20 2020 2020 2020  shape))..       
-00024b50: 2023 0d0a 2020 2020 2020 2020 2320 6966   #..        # if
-00024b60: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00024b70: 6d6f 6475 6c65 2e5f 6f75 7470 7574 5f73  module._output_s
-00024b80: 6861 7065 2c20 5465 6e73 6f72 5368 6170  hape, TensorShap
-00024b90: 6529 3a0d 0a20 2020 2020 2020 2023 2020  e):..        #  
-00024ba0: 2020 206d 6f64 756c 652e 5f6f 7574 7075     module._outpu
-00024bb0: 745f 7368 6170 6520 3d20 5465 6e73 6f72  t_shape = Tensor
-00024bc0: 5368 6170 6528 746f 5f6e 756d 7079 286d  Shape(to_numpy(m
-00024bd0: 6f64 756c 652e 5f6f 7574 7075 745f 7368  odule._output_sh
-00024be0: 6170 6529 290d 0a0d 0a20 2020 2020 2020  ape))....       
-00024bf0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00024c00: 6d6f 6475 6c65 2c20 2762 6174 6368 5f69  module, 'batch_i
-00024c10: 6e64 6578 2729 3a0d 0a20 2020 2020 2020  ndex'):..       
-00024c20: 2020 2020 2073 6574 6174 7472 286d 6f64       setattr(mod
-00024c30: 756c 652c 2027 6261 7463 685f 696e 6465  ule, 'batch_inde
-00024c40: 7827 2c20 3029 0d0a 2020 2020 2020 2020  x', 0)..        
-00024c50: 6966 206e 6f74 2068 6173 6174 7472 286d  if not hasattr(m
-00024c60: 6f64 756c 652c 2027 6669 6c74 6572 5f69  odule, 'filter_i
-00024c70: 6e64 6578 2729 3a0d 0a20 2020 2020 2020  ndex'):..       
-00024c80: 2020 2020 2073 6574 6174 7472 286d 6f64       setattr(mod
-00024c90: 756c 652c 2027 6669 6c74 6572 5f69 6e64  ule, 'filter_ind
-00024ca0: 6578 272c 2031 290d 0a20 2020 2020 2020  ex', 1)..       
-00024cb0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00024cc0: 6d6f 6475 6c65 2c20 2769 6e5f 7365 7175  module, 'in_sequ
-00024cd0: 656e 6365 2729 3a0d 0a20 2020 2020 2020  ence'):..       
-00024ce0: 2020 2020 2073 6574 6174 7472 286d 6f64       setattr(mod
-00024cf0: 756c 652c 2027 696e 5f73 6571 7565 6e63  ule, 'in_sequenc
-00024d00: 6527 2c20 4661 6c73 6529 0d0a 0d0a 2020  e', False)....  
-00024d10: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-00024d20: 6174 7472 286d 6f64 756c 652c 2027 696e  attr(module, 'in
-00024d30: 5f73 6571 7565 6e63 6527 293a 0d0a 2020  _sequence'):..  
-00024d40: 2020 2020 2020 2020 2020 6966 2027 6c73            if 'ls
-00024d50: 746d 2720 696e 2063 6c61 7373 5f6e 616d  tm' in class_nam
-00024d60: 652e 6c6f 7765 7228 2920 6f72 2027 6772  e.lower() or 'gr
-00024d70: 7527 2069 6e20 636c 6173 735f 6e61 6d65  u' in class_name
-00024d80: 2e6c 6f77 6572 2829 206f 7220 2772 6e6e  .lower() or 'rnn
-00024d90: 2720 696e 2063 6c61 7373 5f6e 616d 652e  ' in class_name.
-00024da0: 6c6f 7765 7228 293a 0d0a 2020 2020 2020  lower():..      
-00024db0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-00024dc0: 2e69 6e5f 7365 7175 656e 6365 203d 2054  .in_sequence = T
-00024dd0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00024de0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00024df0: 2020 2020 2020 2020 6d6f 6475 6c65 2e69          module.i
-00024e00: 6e5f 7365 7175 656e 6365 203d 2046 616c  n_sequence = Fal
-00024e10: 7365 0d0a 0d0a 2020 2020 2020 2020 6966  se....        if
-00024e20: 2027 436f 6e76 2720 696e 2063 6c61 7373   'Conv' in class
-00024e30: 5f6e 616d 6520 616e 6420 2742 6c6f 636b  _name and 'Block
-00024e40: 2720 696e 2063 6c61 7373 5f6e 616d 653a  ' in class_name:
-00024e50: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00024e60: 206e 6f74 2068 6173 6174 7472 286d 6f64   not hasattr(mod
-00024e70: 756c 652c 2027 7365 7175 656e 6365 5f72  ule, 'sequence_r
-00024e80: 616e 6b27 293a 0d0a 2020 2020 2020 2020  ank'):..        
-00024e90: 2020 2020 2020 2020 6d6f 6475 6c65 2e73          module.s
-00024ea0: 6571 7565 6e63 655f 7261 6e6b 203d 2027  equence_rank = '
-00024eb0: 636e 6127 0d0a 0d0a 2020 2020 2020 2020  cna'....        
-00024ec0: 6966 2027 436f 6e76 2720 696e 2063 6c61  if 'Conv' in cla
-00024ed0: 7373 5f6e 616d 653a 0d0a 2020 2020 2020  ss_name:..      
-00024ee0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-00024ef0: 6174 7472 286d 6f64 756c 652c 2027 6465  attr(module, 'de
-00024f00: 7074 685f 6d75 6c74 6970 6c69 6572 2729  pth_multiplier')
-00024f10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00024f20: 2020 2069 6620 2744 6570 7468 7769 7365     if 'Depthwise
-00024f30: 2720 696e 2063 6c61 7373 5f6e 616d 6520  ' in class_name 
-00024f40: 6f72 2027 5365 7061 7261 626c 6527 2069  or 'Separable' i
-00024f50: 6e20 636c 6173 735f 6e61 6d65 3a0d 0a20  n class_name:.. 
-00024f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f70: 2020 206d 6f64 756c 652e 6465 7074 685f     module.depth_
-00024f80: 6d75 6c74 6970 6c69 6572 203d 2031 0d0a  multiplier = 1..
-00024f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024fa0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00024fb0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-00024fc0: 652e 6465 7074 685f 6d75 6c74 6970 6c69  e.depth_multipli
-00024fd0: 6572 203d 204e 6f6e 650d 0a20 2020 2020  er = None..     
-00024fe0: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-00024ff0: 7361 7474 7228 6d6f 6475 6c65 2c20 2775  sattr(module, 'u
-00025000: 7365 5f73 7065 6374 7261 6c27 293a 0d0a  se_spectral'):..
-00025010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025020: 6d6f 6475 6c65 2e75 7365 5f73 7065 6374  module.use_spect
-00025030: 7261 6c20 3d20 4661 6c73 650d 0a0d 0a20  ral = False.... 
-00025040: 2020 2069 6620 6c61 7965 722e 6973 5f72     if layer.is_r
-00025050: 6f6f 7420 3d3d 2054 7275 6520 616e 6420  oot == True and 
-00025060: 280d 0a20 2020 2020 2020 2020 2020 206e  (..            n
-00025070: 6f74 2068 6173 6174 7472 286c 6179 6572  ot hasattr(layer
-00025080: 2c20 275f 7369 676e 6174 7572 6527 2920  , '_signature') 
-00025090: 6f72 206c 6179 6572 2e5f 7369 676e 6174  or layer._signat
-000250a0: 7572 6520 6973 204e 6f6e 6520 6f72 206c  ure is None or l
-000250b0: 656e 286c 6179 6572 2e5f 7369 676e 6174  en(layer._signat
-000250c0: 7572 652e 696e 7075 7473 2920 3d3d 2030  ure.inputs) == 0
-000250d0: 293a 0d0a 2020 2020 2020 2020 6c61 7965  ):..        laye
-000250e0: 722e 5f73 6967 6e61 7475 7265 203d 204e  r._signature = N
-000250f0: 6f6e 650d 0a20 2020 2020 2020 2023 2069  one..        # i
-00025100: 6620 6c61 7965 722e 5f69 6e70 7574 5f73  f layer._input_s
-00025110: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
-00025120: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
-00025130: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
-00025140: 6179 6572 2e5f 696e 7075 745f 7368 6170  ayer._input_shap
-00025150: 652c 2054 656e 736f 7253 7065 6329 3a0d  e, TensorSpec):.
-00025160: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-00025170: 2020 206c 6179 6572 2e5f 7369 676e 6174     layer._signat
-00025180: 7572 652e 696e 7075 7473 5b22 696e 7075  ure.inputs["inpu
-00025190: 7422 5d20 3d20 5465 6e73 6f72 5370 6563  t"] = TensorSpec
-000251a0: 2873 6861 7065 3d6c 6179 6572 2e5f 696e  (shape=layer._in
-000251b0: 7075 745f 7368 6170 652c 206e 616d 653d  put_shape, name=
-000251c0: 2269 6e70 7574 2229 0d0a 2020 2020 2020  "input")..      
-000251d0: 2020 2320 2020 2020 656c 6966 2069 7369    #     elif isi
-000251e0: 6e73 7461 6e63 6528 6c61 7965 722e 5f69  nstance(layer._i
-000251f0: 6e70 7574 5f73 6861 7065 2c20 7475 706c  nput_shape, tupl
-00025200: 6529 3a0d 0a20 2020 2020 2020 2023 2020  e):..        #  
-00025210: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00025220: 7261 6e67 6528 6c65 6e28 6c61 7965 722e  range(len(layer.
-00025230: 5f69 6e70 7574 5f73 6861 7065 2929 3a0d  _input_shape)):.
-00025240: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-00025250: 2020 2020 2020 206c 6179 6572 2e5f 7369         layer._si
-00025260: 676e 6174 7572 652e 696e 7075 7473 5b22  gnature.inputs["
-00025270: 696e 7075 745f 7b30 7d22 2e66 6f72 6d61  input_{0}".forma
-00025280: 7428 6929 5d20 3d20 5465 6e73 6f72 5370  t(i)] = TensorSp
-00025290: 6563 2873 6861 7065 3d6c 6179 6572 2e5f  ec(shape=layer._
-000252a0: 696e 7075 745f 7368 6170 655b 695d 2c20  input_shape[i], 
-000252b0: 6e61 6d65 3d22 696e 7075 745f 7b30 7d22  name="input_{0}"
-000252c0: 2e66 6f72 6d61 7428 6929 290d 0a20 2020  .format(i))..   
-000252d0: 2020 2020 2023 2069 6620 6c61 7965 722e       # if layer.
-000252e0: 5f6f 7574 7075 745f 7368 6170 6520 6973  _output_shape is
-000252f0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00025300: 2020 2020 230d 0a20 2020 2020 2020 2023      #..        #
-00025310: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00025320: 6365 286c 6179 6572 2e5f 6f75 7470 7574  ce(layer._output
-00025330: 5f73 6861 7065 2c20 5465 6e73 6f72 5370  _shape, TensorSp
-00025340: 6563 293a 0d0a 2020 2020 2020 2020 2320  ec):..        # 
-00025350: 2020 2020 2020 2020 6c61 7965 722e 5f73          layer._s
-00025360: 6967 6e61 7475 7265 2e6f 7574 7075 7473  ignature.outputs
-00025370: 5b22 6f75 7470 7574 225d 203d 2054 656e  ["output"] = Ten
-00025380: 736f 7253 7065 6328 7368 6170 653d 6c61  sorSpec(shape=la
-00025390: 7965 722e 5f6f 7574 7075 745f 7368 6170  yer._output_shap
-000253a0: 652c 206e 616d 653d 226f 7574 7075 7422  e, name="output"
-000253b0: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-000253c0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-000253d0: 286c 6179 6572 2e5f 6f75 7470 7574 5f73  (layer._output_s
-000253e0: 6861 7065 2c20 7475 706c 6529 3a0d 0a20  hape, tuple):.. 
-000253f0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00025400: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00025410: 6c65 6e28 6c61 7965 722e 5f6f 7574 7075  len(layer._outpu
-00025420: 745f 7368 6170 6529 293a 0d0a 2020 2020  t_shape)):..    
-00025430: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00025440: 2020 6c61 7965 722e 5f73 6967 6e61 7475    layer._signatu
-00025450: 7265 2e6f 7574 7075 7473 5b22 6f75 7470  re.outputs["outp
-00025460: 7574 5f7b 307d 222e 666f 726d 6174 2869  ut_{0}".format(i
-00025470: 295d 203d 2054 656e 736f 7253 7065 6328  )] = TensorSpec(
-00025480: 7368 6170 653d 6c61 7965 722e 5f6f 7574  shape=layer._out
-00025490: 7075 745f 7368 6170 655b 695d 2c20 6e61  put_shape[i], na
-000254a0: 6d65 3d22 6f75 7470 7574 5f7b 307d 222e  me="output_{0}".
-000254b0: 666f 726d 6174 2869 2929 0d0a 2020 2020  format(i))..    
-000254c0: 2020 2020 230d 0a0d 0a20 2020 2020 2020      #....       
-000254d0: 2073 6967 203d 206c 6179 6572 2e73 6967   sig = layer.sig
-000254e0: 6e61 7475 7265 0d0a 0d0a 2020 2020 7265  nature....    re
-000254f0: 7475 726e 206c 6179 6572 0d0a 0d0a 0d0a  turn layer......
-00025500: 6465 6620 6669 785f 6b65 7261 735f 6d6f  def fix_keras_mo
-00025510: 6475 6c65 286d 6f64 756c 653a 2074 662e  dule(module: tf.
-00025520: 4d6f 6475 6c65 2c20 696e 7075 745f 7465  Module, input_te
-00025530: 6e73 6f72 3a20 5465 6e73 6f72 203d 204e  nsor: Tensor = N
-00025540: 6f6e 652c 2069 6e70 7574 5f73 6861 7065  one, input_shape
-00025550: 3a20 2874 7570 6c65 2c20 5465 6e73 6f72  : (tuple, Tensor
-00025560: 5368 6170 6529 203d 204e 6f6e 6529 3a0d  Shape) = None):.
-00025570: 0a20 2020 2069 6d70 6f72 7420 7465 6e73  .    import tens
-00025580: 6f72 666c 6f77 2e70 7974 686f 6e2e 6b65  orflow.python.ke
-00025590: 7261 732e 6261 636b 656e 6420 6173 204b  ras.backend as K
-000255a0: 0d0a 2020 2020 6465 6620 6e61 6d65 645f  ..    def named_
-000255b0: 6d6f 6475 6c65 7328 6b65 7261 735f 6d6f  modules(keras_mo
-000255c0: 6465 6c2c 206d 656d 6f3d 4e6f 6e65 2c20  del, memo=None, 
-000255d0: 7072 6566 6978 3d27 2729 3a0d 0a20 2020  prefix=''):..   
-000255e0: 2020 2020 2069 6620 6d65 6d6f 2069 7320       if memo is 
-000255f0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00025600: 2020 206d 656d 6f20 3d20 7365 7428 290d     memo = set().
-00025610: 0a20 2020 2020 2020 2069 6620 6b65 7261  .        if kera
-00025620: 735f 6d6f 6465 6c20 6e6f 7420 696e 206d  s_model not in m
-00025630: 656d 6f3a 0d0a 2020 2020 2020 2020 2020  emo:..          
-00025640: 2020 6d65 6d6f 2e61 6464 286b 6572 6173    memo.add(keras
-00025650: 5f6d 6f64 656c 290d 0a20 2020 2020 2020  _model)..       
-00025660: 2020 2020 2079 6965 6c64 2070 7265 6669       yield prefi
-00025670: 782c 206b 6572 6173 5f6d 6f64 656c 0d0a  x, keras_model..
-00025680: 0d0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-00025690: 7965 7273 203d 205b 6b65 7261 735f 6d6f  yers = [keras_mo
-000256a0: 6465 6c5d 0d0a 2020 2020 2020 2020 2020  del]..          
-000256b0: 2020 6966 2068 6173 6174 7472 286b 6572    if hasattr(ker
-000256c0: 6173 5f6d 6f64 656c 2c20 276c 6179 6572  as_model, 'layer
-000256d0: 7327 293a 0d0a 2020 2020 2020 2020 2020  s'):..          
-000256e0: 2020 2020 2020 6c61 7965 7273 203d 206b        layers = k
-000256f0: 6572 6173 5f6d 6f64 656c 2e6c 6179 6572  eras_model.layer
-00025700: 730d 0a20 2020 2020 2020 2020 2020 2066  s..            f
-00025710: 6f72 206d 6f64 756c 6520 696e 206c 6179  or module in lay
-00025720: 6572 733a 0d0a 2020 2020 2020 2020 2020  ers:..          
-00025730: 2020 2020 2020 6e61 6d65 203d 206d 6f64        name = mod
-00025740: 756c 652e 6e61 6d65 0d0a 2020 2020 2020  ule.name..      
-00025750: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
-00025760: 756c 6520 6973 204e 6f6e 653a 0d0a 2020  ule is None:..  
-00025770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025780: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
-00025790: 2020 2020 2020 2020 2020 2020 7375 626d              subm
-000257a0: 6f64 756c 655f 7072 6566 6978 203d 2070  odule_prefix = p
-000257b0: 7265 6669 7820 2b20 2827 2e27 2069 6620  refix + ('.' if 
-000257c0: 7072 6566 6978 2065 6c73 6520 2727 2920  prefix else '') 
-000257d0: 2b20 6e61 6d65 0d0a 2020 2020 2020 2020  + name..        
-000257e0: 2020 2020 2020 2020 666f 7220 6d20 696e          for m in
-000257f0: 206e 616d 6564 5f6d 6f64 756c 6573 286d   named_modules(m
-00025800: 6f64 756c 652c 206d 656d 6f2c 2073 7562  odule, memo, sub
-00025810: 6d6f 6475 6c65 5f70 7265 6669 7829 3a0d  module_prefix):.
-00025820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025830: 2020 2020 2079 6965 6c64 206d 0d0a 0d0a       yield m....
-00025840: 2020 2020 6465 6620 6e61 6d65 645f 7061      def named_pa
-00025850: 7261 6d65 7465 7273 286b 6572 6173 5f6d  rameters(keras_m
-00025860: 6f64 656c 2c20 6d65 6d6f 3d4e 6f6e 652c  odel, memo=None,
-00025870: 2070 7265 6669 783d 2727 293a 0d0a 2020   prefix=''):..  
-00025880: 2020 2020 2020 7265 7475 726e 205b 2877        return [(w
-00025890: 2e6e 616d 652c 2077 2920 666f 7220 7720  .name, w) for w 
-000258a0: 696e 206b 6572 6173 5f6d 6f64 656c 2e77  in keras_model.w
-000258b0: 6569 6768 7473 5d0d 0a0d 0a20 2020 2064  eights]....    d
-000258c0: 6566 2074 6f28 6b65 7261 735f 6d6f 6465  ef to(keras_mode
-000258d0: 6c2c 202a 6172 6773 2920 2d3e 2054 3a0d  l, *args) -> T:.
-000258e0: 0a20 2020 2020 2020 2064 6576 6963 6520  .        device 
-000258f0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00025900: 6474 7970 6520 3d20 4e6f 6e65 0d0a 2020  dtype = None..  
-00025910: 2020 2020 2020 6e6f 6e5f 626c 6f63 6b69        non_blocki
-00025920: 6e67 203d 204e 6f6e 650d 0a20 2020 2020  ng = None..     
-00025930: 2020 2066 6f72 2061 7267 2069 6e20 6172     for arg in ar
-00025940: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00025950: 2069 6620 2763 7075 2720 696e 2061 7267   if 'cpu' in arg
-00025960: 2e6c 6f77 6572 2829 206f 7220 2767 7075  .lower() or 'gpu
-00025970: 2720 696e 2061 7267 2e6c 6f77 6572 2829  ' in arg.lower()
-00025980: 206f 7220 2763 7564 7527 2069 6e20 6172   or 'cudu' in ar
-00025990: 672e 6c6f 7765 7228 293a 0d0a 2020 2020  g.lower():..    
-000259a0: 2020 2020 2020 2020 2020 2020 6465 7669              devi
-000259b0: 6365 203d 2061 7267 0d0a 2020 2020 2020  ce = arg..      
-000259c0: 2020 2020 2020 656c 6966 2061 7267 2e6c        elif arg.l
-000259d0: 6f77 6572 2829 2069 6e20 5b27 666c 6f61  ower() in ['floa
-000259e0: 7427 2c20 2769 6e74 272c 2027 626f 6f6c  t', 'int', 'bool
-000259f0: 272c 2027 6861 6c66 272c 2027 6c6f 6e67  ', 'half', 'long
-00025a00: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
-00025a10: 2020 2020 2064 7479 7065 203d 2061 7267       dtype = arg
-00025a20: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00025a30: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-00025a40: 672c 2062 6f6f 6c29 3a0d 0a20 2020 2020  g, bool):..     
-00025a50: 2020 2020 2020 2020 2020 206e 6f6e 5f62             non_b
-00025a60: 6c6f 636b 696e 6720 3d20 6172 670d 0a0d  locking = arg...
-00025a70: 0a20 2020 2020 2020 2069 6620 6465 7669  .        if devi
-00025a80: 6365 2069 7320 4e6f 6e65 3a0d 0a20 2020  ce is None:..   
-00025a90: 2020 2020 2020 2020 2064 6576 6963 6520           device 
-00025aa0: 3d20 6765 745f 6465 7669 6365 2829 0d0a  = get_device()..
-00025ab0: 2020 2020 2020 2020 2320 6966 2064 7479          # if dty
-00025ac0: 7065 2069 7320 4e6f 6e65 2061 6e64 206c  pe is None and l
-00025ad0: 656e 286b 6572 6173 5f6d 6f64 656c 2e77  en(keras_model.w
-00025ae0: 6569 6768 7473 2920 3e20 303a 0d0a 2020  eights) > 0:..  
-00025af0: 2020 2020 2020 2320 2020 2020 6474 7970        #     dtyp
-00025b00: 6520 3d20 6b65 7261 735f 6d6f 6465 6c2e  e = keras_model.
-00025b10: 7765 6967 6874 735b 305d 2e64 7479 7065  weights[0].dtype
-00025b20: 0d0a 2020 2020 2020 2020 6966 2027 6370  ..        if 'cp
-00025b30: 7527 2069 6e20 6465 7669 6365 3a0d 0a20  u' in device:.. 
-00025b40: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00025b50: 7466 2e64 6576 6963 6528 272f 6370 753a  tf.device('/cpu:
-00025b60: 3027 293a 0d0a 2020 2020 2020 2020 2020  0'):..          
-00025b70: 2020 2020 2020 666f 7220 7020 696e 206b        for p in k
-00025b80: 6572 6173 5f6d 6f64 656c 2e77 6569 6768  eras_model.weigh
-00025b90: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00025ba0: 2020 2020 2020 2020 2069 6620 6474 7970           if dtyp
-00025bb0: 6520 6973 204e 6f6e 6520 6f72 2064 7479  e is None or dty
-00025bc0: 7065 203d 3d20 702e 6474 7970 653a 0d0a  pe == p.dtype:..
-00025bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025be0: 2020 2020 2020 2020 702e 6173 7369 676e          p.assign
-00025bf0: 2874 662e 6964 656e 7469 7479 2870 2e76  (tf.identity(p.v
-00025c00: 616c 7565 2829 2929 0d0a 2020 2020 2020  alue()))..      
-00025c10: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00025c20: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00025c30: 2020 2020 2020 2020 2020 2020 2070 2e61               p.a
-00025c40: 7373 6967 6e28 7466 2e69 6465 6e74 6974  ssign(tf.identit
-00025c50: 7928 6361 7374 2870 2e76 616c 7565 2829  y(cast(p.value()
-00025c60: 2c20 6474 7970 6529 2929 0d0a 2020 2020  , dtype)))..    
-00025c70: 2020 2020 656c 6966 2027 6770 7527 2069      elif 'gpu' i
-00025c80: 6e20 6465 7669 6365 206f 7220 2763 7564  n device or 'cud
-00025c90: 6127 2069 6e20 6465 7669 6365 3a0d 0a20  a' in device:.. 
-00025ca0: 2020 2020 2020 2020 2020 2069 6620 7466             if tf
-00025cb0: 2e74 6573 742e 6973 5f67 7075 5f61 7661  .test.is_gpu_ava
-00025cc0: 696c 6162 6c65 3a0d 0a20 2020 2020 2020  ilable:..       
-00025cd0: 2020 2020 2020 2020 2077 6974 6820 7466           with tf
-00025ce0: 2e64 6576 6963 6528 272f 6770 753a 3027  .device('/gpu:0'
-00025cf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00025d00: 2020 2020 2020 2020 666f 7220 7020 696e          for p in
-00025d10: 206b 6572 6173 5f6d 6f64 656c 2e77 6569   keras_model.wei
-00025d20: 6768 7473 3a0d 0a20 2020 2020 2020 2020  ghts:..         
-00025d30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00025d40: 6620 6474 7970 6520 6973 204e 6f6e 6520  f dtype is None 
-00025d50: 6f72 2064 7479 7065 203d 3d20 702e 6474  or dtype == p.dt
-00025d60: 7970 653a 0d0a 2020 2020 2020 2020 2020  ype:..          
-00025d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d80: 2020 702e 6173 7369 676e 2874 662e 6964    p.assign(tf.id
-00025d90: 656e 7469 7479 2870 2e76 616c 7565 2829  entity(p.value()
-00025da0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00025db0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00025dc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00025dd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00025de0: 2e61 7373 6967 6e28 7466 2e69 6465 6e74  .assign(tf.ident
-00025df0: 6974 7928 6361 7374 2870 2e76 616c 7565  ity(cast(p.value
-00025e00: 2829 2c20 6474 7970 6529 2929 0d0a 2020  (), dtype)))..  
-00025e10: 2020 2020 2020 7265 7475 726e 206b 6572        return ker
-00025e20: 6173 5f6d 6f64 656c 0d0a 0d0a 2020 2020  as_model....    
-00025e30: 6465 6620 7472 6169 6e28 6b65 7261 735f  def train(keras_
-00025e40: 6d6f 6465 6c29 3a0d 0a20 2020 2020 2020  model):..       
-00025e50: 2023 2031 203d 2074 7261 696e 0d0a 2020   # 1 = train..  
-00025e60: 2020 2020 2020 4b2e 7365 745f 6c65 6172        K.set_lear
-00025e70: 6e69 6e67 5f70 6861 7365 2831 290d 0a20  ning_phase(1).. 
-00025e80: 2020 2020 2020 2072 6574 7572 6e20 6b65         return ke
-00025e90: 7261 735f 6d6f 6465 6c0d 0a0d 0a20 2020  ras_model....   
-00025ea0: 2064 6566 2065 7661 6c28 6b65 7261 735f   def eval(keras_
-00025eb0: 6d6f 6465 6c29 3a0d 0a20 2020 2020 2020  model):..       
-00025ec0: 2023 2030 203d 2074 6573 742c 2031 203d   # 0 = test, 1 =
-00025ed0: 2074 7261 696e 0d0a 2020 2020 2020 2020   train..        
-00025ee0: 4b2e 7365 745f 6c65 6172 6e69 6e67 5f70  K.set_learning_p
-00025ef0: 6861 7365 2830 290d 0a20 2020 2020 2020  hase(0)..       
-00025f00: 2072 6574 7572 6e20 6b65 7261 735f 6d6f   return keras_mo
-00025f10: 6465 6c0d 0a0d 0a20 2020 206d 6f64 756c  del....    modul
-00025f20: 652e 6973 5f72 6f6f 7420 3d20 5472 7565  e.is_root = True
-00025f30: 0d0a 0d0a 2020 2020 6d6f 6475 6c65 2e5f  ....    module._
-00025f40: 6e6f 6465 7320 3d20 4f72 6465 7265 6444  nodes = OrderedD
-00025f50: 6963 7428 290d 0a20 2020 2066 6f72 206e  ict()..    for n
-00025f60: 616d 652c 206d 6f64 2069 6e20 6e61 6d65  ame, mod in name
-00025f70: 645f 6d6f 6475 6c65 7328 6d6f 6475 6c65  d_modules(module
-00025f80: 293a 0d0a 2020 2020 2020 2020 6d6f 6475  ):..        modu
-00025f90: 6c65 2e5f 6e6f 6465 735b 6964 286d 6f64  le._nodes[id(mod
-00025fa0: 295d 203d 206d 6f64 0d0a 2020 2020 2020  )] = mod..      
-00025fb0: 2020 6d6f 642e 7575 6964 203d 2069 6428    mod.uuid = id(
-00025fc0: 6d6f 6429 0d0a 2020 2020 2020 2020 6966  mod)..        if
-00025fd0: 206e 6f74 2068 6173 6174 7472 286d 6f64   not hasattr(mod
-00025fe0: 2c20 276e 616d 6564 5f6d 6f64 756c 6573  , 'named_modules
-00025ff0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00026000: 2073 6574 6174 7472 286d 6f64 2c20 276e   setattr(mod, 'n
-00026010: 616d 6564 5f6d 6f64 756c 6573 272c 204d  amed_modules', M
-00026020: 6574 686f 6454 7970 6528 6e61 6d65 645f  ethodType(named_
-00026030: 6d6f 6475 6c65 732c 206d 6f64 2929 0d0a  modules, mod))..
-00026040: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00026050: 2068 6173 6174 7472 286d 6f64 2c20 276e   hasattr(mod, 'n
-00026060: 616d 6564 5f70 6172 616d 6574 6572 7327  amed_parameters'
-00026070: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00026080: 7365 7461 7474 7228 6d6f 642c 2027 6e61  setattr(mod, 'na
-00026090: 6d65 645f 7061 7261 6d65 7465 7273 272c  med_parameters',
-000260a0: 204d 6574 686f 6454 7970 6528 6e61 6d65   MethodType(name
-000260b0: 645f 7061 7261 6d65 7465 7273 2c20 6d6f  d_parameters, mo
-000260c0: 6429 290d 0a0d 0a20 2020 2020 2020 2069  d))....        i
-000260d0: 6620 6e6f 7420 6861 7361 7474 7228 6d6f  f not hasattr(mo
-000260e0: 642c 2027 7472 6169 6e27 293a 0d0a 2020  d, 'train'):..  
-000260f0: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-00026100: 7228 6d6f 642c 2027 7472 6169 6e27 2c20  r(mod, 'train', 
-00026110: 4d65 7468 6f64 5479 7065 2874 7261 696e  MethodType(train
-00026120: 2c20 6d6f 6429 290d 0a0d 0a20 2020 2020  , mod))....     
-00026130: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-00026140: 7228 6d6f 642c 2027 6576 616c 2729 3a0d  r(mod, 'eval'):.
-00026150: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
-00026160: 6174 7472 286d 6f64 2c20 2765 7661 6c27  attr(mod, 'eval'
-00026170: 2c20 4d65 7468 6f64 5479 7065 2865 7661  , MethodType(eva
-00026180: 6c2c 206d 6f64 2929 0d0a 0d0a 2020 2020  l, mod))....    
-00026190: 2020 2020 6d6f 642e 7265 6c61 7469 7665      mod.relative
-000261a0: 5f6e 616d 6520 3d20 6e61 6d65 0d0a 2020  _name = name..  
-000261b0: 2020 6d6f 6475 6c65 2e6e 6f64 6573 203d    module.nodes =
-000261c0: 206d 6f64 756c 652e 5f6e 6f64 6573 0d0a   module._nodes..
-000261d0: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-000261e0: 7472 286d 6f64 756c 652c 2027 746f 2729  tr(module, 'to')
-000261f0: 3a0d 0a20 2020 2020 2020 2073 6574 6174  :..        setat
-00026200: 7472 286d 6f64 756c 652c 2027 746f 272c  tr(module, 'to',
-00026210: 204d 6574 686f 6454 7970 6528 746f 2c20   MethodType(to, 
-00026220: 6d6f 6475 6c65 2929 0d0a 0d0a 2020 2020  module))....    
-00026230: 6d6f 6475 6c65 2e5f 7569 645f 7072 6566  module._uid_pref
-00026240: 6978 7320 3d20 6465 6661 756c 7464 6963  ixs = defaultdic
-00026250: 7428 696e 7429 0d0a 2020 2020 7369 6720  t(int)..    sig 
-00026260: 3d20 5369 676e 6174 7572 6528 6e61 6d65  = Signature(name
-00026270: 3d6d 6f64 756c 652e 6e61 6d65 290d 0a20  =module.name).. 
-00026280: 2020 2066 6f72 2069 6e70 2069 6e20 6d6f     for inp in mo
-00026290: 6475 6c65 2e69 6e70 7574 733a 0d0a 2020  dule.inputs:..  
-000262a0: 2020 2020 2020 7369 672e 696e 7075 7473        sig.inputs
-000262b0: 5b69 6e70 2e6e 616d 655d 203d 2054 656e  [inp.name] = Ten
-000262c0: 736f 7253 7065 6328 7368 6170 653d 5465  sorSpec(shape=Te
-000262d0: 6e73 6f72 5368 6170 6528 696e 745f 7368  nsorShape(int_sh
-000262e0: 6170 6528 696e 7029 292c 2064 7479 7065  ape(inp)), dtype
-000262f0: 3d44 5459 5045 5f4d 4150 5049 4e47 5b69  =DTYPE_MAPPING[i
-00026300: 6e70 2e64 7479 7065 5d2c 0d0a 2020 2020  np.dtype],..    
-00026310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026330: 2020 2020 2020 6e61 6d65 3d69 6e70 2e6e        name=inp.n
-00026340: 616d 6529 0d0a 2020 2020 666f 7220 6b20  ame)..    for k 
-00026350: 696e 2072 616e 6765 286c 656e 286d 6f64  in range(len(mod
-00026360: 756c 652e 6f75 7470 7574 7329 293a 0d0a  ule.outputs)):..
-00026370: 2020 2020 2020 2020 6f75 7420 3d20 6d6f          out = mo
-00026380: 6475 6c65 2e6f 7574 7075 7473 5b6b 5d0d  dule.outputs[k].
-00026390: 0a20 2020 2020 2020 206f 7574 5f6e 616d  .        out_nam
-000263a0: 6520 3d20 276f 7574 7075 7427 2069 6620  e = 'output' if 
-000263b0: 6c65 6e28 6d6f 6475 6c65 2e6f 7574 7075  len(module.outpu
-000263c0: 7473 2920 3d3d 2031 2065 6c73 6520 276f  ts) == 1 else 'o
-000263d0: 7574 7075 745f 7b30 7d27 2e66 6f72 6d61  utput_{0}'.forma
-000263e0: 7428 6b29 0d0a 2020 2020 2020 2020 7369  t(k)..        si
-000263f0: 672e 6f75 7470 7574 735b 6f75 745f 6e61  g.outputs[out_na
-00026400: 6d65 5d20 3d20 5465 6e73 6f72 5370 6563  me] = TensorSpec
-00026410: 2873 6861 7065 3d54 656e 736f 7253 6861  (shape=TensorSha
-00026420: 7065 2869 6e74 5f73 6861 7065 286f 7574  pe(int_shape(out
-00026430: 2929 2c20 6474 7970 653d 4454 5950 455f  )), dtype=DTYPE_
-00026440: 4d41 5050 494e 475b 6f75 742e 6474 7970  MAPPING[out.dtyp
-00026450: 655d 2c0d 0a20 2020 2020 2020 2020 2020  e],..           
-00026460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026480: 6e61 6d65 3d6f 7574 5f6e 616d 6529 0d0a  name=out_name)..
-00026490: 0d0a 2020 2020 6d6f 6475 6c65 2e5f 7369  ..    module._si
-000264a0: 676e 6174 7572 6520 3d20 7369 670d 0a20  gnature = sig.. 
-000264b0: 2020 206d 6f64 756c 652e 7369 676e 6174     module.signat
-000264c0: 7572 6520 3d20 7369 670d 0a0d 0a20 2020  ure = sig....   
-000264d0: 2023 2064 6566 2067 6574 5f75 6964 2870   # def get_uid(p
-000264e0: 7265 6669 783d 2727 293a 0d0a 2020 2020  refix=''):..    
-000264f0: 2320 2020 2020 6d6f 6475 6c65 2e5f 7569  #     module._ui
-00026500: 645f 7072 6566 6978 735b 7072 6566 6978  d_prefixs[prefix
-00026510: 5d20 2b3d 2031 0d0a 2020 2020 2320 2020  ] += 1..    #   
-00026520: 2020 7265 7475 726e 206d 6f64 756c 652e    return module.
-00026530: 5f75 6964 5f70 7265 6669 7873 5b70 7265  _uid_prefixs[pre
-00026540: 6669 785d 0d0a 2020 2020 230d 0a20 2020  fix]..    #..   
-00026550: 2023 2064 6566 2067 6574 5f72 6f6f 7428   # def get_root(
-00026560: 6d6f 6475 6c65 293a 0d0a 2020 2020 2320  module):..    # 
-00026570: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-00026580: 7472 286d 6f64 756c 652c 2027 5f6e 6f64  tr(module, '_nod
-00026590: 6573 2729 206f 7220 6d6f 6475 6c65 2e5f  es') or module._
-000265a0: 6e6f 6465 7320 6973 204e 6f6e 6520 6f72  nodes is None or
-000265b0: 206c 656e 286d 6f64 756c 652e 5f6e 6f64   len(module._nod
-000265c0: 6573 2920 3c20 323a 0d0a 2020 2020 2320  es) < 2:..    # 
-000265d0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-000265e0: 6f64 756c 650d 0a20 2020 2023 2020 2020  odule..    #    
-000265f0: 2069 6620 6861 7361 7474 7228 6c69 7374   if hasattr(list
-00026600: 286d 6f64 756c 652e 5f6e 6f64 6573 2e76  (module._nodes.v
-00026610: 616c 7565 7328 2929 5b30 5d2c 2027 6973  alues())[0], 'is
-00026620: 5f72 6f6f 7427 2920 616e 6420 6c69 7374  _root') and list
-00026630: 286d 6f64 756c 652e 5f6e 6f64 6573 2e76  (module._nodes.v
-00026640: 616c 7565 7328 2929 5b30 5d2e 6973 5f72  alues())[0].is_r
-00026650: 6f6f 7420 3d3d 2054 7275 653a 0d0a 2020  oot == True:..  
-00026660: 2020 2320 2020 2020 2020 2020 7265 7475    #         retu
-00026670: 726e 206c 6973 7428 6d6f 6475 6c65 2e5f  rn list(module._
-00026680: 6e6f 6465 732e 7661 6c75 6573 2829 295b  nodes.values())[
-00026690: 305d 0d0a 2020 2020 2320 2020 2020 656c  0]..    #     el
-000266a0: 7365 3a0d 0a20 2020 2023 2020 2020 2020  se:..    #      
-000266b0: 2020 2066 6f72 206e 616d 652c 206e 6f64     for name, nod
-000266c0: 6520 696e 206d 6f64 756c 652e 5f6e 6f64  e in module._nod
-000266d0: 6573 2e69 7465 6d73 2829 3a0d 0a20 2020  es.items():..   
-000266e0: 2023 2020 2020 2020 2020 2020 2020 2069   #             i
-000266f0: 6620 6861 7361 7474 7228 6e6f 6465 2c20  f hasattr(node, 
-00026700: 2764 6566 6175 6c74 5f6e 616d 6527 2920  'default_name') 
-00026710: 616e 6420 6e6f 6465 2e64 6566 6175 6c74  and node.default
-00026720: 5f6e 616d 6520 3d3d 2022 7365 7175 656e  _name == "sequen
-00026730: 7469 616c 5f31 223a 0d0a 2020 2020 2320  tial_1":..    # 
-00026740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026750: 7265 7475 726e 206e 6f64 650d 0a20 2020  return node..   
-00026760: 2023 2020 2020 2020 2020 2072 6574 7572   #         retur
-00026770: 6e20 6d6f 6475 6c65 0d0a 0d0a 2020 2020  n module....    
-00026780: 2320 666f 7220 6e61 6d65 2c20 6d6f 6420  # for name, mod 
-00026790: 696e 206d 6f64 756c 652e 6e61 6d65 645f  in module.named_
-000267a0: 6d6f 6475 6c65 7328 293a 0d0a 2020 2020  modules():..    
-000267b0: 2320 2020 2020 6966 206d 6f64 2021 3d20  #     if mod != 
-000267c0: 6d6f 6475 6c65 3a0d 0a20 2020 2023 2020  module:..    #  
-000267d0: 2020 2020 2020 206d 6f64 756c 652e 6973         module.is
-000267e0: 5f72 6f6f 7420 3d20 4661 6c73 650d 0a20  _root = False.. 
-000267f0: 2020 2023 2020 2020 206d 6f64 2e5f 6275     #     mod._bu
-00026800: 696c 7420 3d20 5472 7565 0d0a 2020 2020  ilt = True..    
-00026810: 2320 2020 2020 6d6f 642e 6275 696c 7420  #     mod.built 
-00026820: 3d20 5472 7565 0d0a 2020 2020 2320 2020  = True..    #   
-00026830: 2020 6d6f 642e 7265 6c61 7469 7665 5f6e    mod.relative_n
-00026840: 616d 6520 3d20 6e61 6d65 0d0a 2020 2020  ame = name..    
-00026850: 2320 2020 2020 6d6f 642e 6261 7463 685f  #     mod.batch_
-00026860: 696e 6465 7820 3d20 300d 0a20 2020 2023  index = 0..    #
-00026870: 2020 2020 206d 6f64 2e66 696c 7465 725f       mod.filter_
-00026880: 696e 6465 7820 3d20 310d 0a20 2020 2023  index = 1..    #
-00026890: 2020 2020 206d 6f64 2e69 6e5f 7365 7175       mod.in_sequ
-000268a0: 656e 6365 203d 2046 616c 7365 0d0a 2020  ence = False..  
-000268b0: 2020 2320 2020 2020 6d6f 642e 7575 6964    #     mod.uuid
-000268c0: 203d 2075 7569 642e 7575 6964 3428 292e   = uuid.uuid4().
-000268d0: 6e6f 6465 0d0a 2020 2020 2320 2020 2020  node..    #     
-000268e0: 7072 6566 6978 203d 206d 6f64 2e5f 5f63  prefix = mod.__c
-000268f0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f0d  lass__.__name__.
-00026900: 0a20 2020 2023 2020 2020 206d 6f64 2e64  .    #     mod.d
-00026910: 6566 6175 6c74 5f6e 616d 6520 3d20 6361  efault_name = ca
-00026920: 6d65 6c32 736e 616b 6528 7072 6566 6978  mel2snake(prefix
-00026930: 2920 2b20 275f 2720 2b20 7374 7228 6765  ) + '_' + str(ge
-00026940: 745f 7569 6428 6361 6d65 6c32 736e 616b  t_uid(camel2snak
-00026950: 6528 7072 6566 6978 2929 290d 0a20 2020  e(prefix)))..   
-00026960: 2023 0d0a 2020 2020 2320 2020 2020 6d6f   #..    #     mo
-00026970: 642e 5f69 6e70 7574 5f73 6861 7065 203d  d._input_shape =
-00026980: 204e 6f6e 650d 0a20 2020 2023 2020 2020   None..    #    
-00026990: 206d 6f64 2e5f 6f75 7470 7574 5f73 6861   mod._output_sha
-000269a0: 7065 203d 204e 6f6e 650d 0a20 2020 2023  pe = None..    #
-000269b0: 2020 2020 206d 6f64 2e6b 6565 705f 6f75       mod.keep_ou
-000269c0: 7470 7574 203d 2046 616c 7365 0d0a 2020  tput = False..  
-000269d0: 2020 2320 2020 2020 6d6f 642e 7265 6769    #     mod.regi
-000269e0: 7374 6572 5f62 7566 6665 7228 275f 6f75  ster_buffer('_ou
-000269f0: 7470 7574 5f74 656e 736f 7227 2c20 4e6f  tput_tensor', No
-00026a00: 6e65 2c20 7065 7273 6973 7465 6e74 3d46  ne, persistent=F
-00026a10: 616c 7365 290d 0a20 2020 2023 0d0a 2020  alse)..    #..  
-00026a20: 2020 2320 2020 2020 6d6f 642e 5f64 6576    #     mod._dev
-00026a30: 6963 6520 3d20 6765 745f 6465 7669 6365  ice = get_device
-00026a40: 2829 0d0a 2020 2020 2320 2020 2020 236d  ()..    #     #m
-00026a50: 6f64 2e5f 7369 676e 6174 7572 6520 3d20  od._signature = 
-00026a60: 696e 7370 6563 742e 7369 676e 6174 7572  inspect.signatur
-00026a70: 6528 6d6f 642e 666f 7277 6172 6429 0d0a  e(mod.forward)..
-00026a80: 2020 2020 2320 2020 2020 6d6f 642e 6475      #     mod.du
-00026a90: 6d70 5f70 6174 6368 6573 203d 2054 7275  mp_patches = Tru
-00026aa0: 650d 0a20 2020 2023 2020 2020 2023 0d0a  e..    #     #..
-00026ab0: 2020 2020 2320 2020 2020 2320 6465 6620      #     # def 
-00026ac0: 6765 7473 6967 6e61 7475 7265 286d 6f64  getsignature(mod
-00026ad0: 293a 0d0a 2020 2020 2320 2020 2020 2320  ):..    #     # 
-00026ae0: 2020 2020 7265 7475 726e 206d 6f64 2e5f      return mod._
-00026af0: 7369 676e 6174 7572 650d 0a20 2020 2023  signature..    #
-00026b00: 2020 2020 2023 0d0a 2020 2020 2320 2020       #..    #   
-00026b10: 2020 2320 6465 6620 7365 7473 6967 6e61    # def setsigna
-00026b20: 7475 7265 286d 6f64 2c20 7661 6c75 6529  ture(mod, value)
-00026b30: 3a0d 0a20 2020 2023 2020 2020 2023 2020  :..    #     #  
-00026b40: 2020 206d 6f64 2e5f 7369 676e 6174 7572     mod._signatur
-00026b50: 6520 3d20 7661 6c75 650d 0a20 2020 2023  e = value..    #
-00026b60: 2020 2020 2023 0d0a 2020 2020 2320 2020       #..    #   
-00026b70: 2020 2320 6465 6620 6465 6c73 6967 6e61    # def delsigna
-00026b80: 7475 7265 286d 6f64 293a 0d0a 2020 2020  ture(mod):..    
-00026b90: 2320 2020 2020 2320 2020 2020 6465 6c20  #     #     del 
-00026ba0: 6d6f 642e 5f73 6967 6e61 7475 7265 0d0a  mod._signature..
-00026bb0: 2020 2020 2320 2020 2020 230d 0a20 2020      #     #..   
-00026bc0: 2023 2020 2020 2023 206d 6f64 2e73 6967   #     # mod.sig
-00026bd0: 6e61 7475 7265 3d20 7072 6f70 6572 7479  nature= property
-00026be0: 2867 6574 7369 676e 6174 7572 652c 2073  (getsignature, s
-00026bf0: 6574 7369 676e 6174 7572 652c 2064 656c  etsignature, del
-00026c00: 7369 676e 6174 7572 652c 2022 7369 676e  signature, "sign
-00026c10: 6174 7572 6522 290d 0a20 2020 2023 0d0a  ature")..    #..
-00026c20: 2020 2020 2320 2020 2020 6966 206e 6f74      #     if not
-00026c30: 2068 6173 6174 7472 286d 6f64 2c20 2767   hasattr(mod, 'g
-00026c40: 6574 5f72 6f6f 7427 293a 0d0a 2020 2020  et_root'):..    
-00026c50: 2320 2020 2020 2020 2020 7365 7461 7474  #         setatt
-00026c60: 7228 6d6f 642c 2027 6765 745f 726f 6f74  r(mod, 'get_root
-00026c70: 272c 204d 6574 686f 6454 7970 6528 6765  ', MethodType(ge
-00026c80: 745f 726f 6f74 2c20 6d6f 6429 290d 0a20  t_root, mod)).. 
-00026c90: 2020 2023 2020 2020 2069 6620 6861 7361     #     if hasa
-00026ca0: 7474 7228 6d6f 642c 2027 6469 6d73 2729  ttr(mod, 'dims')
-00026cb0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-00026cc0: 206d 6f64 2e61 7869 7320 3d20 6d6f 642e   mod.axis = mod.
-00026cd0: 6469 6d73 0d0a 2020 2020 2320 2020 2020  dims..    #     
-00026ce0: 6966 2068 6173 6174 7472 286d 6f64 756c  if hasattr(modul
-00026cf0: 652c 2027 6b65 6570 6469 6d27 293a 0d0a  e, 'keepdim'):..
-00026d00: 2020 2020 2320 2020 2020 2020 2020 7661      #         va
-00026d10: 6c75 6520 3d20 6765 7461 7474 7228 6d6f  lue = getattr(mo
-00026d20: 6475 6c65 2c20 276b 6565 7064 696d 2729  dule, 'keepdim')
-00026d30: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-00026d40: 7365 7461 7474 7228 6d6f 6475 6c65 2c20  setattr(module, 
-00026d50: 276b 6565 7064 696d 7327 2c20 7661 6c75  'keepdims', valu
-00026d60: 6529 0d0a 2020 2020 230d 0a20 2020 2023  e)..    #..    #
-00026d70: 2064 6566 2072 6567 6973 7465 725f 686f   def register_ho
-00026d80: 6f6b 286d 6f64 756c 6529 3a0d 0a20 2020  ok(module):..   
-00026d90: 2023 2020 2020 2064 6566 2068 6f6f 6b28   #     def hook(
-00026da0: 6d6f 6475 6c65 2c20 696e 7075 742c 206f  module, input, o
-00026db0: 7574 7075 7429 3a0d 0a20 2020 2023 2020  utput):..    #  
-00026dc0: 2020 2020 2020 2023 2063 6c61 7373 5f6e         # class_n
-00026dd0: 616d 6520 3d6d 6f64 756c 652e 7265 2020  ame =module.re  
-00026de0: 2020 6d6f 6475 6c65 2e6e 616d 6520 2020    module.name   
-00026df0: 2320 7374 7228 6d6f 6475 6c65 2e5f 5f63  # str(module.__c
-00026e00: 6c61 7373 5f5f 292e 7370 6c69 7428 222e  lass__).split(".
-00026e10: 2229 5b2d 315d 2e73 706c 6974 2822 2722  ")[-1].split("'"
-00026e20: 295b 305d 0d0a 2020 2020 2320 2020 2020  )[0]..    #     
-00026e30: 2020 2020 696e 7075 7420 3d20 6974 6572      input = iter
-00026e40: 6174 696f 6e5f 746f 6f6c 732e 666c 6174  ation_tools.flat
-00026e50: 7465 6e28 5b69 6e70 7574 5d2c 2069 7465  ten([input], ite
-00026e60: 7261 626c 655f 7479 7065 733d 286c 6973  rable_types=(lis
-00026e70: 742c 2074 7570 6c65 2929 0d0a 2020 2020  t, tuple))..    
-00026e80: 2320 2020 2020 2020 2020 696e 7075 7420  #         input 
-00026e90: 3d20 756e 7061 636b 5f73 696e 676c 6574  = unpack_singlet
-00026ea0: 6f6e 285b 6974 656d 2066 6f72 2069 7465  on([item for ite
-00026eb0: 6d20 696e 2069 6e70 7574 2069 6620 6974  m in input if it
-00026ec0: 656d 2069 7320 6e6f 7420 4e6f 6e65 5d29  em is not None])
-00026ed0: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
-00026ee0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00026ef0: 616e 6365 2869 6e70 7574 2c20 286c 6973  ance(input, (lis
-00026f00: 742c 2074 7570 6c65 2929 3a0d 0a20 2020  t, tuple)):..   
-00026f10: 2023 2020 2020 2020 2020 2020 2020 206d   #             m
-00026f20: 6f64 756c 652e 5f69 6e70 7574 5f73 6861  odule._input_sha
-00026f30: 7065 203d 2074 7570 6c65 285b 7465 6e73  pe = tuple([tens
-00026f40: 6f72 5f74 6f5f 7368 6170 6528 742c 206e  or_to_shape(t, n
-00026f50: 6565 645f 6578 636c 7564 655f 6261 7463  eed_exclude_batc
-00026f60: 685f 6178 6973 3d54 7275 652c 2069 735f  h_axis=True, is_
-00026f70: 7369 6e67 6c65 746f 6e3d 4661 6c73 6529  singleton=False)
-00026f80: 2066 6f72 2074 2069 6e20 696e 7075 745d   for t in input]
-00026f90: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
-00026fa0: 2020 2020 206d 6f64 756c 652e 696e 7075       module.inpu
-00026fb0: 745f 7368 6170 6520 3d20 6d6f 6475 6c65  t_shape = module
-00026fc0: 2e5f 696e 7075 745f 7368 6170 650d 0a20  ._input_shape.. 
-00026fd0: 2020 2023 2020 2020 2020 2020 2065 6c69     #         eli
-00026fe0: 6620 6973 5f74 656e 736f 7228 696e 7075  f is_tensor(inpu
-00026ff0: 7429 3a0d 0a20 2020 2023 2020 2020 2020  t):..    #      
-00027000: 2020 2020 2020 206d 6f64 756c 652e 5f69         module._i
-00027010: 6e70 7574 5f73 6861 7065 203d 2074 656e  nput_shape = ten
-00027020: 736f 725f 746f 5f73 6861 7065 2869 6e70  sor_to_shape(inp
-00027030: 7574 2c20 6e65 6564 5f65 7863 6c75 6465  ut, need_exclude
-00027040: 5f62 6174 6368 5f61 7869 733d 5472 7565  _batch_axis=True
-00027050: 2c20 6973 5f73 696e 676c 6574 6f6e 3d46  , is_singleton=F
-00027060: 616c 7365 290d 0a20 2020 2023 2020 2020  alse)..    #    
-00027070: 2020 2020 2020 2020 206d 6f64 756c 652e           module.
-00027080: 696e 7075 745f 7368 6170 6520 3d20 6d6f  input_shape = mo
-00027090: 6475 6c65 2e5f 696e 7075 745f 7368 6170  dule._input_shap
-000270a0: 650d 0a20 2020 2023 0d0a 2020 2020 2320  e..    #..    # 
-000270b0: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-000270c0: 2069 7465 7261 7469 6f6e 5f74 6f6f 6c73   iteration_tools
-000270d0: 2e66 6c61 7474 656e 285b 6f75 7470 7574  .flatten([output
-000270e0: 5d2c 2069 7465 7261 626c 655f 7479 7065  ], iterable_type
-000270f0: 733d 286c 6973 742c 2074 7570 6c65 2929  s=(list, tuple))
-00027100: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-00027110: 6f75 7470 7574 203d 2075 6e70 6163 6b5f  output = unpack_
-00027120: 7369 6e67 6c65 746f 6e28 5b69 7465 6d20  singleton([item 
-00027130: 666f 7220 6974 656d 2069 6e20 6f75 7470  for item in outp
-00027140: 7574 2069 6620 6974 656d 2069 7320 6e6f  ut if item is no
-00027150: 7420 4e6f 6e65 5d29 0d0a 2020 2020 2320  t None])..    # 
-00027160: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00027170: 7461 6e63 6528 6f75 7470 7574 2c20 286c  tance(output, (l
-00027180: 6973 742c 2074 7570 6c65 2929 3a0d 0a20  ist, tuple)):.. 
-00027190: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000271a0: 206d 6f64 756c 652e 5f6f 7574 7075 745f   module._output_
-000271b0: 7368 6170 6520 3d20 7475 706c 6528 5b74  shape = tuple([t
-000271c0: 656e 736f 725f 746f 5f73 6861 7065 2874  ensor_to_shape(t
-000271d0: 2c20 6e65 6564 5f65 7863 6c75 6465 5f62  , need_exclude_b
-000271e0: 6174 6368 5f61 7869 733d 5472 7565 2c20  atch_axis=True, 
-000271f0: 6973 5f73 696e 676c 6574 6f6e 3d46 616c  is_singleton=Fal
-00027200: 7365 2920 666f 7220 7420 696e 206f 7574  se) for t in out
-00027210: 7075 745d 290d 0a20 2020 2023 2020 2020  put])..    #    
-00027220: 2020 2020 2020 2020 206d 6f64 756c 652e           module.
-00027230: 6f75 7470 7574 5f73 6861 7065 203d 206d  output_shape = m
-00027240: 6f64 756c 652e 5f6f 7574 7075 745f 7368  odule._output_sh
-00027250: 6170 650d 0a20 2020 2023 2020 2020 2020  ape..    #      
-00027260: 2020 2065 6c69 6620 6973 5f74 656e 736f     elif is_tenso
-00027270: 7228 6f75 7470 7574 293a 0d0a 2020 2020  r(output):..    
-00027280: 2320 2020 2020 2020 2020 2020 2020 6d6f  #             mo
-00027290: 6475 6c65 2e5f 6f75 7470 7574 5f73 6861  dule._output_sha
-000272a0: 7065 203d 2074 656e 736f 725f 746f 5f73  pe = tensor_to_s
-000272b0: 6861 7065 286f 7574 7075 742c 206e 6565  hape(output, nee
-000272c0: 645f 6578 636c 7564 655f 6261 7463 685f  d_exclude_batch_
-000272d0: 6178 6973 3d54 7275 652c 2069 735f 7369  axis=True, is_si
-000272e0: 6e67 6c65 746f 6e3d 4661 6c73 6529 0d0a  ngleton=False)..
-000272f0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00027300: 2020 6d6f 6475 6c65 2e6f 7574 7075 745f    module.output_
-00027310: 7368 6170 6520 3d20 6d6f 6475 6c65 2e5f  shape = module._
-00027320: 6f75 7470 7574 5f73 6861 7065 0d0a 2020  output_shape..  
-00027330: 2020 230d 0a20 2020 2023 2020 2020 2020    #..    #      
-00027340: 2020 2068 6f6f 6b73 2e61 7070 656e 6428     hooks.append(
-00027350: 6d6f 6475 6c65 2e72 6567 6973 7465 725f  module.register_
-00027360: 666f 7277 6172 645f 686f 6f6b 2868 6f6f  forward_hook(hoo
-00027370: 6b29 290d 0a20 2020 2023 0d0a 2020 2020  k))..    #..    
-00027380: 2320 686f 6f6b 7320 3d20 5b5d 0d0a 2020  # hooks = []..  
-00027390: 2020 230d 0a20 2020 2023 2023 2072 6567    #..    # # reg
-000273a0: 6973 7465 7220 686f 6f6b 0d0a 2020 2020  ister hook..    
-000273b0: 2320 6d6f 6475 6c65 2e61 7070 6c79 2872  # module.apply(r
-000273c0: 6567 6973 7465 725f 686f 6f6b 290d 0a20  egister_hook).. 
-000273d0: 2020 2023 0d0a 2020 2020 2320 6966 2069     #..    # if i
-000273e0: 6e70 7574 5f74 656e 736f 7220 6973 204e  nput_tensor is N
-000273f0: 6f6e 653a 0d0a 2020 2020 2320 2020 2020  one:..    #     
-00027400: 696e 7075 745f 7465 6e73 6f72 203d 2074  input_tensor = t
-00027410: 6f5f 7465 6e73 6f72 2854 656e 736f 7253  o_tensor(TensorS
-00027420: 6861 7065 2869 6e70 7574 5f73 6861 7065  hape(input_shape
-00027430: 292e 6765 745f 6475 6d6d 795f 7465 6e73  ).get_dummy_tens
-00027440: 6f72 2829 290d 0a20 2020 2023 2023 206d  or())..    # # m
-00027450: 616b 6520 6120 666f 7277 6172 6420 7061  ake a forward pa
-00027460: 7373 0d0a 2020 2020 2320 2320 7072 696e  ss..    # # prin
-00027470: 7428 782e 7368 6170 6529 0d0a 2020 2020  t(x.shape)..    
-00027480: 2320 6d6f 6475 6c65 2869 6e70 7574 5f74  # module(input_t
-00027490: 656e 736f 7229 0d0a 2020 2020 230d 0a20  ensor)..    #.. 
-000274a0: 2020 2023 2023 2072 656d 6f76 6520 7468     # # remove th
-000274b0: 6573 6520 686f 6f6b 730d 0a20 2020 2023  ese hooks..    #
-000274c0: 2066 6f72 2068 2069 6e20 686f 6f6b 733a   for h in hooks:
-000274d0: 0d0a 2020 2020 2320 2020 2020 682e 7265  ..    #     h.re
-000274e0: 6d6f 7665 2829 0d0a 2020 2020 7265 7475  move()..    retu
-000274f0: 726e 206d 6f64 756c 650d 0a              rn module..
+000228d0: 6973 5f69 6e70 7574 203d 2061 7267 2e6c  is_input = arg.l
+000228e0: 6f77 6572 2829 2069 6e20 5b27 7827 2c20  ower() in ['x', 
+000228f0: 2769 6e70 7574 275d 0d0a 2020 2020 2020  'input']..      
+00022900: 2020 2020 2020 2020 2020 6973 5f6f 7574            is_out
+00022910: 7075 7420 3d20 6172 672e 6c6f 7765 7228  put = arg.lower(
+00022920: 2920 696e 205b 2779 272c 2027 6f75 7470  ) in ['y', 'outp
+00022930: 7574 272c 2027 795f 7072 6564 275d 0d0a  ut', 'y_pred']..
+00022940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022950: 6966 2061 7267 2069 6e20 6461 7461 5f66  if arg in data_f
+00022960: 6565 6420 616e 6420 6461 7461 5f66 6565  eed and data_fee
+00022970: 645b 6172 675d 2069 6e20 6461 7461 3a0d  d[arg] in data:.
+00022980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022990: 2020 2020 2061 7267 5f6d 6170 5b61 7267       arg_map[arg
+000229a0: 5d20 3d20 746f 5f74 656e 736f 7228 6461  ] = to_tensor(da
+000229b0: 7461 5b64 6174 615f 6665 6564 5b61 7267  ta[data_feed[arg
+000229c0: 5d5d 2c20 6465 7669 6365 3d67 6574 5f64  ]], device=get_d
+000229d0: 6576 6963 6528 2929 0d0a 2020 2020 2020  evice())..      
+000229e0: 2020 2020 2020 2020 2020 656c 6966 2061            elif a
+000229f0: 7267 2069 6e20 6461 7461 3a0d 0a20 2020  rg in data:..   
+00022a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a10: 2061 7267 5f6d 6170 5b61 7267 5d20 3d20   arg_map[arg] = 
+00022a20: 746f 5f74 656e 736f 7228 6461 7461 5b61  to_tensor(data[a
+00022a30: 7267 5d2c 2064 6576 6963 653d 6765 745f  rg], device=get_
+00022a40: 6465 7669 6365 2829 290d 0a20 2020 2020  device())..     
+00022a50: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00022a60: 6973 5f69 6e70 7574 2061 6e64 2027 696e  is_input and 'in
+00022a70: 7075 7427 2069 6e20 6461 7461 5f66 6565  put' in data_fee
+00022a80: 6420 616e 6420 6461 7461 5f66 6565 645b  d and data_feed[
+00022a90: 2769 6e70 7574 275d 2069 6e20 6461 7461  'input'] in data
+00022aa0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00022ab0: 2020 2020 2020 2061 7267 5f6d 6170 5b61         arg_map[a
+00022ac0: 7267 5d20 3d20 746f 5f74 656e 736f 7228  rg] = to_tensor(
+00022ad0: 6461 7461 5b64 6174 615f 6665 6564 5b27  data[data_feed['
+00022ae0: 696e 7075 7427 5d5d 2c20 6465 7669 6365  input']], device
+00022af0: 3d67 6574 5f64 6576 6963 6528 2929 0d0a  =get_device())..
+00022b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b10: 656c 6966 2069 735f 6f75 7470 7574 2061  elif is_output a
+00022b20: 6e64 2027 6f75 7470 7574 2720 696e 2064  nd 'output' in d
+00022b30: 6174 615f 6665 6564 2061 6e64 2064 6174  ata_feed and dat
+00022b40: 615f 6665 6564 5b27 6f75 7470 7574 275d  a_feed['output']
+00022b50: 2069 6e20 6461 7461 3a0d 0a20 2020 2020   in data:..     
+00022b60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00022b70: 7267 5f6d 6170 5b61 7267 5d20 3d20 746f  rg_map[arg] = to
+00022b80: 5f74 656e 736f 7228 6461 7461 5b64 6174  _tensor(data[dat
+00022b90: 615f 6665 6564 5b27 6f75 7470 7574 275d  a_feed['output']
+00022ba0: 5d2c 2064 6576 6963 653d 6765 745f 6465  ], device=get_de
+00022bb0: 7669 6365 2829 290d 0a20 2020 2020 2020  vice())..       
+00022bc0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00022bd0: 5f6f 7074 696f 6e61 6c3a 0d0a 2020 2020  _optional:..    
+00022be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bf0: 6172 675f 6d61 705b 6172 675d 203d 2064  arg_map[arg] = d
+00022c00: 6566 6175 6c74 0d0a 0d0a 2020 2020 2020  efault....      
+00022c10: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00022c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022c30: 2020 2020 2061 7267 5f6d 6170 2e70 6f70       arg_map.pop
+00022c40: 2861 7267 290d 0a20 2020 2020 2020 2020  (arg)..         
+00022c50: 2020 2069 6620 6374 782e 616d 705f 6176     if ctx.amp_av
+00022c60: 6169 6c61 626c 6520 3d3d 2054 7275 6520  ailable == True 
+00022c70: 616e 6420 6973 5f61 7574 6f63 6173 745f  and is_autocast_
+00022c80: 656e 6162 6c65 6420 3d3d 2054 7275 6520  enabled == True 
+00022c90: 616e 6420 6765 745f 6465 7669 6365 2829  and get_device()
+00022ca0: 203d 3d20 2763 7564 6127 3a0d 0a20 2020   == 'cuda':..   
+00022cb0: 2020 2020 2020 2020 2020 2020 2023 206e               # n
+00022cc0: 6f74 2073 7570 706f 7274 2079 6574 0d0a  ot support yet..
+00022cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ce0: 6f75 7420 3d20 666e 282a 6172 675f 6d61  out = fn(*arg_ma
+00022cf0: 702e 7661 6c75 655f 6c69 7374 290d 0a20  p.value_list).. 
+00022d00: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00022d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022d20: 2020 6f75 7420 3d20 666e 282a 6172 675f    out = fn(*arg_
+00022d30: 6d61 702e 7661 6c75 655f 6c69 7374 290d  map.value_list).
+00022d40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00022d50: 7572 6e20 6f75 740d 0a20 2020 2020 2020  urn out..       
+00022d60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00022d70: 2020 2020 7072 696e 7428 2775 6e63 6f6d      print('uncom
+00022d80: 706c 6574 6520 6172 675f 6d61 7027 2c20  plete arg_map', 
+00022d90: 6172 675f 6d61 702e 6b65 795f 6c69 7374  arg_map.key_list
+00022da0: 290d 0a0d 0a0d 0a64 6566 2066 6f72 6365  )......def force
+00022db0: 5f64 6574 6572 6d69 6e69 7374 6963 2873  _deterministic(s
+00022dc0: 6565 6429 3a0d 0a20 2020 2022 2222 2046  eed):..    """ F
+00022dd0: 6f72 6365 206d 6f73 7420 6f66 2074 6865  orce most of the
+00022de0: 2063 6f6d 7075 7461 7469 6f6e 206e 6f64   computation nod
+00022df0: 6573 2074 6f20 7275 6e20 6465 7465 726d  es to run determ
+00022e00: 696e 6973 7469 6361 6c6c 792e 0d0a 0d0a  inistically.....
+00022e10: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+00022e20: 2020 2073 6565 6420 2869 6e74 293a 2073     seed (int): s
+00022e30: 6574 2074 6865 2072 616e 646f 6d20 7365  et the random se
+00022e40: 6564 2066 6f72 2061 6c6c 2072 616e 646f  ed for all rando
+00022e50: 6d20 6f70 7320 696e 2074 6865 2067 7261  m ops in the gra
+00022e60: 7068 2061 6e64 2072 6561 6465 7273 2e0d  ph and readers..
+00022e70: 0a0d 0a20 2020 2022 2222 0d0a 0d0a 2020  ...    """....  
+00022e80: 2020 7365 745f 7365 6564 2873 6565 6429    set_seed(seed)
+00022e90: 0d0a 2020 2020 6f73 2e65 6e76 6972 6f6e  ..    os.environ
+00022ea0: 5b27 5446 5f43 5544 4e4e 5f44 4554 4552  ['TF_CUDNN_DETER
+00022eb0: 4d49 4e49 5354 4943 275d 203d 2054 7275  MINISTIC'] = Tru
+00022ec0: 650d 0a20 2020 206f 732e 656e 7669 726f  e..    os.enviro
+00022ed0: 6e5b 2754 465f 4355 444e 4e5f 5553 455f  n['TF_CUDNN_USE_
+00022ee0: 4155 544f 5455 4e45 275d 203d 2046 616c  AUTOTUNE'] = Fal
+00022ef0: 7365 0d0a 2020 2020 7466 2e63 6f6e 6669  se..    tf.confi
+00022f00: 672e 7468 7265 6164 696e 672e 7365 745f  g.threading.set_
+00022f10: 696e 7472 615f 6f70 5f70 6172 616c 6c65  intra_op_paralle
+00022f20: 6c69 736d 5f74 6872 6561 6473 2831 290d  lism_threads(1).
+00022f30: 0a20 2020 2074 662e 636f 6e66 6967 2e74  .    tf.config.t
+00022f40: 6872 6561 6469 6e67 2e73 6574 5f69 6e74  hreading.set_int
+00022f50: 6572 5f6f 705f 7061 7261 6c6c 656c 6973  er_op_parallelis
+00022f60: 6d5f 7468 7265 6164 7328 3129 0d0a 0d0a  m_threads(1)....
+00022f70: 0d0a 6465 6620 6669 785f 6c61 7965 7228  ..def fix_layer(
+00022f80: 6c61 7965 723a 204c 6179 6572 293a 0d0a  layer: Layer):..
+00022f90: 2020 2020 2222 2266 6978 2065 7869 7374      """fix exist
+00022fa0: 696e 6720 6f75 742d 6f66 2d64 6174 6520  ing out-of-date 
+00022fb0: 6d6f 6465 6c20 636f 6d70 6174 6962 696c  model compatibil
+00022fc0: 6974 790d 0a0d 0a20 2020 2041 7267 733a  ity....    Args:
+00022fd0: 0d0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
+00022fe0: 2874 7269 6465 6e74 204c 6179 6572 293a  (trident Layer):
+00022ff0: 0d0a 0d0a 2020 2020 5265 7475 726e 733a  ....    Returns:
+00023000: 2066 6978 6564 206c 6179 6572 0d0a 0d0a   fixed layer....
+00023010: 2020 2020 2222 220d 0a20 2020 2069 6620      """..    if 
+00023020: 6e6f 7420 6861 7361 7474 7228 6c61 7965  not hasattr(laye
+00023030: 722c 2027 6973 5f72 6f6f 7427 293a 0d0a  r, 'is_root'):..
+00023040: 2020 2020 2020 2020 6c61 7965 722e 6973          layer.is
+00023050: 5f72 6f6f 7420 3d20 5472 7565 0d0a 2020  _root = True..  
+00023060: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00023070: 286c 6179 6572 2c20 2764 6576 6963 6527  (layer, 'device'
+00023080: 293a 0d0a 2020 2020 2020 2020 6c61 7965  ):..        laye
+00023090: 722e 6465 7669 6365 203d 2067 6574 5f64  r.device = get_d
+000230a0: 6576 6963 6528 290d 0a0d 0a20 2020 2064  evice()....    d
+000230b0: 6566 2067 6574 5f72 6f6f 7428 7365 6c66  ef get_root(self
+000230c0: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
+000230d0: 6f74 2068 6173 6174 7472 2873 656c 662c  ot hasattr(self,
+000230e0: 2027 5f6e 6f64 6573 2729 206f 7220 7365   '_nodes') or se
+000230f0: 6c66 2e5f 6e6f 6465 7320 6973 204e 6f6e  lf._nodes is Non
+00023100: 6520 6f72 206c 656e 2873 656c 662e 5f6e  e or len(self._n
+00023110: 6f64 6573 2920 3c20 323a 0d0a 2020 2020  odes) < 2:..    
+00023120: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00023130: 656c 660d 0a20 2020 2020 2020 2069 6620  elf..        if 
+00023140: 6861 7361 7474 7228 6c69 7374 2873 656c  hasattr(list(sel
+00023150: 662e 5f6e 6f64 6573 2e76 616c 7565 7328  f._nodes.values(
+00023160: 2929 5b30 5d2c 2027 6973 5f72 6f6f 7427  ))[0], 'is_root'
+00023170: 2920 616e 6420 6c69 7374 2873 656c 662e  ) and list(self.
+00023180: 5f6e 6f64 6573 2e76 616c 7565 7328 2929  _nodes.values())
+00023190: 5b30 5d2e 6973 5f72 6f6f 7420 3d3d 2054  [0].is_root == T
+000231a0: 7275 653a 0d0a 2020 2020 2020 2020 2020  rue:..          
+000231b0: 2020 7265 7475 726e 206c 6973 7428 7365    return list(se
+000231c0: 6c66 2e5f 6e6f 6465 732e 7661 6c75 6573  lf._nodes.values
+000231d0: 2829 295b 305d 0d0a 2020 2020 2020 2020  ())[0]..        
+000231e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000231f0: 2020 2066 6f72 206e 616d 652c 206e 6f64     for name, nod
+00023200: 6520 696e 2073 656c 662e 5f6e 6f64 6573  e in self._nodes
+00023210: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
+00023220: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+00023230: 7361 7474 7228 6e6f 6465 2c20 2764 6566  sattr(node, 'def
+00023240: 6175 6c74 5f6e 616d 6527 2920 616e 6420  ault_name') and 
+00023250: 6e6f 6465 2e64 6566 6175 6c74 5f6e 616d  node.default_nam
+00023260: 6520 3d3d 2022 7365 7175 656e 7469 616c  e == "sequential
+00023270: 5f31 223a 0d0a 2020 2020 2020 2020 2020  _1":..          
+00023280: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00023290: 206e 6f64 650d 0a20 2020 2020 2020 2020   node..         
+000232a0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+000232b0: 0d0a 2020 2020 6c61 7965 722e 746f 2867  ..    layer.to(g
+000232c0: 6574 5f64 6576 6963 6528 2929 0d0a 2020  et_device())..  
+000232d0: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+000232e0: 286c 6179 6572 2c20 275f 6e6f 6465 7327  (layer, '_nodes'
+000232f0: 293a 0d0a 2020 2020 2020 2020 6c61 7965  ):..        laye
+00023300: 722e 5f6e 6f64 6573 203d 204f 7264 6572  r._nodes = Order
+00023310: 6564 4469 6374 2829 0d0a 0d0a 2020 2020  edDict()....    
+00023320: 6966 206e 6f74 2068 6173 6174 7472 286c  if not hasattr(l
+00023330: 6179 6572 2c20 275f 7569 645f 7072 6566  ayer, '_uid_pref
+00023340: 6978 7327 293a 0d0a 2020 2020 2020 2020  ixs'):..        
+00023350: 6c61 7965 722e 5f75 6964 5f70 7265 6669  layer._uid_prefi
+00023360: 7873 203d 207b 7d0d 0a20 2020 2072 6573  xs = {}..    res
+00023370: 6574 5f6e 616d 6528 6c61 7965 722c 206c  et_name(layer, l
+00023380: 6179 6572 2e5f 7569 645f 7072 6566 6978  ayer._uid_prefix
+00023390: 7329 0d0a 0d0a 2020 2020 6966 2027 7373  s)....    if 'ss
+000233a0: 6427 2069 6e20 6c61 7965 722e 5f5f 636c  d' in layer.__cl
+000233b0: 6173 735f 5f2e 5f5f 6261 7365 5f5f 2e5f  ass__.__base__._
+000233c0: 5f6e 616d 655f 5f2e 6c6f 7765 7228 2920  _name__.lower() 
+000233d0: 6f72 2027 796f 6c6f 2720 696e 206c 6179  or 'yolo' in lay
+000233e0: 6572 2e5f 5f63 6c61 7373 5f5f 2e5f 5f62  er.__class__.__b
+000233f0: 6173 655f 5f2e 5f5f 6e61 6d65 5f5f 2e6c  ase__.__name__.l
+00023400: 6f77 6572 2829 3a0d 0a20 2020 2020 2020  ower():..       
+00023410: 2069 6620 6861 7361 7474 7228 6c61 7965   if hasattr(laye
+00023420: 722c 2027 6e6d 735f 7468 7265 7368 6f6c  r, 'nms_threshol
+00023430: 6427 293a 0d0a 2020 2020 2020 2020 2020  d'):..          
+00023440: 2020 6465 6c61 7474 7228 6c61 7965 722c    delattr(layer,
+00023450: 2027 6e6d 735f 7468 7265 7368 6f6c 6427   'nms_threshold'
+00023460: 290d 0a20 2020 2020 2020 2069 6620 6861  )..        if ha
+00023470: 7361 7474 7228 6c61 7965 722c 2027 6465  sattr(layer, 'de
+00023480: 7465 6374 696f 6e5f 7468 7265 7368 6f6c  tection_threshol
+00023490: 6427 293a 0d0a 2020 2020 2020 2020 2020  d'):..          
+000234a0: 2020 6465 6c61 7474 7228 6c61 7965 722c    delattr(layer,
+000234b0: 2027 6465 7465 6374 696f 6e5f 7468 7265   'detection_thre
+000234c0: 7368 6f6c 6427 290d 0a0d 0a20 2020 2069  shold')....    i
+000234d0: 6620 6c61 7965 722e 5f69 6e70 7574 5f73  f layer._input_s
+000234e0: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
+000234f0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00023500: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
+00023510: 7065 2c20 7475 706c 6529 2061 6e64 2061  pe, tuple) and a
+00023520: 6c6c 280d 0a20 2020 2020 2020 2020 2020  ll(..           
+00023530: 205b 6973 696e 7374 616e 6365 2864 2c20   [isinstance(d, 
+00023540: 6e75 6d62 6572 732e 496e 7465 6772 616c  numbers.Integral
+00023550: 2920 666f 7220 6420 696e 206c 6179 6572  ) for d in layer
+00023560: 2e5f 696e 7075 745f 7368 6170 655d 293a  ._input_shape]):
+00023570: 0d0a 2020 2020 2020 2020 6469 6d73 203d  ..        dims =
+00023580: 205b 6420 666f 7220 6420 696e 206c 6179   [d for d in lay
+00023590: 6572 2e5f 696e 7075 745f 7368 6170 655d  er._input_shape]
+000235a0: 0d0a 2020 2020 2020 2020 6469 6d73 2e69  ..        dims.i
+000235b0: 6e73 6572 7428 302c 204e 6f6e 6529 0d0a  nsert(0, None)..
+000235c0: 2020 2020 2020 2020 6c61 7965 722e 5f69          layer._i
+000235d0: 6e70 7574 5f73 6861 7065 203d 2054 656e  nput_shape = Ten
+000235e0: 736f 7253 6861 7065 2864 696d 7329 0d0a  sorShape(dims)..
+000235f0: 2020 2020 656c 6966 206c 6179 6572 2e5f      elif layer._
+00023600: 696e 7075 745f 7368 6170 6520 6973 206e  input_shape is n
+00023610: 6f74 204e 6f6e 6520 616e 6420 6973 696e  ot None and isin
+00023620: 7374 616e 6365 286c 6179 6572 2e5f 696e  stance(layer._in
+00023630: 7075 745f 7368 6170 652c 2074 7570 6c65  put_shape, tuple
+00023640: 293a 0d0a 2020 2020 2020 2020 6c61 7965  ):..        laye
+00023650: 722e 5f69 6e70 7574 5f73 6861 7065 203d  r._input_shape =
+00023660: 2074 7570 6c65 285b 5465 6e73 6f72 5368   tuple([TensorSh
+00023670: 6170 6528 746f 5f6e 756d 7079 2869 7465  ape(to_numpy(ite
+00023680: 6d29 2920 666f 7220 6974 656d 2069 6e20  m)) for item in 
+00023690: 5465 6e73 6f72 5368 6170 6528 6c61 7965  TensorShape(laye
+000236a0: 722e 5f69 6e70 7574 5f73 6861 7065 295d  r._input_shape)]
+000236b0: 290d 0a20 2020 2065 6c69 6620 6c61 7965  )..    elif laye
+000236c0: 722e 5f69 6e70 7574 5f73 6861 7065 2069  r._input_shape i
+000236d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
+000236e0: 735f 7465 6e73 6f72 286c 6179 6572 2e5f  s_tensor(layer._
+000236f0: 696e 7075 745f 7368 6170 6529 3a0d 0a20  input_shape):.. 
+00023700: 2020 2020 2020 2064 696d 7320 3d20 5b64         dims = [d
+00023710: 2e69 7465 6d28 2920 666f 7220 6420 696e  .item() for d in
+00023720: 206c 6179 6572 2e5f 696e 7075 745f 7368   layer._input_sh
+00023730: 6170 655d 0d0a 2020 2020 2020 2020 6469  ape]..        di
+00023740: 6d73 2e69 6e73 6572 7428 302c 204e 6f6e  ms.insert(0, Non
+00023750: 6529 0d0a 2020 2020 2020 2020 6275 6666  e)..        buff
+00023760: 6572 7320 3d20 6c61 7965 722e 5f5f 6469  ers = layer.__di
+00023770: 6374 5f5f 2e67 6574 2827 5f62 7566 6665  ct__.get('_buffe
+00023780: 7273 2729 0d0a 2020 2020 2020 2020 6966  rs')..        if
+00023790: 2027 5f69 6e70 7574 5f73 6861 7065 2720   '_input_shape' 
+000237a0: 696e 2062 7566 6665 7273 3a0d 0a20 2020  in buffers:..   
+000237b0: 2020 2020 2020 2020 2064 656c 2062 7566           del buf
+000237c0: 6665 7273 5b27 5f69 6e70 7574 5f73 6861  fers['_input_sha
+000237d0: 7065 275d 0d0a 2020 2020 2020 2020 6f62  pe']..        ob
+000237e0: 6a65 6374 2e5f 5f73 6574 6174 7472 5f5f  ject.__setattr__
+000237f0: 286c 6179 6572 2c20 275f 696e 7075 745f  (layer, '_input_
+00023800: 7368 6170 6527 2c20 5465 6e73 6f72 5368  shape', TensorSh
+00023810: 6170 6528 6469 6d73 2929 0d0a 2020 2020  ape(dims))..    
+00023820: 656c 6966 206c 6179 6572 2e5f 696e 7075  elif layer._inpu
+00023830: 745f 7368 6170 6520 6973 206e 6f74 204e  t_shape is not N
+00023840: 6f6e 6520 616e 6420 6e6f 7420 6973 696e  one and not isin
+00023850: 7374 616e 6365 286c 6179 6572 2e5f 696e  stance(layer._in
+00023860: 7075 745f 7368 6170 652c 2054 656e 736f  put_shape, Tenso
+00023870: 7253 6861 7065 293a 0d0a 2020 2020 2020  rShape):..      
+00023880: 2020 6c61 7965 722e 5f69 6e70 7574 5f73    layer._input_s
+00023890: 6861 7065 203d 2054 656e 736f 7253 6861  hape = TensorSha
+000238a0: 7065 2874 6f5f 6e75 6d70 7928 6c61 7965  pe(to_numpy(laye
+000238b0: 722e 5f69 6e70 7574 5f73 6861 7065 2929  r._input_shape))
+000238c0: 0d0a 2020 2020 656c 6966 206c 6179 6572  ..    elif layer
+000238d0: 2e5f 696e 7075 745f 7368 6170 6520 6973  ._input_shape is
+000238e0: 206e 6f74 204e 6f6e 6520 616e 6420 6973   not None and is
+000238f0: 696e 7374 616e 6365 286c 6179 6572 2e5f  instance(layer._
+00023900: 696e 7075 745f 7368 6170 652c 2054 656e  input_shape, Ten
+00023910: 736f 7253 6861 7065 2920 616e 6420 6973  sorShape) and is
+00023920: 5f74 656e 736f 7228 0d0a 2020 2020 2020  _tensor(..      
+00023930: 2020 2020 2020 6c61 7965 722e 5f69 6e70        layer._inp
+00023940: 7574 5f73 6861 7065 2e64 696d 735b 305d  ut_shape.dims[0]
+00023950: 293a 0d0a 2020 2020 2020 2020 6c61 7965  ):..        laye
+00023960: 722e 5f69 6e70 7574 5f73 6861 7065 203d  r._input_shape =
+00023970: 2054 656e 736f 7253 6861 7065 285b 642e   TensorShape([d.
+00023980: 6974 656d 2829 2066 6f72 2064 2069 6e20  item() for d in 
+00023990: 6c61 7965 722e 5f69 6e70 7574 5f73 6861  layer._input_sha
+000239a0: 7065 2e64 696d 735d 290d 0a0d 0a20 2020  pe.dims])....   
+000239b0: 2069 6620 6c61 7965 722e 5f6f 7574 7075   if layer._outpu
+000239c0: 745f 7368 6170 6520 6973 206e 6f74 204e  t_shape is not N
+000239d0: 6f6e 6520 616e 6420 6973 696e 7374 616e  one and isinstan
+000239e0: 6365 286c 6179 6572 2e5f 6f75 7470 7574  ce(layer._output
+000239f0: 5f73 6861 7065 2c20 7475 706c 6529 2061  _shape, tuple) a
+00023a00: 6e64 2061 6c6c 280d 0a20 2020 2020 2020  nd all(..       
+00023a10: 2020 2020 205b 6973 696e 7374 616e 6365       [isinstance
+00023a20: 2864 2c20 6e75 6d62 6572 732e 496e 7465  (d, numbers.Inte
+00023a30: 6772 616c 2920 666f 7220 6420 696e 206c  gral) for d in l
+00023a40: 6179 6572 2e5f 6f75 7470 7574 5f73 6861  ayer._output_sha
+00023a50: 7065 5d29 3a0d 0a20 2020 2020 2020 2064  pe]):..        d
+00023a60: 696d 7320 3d20 5b64 2066 6f72 2064 2069  ims = [d for d i
+00023a70: 6e20 6c61 7965 722e 5f69 6e70 7574 5f73  n layer._input_s
+00023a80: 6861 7065 5d0d 0a20 2020 2020 2020 2064  hape]..        d
+00023a90: 696d 732e 696e 7365 7274 2830 2c20 4e6f  ims.insert(0, No
+00023aa0: 6e65 290d 0a20 2020 2020 2020 206c 6179  ne)..        lay
+00023ab0: 6572 2e5f 696e 7075 745f 7368 6170 6520  er._input_shape 
+00023ac0: 3d20 5465 6e73 6f72 5368 6170 6528 6469  = TensorShape(di
+00023ad0: 6d73 290d 0a20 2020 2065 6c69 6620 6c61  ms)..    elif la
+00023ae0: 7965 722e 5f6f 7574 7075 745f 7368 6170  yer._output_shap
+00023af0: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+00023b00: 6420 6973 696e 7374 616e 6365 286c 6179  d isinstance(lay
+00023b10: 6572 2e5f 6f75 7470 7574 5f73 6861 7065  er._output_shape
+00023b20: 2c20 7475 706c 6529 3a0d 0a20 2020 2020  , tuple):..     
+00023b30: 2020 206c 6179 6572 2e5f 6f75 7470 7574     layer._output
+00023b40: 5f73 6861 7065 203d 2074 7570 6c65 285b  _shape = tuple([
+00023b50: 5465 6e73 6f72 5368 6170 6528 746f 5f6e  TensorShape(to_n
+00023b60: 756d 7079 2869 7465 6d29 2920 666f 7220  umpy(item)) for 
+00023b70: 6974 656d 2069 6e20 5465 6e73 6f72 5368  item in TensorSh
+00023b80: 6170 6528 6c61 7965 722e 5f6f 7574 7075  ape(layer._outpu
+00023b90: 745f 7368 6170 6529 5d29 0d0a 2020 2020  t_shape)])..    
+00023ba0: 656c 6966 206c 6179 6572 2e5f 6f75 7470  elif layer._outp
+00023bb0: 7574 5f73 6861 7065 2069 7320 6e6f 7420  ut_shape is not 
+00023bc0: 4e6f 6e65 2061 6e64 2069 735f 7465 6e73  None and is_tens
+00023bd0: 6f72 286c 6179 6572 2e5f 6f75 7470 7574  or(layer._output
+00023be0: 5f73 6861 7065 293a 0d0a 2020 2020 2020  _shape):..      
+00023bf0: 2020 6469 6d73 203d 205b 642e 6974 656d    dims = [d.item
+00023c00: 2829 2066 6f72 2064 2069 6e20 6c61 7965  () for d in laye
+00023c10: 722e 5f6f 7574 7075 745f 7368 6170 655d  r._output_shape]
+00023c20: 0d0a 2020 2020 2020 2020 6469 6d73 2e69  ..        dims.i
+00023c30: 6e73 6572 7428 302c 204e 6f6e 6529 0d0a  nsert(0, None)..
+00023c40: 2020 2020 2020 2020 6275 6666 6572 7320          buffers 
+00023c50: 3d20 6c61 7965 722e 5f5f 6469 6374 5f5f  = layer.__dict__
+00023c60: 2e67 6574 2827 5f62 7566 6665 7273 2729  .get('_buffers')
+00023c70: 0d0a 2020 2020 2020 2020 6966 2027 5f69  ..        if '_i
+00023c80: 6e70 7574 5f73 6861 7065 2720 696e 2062  nput_shape' in b
+00023c90: 7566 6665 7273 3a0d 0a20 2020 2020 2020  uffers:..       
+00023ca0: 2020 2020 2064 656c 2062 7566 6665 7273       del buffers
+00023cb0: 5b27 5f6f 7574 7075 745f 7368 6170 6527  ['_output_shape'
+00023cc0: 5d0d 0a20 2020 2020 2020 206f 626a 6563  ]..        objec
+00023cd0: 742e 5f5f 7365 7461 7474 725f 5f28 6c61  t.__setattr__(la
+00023ce0: 7965 722c 2027 5f6f 7574 7075 745f 7368  yer, '_output_sh
+00023cf0: 6170 6527 2c20 5465 6e73 6f72 5368 6170  ape', TensorShap
+00023d00: 6528 6469 6d73 2929 0d0a 2020 2020 656c  e(dims))..    el
+00023d10: 6966 206c 6179 6572 2e5f 6f75 7470 7574  if layer._output
+00023d20: 5f73 6861 7065 2069 7320 6e6f 7420 4e6f  _shape is not No
+00023d30: 6e65 2061 6e64 206e 6f74 2069 7369 6e73  ne and not isins
+00023d40: 7461 6e63 6528 6c61 7965 722e 5f6f 7574  tance(layer._out
+00023d50: 7075 745f 7368 6170 652c 2054 656e 736f  put_shape, Tenso
+00023d60: 7253 6861 7065 293a 0d0a 2020 2020 2020  rShape):..      
+00023d70: 2020 6c61 7965 722e 5f6f 7574 7075 745f    layer._output_
+00023d80: 7368 6170 6520 3d20 5465 6e73 6f72 5368  shape = TensorSh
+00023d90: 6170 6528 6c61 7965 722e 5f6f 7574 7075  ape(layer._outpu
+00023da0: 745f 7368 6170 6529 0d0a 2020 2020 656c  t_shape)..    el
+00023db0: 6966 206c 6179 6572 2e5f 6f75 7470 7574  if layer._output
+00023dc0: 5f73 6861 7065 2069 7320 6e6f 7420 4e6f  _shape is not No
+00023dd0: 6e65 2061 6e64 2069 7369 6e73 7461 6e63  ne and isinstanc
+00023de0: 6528 6c61 7965 722e 5f6f 7574 7075 745f  e(layer._output_
+00023df0: 7368 6170 652c 2054 656e 736f 7253 6861  shape, TensorSha
+00023e00: 7065 2920 616e 6420 6973 696e 7374 616e  pe) and isinstan
+00023e10: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00023e20: 206c 6179 6572 2e5f 6f75 7470 7574 5f73   layer._output_s
+00023e30: 6861 7065 2e64 696d 735b 305d 2c20 7466  hape.dims[0], tf
+00023e40: 2e54 656e 736f 7253 6861 7065 2920 616e  .TensorShape) an
+00023e50: 6420 6c65 6e28 6c61 7965 722e 5f6f 7574  d len(layer._out
+00023e60: 7075 745f 7368 6170 652e 6469 6d73 5b30  put_shape.dims[0
+00023e70: 5d29 203d 3d20 313a 0d0a 2020 2020 2020  ]) == 1:..      
+00023e80: 2020 6c61 7965 722e 5f6f 7574 7075 745f    layer._output_
+00023e90: 7368 6170 6520 3d20 5465 6e73 6f72 5368  shape = TensorSh
+00023ea0: 6170 6528 5b4e 6f6e 6520 6966 2064 2069  ape([None if d i
+00023eb0: 7320 4e6f 6e65 2065 6c73 6520 645b 305d  s None else d[0]
+00023ec0: 2066 6f72 2064 2069 6e20 6c61 7965 722e   for d in layer.
+00023ed0: 5f6f 7574 7075 745f 7368 6170 652e 6469  _output_shape.di
+00023ee0: 6d73 5d29 0d0a 2020 2020 656c 6966 206c  ms])..    elif l
+00023ef0: 6179 6572 2e5f 6f75 7470 7574 5f73 6861  ayer._output_sha
+00023f00: 7065 2069 7320 6e6f 7420 4e6f 6e65 2061  pe is not None a
+00023f10: 6e64 2069 7369 6e73 7461 6e63 6528 6c61  nd isinstance(la
+00023f20: 7965 722e 5f6f 7574 7075 745f 7368 6170  yer._output_shap
+00023f30: 652c 2054 656e 736f 7253 6861 7065 2920  e, TensorShape) 
+00023f40: 616e 6420 6973 696e 7374 616e 6365 280d  and isinstance(.
+00023f50: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00023f60: 6572 2e5f 6f75 7470 7574 5f73 6861 7065  er._output_shape
+00023f70: 2e64 696d 735b 305d 2c20 7466 2e54 656e  .dims[0], tf.Ten
+00023f80: 736f 7253 6861 7065 293a 0d0a 2020 2020  sorShape):..    
+00023f90: 2020 2020 6c61 7965 722e 5f6f 7574 7075      layer._outpu
+00023fa0: 745f 7368 6170 6520 3d20 7475 706c 6528  t_shape = tuple(
+00023fb0: 5b54 656e 736f 7253 6861 7065 2874 6f5f  [TensorShape(to_
+00023fc0: 6e75 6d70 7928 6429 2920 666f 7220 6420  numpy(d)) for d 
+00023fd0: 696e 206c 6179 6572 2e5f 6f75 7470 7574  in layer._output
+00023fe0: 5f73 6861 7065 2e64 696d 735d 290d 0a0d  _shape.dims])...
+00023ff0: 0a20 2020 2069 6620 6e6f 7420 6861 7361  .    if not hasa
+00024000: 7474 7228 6c61 7965 722c 2027 6765 745f  ttr(layer, 'get_
+00024010: 726f 6f74 2729 3a0d 0a20 2020 2020 2020  root'):..       
+00024020: 2073 6574 6174 7472 286c 6179 6572 2c20   setattr(layer, 
+00024030: 2767 6574 5f72 6f6f 7427 2c20 4d65 7468  'get_root', Meth
+00024040: 6f64 5479 7065 2867 6574 5f72 6f6f 742c  odType(get_root,
+00024050: 206c 6179 6572 2929 0d0a 0d0a 2020 2020   layer))....    
+00024060: 666f 7220 6d6f 6475 6c65 2069 6e20 6c61  for module in la
+00024070: 7965 722e 6d6f 6475 6c65 7328 293a 0d0a  yer.modules():..
+00024080: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
+00024090: 6173 6174 7472 286d 6f64 756c 652c 2027  asattr(module, '
+000240a0: 5f5f 7369 676e 6174 7572 655f 5f27 293a  __signature__'):
+000240b0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+000240c0: 6475 6c65 2e5f 5f73 6967 6e61 7475 7265  dule.__signature
+000240d0: 5f5f 203d 2069 6e73 7065 6374 2e73 6967  __ = inspect.sig
+000240e0: 6e61 7475 7265 286d 6f64 756c 652e 666f  nature(module.fo
+000240f0: 7277 6172 6429 0d0a 2020 2020 2020 2020  rward)..        
+00024100: 636c 6173 735f 6e61 6d65 203d 206d 6f64  class_name = mod
+00024110: 756c 652e 5f5f 636c 6173 735f 5f2e 5f5f  ule.__class__.__
+00024120: 6e61 6d65 5f5f 0d0a 2020 2020 2020 2020  name__..        
+00024130: 6966 206e 6f74 2068 6173 6174 7472 286c  if not hasattr(l
+00024140: 6179 6572 2c20 2767 6574 5f72 6f6f 7427  ayer, 'get_root'
+00024150: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00024160: 7365 7461 7474 7228 6c61 7965 722c 2027  setattr(layer, '
+00024170: 6765 745f 726f 6f74 272c 204d 6574 686f  get_root', Metho
+00024180: 6454 7970 6528 6765 745f 726f 6f74 2c20  dType(get_root, 
+00024190: 6c61 7965 7229 290d 0a0d 0a20 2020 2020  layer))....     
+000241a0: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+000241b0: 7228 6d6f 6475 6c65 2c20 275f 7374 6174  r(module, '_stat
+000241c0: 655f 6469 6374 5f70 7265 5f68 6f6f 6b73  e_dict_pre_hooks
+000241d0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+000241e0: 206f 626a 6563 742e 5f5f 7365 7461 7474   object.__setatt
+000241f0: 725f 5f28 6d6f 6475 6c65 2c20 275f 666f  r__(module, '_fo
+00024200: 7277 6172 645f 686f 6f6b 735f 7769 7468  rward_hooks_with
+00024210: 5f6b 7761 7267 7327 2c20 4f72 6465 7265  _kwargs', Ordere
+00024220: 6444 6963 7428 2929 0d0a 2020 2020 2020  dDict())..      
+00024230: 2020 2020 2020 6f62 6a65 6374 2e5f 5f73        object.__s
+00024240: 6574 6174 7472 5f5f 286d 6f64 756c 652c  etattr__(module,
+00024250: 2027 5f66 6f72 7761 7264 5f70 7265 5f68   '_forward_pre_h
+00024260: 6f6f 6b73 5f77 6974 685f 6b77 6172 6773  ooks_with_kwargs
+00024270: 272c 204f 7264 6572 6564 4469 6374 2829  ', OrderedDict()
+00024280: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+00024290: 626a 6563 742e 5f5f 7365 7461 7474 725f  bject.__setattr_
+000242a0: 5f28 6d6f 6475 6c65 2c20 275f 7374 6174  _(module, '_stat
+000242b0: 655f 6469 6374 5f70 7265 5f68 6f6f 6b73  e_dict_pre_hooks
+000242c0: 272c 204f 7264 6572 6564 4469 6374 2829  ', OrderedDict()
+000242d0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+000242e0: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
+000242f0: 6c65 2c20 2775 7569 6427 293a 0d0a 2020  le, 'uuid'):..  
+00024300: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+00024310: 2e75 7569 6420 3d20 7575 6964 2e75 7569  .uuid = uuid.uui
+00024320: 6434 2829 2e6e 6f64 650d 0a20 2020 2020  d4().node..     
+00024330: 2020 2023 2063 6865 636b 2066 6f72 2072     # check for r
+00024340: 6f6f 740d 0a20 2020 2020 2020 2069 6620  oot..        if 
+00024350: 6d6f 6475 6c65 2e75 7569 6420 3d3d 206c  module.uuid == l
+00024360: 6179 6572 2e75 7569 643a 0d0a 2020 2020  ayer.uuid:..    
+00024370: 2020 2020 2020 2020 6d6f 6475 6c65 2e69          module.i
+00024380: 735f 726f 6f74 203d 2054 7275 650d 0a20  s_root = True.. 
+00024390: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000243a0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+000243b0: 2e69 735f 726f 6f74 203d 2046 616c 7365  .is_root = False
+000243c0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+000243d0: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
+000243e0: 2027 7265 6c61 7469 7665 5f6e 616d 6527   'relative_name'
+000243f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00024400: 6d6f 6475 6c65 2e72 656c 6174 6976 655f  module.relative_
+00024410: 6e61 6d65 203d 2027 270d 0a20 2020 2020  name = ''..     
+00024420: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00024430: 7228 6d6f 6475 6c65 2c20 275f 7569 645f  r(module, '_uid_
+00024440: 7072 6566 6978 7327 293a 0d0a 2020 2020  prefixs'):..    
+00024450: 2020 2020 2020 2020 6d6f 6475 6c65 2e5f          module._
+00024460: 7569 645f 7072 6566 6978 7320 3d20 6c61  uid_prefixs = la
+00024470: 7965 722e 6765 745f 726f 6f74 2829 2e5f  yer.get_root()._
+00024480: 7569 645f 7072 6566 6978 730d 0a0d 0a20  uid_prefixs.... 
+00024490: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+000244a0: 7361 7474 7228 6d6f 6475 6c65 2c20 2764  sattr(module, 'd
+000244b0: 6566 6175 6c74 5f6e 616d 6527 2920 6f72  efault_name') or
+000244c0: 2028 6d6f 6475 6c65 2e64 6566 6175 6c74   (module.default
+000244d0: 5f6e 616d 6520 6973 204e 6f6e 6520 6f72  _name is None or
+000244e0: 206c 656e 286d 6f64 756c 652e 6465 6661   len(module.defa
+000244f0: 756c 745f 6e61 6d65 2920 3d3d 2030 293a  ult_name) == 0):
+00024500: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00024510: 6475 6c65 5f70 7265 6669 7820 3d20 6d6f  dule_prefix = mo
+00024520: 6475 6c65 2e5f 5f63 6c61 7373 5f5f 2e5f  dule.__class__._
+00024530: 5f6e 616d 655f 5f0d 0a20 2020 2020 2020  _name__..       
+00024540: 2020 2020 206d 6f64 756c 652e 6465 6661       module.defa
+00024550: 756c 745f 6e61 6d65 203d 2063 616d 656c  ult_name = camel
+00024560: 3273 6e61 6b65 286d 6f64 756c 655f 7072  2snake(module_pr
+00024570: 6566 6978 2920 2b20 275f 2720 2b20 7374  efix) + '_' + st
+00024580: 7228 6765 745f 676c 6f62 616c 5f75 6964  r(get_global_uid
+00024590: 2863 616d 656c 3273 6e61 6b65 286d 6f64  (camel2snake(mod
+000245a0: 756c 655f 7072 6566 6978 2929 290d 0a0d  ule_prefix)))...
+000245b0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000245c0: 6861 7361 7474 7228 6d6f 6475 6c65 2c20  hasattr(module, 
+000245d0: 275f 6e61 6d65 2729 3a0d 0a20 2020 2020  '_name'):..     
+000245e0: 2020 2020 2020 206d 6f64 756c 652e 5f6e         module._n
+000245f0: 616d 6520 3d20 4e6f 6e65 0d0a 2020 2020  ame = None..    
+00024600: 2020 2020 7265 7365 745f 6e61 6d65 286d      reset_name(m
+00024610: 6f64 756c 652c 206c 6179 6572 2e67 6574  odule, layer.get
+00024620: 5f72 6f6f 7428 292e 5f75 6964 5f70 7265  _root()._uid_pre
+00024630: 6669 7873 290d 0a0d 0a20 2020 2020 2020  fixs)....       
+00024640: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00024650: 6d6f 6475 6c65 2c20 276e 616d 6527 293a  module, 'name'):
+00024660: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00024670: 6475 6c65 2e6e 616d 6520 3d20 6d6f 6475  dule.name = modu
+00024680: 6c65 2e5f 6e61 6d65 2069 6620 6d6f 6475  le._name if modu
+00024690: 6c65 2e5f 6e61 6d65 2069 7320 6e6f 7420  le._name is not 
+000246a0: 4e6f 6e65 2061 6e64 206c 656e 286d 6f64  None and len(mod
+000246b0: 756c 652e 5f6e 616d 6529 203e 2030 2065  ule._name) > 0 e
+000246c0: 6c73 6520 6d6f 6475 6c65 2e72 656c 6174  lse module.relat
+000246d0: 6976 655f 6e61 6d65 0d0a 0d0a 2020 2020  ive_name....    
+000246e0: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
+000246f0: 7472 286d 6f64 756c 652c 2027 5f62 7569  tr(module, '_bui
+00024700: 6c74 2729 3a0d 0a20 2020 2020 2020 2020  lt'):..         
+00024710: 2020 2073 6574 6174 7472 286d 6f64 756c     setattr(modul
+00024720: 652c 2027 6275 696c 7427 2c20 5472 7565  e, 'built', True
+00024730: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00024740: 6861 7361 7474 7228 6d6f 6475 6c65 2c20  hasattr(module, 
+00024750: 276b 6565 7064 696d 2729 3a0d 0a20 2020  'keepdim'):..   
+00024760: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+00024770: 2067 6574 6174 7472 286d 6f64 756c 652c   getattr(module,
+00024780: 2027 6b65 6570 6469 6d27 290d 0a20 2020   'keepdim')..   
+00024790: 2020 2020 2020 2020 2064 656c 6174 7472           delattr
+000247a0: 286d 6f64 756c 652c 2027 6b65 6570 6469  (module, 'keepdi
+000247b0: 6d27 290d 0a20 2020 2020 2020 2020 2020  m')..           
+000247c0: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+000247d0: 2027 6b65 6570 6469 6d73 272c 2076 616c   'keepdims', val
+000247e0: 7565 290d 0a0d 0a20 2020 2020 2020 2069  ue)....        i
+000247f0: 6620 6e6f 7420 6861 7361 7474 7228 6d6f  f not hasattr(mo
+00024800: 6475 6c65 2c20 275f 6e6f 6e5f 7065 7273  dule, '_non_pers
+00024810: 6973 7465 6e74 5f62 7566 6665 7273 5f73  istent_buffers_s
+00024820: 6574 2729 3a0d 0a20 2020 2020 2020 2020  et'):..         
+00024830: 2020 206d 6f64 756c 652e 5f6e 6f6e 5f70     module._non_p
+00024840: 6572 7369 7374 656e 745f 6275 6666 6572  ersistent_buffer
+00024850: 735f 7365 7420 3d20 7365 7428 290d 0a0d  s_set = set()...
+00024860: 0a20 2020 2020 2020 2023 2066 6978 2066  .        # fix f
+00024870: 6f72 2073 6861 7065 2064 6566 696e 6974  or shape definit
+00024880: 696f 6e0d 0a20 2020 2020 2020 2023 2069  ion..        # i
+00024890: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+000248a0: 286d 6f64 756c 652e 5f69 6e70 7574 5f73  (module._input_s
+000248b0: 6861 7065 2c20 5465 6e73 6f72 5368 6170  hape, TensorShap
+000248c0: 6529 3a0d 0a20 2020 2020 2020 2023 2020  e):..        #  
+000248d0: 2020 206d 6f64 756c 652e 5f69 6e70 7574     module._input
+000248e0: 5f73 6861 7065 203d 2054 656e 736f 7253  _shape = TensorS
+000248f0: 6861 7065 2874 6f5f 6e75 6d70 7928 6d6f  hape(to_numpy(mo
+00024900: 6475 6c65 2e5f 696e 7075 745f 7368 6170  dule._input_shap
+00024910: 6529 290d 0a20 2020 2020 2020 2023 0d0a  e))..        #..
+00024920: 2020 2020 2020 2020 2320 6966 206e 6f74          # if not
+00024930: 2069 7369 6e73 7461 6e63 6528 6d6f 6475   isinstance(modu
+00024940: 6c65 2e5f 6f75 7470 7574 5f73 6861 7065  le._output_shape
+00024950: 2c20 5465 6e73 6f72 5368 6170 6529 3a0d  , TensorShape):.
+00024960: 0a20 2020 2020 2020 2023 2020 2020 206d  .        #     m
+00024970: 6f64 756c 652e 5f6f 7574 7075 745f 7368  odule._output_sh
+00024980: 6170 6520 3d20 5465 6e73 6f72 5368 6170  ape = TensorShap
+00024990: 6528 746f 5f6e 756d 7079 286d 6f64 756c  e(to_numpy(modul
+000249a0: 652e 5f6f 7574 7075 745f 7368 6170 6529  e._output_shape)
+000249b0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+000249c0: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
+000249d0: 6c65 2c20 2762 6174 6368 5f69 6e64 6578  le, 'batch_index
+000249e0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+000249f0: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+00024a00: 2027 6261 7463 685f 696e 6465 7827 2c20   'batch_index', 
+00024a10: 3029 0d0a 2020 2020 2020 2020 6966 206e  0)..        if n
+00024a20: 6f74 2068 6173 6174 7472 286d 6f64 756c  ot hasattr(modul
+00024a30: 652c 2027 6669 6c74 6572 5f69 6e64 6578  e, 'filter_index
+00024a40: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00024a50: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+00024a60: 2027 6669 6c74 6572 5f69 6e64 6578 272c   'filter_index',
+00024a70: 2031 290d 0a20 2020 2020 2020 2069 6620   1)..        if 
+00024a80: 6e6f 7420 6861 7361 7474 7228 6d6f 6475  not hasattr(modu
+00024a90: 6c65 2c20 2769 6e5f 7365 7175 656e 6365  le, 'in_sequence
+00024aa0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00024ab0: 2073 6574 6174 7472 286d 6f64 756c 652c   setattr(module,
+00024ac0: 2027 696e 5f73 6571 7565 6e63 6527 2c20   'in_sequence', 
+00024ad0: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+00024ae0: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00024af0: 286d 6f64 756c 652c 2027 696e 5f73 6571  (module, 'in_seq
+00024b00: 7565 6e63 6527 293a 0d0a 2020 2020 2020  uence'):..      
+00024b10: 2020 2020 2020 6966 2027 6c73 746d 2720        if 'lstm' 
+00024b20: 696e 2063 6c61 7373 5f6e 616d 652e 6c6f  in class_name.lo
+00024b30: 7765 7228 2920 6f72 2027 6772 7527 2069  wer() or 'gru' i
+00024b40: 6e20 636c 6173 735f 6e61 6d65 2e6c 6f77  n class_name.low
+00024b50: 6572 2829 206f 7220 2772 6e6e 2720 696e  er() or 'rnn' in
+00024b60: 2063 6c61 7373 5f6e 616d 652e 6c6f 7765   class_name.lowe
+00024b70: 7228 293a 0d0a 2020 2020 2020 2020 2020  r():..          
+00024b80: 2020 2020 2020 6d6f 6475 6c65 2e69 6e5f        module.in_
+00024b90: 7365 7175 656e 6365 203d 2054 7275 650d  sequence = True.
+00024ba0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00024bb0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00024bc0: 2020 2020 6d6f 6475 6c65 2e69 6e5f 7365      module.in_se
+00024bd0: 7175 656e 6365 203d 2046 616c 7365 0d0a  quence = False..
+00024be0: 0d0a 2020 2020 2020 2020 6966 2027 436f  ..        if 'Co
+00024bf0: 6e76 2720 696e 2063 6c61 7373 5f6e 616d  nv' in class_nam
+00024c00: 6520 616e 6420 2742 6c6f 636b 2720 696e  e and 'Block' in
+00024c10: 2063 6c61 7373 5f6e 616d 653a 0d0a 2020   class_name:..  
+00024c20: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00024c30: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
+00024c40: 2027 7365 7175 656e 6365 5f72 616e 6b27   'sequence_rank'
+00024c50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00024c60: 2020 2020 6d6f 6475 6c65 2e73 6571 7565      module.seque
+00024c70: 6e63 655f 7261 6e6b 203d 2027 636e 6127  nce_rank = 'cna'
+00024c80: 0d0a 0d0a 2020 2020 2020 2020 6966 2027  ....        if '
+00024c90: 436f 6e76 2720 696e 2063 6c61 7373 5f6e  Conv' in class_n
+00024ca0: 616d 653a 0d0a 2020 2020 2020 2020 2020  ame:..          
+00024cb0: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00024cc0: 286d 6f64 756c 652c 2027 6465 7074 685f  (module, 'depth_
+00024cd0: 6d75 6c74 6970 6c69 6572 2729 3a0d 0a20  multiplier'):.. 
+00024ce0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00024cf0: 6620 2744 6570 7468 7769 7365 2720 696e  f 'Depthwise' in
+00024d00: 2063 6c61 7373 5f6e 616d 6520 6f72 2027   class_name or '
+00024d10: 5365 7061 7261 626c 6527 2069 6e20 636c  Separable' in cl
+00024d20: 6173 735f 6e61 6d65 3a0d 0a20 2020 2020  ass_name:..     
+00024d30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00024d40: 6f64 756c 652e 6465 7074 685f 6d75 6c74  odule.depth_mult
+00024d50: 6970 6c69 6572 203d 2031 0d0a 2020 2020  iplier = 1..    
+00024d60: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00024d70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00024d80: 2020 2020 2020 206d 6f64 756c 652e 6465         module.de
+00024d90: 7074 685f 6d75 6c74 6970 6c69 6572 203d  pth_multiplier =
+00024da0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+00024db0: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00024dc0: 7228 6d6f 6475 6c65 2c20 2775 7365 5f73  r(module, 'use_s
+00024dd0: 7065 6374 7261 6c27 293a 0d0a 2020 2020  pectral'):..    
+00024de0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+00024df0: 6c65 2e75 7365 5f73 7065 6374 7261 6c20  le.use_spectral 
+00024e00: 3d20 4661 6c73 650d 0a0d 0a20 2020 2069  = False....    i
+00024e10: 6620 6c61 7965 722e 6973 5f72 6f6f 7420  f layer.is_root 
+00024e20: 3d3d 2054 7275 6520 616e 6420 280d 0a20  == True and (.. 
+00024e30: 2020 2020 2020 2020 2020 206e 6f74 2068             not h
+00024e40: 6173 6174 7472 286c 6179 6572 2c20 275f  asattr(layer, '_
+00024e50: 7369 676e 6174 7572 6527 2920 6f72 206c  signature') or l
+00024e60: 6179 6572 2e5f 7369 676e 6174 7572 6520  ayer._signature 
+00024e70: 6973 204e 6f6e 6520 6f72 206c 656e 286c  is None or len(l
+00024e80: 6179 6572 2e5f 7369 676e 6174 7572 652e  ayer._signature.
+00024e90: 696e 7075 7473 2920 3d3d 2030 293a 0d0a  inputs) == 0):..
+00024ea0: 2020 2020 2020 2020 6c61 7965 722e 5f73          layer._s
+00024eb0: 6967 6e61 7475 7265 203d 204e 6f6e 650d  ignature = None.
+00024ec0: 0a20 2020 2020 2020 2023 2069 6620 6c61  .        # if la
+00024ed0: 7965 722e 5f69 6e70 7574 5f73 6861 7065  yer._input_shape
+00024ee0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00024ef0: 2020 2020 2020 2023 2020 2020 2069 6620         #     if 
+00024f00: 6973 696e 7374 616e 6365 286c 6179 6572  isinstance(layer
+00024f10: 2e5f 696e 7075 745f 7368 6170 652c 2054  ._input_shape, T
+00024f20: 656e 736f 7253 7065 6329 3a0d 0a20 2020  ensorSpec):..   
+00024f30: 2020 2020 2023 2020 2020 2020 2020 206c       #         l
+00024f40: 6179 6572 2e5f 7369 676e 6174 7572 652e  ayer._signature.
+00024f50: 696e 7075 7473 5b22 696e 7075 7422 5d20  inputs["input"] 
+00024f60: 3d20 5465 6e73 6f72 5370 6563 2873 6861  = TensorSpec(sha
+00024f70: 7065 3d6c 6179 6572 2e5f 696e 7075 745f  pe=layer._input_
+00024f80: 7368 6170 652c 206e 616d 653d 2269 6e70  shape, name="inp
+00024f90: 7574 2229 0d0a 2020 2020 2020 2020 2320  ut")..        # 
+00024fa0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00024fb0: 6e63 6528 6c61 7965 722e 5f69 6e70 7574  nce(layer._input
+00024fc0: 5f73 6861 7065 2c20 7475 706c 6529 3a0d  _shape, tuple):.
+00024fd0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+00024fe0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00024ff0: 6528 6c65 6e28 6c61 7965 722e 5f69 6e70  e(len(layer._inp
+00025000: 7574 5f73 6861 7065 2929 3a0d 0a20 2020  ut_shape)):..   
+00025010: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+00025020: 2020 206c 6179 6572 2e5f 7369 676e 6174     layer._signat
+00025030: 7572 652e 696e 7075 7473 5b22 696e 7075  ure.inputs["inpu
+00025040: 745f 7b30 7d22 2e66 6f72 6d61 7428 6929  t_{0}".format(i)
+00025050: 5d20 3d20 5465 6e73 6f72 5370 6563 2873  ] = TensorSpec(s
+00025060: 6861 7065 3d6c 6179 6572 2e5f 696e 7075  hape=layer._inpu
+00025070: 745f 7368 6170 655b 695d 2c20 6e61 6d65  t_shape[i], name
+00025080: 3d22 696e 7075 745f 7b30 7d22 2e66 6f72  ="input_{0}".for
+00025090: 6d61 7428 6929 290d 0a20 2020 2020 2020  mat(i))..       
+000250a0: 2023 2069 6620 6c61 7965 722e 5f6f 7574   # if layer._out
+000250b0: 7075 745f 7368 6170 6520 6973 206e 6f74  put_shape is not
+000250c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000250d0: 230d 0a20 2020 2020 2020 2023 2020 2020  #..        #    
+000250e0: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
+000250f0: 6179 6572 2e5f 6f75 7470 7574 5f73 6861  ayer._output_sha
+00025100: 7065 2c20 5465 6e73 6f72 5370 6563 293a  pe, TensorSpec):
+00025110: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00025120: 2020 2020 6c61 7965 722e 5f73 6967 6e61      layer._signa
+00025130: 7475 7265 2e6f 7574 7075 7473 5b22 6f75  ture.outputs["ou
+00025140: 7470 7574 225d 203d 2054 656e 736f 7253  tput"] = TensorS
+00025150: 7065 6328 7368 6170 653d 6c61 7965 722e  pec(shape=layer.
+00025160: 5f6f 7574 7075 745f 7368 6170 652c 206e  _output_shape, n
+00025170: 616d 653d 226f 7574 7075 7422 290d 0a20  ame="output").. 
+00025180: 2020 2020 2020 2023 2020 2020 2065 6c69         #     eli
+00025190: 6620 6973 696e 7374 616e 6365 286c 6179  f isinstance(lay
+000251a0: 6572 2e5f 6f75 7470 7574 5f73 6861 7065  er._output_shape
+000251b0: 2c20 7475 706c 6529 3a0d 0a20 2020 2020  , tuple):..     
+000251c0: 2020 2023 2020 2020 2020 2020 2066 6f72     #         for
+000251d0: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+000251e0: 6c61 7965 722e 5f6f 7574 7075 745f 7368  layer._output_sh
+000251f0: 6170 6529 293a 0d0a 2020 2020 2020 2020  ape)):..        
+00025200: 2320 2020 2020 2020 2020 2020 2020 6c61  #             la
+00025210: 7965 722e 5f73 6967 6e61 7475 7265 2e6f  yer._signature.o
+00025220: 7574 7075 7473 5b22 6f75 7470 7574 5f7b  utputs["output_{
+00025230: 307d 222e 666f 726d 6174 2869 295d 203d  0}".format(i)] =
+00025240: 2054 656e 736f 7253 7065 6328 7368 6170   TensorSpec(shap
+00025250: 653d 6c61 7965 722e 5f6f 7574 7075 745f  e=layer._output_
+00025260: 7368 6170 655b 695d 2c20 6e61 6d65 3d22  shape[i], name="
+00025270: 6f75 7470 7574 5f7b 307d 222e 666f 726d  output_{0}".form
+00025280: 6174 2869 2929 0d0a 2020 2020 2020 2020  at(i))..        
+00025290: 230d 0a0d 0a20 2020 2020 2020 2073 6967  #....        sig
+000252a0: 203d 206c 6179 6572 2e73 6967 6e61 7475   = layer.signatu
+000252b0: 7265 0d0a 0d0a 2020 2020 7265 7475 726e  re....    return
+000252c0: 206c 6179 6572 0d0a 0d0a 0d0a 6465 6620   layer......def 
+000252d0: 6669 785f 6b65 7261 735f 6d6f 6475 6c65  fix_keras_module
+000252e0: 286d 6f64 756c 653a 2074 662e 4d6f 6475  (module: tf.Modu
+000252f0: 6c65 2c20 696e 7075 745f 7465 6e73 6f72  le, input_tensor
+00025300: 3a20 5465 6e73 6f72 203d 204e 6f6e 652c  : Tensor = None,
+00025310: 2069 6e70 7574 5f73 6861 7065 3a20 2874   input_shape: (t
+00025320: 7570 6c65 2c20 5465 6e73 6f72 5368 6170  uple, TensorShap
+00025330: 6529 203d 204e 6f6e 6529 3a0d 0a20 2020  e) = None):..   
+00025340: 2069 6d70 6f72 7420 7465 6e73 6f72 666c   import tensorfl
+00025350: 6f77 2e70 7974 686f 6e2e 6b65 7261 732e  ow.python.keras.
+00025360: 6261 636b 656e 6420 6173 204b 0d0a 2020  backend as K..  
+00025370: 2020 6465 6620 6e61 6d65 645f 6d6f 6475    def named_modu
+00025380: 6c65 7328 6b65 7261 735f 6d6f 6465 6c2c  les(keras_model,
+00025390: 206d 656d 6f3d 4e6f 6e65 2c20 7072 6566   memo=None, pref
+000253a0: 6978 3d27 2729 3a0d 0a20 2020 2020 2020  ix=''):..       
+000253b0: 2069 6620 6d65 6d6f 2069 7320 4e6f 6e65   if memo is None
+000253c0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+000253d0: 656d 6f20 3d20 7365 7428 290d 0a20 2020  emo = set()..   
+000253e0: 2020 2020 2069 6620 6b65 7261 735f 6d6f       if keras_mo
+000253f0: 6465 6c20 6e6f 7420 696e 206d 656d 6f3a  del not in memo:
+00025400: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00025410: 6d6f 2e61 6464 286b 6572 6173 5f6d 6f64  mo.add(keras_mod
+00025420: 656c 290d 0a20 2020 2020 2020 2020 2020  el)..           
+00025430: 2079 6965 6c64 2070 7265 6669 782c 206b   yield prefix, k
+00025440: 6572 6173 5f6d 6f64 656c 0d0a 0d0a 2020  eras_model....  
+00025450: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00025460: 203d 205b 6b65 7261 735f 6d6f 6465 6c5d   = [keras_model]
+00025470: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00025480: 2068 6173 6174 7472 286b 6572 6173 5f6d   hasattr(keras_m
+00025490: 6f64 656c 2c20 276c 6179 6572 7327 293a  odel, 'layers'):
+000254a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000254b0: 2020 6c61 7965 7273 203d 206b 6572 6173    layers = keras
+000254c0: 5f6d 6f64 656c 2e6c 6179 6572 730d 0a20  _model.layers.. 
+000254d0: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+000254e0: 6f64 756c 6520 696e 206c 6179 6572 733a  odule in layers:
+000254f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025500: 2020 6e61 6d65 203d 206d 6f64 756c 652e    name = module.
+00025510: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00025520: 2020 2020 2020 6966 206d 6f64 756c 6520        if module 
+00025530: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00025540: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00025550: 6e74 696e 7565 0d0a 2020 2020 2020 2020  ntinue..        
+00025560: 2020 2020 2020 2020 7375 626d 6f64 756c          submodul
+00025570: 655f 7072 6566 6978 203d 2070 7265 6669  e_prefix = prefi
+00025580: 7820 2b20 2827 2e27 2069 6620 7072 6566  x + ('.' if pref
+00025590: 6978 2065 6c73 6520 2727 2920 2b20 6e61  ix else '') + na
+000255a0: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+000255b0: 2020 2020 666f 7220 6d20 696e 206e 616d      for m in nam
+000255c0: 6564 5f6d 6f64 756c 6573 286d 6f64 756c  ed_modules(modul
+000255d0: 652c 206d 656d 6f2c 2073 7562 6d6f 6475  e, memo, submodu
+000255e0: 6c65 5f70 7265 6669 7829 3a0d 0a20 2020  le_prefix):..   
+000255f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025600: 2079 6965 6c64 206d 0d0a 0d0a 2020 2020   yield m....    
+00025610: 6465 6620 6e61 6d65 645f 7061 7261 6d65  def named_parame
+00025620: 7465 7273 286b 6572 6173 5f6d 6f64 656c  ters(keras_model
+00025630: 2c20 6d65 6d6f 3d4e 6f6e 652c 2070 7265  , memo=None, pre
+00025640: 6669 783d 2727 293a 0d0a 2020 2020 2020  fix=''):..      
+00025650: 2020 7265 7475 726e 205b 2877 2e6e 616d    return [(w.nam
+00025660: 652c 2077 2920 666f 7220 7720 696e 206b  e, w) for w in k
+00025670: 6572 6173 5f6d 6f64 656c 2e77 6569 6768  eras_model.weigh
+00025680: 7473 5d0d 0a0d 0a20 2020 2064 6566 2074  ts]....    def t
+00025690: 6f28 6b65 7261 735f 6d6f 6465 6c2c 202a  o(keras_model, *
+000256a0: 6172 6773 2920 2d3e 2054 3a0d 0a20 2020  args) -> T:..   
+000256b0: 2020 2020 2064 6576 6963 6520 3d20 4e6f       device = No
+000256c0: 6e65 0d0a 2020 2020 2020 2020 6474 7970  ne..        dtyp
+000256d0: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+000256e0: 2020 6e6f 6e5f 626c 6f63 6b69 6e67 203d    non_blocking =
+000256f0: 204e 6f6e 650d 0a20 2020 2020 2020 2066   None..        f
+00025700: 6f72 2061 7267 2069 6e20 6172 6773 3a0d  or arg in args:.
+00025710: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00025720: 2763 7075 2720 696e 2061 7267 2e6c 6f77  'cpu' in arg.low
+00025730: 6572 2829 206f 7220 2767 7075 2720 696e  er() or 'gpu' in
+00025740: 2061 7267 2e6c 6f77 6572 2829 206f 7220   arg.lower() or 
+00025750: 2763 7564 7527 2069 6e20 6172 672e 6c6f  'cudu' in arg.lo
+00025760: 7765 7228 293a 0d0a 2020 2020 2020 2020  wer():..        
+00025770: 2020 2020 2020 2020 6465 7669 6365 203d          device =
+00025780: 2061 7267 0d0a 2020 2020 2020 2020 2020   arg..          
+00025790: 2020 656c 6966 2061 7267 2e6c 6f77 6572    elif arg.lower
+000257a0: 2829 2069 6e20 5b27 666c 6f61 7427 2c20  () in ['float', 
+000257b0: 2769 6e74 272c 2027 626f 6f6c 272c 2027  'int', 'bool', '
+000257c0: 6861 6c66 272c 2027 6c6f 6e67 275d 3a0d  half', 'long']:.
+000257d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000257e0: 2064 7479 7065 203d 2061 7267 0d0a 2020   dtype = arg..  
+000257f0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+00025800: 7369 6e73 7461 6e63 6528 6172 672c 2062  sinstance(arg, b
+00025810: 6f6f 6c29 3a0d 0a20 2020 2020 2020 2020  ool):..         
+00025820: 2020 2020 2020 206e 6f6e 5f62 6c6f 636b         non_block
+00025830: 696e 6720 3d20 6172 670d 0a0d 0a20 2020  ing = arg....   
+00025840: 2020 2020 2069 6620 6465 7669 6365 2069       if device i
+00025850: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00025860: 2020 2020 2064 6576 6963 6520 3d20 6765       device = ge
+00025870: 745f 6465 7669 6365 2829 0d0a 2020 2020  t_device()..    
+00025880: 2020 2020 2320 6966 2064 7479 7065 2069      # if dtype i
+00025890: 7320 4e6f 6e65 2061 6e64 206c 656e 286b  s None and len(k
+000258a0: 6572 6173 5f6d 6f64 656c 2e77 6569 6768  eras_model.weigh
+000258b0: 7473 2920 3e20 303a 0d0a 2020 2020 2020  ts) > 0:..      
+000258c0: 2020 2320 2020 2020 6474 7970 6520 3d20    #     dtype = 
+000258d0: 6b65 7261 735f 6d6f 6465 6c2e 7765 6967  keras_model.weig
+000258e0: 6874 735b 305d 2e64 7479 7065 0d0a 2020  hts[0].dtype..  
+000258f0: 2020 2020 2020 6966 2027 6370 7527 2069        if 'cpu' i
+00025900: 6e20 6465 7669 6365 3a0d 0a20 2020 2020  n device:..     
+00025910: 2020 2020 2020 2077 6974 6820 7466 2e64         with tf.d
+00025920: 6576 6963 6528 272f 6370 753a 3027 293a  evice('/cpu:0'):
+00025930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025940: 2020 666f 7220 7020 696e 206b 6572 6173    for p in keras
+00025950: 5f6d 6f64 656c 2e77 6569 6768 7473 3a0d  _model.weights:.
+00025960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025970: 2020 2020 2069 6620 6474 7970 6520 6973       if dtype is
+00025980: 204e 6f6e 6520 6f72 2064 7479 7065 203d   None or dtype =
+00025990: 3d20 702e 6474 7970 653a 0d0a 2020 2020  = p.dtype:..    
+000259a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000259b0: 2020 2020 702e 6173 7369 676e 2874 662e      p.assign(tf.
+000259c0: 6964 656e 7469 7479 2870 2e76 616c 7565  identity(p.value
+000259d0: 2829 2929 0d0a 2020 2020 2020 2020 2020  ()))..          
+000259e0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000259f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025a00: 2020 2020 2020 2020 2070 2e61 7373 6967           p.assig
+00025a10: 6e28 7466 2e69 6465 6e74 6974 7928 6361  n(tf.identity(ca
+00025a20: 7374 2870 2e76 616c 7565 2829 2c20 6474  st(p.value(), dt
+00025a30: 7970 6529 2929 0d0a 2020 2020 2020 2020  ype)))..        
+00025a40: 656c 6966 2027 6770 7527 2069 6e20 6465  elif 'gpu' in de
+00025a50: 7669 6365 206f 7220 2763 7564 6127 2069  vice or 'cuda' i
+00025a60: 6e20 6465 7669 6365 3a0d 0a20 2020 2020  n device:..     
+00025a70: 2020 2020 2020 2069 6620 7466 2e74 6573         if tf.tes
+00025a80: 742e 6973 5f67 7075 5f61 7661 696c 6162  t.is_gpu_availab
+00025a90: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
+00025aa0: 2020 2020 2077 6974 6820 7466 2e64 6576       with tf.dev
+00025ab0: 6963 6528 272f 6770 753a 3027 293a 0d0a  ice('/gpu:0'):..
+00025ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ad0: 2020 2020 666f 7220 7020 696e 206b 6572      for p in ker
+00025ae0: 6173 5f6d 6f64 656c 2e77 6569 6768 7473  as_model.weights
+00025af0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00025b00: 2020 2020 2020 2020 2020 2069 6620 6474             if dt
+00025b10: 7970 6520 6973 204e 6f6e 6520 6f72 2064  ype is None or d
+00025b20: 7479 7065 203d 3d20 702e 6474 7970 653a  type == p.dtype:
+00025b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025b40: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+00025b50: 6173 7369 676e 2874 662e 6964 656e 7469  assign(tf.identi
+00025b60: 7479 2870 2e76 616c 7565 2829 2929 0d0a  ty(p.value()))..
+00025b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b80: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00025b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ba0: 2020 2020 2020 2020 2020 2070 2e61 7373             p.ass
+00025bb0: 6967 6e28 7466 2e69 6465 6e74 6974 7928  ign(tf.identity(
+00025bc0: 6361 7374 2870 2e76 616c 7565 2829 2c20  cast(p.value(), 
+00025bd0: 6474 7970 6529 2929 0d0a 2020 2020 2020  dtype)))..      
+00025be0: 2020 7265 7475 726e 206b 6572 6173 5f6d    return keras_m
+00025bf0: 6f64 656c 0d0a 0d0a 2020 2020 6465 6620  odel....    def 
+00025c00: 7472 6169 6e28 6b65 7261 735f 6d6f 6465  train(keras_mode
+00025c10: 6c29 3a0d 0a20 2020 2020 2020 2023 2031  l):..        # 1
+00025c20: 203d 2074 7261 696e 0d0a 2020 2020 2020   = train..      
+00025c30: 2020 4b2e 7365 745f 6c65 6172 6e69 6e67    K.set_learning
+00025c40: 5f70 6861 7365 2831 290d 0a20 2020 2020  _phase(1)..     
+00025c50: 2020 2072 6574 7572 6e20 6b65 7261 735f     return keras_
+00025c60: 6d6f 6465 6c0d 0a0d 0a20 2020 2064 6566  model....    def
+00025c70: 2065 7661 6c28 6b65 7261 735f 6d6f 6465   eval(keras_mode
+00025c80: 6c29 3a0d 0a20 2020 2020 2020 2023 2030  l):..        # 0
+00025c90: 203d 2074 6573 742c 2031 203d 2074 7261   = test, 1 = tra
+00025ca0: 696e 0d0a 2020 2020 2020 2020 4b2e 7365  in..        K.se
+00025cb0: 745f 6c65 6172 6e69 6e67 5f70 6861 7365  t_learning_phase
+00025cc0: 2830 290d 0a20 2020 2020 2020 2072 6574  (0)..        ret
+00025cd0: 7572 6e20 6b65 7261 735f 6d6f 6465 6c0d  urn keras_model.
+00025ce0: 0a0d 0a20 2020 206d 6f64 756c 652e 6973  ...    module.is
+00025cf0: 5f72 6f6f 7420 3d20 5472 7565 0d0a 0d0a  _root = True....
+00025d00: 2020 2020 6d6f 6475 6c65 2e5f 6e6f 6465      module._node
+00025d10: 7320 3d20 4f72 6465 7265 6444 6963 7428  s = OrderedDict(
+00025d20: 290d 0a20 2020 2066 6f72 206e 616d 652c  )..    for name,
+00025d30: 206d 6f64 2069 6e20 6e61 6d65 645f 6d6f   mod in named_mo
+00025d40: 6475 6c65 7328 6d6f 6475 6c65 293a 0d0a  dules(module):..
+00025d50: 2020 2020 2020 2020 6d6f 6475 6c65 2e5f          module._
+00025d60: 6e6f 6465 735b 6964 286d 6f64 295d 203d  nodes[id(mod)] =
+00025d70: 206d 6f64 0d0a 2020 2020 2020 2020 6d6f   mod..        mo
+00025d80: 642e 7575 6964 203d 2069 6428 6d6f 6429  d.uuid = id(mod)
+00025d90: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00025da0: 2068 6173 6174 7472 286d 6f64 2c20 276e   hasattr(mod, 'n
+00025db0: 616d 6564 5f6d 6f64 756c 6573 2729 3a0d  amed_modules'):.
+00025dc0: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
+00025dd0: 6174 7472 286d 6f64 2c20 276e 616d 6564  attr(mod, 'named
+00025de0: 5f6d 6f64 756c 6573 272c 204d 6574 686f  _modules', Metho
+00025df0: 6454 7970 6528 6e61 6d65 645f 6d6f 6475  dType(named_modu
+00025e00: 6c65 732c 206d 6f64 2929 0d0a 0d0a 2020  les, mod))....  
+00025e10: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
+00025e20: 6174 7472 286d 6f64 2c20 276e 616d 6564  attr(mod, 'named
+00025e30: 5f70 6172 616d 6574 6572 7327 293a 0d0a  _parameters'):..
+00025e40: 2020 2020 2020 2020 2020 2020 7365 7461              seta
+00025e50: 7474 7228 6d6f 642c 2027 6e61 6d65 645f  ttr(mod, 'named_
+00025e60: 7061 7261 6d65 7465 7273 272c 204d 6574  parameters', Met
+00025e70: 686f 6454 7970 6528 6e61 6d65 645f 7061  hodType(named_pa
+00025e80: 7261 6d65 7465 7273 2c20 6d6f 6429 290d  rameters, mod)).
+00025e90: 0a0d 0a20 2020 2020 2020 2069 6620 6e6f  ...        if no
+00025ea0: 7420 6861 7361 7474 7228 6d6f 642c 2027  t hasattr(mod, '
+00025eb0: 7472 6169 6e27 293a 0d0a 2020 2020 2020  train'):..      
+00025ec0: 2020 2020 2020 7365 7461 7474 7228 6d6f        setattr(mo
+00025ed0: 642c 2027 7472 6169 6e27 2c20 4d65 7468  d, 'train', Meth
+00025ee0: 6f64 5479 7065 2874 7261 696e 2c20 6d6f  odType(train, mo
+00025ef0: 6429 290d 0a0d 0a20 2020 2020 2020 2069  d))....        i
+00025f00: 6620 6e6f 7420 6861 7361 7474 7228 6d6f  f not hasattr(mo
+00025f10: 642c 2027 6576 616c 2729 3a0d 0a20 2020  d, 'eval'):..   
+00025f20: 2020 2020 2020 2020 2073 6574 6174 7472           setattr
+00025f30: 286d 6f64 2c20 2765 7661 6c27 2c20 4d65  (mod, 'eval', Me
+00025f40: 7468 6f64 5479 7065 2865 7661 6c2c 206d  thodType(eval, m
+00025f50: 6f64 2929 0d0a 0d0a 2020 2020 2020 2020  od))....        
+00025f60: 6d6f 642e 7265 6c61 7469 7665 5f6e 616d  mod.relative_nam
+00025f70: 6520 3d20 6e61 6d65 0d0a 2020 2020 6d6f  e = name..    mo
+00025f80: 6475 6c65 2e6e 6f64 6573 203d 206d 6f64  dule.nodes = mod
+00025f90: 756c 652e 5f6e 6f64 6573 0d0a 2020 2020  ule._nodes..    
+00025fa0: 6966 206e 6f74 2068 6173 6174 7472 286d  if not hasattr(m
+00025fb0: 6f64 756c 652c 2027 746f 2729 3a0d 0a20  odule, 'to'):.. 
+00025fc0: 2020 2020 2020 2073 6574 6174 7472 286d         setattr(m
+00025fd0: 6f64 756c 652c 2027 746f 272c 204d 6574  odule, 'to', Met
+00025fe0: 686f 6454 7970 6528 746f 2c20 6d6f 6475  hodType(to, modu
+00025ff0: 6c65 2929 0d0a 0d0a 2020 2020 6d6f 6475  le))....    modu
+00026000: 6c65 2e5f 7569 645f 7072 6566 6978 7320  le._uid_prefixs 
+00026010: 3d20 6465 6661 756c 7464 6963 7428 696e  = defaultdict(in
+00026020: 7429 0d0a 2020 2020 7369 6720 3d20 5369  t)..    sig = Si
+00026030: 676e 6174 7572 6528 6e61 6d65 3d6d 6f64  gnature(name=mod
+00026040: 756c 652e 6e61 6d65 290d 0a20 2020 2066  ule.name)..    f
+00026050: 6f72 2069 6e70 2069 6e20 6d6f 6475 6c65  or inp in module
+00026060: 2e69 6e70 7574 733a 0d0a 2020 2020 2020  .inputs:..      
+00026070: 2020 7369 672e 696e 7075 7473 5b69 6e70    sig.inputs[inp
+00026080: 2e6e 616d 655d 203d 2054 656e 736f 7253  .name] = TensorS
+00026090: 7065 6328 7368 6170 653d 5465 6e73 6f72  pec(shape=Tensor
+000260a0: 5368 6170 6528 696e 745f 7368 6170 6528  Shape(int_shape(
+000260b0: 696e 7029 292c 2064 7479 7065 3d44 5459  inp)), dtype=DTY
+000260c0: 5045 5f4d 4150 5049 4e47 5b69 6e70 2e64  PE_MAPPING[inp.d
+000260d0: 7479 7065 5d2c 0d0a 2020 2020 2020 2020  type],..        
+000260e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026100: 2020 6e61 6d65 3d69 6e70 2e6e 616d 6529    name=inp.name)
+00026110: 0d0a 2020 2020 666f 7220 6b20 696e 2072  ..    for k in r
+00026120: 616e 6765 286c 656e 286d 6f64 756c 652e  ange(len(module.
+00026130: 6f75 7470 7574 7329 293a 0d0a 2020 2020  outputs)):..    
+00026140: 2020 2020 6f75 7420 3d20 6d6f 6475 6c65      out = module
+00026150: 2e6f 7574 7075 7473 5b6b 5d0d 0a20 2020  .outputs[k]..   
+00026160: 2020 2020 206f 7574 5f6e 616d 6520 3d20       out_name = 
+00026170: 276f 7574 7075 7427 2069 6620 6c65 6e28  'output' if len(
+00026180: 6d6f 6475 6c65 2e6f 7574 7075 7473 2920  module.outputs) 
+00026190: 3d3d 2031 2065 6c73 6520 276f 7574 7075  == 1 else 'outpu
+000261a0: 745f 7b30 7d27 2e66 6f72 6d61 7428 6b29  t_{0}'.format(k)
+000261b0: 0d0a 2020 2020 2020 2020 7369 672e 6f75  ..        sig.ou
+000261c0: 7470 7574 735b 6f75 745f 6e61 6d65 5d20  tputs[out_name] 
+000261d0: 3d20 5465 6e73 6f72 5370 6563 2873 6861  = TensorSpec(sha
+000261e0: 7065 3d54 656e 736f 7253 6861 7065 2869  pe=TensorShape(i
+000261f0: 6e74 5f73 6861 7065 286f 7574 2929 2c20  nt_shape(out)), 
+00026200: 6474 7970 653d 4454 5950 455f 4d41 5050  dtype=DTYPE_MAPP
+00026210: 494e 475b 6f75 742e 6474 7970 655d 2c0d  ING[out.dtype],.
+00026220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026240: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00026250: 3d6f 7574 5f6e 616d 6529 0d0a 0d0a 2020  =out_name)....  
+00026260: 2020 6d6f 6475 6c65 2e5f 7369 676e 6174    module._signat
+00026270: 7572 6520 3d20 7369 670d 0a20 2020 206d  ure = sig..    m
+00026280: 6f64 756c 652e 7369 676e 6174 7572 6520  odule.signature 
+00026290: 3d20 7369 670d 0a0d 0a20 2020 2023 2064  = sig....    # d
+000262a0: 6566 2067 6574 5f75 6964 2870 7265 6669  ef get_uid(prefi
+000262b0: 783d 2727 293a 0d0a 2020 2020 2320 2020  x=''):..    #   
+000262c0: 2020 6d6f 6475 6c65 2e5f 7569 645f 7072    module._uid_pr
+000262d0: 6566 6978 735b 7072 6566 6978 5d20 2b3d  efixs[prefix] +=
+000262e0: 2031 0d0a 2020 2020 2320 2020 2020 7265   1..    #     re
+000262f0: 7475 726e 206d 6f64 756c 652e 5f75 6964  turn module._uid
+00026300: 5f70 7265 6669 7873 5b70 7265 6669 785d  _prefixs[prefix]
+00026310: 0d0a 2020 2020 230d 0a20 2020 2023 2064  ..    #..    # d
+00026320: 6566 2067 6574 5f72 6f6f 7428 6d6f 6475  ef get_root(modu
+00026330: 6c65 293a 0d0a 2020 2020 2320 2020 2020  le):..    #     
+00026340: 6966 206e 6f74 2068 6173 6174 7472 286d  if not hasattr(m
+00026350: 6f64 756c 652c 2027 5f6e 6f64 6573 2729  odule, '_nodes')
+00026360: 206f 7220 6d6f 6475 6c65 2e5f 6e6f 6465   or module._node
+00026370: 7320 6973 204e 6f6e 6520 6f72 206c 656e  s is None or len
+00026380: 286d 6f64 756c 652e 5f6e 6f64 6573 2920  (module._nodes) 
+00026390: 3c20 323a 0d0a 2020 2020 2320 2020 2020  < 2:..    #     
+000263a0: 2020 2020 7265 7475 726e 206d 6f64 756c      return modul
+000263b0: 650d 0a20 2020 2023 2020 2020 2069 6620  e..    #     if 
+000263c0: 6861 7361 7474 7228 6c69 7374 286d 6f64  hasattr(list(mod
+000263d0: 756c 652e 5f6e 6f64 6573 2e76 616c 7565  ule._nodes.value
+000263e0: 7328 2929 5b30 5d2c 2027 6973 5f72 6f6f  s())[0], 'is_roo
+000263f0: 7427 2920 616e 6420 6c69 7374 286d 6f64  t') and list(mod
+00026400: 756c 652e 5f6e 6f64 6573 2e76 616c 7565  ule._nodes.value
+00026410: 7328 2929 5b30 5d2e 6973 5f72 6f6f 7420  s())[0].is_root 
+00026420: 3d3d 2054 7275 653a 0d0a 2020 2020 2320  == True:..    # 
+00026430: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00026440: 6973 7428 6d6f 6475 6c65 2e5f 6e6f 6465  ist(module._node
+00026450: 732e 7661 6c75 6573 2829 295b 305d 0d0a  s.values())[0]..
+00026460: 2020 2020 2320 2020 2020 656c 7365 3a0d      #     else:.
+00026470: 0a20 2020 2023 2020 2020 2020 2020 2066  .    #         f
+00026480: 6f72 206e 616d 652c 206e 6f64 6520 696e  or name, node in
+00026490: 206d 6f64 756c 652e 5f6e 6f64 6573 2e69   module._nodes.i
+000264a0: 7465 6d73 2829 3a0d 0a20 2020 2023 2020  tems():..    #  
+000264b0: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+000264c0: 7361 7474 7228 6e6f 6465 2c20 2764 6566  sattr(node, 'def
+000264d0: 6175 6c74 5f6e 616d 6527 2920 616e 6420  ault_name') and 
+000264e0: 6e6f 6465 2e64 6566 6175 6c74 5f6e 616d  node.default_nam
+000264f0: 6520 3d3d 2022 7365 7175 656e 7469 616c  e == "sequential
+00026500: 5f31 223a 0d0a 2020 2020 2320 2020 2020  _1":..    #     
+00026510: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00026520: 726e 206e 6f64 650d 0a20 2020 2023 2020  rn node..    #  
+00026530: 2020 2020 2020 2072 6574 7572 6e20 6d6f         return mo
+00026540: 6475 6c65 0d0a 0d0a 2020 2020 2320 666f  dule....    # fo
+00026550: 7220 6e61 6d65 2c20 6d6f 6420 696e 206d  r name, mod in m
+00026560: 6f64 756c 652e 6e61 6d65 645f 6d6f 6475  odule.named_modu
+00026570: 6c65 7328 293a 0d0a 2020 2020 2320 2020  les():..    #   
+00026580: 2020 6966 206d 6f64 2021 3d20 6d6f 6475    if mod != modu
+00026590: 6c65 3a0d 0a20 2020 2023 2020 2020 2020  le:..    #      
+000265a0: 2020 206d 6f64 756c 652e 6973 5f72 6f6f     module.is_roo
+000265b0: 7420 3d20 4661 6c73 650d 0a20 2020 2023  t = False..    #
+000265c0: 2020 2020 206d 6f64 2e5f 6275 696c 7420       mod._built 
+000265d0: 3d20 5472 7565 0d0a 2020 2020 2320 2020  = True..    #   
+000265e0: 2020 6d6f 642e 6275 696c 7420 3d20 5472    mod.built = Tr
+000265f0: 7565 0d0a 2020 2020 2320 2020 2020 6d6f  ue..    #     mo
+00026600: 642e 7265 6c61 7469 7665 5f6e 616d 6520  d.relative_name 
+00026610: 3d20 6e61 6d65 0d0a 2020 2020 2320 2020  = name..    #   
+00026620: 2020 6d6f 642e 6261 7463 685f 696e 6465    mod.batch_inde
+00026630: 7820 3d20 300d 0a20 2020 2023 2020 2020  x = 0..    #    
+00026640: 206d 6f64 2e66 696c 7465 725f 696e 6465   mod.filter_inde
+00026650: 7820 3d20 310d 0a20 2020 2023 2020 2020  x = 1..    #    
+00026660: 206d 6f64 2e69 6e5f 7365 7175 656e 6365   mod.in_sequence
+00026670: 203d 2046 616c 7365 0d0a 2020 2020 2320   = False..    # 
+00026680: 2020 2020 6d6f 642e 7575 6964 203d 2075      mod.uuid = u
+00026690: 7569 642e 7575 6964 3428 292e 6e6f 6465  uid.uuid4().node
+000266a0: 0d0a 2020 2020 2320 2020 2020 7072 6566  ..    #     pref
+000266b0: 6978 203d 206d 6f64 2e5f 5f63 6c61 7373  ix = mod.__class
+000266c0: 5f5f 2e5f 5f6e 616d 655f 5f0d 0a20 2020  __.__name__..   
+000266d0: 2023 2020 2020 206d 6f64 2e64 6566 6175   #     mod.defau
+000266e0: 6c74 5f6e 616d 6520 3d20 6361 6d65 6c32  lt_name = camel2
+000266f0: 736e 616b 6528 7072 6566 6978 2920 2b20  snake(prefix) + 
+00026700: 275f 2720 2b20 7374 7228 6765 745f 7569  '_' + str(get_ui
+00026710: 6428 6361 6d65 6c32 736e 616b 6528 7072  d(camel2snake(pr
+00026720: 6566 6978 2929 290d 0a20 2020 2023 0d0a  efix)))..    #..
+00026730: 2020 2020 2320 2020 2020 6d6f 642e 5f69      #     mod._i
+00026740: 6e70 7574 5f73 6861 7065 203d 204e 6f6e  nput_shape = Non
+00026750: 650d 0a20 2020 2023 2020 2020 206d 6f64  e..    #     mod
+00026760: 2e5f 6f75 7470 7574 5f73 6861 7065 203d  ._output_shape =
+00026770: 204e 6f6e 650d 0a20 2020 2023 2020 2020   None..    #    
+00026780: 206d 6f64 2e6b 6565 705f 6f75 7470 7574   mod.keep_output
+00026790: 203d 2046 616c 7365 0d0a 2020 2020 2320   = False..    # 
+000267a0: 2020 2020 6d6f 642e 7265 6769 7374 6572      mod.register
+000267b0: 5f62 7566 6665 7228 275f 6f75 7470 7574  _buffer('_output
+000267c0: 5f74 656e 736f 7227 2c20 4e6f 6e65 2c20  _tensor', None, 
+000267d0: 7065 7273 6973 7465 6e74 3d46 616c 7365  persistent=False
+000267e0: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
+000267f0: 2020 2020 6d6f 642e 5f64 6576 6963 6520      mod._device 
+00026800: 3d20 6765 745f 6465 7669 6365 2829 0d0a  = get_device()..
+00026810: 2020 2020 2320 2020 2020 236d 6f64 2e5f      #     #mod._
+00026820: 7369 676e 6174 7572 6520 3d20 696e 7370  signature = insp
+00026830: 6563 742e 7369 676e 6174 7572 6528 6d6f  ect.signature(mo
+00026840: 642e 666f 7277 6172 6429 0d0a 2020 2020  d.forward)..    
+00026850: 2320 2020 2020 6d6f 642e 6475 6d70 5f70  #     mod.dump_p
+00026860: 6174 6368 6573 203d 2054 7275 650d 0a20  atches = True.. 
+00026870: 2020 2023 2020 2020 2023 0d0a 2020 2020     #     #..    
+00026880: 2320 2020 2020 2320 6465 6620 6765 7473  #     # def gets
+00026890: 6967 6e61 7475 7265 286d 6f64 293a 0d0a  ignature(mod):..
+000268a0: 2020 2020 2320 2020 2020 2320 2020 2020      #     #     
+000268b0: 7265 7475 726e 206d 6f64 2e5f 7369 676e  return mod._sign
+000268c0: 6174 7572 650d 0a20 2020 2023 2020 2020  ature..    #    
+000268d0: 2023 0d0a 2020 2020 2320 2020 2020 2320   #..    #     # 
+000268e0: 6465 6620 7365 7473 6967 6e61 7475 7265  def setsignature
+000268f0: 286d 6f64 2c20 7661 6c75 6529 3a0d 0a20  (mod, value):.. 
+00026900: 2020 2023 2020 2020 2023 2020 2020 206d     #     #     m
+00026910: 6f64 2e5f 7369 676e 6174 7572 6520 3d20  od._signature = 
+00026920: 7661 6c75 650d 0a20 2020 2023 2020 2020  value..    #    
+00026930: 2023 0d0a 2020 2020 2320 2020 2020 2320   #..    #     # 
+00026940: 6465 6620 6465 6c73 6967 6e61 7475 7265  def delsignature
+00026950: 286d 6f64 293a 0d0a 2020 2020 2320 2020  (mod):..    #   
+00026960: 2020 2320 2020 2020 6465 6c20 6d6f 642e    #     del mod.
+00026970: 5f73 6967 6e61 7475 7265 0d0a 2020 2020  _signature..    
+00026980: 2320 2020 2020 230d 0a20 2020 2023 2020  #     #..    #  
+00026990: 2020 2023 206d 6f64 2e73 6967 6e61 7475     # mod.signatu
+000269a0: 7265 3d20 7072 6f70 6572 7479 2867 6574  re= property(get
+000269b0: 7369 676e 6174 7572 652c 2073 6574 7369  signature, setsi
+000269c0: 676e 6174 7572 652c 2064 656c 7369 676e  gnature, delsign
+000269d0: 6174 7572 652c 2022 7369 676e 6174 7572  ature, "signatur
+000269e0: 6522 290d 0a20 2020 2023 0d0a 2020 2020  e")..    #..    
+000269f0: 2320 2020 2020 6966 206e 6f74 2068 6173  #     if not has
+00026a00: 6174 7472 286d 6f64 2c20 2767 6574 5f72  attr(mod, 'get_r
+00026a10: 6f6f 7427 293a 0d0a 2020 2020 2320 2020  oot'):..    #   
+00026a20: 2020 2020 2020 7365 7461 7474 7228 6d6f        setattr(mo
+00026a30: 642c 2027 6765 745f 726f 6f74 272c 204d  d, 'get_root', M
+00026a40: 6574 686f 6454 7970 6528 6765 745f 726f  ethodType(get_ro
+00026a50: 6f74 2c20 6d6f 6429 290d 0a20 2020 2023  ot, mod))..    #
+00026a60: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00026a70: 6d6f 642c 2027 6469 6d73 2729 3a0d 0a20  mod, 'dims'):.. 
+00026a80: 2020 2023 2020 2020 2020 2020 206d 6f64     #         mod
+00026a90: 2e61 7869 7320 3d20 6d6f 642e 6469 6d73  .axis = mod.dims
+00026aa0: 0d0a 2020 2020 2320 2020 2020 6966 2068  ..    #     if h
+00026ab0: 6173 6174 7472 286d 6f64 756c 652c 2027  asattr(module, '
+00026ac0: 6b65 6570 6469 6d27 293a 0d0a 2020 2020  keepdim'):..    
+00026ad0: 2320 2020 2020 2020 2020 7661 6c75 6520  #         value 
+00026ae0: 3d20 6765 7461 7474 7228 6d6f 6475 6c65  = getattr(module
+00026af0: 2c20 276b 6565 7064 696d 2729 0d0a 2020  , 'keepdim')..  
+00026b00: 2020 2320 2020 2020 2020 2020 7365 7461    #         seta
+00026b10: 7474 7228 6d6f 6475 6c65 2c20 276b 6565  ttr(module, 'kee
+00026b20: 7064 696d 7327 2c20 7661 6c75 6529 0d0a  pdims', value)..
+00026b30: 2020 2020 230d 0a20 2020 2023 2064 6566      #..    # def
+00026b40: 2072 6567 6973 7465 725f 686f 6f6b 286d   register_hook(m
+00026b50: 6f64 756c 6529 3a0d 0a20 2020 2023 2020  odule):..    #  
+00026b60: 2020 2064 6566 2068 6f6f 6b28 6d6f 6475     def hook(modu
+00026b70: 6c65 2c20 696e 7075 742c 206f 7574 7075  le, input, outpu
+00026b80: 7429 3a0d 0a20 2020 2023 2020 2020 2020  t):..    #      
+00026b90: 2020 2023 2063 6c61 7373 5f6e 616d 6520     # class_name 
+00026ba0: 3d6d 6f64 756c 652e 7265 2020 2020 6d6f  =module.re    mo
+00026bb0: 6475 6c65 2e6e 616d 6520 2020 2320 7374  dule.name   # st
+00026bc0: 7228 6d6f 6475 6c65 2e5f 5f63 6c61 7373  r(module.__class
+00026bd0: 5f5f 292e 7370 6c69 7428 222e 2229 5b2d  __).split(".")[-
+00026be0: 315d 2e73 706c 6974 2822 2722 295b 305d  1].split("'")[0]
+00026bf0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00026c00: 696e 7075 7420 3d20 6974 6572 6174 696f  input = iteratio
+00026c10: 6e5f 746f 6f6c 732e 666c 6174 7465 6e28  n_tools.flatten(
+00026c20: 5b69 6e70 7574 5d2c 2069 7465 7261 626c  [input], iterabl
+00026c30: 655f 7479 7065 733d 286c 6973 742c 2074  e_types=(list, t
+00026c40: 7570 6c65 2929 0d0a 2020 2020 2320 2020  uple))..    #   
+00026c50: 2020 2020 2020 696e 7075 7420 3d20 756e        input = un
+00026c60: 7061 636b 5f73 696e 676c 6574 6f6e 285b  pack_singleton([
+00026c70: 6974 656d 2066 6f72 2069 7465 6d20 696e  item for item in
+00026c80: 2069 6e70 7574 2069 6620 6974 656d 2069   input if item i
+00026c90: 7320 6e6f 7420 4e6f 6e65 5d29 0d0a 2020  s not None])..  
+00026ca0: 2020 230d 0a20 2020 2023 2020 2020 2020    #..    #      
+00026cb0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00026cc0: 2869 6e70 7574 2c20 286c 6973 742c 2074  (input, (list, t
+00026cd0: 7570 6c65 2929 3a0d 0a20 2020 2023 2020  uple)):..    #  
+00026ce0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+00026cf0: 652e 5f69 6e70 7574 5f73 6861 7065 203d  e._input_shape =
+00026d00: 2074 7570 6c65 285b 7465 6e73 6f72 5f74   tuple([tensor_t
+00026d10: 6f5f 7368 6170 6528 742c 206e 6565 645f  o_shape(t, need_
+00026d20: 6578 636c 7564 655f 6261 7463 685f 6178  exclude_batch_ax
+00026d30: 6973 3d54 7275 652c 2069 735f 7369 6e67  is=True, is_sing
+00026d40: 6c65 746f 6e3d 4661 6c73 6529 2066 6f72  leton=False) for
+00026d50: 2074 2069 6e20 696e 7075 745d 290d 0a20   t in input]).. 
+00026d60: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00026d70: 206d 6f64 756c 652e 696e 7075 745f 7368   module.input_sh
+00026d80: 6170 6520 3d20 6d6f 6475 6c65 2e5f 696e  ape = module._in
+00026d90: 7075 745f 7368 6170 650d 0a20 2020 2023  put_shape..    #
+00026da0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00026db0: 5f74 656e 736f 7228 696e 7075 7429 3a0d  _tensor(input):.
+00026dc0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00026dd0: 2020 206d 6f64 756c 652e 5f69 6e70 7574     module._input
+00026de0: 5f73 6861 7065 203d 2074 656e 736f 725f  _shape = tensor_
+00026df0: 746f 5f73 6861 7065 2869 6e70 7574 2c20  to_shape(input, 
+00026e00: 6e65 6564 5f65 7863 6c75 6465 5f62 6174  need_exclude_bat
+00026e10: 6368 5f61 7869 733d 5472 7565 2c20 6973  ch_axis=True, is
+00026e20: 5f73 696e 676c 6574 6f6e 3d46 616c 7365  _singleton=False
+00026e30: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+00026e40: 2020 2020 206d 6f64 756c 652e 696e 7075       module.inpu
+00026e50: 745f 7368 6170 6520 3d20 6d6f 6475 6c65  t_shape = module
+00026e60: 2e5f 696e 7075 745f 7368 6170 650d 0a20  ._input_shape.. 
+00026e70: 2020 2023 0d0a 2020 2020 2320 2020 2020     #..    #     
+00026e80: 2020 2020 6f75 7470 7574 203d 2069 7465      output = ite
+00026e90: 7261 7469 6f6e 5f74 6f6f 6c73 2e66 6c61  ration_tools.fla
+00026ea0: 7474 656e 285b 6f75 7470 7574 5d2c 2069  tten([output], i
+00026eb0: 7465 7261 626c 655f 7479 7065 733d 286c  terable_types=(l
+00026ec0: 6973 742c 2074 7570 6c65 2929 0d0a 2020  ist, tuple))..  
+00026ed0: 2020 2320 2020 2020 2020 2020 6f75 7470    #         outp
+00026ee0: 7574 203d 2075 6e70 6163 6b5f 7369 6e67  ut = unpack_sing
+00026ef0: 6c65 746f 6e28 5b69 7465 6d20 666f 7220  leton([item for 
+00026f00: 6974 656d 2069 6e20 6f75 7470 7574 2069  item in output i
+00026f10: 6620 6974 656d 2069 7320 6e6f 7420 4e6f  f item is not No
+00026f20: 6e65 5d29 0d0a 2020 2020 2320 2020 2020  ne])..    #     
+00026f30: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00026f40: 6528 6f75 7470 7574 2c20 286c 6973 742c  e(output, (list,
+00026f50: 2074 7570 6c65 2929 3a0d 0a20 2020 2023   tuple)):..    #
+00026f60: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+00026f70: 756c 652e 5f6f 7574 7075 745f 7368 6170  ule._output_shap
+00026f80: 6520 3d20 7475 706c 6528 5b74 656e 736f  e = tuple([tenso
+00026f90: 725f 746f 5f73 6861 7065 2874 2c20 6e65  r_to_shape(t, ne
+00026fa0: 6564 5f65 7863 6c75 6465 5f62 6174 6368  ed_exclude_batch
+00026fb0: 5f61 7869 733d 5472 7565 2c20 6973 5f73  _axis=True, is_s
+00026fc0: 696e 676c 6574 6f6e 3d46 616c 7365 2920  ingleton=False) 
+00026fd0: 666f 7220 7420 696e 206f 7574 7075 745d  for t in output]
+00026fe0: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+00026ff0: 2020 2020 206d 6f64 756c 652e 6f75 7470       module.outp
+00027000: 7574 5f73 6861 7065 203d 206d 6f64 756c  ut_shape = modul
+00027010: 652e 5f6f 7574 7075 745f 7368 6170 650d  e._output_shape.
+00027020: 0a20 2020 2023 2020 2020 2020 2020 2065  .    #         e
+00027030: 6c69 6620 6973 5f74 656e 736f 7228 6f75  lif is_tensor(ou
+00027040: 7470 7574 293a 0d0a 2020 2020 2320 2020  tput):..    #   
+00027050: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
+00027060: 2e5f 6f75 7470 7574 5f73 6861 7065 203d  ._output_shape =
+00027070: 2074 656e 736f 725f 746f 5f73 6861 7065   tensor_to_shape
+00027080: 286f 7574 7075 742c 206e 6565 645f 6578  (output, need_ex
+00027090: 636c 7564 655f 6261 7463 685f 6178 6973  clude_batch_axis
+000270a0: 3d54 7275 652c 2069 735f 7369 6e67 6c65  =True, is_single
+000270b0: 746f 6e3d 4661 6c73 6529 0d0a 2020 2020  ton=False)..    
+000270c0: 2320 2020 2020 2020 2020 2020 2020 6d6f  #             mo
+000270d0: 6475 6c65 2e6f 7574 7075 745f 7368 6170  dule.output_shap
+000270e0: 6520 3d20 6d6f 6475 6c65 2e5f 6f75 7470  e = module._outp
+000270f0: 7574 5f73 6861 7065 0d0a 2020 2020 230d  ut_shape..    #.
+00027100: 0a20 2020 2023 2020 2020 2020 2020 2068  .    #         h
+00027110: 6f6f 6b73 2e61 7070 656e 6428 6d6f 6475  ooks.append(modu
+00027120: 6c65 2e72 6567 6973 7465 725f 666f 7277  le.register_forw
+00027130: 6172 645f 686f 6f6b 2868 6f6f 6b29 290d  ard_hook(hook)).
+00027140: 0a20 2020 2023 0d0a 2020 2020 2320 686f  .    #..    # ho
+00027150: 6f6b 7320 3d20 5b5d 0d0a 2020 2020 230d  oks = []..    #.
+00027160: 0a20 2020 2023 2023 2072 6567 6973 7465  .    # # registe
+00027170: 7220 686f 6f6b 0d0a 2020 2020 2320 6d6f  r hook..    # mo
+00027180: 6475 6c65 2e61 7070 6c79 2872 6567 6973  dule.apply(regis
+00027190: 7465 725f 686f 6f6b 290d 0a20 2020 2023  ter_hook)..    #
+000271a0: 0d0a 2020 2020 2320 6966 2069 6e70 7574  ..    # if input
+000271b0: 5f74 656e 736f 7220 6973 204e 6f6e 653a  _tensor is None:
+000271c0: 0d0a 2020 2020 2320 2020 2020 696e 7075  ..    #     inpu
+000271d0: 745f 7465 6e73 6f72 203d 2074 6f5f 7465  t_tensor = to_te
+000271e0: 6e73 6f72 2854 656e 736f 7253 6861 7065  nsor(TensorShape
+000271f0: 2869 6e70 7574 5f73 6861 7065 292e 6765  (input_shape).ge
+00027200: 745f 6475 6d6d 795f 7465 6e73 6f72 2829  t_dummy_tensor()
+00027210: 290d 0a20 2020 2023 2023 206d 616b 6520  )..    # # make 
+00027220: 6120 666f 7277 6172 6420 7061 7373 0d0a  a forward pass..
+00027230: 2020 2020 2320 2320 7072 696e 7428 782e      # # print(x.
+00027240: 7368 6170 6529 0d0a 2020 2020 2320 6d6f  shape)..    # mo
+00027250: 6475 6c65 2869 6e70 7574 5f74 656e 736f  dule(input_tenso
+00027260: 7229 0d0a 2020 2020 230d 0a20 2020 2023  r)..    #..    #
+00027270: 2023 2072 656d 6f76 6520 7468 6573 6520   # remove these 
+00027280: 686f 6f6b 730d 0a20 2020 2023 2066 6f72  hooks..    # for
+00027290: 2068 2069 6e20 686f 6f6b 733a 0d0a 2020   h in hooks:..  
+000272a0: 2020 2320 2020 2020 682e 7265 6d6f 7665    #     h.remove
+000272b0: 2829 0d0a 2020 2020 7265 7475 726e 206d  ()..    return m
+000272c0: 6f64 756c 650d 0a                        odule..
```

## trident/backend/tensorflow_ops.py

```diff
@@ -4470,19 +4470,21 @@
           from_logits: Whether `output` is expected to be a logits tensor.
               By default, we consider that `output`
               encodes a probability distribution.
       Returns:
           A tensor.
       """
     if from_logits:
-        output = clip(output, 1e-7, 1 - 1e-7)
+        pass
     else:
-        output = clip(sigmoid(output), 1e-7, 1 - 1e-7)
-    bce = target * tf.math.log(output)
-    bce += (1 - target) * tf.math.log(1 - output)
+        output = sigmoid(output)
+    if isinstance(target,(_float,_int )):
+        target=(ones_like(output)*float(target)).to(output.dtype).to(output.device)
+    bce = target *  tf.math.log(tf.clip_by_value(output,1e-7,1))
+    bce =bce+ (1 - target) * tf.math.log(tf.clip_by_value(1 - output,1e-7,1))
     return -bce
 
 
 def cross_entropy(output, target, from_logits=False):
     if not from_logits:
         output = output.sigmoid()
     output = output.clamp(epsilon(), 1.0 - epsilon())
```

## trident/callbacks/visualization_callbacks.py

```diff
@@ -172,15 +172,15 @@
 
     def on_batch_end(self, training_context):
         if self.frequency > 0 and ((self.unit == 'batch' and (training_context['steps'] + 1) % self.frequency == 0) or (
                 self.unit == 'step' and (training_context['steps'] + 1) % self.frequency == 0)):
             self.plot_tile_image(training_context)
 
     def on_epoch_end(self, training_context):
-        if self.frequency > 0 and (self.unit == 'epoch' and training_context['current_batch'] == 0 and (training_context['current_epoch'] % self.frequency )== 0):
+        if self.frequency > 0 and (self.unit == 'epoch' and (training_context['current_epoch'] % self.frequency )== 0):
             self.plot_tile_image(training_context)
 
 
 class GanTileImageCallback(VisualizationCallbackBase):
     def __init__(self, frequency=-1, unit='batch', save_path: str = 'Results',
                  name_prefix: str = 'tile_image_{0}.png', row=3,
                  include_mask=None, reverse_image_transform=None, imshow=False):
@@ -709,14 +709,13 @@
             self.print_gpu_utilization()
             if len(self.lines) > 0:
                 for line in self.lines:
                     ctx.print(line)
                 self.lines = []
 
     def on_overall_epoch_end(self, training_context):
-        if self.frequency > 0 and (self.unit == 'epoch' and training_context['current_batch'] == 0 and (
-                training_context['current_epoch'] ) % self.frequency == 0):
+        if self.frequency > 0 and (self.unit == 'epoch' and (training_context['current_epoch']+1) % self.frequency == 0):
             self.print_gpu_utilization()
             if len(self.lines) > 0:
                 for line in self.lines:
                     ctx.print(line)
                 self.lines = []
```

## trident/data/__init__.py

```diff
@@ -1,15 +1,15 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
 
 import os
 import threading
 
-from trident.data.image_common import *
+#from trident.data.image_common import *
 
 from trident.data.utils import *
 from trident.data.samplers import *
 from trident.data.dataset import *
 from trident.data.data_provider import *
```

## trident/data/data_loaders.py

```diff
@@ -21,15 +21,15 @@
 from tqdm import tqdm
 from trident.context import sanitize_path
 from trident.backend.common import *
 from trident.data.text_transforms import ToHalfWidth, ChineseConvert, bpmf_phonetic
 
 from trident.data.utils import _delete_h
 
-from trident.backend.opencv_backend import image2array, array2image
+from trident.backend.opencv_backend import image2array, array2image,array2mask
 from trident.data.image_common import list_images
 from trident.data.data_provider import *
 from trident.data.dataset import *
 from trident.data.text_transforms import *
 from trident.data.mask_common import *
 from trident.data.utils import *
 from trident.backend.common import floatx, OrderedDict, is_alphabet, is_punctuation, remove_nonprintable
@@ -678,15 +678,31 @@
             pass
     is_internet_ok = is_connected()
     if dataset_name == 'examples_pokemon':
         is_download = download_file_from_google_drive('1U-xc54fX9j9BcidvRa0ow6qjssMlSF2A', dirname, 'pokemon.tar')
         tar_file_path = os.path.join(dirname, 'pokemon.tar')
         extract_archive(tar_file_path, dirname, archive_format='tar')
         extract_path = os.path.join(dirname, 'pokemon')
+
         dataset = load_folder_images(dataset_name, extract_path, folder_as_label=False)
+        make_dir_if_need(os.path.join(extract_path,'masks'))
+        for impath in dataset.traindata.data.items:
+            folder,filename,ext=split_path(impath)
+            arr = image2array(impath)
+            arr1=np.zeros_like(arr)
+            arr1[:,1:,:]=arr[:,:-1,:]-arr[:,1:,:]
+            arr2 = np.zeros_like(arr)
+            arr2[1:,:, :] = arr[:-1,:, :] - arr[1:,:, :]
+            arr1=(np.abs(arr1)+np.abs(arr2)).sum(-1)
+            mask=np.not_equal(np.equal(arr1,0).astype(np.float32)+np.equal(arr.mean(-1),arr.mean(-1)[2,2]).astype(np.float32),2).astype(np.float32)*255
+            mask[mask>220]=255
+            mask[mask<=220] = 0
+            array2mask(mask).save(os.path.join(folder, 'masks', filename + '.png'))
+
+
         print('get pokemon images :{0}'.format(len(dataset)))
         return dataset
 
 
     elif dataset_name == 'examples_hanzi':
         download_file_from_google_drive('13UEzSG0az113gpRPKPyKrIE2HDaA2P4H', dirname, 'hanzi.tar')
         tar_file_path = os.path.join(dirname, 'hanzi.tar')
```

## trident/data/dataset.py

```diff
@@ -21,16 +21,16 @@
 from trident import context
 # from trident.backend.numpy_ops import DTYPE_MAPPING
 from trident.backend import dtype as Dtype
 from trident.backend import iteration_tools
 from trident.backend.common import *
 from trident.backend.opencv_backend import file2array
 from trident.backend.tensorspec import TensorSpec, ObjectType
-from trident.data.image_common import image_backend_adaption, reverse_image_backend_adaption, \
-    array2image, TensorShape,OrderedDict
+from trident.data.image_common import image_backend_adaption, reverse_image_backend_adaption, TensorShape,OrderedDict
+from trident.backend.pillow_backend import array2image
 from trident.data.label_common import label_backend_adaptive
 from trident.data.mask_common import mask_backend_adaptive, color2label
 from trident.data.samplers import *
 from trident.data.text_common import reverse_text_backend_adaption
 from trident.data.transform import Transform
 from trident.data.vision_transforms import Unnormalize
 from trident.data.text_transforms import ToHalfWidth
```

## trident/data/image_common.py

```diff
@@ -1,187 +1,171 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
-import functools
-import math
+
+import builtins
+import inspect
 import numbers
-import sys
 import os
 import random
 import re
-import builtins
-import time
-import warnings
-
-from itertools import repeat
 from functools import partial
-import inspect
-from typing import Union, Dict
-
 import cv2
 import numpy as np
-import six
-from scipy import ndimage
-from skimage import color
 from skimage import exposure
-from skimage import morphology
-from skimage import transform, exposure
-from skimage.filters import *
-from skimage.morphology import square
+from scipy.ndimage import grey_erosion, grey_dilation
+
 from trident.backend.common import *
 from trident.backend.decorators import deprecated
-from trident.backend.tensorspec import TensorSpec, assert_input_compatibility, ObjectType
 from trident.data.vision_transforms import *
 
-__all__ = [ 'list_pictures','list_images','check_same_size', 'normalize', 'unnormalize', 'channel_reverse', 'blur', 'random_blur',
+__all__ = ['list_pictures', 'list_images', 'check_same_size', 'normalize', 'unnormalize', 'channel_reverse', 'blur',
+           'random_blur',
            'random_crop', 'resize', 'rescale', 'downsample_then_upsample', 'add_noise', 'gray_scale', 'to_rgb',
            'to_bgr', 'auto_level', 'random_invert_color', 'image_backend_adaption', 'reverse_image_backend_adaption',
            'random_adjust_hue', 'random_channel_shift', 'random_cutout', 'random_rescale_crop', 'random_center_crop',
-           'adjust_gamma','adjust_brightness_contrast', 'random_adjust_gamma', 'adjust_contrast', 'random_adjust_contrast', 'clahe',
+           'adjust_gamma', 'adjust_brightness_contrast', 'random_adjust_gamma', 'adjust_contrast',
+           'random_adjust_contrast', 'clahe',
            'erosion_then_dilation', 'dilation_then_erosion', 'image_erosion', 'image_dilation', 'adaptive_binarization',
-           'random_transform', 'horizontal_flip', 'random_mirror', 'to_low_resolution','random_erasing']
-
-
+           'random_transform', 'horizontal_flip', 'random_mirror', 'to_low_resolution', 'random_erasing']
 
 if get_backend() == 'pytorch':
     from trident.backend.pytorch_ops import *
 elif get_backend() == 'tensorflow':
     from trident.backend.tensorflow_ops import *
 
 
-from trident.backend.opencv_backend import *
-
-
-
-
-
 def transform_func(func):
     """
 
     Args:
         func ():
 
     Returns:
 
 
     """
+
     def wrapper(*args, **kwargs):
         argspec = inspect.getfullargspec(func)
 
-        if len(args)>len(argspec.varargs)-1:
-            raise ValueError('Beside image, there should be only {0} in {1} function, but you get {2}'.format(len(argspec.varargs)-1,func.__name__,len(args)))
+        if len(args) > len(argspec.varargs) - 1:
+            raise ValueError('Beside image, there should be only {0} in {1} function, but you get {2}'.format(
+                len(argspec.varargs) - 1, func.__name__, len(args)))
         if len(kwargs) > len(argspec.kwonlyargs) - 1:
-            raise ValueError('there should be only {0} in {1} function, but you get {2}'.format(len(argspec.kwonlyargs) , func.__name__, len(kwargs)))
+            raise ValueError('there should be only {0} in {1} function, but you get {2}'.format(len(argspec.kwonlyargs),
+                                                                                                func.__name__,
+                                                                                                len(kwargs)))
         for i in range(len(args)):
-            kwargs[argspec.args[i+1]]=args[i]
-        ret = partial(func,**kwargs)
+            kwargs[argspec.args[i + 1]] = args[i]
+        ret = partial(func, **kwargs)
         return ret
 
     return wrapper
 
+
 @deprecated('0.7.0', 'list_images')
 def list_pictures(directory, ext='jpg|jpeg|jpe|tiff|tif|bmp|png|ppm|jfif'):
     filelist = []
     for root, dirs, files in os.walk(directory):
-        filelist = filelist + [os.path.join(root,f) for f in files if re.match( "([^\\s]+(\\.(?i)({0}))$)".format(ext), f)]
+        filelist = filelist + [os.path.join(root, f) for f in files if
+                               re.match("([^\\s]+(\\.(?i)({0}))$)".format(ext), f)]
     return filelist
 
 
-
 def list_images(directory, ext='jpg|jpeg|jpe|tiff|tif|bmp|png|ppm|jfif'):
     # return [os.path.join(root, f) for root, _, files in os.walk(directory) for f in files if
     #         re.match(r'([\w]+\.(?:' + ext + '))', f)]
     filelist = []
     for root, dirs, files in os.walk(directory):
-        filelist = filelist + [os.path.join(root,f) for f in files if re.match( "(\S+(\\.(?i)({0}))$)".format(ext), f)]
+        filelist = filelist + [os.path.join(root, f) for f in files if re.match("(\S+(\\.(?i)({0}))$)".format(ext), f)]
     return filelist
 
 
 def check_same_size(*images):
     result = True
-    base_shape =None
-    if isinstance(images[0],str):
+    base_shape = None
+    if isinstance(images[0], str):
         return True
-    elif isinstance(images[0],numbers.Number):
-        base_shape=0
-    elif  isinstance(images[0],np.ndarray):
+    elif isinstance(images[0], numbers.Number):
+        base_shape = 0
+    elif isinstance(images[0], np.ndarray):
         base_shape = TensorShape(images[0].shape)
     # check same isze
     for img in images:
-        if base_shape==0 and isinstance(img, numbers.Number):
+        if base_shape == 0 and isinstance(img, numbers.Number):
             pass
-        elif   isinstance(img,np.ndarray) and base_shape== TensorShape(img.shape):
+        elif isinstance(img, np.ndarray) and base_shape == TensorShape(img.shape):
             pass
         else:
             print(img.shape)
             result = False
     return True
 
 
-
 def add_noise(intensity=0.1):
     return AddNoise(intensity=intensity)
 
 
 def normalize(mean, std):
-    return Normalize(mean=mean,std=std)
+    return Normalize(mean=mean, std=std)
 
 
 def unnormalize(mean, std):
-    return Unnormalize(mean=mean,std=std)
+    return Unnormalize(mean=mean, std=std)
+
 
 #
 # 0: Nearest-neighbor
 # 1: Bi-linear (default)
 # 2: Bi-quadratic
 # 3: Bi-cubic
 # 4: Bi-quartic
 # 5: Bi-quintic
 
 # all size is HWC or (H,W)
 def resize(size, keep_aspect=True, order=1, align_corner=True):
-    interpolation=cv2.INTER_LINEAR if order==1 else cv2.INTER_NEAREST
-    return Resize(size, keep_aspect=keep_aspect,interpolation=interpolation, align_corner=align_corner)
+    interpolation = cv2.INTER_LINEAR if order == 1 else cv2.INTER_NEAREST
+    return Resize(size, keep_aspect=keep_aspect, interpolation=interpolation, align_corner=align_corner)
 
 
 def rescale(scale, order=1):
     interpolation = cv2.INTER_LINEAR if order == 1 else cv2.INTER_NEAREST
-    return Rescale(scale=scale,interpolation=interpolation)
+    return Rescale(scale=scale, interpolation=interpolation)
+
 
 def random_rescale_crop(h, w, scale=(0.5, 2), order=1):
     interpolation = cv2.INTER_LINEAR if order == 1 else cv2.INTER_NEAREST
-    return RandomRescaleCrop(output_size=(h,w),scale_range=scale,interpolation=interpolation)
+    return RandomRescaleCrop(output_size=(h, w), scale_range=scale, interpolation=interpolation)
 
 
-def random_center_crop(h,w, scale=(0.8, 1.2), order=1):
+def random_center_crop(h, w, scale=(0.8, 1.2), order=1):
     interpolation = cv2.INTER_LINEAR if order == 1 else cv2.INTER_NEAREST
-    return RandomCenterCrop(output_size=(h,w),scale_range=scale,interpolation=interpolation)
+    return RandomCenterCrop(output_size=(h, w), scale_range=scale, interpolation=interpolation)
 
 
 def random_crop(h, w):
-    return RandomCrop(output_size=(h,w))
-
+    return RandomCrop(output_size=(h, w))
 
 
-def random_transform(rotation_range= 15, zoom_range= 0.02, shift_range= 0.02,shear_range = 0.2,   random_flip= 0.15):
-    return RandomTransformAffine(rotation_range=rotation_range,zoom_range=zoom_range,shift_range=shift_range,shear_range=shear_range,random_flip=random_flip)
-
+def random_transform(rotation_range=15, zoom_range=0.02, shift_range=0.02, shear_range=0.2, random_flip=0.15):
+    return RandomTransformAffine(rotation_range=rotation_range, zoom_range=zoom_range, shift_range=shift_range,
+                                 shear_range=shear_range, random_flip=random_flip)
 
 
 def horizontal_flip():
     return HorizontalFlip()
 
 
 def random_mirror():
     return RandomMirror()
 
 
-
 def downsample_then_upsample(scale=4, order=1, repeat=1):
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         for i in range(repeat):
             image = rescale(scale=1.0 / scale)(image)
             image = rescale(scale=scale)(image)
         return image
 
     return img_op
 
@@ -193,71 +177,71 @@
 def random_invert_color():
     return RandomInvertColor()
 
 
 def gray_scale():
     return GrayScale()
 
+
 def random_gray_scale():
     return RandomGrayScale()
 
+
 def to_rgb():
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
 
         if len(image.shape) == 2:
             image = np.expand_dims(image, -1)
             image = np.concatenate([image, image, image], -1)
             return image
 
         elif len(image.shape) == 3:
-            if image.shape[0] in (1,3, 4) and image.shape[-1] >4:
+            if image.shape[0] in (1, 3, 4) and image.shape[-1] > 4:
                 image = image.transpose([1, 2, 0])
             if image.shape[-1] in (3, 4):
-                image = image[:,:, :3]
-            elif  image.shape[-1] ==1:
-               image = np.concatenate([image, image, image], -1)
+                image = image[:, :, :3]
+            elif image.shape[-1] == 1:
+                image = np.concatenate([image, image, image], -1)
             return image
 
         return image
 
     return img_op
 
 
 def to_bgr():
-    def img_op(image: np.ndarray,**kwargs):
-        if len(image.shape) == 2 :
+    def img_op(image: np.ndarray, **kwargs):
+        if len(image.shape) == 2:
             image = np.expand_dims(image, -1)
             image = np.concatenate([image, image, image], -1)
             return image
         elif image.ndim == 3:
-            if image.shape[0] in (1,3, 4) and image.shape[-1] >4:
+            if image.shape[0] in (1, 3, 4) and image.shape[-1] > 4:
                 image = image.transpose([1, 2, 0])
             if image.shape[-1] in (3, 4):
                 if image.shape[0] == 4:
-                    image = image[:, :,:3]
+                    image = image[:, :, :3]
                 image = image[..., ::-1]
-            elif  image.shape[-1] ==1:
-               image = np.concatenate([image, image, image], -1)
+            elif image.shape[-1] == 1:
+                image = np.concatenate([image, image, image], -1)
             return image
 
         return image
 
     return img_op
 
 
 def adjust_brightness(value):
     return AdjustBrightness(value=value)
 
 
-
 def adjust_saturation(value):
     return AdjustSaturation(value=value)
 
 
-
 def adjust_contrast(value):
     return AdjustContrast(value=value)
 
 
 def adjust_brightness_contrast(brightness=255, contrast=127):
     """
 
@@ -265,21 +249,21 @@
         brightness ():       -255~255
         contrast (float):   -127~127
 
     Returns:
 
     """
 
-
     def map(x, in_min, in_max, out_min, out_max):
         return float((x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min)
 
     brightness = map(brightness, 0, 510.0, -255.0, 255.0)
     contrast = map(contrast, 0.0, 254.0, -127.0, 127.0)
-    def img_op(image: np.ndarray,**kwargs):
+
+    def img_op(image: np.ndarray, **kwargs):
         if brightness != 0:
             if brightness > 0:
                 shadow = brightness
                 highlight = 255
             else:
                 shadow = 0
                 highlight = 255 + brightness
@@ -293,108 +277,108 @@
         if contrast != 0:
             f = float(131 * (contrast + 127)) / (127 * (131 - contrast))
             alpha_c = f
             gamma_c = 127 * (1 - f)
             image = image * alpha_c + image * 0 + gamma_c
 
         return image
+
     return img_op
 
 
 def adjust_gamma(gamma=1):
-    def img_op(image: np.ndarray,**kwargs):
-        return exposure.adjust_gamma(image/255.0, gamma)*255.0
+    def img_op(image: np.ndarray, **kwargs):
+        return exposure.adjust_gamma(image / 255.0, gamma) * 255.0
 
     return img_op
 
 
 def random_adjust_gamma(gamma=(0.6, 1.4)):
-    gamma_range=gamma
-    def img_op(image: np.ndarray,**kwargs):
-        image=np.clip(image,0.0,255.0)
+    gamma_range = gamma
+
+    def img_op(image: np.ndarray, **kwargs):
+        image = np.clip(image, 0.0, 255.0)
         gammamin, gammamax = gamma_range
-        avg_pix=image.mean()
-        if avg_pix>220:
-            gammamax=builtins.max(gammamin,1)
-        elif avg_pix<30:
+        avg_pix = image.mean()
+        if avg_pix > 220:
+            gammamax = builtins.max(gammamin, 1)
+        elif avg_pix < 30:
             gammamin = builtins.min(1, gammamax)
 
         gamma = np.random.choice(np.arange(gammamin, gammamax, 0.01))
-        return exposure.adjust_gamma(image/255.0, gamma)*255.0
+        return exposure.adjust_gamma(image / 255.0, gamma) * 255.0
 
     return img_op
 
 
-
 def random_adjust_contrast(scale=(0.5, 1.5)):
     return RandomAdjustContrast(value_range=scale)
 
 
 def random_adjust_hue(hue_range=(-20, 20), saturation_range=(0.5, 1.5), lightness_range=(-50, 50)):
-    return RandomAdjustHue(value_range=(0,0.5))
+    return RandomAdjustHue(value_range=(0, 0.5))
 
 
 def auto_level():
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         minv = np.percentile(image, 5)
         maxv = np.percentile(image, 95)
         if maxv - minv < 40:
             minv = image.min()
             maxv = image.max()
 
         image = np.clip((image - minv) * (255.0 / (maxv - minv)), 0, 255)
         return image.astype(np.float32)
 
     return img_op
 
 
-
 def image_backend_adaption(image):
-    if  get_backend() == 'tensorflow':
-        if image.ndim==2: #gray-scale image
-            image=np.expand_dims(image,-1).astype(np.float32)
-        elif image.ndim in (3,4):
-            image=image.astype(np.float32)
+    if get_backend() == 'tensorflow':
+        if image.ndim == 2:  # gray-scale image
+            image = np.expand_dims(image, -1).astype(np.float32)
+        elif image.ndim in (3, 4):
+            image = image.astype(np.float32)
     else:
-        if image.ndim==2: #gray-scale image
-            image=np.expand_dims(image,0).astype(np.float32)
-        elif image.ndim==3:
+        if image.ndim == 2:  # gray-scale image
+            image = np.expand_dims(image, 0).astype(np.float32)
+        elif image.ndim == 3:
             image = np.transpose(image, [2, 0, 1]).astype(np.float32)
-        elif image.ndim==4:
+        elif image.ndim == 4:
             image = np.transpose(image, [0, 3, 1, 2]).astype(np.float32)
     return image
 
 
 def reverse_image_backend_adaption(image):
-    image=to_numpy(image)
-    if get_backend() =='pytorch' and len( int_shape(image))== 3 and int_shape(image)[0] in [3, 4]:
+    image = to_numpy(image)
+    if get_backend() == 'pytorch' and len(int_shape(image)) == 3 and int_shape(image)[0] in [3, 4]:
         image = np.transpose(image, [1, 2, 0]).astype(np.float32)
-    elif get_backend() =='pytorch'  and len( int_shape(image))== 4 and int_shape(image)[1] in [3, 4]:
+    elif get_backend() == 'pytorch' and len(int_shape(image)) == 4 and int_shape(image)[1] in [3, 4]:
         image = np.transpose(image, [0, 2, 3, 1]).astype(np.float32)
     return image
 
 
 def random_channel_shift(intensity=0.15):
     channel_axis = -1
     inten = intensity
-    def img_op(image: np.ndarray,**kwargs):
+
+    def img_op(image: np.ndarray, **kwargs):
         image = np.rollaxis(image, channel_axis, channel_axis)
         min_x, max_x = np.min(image), np.max(image)
         intensity = max_x / 255 * inten
         channel_images = [np.clip(x_channel + np.random.uniform(-intensity, intensity), min_x, max_x) for x_channel in
                           image.shape[-1]]
         x = np.stack(channel_images, axis=channel_axis)
         x = np.rollaxis(x, 0, channel_axis + 1)
         return x
 
     return img_op
 
 
-
-def random_erasing(size_range=(0.02,0.3),transparency_range=(0.4,0.8),transparancy_ratio=0.5):
+def random_erasing(size_range=(0.02, 0.3), transparency_range=(0.4, 0.8), transparancy_ratio=0.5):
     return RandomErasing
 
 
 def random_cutout(img, mask):
     h, w = img.shape[:2] if get_backend() == 'tensorflow' or len(img.shape) == 2 else img.shape[1:3]
     cutx = random.choice(range(0, w // 4))
     cuty = random.choice(range(0, h // 4))
@@ -415,18 +399,17 @@
         block = np.expand_dims(0, block)
         block = np.concatenate([block, block, block], axis=0)
         img[:, offsety:min(offsety + cuty, img.shape[0]), offsetx:min(offsetx + cutx, img.shape[1])] = block
         mask[offsety:min(offsety + cuty, mask.shape[0]), offsetx:min(offsetx + cutx, mask.shape[1])] = 0
     return img, mask
 
 
-
 ## denoise, smooth,
 def clahe(clip_limit=0.1, nbins=16):
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         image = image.astype(np.float32) / 255.0
         if image.max() - image.min() > 0.2:
             image = exposure.equalize_adapthist(image, clip_limit=clip_limit, nbins=nbins)
         return image * 255.0
 
     return img_op
 
@@ -440,56 +423,55 @@
         repeat (int): the number of repeating operation.
 
     Returns:
         output image array
 
     """
 
-
-    return ImageDilation(filter_size=filter_size,repeat=repeat)
+    return ImageDilation(filter_size=filter_size, repeat=repeat)
 
 
 def image_dilation(filter_size=3, repeat=1):
     """ Dilation operation
     Dilation is a mathematical morphology operation that uses a structuring element for expanding the shapes in an image. The binary dilation of an image by a structuring element is the locus of the points covered by the structuring element, when its center lies within the non-zero points of the image.
 
     Args:
         filter_size (int): the size of the structuring element .
         repeat (int): the number of repeating operation.
 
     Returns:
         output image array
 
     """
-    return  ImageErosion(filter_size=filter_size, repeat=repeat)
+    return ImageErosion(filter_size=filter_size, repeat=repeat)
 
 
 def erosion_then_dilation(filter_size=3, repeat=1):
-    def img_op(image: np.ndarray,**kwargs):
-        structure_shape=[1]*image.ndim
-        structure_shape[0]=filter_size
+    def img_op(image: np.ndarray, **kwargs):
+        structure_shape = [1] * image.ndim
+        structure_shape[0] = filter_size
         structure_shape[1] = filter_size
         for i in range(repeat):
-            image = ndimage.morphology.grey_erosion(image, size=(filter_size,filter_size), structure=np.ones(tuple(structure_shape)))
-            image=clip(image, 0, 255)
-            image = ndimage.morphology.grey_dilation(image, size=(filter_size,filter_size), structure=np.ones(tuple(structure_shape)))
+            image = grey_erosion(image, size=(filter_size, filter_size), structure=np.ones(tuple(structure_shape)))
+            image = clip(image, 0, 255)
+            image = grey_dilation(image, size=(filter_size, filter_size), structure=np.ones(tuple(structure_shape)))
             image = clip(image, 0, 255)
         return image
 
     return img_op
 
 
 def dilation_then_erosion(filter_size=3, repeat=1):
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         structure_shape = [1] * image.ndim
-        structure_shape[0]=filter_size
+        structure_shape[0] = filter_size
         structure_shape[1] = filter_size
         for i in range(repeat):
-            image = ndimage.morphology.grey_dilation(image, size=(filter_size,filter_size), structure=np.ones(tuple(structure_shape)))
-            image = ndimage.morphology.grey_erosion(image, size=(filter_size,filter_size), structure=np.ones(tuple(structure_shape)))
+            image = grey_dilation(image, size=(filter_size, filter_size), structure=np.ones(tuple(structure_shape)))
+            image = grey_erosion(image, size=(filter_size, filter_size), structure=np.ones(tuple(structure_shape)))
         return image
 
     return img_op
 
 
 def adaptive_binarization(threshold_type='otsu'):
     # def img_op(image: np.ndarray,**kwargs):
@@ -541,39 +523,39 @@
     #
     #     return image
 
     return AdaptiveBinarization(threshold_type=threshold_type)
 
 
 def blur(sigma=0.3):
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         if len(image.shape) > 2 and image.shape[-1] in (3, 4):
             image = gaussian(image.astype(np.float32), sigma=sigma, multichannel=True, preserve_range=True)
         else:
             image = gaussian(image.astype(np.float32), sigma=sigma, multichannel=False, preserve_range=True)
         return image
 
     return img_op
 
 
 def random_blur(sigma=(0.1, 0.6)):
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         n = random.randint(0, 3)
         if n == 0:
             return image
         else:
             image = gaussian(image.astype(np.float32), sigma=np.random.choice(np.arange(sigma[0], sigma[1], 0.05)),
                              multichannel=True)
         return image
 
     return img_op
 
 
 def channel_reverse():
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         if image.ndim == 4:
             image = image[..., ::-1]
         elif image.ndim == 3:
             image = image[:, :, ::-1]
         return image
 
     return img_op
@@ -587,18 +569,16 @@
     T = [[1, 0, t[0]], [0, 1, t[1]], [0, 0, 1]]
     R = [[np.cos(rad), -np.sin(rad), 0], [np.sin(rad), np.cos(rad), 0], [0, 0, 1]]
     C_prime = [[1, 0, -c[0]], [0, 1, -c[1]], [0, 0, 1]]
     M = np.dot(C_prime, np.dot(T, np.dot(R, np.dot(S, C))))
     return M
 
 
-
-
 def to_low_resolution(scale=2):
-    def img_op(image: np.ndarray,**kwargs):
+    def img_op(image: np.ndarray, **kwargs):
         rnd = random.randint(0, 10)
         if rnd == 0:
             image = rescale(1 / scale)(image)
         elif rnd % 3 == 0:
             image = downsample_then_upsample(scale + 2)(image)
             image = add_noise(0.02)(image)
             image = rescale(1 / scale)(image)
@@ -610,16 +590,14 @@
             image = downsample_then_upsample(scale, repeat=2)(image)
             image = add_noise(0.02)(image)
             image = rescale(1 / scale)(image)
         return image
 
     return img_op
 
-
-
 # def image_smoothening():
 #     def img_op(image: np.ndarray,**kwargs):
 #         ret1, th1 = cv2.threshold(img, BINARY_THREHOLD, 255, cv2.THRESH_BINARY)
 #         ret2, th2 = cv2.threshold(th1, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)
 #         blur = cv2.GaussianBlur(th2, (1, 1), 0)
 #         ret3, th3 = cv2.threshold(blur, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)
 #         return th3
@@ -701,14 +679,7 @@
 #     image = np.clip(image*255,0,255).astype(np.uint8)
 #     return image
 #
 #
 
 #
 #
-
-
-
-
-
-
-
```

## trident/data/mask_common.py

```diff
@@ -1,37 +1,21 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
 
-import math
-import os
 import random
-import re
-from itertools import repeat
 
 import numpy as np
-import six
-from scipy import misc, ndimage
+from scipy import ndimage
 from skimage import color
-from skimage import exposure
-from skimage import morphology
-from skimage import transform, exposure
-from skimage.filters import *
 
 from trident.backend.common import *
 from trident.backend.tensorspec import *
-
-
-if get_image_backend()=='opencv':
-    from trident.backend.opencv_backend import *
-else:
-    from trident.backend.pillow_backend import *
-
 from trident.backend.common import get_backend
-from trident.data.label_common import check_is_onehot,get_onehot
+from trident.data.label_common import check_is_onehot
 from trident.misc.visualization_utils import generate_palette
 
 __all__ = ['mask2trimap','color2label','label2color','mask_backend_adaptive']
```

## trident/data/transform.py

```diff
@@ -1,11 +1,11 @@
 import numbers
 import random
 from abc import ABC, abstractmethod
-from collections import Iterable
+from collections.abc import Iterable
 from typing import Sequence, Tuple, Dict, Union, Optional, Callable, Any
 import collections
 
 import matplotlib.pyplot as plt
 import  numpy as np
 import cv2
```

## trident/layers/pytorch_layers.py

```diff
@@ -807,15 +807,15 @@
             # channel_multiplier = int(self.num_filters // self.groups) if self.depth_multiplier is None else self.depth_multiplier  # default channel_multiplier
 
             if self.transposed:
                 self.weight = Parameter(
                     torch.Tensor(int(self.input_filters), self.num_filters // self.groups, *self.kernel_size).to(self.get_root().device))
             else:
                 self.weight = Parameter(
-                    torch.Tensor(int(self.num_filters), self.input_filters // self.groups, *self.kernel_size).to(self.get_root().device))  #
+                    torch.Tensor(int(self.num_filters), self.input_filters // self.groups, *self.kernel_size).to(self.device))  #
 
                 if self.separable:
                     self.pointwise = Parameter(
                         torch.Tensor(int(self.input_filters * self.depth_multiplier), int(self.num_filters), 1, 1).to(self.get_root().device))
 
             xavier_uniform(self.weight, gain=1)
 
@@ -1389,32 +1389,23 @@
         super(SeparableConv1d, self).__init__(rank, kernel_size, num_filters, strides, auto_pad, padding, padding_mode,
                                               use_bias,
                                               dilation, groups, transposed=False, name=name,
                                               depth_multiplier=depth_multiplier,
                                               depthwise=True, separable=True, keep_output=keep_output, **kwargs)
 
         self.activation = get_activation(activation)
-        self.conv1 = None
-        self.pointwise = None
 
-    def build(self, input_shape: TensorShape):
-        if self._built == False or self.conv1 is None:
-            if self.num_filters is None:
-                self.num_filters = self.input_filters * self.depth_multiplier if self.depth_multiplier is not None else self.num_filters
-            self.conv1 = DepthwiseConv1d(kernel_size=self.kernel_size, depth_multiplier=self.depth_multiplier,
-                                         strides=self.strides, auto_pad=self.auto_pad, padding_mode=self.padding_mode,
-                                         activation=self.activation, dilation=self.dilation, use_bias=self.use_bias)
-            self.pointwise = Conv1d(kernel_size=1, num_filters=self.num_filters, strides=1, use_bias=self.use_bias,
-                                    dilation=1, groups=1)
-            self.to(self.device)
-            self._built = True
+
+    def conv1d_forward(self, x, **kwargs):
+        x = F.pad(x, self.padding, mode='constant' if self.padding_mode == 'zero' else self.padding_mode)
+        return F.conv1d(x, self.weight, self.bias, self.strides, _single(0), self.dilation, self.groups)
 
     def forward(self, x, **kwargs):
-        x = self.conv1(x)
-        x = self.pointwise(x)
+        x = self.conv1d_forward(x)
+        x = F.conv1d(x, self.pointwise, self.bias, 1, _pair(0), 1, 1)
         if self.activation is not None:
             x = self.activation(x)
         return x
 
 
 class SeparableConv2d(_ConvNd):
     def __init__(self, kernel_size, num_filters=None, depth_multiplier=1, strides=1, auto_pad=True, padding=None,
@@ -1437,33 +1428,45 @@
         super(SeparableConv2d, self).__init__(rank, kernel_size, num_filters, strides, auto_pad, padding, padding_mode,
                                               use_bias,
                                               dilation, groups, transposed=False, name=name,
                                               depth_multiplier=depth_multiplier,
                                               depthwise=True, separable=True, keep_output=keep_output, **kwargs)
 
         self.activation = get_activation(activation)
-        self.pointwise = None
+        #self.pointwise =Conv2d(kernel_size=(1, 1), num_filters=self.num_filters, strides=1, use_bias=self.use_bias, dilation=1, groups=1)
         self._built = False
 
-    def build(self, input_shape: TensorShape):
-        if self._built == False or self.conv1 is None:
-            if self.num_filters is None:
-                self.num_filters = self.input_filters * self.depth_multiplier if self.depth_multiplier is not None else self.num_filters
-            self.conv1 = DepthwiseConv2d(kernel_size=self.kernel_size, depth_multiplier=self.depth_multiplier,
-                                         strides=self.strides, auto_pad=self.auto_pad, padding_mode=self.padding_mode,
-                                         activation=self.activation, dilation=self.dilation, use_bias=self.use_bias)
-            self.pointwise = Conv2d(kernel_size=(1, 1), num_filters=self.num_filters, strides=1, use_bias=self.use_bias,
-                                    dilation=1, groups=1)
-            self.to(self.device)
-            self._built = True
+    # def build(self, input_shape: TensorShape):
+    #     if self._built == False or self.conv1 is None:
+    #         if self.num_filters is None:
+    #             self.num_filters = self.input_filters * self.depth_multiplier if self.depth_multiplier is not None else self.num_filters
+    #         self.conv1 = DepthwiseConv2d(kernel_size=self.kernel_size, depth_multiplier=self.depth_multiplier,
+    #                                      strides=self.strides, auto_pad=self.auto_pad, padding_mode=self.padding_mode,
+    #                                      activation=self.activation, dilation=self.dilation, use_bias=self.use_bias)
+    #         self.pointwise = Conv2d(kernel_size=(1, 1), num_filters=self.num_filters, strides=1, use_bias=self.use_bias,
+    #                                 dilation=1, groups=1)
+    #         self.to(self.device)
+    #         self._built = True
 
+    def conv2d_forward(self, x, **kwargs):
+        self.rank = 2
+        if len(self.padding) == self.rank:
+            self.padding = (self.padding[1], self.padding[1], self.padding[0], self.padding[0])
+        if self.padding_mode == 'circular':
+            expanded_padding = (
+            (self.padding[0] + 1) // 2, self.padding[1] // 2, (self.padding[2] + 1) // 2, self.padding[3] // 2)
+            x = F.pad(x, expanded_padding, mode='circular')
+        else:
+            x = F.pad(x, self.padding, mode='constant' if self.padding_mode == 'zero' else self.padding_mode)
+
+        return F.conv2d(x, self.weight, self.bias, self.strides, _pair(0), self.dilation, self.groups)
     def forward(self, x, **kwargs):
 
-        x = self.conv1(x)
-        x = self.pointwise(x)
+        x = self.conv2d_forward(x)
+        x = F.conv2d(x, self.pointwise, self.bias, 1, _pair(0), 1, 1)
 
         return x
 
 
 class SeparableConv3d(_ConvNd):
     def __init__(self, kernel_size, num_filters=None, depth_multiplier=1, strides=1, auto_pad=True, padding=None,
                  padding_mode='zero', activation=None,
@@ -1485,33 +1488,34 @@
         super(SeparableConv3d, self).__init__(rank, kernel_size, num_filters, strides, auto_pad, padding, padding_mode,
                                               use_bias,
                                               dilation, groups, transposed=False, name=name,
                                               depth_multiplier=depth_multiplier,
                                               depthwise=True, separable=True, keep_output=keep_output, **kwargs)
 
         self.activation = get_activation(activation)
-        self.pointwise = None
 
-    def build(self, input_shape: TensorShape):
-        if self._built == False or self.conv1 is None:
-            self.num_filters = self.input_filters * self.depth_multiplier if self.depth_multiplier is not None else self.num_filters
-            self.conv1 = DepthwiseConv3d(kernel_size=self.kernel_size, depth_multiplier=self.depth_multiplier,
-                                         strides=self.strides, auto_pad=self.auto_pad, padding_mode=self.padding_mode,
-                                         dilation=self.dilation, groups=self.input_filters, bias=self.use_bias)
-            self.pointwise = Conv3d(kernel_size=(1, 1, 1), depth_multiplier=1, strides=1, use_bias=self.use_bias,
-                                    dilation=1,
-                                    groups=1)
 
-            self.to(self.device)
-            self._built = True
+
+    def conv3d_forward(self, x, **kwargs):
+        if self.padding_mode == 'circular':
+            expanded_padding = (
+                (self.padding[2] + 1) // 2, self.padding[2] // 2, (self.padding[1] + 1) // 2, self.padding[1] // 2,
+                (self.padding[0] + 1) // 2, self.padding[0] // 2)
+            x = F.pad(x, expanded_padding, mode='circular')
+        else:
+            x = F.pad(x, (
+            self.padding[2], self.padding[2], self.padding[1], self.padding[1], self.padding[0], self.padding[0]),
+                      mode='constant' if self.padding_mode == 'zero' else self.padding_mode)
+
+        return F.conv3d(x, self.weight, self.bias, self.strides, _triple(0), self.dilation, self.groups)
 
     def forward(self, x, **kwargs):
 
-        x = self.conv1(x)
-        x = self.pointwise(x)
+        x = self.conv3d_forward(x)
+        x = F.conv3d(x, self.pointwise, self.bias, 1, _triple(0), 1, 1)
         if self.activation is not None:
             x = self.activation(x)
         return x
 
 
 class DepthwiseConv1d(_ConvNd):
     def __init__(self, kernel_size, depth_multiplier=1, strides=1, auto_pad=True, padding=None, padding_mode='zero',
@@ -2397,34 +2401,67 @@
         else:
             info = 'size=' + str(self.size)
         info += ', mode=' + self.mode
         return info
 
 
 class Upsampling2d(Layer):
-    def __init__(self, size=None, scale_factor=None, mode='nearest', align_corners=True, name=None, keep_output=False,
+    def __init__(self, size=None, scale_factor=None, mode='nearest', align_corners=None, antialias: bool = False, name=None, keep_output=False,
                  **kwargs):
+        """
+
+        Args:
+            size (int or Tuple[int] or Tuple[int, int] or Tuple[int, int, int]):
+            output spatial size.
+            scale_factor (float or Tuple[float]): multiplier for spatial size. If `scale_factor` is a tuple,
+            its length has to match the number of spatial dimensions; `input.dim() - 2`.
+            mode: algorithm used for upsampling:
+            ``'nearest'`` | ``'linear'`` | ``'bilinear'`` | ``'bicubic'`` |
+            ``'trilinear'`` | ``'area'`` | ``'nearest-exact'`` | ``'pixel-shuffle'``. Default: ``'nearest'``
+            align_corners:
+            antialias:
+            name:
+            keep_output:
+            **kwargs:
+        """
         super(Upsampling2d, self).__init__(keep_output=keep_output, name=name)
+        self.mode = mode
+        if mode in ("nearest", "area", "nearest-exact"):
+            if align_corners is not None:
+                align_corners =None
+        else:
+            if align_corners is None:
+                align_corners = False
+
         self.rank = 2
         self.size = size
+
         if isinstance(scale_factor, tuple):
-            self.scale_factor = tuple(float(factor) for factor in scale_factor)
+            if self.mode == 'pixel_shuffle':
+                self.scale_factor=int(scale_factor[0])
+            else:
+                self.scale_factor = tuple(float(factor) for factor in scale_factor)
         else:
-            self.scale_factor = float(scale_factor) if scale_factor else None
-        self.mode = mode
+            if self.mode == 'pixel_shuffle':
+                self.scale_factor=int(scale_factor)
+            else:
+                self.scale_factor = [scale_factor for _ in range(self.rank)]
+
         self.align_corners = align_corners
+        self.antialias=antialias
+
 
     def forward(self, x, **kwargs):
 
         if self.mode == 'pixel_shuffle':
-            return F.pixel_shuffle(x, int(self.scale_factor))
+            return F.pixel_shuffle(concate([x]*int(self.scale_factor)**2,axis=1), int(self.scale_factor))
         elif self.mode == 'nearest':
             return F.interpolate(x, self.size, self.scale_factor, self.mode, None)
         else:
-            return F.interpolate(x, self.size, self.scale_factor, mode=self.mode, align_corners=self.align_corners)
+            return F.interpolate(x, self.size, self.scale_factor, mode=self.mode, align_corners=self.align_corners,antialias=self.antialias)
 
     def extra_repr(self):
         if self.scale_factor is not None:
             info = 'scale_factor=' + str(self.scale_factor)
         else:
             info = 'size=' + str(self.size)
         info += ', mode=' + self.mode
```

## trident/layers/pytorch_pooling.py

```diff
@@ -824,16 +824,15 @@
                 output_shape[3] = 1
                 self.output_shape = TensorShape(output_shape)
             else:
                 self.output_shape = TensorShape(input_shape[:2])
             self._built = True
 
     def forward(self, x, **kwargs):
-
-        x = x.mean(dim=[2,3], keepdim=self.keepdims)
+        x=reduce_mean(x,axis=[2,3],keepdims=self.keepdims)
         return x
 
 
 class AdaptiveAvgPool2d(Layer):
     r"""
      Applies a 2D adaptive average pooling over an input signal composed of
      several input planes.
```

## trident/layers/tensorflow_layers.py

```diff
@@ -411,17 +411,17 @@
                 >>> layer2=Scale(scale=to_tensor([1,2,3,4]),shift=0.5,power=1.2,mode='channel')
                 >>> output2 = layer2(x)
                 >>> tf.reduce_all(output2==pow((x*(to_tensor([1,2,3,4]).reshape((1,1,1,4)))+0.5),1.2))
                 <tf.Tensor: shape=(), dtype=bool, numpy=True>
     """
     def __init__(self, scale:(float,Tensor)=1.0, shift:(float,Tensor)=0.0, power:(float,Tensor)=1.0,mode='uniform',keep_output: bool=False,name:Optional[str] = None):
         super(Scale, self).__init__(keep_output=keep_output,name=name)
-        self._scale=to_tensor(scale)
-        self._shift=to_tensor(shift)
-        self._power=to_tensor(power)
+        self._scale=scale
+        self._shift=shift
+        self._power=power
 
         if mode == 'uniform' and (numel(self._scale)!=1 or numel(self._shift)!=1or numel(self._power)!=1):
             raise ValueError('Scale/ Shift/ Power should float, 0d Tensor or One element Tensor whem mode=uniform')
         if mode in [ 'uniform', 'channel', 'elementwise']:
             self.mode = mode
         else :
             raise ValueError('Only [uniform,channel,elementwise] is valid value for mode ')
@@ -429,44 +429,40 @@
     def build(self, input_shape:TensorShape):
         def remove_from(name:str,*dicts):
             for d in dicts:
                 if name in d:
                     del d[name]
         if self._built == False:
             if self.mode == 'uniform':
-                self.scale = Parameter(ones((1)).to(self.get_root().device) * self._scale, trainable=True)
-                self.shift = Parameter(ones((1)).to(self.get_root().device) * self._shift, trainable=True)
-                self.power = Parameter(ones((1)).to(self.get_root().device) * self._power, trainable=True)
+                self.weight_scale = Parameter(ones((1)).to(self.get_root().device) * self._scale, trainable=True)
+                self.weight_shift = Parameter(ones((1)).to(self.get_root().device) * self._shift, trainable=True)
+                self.weight_power = Parameter(ones((1)).to(self.get_root().device) * self._power, trainable=True)
             elif self.mode == 'constant':
-                self.scale = ones((1)).to(self.get_root().device) * self._scale
-                self.shift = ones((1)).to(self.get_root().device)  * self._shift
-                self.power = ones((1)).to(self.get_root().device) *  self._power
+                self.weight_scale = ones((1)).to(self.get_root().device) * self._scale
+                self.weight_shift = ones((1)).to(self.get_root().device)  * self._shift
+                self.weight_power = ones((1)).to(self.get_root().device) *  self._power
             elif self.mode == 'channel':
                 new_shape=[1,]*(input_shape.rank)
                 new_shape[self.filter_index]=self.input_filters
                 new_shape=tuple(new_shape[1:])
-                self.scale = Parameter(ones(new_shape).to(self.get_root().device)*self._scale,trainable=True)
-                self.shift = Parameter(ones(new_shape).to(self.get_root().device)*self._shift,trainable=True)
-                self.power = Parameter(ones(new_shape).to(self.get_root().device)*self._power,trainable=True)
+                self.weight_scale = Parameter(ones(new_shape).to(self.get_root().device)*self._scale,trainable=True)
+                self.weight_shift = Parameter(ones(new_shape).to(self.get_root().device)*self._shift,trainable=True)
+                self.weight_power = Parameter(ones(new_shape).to(self.get_root().device)*self._power,trainable=True)
             elif self.mode == 'elementwise':
                 new_shape = input_shape.dims[1:]
-                self.scale = Parameter(ones(new_shape).to(self.get_root().device) * self._scale, trainable=True)
-                self.shift = Parameter(ones(new_shape).to(self.get_root().device) * self._shift, trainable=True)
-                self.power = Parameter(ones(new_shape).to(self.get_root().device) * self._power, trainable=True)
-            remove_from('_scale',self.__dict__, self._buffers)
-            remove_from('_shift',self.__dict__, self._buffers)
-            remove_from('_power',self.__dict__, self._buffers)
+                self.weight_scale = Parameter(ones(new_shape).to(self.get_root().device) * self._scale, trainable=True)
+                self.weight_shift = Parameter(ones(new_shape).to(self.get_root().device) * self._shift, trainable=True)
+                self.weight_power = Parameter(ones(new_shape).to(self.get_root().device) * self._power, trainable=True)
+
             self._built = True
 
 
     def forward(self, x, **kwargs) -> tf.Tensor:
-        self.scale=self.scale.to(x.device)
-        self.shift=self.shift.to(x.device)
-        self.power=self.power.to(x.device)
-        x = pow(x * self.scale + self.shift, self.power)
+        x = x * self.scale + self.shift
+        x=sign(x)* pow(abs(x), self.weight_power)
         return x
 
 
 class Aggregation(Layer):
     """Flatten layer to flatten a tensor after convolution."""
 
     def __init__(self, mode='mean', axis=-1, keepdims=True, keep_output: bool = False, name: Optional[str] = None):
```

## trident/optims/losses.py

```diff
@@ -3,15 +3,15 @@
 from __future__ import print_function
 
 import sys
 from typing import Callable, Any
 
 import numpy as np
 import torch
-
+import trident.backend.dtype as Dtype
 from trident.backend.common import get_session, OrderedDict
 from trident.backend.tensorspec import *
 
 _session = get_session()
 _backend = _session.backend
 if _backend == 'pytorch':
     import torch
@@ -124,26 +124,31 @@
     #       shape = `[batch_size, d0, .. dN-1]`
     #
     #   Returns:
     #     Loss values with the shape `[batch_size, d0, .. dN-1]`.
     #   """
     #   NotImplementedError('Must be implemented in subclasses.')
 
-    def _get_reduction(self, loss):
+    def _get_reduction(self, loss:'Tensor'):
         reduction_axis = list(range(ndim(loss)))
         if ndim(loss) == 0 or self.reduction == 'none':
             return loss
         if ndim(loss) >= 2 and self.reduction == 'batch_sum':
             loss = reshape(loss, (int_shape(loss)[0], -1))
             return loss.sum(0).mean()
         elif ndim(loss) >= 2 and self.reduction == 'batch_mean':
             loss = reshape(loss, (int_shape(loss)[0], -1))
             return loss.mean(0).mean()
         elif self.reduction in ('mean', 'batch_mean'):
-            return loss.mean()
+            if loss.data.dtype == Dtype.float16:
+                loss=loss.view(-1)
+                loss=loss/len(loss)
+                return loss.sum()
+            else:
+                return loss.mean()
         elif self.reduction in ('sum', 'batch_sum'):
             return loss.sum()
         else:
             return loss.mean()
 
     def _handel_abnormal(self, loss):
         if any_abnormal_number(loss):
```

## trident/optims/pytorch_losses.py

```diff
@@ -87,15 +87,15 @@
 
 
 
 
 class _ClassificationLoss(Loss):
     """Calculate loss for  complex classification task."""
 
-    def __init__(self, axis=1, sample_weight=None, auto_balance=False, from_logits=False, ignore_index=-100,
+    def __init__(self, axis=1, sample_weight=None,  class_weight=None, auto_balance=False, from_logits=False, ignore_index=-100,
                  cutoff=None, label_smooth=False, reduction='mean', enable_ohem=False,
                  ohem_thresh=0.1, input_names=None, output_names=None,
                  name=None, **kwargs):
         """
 
         Args:
             axis (int): the position where the classes are.
```

## trident/optims/pytorch_optimizers.py

```diff
@@ -7,20 +7,21 @@
 import sys
 from collections import defaultdict
 import numpy as np
 import torch
 import torch.nn.functional as F
 import torch.optim as optim
 from torch.optim import optimizer, lbfgs, adagrad, adadelta, rmsprop, adam
-
+from trident.backend.common import PrintException
 from trident.backend.common import get_class, snake2camel
 from trident.backend.pytorch_ops import *
 
 __all__ = ['Adam', 'SGD', 'LBFGS', 'Adadelta', 'Adagrad', 'RMSprop', 'RAdam', 'PlainRAdam', 'AdamW', 'Lookahead',
-           'Ranger', 'Ranger21', 'RangerLars', 'AdaBelief', 'RangerAdaBelief', 'DiffGrad', 'Lamb', 'Lion','get_optimizer']
+           'Ranger', 'Ranger21', 'RangerLars', 'AdaBelief', 'RangerAdaBelief', 'DiffGrad', 'Lamb', 'Lion',
+           'get_optimizer']
 
 
 def cheb_steps(m, M, T):
     C, R = (M + m) / 2.0, (M - m) / 2.0
     thetas = (np.arange(T) + 0.5) / T * np.pi
     return 1.0 / (C - R * np.cos(thetas))
 
@@ -90,18 +91,18 @@
     """
 
     def __init__(self, params, defaults):
         super().__init__(params, defaults)
         self._base_lr = 1e-3
         if 'lr' in defaults:
             self._base_lr = defaults['lr']
-        self.use_adaptive_gradient_clipping = defaults.get('use_adaptive_gradient_clipping',False)
-        self.agc_clip_val=1e-2
-        self.agc_eps=1e-3
-        self.gradient_centralization = defaults.get('gradient_centralization',None)
+        self.use_adaptive_gradient_clipping = defaults.get('use_adaptive_gradient_clipping', False)
+        self.agc_clip_val = 1e-2
+        self.agc_eps = 1e-3
+        self.gradient_centralization = defaults.get('gradient_centralization', None)
 
     def adjust_learning_rate(self, new_lr, verbose=True):
         """
 
         Args:
             new_lr (float):  new learning rate value
             verbose (bool): if True, will print the learning rate change information.
@@ -1245,15 +1246,16 @@
         # N_sma_threshold of 5 seems better in testing than 4.
         # In both cases, worth testing on your dataset (.90 vs .95, 4 vs 5) to
         # make sure which works best for you.
 
         # prep defaults and init torch.optim base
         defaults = dict(lr=lr, alpha=alpha, k=k, step_counter=0, betas=betas,
                         N_sma_threshhold=N_sma_threshhold, eps=eps,
-                        weight_decay=weight_decay, gradient_centralization=gradient_centralization,use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
+                        weight_decay=weight_decay, gradient_centralization=gradient_centralization,
+                        use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
         super().__init__(params, defaults)
 
         # adjustable threshold
         self.N_sma_threshhold = N_sma_threshhold
 
         # now we can get to work...
         # removed as we now use step from RAdam...no need for
@@ -1485,15 +1487,15 @@
         self.use_cheb = use_cheb
         self.cheb_schedule = None
         if self.use_cheb:
             if self.total_iterations is None:
                 raise ValueError(
                     "can't produce chebs without num epochs info being passed in"
                 )
-            self.cheb_schedule = get_chebs(self.total_iterations//100)
+            self.cheb_schedule = get_chebs(self.total_iterations // 100)
 
         # self.total_iterations = num_epochs * num_batches_per_epoch
         # if not self.total_iterations:
         #     raise ValueError(
         #         "missing total iterations, which is calced from num epochs and num iters per epoch param"
         #     )
 
@@ -1502,16 +1504,15 @@
         # warmup - we'll use default recommended in Ma/Yarats unless user specifies num iterations
         # -=-=-=-=-=-=-=-=-=-=-=-=-=--=-=--=-=-
         self.use_warmup = use_warmup
         self.warmup_complete = False
         self.warmup_type = warmup_type
         self.warmup_pct_default = warmup_pct_default
 
-
-        if use_warmup==True and num_warmup_iterations is None:
+        if use_warmup == True and num_warmup_iterations is None:
             beta_warmup_iters = math.ceil(
                 (2 / (1 - betas[1]))
             )  # default untuned linear warmup
 
             beta_pct = beta_warmup_iters / self.total_iterations
             # print(f"beta_warmup_pct = {beta_pct}")
 
@@ -1520,15 +1521,15 @@
                 warmup_auto_pct = int(self.warmup_pct_default * self.total_iterations)
                 self.num_warmup_iters = warmup_auto_pct
             else:
                 self.num_warmup_iters = beta_warmup_iters
 
         else:  # user passed in specific num
             self.num_warmup_iters = num_warmup_iterations if num_warmup_iterations is not None else 0
-            self.use_warmup=True  if num_warmup_iterations is not None else False
+            self.use_warmup = True if num_warmup_iterations is not None else False
 
         # warm down
         self.min_lr = warmdown_min_lr
         self.warmdown_lr_delta = self._base_lr - self.min_lr
         self.warmdown_active = warmdown_active
 
         if self.warmdown_active:
@@ -1605,63 +1606,14 @@
         # don't use grad for lookahead weights
         # for w in it.chain(*self.slow_weights):
         #    w.requires_grad = False
 
     def __setstate__(self, state):
         super(Ranger21, self).__setstate__(state)
 
-    def unit_norm(self, x):
-        """ axis-based Euclidean norm"""
-        # verify shape
-        keepdim = True
-        dim = None
-        try:
-            xlen = len(x.shape)
-
-            # print(f"xlen = {xlen}")
-
-            if xlen <= 1:
-                keepdim = False
-            elif xlen in (2, 3):  # linear layers
-                dim = 1
-            elif xlen == 4:  # conv kernels
-                dim = (1, 2, 3)
-            else:
-                dim = tuple(
-                    [x for x in range(1, xlen)]
-                )  # create 1,..., xlen-1 tuple, while avoiding last dim ...
-
-            return x.norm(dim=dim, keepdim=keepdim, p=2.0)
-        except:
-            print(type(x), )
-            return x
-
-    def agc(self, p):
-        """clip gradient values in excess of the unitwise norm.
-        the hardcoded 1e-6 is simple stop from div by zero and no relation to standard optimizer eps
-        """
-
-        # params = [p for p in parameters if p.grad is not None]
-        # if not params:
-        #    return
-
-        # for p in params:
-        if p.grad is not None and p.dtype != torch.int64:
-            grad = p.grad
-            p_norm = self.unit_norm(p).clamp_(self.agc_eps)
-            g_norm = self.unit_norm(grad)
-
-            max_norm = p_norm * self.agc_clip_val
-
-            clipped_grad = grad * (max_norm / g_norm.clamp(min=1e-6))
-            if clipped_grad.device != grad.device:
-                grad.to(g_norm.device)
-                clipped_grad.to(g_norm.device)
-            new_grads = torch.where(g_norm > max_norm, clipped_grad, grad)
-            p.grad.detach().copy_(new_grads)
 
     def warmup_dampening(self, lr, step):
 
         style = self.warmup_type
         warmup = self.num_warmup_iters
 
         if style is None:
@@ -1791,27 +1743,28 @@
         global variance_ma_belief
         loss = None
 
         if closure is not None:
             with torch.enable_grad():
                 loss = closure()
 
-        param_size = 0
+        param_size = 1
         variance_ma_sum = 0.0
         for i, group in enumerate(self.param_groups):
             for j, p in enumerate(group["params"]):
                 if p.grad is None or not p.requires_grad:
                     continue
                 # cast data type
                 half_precision = False
                 if p.data.dtype == torch.float16:
                     half_precision = True
                     p.data = p.data.float()
                     p.grad = p.grad.float()
 
+                param_size += p.numel()
                 # apply agc if enabled
                 if self.agc_active:
                     self.agc(p)
 
                 grad = p.grad.data
 
                 if grad.is_sparse:
@@ -1898,28 +1851,31 @@
 
         # stable weight decay
         if self.use_madgrad:
             variance_normalized = torch.pow(variance_ma_sum / param_size, 1 / 3)
         else:
             variance_normalized = math.sqrt(variance_ma_sum / param_size)
             # variance_mean = variance_ma_sum / param_size
+
         if math.isnan(variance_normalized):
+            print(variance_normalized)
             raise RuntimeError("hit nan for variance_normalized")
 
         # print(f"variance_mean = {variance_mean}")
         # print(f"variance_normalized = {variance_normalized}")
         # else:
         #    variance_normalized = math.pow((variance_ma / self.param_size), .3333)
 
         # print(f"variance mean sqrt = {variance_normalized}")
 
         # phase 2 - apply weight decay and step
         # ===========================================
         for group in self.param_groups:
             # print(f"In second phase loop")
+
             step = state["step"]
 
             # Perform stable weight decay
             decay = group["weight_decay"]
             eps = group["eps"]
             lr = group["lr"]
             momentum = group["momentum"]
@@ -2021,15 +1977,15 @@
                     s.data.add_(inner_grad, alpha=lamb)
 
                     # Step
                     if momentum == 0:
                         p.data.copy_(x0.addcdiv(s, rms, value=-1))
                     else:
                         z = x0.addcdiv(s, rms, value=-1)
-
+                        ck = 1 - momentum
                         # p is a moving average of z
                         p.data.mul_(1 - ck).add_(z, alpha=ck)
 
                 else:  # adam with pnm core
                     # ============= adamW with pnm option ========================
 
                     grad = p.grad
@@ -2111,15 +2067,15 @@
 
 class RangerLars(Optimizer):
     """
     https://github.com/lessw2020/Ranger-Deep-Learning-Optimizer/blob/master/ranger/ranger.py
     """
 
     def __init__(self, params, lr=1e-3, betas=(0.9, 0.999), alpha=0.5, k=6, N_sma_threshhold=5, eps=1e-7,
-                 weight_decay=0, gradient_centralization=None, use_adaptive_gradient_clipping=False,**kwargs):
+                 weight_decay=0, gradient_centralization=None, use_adaptive_gradient_clipping=False, **kwargs):
         # parameter checks
         if not 0.0 <= alpha <= 1.0:
             raise ValueError('Invalid slow update rate: {alpha}')
         if not 1 <= k:
             raise ValueError('Invalid lookahead steps: {k}')
 
         if not lr > 0:
@@ -2130,15 +2086,16 @@
         self.N_sma_threshhold = N_sma_threshhold
         # parameter comments:
         # beta1 (momentum) of .95 seems to work better than .90...
         # N_sma_threshold of 5 seems better in testing than 4.
         # In both cases, worth testing on your dataset (.90 vs .95, 4 vs 5) to make sure which works best for you.
 
         # prep defaults and init torch.optim base
-        defaults = dict(lr=lr, alpha=alpha, k=k, betas=betas, eps=eps, weight_decay=weight_decay,use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
+        defaults = dict(lr=lr, alpha=alpha, k=k, betas=betas, eps=eps, weight_decay=weight_decay,
+                        use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
 
         super().__init__(params, defaults)
         # radam buffer for state
         self.radam_buffer = [[None, None, None] for ind in range(10)]
         self.alpha = alpha
         self.k = k
 
@@ -2336,15 +2293,15 @@
             lr=lr,
             momentum=momentum,
             use_nesterov=use_nesterov,
             weight_decay=weight_decay,
             exclude_from_weight_decay=exclude_from_weight_decay,
             exclude_from_layer_adaptation=exclude_from_layer_adaptation,
             classic_momentum=classic_momentum,
-            use_adaptive_gradient_clipping = use_adaptive_gradient_clipping,
+            use_adaptive_gradient_clipping=use_adaptive_gradient_clipping,
             eeta=eeta,
         )
 
         super(LARS, self).__init__(params, defaults)
         self.lr = lr
         self.momentum = momentum
         self.weight_decay = weight_decay
@@ -2498,15 +2455,15 @@
             when variance of gradient is high
 
     reference: AdaBelief Optimizer, adapting stepsizes by the belief in observed gradients, NeurIPS 2020
     """
 
     def __init__(self, params, lr=1e-3, betas=(0.9, 0.999), eps=1e-7,
                  weight_decay=0, amsgrad=False, weight_decouple=True, fixed_decay=False, rectify=True,
-                 degenerated_to_sgd=True,  use_adaptive_gradient_clipping=False,gradient_centralization=None, **kwargs):
+                 degenerated_to_sgd=True, use_adaptive_gradient_clipping=False, gradient_centralization=None, **kwargs):
         if not 0.0 <= lr:
             raise ValueError("Invalid learning rate: {}".format(lr))
         if not 0.0 <= eps:
             raise ValueError("Invalid epsilon value: {}".format(eps))
         if not 0.0 <= betas[0] < 1.0:
             raise ValueError("Invalid beta parameter at index 0: {}".format(betas[0]))
         if not 0.0 <= betas[1] < 1.0:
@@ -2514,15 +2471,16 @@
 
         if isinstance(params, (list, tuple)) and len(params) > 0 and isinstance(params[0], dict):
             for param in params:
                 if 'betas' in param and (param['betas'][0] != betas[0] or param['betas'][1] != betas[1]):
                     param['buffer'] = [[None, None, None] for _ in range(10)]
 
         defaults = dict(lr=lr, betas=betas, eps=eps,
-                        weight_decay=weight_decay, amsgrad=amsgrad, buffer=[[None, None, None] for _ in range(10)],use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
+                        weight_decay=weight_decay, amsgrad=amsgrad, buffer=[[None, None, None] for _ in range(10)],
+                        use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
         super(AdaBelief, self).__init__(params, defaults)
 
         self.degenerated_to_sgd = degenerated_to_sgd
         self.weight_decouple = weight_decouple
         self.rectify = rectify
         self.fixed_decay = fixed_decay
         self.gradient_centralization = gradient_centralization
@@ -2737,15 +2695,16 @@
     reference: AdaBelief Optimizer, adapting stepsizes by the belief in observed gradients, NeurIPS 2020
     """
 
     def __init__(self, params, lr=1e-3,  # lr
                  alpha=0.5, k=6, N_sma_threshhold=5,  # Ranger options
                  betas=(.95, 0.999), eps=1e-5, weight_decay=0,  # Adam options
                  # Gradient centralization on or off, applied to conv layers only or conv + fc layers
-                 adabelief=True, weight_decouple=True, use_adaptive_gradient_clipping=False, gradient_centralization=None, **kwargs):
+                 adabelief=True, weight_decouple=True, use_adaptive_gradient_clipping=False,
+                 gradient_centralization=None, **kwargs):
 
         if not 0.0 <= alpha <= 1.0:
             raise ValueError(f'Invalid slow update rate: {alpha}')
         if not 1 <= k:
             raise ValueError(f'Invalid lookahead steps: {k}')
         if not lr > 0:
             raise ValueError(f'Invalid Learning Rate: {lr}')
@@ -2755,15 +2714,16 @@
         # parameter comments:
         # beta1 (momentum) of .95 seems to work better than .90...
         # N_sma_threshold of 5 seems better in testing than 4.
         # In both cases, worth testing on your dataset (.90 vs .95, 4 vs 5) to make sure which works best for you.
 
         # prep defaults and init torch.optim base
         defaults = dict(lr=lr, alpha=alpha, k=k, step_counter=0, betas=betas,
-                        N_sma_threshhold=N_sma_threshhold, eps=eps, weight_decay=weight_decay,use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
+                        N_sma_threshhold=N_sma_threshhold, eps=eps, weight_decay=weight_decay,
+                        use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
         super().__init__(params, defaults)
 
         # adjustable threshold
         self.N_sma_threshhold = N_sma_threshhold
 
         # look ahead params
 
@@ -2957,26 +2917,28 @@
         https://arxiv.org/abs/1909.11015
     .. _Adam\: A Method for Stochastic Optimization:
         https://arxiv.org/abs/1412.6980
     .. _On the Convergence of Adam and Beyond:
         https://openreview.net/forum?id=ryQu7f-RZ
     """
 
-    def __init__(self, params, lr=1e-3, betas=(0.9, 0.999), eps=1e-7, weight_decay=0, use_adaptive_gradient_clipping=False,gradient_centralization=None):
+    def __init__(self, params, lr=1e-3, betas=(0.9, 0.999), eps=1e-7, weight_decay=0,
+                 use_adaptive_gradient_clipping=False, gradient_centralization=None):
         if not 0.0 <= lr:
             raise ValueError("Invalid learning rate: {}".format(lr))
         if not 0.0 <= eps:
             raise ValueError("Invalid epsilon value: {}".format(eps))
         if not 0.0 <= betas[0] < 1.0:
             raise ValueError("Invalid beta parameter at index 0: {}".format(betas[0]))
         if not 0.0 <= betas[1] < 1.0:
             raise ValueError("Invalid beta parameter at index 1: {}".format(betas[1]))
         self.gradient_centralization = gradient_centralization
         defaults = dict(lr=lr, betas=betas, eps=eps, weight_decay=weight_decay,
-                        gradient_centralization=gradient_centralization,use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
+                        gradient_centralization=gradient_centralization,
+                        use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
         super(DiffGrad, self).__init__(params, defaults)
 
     def __setstate__(self, state):
         super(DiffGrad, self).__setstate__(state)
 
     @torch.no_grad()
     def step(self, closure=None):
@@ -3020,16 +2982,15 @@
                     state['exp_avg_sq'] = torch.zeros_like(p_data_fp32)
                     # Previous gradient
                     state['previous_grad'] = torch.zeros_like(p_data_fp32)
 
                 exp_avg, exp_avg_sq, previous_grad = state['exp_avg'], state['exp_avg_sq'], state['previous_grad']
                 beta1, beta2 = group['betas']
 
-                if group['weight_decay'] != 0:
-                    grad.add_(p_data_fp32, alpha=group['weight_decay'])
+
 
                 if self.gradient_centralization in ['all', 'gcc']:
                     if ndim(grad) > 3:
                         grad = grad - grad.mean(axis=list(range(1, ndim(grad))), keepdims=True)
 
                 state['step'] += 1
 
@@ -3048,17 +3009,20 @@
                 # state['previous_grad'] = grad %used in paper but has the bug that previous grad is overwritten with grad and diff becomes always zero. Fixed in the next line.
                 state['previous_grad'] = grad.clone()
 
                 # update momentum with dfc
                 exp_avg1 = exp_avg * dfc
                 G_grad = true_divide(exp_avg1, denom)
 
-                # if self.gradient_centralization is not None:
-                #     if ndim(G_grad) > 1:
-                #         G_grad = G_grad - G_grad.mean(axis=list(range(1, ndim(G_grad))), keepdims=True)
+                if group['weight_decay'] != 0:
+                    G_grad.add_(p_data_fp32, alpha=group['weight_decay'])
+
+                if self.gradient_centralization is not None:
+                    if ndim(G_grad) > 1:
+                        G_grad = G_grad - G_grad.mean(axis=list(range(1, ndim(G_grad))), keepdims=True)
 
                 step_size = group['lr'] * math.sqrt(bias_correction2) / bias_correction1
 
                 p.data.add_(G_grad, alpha=-step_size)
 
                 if half_precision:
                     p.data = p.data.half()
@@ -3185,26 +3149,28 @@
 
 class Lion(Optimizer):
     r"""Implements Lion, EvoLved Sign Momentum
      new optimizer discovered by Google Brain that is purportedly better than Adam(w).
 
     """
 
-    def __init__(self, params, lr=1e-4, betas=(0.9, 0.999), eps=1e-7, weight_decay=0, use_adaptive_gradient_clipping=False,gradient_centralization=None):
+    def __init__(self, params, lr=1e-4, betas=(0.9, 0.999), eps=1e-7, weight_decay=0,
+                 use_adaptive_gradient_clipping=False, gradient_centralization=None):
         if not 0.0 <= lr:
             raise ValueError("Invalid learning rate: {}".format(lr))
         if not 0.0 <= eps:
             raise ValueError("Invalid epsilon value: {}".format(eps))
         if not 0.0 <= betas[0] < 1.0:
             raise ValueError("Invalid beta parameter at index 0: {}".format(betas[0]))
         if not 0.0 <= betas[1] < 1.0:
             raise ValueError("Invalid beta parameter at index 1: {}".format(betas[1]))
         self.gradient_centralization = gradient_centralization
         defaults = dict(lr=lr, betas=betas, eps=eps, weight_decay=weight_decay,
-                        gradient_centralization=gradient_centralization,use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
+                        gradient_centralization=gradient_centralization,
+                        use_adaptive_gradient_clipping=use_adaptive_gradient_clipping)
         super(Lion, self).__init__(params, defaults)
 
     def __setstate__(self, state):
         super(Lion, self).__setstate__(state)
 
     @torch.no_grad()
     def step(self, closure=None):
@@ -3256,32 +3222,30 @@
                 if self.gradient_centralization in ['all', 'gcc']:
                     if len(list(grad.size())) > 3:
                         grad.add_(-grad.mean(dim=tuple(range(1, len(list(grad.size())))), keepdim=True))
 
                 if group['weight_decay'] != 0:
                     grad.add_(p_data, alpha=group['weight_decay'])
 
-
-
                 # weight update
 
                 update = exp_avg.clone().lerp_(grad, 1 - beta1).sign_()
                 p.add_(update, alpha=- group['lr'])
 
                 # decay the momentum running average coefficient
 
                 exp_avg.lerp_(grad, 1 - beta2)
 
                 if half_precision:
                     p.data = p.data.half()
                     p.grad = p.grad.half()
 
-
         return loss
 
+
 def get_optimizer(optimizer_name):
     if optimizer_name is None:
         return None
     optimizer_modules = ['trident.optims.pytorch_optimizers', 'torch.optim']
     if optimizer_name in __all__:
         optimizer_class = get_class(optimizer_name, optimizer_modules)
         return optimizer_class
```

## Comparing `tridentx-0.7.6.dist-info/LICENSE` & `tridentx-0.7.7.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `tridentx-0.7.6.dist-info/METADATA` & `tridentx-0.7.7.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: tridentx
-Version: 0.7.6
+Version: 0.7.7
 Summary: Make pytorch and tensorflow two become one.
 Download-URL: https://test.pypi.org/project/tridentx
 Author: Allan Yiin
 Author-email: allanyiin.ai@gmail.com
 License: MIT
 Keywords: deep learning,machine learning,pytorch,tensorflow,AI
 Classifier: Development Status :: 4 - Beta
@@ -21,16 +21,16 @@
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
 Requires-Python: >=3.5
 Description-Content-Type: text/markdown
 License-File: LICENSE
 Requires-Dist: numpy (>=1.18)
 Requires-Dist: opencv-python
 Requires-Dist: six (>=1.13.0)
-Requires-Dist: scipy (>=1.2.0)
-Requires-Dist: scikit-image (>=0.15.0)
+Requires-Dist: scikit-image (>=0.19.0)
+Requires-Dist: scipy
 Requires-Dist: scikit-learn
 Requires-Dist: matplotlib (>=3.0.2)
 Requires-Dist: ipython (>=7.10.2)
 Requires-Dist: pillow (>=4.1.1)
 Requires-Dist: setuptools (>=42.0.1)
 Requires-Dist: onnx (>=1.4.1)
 Requires-Dist: tensorboard (>=1.15.0)
```

## Comparing `tridentx-0.7.6.dist-info/RECORD` & `tridentx-0.7.7.dist-info/RECORD`

 * *Files 9% similar despite different names*

```diff
@@ -1,81 +1,81 @@
-trident/__init__.py,sha256=zEn0HH56LAOSdtk7OCviniuURoOYabiB7ivrqCl0t4I,720
+trident/__init__.py,sha256=8f2w8ueNBGg4k4ABfcVfN_nNsV9F0nJCOAjuPiVLywI,720
 trident/context.py,sha256=V0thtRiSjTS5zfttwSghmbcU0RXRXIfZCv6pDqBTwOE,13441
 trident/readable_errors.py,sha256=6ojDsYaA2yOYWbB1zUgcrrueaPueK7G_NsM9v9ArUzI,41712
 trident/backend/__init__.py,sha256=4saH5Al7GTwMwIwXHdKi79UgesOKyslq4QtGB5zQKDU,3598
 trident/backend/common.py,sha256=hkaDWRWY8kG39eNn2jUSVFUzGnUNHWHzX3DbmccL2Co,64781
 trident/backend/decorators.py,sha256=l2EVAm_c-DjFZ6XMfR-_S9DMKJJk4YjZIDAvd4vJIIg,2048
 trident/backend/distribution.py,sha256=nq9i_W6rcaUJ2TKbXsGSrAPXucGZ0U1zvs7mBpXtkD0,13093
 trident/backend/dtype.py,sha256=C2ONYpHsvGV7VRSS6pUAXaoUPUrrUVUseTOPaZAHzCc,3621
 trident/backend/function.py,sha256=XNuDrRA6khPUEU0Gx5rqRqX06hJ-PTQhkSY_vPKKaV4,30444
 trident/backend/graph_tools.py,sha256=ZVZ8yuixvVCfd7nAHWlbm96GiOEOs4fgBZXeLjl-UiY,71540
 trident/backend/iteration_tools.py,sha256=bF6MtccDwS0JaU5l-7XHGR-VrJpy2u5rI-Lj4JdyN3s,28221
-trident/backend/jax_backend.py,sha256=_awRlbL66vz1dlusz2QwkVfvY7mU1BdP4g37qpxZjdE,105784
-trident/backend/jax_ops.py,sha256=Fqgowl9MLtCU6wesCagKb61nw0t_qzZdvcDAOIwO-rg,111490
+trident/backend/jax_backend.py,sha256=eSsWGV5BK4kiB2yuC_S55AEm3TnA0jmkAwMaeeJIuU8,105774
+trident/backend/jax_ops.py,sha256=RiPTlKn47_mlXDo2jTlOcjP-CWrooVvV_U4ruhQUJX8,112324
 trident/backend/jax_serialization.py,sha256=tEsJ0G9Mcc1pOVdyiSUA-1gmqr4S4SAX3pqzCW20q8Q,37076
 trident/backend/load_backend.py,sha256=TRTRV6-CTLJABOAdZJA35hzUws1WsvUhYCA8AQIikro,5169
-trident/backend/model.py,sha256=AxQ0vVn96Z1ZXiLm8-bxDqmLnhkROo7m8qWlctMIFvg,54142
-trident/backend/numpy_ops.py,sha256=Kx7Vox4SnbW-cKFQB2LkBggW7NGTAZGcwJeK-xTZAw4,129771
+trident/backend/model.py,sha256=o-4oA1PobojQzgsZ8xQBIa1KmkhvORYqhaAoOmh6rN8,54095
+trident/backend/numpy_ops.py,sha256=TRlV0ms16P52qX6D12xriWEqiGKVwxAtJo1pmMLnU_8,129775
 trident/backend/opencv_backend.py,sha256=1qKCn5uTBwewLQmcHC4J-VyUdwXvI-9ToCHm0823twQ,12911
 trident/backend/pillow_backend.py,sha256=i5OFJMSzCpSC3fH5_HWGrHFFgIPV7Vf1V10Hc0VV3vc,8181
-trident/backend/pytorch_backend.py,sha256=_Jssvvxj3sa_6g3Q3Wn_E-qv8QNGFtfeNjeL_We4NqQ,161801
-trident/backend/pytorch_ops.py,sha256=rMDpjnYvsV7DhrFd6s5Mj4X_NsIueLqQ4ayzPmqTGsA,186932
-trident/backend/tensorflow_backend.py,sha256=9ndUUua0HvX13GCoaiIvrpcev4URGspNSBMdP2F3xvk,161019
-trident/backend/tensorflow_ops.py,sha256=phHHS3iXZs5KbCNAzS21zWSfi2tmXmtzl1nPuXygNiw,172078
+trident/backend/pytorch_backend.py,sha256=J-9xUntqzQfmZAK7aHkutvPSwv8mIL8AMRG_hHK-Quc,161888
+trident/backend/pytorch_ops.py,sha256=MyEE1MoHmnXS9eCzS2pNCu_fGFHQmyv5P_SCoQXRg2I,188174
+trident/backend/tensorflow_backend.py,sha256=SmURl-tAePhRjFAut0LhGYUzfaQxEZh1NA1V9tiqXmc,160455
+trident/backend/tensorflow_ops.py,sha256=hr30nLP--TBp2xGJovh5-pybqqBV6BbyezfBrlMMS1E,172203
 trident/backend/tensorflow_serialization.py,sha256=DsUlcH9mfT1bDv3WEr6GxppE6knR0pbsm_vJgP_RoA8,37231
 trident/backend/tensorspec.py,sha256=TwT2POh9qoc6W4MfRZJNwGXZwrT-xVPSy0UBCDu1RqU,37642
 trident/callbacks/__init__.py,sha256=yILs4VlXWpEAIeEZAKrsnnXlZRiILL0qRJT_lyWZ8K0,749
 trident/callbacks/callback_base.py,sha256=FqIq1YR4YzZ9qpVfEOGXbGErGxCm2Z9b6Cdbxvmo9J8,17735
 trident/callbacks/dataflow_callbacks.py,sha256=NeDdyUebEDpZ72ssdz3wmHjFNx2yvTMNm-fOorcjvck,2347
 trident/callbacks/lr_schedulers.py,sha256=XPTcHsWwAzxp_qPsSFCCQrDUsvPK5w9ZMXHC5eP3S6Y,27191
 trident/callbacks/regularization_callbacks.py,sha256=JM7Vn3mVo_56GLd6Nbeo90Q4oZ-KeBpwUdtKD_LJfq0,23850
 trident/callbacks/saving_strategies.py,sha256=JeDqRDSBYU6JSXF5wrF_s1JxVqbyc9YrfBo5TXp08lc,1838
-trident/callbacks/visualization_callbacks.py,sha256=oTZjBwZ6WYfMjkTikuiqi3WjlLTyDh4yY_eKpcUdahQ,41360
-trident/data/__init__.py,sha256=mcbLL89bVkh0ib190AhGadA9zHGCX4ZnGoh313ruDlY,630
+trident/callbacks/visualization_callbacks.py,sha256=D9mwpdhHys2jfL976UWZ-OwlTm7SNrSgkUtnudUzKNU,41257
+trident/data/__init__.py,sha256=Wzk8_ixGROOKoFat-gk6xDEYxKoJxiAAw7d9KnVFguM,631
 trident/data/augment_policy.py,sha256=GQdpZtdhsGAeAeZI60i-V2blM2_WaIkoXgXvvjuiUsE,6308
 trident/data/bbox.py,sha256=yjkj3_2NRFxUm9DWKv7ScnN9voWDwcmAi4lWktwbUeg,12988
 trident/data/bbox_common.py,sha256=k__OgTQiLm6onkGbe5VnfnQbQF9RR9lN9utaBhj6g7g,13459
 trident/data/char_freq.txt,sha256=t2RaDgfNV3WjoLo3mg-YlCkVUP-v6qoG6BBfwxbpWyk,167037
-trident/data/data_loaders.py,sha256=jIM-sQdFuds_A9EI3T6hksuTH_rvE51ZwP_ZwY1RreQ,63838
+trident/data/data_loaders.py,sha256=bxiwChAh83riBG7qRbue251IKDnlrrJVBffEGhnqvwE,64603
 trident/data/data_provider.py,sha256=6motA9V6u9AtbRMdUuq8rhjrRr5qwBL_PVah30pbAd0,38678
-trident/data/dataset.py,sha256=4C2CxvxaaJFaoM_YF8VsNQIlmc7aelMjBXy490ESybs,70058
-trident/data/image_common.py,sha256=pDLBbxqXN-ohJA3ha1X0ryYUilxZepu2wa-FNV2eEtQ,24203
+trident/data/dataset.py,sha256=60zbC0CdxSPE57GTq8CZwDgT9R1xjNHDbbvEXeohOSI,70094
+trident/data/image_common.py,sha256=FkxriKF-3ndNdpUMJ6thFnYJlEyqqfpUJDFZm5nK1-o,24083
 trident/data/image_reader.py,sha256=PBVCfW7nf5lJlMj5SD1_qynwv_HQZ-6Fvb7NB9LJir0,4383
 trident/data/label_common.py,sha256=cBDtYTlMeb_VzJzsK61gYRfXnPF15-n1XjHfJi_Dzjc,2785
-trident/data/mask_common.py,sha256=r4phBEc9xdzbbhh7uHnhsZ00gxIPy4AcAPhinvXY7Wo,8905
+trident/data/mask_common.py,sha256=hF1UMyQVLsZGCKDopEqsOvtmIREMAes6yjkyjJTBKtw,8529
 trident/data/preprocess_policy.py,sha256=ohh-lNB1GfWqZ6-x8g5KcygiWscQA4FoebkH2GSBpAg,5958
 trident/data/samplers.py,sha256=6RaINs-jzS4kEu7Y5mTkguk3XJpy4_756XqrBGHbZYg,10001
 trident/data/t2s.txt,sha256=uJVumTrqtUDQhoLiAc9eI92SvKIcFL4Et3DFzlKqP_o,39074
 trident/data/text2pronounce.txt,sha256=k8k44yLocxKeXh-uZCeIplUZzFzGaZJLvTwCGNVseSI,599727
 trident/data/text_common.py,sha256=3B9-Z6Ug-sOjom-Dn-RFptoDKEYkkTxSwLRX8JUhyJc,3728
 trident/data/text_transforms.py,sha256=zxwIKrHL5ql68O4j6SCm8CnalKg8n43dYBWo8Zf856w,35274
-trident/data/transform.py,sha256=I3dXiL7PJnYYgqmEzwU9EQs7jzV0Le6RFup8fYjcGJg,21375
+trident/data/transform.py,sha256=P2baK0Dg_7eKkOZDMeICKK4BD2JtGpuk2AA7WjeAv2s,21379
 trident/data/utils.py,sha256=vpJmgoxBHmpfvoBUrm7RsduoU0f3WgSSPPVT1yKNiHA,28830
 trident/data/vision_transforms.py,sha256=D8xInVzdXsxmI5-2NhueV1xxWvhly-i0cK6bKo-J0yo,119214
 trident/layers/__init__.py,sha256=X65rzYEsh_5LVZ5O20lPdzoCD4adaZZ645bc507PzKw,22
 trident/layers/jax_activations.py,sha256=VmMHczNPBmG-NlDkoRV0SVRXLxHhY5HuuN9-IpQbopQ,24238
 trident/layers/jax_blocks.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 trident/layers/jax_initializers.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 trident/layers/jax_layers.py,sha256=IVdQ09hyNm0IjRU5H4Je-Nnb2uplucf3CHwy-k7TJYY,3766
 trident/layers/jax_normalizations.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 trident/layers/jax_pooling.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 trident/layers/jax_rnn.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 trident/layers/jax_transformers.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 trident/layers/pytorch_activations.py,sha256=UUgTyqRXSioqOebI9CYKEEeU7yo33hwBbrbM3OFLJWA,24467
 trident/layers/pytorch_blocks.py,sha256=FyjIVo91-mLLfQB0v7_ulmWHrv3Aaz8w74r0xuAHC1Q,70188
 trident/layers/pytorch_initializers.py,sha256=W6K1dJo7apgl01hdZf-cWz0ekA4NfCvvbmgB0g9nX-U,12460
-trident/layers/pytorch_layers.py,sha256=GSOhA1xorh-kuuth3woQS-byEiNLrDi8Rv9pnJEMr0c,121085
+trident/layers/pytorch_layers.py,sha256=NISzvp7LiX01X2J7lBXMJRDdCpzkwjzM7mMyC0Ah0IQ,122537
 trident/layers/pytorch_normalizations.py,sha256=RIJnwx9wRh6hrrmONqLvEgfRKy-UbmFXbKjLAJtX2nw,34202
-trident/layers/pytorch_pooling.py,sha256=bqHPCQ7qLSTiHLvalYiYgX4Nubfa_meb-0XMeXVpMYw,38800
+trident/layers/pytorch_pooling.py,sha256=5b469u72SRE25fjqBOzyfcEQhCXDnHY2MzH1DAg9nBc,38804
 trident/layers/pytorch_rnn.py,sha256=JhhkStbxH9VsUxzLb0WwkN0fIbQwy_ci_30HgFtcrFs,47106
 trident/layers/pytorch_transformers.py,sha256=RmA82OqRrVZa0F4tH6q4h-79cffNMn--mEGtVO8OaAE,47274
 trident/layers/tensorflow_activations.py,sha256=1h0ZiTDAt9eipq43zQUOoF8ivcPjJA-dOkyW-c7C2n8,19614
 trident/layers/tensorflow_blocks.py,sha256=ZS6CHY778nHdRh6JzAeQALoOSboffpYxXDC8lbhZyss,51498
 trident/layers/tensorflow_initializers.py,sha256=BS2FhTkALyvPG4lFvFywcNM0wL3HMnTWj4B2HGlyfPA,14544
-trident/layers/tensorflow_layers.py,sha256=Re-wEiSnhft3wtNMEBEuIwcKwdWeTLXzuDi_wHtqcHA,68883
+trident/layers/tensorflow_layers.py,sha256=cROKLkLr7MrG99-MDJWZVsIYtncbP4X-hjZzd9TIJRQ,68646
 trident/layers/tensorflow_normalizations.py,sha256=ZIfMLkms0neI3bp47_tdZZ9Hv4yb7tORb3AEGd2eP8s,30439
 trident/layers/tensorflow_pooling.py,sha256=mdLsrEpuBB0KweYnw-iBkPuUSnwKGXI9DdLyykA7tG4,28286
 trident/layers/tensorflow_rnn.py,sha256=8g8Uqk1Ghr7t0zV27KiYSQz-9eal_cLkuYQhNZpBbJg,60659
 trident/layers/tensorflow_transformers.py,sha256=XRktUdVD5Taj53cAxXzufliTTWtDTFZGlAwe-bJbG3U,14026
 trident/loggers/BaseLogger.py,sha256=bsYyRq7V___jvlAIAZDEbWrWSKHU43tgNBgJ6Mvyyjg,1033
 trident/loggers/__init__.py,sha256=7W15Q3CIWjcJWVkMhSACx4zmkSVA0HK6LoPNUkEen9Y,403
 trident/loggers/graph.py,sha256=zW-5Ot5BiCdGlrdP7tq7DldQnIZzgKsT_U87nHV7QUk,17326
@@ -117,20 +117,20 @@
 trident/models/tensorflow_densenet.py,sha256=BUe4mmHp9qKsbR2ba5NM8E5SLxqe1jQwKBV0xQh95qs,21152
 trident/models/tensorflow_efficientnet.py,sha256=KG6UG8XjQo4qs8m-QIS0j-CTvH-O4pZPIBWsgBjGb8Y,20992
 trident/models/tensorflow_mobilenet.py,sha256=P-2RSj5j1QGWRlqMci6U3ypEH8lH3zXgaZbKI_aAopQ,6564
 trident/models/tensorflow_mtcnn.py,sha256=0MVogCcyS6Fo0f67Im4nBAQxkWnM_4VvTOgmPkbSIJM,17403
 trident/models/tensorflow_resnet.py,sha256=PgGcqDuSlPiGQtc5t-lKFsUkqpe9EW-KWjx5XliZ7n8,7741
 trident/models/tensorflow_vgg.py,sha256=kdGkU1pdLLy3jAeiBECZKsSTuxYFwwXwVTEQ7hiYmIM,7341
 trident/optims/__init__.py,sha256=frcCV1k9oG9oKj3dpUqdJg1PxRT2RSN_XKdLCPjaYaY,2
-trident/optims/losses.py,sha256=FesaBflG80fJOvXkVhqXKRd6JM3mjta2Y8Q86SOJbOQ,8557
+trident/optims/losses.py,sha256=8VH-u274gPNhL3nZZ5nNu4Xy0cnkoC_IauUOI_xbzC4,8784
 trident/optims/metrics.py,sha256=x6NDyZMaPhVL1q1bUZVP1OPNHjm9NbBofuQw0XGP6nk,2925
 trident/optims/pytorch_constraints.py,sha256=Mbl8_mT5IN2WD-grgCDJ57GpBvx9gRtCgyl9rA6FAQA,4498
-trident/optims/pytorch_losses.py,sha256=swZPLYMMBtxJ9br_449BJd2wEyDGLft9HUy4PPbcNvw,115381
+trident/optims/pytorch_losses.py,sha256=HgVHoejCONhKhSJdJvwOS3w200RmaMmx_VugoZ1rH4o,115401
 trident/optims/pytorch_metrics.py,sha256=w0MMGa2oFDURDv-oruIOpfxNuQ-zsvmgRbQGW3vw-H8,11437
-trident/optims/pytorch_optimizers.py,sha256=Hx0n6vMrTXAFwJUAflTd-FciBWtFuMfcVunzES10-tQ,135881
+trident/optims/pytorch_optimizers.py,sha256=wbGCz4FaUeCmvcCwof_fl5DibKRBPnwapRu1d8aEKVc,134607
 trident/optims/pytorch_profiling.py,sha256=s_EuRFp5W2psUCI-oWO8z3PA1gTFHgVP8W7z_nxeVdI,4698
 trident/optims/pytorch_regularizers.py,sha256=txvnSEpv6iafYeV5CeQrpBiddvVgEKQ__lQhBVbEUA4,2795
 trident/optims/pytorch_trainer.py,sha256=tgEr6uYb4eCeXegO2l0ap53uSQKSyfmFNbitDRrvqCI,116767
 trident/optims/tensorflow_constraints.py,sha256=UWptgWXio_SiEgFpSKmHteZYRUQnyq-rJiNzhIwG3bo,6181
 trident/optims/tensorflow_losses.py,sha256=8Unb0soY57VPqQAh5JArysjbJY2jRmR9pzlxar_xPg8,63130
 trident/optims/tensorflow_metrics.py,sha256=J8H9Sqez68IG-Jf8Zb4-wAaPaxWGtPdNpBIgQ2DnHZs,12822
 trident/optims/tensorflow_optimizers.py,sha256=J375UAJQnW-qlOFaRQ_F1N9kSLEzmJaI-nBsGSIAdBE,112541
@@ -142,12 +142,12 @@
 trident/reinforcement/tensorflow_policies.py,sha256=TGN-IMtbq55u52YBVGs0sb1q2T15PAG050l-KqgQb2s,22242
 trident/reinforcement/utils.py,sha256=q08EW4mMsfmzX1iTYd-KHXe70Fn6Jp56iirGdYFXvLA,16845
 trident/reinforcement/envs/__init__.py,sha256=bvfEn0bXgKAgBB-RTF4iRP0wDWQnd6dYB8VnQbI-CBM,3462
 trident/reinforcement/envs/tetris.py,sha256=0rEH_jv3bq-9XcnrARC2kGLfBVeudpUZGrToTsvO5bg,21609
 trident/reinforcement/envs/tetris2.py,sha256=dpY0AqHlpIC2U03QVndGigLSFY30tbBe1dH_UgK_n7k,10211
 trident/reinforcement/envs/wrappers.py,sha256=mY_yODRAgtlrXqdgTOPxmQodS5p4tSXKFfgmtaCWVRc,22759
 trident/tools/model_converter.py,sha256=XaRGTjBHtz9Jgnsfx_eC1fRVz3qiUb2EkrpvQaajR-s,8856
-tridentx-0.7.6.dist-info/LICENSE,sha256=h3yu8lRoVE58m62p7mEfw98g8iQhXhF4IiPn9_R1now,1087
-tridentx-0.7.6.dist-info/METADATA,sha256=65xXsh9tkUIC7V4mWkPKJhQjONw1T-kohFOEMG2RR8o,10987
-tridentx-0.7.6.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-tridentx-0.7.6.dist-info/top_level.txt,sha256=DH9YcDRRuK8BR7dS-A5YoAisd1T5JqWgw7NLV5LebTA,8
-tridentx-0.7.6.dist-info/RECORD,,
+tridentx-0.7.7.dist-info/LICENSE,sha256=h3yu8lRoVE58m62p7mEfw98g8iQhXhF4IiPn9_R1now,1087
+tridentx-0.7.7.dist-info/METADATA,sha256=ALQ35wpbn8rHStb1_d_mHXJPtdSYoc91yoR6y-grMDI,10977
+tridentx-0.7.7.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+tridentx-0.7.7.dist-info/top_level.txt,sha256=DH9YcDRRuK8BR7dS-A5YoAisd1T5JqWgw7NLV5LebTA,8
+tridentx-0.7.7.dist-info/RECORD,,
```

