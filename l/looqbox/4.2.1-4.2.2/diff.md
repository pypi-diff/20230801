# Comparing `tmp/looqbox-4.2.1-py3-none-any.whl.zip` & `tmp/looqbox-4.2.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 7192001 bytes, number of entries: 207
+Zip file size: 7193888 bytes, number of entries: 210
 -rw-r--r--  2.0 unx      276 b- defN 23-May-02 18:25 looqbox/__init__.py
 -rw-r--r--  2.0 unx     2977 b- defN 23-Jul-11 11:34 looqbox/global_calling.py
 -rw-r--r--  2.0 unx     1471 b- defN 23-May-02 18:25 looqbox/json_encoder.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Nov-21 21:06 looqbox/teste.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Feb-01 12:29 looqbox/class_loader/__init__.py
 -rw-r--r--  2.0 unx      388 b- defN 23-Feb-01 12:29 looqbox/class_loader/class_loader.py
 -rw-r--r--  2.0 unx      316 b- defN 23-May-02 18:25 looqbox/class_loader/lazy_import.py
@@ -30,15 +30,15 @@
 -rw-r--r--  2.0 unx  6890931 b- defN 23-Mar-02 19:26 looqbox/database/objects/jars/queryExecutor.jar
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/database/test/__init__.py
 -rw-r--r--  2.0 unx     3393 b- defN 23-Mar-14 18:31 looqbox/database/test/test_database_functions.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Mar-02 19:26 looqbox/database/timeout/__init__.py
 -rw-r--r--  2.0 unx      347 b- defN 23-Mar-02 19:26 looqbox/database/timeout/unix_connection_timeout.py
 -rw-r--r--  2.0 unx      481 b- defN 23-Mar-02 19:26 looqbox/database/timeout/windows_connection_timeout.py
 -rw-r--r--  2.0 unx        0 b- defN 23-May-02 18:25 looqbox/flows/__init__.py
--rw-r--r--  2.0 unx     2394 b- defN 23-May-10 19:53 looqbox/flows/base_flow.py
+-rw-r--r--  2.0 unx     2791 b- defN 23-Aug-01 20:30 looqbox/flows/base_flow.py
 -rw-r--r--  2.0 unx     1224 b- defN 23-May-02 18:25 looqbox/flows/flow_factory.py
 -rw-r--r--  2.0 unx      517 b- defN 23-May-02 18:25 looqbox/flows/reload_database_connection_flow.py
 -rw-r--r--  2.0 unx     1075 b- defN 23-May-10 19:53 looqbox/flows/script_flow.py
 -rw-r--r--  2.0 unx     1049 b- defN 23-May-10 19:53 looqbox/flows/script_response_form_flow.py
 -rw-r--r--  2.0 unx      713 b- defN 23-Jun-13 18:36 looqbox/flows/test_connection_flow.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/integration/__init__.py
 -rw-r--r--  2.0 unx    23715 b- defN 23-Jul-20 21:08 looqbox/integration/integration_links.py
@@ -149,38 +149,41 @@
 -rw-r--r--  2.0 unx     7715 b- defN 23-May-02 18:25 looqbox/objects/visual/tests/test_looq_table.py
 -rw-r--r--  2.0 unx     4365 b- defN 22-Nov-21 21:06 looqbox/objects/visual/tests/test_looq_table_style.py
 -rw-r--r--  2.0 unx     1637 b- defN 22-Nov-21 21:06 looqbox/objects/visual/tests/test_looq_web_frame.py
 -rw-r--r--  2.0 unx     3449 b- defN 23-Mar-02 19:26 looqbox/objects/visual/tests/test_text.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Nov-17 21:17 looqbox/render/__init__.py
 -rw-r--r--  2.0 unx     4315 b- defN 23-Jun-13 18:36 looqbox/render/abstract_render.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Jan-10 18:37 looqbox/render/chatbot/__init__.py
--rw-r--r--  2.0 unx    14411 b- defN 23-Jun-13 18:36 looqbox/render/chatbot/base_chatbot_render.py
+-rw-r--r--  2.0 unx    14409 b- defN 23-Aug-01 20:30 looqbox/render/chatbot/base_chatbot_render.py
 -rw-r--r--  2.0 unx      820 b- defN 23-Jan-10 18:37 looqbox/render/chatbot/teams_render.py
 -rw-r--r--  2.0 unx      556 b- defN 23-Jan-10 18:37 looqbox/render/chatbot/whatsapp_render.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Jan-10 18:37 looqbox/render/chatbot/components/__init__.py
 -rw-r--r--  2.0 unx     1682 b- defN 23-Feb-01 12:29 looqbox/render/chatbot/components/text.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Jan-10 18:37 looqbox/render/chatbot/tests/__init__.py
+-rw-r--r--  2.0 unx     2654 b- defN 23-Aug-01 20:30 looqbox/render/chatbot/tests/test_add_to_text.py
 -rw-r--r--  2.0 unx     3629 b- defN 23-Jan-18 18:21 looqbox/render/chatbot/tests/test_base_chatbot_render.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Nov-17 21:17 looqbox/render/looqbox/__init__.py
 -rw-r--r--  2.0 unx    27252 b- defN 23-Jun-13 18:36 looqbox/render/looqbox/base_looqbox_render.py
 -rw-r--r--  2.0 unx      210 b- defN 22-Nov-17 21:17 looqbox/render/looqbox/looqbox_desktop_render.py
 -rw-r--r--  2.0 unx      208 b- defN 22-Nov-17 21:17 looqbox/render/looqbox/looqbox_mobile_render.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Nov-17 21:17 looqbox/render/looqbox/tests/__init__.py
 -rw-r--r--  2.0 unx     2866 b- defN 23-May-02 18:25 looqbox/render/looqbox/tests/test_base_looqbox_render.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Jan-13 20:37 looqbox/render/pdf/__init__.py
--rw-r--r--  2.0 unx    12953 b- defN 23-Mar-23 18:27 looqbox/render/pdf/base_pdf_render.py
+-rw-r--r--  2.0 unx    13391 b- defN 23-Aug-01 20:30 looqbox/render/pdf/base_pdf_render.py
 -rw-r--r--  2.0 unx     7203 b- defN 23-Jan-13 20:37 looqbox/render/pdf/logo.png
 -rw-r--r--  2.0 unx     5329 b- defN 23-Mar-23 18:21 looqbox/render/pdf/pdf_builder.py
 -rw-r--r--  2.0 unx   201265 b- defN 23-Jan-13 20:37 looqbox/render/pdf/template.pdf
 -rw-r--r--  2.0 unx        0 b- defN 23-Feb-01 12:29 looqbox/render/pdf/fonts/__init__.py
 -rw-r--r--  2.0 unx   803384 b- defN 23-Jan-13 20:37 looqbox/render/pdf/fonts/Inter/Inter-VariableFont_slnt,wght.ttf
 -rw-r--r--  2.0 unx        0 b- defN 23-Jan-18 18:21 looqbox/render/pdf/fonts/Inter/__init__.py
 -rw-r--r--  2.0 unx   316100 b- defN 23-Jan-13 20:37 looqbox/render/pdf/fonts/Inter/static/Inter-Bold.ttf
 -rw-r--r--  2.0 unx   309828 b- defN 23-Jan-13 20:37 looqbox/render/pdf/fonts/Inter/static/Inter-Regular.ttf
 -rw-r--r--  2.0 unx        0 b- defN 23-Jan-18 18:21 looqbox/render/pdf/fonts/Inter/static/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Aug-01 20:30 looqbox/render/pdf/tests/__init__.py
+-rw-r--r--  2.0 unx     2326 b- defN 23-Aug-01 20:30 looqbox/render/pdf/tests/test_base_pdf_render.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/tests/__init__.py
 -rw-r--r--  2.0 unx     1396 b- defN 22-Sep-26 20:35 looqbox/tests/test_json_encoder.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/tools/__init__.py
 -rw-r--r--  2.0 unx    12031 b- defN 23-Feb-01 12:29 looqbox/tools/tools.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/tools/tests/__init__.py
 -rw-r--r--  2.0 unx     7306 b- defN 22-Nov-21 21:06 looqbox/tools/tests/test_tools_functions.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/utils/__init__.py
@@ -196,14 +199,14 @@
 -rw-r--r--  2.0 unx      263 b- defN 22-Sep-26 20:35 looqbox/view/log_functions.py
 -rw-r--r--  2.0 unx      534 b- defN 23-Jan-10 18:37 looqbox/view/response_board.py
 -rw-r--r--  2.0 unx     2992 b- defN 22-Nov-17 21:17 looqbox/view/response_frame.py
 -rw-r--r--  2.0 unx      667 b- defN 22-Nov-17 21:17 looqbox/view/view_functions.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-26 20:35 looqbox/view/tests/__init__.py
 -rw-r--r--  2.0 unx     2857 b- defN 22-Nov-21 21:06 looqbox/view/tests/test_response_board.py
 -rw-r--r--  2.0 unx     2603 b- defN 22-Nov-21 21:06 looqbox/view/tests/test_response_frame.py
--rwxr-xr-x  2.0 unx       42 b- defN 23-Jul-20 21:09 looqbox-4.2.1.data/scripts/looq
--rw-r--r--  2.0 unx     1073 b- defN 23-Jul-20 21:09 looqbox-4.2.1.dist-info/LICENSE
--rw-r--r--  2.0 unx     1352 b- defN 23-Jul-20 21:09 looqbox-4.2.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-20 21:09 looqbox-4.2.1.dist-info/WHEEL
--rw-r--r--  2.0 unx        8 b- defN 23-Jul-20 21:09 looqbox-4.2.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    19529 b- defN 23-Jul-20 21:09 looqbox-4.2.1.dist-info/RECORD
-207 files, 9114126 bytes uncompressed, 7160337 bytes compressed:  21.4%
+-rwxr-xr-x  2.0 unx       42 b- defN 23-Aug-01 20:31 looqbox-4.2.2.data/scripts/looq
+-rw-r--r--  2.0 unx     1073 b- defN 23-Aug-01 20:31 looqbox-4.2.2.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1352 b- defN 23-Aug-01 20:31 looqbox-4.2.2.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Aug-01 20:31 looqbox-4.2.2.dist-info/WHEEL
+-rw-r--r--  2.0 unx        8 b- defN 23-Aug-01 20:31 looqbox-4.2.2.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    19829 b- defN 23-Aug-01 20:31 looqbox-4.2.2.dist-info/RECORD
+210 files, 9120239 bytes uncompressed, 7161732 bytes compressed:  21.5%
```

## zipnote {}

```diff
@@ -474,14 +474,17 @@
 
 Filename: looqbox/render/chatbot/components/text.py
 Comment: 
 
 Filename: looqbox/render/chatbot/tests/__init__.py
 Comment: 
 
+Filename: looqbox/render/chatbot/tests/test_add_to_text.py
+Comment: 
+
 Filename: looqbox/render/chatbot/tests/test_base_chatbot_render.py
 Comment: 
 
 Filename: looqbox/render/looqbox/__init__.py
 Comment: 
 
 Filename: looqbox/render/looqbox/base_looqbox_render.py
@@ -528,14 +531,20 @@
 
 Filename: looqbox/render/pdf/fonts/Inter/static/Inter-Regular.ttf
 Comment: 
 
 Filename: looqbox/render/pdf/fonts/Inter/static/__init__.py
 Comment: 
 
+Filename: looqbox/render/pdf/tests/__init__.py
+Comment: 
+
+Filename: looqbox/render/pdf/tests/test_base_pdf_render.py
+Comment: 
+
 Filename: looqbox/tests/__init__.py
 Comment: 
 
 Filename: looqbox/tests/test_json_encoder.py
 Comment: 
 
 Filename: looqbox/tools/__init__.py
@@ -597,26 +606,26 @@
 
 Filename: looqbox/view/tests/test_response_board.py
 Comment: 
 
 Filename: looqbox/view/tests/test_response_frame.py
 Comment: 
 
-Filename: looqbox-4.2.1.data/scripts/looq
+Filename: looqbox-4.2.2.data/scripts/looq
 Comment: 
 
-Filename: looqbox-4.2.1.dist-info/LICENSE
+Filename: looqbox-4.2.2.dist-info/LICENSE
 Comment: 
 
-Filename: looqbox-4.2.1.dist-info/METADATA
+Filename: looqbox-4.2.2.dist-info/METADATA
 Comment: 
 
-Filename: looqbox-4.2.1.dist-info/WHEEL
+Filename: looqbox-4.2.2.dist-info/WHEEL
 Comment: 
 
-Filename: looqbox-4.2.1.dist-info/top_level.txt
+Filename: looqbox-4.2.2.dist-info/top_level.txt
 Comment: 
 
-Filename: looqbox-4.2.1.dist-info/RECORD
+Filename: looqbox-4.2.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## looqbox/flows/base_flow.py

```diff
@@ -1,14 +1,16 @@
 import json
 import uuid
 import os.path
 
 from abc import abstractmethod
 from typing import Any, Callable, Dict, List
 
+from multimethod import multimethod
+
 from looqbox.global_calling import GlobalCalling
 from looqbox.utils.utils import _format_quotes, load_json_from_relative_path
 
 
 class BaseFlow:
     def __init__(self, script_info: str):
         script_data = json.loads(script_info)
@@ -29,14 +31,25 @@
 
     def response_enricher(self) -> None:
         self.data.update(self.vars)
 
     def define_global_variables(self) -> None:
         for key, value in self.vars.items():
             setattr(self.global_variables, key, value)
+        response_question = self.data.get("question", {})
+        self.global_variables.question = self.get_question(response_question)
+
+
+    @multimethod
+    def get_question(self, question: Dict[str, Any]) -> Dict[str, Any]:
+        return question.get("clean", "")
+
+    @multimethod
+    def get_question(self, question: str) -> str:
+        return question
 
     def response_writer(self) -> None:
         with open(self.output_json_file, 'w') as file:
             file.write(self.data)
             file.close()
 
     def _set_stack_trace_level(self) -> None:
```

## looqbox/render/chatbot/base_chatbot_render.py

```diff
@@ -1,12 +1,14 @@
 import os
 import re
 import shutil
 from urllib.parse import quote_plus
 
+from multimethod import multimethod
+
 from looqbox.global_calling import GlobalCalling
 from looqbox.objects.container.looq_link import ObjLink
 from looqbox.objects.looq_pdf import ObjPDF
 from looqbox.objects.visual.looq_message import ObjMessage
 from looqbox.objects.visual.looq_table import ObjTable
 from looqbox.objects.visual.looq_text import ObjText
 from looqbox.render.abstract_render import BaseRender
@@ -26,67 +28,73 @@
     formats = {
         "bold": {"start": "<b>", "end": "</b>"},
         "italic": {"start": "<i>", "end": "</i>"},
         "unispace": {"start": "<code>", "end": "</code>"},
         "none": {"start": "", "end": ""},
     }
 
-    feature_flags = GlobalCalling.looq.feature_flags or {}
+    def __init__(self):
+        self._unispace_texts = None
+        self.non_text_objects = []
+        self.feature_flags = GlobalCalling.looq.feature_flags or {}
 
     def should_render_pdf(self, board: ResponseBoard):
         if not self.feature_flags.get("looqbot", {}).get("pdfOnAnswer", True):
             return False
 
         children = flatten([child.content for child in board.content if isinstance(child, ResponseFrame)])
         len_children = len(children)
-        if len_children == 0:
-            return False
-        elif len_children == 1 and (isinstance(children[0], ObjMessage) or isinstance(children[0], ObjPDF)):
+        if len_children == 0 or (len_children == 1 and isinstance(children[0], (ObjMessage, ObjPDF))):
             return False
         return True
 
+    @staticmethod
+    def generate_question_link():
+        question_link = GlobalCalling.looq.domains[0].get("domain")
+        question = GlobalCalling.looq.question or ""
+        if question:
+            url_safe_question = quote_plus(question.encode("utf-8"))
+            question_link = f"{question_link}/#/q?question={url_safe_question}"
+            return ObjLink(ObjText("link para a pergunta"), question=question_link)
+
     def response_board_render(self, board: ResponseBoard):
         self.non_text_objects = []
         if self.should_render_pdf(board):
             from looqbox.render.pdf.base_pdf_render import BasePDFRender
 
             pdf_obj = BasePDFRender()
             pdf_obj.response_board_render(board)
             pdf_filepath = pdf_obj.pdf.name
-            pdf = ObjPDF(pdf_filepath, tab_label="Relatório.pdf")
-            board.content.append(pdf)
-        else:
-            self.non_text_objects = []
+            board.content.append(ObjPDF(pdf_filepath, tab_label="Relatório.pdf"))
 
-        if self.feature_flags.get("looqbot", {}).get("linkOnAnswer"):
-            question_link = GlobalCalling.looq.domains[0].get("domain")
-            url_safe_question = quote_plus(GlobalCalling.looq.question)
-            question_link = f"{question_link}/#/q?question={url_safe_question}"
-            text = ObjText(text="link para a pergunta")
-            link = ObjLink(text, question=question_link)
-            board.content.append(link)
+        if self.feature_flags.get("looqbot", {}).get("linkOnAnswer", False):
+            question_link = self.generate_question_link()
+            if question_link:
+                board.content.append(question_link)
 
         frames_json_list = [
             looq_obj.to_json_structure(self) for looq_obj in board.content
             if looq_obj.render_condition
         ]
 
         text = self._clean_text(self.add_to_text("", frames_json_list))
 
-        content = [ObjectToText(text, self.formats).to_json_structure, *[dict(t) for t in {tuple(d.items()) for d in self.non_text_objects}]]
+        content = [ObjectToText(text, self.formats).to_json_structure,
+                   *[dict(t) for t in {tuple(d.items()) for d in self.non_text_objects}]]
 
         self._remove_empty_text(content)
 
         json_content = {
             "content": content,
         }
 
         return self._dict_to_json(self.remove_json_nones(json_content.get("content", [])))
 
-    def _remove_empty_text(self, content):
+    @staticmethod
+    def _remove_empty_text(content):
         for obj in content:
             if obj is not None:
                 if obj.get("text", "-").isspace():
                     del obj["text"]
 
     def response_frame_render(self, frame: ResponseFrame):
 
@@ -111,28 +119,37 @@
     def html_render(self, obj_html):
         if obj_html.html is None:
             return None
         tab_label = ObjectToText(obj_html.tab_label, self.formats).to_bold().to_json_structure
         html_text = ObjectToText(obj_html.html, self.formats).to_json_structure
         return self.remove_json_nones([tab_label, html_text])
 
-    def pdf_render(self, obj_pdf):
-
-        if 'https://' not in obj_pdf.source:
-            if os.path.dirname(obj_pdf.source) == GlobalCalling.looq.temp_dir:
-                temporary_file = obj_pdf.source
+    @staticmethod
+    def handle_local_source(source):
+        if 'https://' not in source:
+            if os.path.dirname(source) == GlobalCalling.looq.temp_dir:
+                temporary_file = source
             else:
-                template_file = os.path.join(GlobalCalling.looq.response_dir() + "/" + obj_pdf.source)
-                temporary_file = GlobalCalling.looq.temp_file(obj_pdf.source)
+                template_file = os.path.join(GlobalCalling.looq.response_dir() + "/" + source)
+                temporary_file = GlobalCalling.looq.temp_file(source)
                 shutil.copy(template_file, temporary_file)
-                obj_pdf.source = "/api/tmp/download/" + os.path.basename(temporary_file)
+                source = "/api/tmp/download/" + os.path.basename(temporary_file)
+        else:
+            return None, None
 
         file_extension = temporary_file.split(".")[-1]
         filename = temporary_file.split("/")[-1]
+        return source, (file_extension, filename)
+
+    def pdf_render(self, obj_pdf):
+        temporary_file, file_info = self.handle_local_source(obj_pdf.source)
+        if temporary_file is None:
+            return None
 
+        file_extension, filename = file_info
         json_content = {
             "type": self.file_extension_to_mime.get(file_extension),
             "uri": temporary_file,
             "title": obj_pdf.tab_label,
             "filename": filename,
             "text": " "
         }
@@ -144,29 +161,19 @@
             return None
 
         tab_label = ObjectToText(obj_simple.tab_label, self.formats).to_bold().to_json_structure
         text = ObjectToText(obj_simple.original_text, self.formats).to_json_structure
         return self.remove_json_nones([tab_label, text])
 
     def image_render(self, obj_image):
-        if 'https://' not in obj_image.source:
-            # From global variable looq
-            if os.path.dirname(obj_image.source) == GlobalCalling.looq.temp_dir:
-                temporary_file = obj_image.source
-            else:
-                template_file = os.path.join(GlobalCalling.looq.response_dir() + "/" + obj_image.source)
-                temporary_file = GlobalCalling.looq.temp_file(obj_image.source)
-                shutil.copy(template_file, temporary_file)
-                obj_image.source = "/api/tmp/download/" + os.path.basename(temporary_file)
-        else:
+        temporary_file, file_info = self.handle_local_source(obj_image.source)
+        if temporary_file is None:
             return None
 
-        file_extension = temporary_file.split(".")[-1]
-        filename = temporary_file.split("/")[-1]
-
+        file_extension, filename = file_info
         json_content = {
             "type": self.file_extension_to_mime.get(file_extension),
             "uri": temporary_file,
             "title": obj_image.tab_label,
             "filename": filename,
             "text": obj_image.value
         }
@@ -377,29 +384,33 @@
 
     def image_capture_render(self, obj_image_capture):
         ...
 
     def simple_table_render(self, obj_simple_table):
         ...
 
-    def add_to_text(self, text, add):
-        if isinstance(add, str):
-            if add:
-                return text + re.sub("^ ", "", add)
-            return text
-        elif not add:
-            return text
-        elif isinstance(add, list):
-            for item in add:
-                text = self.add_to_text(text, item)
-            return text
-        elif isinstance(add, dict):
-            if "text" in add:
-                if "target" in add or "uri" in add:
-                    self.non_text_objects.append(add)
-                    return text
-                return self.add_to_text(text, add["text"])
-            elif "children" in add:
-                text = text + add.get("separator", "") if add["children"] and text else text
-                return self.add_to_text(text, add["children"])
+    @multimethod
+    def add_to_text(self, text: str, add: str):
+        return text + re.sub("^ ", "", add) if add else text
+
+    @multimethod
+    def add_to_text(self, text: str, add: list):
+        for item in add:
+            text = self.add_to_text(text, item)
+        return text
+
+    @multimethod
+    def add_to_text(self, text: str, add: dict):
+        if "text" in add:
+            if "target" in add or "uri" in add:
+                self.non_text_objects.append(add)
+            else:
+                text = self.add_to_text(text, add["text"])
+        elif "children" in add:
+            if add["children"] and text:
+                text += add.get("separator", "")
+            text = self.add_to_text(text, add["children"])
+        return text
 
+    @multimethod
+    def add_to_text(self, text: str, add: None):
         return text
```

## looqbox/render/pdf/base_pdf_render.py

```diff
@@ -1,10 +1,12 @@
 import os
 from urllib.parse import quote
+
 from multimethod import multimethod
+
 from looqbox.global_calling import GlobalCalling
 from looqbox.integration.looqbox_global import random_hash
 from looqbox.render.abstract_render import BaseRender
 from looqbox.utils.utils import format as looq_format
 
 
 def _hex_to_rgb(color: str) -> tuple:
@@ -39,40 +41,54 @@
 
 
 class BasePDFRender(BaseRender):
 
     def __init__(self):
         from looqbox.render.pdf.pdf_builder import PDFBuilder
 
-        try:
-            question_link = GlobalCalling.looq.domains[0].get("domain", None)
-        except KeyError:
-            question_link = None
-        if question_link is not None:
-            url_safe_question = quote(GlobalCalling.looq.question)
-            question_link = f"{question_link}/#/q?question={url_safe_question}"
+        self.looq = GlobalCalling.looq
+        self.add_question_link, self.add_watermark = self.get_feature_flags()
+        self.question_link = self.get_question_link()
 
         self.pdf = PDFBuilder(
-            user_name=GlobalCalling.looq.user.login,
-            user_id=GlobalCalling.looq.user.id,
+            user_name=self.looq.user.login,
+            user_id=self.looq.user.id,
             logo_path=os.path.join(os.path.dirname(__file__), "logo.png"),
-            question_link=question_link,
-            add_question_link=GlobalCalling.looq.feature_flags.get("looqbot", {}).get("linkOnAnswer", False),
-            add_watermark=GlobalCalling.looq.feature_flags.get("looqbot", {}).get("watermark", False),
+            question_link=self.question_link,
+            add_question_link=self.add_question_link,
+            add_watermark=self.add_watermark,
         )
 
         self.pdf_width, self.pdf_height = self.pdf.w, self.pdf.h
         self.left_margin = None
         self.margin = 10
 
         self.add_watermark = True
         self.add_template_on_first_page = False
 
         self.rendered_objs = list()
 
+    def get_feature_flags(self):
+        feature_flags = self.looq.feature_flags.get("looqbot", {})
+        add_question_link = feature_flags.get("linkOnAnswer", False)
+        add_watermark = feature_flags.get("watermark", False)
+        return add_question_link, add_watermark
+
+    def get_question_link(self):
+        if not self.add_question_link:
+            return None
+        try:
+            question_link = self.looq.domains[0].get("domain")
+            question = self.looq.question or ""
+            url_safe_question = quote(question.encode('utf-8'))
+            return f"{question_link}/#/q?question={url_safe_question}"
+        except Exception:
+            self.add_question_link = False
+        return None
+
     def _render_container(self, container):
         spacing = 0
         if container.css_options:
             if len([css for css in container.css_options if "border" in css.property]) > 1:
                 spacing = 6
         try:
             self.pdf.cell(0, spacing, "", 0, 1, 'C')
```

## Comparing `looqbox-4.2.1.dist-info/LICENSE` & `looqbox-4.2.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `looqbox-4.2.1.dist-info/METADATA` & `looqbox-4.2.2.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: looqbox
-Version: 4.2.1
+Version: 4.2.2
 Summary: A looqbox package to write python scripts in the platform
 Home-page: https://github.com/looqbox/python-package
 Author: looqbox
 Author-email: admin@looqbox.com
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

## Comparing `looqbox-4.2.1.dist-info/RECORD` & `looqbox-4.2.2.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -29,15 +29,15 @@
 looqbox/database/objects/jars/queryExecutor.jar,sha256=rWUENDv3vqUkLndiLvCLwsJNi-cZpo4N_Rq7Phx3mpU,6890931
 looqbox/database/test/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/database/test/test_database_functions.py,sha256=IlT2mM49uGOgvEFyKFlUU9oDayK91SbU6VDNKWdZlWo,3393
 looqbox/database/timeout/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/database/timeout/unix_connection_timeout.py,sha256=N2tzkCr6P8xccBf8kSvqJMqxfOzTKZdllyHMF1jMttc,347
 looqbox/database/timeout/windows_connection_timeout.py,sha256=NRu8aZMu0-5ARRtYf3PLdFZcOD4LAfY-Py15uNWipoU,481
 looqbox/flows/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-looqbox/flows/base_flow.py,sha256=EDueXksN4XgJ8DvmDfPtCBDXWoTFTG_gogR9Dg_QfKY,2394
+looqbox/flows/base_flow.py,sha256=E9YpxKXP7JHwaCLtEvnX6WDDSghh7hvF15gE8rjGUZ0,2791
 looqbox/flows/flow_factory.py,sha256=gSbNl9YGnGJJTerhpS4FxyZTs99d7b5GKl_yfH370cA,1224
 looqbox/flows/reload_database_connection_flow.py,sha256=1DugkLWu015lNYafzZzgnUjaHJOBnOGNudJjSYgUkLY,517
 looqbox/flows/script_flow.py,sha256=nEr2CYrAdrJ7J3dO3vxchSs_A1SlUciGc_fPcY3eKjU,1075
 looqbox/flows/script_response_form_flow.py,sha256=O-4oGj2eK_91_EMf2VHCDiSAed7IvEhgPO64gDmvREQ,1049
 looqbox/flows/test_connection_flow.py,sha256=98ykV9WEuDhCPM3T6-kkoQEhf5pj8wD_6un8564qzlE,713
 looqbox/integration/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/integration/integration_links.py,sha256=Won89NDUqsL2cbuHNucYxY6dEthsUGyGwizvVOPtBqM,23715
@@ -148,38 +148,41 @@
 looqbox/objects/visual/tests/test_looq_table.py,sha256=PdoAZMdb08Bdb9o-stnv0SPOiWum9s20TR93hkiW1Co,7715
 looqbox/objects/visual/tests/test_looq_table_style.py,sha256=K3euySkVNTv8wIivvwZ06sovkQ6-NS_-82hfnSfKHZM,4365
 looqbox/objects/visual/tests/test_looq_web_frame.py,sha256=_6TQDo1bgEdQWK7yQJYYp2wFXPZC_MJTy7XjcGMl0qQ,1637
 looqbox/objects/visual/tests/test_text.py,sha256=NKzlcWUxJ8rLPE5dpUc19sC7NOKsBB632v4p0xRcE7A,3449
 looqbox/render/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/render/abstract_render.py,sha256=Lq52Hdx3jOR2x_AvanYWE_7f6QyOYZ4Ju0QqCOAt2w0,4315
 looqbox/render/chatbot/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-looqbox/render/chatbot/base_chatbot_render.py,sha256=ZSSyX3hbMuTj1RbBgd1srdsOYe3nWIrFh2nG1OuoAxo,14411
+looqbox/render/chatbot/base_chatbot_render.py,sha256=3EfO82evzcgwvvUUkbSk7VvoLp3_wBNOh0cH5-K_qQA,14409
 looqbox/render/chatbot/teams_render.py,sha256=iM8fIxNyE6lidsGL_ctId391kYdv8_pSwwBJH8GDxgI,820
 looqbox/render/chatbot/whatsapp_render.py,sha256=_XmsRXXbtcyIgxXLRb8yYmFDe-FKyfuJteVkEwvvVZw,556
 looqbox/render/chatbot/components/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/render/chatbot/components/text.py,sha256=udRcaM-8LaeISteBK6gtskheLquAlfDEK6ZtJW2oUts,1682
 looqbox/render/chatbot/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+looqbox/render/chatbot/tests/test_add_to_text.py,sha256=q3ezj-hP8_8r0MBpL_4OZjVHZ1i2NTEcu8w2VU6cg7k,2654
 looqbox/render/chatbot/tests/test_base_chatbot_render.py,sha256=Act0c_iMD_eoK_hmy-jby0i-IxbQeovMwX9_Lx8mUFo,3629
 looqbox/render/looqbox/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/render/looqbox/base_looqbox_render.py,sha256=qze0a4VDUa8jhqtRbdlTZHZ8lwp0MW17AtIu1ghOOO0,27252
 looqbox/render/looqbox/looqbox_desktop_render.py,sha256=_ftTqhjr0akl9b14hD7l_njq7YuDLzAxUG27CcipB2k,210
 looqbox/render/looqbox/looqbox_mobile_render.py,sha256=FfZjRZZopphg7JcjXIGBxJqxw9Gn7-iZVRBGm53dRN4,208
 looqbox/render/looqbox/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/render/looqbox/tests/test_base_looqbox_render.py,sha256=UM1gjJJeRo2WWfv0-AJJhoPeLuWvPpZe4biYc3N90u8,2866
 looqbox/render/pdf/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-looqbox/render/pdf/base_pdf_render.py,sha256=GrwBHfvdVHVQTKB1ZUHoNaM5socK4F9TTjoujVV1S8g,12953
+looqbox/render/pdf/base_pdf_render.py,sha256=tGbaFGSoSzHAvWcb50oHeXA2JL7Po67_sTzl50wWEnI,13391
 looqbox/render/pdf/logo.png,sha256=PJ8aMN2x7TZ7XCwODgnv1AuziQ4jyWsOV9hNTC87wd4,7203
 looqbox/render/pdf/pdf_builder.py,sha256=4r54Eq7j4QMUXojbVAVrsqgxCLjGSNKaBvfhajYvziE,5329
 looqbox/render/pdf/template.pdf,sha256=VP41XnIbKD3tAmE37_2PxPrkukQ7lvgOjHo0L6Vx-XY,201265
 looqbox/render/pdf/fonts/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 "looqbox/render/pdf/fonts/Inter/Inter-VariableFont_slnt,wght.ttf",sha256=uajl4hOXdmW-KlbbZpRaFsaG2j2YYa8eeFEyLPFUleo,803384
 looqbox/render/pdf/fonts/Inter/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/render/pdf/fonts/Inter/static/Inter-Bold.ttf,sha256=eQwQi-_oWdrC3b0grz-7aRfGAbPVRMigV2FRnztVCP4,316100
 looqbox/render/pdf/fonts/Inter/static/Inter-Regular.ttf,sha256=QasPcHor-rgTPM382rUigvX3nldR9DomSAVFHHu5X7g,309828
 looqbox/render/pdf/fonts/Inter/static/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+looqbox/render/pdf/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+looqbox/render/pdf/tests/test_base_pdf_render.py,sha256=8-rzdnN56SlWSdOVn5vQKqvrioK7is-1LBCIcngK2Dg,2326
 looqbox/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/tests/test_json_encoder.py,sha256=LWdSZdZfrI2sOnM5Kk0vHtMgD7nRcyNuX87jaumEeAk,1396
 looqbox/tools/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/tools/tools.py,sha256=pdXHUCF3e3kifV3OACqizaT_zd5svdIo34lrDwAy2aM,12031
 looqbox/tools/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/tools/tests/test_tools_functions.py,sha256=d7AvfgsC0HxRKj-0IGJSclhFKAx22VvqnxXI_-o0y6s,7306
 looqbox/utils/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
@@ -195,13 +198,13 @@
 looqbox/view/log_functions.py,sha256=uPRCKFkx5TY4aAnTjOz9xzpary1Iu6gutSHnyAGPJ2g,263
 looqbox/view/response_board.py,sha256=7oRQQlQ3ksacgOHcbrUo08ZbDls0kVIK-6SvRU17hgA,534
 looqbox/view/response_frame.py,sha256=lq8JI5bYGSbB6oR60ZFXIpH4bUKWiNip5FnAl_-uChc,2992
 looqbox/view/view_functions.py,sha256=WEtH8ekptSRLpITnLIzUXDvvOitT0Ue46cc8achjVa8,667
 looqbox/view/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 looqbox/view/tests/test_response_board.py,sha256=KrPqZbOh3FLuEMHILMKU8EHV6b6gq92C6zYwz9u-GC4,2857
 looqbox/view/tests/test_response_frame.py,sha256=mOfIlVpgF7IUpZNIOlsM8jc92Ol06tM95DK9CBh6SFg,2603
-looqbox-4.2.1.data/scripts/looq,sha256=3csn1Umd6KQ4yp4DRA-qPo_bqZRupizppQNN--bm26I,42
-looqbox-4.2.1.dist-info/LICENSE,sha256=2bm9uFabQZ3Ykb_SaSU_uUbAj2-htc6WJQmS_65qD00,1073
-looqbox-4.2.1.dist-info/METADATA,sha256=Wo9glMEqx6O5tEr2wdxVypUlejLx_rYmbGKOGxOeqxA,1352
-looqbox-4.2.1.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-looqbox-4.2.1.dist-info/top_level.txt,sha256=885s3GhRX70T44C3f0-8199eVe2B0Q1mpd48ZfwLUdA,8
-looqbox-4.2.1.dist-info/RECORD,,
+looqbox-4.2.2.data/scripts/looq,sha256=3csn1Umd6KQ4yp4DRA-qPo_bqZRupizppQNN--bm26I,42
+looqbox-4.2.2.dist-info/LICENSE,sha256=2bm9uFabQZ3Ykb_SaSU_uUbAj2-htc6WJQmS_65qD00,1073
+looqbox-4.2.2.dist-info/METADATA,sha256=jbdCkZkmsX_HVZsJLAV1Z6daORXEzrIn_keFULtTlLY,1352
+looqbox-4.2.2.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+looqbox-4.2.2.dist-info/top_level.txt,sha256=885s3GhRX70T44C3f0-8199eVe2B0Q1mpd48ZfwLUdA,8
+looqbox-4.2.2.dist-info/RECORD,,
```

