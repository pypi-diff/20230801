# Comparing `tmp/opentf_tools_nightly-0.43.0.dev470-py3-none-any.whl.zip` & `tmp/opentf_tools_nightly-0.43.0.dev474-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 40028 bytes, number of entries: 14
--rw-r--r--  2.0 unx    23226 b- defN 23-Jul-28 16:04 opentf/tools/ctl.py
--rw-r--r--  2.0 unx    10629 b- defN 23-Jul-28 16:04 opentf/tools/ctlcommons.py
--rw-r--r--  2.0 unx    29452 b- defN 23-Jul-28 16:04 opentf/tools/ctlconfig.py
--rw-r--r--  2.0 unx     8878 b- defN 23-Jul-28 16:04 opentf/tools/ctlnetworking.py
--rw-r--r--  2.0 unx    11691 b- defN 23-Jul-28 16:04 opentf/tools/ctlqualitygate.py
--rw-r--r--  2.0 unx    28100 b- defN 23-Jul-28 16:04 opentf/tools/ctlworkflows.py
--rw-r--r--  2.0 unx     3188 b- defN 23-Jul-28 16:04 opentf/tools/done.py
--rw-r--r--  2.0 unx     9391 b- defN 23-Jul-28 16:04 opentf/tools/ready.py
--rw-rw-rw-  2.0 unx    11357 b- defN 23-Jul-28 16:04 opentf_tools_nightly-0.43.0.dev470.dist-info/LICENSE
--rw-r--r--  2.0 unx     1806 b- defN 23-Jul-28 16:04 opentf_tools_nightly-0.43.0.dev470.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-28 16:04 opentf_tools_nightly-0.43.0.dev470.dist-info/WHEEL
--rw-r--r--  2.0 unx      139 b- defN 23-Jul-28 16:04 opentf_tools_nightly-0.43.0.dev470.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-28 16:04 opentf_tools_nightly-0.43.0.dev470.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1267 b- defN 23-Jul-28 16:04 opentf_tools_nightly-0.43.0.dev470.dist-info/RECORD
-14 files, 139223 bytes uncompressed, 37896 bytes compressed:  72.8%
+Zip file size: 40815 bytes, number of entries: 14
+-rw-r--r--  2.0 unx    23417 b- defN 23-Aug-01 14:55 opentf/tools/ctl.py
+-rw-r--r--  2.0 unx    13215 b- defN 23-Aug-01 14:55 opentf/tools/ctlcommons.py
+-rw-r--r--  2.0 unx    31854 b- defN 23-Aug-01 14:55 opentf/tools/ctlconfig.py
+-rw-r--r--  2.0 unx     8878 b- defN 23-Aug-01 14:55 opentf/tools/ctlnetworking.py
+-rw-r--r--  2.0 unx    11850 b- defN 23-Aug-01 14:55 opentf/tools/ctlqualitygate.py
+-rw-r--r--  2.0 unx    28250 b- defN 23-Aug-01 14:55 opentf/tools/ctlworkflows.py
+-rw-r--r--  2.0 unx     3188 b- defN 23-Aug-01 14:55 opentf/tools/done.py
+-rw-r--r--  2.0 unx     9391 b- defN 23-Aug-01 14:55 opentf/tools/ready.py
+-rw-rw-rw-  2.0 unx    11357 b- defN 23-Aug-01 14:56 opentf_tools_nightly-0.43.0.dev474.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1806 b- defN 23-Aug-01 14:56 opentf_tools_nightly-0.43.0.dev474.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Aug-01 14:56 opentf_tools_nightly-0.43.0.dev474.dist-info/WHEEL
+-rw-r--r--  2.0 unx      139 b- defN 23-Aug-01 14:56 opentf_tools_nightly-0.43.0.dev474.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        7 b- defN 23-Aug-01 14:56 opentf_tools_nightly-0.43.0.dev474.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1267 b- defN 23-Aug-01 14:56 opentf_tools_nightly-0.43.0.dev474.dist-info/RECORD
+14 files, 144711 bytes uncompressed, 38683 bytes compressed:  73.3%
```

## zipnote {}

```diff
@@ -18,26 +18,26 @@
 
 Filename: opentf/tools/done.py
 Comment: 
 
 Filename: opentf/tools/ready.py
 Comment: 
 
-Filename: opentf_tools_nightly-0.43.0.dev470.dist-info/LICENSE
+Filename: opentf_tools_nightly-0.43.0.dev474.dist-info/LICENSE
 Comment: 
 
-Filename: opentf_tools_nightly-0.43.0.dev470.dist-info/METADATA
+Filename: opentf_tools_nightly-0.43.0.dev474.dist-info/METADATA
 Comment: 
 
-Filename: opentf_tools_nightly-0.43.0.dev470.dist-info/WHEEL
+Filename: opentf_tools_nightly-0.43.0.dev474.dist-info/WHEEL
 Comment: 
 
-Filename: opentf_tools_nightly-0.43.0.dev470.dist-info/entry_points.txt
+Filename: opentf_tools_nightly-0.43.0.dev474.dist-info/entry_points.txt
 Comment: 
 
-Filename: opentf_tools_nightly-0.43.0.dev470.dist-info/top_level.txt
+Filename: opentf_tools_nightly-0.43.0.dev474.dist-info/top_level.txt
 Comment: 
 
-Filename: opentf_tools_nightly-0.43.0.dev470.dist-info/RECORD
+Filename: opentf_tools_nightly-0.43.0.dev474.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## opentf/tools/ctl.py

```diff
@@ -724,39 +724,41 @@
             sys.exit(2)
         check_token(sys.argv[3], sys.argv[5])
         sys.exit(0)
     if _is_command('check token _', sys.argv):
         _error('Missing required parameter.  Use "check token --help" for details.')
         sys.exit(2)
     if _is_command('get namespaces', sys.argv):
-        _ensure_options(sys.argv[3:], [('--selector', '-l')])
+        _ensure_options('get namespaces', sys.argv[1:], extra=[('--selector', '-l')])
         read_configuration()
         list_namespaces()
     elif _is_command('get subscriptions', sys.argv):
-        _ensure_options(sys.argv[3:], [('--output', '-o')])
+        _ensure_options('get subscriptions', sys.argv[1:], extra=[('--output', '-o')])
         read_configuration()
         list_subscriptions()
     elif _is_command('delete subscription _', sys.argv):
-        _ensure_options(sys.argv[4:])
+        subscription_id = _ensure_options('delete subscription _', sys.argv[1:])
         read_configuration()
-        delete_subscription(sys.argv[3])
+        delete_subscription(subscription_id)
     elif _is_command('get agents', sys.argv):
-        _ensure_options(sys.argv[3:], [('--output', '-o')])
+        _ensure_options('get agents', sys.argv[1:], extra=[('--output', '-o')])
         read_configuration()
         list_agents()
     elif _is_command('get channels', sys.argv):
         _ensure_options(
-            sys.argv[3:], [('--output', '-o'), ('--field-selector', '--selector', '-l')]
+            'get channels',
+            sys.argv[1:],
+            extra=[('--output', '-o'), ('--field-selector', '--selector', '-l')],
         )
         read_configuration()
         list_channels()
     elif _is_command('delete agent _', sys.argv):
-        _ensure_options(sys.argv[4:])
+        agent_id = _ensure_options('delete agent _', sys.argv[1:])
         read_configuration()
-        delete_agent(sys.argv[3])
+        delete_agent(agent_id)
     elif _is_command('_ workflow', sys.argv) or _is_command('_ workflows', sys.argv):
         workflow_cmd()
     elif _is_command('get qualitygate', sys.argv) or _is_command(
         'describe qualitygate', sys.argv
     ):
         qualitygate_cmd()
     elif _is_command('config', sys.argv):
```

## opentf/tools/ctlcommons.py

```diff
@@ -45,74 +45,155 @@
 
 
 ########################################################################
 # sys.argv processing
 
 
 COMMON_OPTIONS = [
-    '--token=',
-    '--user=',
-    '--orchestrator=',
-    '--context=',
-    '--insecure-skip-tls-verify=',
-    '--insecure_skip_tls_verify=',
-    '--opentfconfig=',
+    ('--token=',),
+    ('--user=',),
+    ('--orchestrator=',),
+    ('--context=',),
+    ('--insecure-skip-tls-verify=',),
+    ('--opentfconfig=',),
 ]
 
 
-def _ensure_options(args: List[str], extras=(), flags=()) -> None:
+def _filter_options(args: List[str], extra=(), multi=(), flags=()) -> List[str]:
     """Check options.
 
-    Exit with error code 2 if there are unknown options in args.
-
     # Required parameters
 
     - args: a list of strings
 
     # Optional parameters
 
     - extra: a collection of string collections
+    - multi: a collection of string collections
     - flags: a collection of string collections
 
     Items in `extra` are expecting a parameter, in the form `extra=x` or
     `extra x` (for example: `--user=foo` or `--user foo`).
 
-    Items in `extra` may end with `=`, but this is not mandatory, it
-    will be implicitly added if not there.
+    Items in `multi` are expecting a parameter, in the form `extra=x` or
+    `extra x` and can be repeated (for example: `--user=foo --user=bar`
+    or `--user foo --user bar`).
+
+    Items in `extra` and `multi` may end with `=`, but this is not
+    mandatory, it will be implicitly added if not there.
+
+    # Returned value
+
+    A possibly empty list of strings, the unhandled elements in `args`.
     """
+
+    def _consume(option):
+        for item in list(options):
+            if option in item:
+                options.remove(item)
+                for alias in item:
+                    allowed.remove(alias)
+                break
+
+    def _processed(what, candidates):
+        for option in candidates:
+            if option[-1] == '=':
+                if what.startswith(option):
+                    processed[index] = None
+                    return option
+                if what == option[:-1]:
+                    if index < max_index:
+                        processed[index] = processed[index + 1] = None
+                        return option
+                    _error(f'Missing parameter for option {item}.')
+                    sys.exit(2)
+            if what == option:
+                processed[index] = None
+                return option
+        return False
+
     max_index = len(args) - 1
     processed: List[Optional[str]] = list(args)
-    options = list(COMMON_OPTIONS)
-    for option in extras:
-        for alias in option:
-            options.append(f'{alias.rstrip("=")}=')
+    options = []
+    allowed = []
+    multis = []
+    for option in COMMON_OPTIONS + list(extra):
+        options.append(tuple(f'{alias.rstrip("=")}=' for alias in option))
+        for alias in options[-1]:
+            allowed.append(alias)
     for option in flags:
+        options.append(option)
+        for alias in option:
+            allowed.append(alias)
+    for option in multi:
         for alias in option:
-            options.append(alias)
+            multis.append(f'{alias.rstrip("=")}=')
+
     for index, item in enumerate(args):
         if processed[index] is None:
             continue
-        for option in options:
-            if option[-1] == '=':
-                if item.replace('_', '-').startswith(option):
-                    processed[index] = None
-                if item == option[:-1]:
-                    if index < max_index:
-                        processed[index] = None
-                        processed[index + 1] = None
-                    else:
-                        _error(f'Missing parameter for option {item}.')
-                        sys.exit(2)
-            if item.replace('_', '-') == option:
-                processed[index] = None
+        if found := _processed(item.replace('_', '-'), allowed):
+            _consume(found)
+            continue
+        if _processed(item.replace('_', '-'), multis):
+            continue
+
+    return [arg for arg in processed if arg is not None]
+
 
-    unknown = [arg for arg in processed if arg is not None]
-    if unknown:
-        _error(f'Unknown option: {" ".join(unknown)}.')
+def _ensure_options(
+    command: str, args: List[str], extra=(), multi=(), flags=()
+) -> Optional[str]:
+    """Ensure options are allowed.
+
+    # Required parameters
+
+    - command: a string
+    - args: a list of strings
+
+    # Optional parameters
+
+    - extra: a collection of string collections
+    - multi: a collection of string collections
+    - flags: a collection of string collections
+
+    Items in `extra` are expecting a parameter, in the form `extra=x` or
+    `extra x` (for example: `--user=foo` or `--user foo`).
+
+    Items in `multi` are expecting a parameter, in the form `extra=x` or
+    `extra x` and can be repeated (for example: `--user=foo --user=bar`
+    or `--user foo --user bar`).
+
+    Items in `extra` and `multi` may end with `=`, but this is not
+    mandatory, it will be implicitly added if not there.
+
+    # Returned value
+
+    A string or None.  Returns a string if `command` contains a `_`
+    placeholder, the corresponding value.  Returns None otherwise.
+
+    # Raised exceptions
+
+    Raises a `SystemExit` exception if some args are missing or
+    unexpected or incomplete.
+    """
+    unknown = _filter_options(args, extra, multi, flags)
+    pattern = command.split()
+    if len(unknown) < len(pattern):
+        _error(f'Missing parameter: was expecting "{command}", got "{unknown}".')
+        sys.exit(2)
+    if len(unknown) > len(pattern):
+        unexpected = ' '.join(unknown)
+        _error(
+            f'Unexpected or duplicate parameters: was expecting "{command}", got "{unexpected}".'
+        )
         sys.exit(2)
+    if '_' in pattern:
+        return unknown[pattern.index('_')]
+    return None
 
 
 def _is_command(command: str, args: List[str]) -> bool:
     """Check if args matches command.
 
     `_` are placeholders.
 
@@ -129,21 +210,22 @@
     - command: a string
     - args: a list of strings
 
     # Returned value
 
     A boolean.
     """
+    args = _filter_options(args[1:])
     pattern = command.split()
     pattern_length = len(pattern)
-    maybe_missing = pattern_length == len(args) and pattern[-1] == '_'
-    if pattern_length >= len(args) and not maybe_missing:
+    maybe_missing = pattern_length == len(args) + 1 and pattern[-1] == '_'
+    if pattern_length >= 1 + len(args) and not maybe_missing:
         return False
-    for pos, item in enumerate(pattern, start=1):
-        if maybe_missing and pos == pattern_length:
+    for pos, item in enumerate(pattern, start=0):
+        if maybe_missing and pos == pattern_length - 1:
             _error(
                 f'Missing required parameter.  Use "{" ".join(pattern[:-1])} --help" for details.'
             )
             sys.exit(1)
         if item not in ('_', args[pos]):
             return False
     return True
```

## opentf/tools/ctlconfig.py

```diff
@@ -370,31 +370,93 @@
         set-credentials      Set a user entry in the opentf-config
         delete-context       Unset a context entry in the opentf-config
         delete-orchestrator  Unset an orchestrator entry in the opentf-config
         delete-credentials   Unset a user entry in the opentf-config
         view                 Display current opentf-config
     """
     if _is_command('config generate', sys.argv):
+        _ensure_options(
+            'config generate',
+            sys.argv[1:],
+            extra=[
+                ('--name',),
+                ('--orchestrator-server',),
+                ('--orchestrator-receptionist-port',),
+                ('--orchestrator-observer-port',),
+                ('--orchestrator-eventbus-port',),
+                ('--orchestrator-agentchannel-port',),
+                ('--orchestrator-killswitch-port',),
+                ('--orchestrator-qualitygate-port',),
+                ('--insecure-skip-tls-verify',),
+            ],
+        )
         generate_config()
     elif _is_command('config use-context _', sys.argv):
-        use_context(sys.argv[3])
+        context = _ensure_options('config use-context _', sys.argv[1:])
+        use_context(context)
     elif _is_command('config set-context _', sys.argv):
-        set_context(sys.argv[3])
-    elif _is_command('config set-orchestrator _', sys.argv):
-        set_orchestrator(sys.argv[3])
-    elif _is_command('config set-credentials _', sys.argv):
-        set_credentials(sys.argv[3])
+        context = _ensure_options(
+            'config set-context _',
+            sys.argv[1:],
+            extra=[
+                ('--namespace',),
+            ],
+        )
+        set_context(context)
     elif _is_command('config delete-context _', sys.argv):
-        delete_context(sys.argv[3])
+        context = _ensure_options('config delete-context _', sys.argv[1:])
+        delete_context(context)
+    elif _is_command('config set-orchestrator _', sys.argv):
+        orchestrator = _ensure_options(
+            'config set-orchestrator _',
+            sys.argv[1:],
+            extra=[
+                ('--server',),
+                ('--receptionist-port',),
+                ('--observer-port',),
+                ('--eventbus-port',),
+                ('--agentchannel-port',),
+                ('--killswitch-port',),
+                ('--qualitygate-port',),
+                ('--insecure-skip-tls-verify',),
+                ('--receptionist-prefix',),
+                ('--observer-prefix',),
+                ('--eventbus-prefix',),
+                ('--agentchannel-prefix',),
+                ('--killswitch-prefix',),
+                ('--qualitygate-prefix',),
+                ('--receptionist-force-base-url',),
+                ('--observer-force-base-url',),
+                ('--eventbus-force-base-url',),
+                ('--agentchannel-force-base-url',),
+                ('--killswitch-force-base-url',),
+                ('--qualitygate-force-base-url',),
+                ('--insecure-skip-tls-verify',),
+            ],
+        )
+        set_orchestrator(orchestrator)
     elif _is_command('config delete-orchestrator _', sys.argv):
-        delete_orchestrator(sys.argv[3])
+        orchestrator = _ensure_options('config delete-orchestrator _', sys.argv[1:])
+        delete_orchestrator(orchestrator)
+    elif _is_command('config set-credentials _', sys.argv):
+        credentials = _ensure_options(
+            'config set-credentials _',
+            sys.argv[1:],
+            extra=[
+                ('--step-depth',),
+                ('--job-depth',),
+                ('--max-command-length',),
+            ],
+        )
+        set_credentials(credentials)
     elif _is_command('config delete-credentials _', sys.argv):
-        delete_credentials(sys.argv[3])
+        credentials = _ensure_options('config delete-credentials _', sys.argv[1:])
+        delete_credentials(credentials)
     elif _is_command('config view', sys.argv):
-        _ensure_options(sys.argv[3:])
+        _ensure_options('config view', sys.argv[1:])
         view_config()
     elif len(sys.argv) == 2:
         print_config_help(sys.argv)
     else:
         _error(
             'Unknown subcommand.  Use "opentf-ctl config --help" to list known subcommands.'
         )
```

## opentf/tools/ctlqualitygate.py

```diff
@@ -303,29 +303,35 @@
         _error('Unknown command.  Use --help to list known commands.')
         sys.exit(1)
 
 
 def qualitygate_cmd():
     """Interact with qualitygate."""
     if _is_command('get qualitygate _', sys.argv):
-        _ensure_options(
-            sys.argv[4:], [('--mode', '-m'), ('--output', '-o'), ('--using', '-u')]
+        workflow_id = _ensure_options(
+            'get qualitygate _',
+            sys.argv[1:],
+            extra=[('--mode', '-m'), ('--output', '-o'), ('--using', '-u')],
         )
         read_configuration()
         get_qualitygate(
-            sys.argv[3],
+            workflow_id,
             _get_arg('--mode=') or _get_arg('-m=') or 'strict',
             False,
             _get_arg('--using=') or _get_arg('-u='),
         )
     elif _is_command('describe qualitygate _', sys.argv):
-        _ensure_options(sys.argv[4:], [('--mode', '-m'), ('--using', '-u')])
+        workflow_id = _ensure_options(
+            'describe qualitygate _',
+            sys.argv[1:],
+            extra=[('--mode', '-m'), ('--using', '-u')],
+        )
         read_configuration()
         get_qualitygate(
-            sys.argv[3],
+            workflow_id,
             _get_arg('--mode=') or _get_arg('-m=') or 'strict',
             True,
             _get_arg('--using=') or _get_arg('-u='),
         )
     else:
         _error('Unknown command.  Use --help to list known commands.')
         sys.exit(1)
```

## opentf/tools/ctlworkflows.py

```diff
@@ -813,51 +813,59 @@
         _error('Unknown command.  Use --help to list known commands.')
         sys.exit(1)
 
 
 def workflow_cmd():
     """Interact with workflows."""
     if _is_command('get workflows', sys.argv):
-        _ensure_options(sys.argv[3:], [('--output', '-o')])
+        _ensure_options('get workflows', sys.argv[1:], extra=[('--output', '-o')])
         read_configuration()
         list_workflows()
     elif _is_command('run workflow _', sys.argv):
-        _ensure_options(
-            sys.argv[4:],
-            [
-                ('-e',),
-                ('-f',),
-                ('--step-depth', '--step_depth', '-s'),
-                ('--job-depth', '--job_depth', '-j'),
-                ('--max-command-length', '--max_command_length', '-c'),
+        workflow = _ensure_options(
+            'run workflow _',
+            sys.argv[1:],
+            extra=[
+                ('--step-depth', '-s'),
+                ('--job-depth', '-j'),
+                ('--max-command-length', '-c'),
                 ('--namespace', '-n'),
                 ('--selector', '-l', '--field-selector'),
             ],
-            [
+            multi=[
+                ('-e',),
+                ('-f',),
+            ],
+            flags=[
                 ('--wait', '--watch', '-w'),
                 ('--show-notifications', '-a'),
                 ('--verbose', '-v'),
             ],
         )
         read_configuration()
-        run_workflow(sys.argv[3])
+        run_workflow(workflow)
     elif _is_command('get workflow _', sys.argv):
-        _ensure_options(
-            sys.argv[4:],
-            [
-                ('--step-depth', '--step_depth', '-s'),
-                ('--job-depth', '--job_depth', '-j'),
-                ('--max-command-length', '--max_command_length', '-c'),
+        workflow_id = _ensure_options(
+            'get workflow _',
+            sys.argv[1:],
+            extra=[
+                ('--step-depth', '-s'),
+                ('--job-depth', '-j'),
+                ('--max-command-length', '-c'),
                 ('--output', '-o'),
                 ('--selector', '-l', '--field-selector'),
             ],
-            [('--watch', '-w'), ('--show-notifications', '-a'), ('--verbose', '-v')],
+            flags=[
+                ('--watch', '-w'),
+                ('--show-notifications', '-a'),
+                ('--verbose', '-v'),
+            ],
         )
         read_configuration()
-        get_workflow(sys.argv[3], '--watch' in sys.argv or '-w' in sys.argv)
+        get_workflow(workflow_id, '--watch' in sys.argv or '-w' in sys.argv)
     elif _is_command('kill workflow _', sys.argv):
-        _ensure_options(sys.argv[4:])
+        workflow_id = _ensure_options('kill workflow _', sys.argv[1:])
         read_configuration()
-        kill_workflow(sys.argv[3])
+        kill_workflow(workflow_id)
     else:
         _error('Unknown command.  Use --help to list known commands.')
         sys.exit(1)
```

## Comparing `opentf_tools_nightly-0.43.0.dev470.dist-info/LICENSE` & `opentf_tools_nightly-0.43.0.dev474.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `opentf_tools_nightly-0.43.0.dev470.dist-info/METADATA` & `opentf_tools_nightly-0.43.0.dev474.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: opentf-tools-nightly
-Version: 0.43.0.dev470
+Version: 0.43.0.dev474
 Summary: OpenTestFactory Orchestrator Tools
 Home-page: https://opentestfactory.org/tools/
 Author: Martin Lafaix
 Author-email: mlafaix@henix.com
 Maintainer: Henix
 Maintainer-email: opentestfactory@henix.com
 License: Apache Software License (https://www.apache.org/licenses/LICENSE-2.0)
```

