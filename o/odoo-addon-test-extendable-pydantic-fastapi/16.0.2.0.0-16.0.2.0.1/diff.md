# Comparing `tmp/odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0-py3-none-any.whl.zip` & `tmp/odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,20 +1,20 @@
-Zip file size: 23440 bytes, number of entries: 18
--rw-r--r--  2.0 unx     2834 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/README.rst
--rw-r--r--  2.0 unx       43 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/__init__.py
--rw-r--r--  2.0 unx      705 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/__manifest__.py
--rw-r--r--  2.0 unx     1093 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/routers.py
--rw-r--r--  2.0 unx      819 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/schemas.py
--rw-r--r--  2.0 unx      538 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/i18n/test_extendable_pydantic_fastapi.pot
--rw-r--r--  2.0 unx       31 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/models/__init__.py
--rw-r--r--  2.0 unx      477 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/models/fastapi_endpoint.py
--rw-r--r--  2.0 unx       59 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      110 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx     9455 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/static/description/icon.png
--rw-r--r--  2.0 unx    11948 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/static/description/index.html
--rw-r--r--  2.0 unx       24 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/tests/__init__.py
--rw-r--r--  2.0 unx     4286 b- defN 23-Jul-25 16:11 odoo/addons/test_extendable_pydantic_fastapi/tests/test_user.py
--rw-r--r--  2.0 unx     3674 b- defN 23-Jul-25 16:11 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-25 16:11 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jul-25 16:11 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2154 b- defN 23-Jul-25 16:11 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/RECORD
-18 files, 38347 bytes uncompressed, 19652 bytes compressed:  48.8%
+Zip file size: 24525 bytes, number of entries: 18
+-rw-r--r--  2.0 unx     2834 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/README.rst
+-rw-r--r--  2.0 unx       43 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/__init__.py
+-rw-r--r--  2.0 unx      705 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/__manifest__.py
+-rw-r--r--  2.0 unx     2829 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/routers.py
+-rw-r--r--  2.0 unx     1504 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/schemas.py
+-rw-r--r--  2.0 unx      538 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/i18n/test_extendable_pydantic_fastapi.pot
+-rw-r--r--  2.0 unx       31 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/models/__init__.py
+-rw-r--r--  2.0 unx      477 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/models/fastapi_endpoint.py
+-rw-r--r--  2.0 unx       59 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      110 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/static/description/icon.png
+-rw-r--r--  2.0 unx    11948 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/static/description/index.html
+-rw-r--r--  2.0 unx       24 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/tests/__init__.py
+-rw-r--r--  2.0 unx     7671 b- defN 23-Aug-01 06:17 odoo/addons/test_extendable_pydantic_fastapi/tests/test_user.py
+-rw-r--r--  2.0 unx     3674 b- defN 23-Aug-01 06:17 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Aug-01 06:17 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Aug-01 06:17 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2155 b- defN 23-Aug-01 06:17 odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/RECORD
+18 files, 44154 bytes uncompressed, 20737 bytes compressed:  53.0%
```

## zipnote {}

```diff
@@ -36,20 +36,20 @@
 
 Filename: odoo/addons/test_extendable_pydantic_fastapi/tests/__init__.py
 Comment: 
 
 Filename: odoo/addons/test_extendable_pydantic_fastapi/tests/test_user.py
 Comment: 
 
-Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/METADATA
+Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/WHEEL
+Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/top_level.txt
+Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/RECORD
+Filename: odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/test_extendable_pydantic_fastapi/__manifest__.py

```diff
@@ -2,15 +2,15 @@
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl).
 
 {
     "name": "Test Extendable Pydantic Fastapi",
     "summary": """
         Tests integration between extendable_pydantic/odoo_addon_fastapi and
         odoo_addon_extendable_fastapi""",
-    "version": "16.0.2.0.0",
+    "version": "16.0.2.0.1",
     "license": "LGPL-3",
     "author": "ACSONE SA/NV,Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/rest-framework",
     "depends": [
         "fastapi",
         "extendable_fastapi",
     ],
```

## odoo/addons/test_extendable_pydantic_fastapi/routers.py

```diff
@@ -1,31 +1,82 @@
 # Copyright 2023 ACSONE SA/NV
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl).
-from fastapi import APIRouter
+from typing import Annotated
+
+from odoo import api
+
+from odoo.addons.fastapi.dependencies import odoo_env
+
+from fastapi import APIRouter, Depends
 
 from .schemas import PrivateUser, User, UserSearchResponse
 
 demo_pydantic_router = APIRouter(tags=["demo_pydantic"])
 
 
+@demo_pydantic_router.get("/{user_id}")
+def get(env: Annotated[api.Environment, Depends(odoo_env)], user_id: int) -> User:
+    """
+    Get a specific user using its Odoo id.
+    """
+    user = env["res.users"].sudo().search([("id", "=", user_id)])
+    if not user:
+        raise ValueError("No user found")
+    return User.from_user(user)
+
+
+@demo_pydantic_router.get("/private/{user_id}")
+def get_private(
+    env: Annotated[api.Environment, Depends(odoo_env)], user_id: int
+) -> User:
+    """
+    Get a specific user using its Odoo id.
+    """
+    user = env["res.users"].sudo().search([("id", "=", user_id)])
+    if not user:
+        raise ValueError("No user found")
+    return PrivateUser.from_user(user)
+
+
 @demo_pydantic_router.post("/post_user")
 def post_user(user: User) -> UserSearchResponse:
     """A demo endpoint to test the extendable pydantic model integration
     with fastapi and odoo.
 
     Type of the request body is User. This model is the base model
     of ExtendedUser. At runtime, the documentation and the processing
     of the request body should be done as if the type of the request body
     was ExtendedUser.
     """
     return UserSearchResponse(total=1, items=[user])
 
 
 @demo_pydantic_router.post("/post_private_user")
-def post_private_user(user: PrivateUser) -> UserSearchResponse:
+def post_private_user(user: PrivateUser) -> User:
+    """A demo endpoint to test the extendable pydantic model integration
+    with fastapi and odoo.
+
+    Type of the request body is PrivateUser. This model inherits base model
+    User but does not extend it.
+
+    This method will return attributes from the declared response type.
+    It will never return attribute of a derived type from the declared response
+    type, even if in the route implementation we return an instance of the
+    derived type.
+    """
+    return user
+
+
+@demo_pydantic_router.post("/post_private_user_generic")
+def post_private_user_generic(user: PrivateUser) -> UserSearchResponse:
     """A demo endpoint to test the extendable pydantic model integration
     with fastapi and odoo.
 
     Type of the request body is PrivateUser. This model inherits base model
-    User.
+    User but does not extend it.
+
+    This method will return attributes from the declared response type.
+    It will never return attribute of a derived type from the declared response
+    type, even if in the route implementation we return an instance of the
+    derived type. This assertion is also true with generics.
     """
     return UserSearchResponse(total=1, items=[user])
```

## odoo/addons/test_extendable_pydantic_fastapi/schemas.py

```diff
@@ -3,25 +3,50 @@
 from typing import Generic, TypeVar
 
 from extendable_pydantic.main import ExtendableModelMeta
 
 from pydantic import BaseModel
 
 
-class User(BaseModel, metaclass=ExtendableModelMeta):
+class User(BaseModel, metaclass=ExtendableModelMeta, revalidate_instances="always"):
+    """
+    We MUST set revalidate_instances="always" to be sure that FastAPI validates
+    responses of this model type.
+    """
+
     name: str
 
+    @classmethod
+    def from_user(cls, user):
+        res = cls.model_construct()
+        res.name = user.name
+        return res
+
 
 class ExtendedUser(User, extends=User):
     address: str
 
+    @classmethod
+    def from_user(cls, user):
+        res = super().from_user(user)
+        if user.street or user.city:
+            # Dummy address construction
+            res.address = (user.street or "") + (user.city or "")
+        return res
+
 
 class PrivateUser(User):
     password: str
 
+    @classmethod
+    def from_user(cls, user):
+        res = super().from_user(user)
+        res.password = user.password
+        return res
+
 
 _T = TypeVar("_T")
 
 
 class SearchResponse(BaseModel, Generic[_T], metaclass=ExtendableModelMeta):
     total: int
     items: list[_T]
```

## odoo/addons/test_extendable_pydantic_fastapi/tests/test_user.py

```diff
@@ -2,14 +2,16 @@
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 from requests import Response
 
 from odoo.tests.common import tagged
 
 from odoo.addons.extendable_fastapi.tests.common import FastAPITransactionCase
 
+from fastapi.exceptions import ResponseValidationError
+
 from ..routers import demo_pydantic_router
 from ..schemas import PrivateUser, User
 
 
 @tagged("post_install", "-at_install")
 class TestUser(FastAPITransactionCase):
     @classmethod
@@ -38,14 +40,26 @@
                 ]["application/json"]["schema"]["$ref"],
                 "#/components/schemas/PrivateUser",
             )
             self.assertEqual(
                 to_openapi["paths"]["/post_private_user"]["post"]["responses"]["200"][
                     "content"
                 ]["application/json"]["schema"]["$ref"],
+                "#/components/schemas/User",
+            )
+            self.assertEqual(
+                to_openapi["paths"]["/post_private_user_generic"]["post"][
+                    "requestBody"
+                ]["content"]["application/json"]["schema"]["$ref"],
+                "#/components/schemas/PrivateUser",
+            )
+            self.assertEqual(
+                to_openapi["paths"]["/post_private_user_generic"]["post"]["responses"][
+                    "200"
+                ]["content"]["application/json"]["schema"]["$ref"],
                 "#/components/schemas/UserSearchResponse",
             )
 
             # Check Pydantic model extension
             self.assertEqual(
                 set(to_openapi["components"]["schemas"]["User"]["properties"].keys()),
                 {"name", "address"},
@@ -81,27 +95,97 @@
             self.assertEqual(res["total"], 1)
             user = res["items"][0]
             self.assertEqual(user["name"], name)
             self.assertEqual(user["address"], address)
             self.assertFalse("password" in user.keys())
 
     def test_post_private_user(self):
+        """
+        /post_private_user return attributes from User, but not PrivateUser
+
+        Security check: this method should never return attributes from
+        derived type PrivateUser, even thought a PrivateUser object
+        is given as input.
+        """
         name = "Jean Dupont"
         address = "Rue du Puits 12, 4000 Liège"
         password = "dummy123"
         pydantic_data = PrivateUser(name=name, address=address, password=password)
         # Assert that class was correctly extended
         self.assertTrue(pydantic_data.address)
         self.assertTrue(pydantic_data.password)
 
         with self._create_test_client(router=demo_pydantic_router) as test_client:
             response: Response = test_client.post(
                 "/post_private_user", content=pydantic_data.model_dump_json()
             )
             self.assertEqual(response.status_code, 200)
+            user = response.json()
+            self.assertEqual(user["name"], name)
+            self.assertEqual(user["address"], address)
+            # Private attrs were not returned
+            self.assertFalse("password" in user.keys())
+
+    def test_post_private_user_generic(self):
+        """
+        /post_private_user_generic return attributes from User, but not PrivateUser
+
+        Security check: this method should never return attributes from
+        derived type PrivateUser, even thought a PrivateUser object
+        is given as input.
+        This test is specifically made to test this assertion with generics.
+        """
+        name = "Jean Dupont"
+        address = "Rue du Puits 12, 4000 Liège"
+        password = "dummy123"
+        pydantic_data = PrivateUser(name=name, address=address, password=password)
+        # Assert that class was correctly extended
+        self.assertTrue(pydantic_data.address)
+        self.assertTrue(pydantic_data.password)
+
+        with self._create_test_client(router=demo_pydantic_router) as test_client:
+            response: Response = test_client.post(
+                "/post_private_user_generic", content=pydantic_data.model_dump_json()
+            )
+            self.assertEqual(response.status_code, 200)
             res = response.json()
             self.assertEqual(res["total"], 1)
             user = res["items"][0]
             self.assertEqual(user["name"], name)
             self.assertEqual(user["address"], address)
             # Private attrs were not returned
             self.assertFalse("password" in user.keys())
+
+    def test_get_user_failed_no_address(self):
+        """
+        Try to get a specific user but having no address
+        -> Error because address is a required field on User (extended) class
+        :return:
+        """
+        user = self.env["res.users"].create(
+            {
+                "name": "Michel Dupont",
+                "login": "michel",
+            }
+        )
+        with self._create_test_client(
+            router=demo_pydantic_router
+        ) as test_client, self.assertRaises(ResponseValidationError):
+            test_client.get(f"/{user.id}")
+
+    def test_get_user_failed_no_pwd(self):
+        """
+        Try to get a specific user having an address but no password.
+        -> No error because return type is User, not PrivateUser
+        :return:
+        """
+        user = self.env["res.users"].create(
+            {
+                "name": "Michel Dupont",
+                "login": "michel",
+                "street": "Rue du Moulin",
+            }
+        )
+        self.assertFalse(user.password)
+        with self._create_test_client(router=demo_pydantic_router) as test_client:
+            response: Response = test_client.get(f"/private/{user.id}")
+            self.assertEqual(response.status_code, 200)
```

## Comparing `odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/METADATA` & `odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-test-extendable-pydantic-fastapi
-Version: 16.0.2.0.0
+Version: 16.0.2.0.1
 Summary: Tests integration between extendable_pydantic/odoo_addon_fastapi and odoo_addon_extendable_fastapi
 Home-page: https://github.com/OCA/rest-framework
 Author: ACSONE SA/NV,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/RECORD` & `odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/RECORD`

 * *Files 26% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 odoo/addons/test_extendable_pydantic_fastapi/README.rst,sha256=mievgWofP-VcBlPn3l5G73MYnyKSoLo50vIqIieLVm0,2834
 odoo/addons/test_extendable_pydantic_fastapi/__init__.py,sha256=i_drVBWeZzPsEW8CXRE2dotlgc9JmkHDy6GjuZ3NlIU,43
-odoo/addons/test_extendable_pydantic_fastapi/__manifest__.py,sha256=M1CXUpbf5q2BppfhFa_tlIzD9aYPLS1Ju1b1xBz1SEg,705
-odoo/addons/test_extendable_pydantic_fastapi/routers.py,sha256=2sPkvC8nLG-J9fsRejS6p9Ev6rU-opfBxrE_OO86mT4,1093
-odoo/addons/test_extendable_pydantic_fastapi/schemas.py,sha256=_8OaLGRMmn7l-goWnmNW1tpek8ujMsab8EQaD_zwM5I,819
+odoo/addons/test_extendable_pydantic_fastapi/__manifest__.py,sha256=3NynayMLstj1OHRtfcdIYxlR0mTunZSbvplx1Fou-QE,705
+odoo/addons/test_extendable_pydantic_fastapi/routers.py,sha256=zHyJERDM2XqFUaEyugZe6pnnKTjHxaI7boCK4Jgvqzg,2829
+odoo/addons/test_extendable_pydantic_fastapi/schemas.py,sha256=BLgZRM3SOWA93bpqm24FH-hXurWABALOaoSxwda_x0M,1504
 odoo/addons/test_extendable_pydantic_fastapi/i18n/test_extendable_pydantic_fastapi.pot,sha256=E71KF6qxfhdaNthUTjnxWm9A5EgNZ6yvDcMZvDx_yUE,538
 odoo/addons/test_extendable_pydantic_fastapi/models/__init__.py,sha256=NF75IvaT9G60mgm2FqAkfw91SzMZ9m7CL41HiOD3rj4,31
 odoo/addons/test_extendable_pydantic_fastapi/models/fastapi_endpoint.py,sha256=je72u3ooHH-HMLu5hLrTmcdGZes6GkrEtbvSLdpJ_50,477
 odoo/addons/test_extendable_pydantic_fastapi/readme/CONTRIBUTORS.rst,sha256=b772IbzXD5vPJVDYedlDPPRZodoGMuwy2MEHCEWAH3E,59
 odoo/addons/test_extendable_pydantic_fastapi/readme/DESCRIPTION.rst,sha256=i0Wi1LlKrVBPrgBiX5KDPybV85g_dV79ihM2z_kumZ0,110
 odoo/addons/test_extendable_pydantic_fastapi/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
 odoo/addons/test_extendable_pydantic_fastapi/static/description/index.html,sha256=Gt0et0WaQuS0Isu5-QPg8P0C321VY4__VsYsGfjyE0A,11948
 odoo/addons/test_extendable_pydantic_fastapi/tests/__init__.py,sha256=UFAfeHohFc_ItgmMH45W0IQEJXUqQCzK6UUvB6xGYiY,24
-odoo/addons/test_extendable_pydantic_fastapi/tests/test_user.py,sha256=76kwZYwdDMG1gwor6Ov0ikC7TUQNLwLNvFPS7fIYQak,4286
-odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/METADATA,sha256=mP5VSJ_U6IXZRdtZhrgR8NZCS7AbJaVAsQrxSPus2os,3674
-odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.0.dist-info/RECORD,,
+odoo/addons/test_extendable_pydantic_fastapi/tests/test_user.py,sha256=QDLrkrnRlUiHkmvrE6wFgdnrLxjMHhhE7kFyODfwLYU,7671
+odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/METADATA,sha256=e6Snl9PXYWbzEHsHbd9HM-h39NPvGLXawhB0Pf8sVn8,3674
+odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/WHEEL,sha256=AtBG6SXL3KF_v0NxLf0ehyVOh0cold-JbJYXNGorC6Q,92
+odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_test_extendable_pydantic_fastapi-16.0.2.0.1.dist-info/RECORD,,
```

